var xi=(l,n)=>()=>(n||l((n={exports:{}}).exports,n),n.exports);var wi=xi(exports=>{(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var global$1=typeof window<"u"?window:null,ssr=global$1===null,document$1=ssr?void 0:global$1.document,addEventListener="addEventListener",removeEventListener="removeEventListener",getBoundingClientRect="getBoundingClientRect",gutterStartDragging="_a",aGutterSize="_b",bGutterSize="_c",HORIZONTAL="horizontal",NOOP=function(){return!1},calc=ssr?"calc":["","-webkit-","-moz-","-o-"].filter(function(l){var n=document$1.createElement("div");return n.style.cssText="width:"+l+"calc(9px)",!!n.style.length}).shift()+"calc",isString$1=function(l){return typeof l=="string"||l instanceof String},elementOrSelector=function(l){if(isString$1(l)){var n=document$1.querySelector(l);if(!n)throw new Error("Selector "+l+" did not match a DOM element");return n}return l},getOption=function(l,n,t){var e=l[n];return e!==void 0?e:t},getGutterSize=function(l,n,t,e){if(n){if(e==="end")return 0;if(e==="center")return l/2}else if(t){if(e==="start")return 0;if(e==="center")return l/2}return l},defaultGutterFn=function(l,n){var t=document$1.createElement("div");return t.className="gutter gutter-"+n,t},defaultElementStyleFn=function(l,n,t){var e={};return isString$1(n)?e[l]=n:e[l]=calc+"("+n+"% - "+t+"px)",e},defaultGutterStyleFn=function(l,n){var t;return t={},t[l]=n+"px",t},Split=function(l,n){if(n===void 0&&(n={}),ssr)return{};var t=l,e,i,s,r,o,h;Array.from&&(t=Array.from(t));var u=elementOrSelector(t[0]),p=u.parentNode,d=getComputedStyle?getComputedStyle(p):null,f=d?d.flexDirection:null,g=getOption(n,"sizes")||t.map(function(){return 100/t.length}),_=getOption(n,"minSize",100),v=Array.isArray(_)?_:t.map(function(){return _}),y=getOption(n,"maxSize",1/0),E=Array.isArray(y)?y:t.map(function(){return y}),m=getOption(n,"expandToMin",!1),x=getOption(n,"gutterSize",10),C=getOption(n,"gutterAlign","center"),O=getOption(n,"snapOffset",30),S=Array.isArray(O)?O:t.map(function(){return O}),P=getOption(n,"dragInterval",1),F=getOption(n,"direction",HORIZONTAL),V=getOption(n,"cursor",F===HORIZONTAL?"col-resize":"row-resize"),N=getOption(n,"gutter",defaultGutterFn),B=getOption(n,"elementStyle",defaultElementStyleFn),W=getOption(n,"gutterStyle",defaultGutterStyleFn);F===HORIZONTAL?(e="width",i="clientX",s="left",r="right",o="clientWidth"):F==="vertical"&&(e="height",i="clientY",s="top",r="bottom",o="clientHeight");function A(at,nt,ht,Ct){var gt=B(e,nt,ht,Ct);Object.keys(gt).forEach(function(mt){at.style[mt]=gt[mt]})}function G(at,nt,ht){var Ct=W(e,nt,ht);Object.keys(Ct).forEach(function(gt){at.style[gt]=Ct[gt]})}function D(){return h.map(function(at){return at.size})}function M(at){return"touches"in at?at.touches[0][i]:at[i]}function J(at){var nt=h[this.a],ht=h[this.b],Ct=nt.size+ht.size;nt.size=at/this.size*Ct,ht.size=Ct-at/this.size*Ct,A(nt.element,nt.size,this[aGutterSize],nt.i),A(ht.element,ht.size,this[bGutterSize],ht.i)}function et(at){var nt,ht=h[this.a],Ct=h[this.b];this.dragging&&(nt=M(at)-this.start+(this[aGutterSize]-this.dragOffset),P>1&&(nt=Math.round(nt/P)*P),nt<=ht.minSize+ht.snapOffset+this[aGutterSize]?nt=ht.minSize+this[aGutterSize]:nt>=this.size-(Ct.minSize+Ct.snapOffset+this[bGutterSize])&&(nt=this.size-(Ct.minSize+this[bGutterSize])),nt>=ht.maxSize-ht.snapOffset+this[aGutterSize]?nt=ht.maxSize+this[aGutterSize]:nt<=this.size-(Ct.maxSize-Ct.snapOffset+this[bGutterSize])&&(nt=this.size-(Ct.maxSize+this[bGutterSize])),J.call(this,nt),getOption(n,"onDrag",NOOP)(D()))}function Q(){var at=h[this.a].element,nt=h[this.b].element,ht=at[getBoundingClientRect](),Ct=nt[getBoundingClientRect]();this.size=ht[e]+Ct[e]+this[aGutterSize]+this[bGutterSize],this.start=ht[s],this.end=ht[r]}function ot(at){if(!getComputedStyle)return null;var nt=getComputedStyle(at);if(!nt)return null;var ht=at[o];return ht===0?null:(F===HORIZONTAL?ht-=parseFloat(nt.paddingLeft)+parseFloat(nt.paddingRight):ht-=parseFloat(nt.paddingTop)+parseFloat(nt.paddingBottom),ht)}function tt(at){var nt=ot(p);if(nt===null||v.reduce(function(mt,Rt){return mt+Rt},0)>nt)return at;var ht=0,Ct=[],gt=at.map(function(mt,Rt){var Ft=nt*mt/100,Pt=getGutterSize(x,Rt===0,Rt===at.length-1,C),X=v[Rt]+Pt;return Ft<X?(ht+=X-Ft,Ct.push(0),X):(Ct.push(Ft-X),Ft)});return ht===0?at:gt.map(function(mt,Rt){var Ft=mt;if(ht>0&&Ct[Rt]-ht>0){var Pt=Math.min(ht,Ct[Rt]-ht);ht-=Pt,Ft=mt-Pt}return Ft/nt*100})}function rt(){var at=this,nt=h[at.a].element,ht=h[at.b].element;at.dragging&&getOption(n,"onDragEnd",NOOP)(D()),at.dragging=!1,global$1[removeEventListener]("mouseup",at.stop),global$1[removeEventListener]("touchend",at.stop),global$1[removeEventListener]("touchcancel",at.stop),global$1[removeEventListener]("mousemove",at.move),global$1[removeEventListener]("touchmove",at.move),at.stop=null,at.move=null,nt[removeEventListener]("selectstart",NOOP),nt[removeEventListener]("dragstart",NOOP),ht[removeEventListener]("selectstart",NOOP),ht[removeEventListener]("dragstart",NOOP),nt.style.userSelect="",nt.style.webkitUserSelect="",nt.style.MozUserSelect="",nt.style.pointerEvents="",ht.style.userSelect="",ht.style.webkitUserSelect="",ht.style.MozUserSelect="",ht.style.pointerEvents="",at.gutter.style.cursor="",at.parent.style.cursor="",document$1.body.style.cursor=""}function ft(at){if(!("button"in at&&at.button!==0)){var nt=this,ht=h[nt.a].element,Ct=h[nt.b].element;nt.dragging||getOption(n,"onDragStart",NOOP)(D()),at.preventDefault(),nt.dragging=!0,nt.move=et.bind(nt),nt.stop=rt.bind(nt),global$1[addEventListener]("mouseup",nt.stop),global$1[addEventListener]("touchend",nt.stop),global$1[addEventListener]("touchcancel",nt.stop),global$1[addEventListener]("mousemove",nt.move),global$1[addEventListener]("touchmove",nt.move),ht[addEventListener]("selectstart",NOOP),ht[addEventListener]("dragstart",NOOP),Ct[addEventListener]("selectstart",NOOP),Ct[addEventListener]("dragstart",NOOP),ht.style.userSelect="none",ht.style.webkitUserSelect="none",ht.style.MozUserSelect="none",ht.style.pointerEvents="none",Ct.style.userSelect="none",Ct.style.webkitUserSelect="none",Ct.style.MozUserSelect="none",Ct.style.pointerEvents="none",nt.gutter.style.cursor=V,nt.parent.style.cursor=V,document$1.body.style.cursor=V,Q.call(nt),nt.dragOffset=M(at)-nt.end}}g=tt(g);var _t=[];h=t.map(function(at,nt){var ht={element:elementOrSelector(at),size:g[nt],minSize:v[nt],maxSize:E[nt],snapOffset:S[nt],i:nt},Ct;if(nt>0&&(Ct={a:nt-1,b:nt,dragging:!1,direction:F,parent:p},Ct[aGutterSize]=getGutterSize(x,nt-1===0,!1,C),Ct[bGutterSize]=getGutterSize(x,!1,nt===t.length-1,C),f==="row-reverse"||f==="column-reverse")){var gt=Ct.a;Ct.a=Ct.b,Ct.b=gt}if(nt>0){var mt=N(nt,F,ht.element);G(mt,x,nt),Ct[gutterStartDragging]=ft.bind(Ct),mt[addEventListener]("mousedown",Ct[gutterStartDragging]),mt[addEventListener]("touchstart",Ct[gutterStartDragging]),p.insertBefore(mt,ht.element),Ct.gutter=mt}return A(ht.element,ht.size,getGutterSize(x,nt===0,nt===t.length-1,C),nt),nt>0&&_t.push(Ct),ht});function yt(at){var nt=at.i===_t.length,ht=nt?_t[at.i-1]:_t[at.i];Q.call(ht);var Ct=nt?ht.size-at.minSize-ht[bGutterSize]:at.minSize+ht[aGutterSize];J.call(ht,Ct)}h.forEach(function(at){var nt=at.element[getBoundingClientRect]()[e];nt<at.minSize&&(m?yt(at):at.minSize=nt)});function Z(at){var nt=tt(at);nt.forEach(function(ht,Ct){if(Ct>0){var gt=_t[Ct-1],mt=h[gt.a],Rt=h[gt.b];mt.size=nt[Ct-1],Rt.size=ht,A(mt.element,mt.size,gt[aGutterSize],mt.i),A(Rt.element,Rt.size,gt[bGutterSize],Rt.i)}})}function bt(at,nt){_t.forEach(function(ht){if(nt!==!0?ht.parent.removeChild(ht.gutter):(ht.gutter[removeEventListener]("mousedown",ht[gutterStartDragging]),ht.gutter[removeEventListener]("touchstart",ht[gutterStartDragging])),at!==!0){var Ct=B(e,ht.a.size,ht[aGutterSize]);Object.keys(Ct).forEach(function(gt){h[ht.a].element.style[gt]="",h[ht.b].element.style[gt]=""})}})}return{setSizes:Z,getSizes:D,collapse:function(nt){yt(h[nt])},destroy:bt,parent:p,pairs:_t}};/*! lozad.js - v1.16.0 - 2020-09-06
* https://github.com/ApoorvSaxena/lozad.js
* Copyright (c) 2020 Apoorv Saxena; Licensed MIT */const isIE=typeof document<"u"&&document.documentMode,defaultConfig={rootMargin:"0px",threshold:0,load(l){if(l.nodeName.toLowerCase()==="picture"){let t=l.querySelector("img"),e=!1;t===null&&(t=document.createElement("img"),e=!0),isIE&&l.getAttribute("data-iesrc")&&(t.src=l.getAttribute("data-iesrc")),l.getAttribute("data-alt")&&(t.alt=l.getAttribute("data-alt")),e&&l.append(t)}if(l.nodeName.toLowerCase()==="video"&&!l.getAttribute("data-src")&&l.children){const t=l.children;let e;for(let i=0;i<=t.length-1;i++)e=t[i].getAttribute("data-src"),e&&(t[i].src=e);l.load()}l.getAttribute("data-poster")&&(l.poster=l.getAttribute("data-poster")),l.getAttribute("data-src")&&(l.src=l.getAttribute("data-src")),l.getAttribute("data-srcset")&&l.setAttribute("srcset",l.getAttribute("data-srcset"));let n=",";if(l.getAttribute("data-background-delimiter")&&(n=l.getAttribute("data-background-delimiter")),l.getAttribute("data-background-image"))l.style.backgroundImage=`url('${l.getAttribute("data-background-image").split(n).join("'),url('")}')`;else if(l.getAttribute("data-background-image-set")){const t=l.getAttribute("data-background-image-set").split(n);let e=t[0].substr(0,t[0].indexOf(" "))||t[0];e=e.indexOf("url(")===-1?`url(${e})`:e,t.length===1?l.style.backgroundImage=e:l.setAttribute("style",(l.getAttribute("style")||"")+`background-image: ${e}; background-image: -webkit-image-set(${t}); background-image: image-set(${t})`)}l.getAttribute("data-toggle-class")&&l.classList.toggle(l.getAttribute("data-toggle-class"))},loaded(){}};function markAsLoaded(l){l.setAttribute("data-loaded",!0)}function preLoad(l){l.getAttribute("data-placeholder-background")&&(l.style.background=l.getAttribute("data-placeholder-background"))}const isLoaded=l=>l.getAttribute("data-loaded")==="true",onIntersection=(l,n)=>(t,e)=>{t.forEach(i=>{(i.intersectionRatio>0||i.isIntersecting)&&(e.unobserve(i.target),isLoaded(i.target)||(l(i.target),markAsLoaded(i.target),n(i.target)))})},getElements=(l,n=document)=>l instanceof Element?[l]:l instanceof NodeList?l:n.querySelectorAll(l);function lozad(l=".lozad",n={}){const{root:t,rootMargin:e,threshold:i,load:s,loaded:r}=Object.assign({},defaultConfig,n);let o;typeof window<"u"&&window.IntersectionObserver&&(o=new IntersectionObserver(onIntersection(s,r),{root:t,rootMargin:e,threshold:i}));const h=getElements(l,t);for(let u=0;u<h.length;u++)preLoad(h[u]);return{observe(){const u=getElements(l,t);for(let p=0;p<u.length;p++)if(!isLoaded(u[p])){if(o){o.observe(u[p]);continue}s(u[p]),markAsLoaded(u[p]),r(u[p])}},triggerLoad(u){isLoaded(u)||(s(u),markAsLoaded(u),r(u))},observer:o}}const R={ui:[],debug:!1,dom:null,ID:null,lock:!1,wlock:!1,current:-1,needReZone:!0,needResize:!1,forceZone:!1,isEventsInit:!1,isLeave:!1,downTime:0,prevTime:0,prevDefault:["contextmenu"],pointerEvent:["pointerdown","pointermove","pointerup"],eventOut:["pointercancel","pointerout","pointerleave"],xmlserializer:null,tmpTime:null,tmpImage:null,oldCursor:"auto",input:null,parent:null,firstImput:!0,hiddenImput:null,hiddenSizer:null,hasFocus:!1,startInput:!1,inputRange:[0,0],cursorId:0,str:"",pos:0,startX:-1,moveX:-1,debugInput:!1,isLoop:!1,listens:[],e:{type:null,clientX:0,clientY:0,keyCode:NaN,key:null,delta:0},isMobile:!1,now:null,injectCss(l,n,t){const e=n||"codeflask-style",i=t||document.head;if(!l)return!1;if(document.getElementById(e))return!0;const s=document.createElement("style");return s.innerHTML=l,s.id=e,i.appendChild(s),!0},getTime:function(){return self.performance&&self.performance.now?self.performance.now.bind(performance):Date.now},testMobile:function(){let l=navigator.userAgent;return!!(l.match(/Android/i)||l.match(/webOS/i)||l.match(/iPhone/i)||l.match(/iPad/i)||l.match(/iPod/i)||l.match(/BlackBerry/i)||l.match(/Windows Phone/i))},add:function(l){R.ui.push(l),R.getZone(l),R.isEventsInit||R.initEvents()},remove:function(l){let n=R.ui.indexOf(l);n!==-1&&(R.removeListen(l),R.ui.splice(n,1)),R.ui.length===0&&R.removeEvents()},initEvents:function(){if(R.isEventsInit)return;let l=document.body;R.isMobile=R.testMobile(),R.now=R.getTime(),R.isMobile?l.style.touchAction="none":l.addEventListener("wheel",R,{passive:!1}),l.addEventListener("pointercancel",R),l.addEventListener("pointerleave",R),l.addEventListener("pointermove",R),l.addEventListener("pointerdown",R),l.addEventListener("pointerup",R),l.addEventListener("keydown",R,!1),l.addEventListener("keyup",R,!1),window.addEventListener("resize",R.resize,!1),R.isEventsInit=!0,R.dom=l},removeEvents:function(){if(!R.isEventsInit)return;let l=document.body;R.isMobile||l.removeEventListener("wheel",R),l.removeEventListener("pointercancel",R),l.removeEventListener("pointerleave",R),l.removeEventListener("pointermove",R),l.removeEventListener("pointerdown",R),l.removeEventListener("pointerup",R),l.removeEventListener("keydown",R),l.removeEventListener("keyup",R),window.removeEventListener("resize",R.resize),R.isEventsInit=!1},resize:function(){let l=R.ui.length,n;for(;l--;)n=R.ui[l],n.isGui&&!n.isCanvasOnly&&n.autoResize&&n.calc();R.needReZone=!0,R.needResize=!1},out:function(){console.log("im am out"),R.clearOldID()},in:function(){console.log("im am in")},fakeUp:function(){this.handleEvent({type:"pointerup"})},handleEvent:function(l){R.needResize&&R.resize(),R.findZone(R.forceZone);let n=R.e,t=!1;l.type==="keydown"&&R.keydown(l),l.type==="keyup"&&R.keyup(l),l.type==="wheel"?n.delta=l.deltaY>0?1:-1:n.delta=0;let e=l.pointerType;if(n.clientX=(e==="touch"?l.pageX:l.clientX)||0,n.clientY=(e==="touch"?l.pageY:l.clientY)||0,n.type=l.type,R.eventOut.indexOf(l.type)!==-1&&(t=!0,n.type="mouseup"),l.type==="pointerleave"&&(R.isLeave=!0),l.type==="pointerdown"&&(n.type="mousedown"),l.type==="pointerup"&&(n.type="mouseup"),l.type==="pointermove"&&(R.isLeave&&(R.isLeave=!1,R.resize()),n.type="mousemove"),n.type==="mousedown"){if(R.downTime=R.now(),R.downTime-R.prevTime<200)return R.selectAll(),!1;R.prevTime=R.downTime,R.forceZone=!1}n.type==="mousedown"&&R.clearInput(),n.type==="mousedown"&&(R.lock=!0),n.type==="mouseup"&&(R.lock=!1),R.isMobile&&n.type==="mousedown"&&R.findID(n),n.type==="mousemove"&&!R.lock&&R.findID(n),R.ID!==null&&(R.ID.isCanvasOnly&&(n.clientX=R.ID.mouse.x,n.clientY=R.ID.mouse.y),R.ID.handleEvent(n)),R.isMobile&&n.type==="mouseup"&&R.clearOldID(),t&&R.clearOldID()},findID:function(l){let n=R.ui.length,t=-1,e,i,s;for(;n--;)if(e=R.ui[n],e.isCanvasOnly?(i=e.mouse.x,s=e.mouse.y):(i=l.clientX,s=l.clientY),R.onZone(e,i,s)){t=n,t!==R.current&&(R.clearOldID(),R.current=t,R.ID=e);break}t===-1&&R.clearOldID()},clearOldID:function(){R.ID&&(R.current=-1,R.ID.reset(),R.ID=null,R.cursor())},calcUis:(l,n,t,e=!1)=>{R.debug&&console.log("calc_uis !!");let i=l.length,s,r=0,o=0,h,u=0;for(;i--;){s=l[o],o++,!e&&s.isGroup&&s.calcUis();let p=s.margin||0;s.zone.w=s.w,s.zone.h=s.h+p,s.autoWidth?(r=0,s.zone.x=n.x+s.dx,s.zone.y=t,t+=s.h+p,u+=s.h+p):(r===0&&(u+=s.h+p),s.zone.x=n.x+r,s.zone.y=t,h=R.getWidth(s),h?s.zone.w=s.w=h:s.fw&&(s.zone.w=s.w=s.fw),r+=s.zone.w,r>=n.w&&(t+=s.h+p,r=0))}return u},findTarget:function(l,n){let t=l.length;for(;t--;)if(R.onZone(l[t],n.clientX,n.clientY))return t;return-1},findZone:function(l=!1){if(l&&(R.needReZone=l),!R.needReZone)return;let n=R.ui.length,t;for(;n--;)t=R.ui[n],R.getZone(t),t.isGui&&t.calcUis();R.needReZone=!1},onZone:function(l,n,t){if(n===void 0||t===void 0)return!1;let e=l.zone,i=n-e.x,s=t-e.y,r=i>=0&&s>=0&&i<=e.w&&s<=e.h;return r?l.local.set(i,s):l.local.neg(),r},getWidth:function(l){return l.getDom().clientWidth},getZone:function(l){if(l.isCanvasOnly||l.isEmpty)return;const t=l.getDom().getBoundingClientRect();l.zone={x:t.left,y:t.top,w:t.width,h:t.height},l.isBottom&&(l.zone.y=l.realTop)},cursor:function(l){l=l||"auto",l!==R.oldCursor&&(document.body.style.cursor=l,R.oldCursor=l)},toCanvas:function(l,n,t,e){if(R.xmlserializer||(R.xmlserializer=new XMLSerializer),e&&R.tmpTime!==null&&(clearTimeout(R.tmpTime),R.tmpTime=null),R.tmpTime!==null)return;R.lock&&(R.tmpTime=setTimeout(function(){R.tmpTime=null},10));let i=!1;(n!==l.canvas.width||t!==l.canvas.height)&&(i=!0),R.tmpImage===null&&(R.tmpImage=new Image);let s=R.tmpImage,r=R.xmlserializer.serializeToString(l.content),o='<svg xmlns="http://www.w3.org/2000/svg" width="'+n+'" height="'+t+'"><foreignObject style="pointer-events: none; left:0;" width="100%" height="100%">'+r+"</foreignObject></svg>";s.onload=function(){let h=l.canvas.getContext("2d");i?(l.canvas.width=n,l.canvas.height=t):h.clearRect(0,0,n,t),h.drawImage(this,0,0),l.onDraw()},s.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(o),s.crossOrigin=""},setHidden:function(){R.hiddenImput===null&&(R.hiddenImput=document.createElement("input"),R.hiddenImput.type="text",R.hiddenSizer=document.createElement("div"),document.body.appendChild(R.hiddenImput),document.body.appendChild(R.hiddenSizer));let l=R.debugInput?"":"opacity:0; zIndex:0;",n=R.parent.css.txtselect+"padding:0; width:auto; height:auto; left:10px; top:auto; color:#FFF; background:#000;"+l;R.hiddenImput.style.cssText=n+"bottom:10px;"+(R.debugInput?"":"transform:scale(0);"),R.hiddenSizer.style.cssText=n+"bottom:40px;",R.hiddenImput.style.width=R.input.clientWidth+"px",R.hiddenImput.value=R.str,R.hiddenSizer.innerHTML=R.str,R.hasFocus=!0},clearHidden:function(l){R.hiddenImput!==null&&(R.hasFocus=!1)},clickPos:function(l){let n=R.str.length,t=0,e=0;for(;n--&&(t+=R.textWidth(R.str[e]),!(t>=l));)e++;return e},upInput:function(l,n){if(R.parent===null)return!1;let t=!1;if(n){let e=R.clickPos(l);R.moveX=e,R.startX===-1?(R.startX=e,R.cursorId=e,R.inputRange=[R.startX,R.startX]):R.moveX!==R.startX&&(R.startX>R.moveX?R.inputRange=[R.moveX,R.startX]:R.inputRange=[R.startX,R.moveX]),t=!0}else R.startX!==-1&&(R.hasFocus=!0,R.hiddenImput.focus(),R.hiddenImput.selectionStart=R.inputRange[0],R.hiddenImput.selectionEnd=R.inputRange[1],R.startX=-1,t=!0);return t&&R.selectParent(),t},selectAll:function(){R.parent&&(R.str=R.input.textContent,R.inputRange=[0,R.str.length],R.hasFocus=!0,R.hiddenImput.focus(),R.hiddenImput.selectionStart=R.inputRange[0],R.hiddenImput.selectionEnd=R.inputRange[1],R.cursorId=R.inputRange[1],R.selectParent())},selectParent:function(){var l=R.textWidth(R.str.substring(0,R.cursorId)),n=R.textWidth(R.str.substring(0,R.inputRange[0])),t=R.textWidth(R.str.substring(R.inputRange[0],R.inputRange[1]));R.parent.select(l,n,t,R.hiddenSizer.innerHTML)},textWidth:function(l){return R.hiddenSizer===null?0:(l=l.replace(/ /g,"&nbsp;"),R.hiddenSizer.innerHTML=l,R.hiddenSizer.clientWidth)},clearInput:function(){R.parent!==null&&(R.firstImput||R.parent.validate(!0),R.clearHidden(),R.parent.unselect(),R.input.style.background=R.parent.colors.back,R.input.style.borderColor=R.parent.colors.border,R.parent.isEdit=!1,R.input=null,R.parent=null,R.str="",R.firstImput=!0)},setInput:function(l,n){R.clearInput(),R.input=l,R.parent=n,R.input.style.background=R.parent.colors.backoff,R.input.style.borderColor=R.parent.colors.select,R.str=R.input.textContent,R.setHidden()},keydown:function(l){if(R.parent===null)return;let n=l.which;l.shiftKey,R.firstImput=!1,R.hasFocus&&(window.focus(),R.hiddenImput.focus()),R.parent.isEdit=!0,n===13?R.clearInput():R.input.isNum?l.keyCode>47&&l.keyCode<58||l.keyCode>95&&l.keyCode<106||l.keyCode===190||l.keyCode===110||l.keyCode===8||l.keyCode===109?R.hiddenImput.readOnly=!1:R.hiddenImput.readOnly=!0:R.hiddenImput.readOnly=!1},keyup:function(l){R.parent!==null&&(R.str=R.hiddenImput.value,R.parent.allEqual?R.parent.sameStr(R.str):R.input.textContent=R.str,R.cursorId=R.hiddenImput.selectionStart,R.inputRange=[R.hiddenImput.selectionStart,R.hiddenImput.selectionEnd],R.selectParent(),R.parent.validate())},loop:function(){R.isLoop&&requestAnimationFrame(R.loop),R.update()},update:function(){let l=R.listens.length;for(;l--;)R.listens[l].listening()},removeListen:function(l){let n=R.listens.indexOf(l);n!==-1&&R.listens.splice(n,1),R.listens.length===0&&(R.isLoop=!1)},addListen:function(l){return R.listens.indexOf(l)!==-1?!1:(R.listens.push(l),R.isLoop||(R.isLoop=!0,R.loop()),!0)}},Roots=R,T={size:{w:320,h:24,p:30,s:8},texture:null,transition:.1,frag:document.createDocumentFragment(),colorRing:null,joystick_0:null,joystick_1:null,circular:null,knob:null,pad2d:null,svgns:"http://www.w3.org/2000/svg",links:"http://www.w3.org/1999/xlink",htmls:"http://www.w3.org/1999/xhtml",DOM_SIZE:["height","width","top","left","bottom","right","margin-left","margin-right","margin-top","margin-bottom"],SVG_TYPE_D:["pattern","defs","transform","stop","animate","radialGradient","linearGradient","animateMotion","use","filter","feColorMatrix"],SVG_TYPE_G:["svg","rect","circle","path","polygon","text","g","line","foreignObject"],PI:Math.PI,TwoPI:Math.PI*2,pi90:Math.PI*.5,pi60:Math.PI/3,torad:Math.PI/180,todeg:180/Math.PI,clamp:(l,n,t)=>(l=l<n?n:l,l=l>t?t:l,l),isDivid:l=>l*.5===Math.floor(l*.5),defineColor:(l,n=T.colors)=>{let t={...n},e=["fontFamily","fontWeight","fontShadow","fontSize"],i=!1;l.font&&(l.fontFamily=l.font),l.shadow&&(l.fontShadow=l.shadow),l.weight&&(l.fontWeight=l.weight),l.fontColor&&(l.text=l.fontColor),l.color&&(l.text=l.color),l.text&&(t.text=l.text,!l.fontColor&&!l.color&&(t.title=T.ColorLuma(l.text,-.25),t.titleoff=T.ColorLuma(l.text,-.5)),t.textOver=T.ColorLuma(l.text,.25),t.textSelect=T.ColorLuma(l.text,.5)),l.button&&(t.button=l.button,t.border=T.ColorLuma(l.button,.1),t.overoff=T.ColorLuma(l.button,.2)),l.select&&(t.select=l.select,t.over=T.ColorLuma(l.select,-.1)),l.itemBg&&(l.back=l.itemBg),l.back&&(t.back=l.back,t.backoff=T.ColorLuma(l.back,-.1)),l.fontSelect&&(t.textSelect=l.fontSelect),l.groupBorder&&(t.gborder=l.groupBorder),l.bgOver&&(t.backgroundOver=l.bgOver);for(let s in t)l[s]!==void 0&&(t[s]=l[s]);for(let s in l)e.indexOf(s)!==-1&&(i=!0);return i&&T.defineText(t),t},colors:{sx:4,sy:0,radius:6,showOver:1,content:"#37383d",background:"#28292e",backgroundOver:"rgba(40,40,40,0)",title:"#CCC",titleoff:"#BBB",text:"#DDD",textOver:"#EEE",textSelect:"#FFF",back:"rgba(0,0,0,0.2)",backoff:"rgba(0,0,0,0.3)",border:"#4c4c4c",borderSize:1,gborder:"none",groups:"none",button:"#3c3c3c",overoff:"#5c5c5c",over:"#024699",select:"#308AFF",action:"#FF3300",fontFamily:"Roboto Mono, Source Code Pro, Menlo, Courier, monospace",fontWeight:"normal",fontShadow:"none",fontSize:11,joyOver:"rgba(48,138,255,0.25)",joyOut:"rgba(100,100,100,0.5)",joySelect:"#308AFF",hide:"rgba(0,0,0,0)"},css:{basic:"position:absolute; pointer-events:none; box-sizing:border-box; margin:0; padding:0; overflow:hidden; -o-user-select:none; -ms-user-select:none; -khtml-user-select:none; -webkit-user-select:none; -moz-user-select:none;",button:"display:flex; align-items:center; justify-content:center; text-align:center;",middle:"display:flex; align-items:center; justify-content:left; text-align:left; flex-direction: row-reverse;"},svgs:{g1:"M 6 4 L 0 4 0 6 6 6 6 4 M 6 0 L 0 0 0 2 6 2 6 0 Z",g2:"M 6 0 L 4 0 4 6 6 6 6 0 M 2 0 L 0 0 0 6 2 6 2 0 Z",group:"M 7 7 L 7 8 8 8 8 7 7 7 M 5 7 L 5 8 6 8 6 7 5 7 M 3 7 L 3 8 4 8 4 7 3 7 M 7 5 L 7 6 8 6 8 5 7 5 M 6 6 L 6 5 5 5 5 6 6 6 M 7 3 L 7 4 8 4 8 3 7 3 M 6 4 L 6 3 5 3 5 4 6 4 M 3 5 L 3 6 4 6 4 5 3 5 M 3 3 L 3 4 4 4 4 3 3 3 Z",arrow:"M 3 8 L 8 5 3 2 3 8 Z",arrowDown:"M 5 8 L 8 3 2 3 5 8 Z",arrowUp:"M 5 2 L 2 7 8 7 5 2 Z",solid:"M 13 10 L 13 1 4 1 1 4 1 13 10 13 13 10 M 11 3 L 11 9 9 11 3 11 3 5 5 3 11 3 Z",body:"M 13 10 L 13 1 4 1 1 4 1 13 10 13 13 10 M 11 3 L 11 9 9 11 3 11 3 5 5 3 11 3 M 5 4 L 4 5 4 10 9 10 10 9 10 4 5 4 Z",vehicle:"M 13 6 L 11 1 3 1 1 6 1 13 3 13 3 11 11 11 11 13 13 13 13 6 M 2.4 6 L 4 2 10 2 11.6 6 2.4 6 M 12 8 L 12 10 10 10 10 8 12 8 M 4 8 L 4 10 2 10 2 8 4 8 Z",articulation:"M 13 9 L 12 9 9 2 9 1 5 1 5 2 2 9 1 9 1 13 5 13 5 9 4 9 6 5 8 5 10 9 9 9 9 13 13 13 13 9 Z",character:"M 13 4 L 12 3 9 4 5 4 2 3 1 4 5 6 5 8 4 13 6 13 7 9 8 13 10 13 9 8 9 6 13 4 M 6 1 L 6 3 8 3 8 1 6 1 Z",terrain:"M 13 8 L 12 7 Q 9.06 -3.67 5.95 4.85 4.04 3.27 2 7 L 1 8 7 13 13 8 M 3 8 Q 3.78 5.420 5.4 6.6 5.20 7.25 5 8 L 7 8 Q 8.39 -0.16 11 8 L 7 11 3 8 Z",joint:"M 7.7 7.7 Q 8 7.45 8 7 8 6.6 7.7 6.3 7.45 6 7 6 6.6 6 6.3 6.3 6 6.6 6 7 6 7.45 6.3 7.7 6.6 8 7 8 7.45 8 7.7 7.7 M 3.35 8.65 L 1 11 3 13 5.35 10.65 Q 6.1 11 7 11 8.28 11 9.25 10.25 L 7.8 8.8 Q 7.45 9 7 9 6.15 9 5.55 8.4 5 7.85 5 7 5 6.54 5.15 6.15 L 3.7 4.7 Q 3 5.712 3 7 3 7.9 3.35 8.65 M 10.25 9.25 Q 11 8.28 11 7 11 6.1 10.65 5.35 L 13 3 11 1 8.65 3.35 Q 7.9 3 7 3 5.7 3 4.7 3.7 L 6.15 5.15 Q 6.54 5 7 5 7.85 5 8.4 5.55 9 6.15 9 7 9 7.45 8.8 7.8 L 10.25 9.25 Z",ray:"M 9 11 L 5 11 5 12 9 12 9 11 M 12 5 L 11 5 11 9 12 9 12 5 M 11.5 10 Q 10.9 10 10.45 10.45 10 10.9 10 11.5 10 12.2 10.45 12.55 10.9 13 11.5 13 12.2 13 12.55 12.55 13 12.2 13 11.5 13 10.9 12.55 10.45 12.2 10 11.5 10 M 9 10 L 10 9 2 1 1 2 9 10 Z",collision:"M 11 12 L 13 10 10 7 13 4 11 2 7.5 5.5 9 7 7.5 8.5 11 12 M 3 2 L 1 4 4 7 1 10 3 12 8 7 3 2 Z",map:"M 13 1 L 1 1 1 13 13 13 13 1 M 12 2 L 12 7 7 7 7 12 2 12 2 7 7 7 7 2 12 2 Z",material:"M 13 1 L 1 1 1 13 13 13 13 1 M 12 2 L 12 7 7 7 7 12 2 12 2 7 7 7 7 2 12 2 Z",texture:"M 13 4 L 13 1 1 1 1 4 5 4 5 13 9 13 9 4 13 4 Z",object:"M 10 1 L 7 4 4 1 1 1 1 13 4 13 4 5 7 8 10 5 10 13 13 13 13 1 10 1 Z",none:"M 9 5 L 5 5 5 9 9 9 9 5 Z",cursor:"M 4 7 L 1 10 1 12 2 13 4 13 7 10 9 14 14 0 0 5 4 7 Z",load:"M 13 8 L 11.5 6.5 9 9 9 3 5 3 5 9 2.5 6.5 1 8 7 14 13 8 M 9 2 L 9 0 5 0 5 2 9 2 Z",save:"M 9 12 L 5 12 5 14 9 14 9 12 M 11.5 7.5 L 13 6 7 0 1 6 2.5 7.5 5 5 5 11 9 11 9 5 11.5 7.5 Z",extern:"M 14 14 L 14 0 0 0 0 14 14 14 M 12 6 L 12 12 2 12 2 6 12 6 M 12 2 L 12 4 2 4 2 2 12 2 Z"},setDebug(l){Roots.debug=l},rezone(){Roots.needReZone=!0},getImput:function(){return!!Roots.input},setStyle:function(l){for(var n in l)T.colors[n]&&(T.colors[n]=l[n]);T.setText()},defineText:function(l){T.setText(l.fontSize,l.text,l.fontFamily,l.fontShadow,l.fontWeight)},setText:function(l,n,t,e,i){let s=T.colors;t===void 0&&(t=s.fontFamily),l===void 0&&(l=s.fontSize),e===void 0&&(e=s.fontShadow),i===void 0&&(i=s.fontWeight),n===void 0&&(n=s.text),isNaN(l)?l.search("em")===-1&&(l+="px"):l+="px",T.css.txt=T.css.basic+T.css.middle+" font-family:"+t+"; font-weight:"+i+"; font-size:"+l+"; color:"+s.text+"; padding:0px 8px; left:0; top:2px; height:16px; width:100px; overflow:hidden; white-space: nowrap; letter-spacing:normal;",e!=="none"&&(T.css.txt+=" text-shadow: 1px 1px 1px "+e+";"),T.css.txtselect=T.css.txt+"padding:0px 4px; border:1px dashed "+s.border+";",T.css.item=T.css.txt+"padding:0px 4px; position:relative; margin-bottom:1px; "},cloneCss:function(){return{...T.css}},clone:function(l){return l.cloneNode(!0)},setSvg:function(l,n,t,e,i){e===-1?l.setAttributeNS(null,n,t):i!==void 0?l.childNodes[e||0].childNodes[i||0].setAttributeNS(null,n,t):l.childNodes[e||0].setAttributeNS(null,n,t)},setCss:function(l,n){for(let t in n)T.DOM_SIZE.indexOf(t)!==-1?l.style[t]=n[t]+"px":l.style[t]=n[t]},set:function(l,n){for(let t in n)t==="txt"&&(l.textContent=n[t]),t==="link"?l.setAttributeNS(T.links,"xlink:href",n[t]):l.setAttributeNS(null,t,n[t])},get:function(l,n){if(n===void 0)return l;if(isNaN(n)){if(n instanceof Array){if(n.length===2)return l.childNodes[n[0]].childNodes[n[1]];if(n.length===3)return l.childNodes[n[0]].childNodes[n[1]].childNodes[n[2]]}}else return l.childNodes[n]},dom:function(l,n,t,e,i){return l=l||"div",T.SVG_TYPE_D.indexOf(l)!==-1||T.SVG_TYPE_G.indexOf(l)!==-1?l==="svg"?(e=document.createElementNS(T.svgns,"svg"),T.set(e,t)):(e===void 0&&(e=document.createElementNS(T.svgns,"svg")),T.addAttributes(e,l,t,i)):e===void 0?e=document.createElementNS(T.htmls,l):e=e.appendChild(document.createElementNS(T.htmls,l)),n&&(e.style.cssText=n),i===void 0?e:e.childNodes[i||0]},addAttributes:function(l,n,t,e){let i=document.createElementNS(T.svgns,n);return T.set(i,t),T.get(l,e).appendChild(i),T.SVG_TYPE_G.indexOf(n)!==-1&&(i.style.pointerEvents="none"),i},clear:function(l){for(T.purge(l);l.firstChild;)l.firstChild.firstChild&&T.clear(l.firstChild),l.removeChild(l.firstChild)},purge:function(l){let n=l.attributes,t,e;if(n)for(t=n.length;t--;)e=n[t].name,typeof l[e]=="function"&&(l[e]=null);if(n=l.childNodes,n)for(t=n.length;t--;)T.purge(l.childNodes[t])},addSVGGlowEffect:function(){if(document.getElementById("UILGlow")!==null)return;let l=T.initUILEffects(),n=T.addAttributes(l,"filter",{id:"UILGlow",x:"-20%",y:"-20%",width:"140%",height:"140%"});T.addAttributes(n,"feGaussianBlur",{in:"SourceGraphic",stdDeviation:"3",result:"uilBlur"});let t=T.addAttributes(n,"feMerge",{});for(let e=0;e<=3;e++)T.addAttributes(t,"feMergeNode",{in:"uilBlur"});T.addAttributes(t,"feMergeNode",{in:"SourceGraphic"})},initUILEffects:function(){let l=document.getElementById("UILSVGEffects");return l===null&&(l=T.dom("svg",void 0,{id:"UILSVGEffects",width:"0",height:"0"}),document.body.appendChild(l)),l},ColorLuma:function(l,n){l==="n"&&(l="#000"),l=String(l).replace(/[^0-9a-f]/gi,""),l.length<6&&(l=l[0]+l[0]+l[1]+l[1]+l[2]+l[2]),n=n||0;let t="#",e,i;for(i=0;i<3;i++)e=parseInt(l.substr(i*2,2),16),e=Math.round(Math.min(Math.max(0,e+e*n),255)).toString(16),t+=("00"+e).substr(e.length);return t},findDeepInver:function(l){return l[0]*.3+l[1]*.59+l[2]*.11<=.6},lerpColor:function(l,n,t){let e={};for(let i=0;i<3;i++)e[i]=l[i]+(n[i]-l[i])*t;return e},hexToHtml:function(l){return l=l===void 0?0:l,"#"+("000000"+l.toString(16)).substr(-6)},htmlToHex:function(l){return l.toUpperCase().replace("#","0x")},u255:function(l,n){return parseInt(l.substring(n,n+2),16)/255},u16:function(l,n){return parseInt(l.substring(n,n+1),16)/15},unpack:function(l){if(l.length==7)return[T.u255(l,1),T.u255(l,3),T.u255(l,5)];if(l.length==4)return[T.u16(l,1),T.u16(l,2),T.u16(l,3)]},p255:function(l){let n=Math.round(l*255).toString(16);return n.length<2&&(n="0"+n),n},pack:function(l){return"#"+T.p255(l[0])+T.p255(l[1])+T.p255(l[2])},htmlRgba:function(l,n){return l=T.unpack(l),"rgba("+Math.round(l[0]*255)+","+Math.round(l[1]*255)+","+Math.round(l[2]*255)+","+n+")"},htmlRgb:function(l,n){return"rgb("+Math.round(l[0]*255)+","+Math.round(l[1]*255)+","+Math.round(l[2]*255)+")"},pad:function(l){return l.length==1&&(l="0"+l),l},rgbToHex:function(l){let n=Math.round(l[0]*255).toString(16),t=Math.round(l[1]*255).toString(16),e=Math.round(l[2]*255).toString(16);return"#"+T.pad(n)+T.pad(t)+T.pad(e)},hueToRgb:function(l,n,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?l+(n-l)*6*t:t<1/2?n:t<2/3?l+(n-l)*6*(2/3-t):l},rgbToHsl:function(l){let n=l[0],t=l[1],e=l[2],i=Math.min(n,t,e),s=Math.max(n,t,e),r=s-i,o=0,h=0,u=(i+s)/2;return u>0&&u<1&&(h=r/(u<.5?2*u:2-2*u)),r>0&&(s==n&&s!=t&&(o+=(t-e)/r),s==t&&s!=e&&(o+=2+(e-n)/r),s==e&&s!=n&&(o+=4+(n-t)/r),o/=6),[o,h,u]},hslToRgb:function(l){let n,t,e=l[0],i=l[1],s=l[2];return i===0?[s,s,s]:(t=s<=.5?s*(i+1):s+i-s*i,n=s*2-t,[T.hueToRgb(n,t,e+.33333),T.hueToRgb(n,t,e),T.hueToRgb(n,t,e-.33333)])},makeGradiant:function(l,n,t,e){T.dom(l,null,n,t,0);let i=t.childNodes[0].childNodes.length-1,s;for(let r=0;r<e.length;r++)s=e[r],T.dom("stop",null,{offset:s[0]+"%","stop-color":s[1],"stop-opacity":s[2]},t,[0,i])},makePad:function(l){let n=256,t=T.dom("svg",T.css.basic+"position:relative;",{viewBox:"0 0 "+n+" "+n,width:n,height:n,preserveAspectRatio:"none"}),e=200,i=(n-e)*.5,s=20;Tools.dom("rect","",{x:i,y:i,width:e,height:e,fill:T.colors.back},t),Tools.dom("rect","",{x:i+s*.5,y:i+s*.5,width:e-s,height:e-s,fill:T.colors.button},t),Tools.dom("line","",{x1:i+s*.5,y1:n*.5,x2:i+(e-s*.5),y2:n*.5,stroke:T.colors.back,"stroke-width":2},t),Tools.dom("line","",{x1:n*.5,x2:n*.5,y1:i+s*.5,y2:i+(e-s*.5),stroke:T.colors.back,"stroke-width":2},t),Tools.dom("circle","",{cx:n*.5,cy:n*.5,r:5,stroke:T.colors.text,"stroke-width":5,fill:"none"},t),T.pad2d=t},makeKnob:function(l){let n=128,t=34,e=T.dom("svg",T.css.basic+"position:relative;",{viewBox:"0 0 "+n+" "+n,width:n,height:n,preserveAspectRatio:"none"});T.dom("circle","",{cx:64,cy:64,r:t,fill:T.colors.button,stroke:"rgba(0,0,0,0.3)","stroke-width":8},e),T.dom("path","",{d:"",stroke:T.colors.text,"stroke-width":4,fill:"none","stroke-linecap":"round"},e),T.dom("circle","",{cx:64,cy:64,r:t+7,stroke:"rgba(0,0,0,0.1)","stroke-width":7,fill:"none"},e),T.dom("path","",{d:"",stroke:"rgba(255,255,255,0.3)","stroke-width":2,fill:"none","stroke-linecap":"round","stroke-opacity":.5},e),T.knob=e},makeCircular:function(l){let n=128,t=40,e=T.dom("svg",T.css.basic+"position:relative;",{viewBox:"0 0 "+n+" "+n,width:n,height:n,preserveAspectRatio:"none"});T.dom("circle","",{cx:64,cy:64,r:t,stroke:"rgba(0,0,0,0.1)","stroke-width":10,fill:"none"},e),T.dom("path","",{d:"",stroke:T.colors.text,"stroke-width":7,fill:"none","stroke-linecap":"butt"},e),T.circular=e},makeJoystick:function(l){let n=128,t,e=Math.floor((n-30)*.5),i=Math.floor(e*.6),s=T.dom("svg",T.css.basic+"position:relative;",{viewBox:"0 0 "+n+" "+n,width:n,height:n,preserveAspectRatio:"none"});if(T.dom("defs",null,{},s),T.dom("g",null,{},s),l===0){t=[[40,"rgb(0,0,0)",.3],[80,"rgb(0,0,0)",0],[90,"rgb(50,50,50)",.4],[100,"rgb(50,50,50)",0]],T.makeGradiant("radialGradient",{id:"grad",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},s,t),t=[[60,"rgb(0,0,0)",.5],[100,"rgb(0,0,0)",0]],T.makeGradiant("radialGradient",{id:"gradS",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},s,t);let r=["rgb(40,40,40)","rgb(48,48,48)","rgb(30,30,30)"],o=["rgb(1,90,197)","rgb(3,95,207)","rgb(0,65,167)"];t=[[30,r[0],1],[60,r[1],1],[80,r[1],1],[100,r[2],1]],T.makeGradiant("radialGradient",{id:"gradIn",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},s,t),t=[[30,o[0],1],[60,o[1],1],[80,o[1],1],[100,o[2],1]],T.makeGradiant("radialGradient",{id:"gradIn2",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},s,t),T.dom("circle","",{cx:64,cy:64,r:e,fill:"url(#grad)"},s),T.dom("circle","",{cx:69,cy:74,r:i+10,fill:"url(#gradS)"},s),T.dom("circle","",{cx:64,cy:64,r:i,fill:"url(#gradIn)"},s),T.joystick_0=s}else t=[[69,"rgb(0,0,0)",0],[70,"rgb(0,0,0)",.3],[100,"rgb(0,0,0)",0]],T.makeGradiant("radialGradient",{id:"gradX",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%"},s,t),T.dom("circle","",{cx:64,cy:64,r:e,fill:"none",stroke:"rgba(100,100,100,0.25)","stroke-width":"4"},s),T.dom("circle","",{cx:64,cy:64,r:i+14,fill:"url(#gradX)"},s),T.dom("circle","",{cx:64,cy:64,r:i,fill:"none",stroke:"rgb(100,100,100)","stroke-width":"4"},s),T.joystick_1=s},makeColorRing:function(){let l=256,n=T.dom("svg",T.css.basic+"position:relative;",{viewBox:"0 0 "+l+" "+l,width:l,height:l,preserveAspectRatio:"none"});T.dom("defs",null,{},n),T.dom("g",null,{},n);let t=30,e=(l-t)*.5,i=l*.5,s=24,r=8/e/s*Math.PI,o=0,h,u,p,d,f,g,_,v,y,E=[];for(g=0;g<=s;++g){if(p=g/s,d=p*T.TwoPI,h=(o+d)*.5,u=1/Math.cos((d-o)*.5),f=[Math.sin(o),-Math.cos(o),Math.sin(h)*u,-Math.cos(h)*u,Math.sin(d),-Math.cos(d)],E[1]=T.rgbToHex(T.hslToRgb([p,1,.5])),g>0){for(_=6;_--;)f[_]=(f[_]*e+i).toFixed(2);v=" M"+f[0]+" "+f[1]+" Q"+f[2]+" "+f[3]+" "+f[4]+" "+f[5],y=[[0,E[0],1],[100,E[1],1]],T.makeGradiant("linearGradient",{id:"G"+g,x1:f[0],y1:f[1],x2:f[4],y2:f[5],gradientUnits:"userSpaceOnUse"},n,y),T.dom("path","",{d:v,"stroke-width":t,stroke:"url(#G"+g+")","stroke-linecap":"butt"},n,1)}o=d-r,E[0]=E[1]}let m=84.9;y=[[0,"#FFFFFF",1],[50,"#FFFFFF",0],[50,"#000000",0],[100,"#000000",1]],T.makeGradiant("linearGradient",{id:"GL0",x1:0,y1:i-m,x2:0,y2:i+m,gradientUnits:"userSpaceOnUse"},n,y),y=[[0,"#7f7f7f",1],[50,"#7f7f7f",.5],[100,"#7f7f7f",0]],T.makeGradiant("linearGradient",{id:"GL1",x1:i-49.05,y1:0,x2:i+98,y2:0,gradientUnits:"userSpaceOnUse"},n,y),T.dom("g",null,{"transform-origin":"128px 128px",transform:"rotate(0)"},n),T.dom("polygon","",{points:"78.95 43.1 78.95 212.85 226 128",fill:"red"},n,2),T.dom("polygon","",{points:"78.95 43.1 78.95 212.85 226 128",fill:"url(#GL1)","stroke-width":1,stroke:"url(#GL1)"},n,2),T.dom("polygon","",{points:"78.95 43.1 78.95 212.85 226 128",fill:"url(#GL0)","stroke-width":1,stroke:"url(#GL0)"},n,2),T.dom("path","",{d:"M 255.75 136.5 Q 256 132.3 256 128 256 123.7 255.75 119.5 L 241 128 255.75 136.5 Z",fill:"none","stroke-width":2,stroke:"#000"},n,2),T.dom("circle","",{cx:128,cy:128,r:6,"stroke-width":2,stroke:"#000",fill:"none"},n),T.colorRing=n},icon:function(l,n,t){t=t||40;let i=["<svg xmlns='"+T.svgns+"' version='1.1' xmlns:xlink='"+T.htmls+"' style='pointer-events:none;' preserveAspectRatio='xMinYMax meet' x='0px' y='0px' width='"+t+"px' height='"+t+"px' viewBox='"+"0 0 256 256"+"'><g>"];switch(l){case"logo":i[1]="<path id='logoin' fill='"+n+"' stroke='none' d='"+T.logoFill_d+"'/>";break;case"donate":i[1]="<path id='logoin' fill='"+n+"' stroke='none' d='"+T.logo_donate+"'/>";break;case"neo":i[1]="<path id='logoin' fill='"+n+"' stroke='none' d='"+T.logo_neo+"'/>";break;case"phy":i[1]="<path id='logoin' stroke='"+n+"' stroke-width='49' stroke-linejoin='round' stroke-linecap='butt' fill='none' d='"+T.logo_phy+"'/>";break;case"config":i[1]="<path id='logoin' stroke='"+n+"' stroke-width='49' stroke-linejoin='round' stroke-linecap='butt' fill='none' d='"+T.logo_config+"'/>";break;case"github":i[1]="<path id='logoin' fill='"+n+"' stroke='none' d='"+T.logo_github+"'/>";break;case"save":i[1]="<path stroke='"+n+"' stroke-width='4' stroke-linejoin='round' stroke-linecap='round' fill='none' d='M 26.125 17 L 20 22.95 14.05 17 M 20 9.95 L 20 22.95'/><path stroke='"+n,i[1]+="' stroke-width='2.5' stroke-linejoin='round' stroke-linecap='round' fill='none' d='M 32.6 23 L 32.6 25.5 Q 32.6 28.5 29.6 28.5 L 10.6 28.5 Q 7.6 28.5 7.6 25.5 L 7.6 23'/>";break}return i[2]="</g></svg>",i.join(`
`)},logoFill_d:`
    M 171 150.75 L 171 33.25 155.5 33.25 155.5 150.75 Q 155.5 162.2 147.45 170.2 139.45 178.25 128 178.25 116.6 178.25 108.55 170.2 100.5 162.2 100.5 150.75 
    L 100.5 33.25 85 33.25 85 150.75 Q 85 168.65 97.55 181.15 110.15 193.75 128 193.75 145.9 193.75 158.4 181.15 171 168.65 171 150.75 
    M 200 33.25 L 184 33.25 184 150.8 Q 184 174.1 167.6 190.4 151.3 206.8 128 206.8 104.75 206.8 88.3 190.4 72 174.1 72 150.8 L 72 33.25 56 33.25 56 150.75 
    Q 56 180.55 77.05 201.6 98.2 222.75 128 222.75 157.8 222.75 178.9 201.6 200 180.55 200 150.75 L 200 33.25 Z
    `,logo_github:`
    M 180.5 70 Q 186.3 82.4 181.55 96.55 196.5 111.5 189.7 140.65 183.65 168.35 146 172.7 152.5 178.7 152.55 185.9 L 152.55 218.15 Q 152.84 224.56 159.15 223.3 
    159.21 223.3 159.25 223.3 181.14 216.25 198.7 198.7 228 169.4 228 128 228 86.6 198.7 57.3 169.4 28 128 28 86.6 28 57.3 57.3 28 86.6 28 128 28 169.4 57.3 198.7 74.85 
    216.25 96.75 223.3 96.78 223.3 96.8 223.3 103.16 224.54 103.45 218.15 L 103.45 200 Q 82.97 203.1 75.1 196.35 69.85 191.65 68.4 185.45 64.27 177.055 59.4 174.15 49.20 
    166.87 60.8 167.8 69.85 169.61 75.7 180 81.13 188.09 90 188.55 98.18 188.86 103.45 185.9 103.49 178.67 110 172.7 72.33 168.33 66.3 140.65 59.48 111.49 74.45 96.55 69.7 
    82.41 75.5 70 84.87 68.74 103.15 80 115.125 76.635 128 76.85 140.85 76.65 152.85 80 171.1 68.75 180.5 70 Z
    `,logo_neo:`
    M 219 52 L 206 52 206 166 Q 206 183.4 193.75 195.65 181.4 208 164 208 146.6 208 134.35 195.65 122 183.4 122 166 L 122 90 Q 122 77.6 113.15 68.85 104.4 60 92 60 79.55 
    60 70.75 68.85 62 77.6 62 90 L 62 204 75 204 75 90 Q 75 83 79.95 78 84.95 73 92 73 99 73 104 78 109 83 109 90 L 109 166 Q 109 188.8 125.15 204.85 141.2 221 164 221 
    186.75 221 202.95 204.85 219 188.8 219 166 L 219 52 M 194 52 L 181 52 181 166 Q 181 173 176.05 178 171.05 183 164 183 157 183 152 178 147 173 147 166 L 147 90 Q 147 
    67.2 130.85 51.15 114.8 35 92 35 69.25 35 53.05 51.15 37 67.2 37 90 L 37 204 50 204 50 90 Q 50 72.6 62.25 60.35 74.6 48 92 48 109.4 48 121.65 60.35 134 72.6 134 90 L 
    134 166 Q 134 178.4 142.85 187.15 151.6 196 164 196 176.45 196 185.25 187.15 194 178.4 194 166 L 194 52 Z
    `,logo_phy:`
    M 103.55 37.95 L 127.95 37.95 Q 162.35 37.95 186.5 55 210.9 72.35 210.9 96.5 210.9 120.65 186.5 137.7 162.35 155 127.95 155 L 127.95 237.95 M 127.95 155 
    Q 93.55 155 69.15 137.7 45 120.65 45 96.5 45 72.35 69.15 55 70.9 53.8 72.85 52.85 M 127.95 155 L 127.95 37.95
    `,logo_config:`
    M 204.35 51.65 L 173.25 82.75 Q 192 101.5 192 128 L 236 128 M 192 128 Q 192 154.55 173.25 173.25 L 204.4 204.4 M 51.65 51.65 L 82.75 82.75 Q 101.5 64 128 64 
    L 128 20 M 51.6 204.4 L 82.75 173.25 Q 64 154.55 64 128 L 20 128 M 128 236 L 128 192 Q 101.5 192 82.75 173.25 M 64 128 Q 64 101.5 82.75 82.75 M 173.25 173.25 
    Q 154.55 192 128 192 M 128 64 Q 154.55 64 173.25 82.75
    `,logo_donate:`
    M 171.3 80.3 Q 179.5 62.15 171.3 45.8 164.1 32.5 141.35 30.1 L 94.35 30.1 Q 89.35 30.4 88.3 35.15 L 70.5 148.05 Q 70.2 152.5 73.7 152.6 L 100.95 152.6 107 111.6 Q 108.75 
    106.55 112.6 106.45 130.45 108.05 145.3 103.9 163.35 98.75 171.3 80.3 M 179.8 71.5 Q 178.6 79.75 174.9 87.85 168.45 102.9 151.9 109.15 140.65 113.95 117.55 113 113.15 
    112.75 111 117.45 L 102.7 169.95 Q 102.45 173.8 105.5 173.85 L 128.95 173.85 Q 132.2 174.2 133.35 169.65 L 138.3 139.95 Q 139.75 135.6 143.1 135.5 146.6 135.75 150.6 135.65 
    154.55 135.5 157.35 135.1 160.15 134.7 166.75 132.35 181.35 127.4 187.9 111.2 194.25 95.75 189.5 81.95 186.75 74.85 179.8 71.5 M 103.5 209.9 Q 103.5 202.85 99.7 198.85 95.95 
    194.75 89.4 194.75 82.8 194.75 79.05 198.85 75.3 202.9 75.3 209.9 75.3 216.85 79.05 220.95 82.8 225.05 89.4 225.05 95.95 225.05 99.7 221 103.5 216.95 103.5 209.9 M 95.45 205.5 
    Q 95.95 207.3 95.95 209.9 95.95 212.65 95.45 214.35 94.95 216 94 217.3 93.1 218.45 91.9 219 90.7 219.55 89.4 219.55 88.15 219.55 86.95 219.05 85.75 218.55 84.8 217.3 83.9 216.15 
    83.4 214.35 82.85 212.6 82.85 209.9 82.85 207.3 83.4 205.45 83.95 203.55 84.85 202.45 85.9 201.2 86.95 200.75 88.05 200.25 89.4 200.25 90.7 200.25 91.85 200.8 93.05 201.3 94 202.5 
    94.9 203.65 95.45 205.5 M 153.3 195.35 L 145.3 195.35 135.5 224.45 142.8 224.45 144.6 218.5 153.75 218.5 155.6 224.45 163.1 224.45 153.3 195.35 M 152.15 213.25 L 146.25 213.25 
    149.2 203.65 152.15 213.25 M 116.75 195.35 L 107.8 195.35 107.8 224.45 114.5 224.45 114.5 204.2 125.7 224.45 132.75 224.45 132.75 195.35 126.05 195.35 126.05 212.05 116.75 195.35 M 
    66.5 197.65 Q 64.15 196.15 61.45 195.75 58.8 195.35 55.75 195.35 L 46.7 195.35 46.7 224.45 55.8 224.45 Q 58.8 224.45 61.5 224.05 64.15 223.6 66.4 222.15 69.15 220.45 70.9 217.2 
    72.7 214 72.7 209.95 72.7 205.7 71 202.6 69.35 199.5 66.5 197.65 M 64.2 205 Q 65.2 207 65.2 209.9 65.2 212.75 64.25 214.75 63.3 216.75 61.5 217.85 60 218.85 58.3 218.9 56.6 219 
    54.15 219 L 54 219 54 200.8 54.15 200.8 Q 56.4 200.8 58.05 200.9 59.7 200.95 61.15 201.75 63.2 202.95 64.2 205 M 210.2 195.35 L 190.5 195.35 190.5 224.45 210.2 224.45 210.2 218.9 
    197.75 218.9 197.75 211.55 209.2 211.55 209.2 206 197.75 206 197.75 200.9 210.2 200.9 210.2 195.35 M 187.5 195.35 L 163 195.35 163 200.9 171.6 200.9 171.6 224.45 178.9 224.45 178.9 
    200.9 187.5 200.9 187.5 195.35 Z
    `};T.setText();const Tools=T;class Files{static autoTypes(n){let t=[];switch(n){case"svg":t=[{accept:{"image/svg+xml":".svg"}}];break;case"wav":t=[{accept:{"audio/wav":".wav"}}];break;case"mp3":t=[{accept:{"audio/mpeg":".mp3"}}];break;case"mp4":t=[{accept:{"video/mp4":".mp4"}}];break;case"bin":case"hex":t=[{description:"Binary Files",accept:{"application/octet-stream":[".bin",".hex"]}}];break;case"text":t=[{description:"Text Files",accept:{"text/plain":[".txt",".text"],"text/html":[".html",".htm"]}}];break;case"json":t=[{description:"JSON Files",accept:{"application/json":[".json"]}}];break;case"js":t=[{description:"JavaScript Files",accept:{"text/javascript":[".js"]}}];break;case"ktx2":t=[{description:"ktx2",accept:{"image/ktx2":[".ktx2"]}}];break;case"image":t=[{description:"Images",accept:{"image/*":[".png",".gif",".jpeg",".jpg",".hdr",".exr"]}}];break;case"gif":t=[{description:"Images",accept:{"image/*":[".gif"]}}];break;case"png":t=[{description:"Images",accept:{"image/*":[".png"]}}];break;case"exr":t=[{description:"Images",accept:{"image/exr":[".exr"]}}];break;case"hdr":t=[{description:"Images",accept:{"image/hdr":[".hdr"]}}];break;case"jpg":t=[{description:"Images",accept:{"image/*":[".jpg",".jpeg"]}}];break;case"icon":t=[{description:"Icons",accept:{"image/x-ico":[".ico"]}}];break;case"lut":t=[{description:"Lut",accept:{"text/plain":[".cube",".3dl"]}}];break}return t}static async load(n={}){typeof window.showOpenFilePicker!="function"&&(window.showOpenFilePicker=Files.showOpenFilePickerPolyfill);try{let t=n.type||"";const e={excludeAcceptAllOption:!!t,multiple:!1};e.types=Files.autoTypes(t);const s=await(await window.showOpenFilePicker(e))[0].getFile();if(!s)return null;let r=s.name,o=r.substring(r.lastIndexOf(".")+1,r.length),h="";const u=["png","jpg","jpeg","mp4","webm","ogg","mp3"],p=["sea","z","hex","bvh","BVH","glb","gltf","exr","ktx2","hdr"],d=new FileReader;n.forceType==="ArrayBuffer"?(d.readAsArrayBuffer(s),t=""):u.indexOf(o)!==-1?d.readAsDataURL(s):p.indexOf(o)!==-1?d.readAsArrayBuffer(s):d.readAsText(s),d.onload=function(f){let g=f.target.result;switch(t){case"image":let _=new Image;_.onload=function(){_.width=_.width,_.height=_.height,n.callback&&n.callback(_,r,o,[_.width,_.height])},_.src=g;break;case"json":n.callback&&n.callback(JSON.parse(g),r,o);break;default:n.callback&&n.callback(g,r,o);break}}}catch(t){console.log(t),n.always&&n.callback&&n.callback(null)}}static showOpenFilePickerPolyfill(n){return new Promise(t=>{const e=document.createElement("input");e.type="file",e.multiple=n.multiple,e.accept=n.types.map(i=>i.accept).flatMap(i=>Object.keys(i).flatMap(s=>i[s])).join(","),e.addEventListener("change",()=>{t([...e.files].map(i=>({getFile:async()=>new Promise(s=>{s(i)})})))}),e.click()})}static async save(n={}){let t=!1;typeof window.showSaveFilePicker!="function"&&(window.showSaveFilePicker=Files.showSaveFilePickerPolyfill,t=!0);try{let e=n.type||"";const i={suggestedName:n.name||"hello",data:n.data||""};i.types=Files.autoTypes(e),i.finalType=Object.keys(i.types[0].accept)[0],i.suggestedName+=i.types[0].accept[i.finalType][0];const s=await window.showSaveFilePicker(i);if(t)return;const r=await s.createWritable();let o=new Blob([i.data],{type:i.finalType});await r.write(o),await r.close()}catch(e){console.log(e)}}static showSaveFilePickerPolyfill(n){return new Promise(t=>{const e=document.createElement("a");e.download=n.suggestedName||"my-file.txt";let i=new Blob([n.data],{type:n.finalType});e.href=URL.createObjectURL(i),e.addEventListener("click",()=>{t(setTimeout(()=>URL.revokeObjectURL(e.href),1e3))}),e.click()})}static async getFolder(){try{const n=await window.showDirectoryPicker(),t=[];for await(const e of n.values()){const i=await e.getFile();t.push(i)}return console.log(t),t}catch(n){console.log(n)}}}class V2{constructor(n=0,t=0){this.x=n,this.y=t}set(n,t){return this.x=n,this.y=t,this}divide(n){return this.x/=n.x,this.y/=n.y,this}multiply(n){return this.x*=n.x,this.y*=n.y,this}multiplyScalar(n){return this.x*=n,this.y*=n,this}divideScalar(n){return this.multiplyScalar(1/n)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}angle(){var n=Math.atan2(this.y,this.x);return n<0&&(n+=2*Math.PI),n}addScalar(n){return this.x+=n,this.y+=n,this}negate(){return this.x*=-1,this.y*=-1,this}neg(){return this.x=-1,this.y=-1,this}isZero(){return this.x===0&&this.y===0}copy(n){return this.x=n.x,this.y=n.y,this}equals(n){return n.x===this.x&&n.y===this.y}nearEquals(n,t){return n.x.toFixed(t)===this.x.toFixed(t)&&n.y.toFixed(t)===this.y.toFixed(t)}lerp(n,t){return n===null?(this.x-=this.x*t,this.y-=this.y*t):(this.x+=(n.x-this.x)*t,this.y+=(n.y-this.y)*t),this}}class Proto{constructor(n={}){this.lock=n.lock||!1,this.neverlock=!1,this.isSpace=n.isSpace||!1,this.main=n.main||null,this.isUI=n.isUI||!1,this.group=n.group||null,this.isListen=!1,this.top=0,this.ytop=0,this.dx=n.dx||0,this.isSelectable=n.selectable!==void 0?n.selectable:!1,this.unselectable=n.unselect!==void 0?n.unselect:this.isSelectable,this.ontop=n.ontop?n.ontop:!1,this.css=this.main?this.main.css:Tools.css,this.colors=Tools.defineColor(n,this.main?this.group?this.group.colors:this.main.colors:Tools.colors),this.overEffect=this.colors.showOver,this.svgs=Tools.svgs,this.zone={x:0,y:0,w:0,h:0,d:0},this.local=new V2().neg(),this.isCanvasOnly=!1,this.isSelect=!1,this.p=n.p!==void 0?n.p:Tools.size.p,this.w=this.isUI?this.main.size.w:Tools.size.w,n.w!==void 0&&(this.w=n.w),this.h=this.isUI?this.main.size.h:Tools.size.h,n.h!==void 0&&(this.h=n.h),this.isSpace?this.lock=!0:this.h=this.h<11?11:this.h,this.fw=n.fw||0,this.autoWidth=n.auto||!0,this.isOpen=!1,this.radius=n.radius||this.colors.radius,this.transition=n.transition||Tools.transition,this.isNumber=!1,this.noNeg=n.noNeg||!1,this.allEqual=n.allEqual||!1,this.mono=!1,this.isEdit=!1,this.simple=n.simple||!1,this.simple&&(this.sa=0),this.setSize(this.w),n.sa!==void 0&&(this.sa=n.sa),n.sb!==void 0&&(this.sb=n.sb),this.simple&&(this.sb=this.w-this.sa),this.sc=n.sc===void 0?47:n.sc,this.objectLink=null,this.isSend=!1,this.objectKey=null,this.txt=n.name||"",this.name=n.rename||this.txt,this.target=n.target||null,this.callback=n.callback===void 0?null:n.callback,this.endCallback=null,this.openCallback=n.openCallback===void 0?null:n.openCallback,this.closeCallback=n.closeCallback===void 0?null:n.closeCallback,this.callback===null&&this.isUI&&this.main.callback!==null&&(this.callback=this.group?this.group.callback:this.main.callback),this.c=[],this.s=[],this.useFlex=this.isUI?this.main.useFlex:!1;let t=this.useFlex?"display:flex; justify-content:center; align-items:center; text-align:center; flex: 1 100%;":"float:left;";this.c[0]=Tools.dom("div",this.css.basic+t+"position:relative; height:20px;"),this.s[0]=this.c[0].style,this.margin=this.colors.sy,this.mtop=0;let e=Tools.isDivid(this.margin);if(this.isUI&&this.margin&&(this.s[0].boxSizing="content-box",e?(this.mtop=this.margin*.5,this.s[0].borderTop=this.mtop+"px solid transparent",this.s[0].borderBottom=this.mtop+"px solid transparent"):this.s[0].borderBottom=NaN),this.simple||(this.c[1]=Tools.dom("div",this.css.txt+this.css.middle),this.s[1]=this.c[1].style,this.c[1].textContent=this.name,this.s[1].color=this.lock?this.colors.titleoff:this.colors.title),n.pos){this.s[0].position="absolute";for(let i in n.pos)this.s[0][i]=n.pos[i];this.mono=!0}n.css&&(this.s[0].cssText=n.css)}init(){this.ytop=this.top+this.mtop,this.zone.h=this.h+this.margin,this.zone.w=this.w;let n=this.s,t=this.c;n[0].height=this.h+"px",this.isUI&&(n[0].background=this.colors.background),!this.autoWidth&&this.useFlex?(n[0].flex="1 0 auto",n[0].minWidth=this.minw+"px",n[0].textAlign="center"):this.isUI&&(n[0].width="100%"),t[1]!==void 0&&this.autoWidth&&(n[1]=t[1].style,n[1].top="1px",n[1].height=this.h-2+"px");let e=Tools.frag;for(let s=1,r=t.length;s!==r;s++)t[s]!==void 0&&(e.appendChild(t[s]),n[s]=t[s].style);let i=this.target!==null?this.target:this.isUI?this.main.inner:document.body;this.ontop?i.insertAdjacentElement("afterbegin",t[0]):i.appendChild(t[0]),t[0].appendChild(e),this.rSize(),this.isUI||(this.c[0].style.pointerEvents="auto",Roots.add(this))}addTransition(){this.baseH&&this.transition&&this.isUI&&(this.c[0].style.transition="height "+this.transition+"s ease-out")}dom(n,t,e,i,s){return Tools.dom(n,t,e,i,s)}setSvg(n,t,e,i,s){Tools.setSvg(n,t,e,i,s)}setCss(n,t){Tools.setCss(n,t)}clamp(n,t,e){return Tools.clamp(n,t,e)}getColorRing(){return Tools.colorRing||Tools.makeColorRing(),Tools.clone(Tools.colorRing)}getJoystick(n){return Tools["joystick_"+n]||Tools.makeJoystick(n),Tools.clone(Tools["joystick_"+n])}getCircular(n){return Tools.circular||Tools.makeCircular(n),Tools.clone(Tools.circular)}getKnob(n){return Tools.knob||Tools.makeKnob(n),Tools.clone(Tools.knob)}getPad2d(n){return Tools.pad2d||Tools.makePad(n),Tools.clone(Tools.pad2d)}cursor(n){Roots.cursor(n)}update(){}reset(){}appendChild(n){this.c[0].appendChild(n)}content(){return this.c[0]}getDom(){return this.c[0]}uiout(){this.lock||this.overEffect&&(this.isGroup||this.isTitle||this.s&&(this.s[0].background=this.colors.background))}uiover(){this.lock||this.overEffect&&(this.isGroup||this.isTitle||this.s&&(this.s[0].background=this.colors.backgroundOver))}rename(n){this.c[1]!==void 0&&(this.c[1].textContent=n)}listen(){return this.isListen=Roots.addListen(this),this}listening(){this.objectLink!==null&&(this.isSend||this.isEdit||this.setValue(this.objectLink[this.objectKey]))}setValue(n){this.isNumber?this.value=this.numValue(n):this.value=n,this.update()}onChange(n){if(!this.isSpace)return this.callback=n||null,this}onFinishChange(n){if(!this.isSpace)return this.callback=null,this.endCallback=n,this}onOpen(n){return this.openCallback=n,this}onClose(n){return this.closeCallback=n,this}send(n){n=n||this.value,n instanceof Array&&n.length===1&&(n=n[0]),this.isSend=!0,this.objectLink!==null&&(this.objectLink[this.objectKey]&&this.objectLink[this.objectKey].isColor?this.objectLink[this.objectKey].setHex(n):this.objectLink[this.objectKey]=n),this.callback&&this.callback(n,this.objectKey),this.isSend=!1}sendEnd(n){n=n||this.value,n instanceof Array&&n.length===1&&(n=n[0]),this.endCallback&&this.endCallback(n),this.objectLink!==null&&(this.objectLink[this.objectKey]=n)}dispose(){this.isListen&&Roots.removeListen(this),Tools.clear(this.c[0]),this.target!==null?this.group!==null?this.group.clearOne(this):this.target.removeChild(this.c[0]):this.isUI?this.main.clearOne(this):document.body.removeChild(this.c[0]),this.isUI||Roots.remove(this),this.c=null,this.s=null,this.callback=null,this.target=null,this.isListen=!1}clear(){}getWidth(){let n=Roots.getWidth(this);n&&(this.w=n)}setSize(n){if(this.autoWidth)if(this.w=n,this.simple)this.sb=this.w-this.sa;else{let t=this.w*(this.p/100);this.sa=Math.floor(t+8),this.sb=Math.floor(this.w-t-16)}}rSize(){this.autoWidth&&(this.isUI||(this.s[0].width=this.w+"px"),this.simple||(this.s[1].width=this.sa+"px"))}setTypeNumber(n){this.isNumber=!0,this.value=0,n.value!==void 0&&(typeof n.value=="string"?this.value=n.value*1:this.value=n.value),this.min=n.min===void 0?-1/0:n.min,this.max=n.max===void 0?1/0:n.max,this.precision=n.precision===void 0?2:n.precision;let t;switch(this.precision){case 0:t=1;break;case 1:t=.1;break;case 2:t=.01;break;case 3:t=.001;break;case 4:t=1e-4;break;case 5:t=1e-5;break;case 6:t=1e-6;break}this.step=n.step===void 0?t:n.step,this.range=this.max-this.min,this.value=this.numValue(this.value)}numValue(n){return this.noNeg&&(n=Math.abs(n)),Math.min(this.max,Math.max(this.min,n)).toFixed(this.precision)*1}handleEvent(n){if(!this.lock)return this.neverlock&&(Roots.lock=!1),this[n.type]?this[n.type](n):console.error(n.type,"this type of event no existe !")}wheel(n){return!1}mousedown(n){return!1}mousemove(n){return!1}mouseup(n){return!1}keydown(n){return!1}keyup(n){return!1}setReferency(n,t){this.objectLink=n,this.objectKey=t}display(n=!1){this.s[0].visibility=n?"visible":"hidden"}open(){this.isOpen||(this.isOpen=!0,Roots.needResize=!0,this.openCallback&&this.openCallback())}close(){this.isOpen&&(this.isOpen=!1,Roots.needResize=!0,this.closeCallback&&this.closeCallback())}needZone(){Roots.needReZone=!0}rezone(){Roots.needReZone=!0}select(){}unselect(){}setInput(n){Roots.setInput(n,this)}upInput(n,t){return Roots.upInput(n,t)}selected(n){this.isSelect=n||!1}}class Bool extends Proto{constructor(n={}){super(n),this.value=n.value||!1,this.model=n.mode!==void 0?n.mode:0,this.onName=n.rename||this.txt,n.onName&&(n.onname=n.onName),n.onname&&(this.onName=n.onname),this.inh=n.inh||Math.floor(this.h*.8),this.inw=n.inw||36;let t=this.colors;if(this.model===0){let e=Math.floor(this.h*.5)-(this.inh-2)*.5;this.c[2]=this.dom("div",this.css.basic+"background:"+t.inputBg+"; height:"+(this.inh-2)+"px; width:"+this.inw+"px; top:"+e+"px; border-radius:10px; border:2px solid "+t.back),this.c[3]=this.dom("div",this.css.basic+"height:"+(this.inh-6)+"px; width:16px; top:"+(e+2)+"px; border-radius:10px; background:"+t.button+";")}else this.p=0,this.c[1]!==void 0&&(this.c[1].textContent=""),this.c[2]=this.dom("div",this.css.txt+this.css.button+"top:1px; background:"+t.button+"; height:"+(this.h-2)+"px; border:"+t.borderSize+"px solid "+t.border+"; border-radius:"+this.radius+"px;");this.stat=-1,this.init(),this.update()}mousedown(n){return this.value=!this.value,this.update(!0),this.mousemove(n)}mousemove(n){return this.cursor("pointer"),this.mode(!0)}reset(){return this.cursor(),this.mode()}mode(n){let t=!1,e=this.colors,i=this.s,s,r=this.value;if(n?s=r?4:3:s=r?2:1,this.stat!==s){if(this.stat=s,this.model!==0){switch(s){case 1:i[2].color=e.text,i[2].background=e.button;break;case 2:i[2].color=e.textSelect,i[2].background=e.select;break;case 3:i[2].color=e.textOver,i[2].background=e.overoff;break;case 4:i[2].color=e.textOver,i[2].background=e.over;break}this.c[2].innerHTML=r?this.onName:this.name}else{switch(s){case 1:i[2].background=i[2].borderColor=e.backoff,i[3].background=e.button;break;case 2:i[2].background=i[2].borderColor=e.back,i[3].background=e.textOver;break;case 3:i[2].background=i[2].borderColor=e.back,i[3].background=e.overoff;break;case 4:i[2].background=i[2].borderColor=e.backoff,i[3].background=e.textSelect;break}i[3].marginLeft=r?"17px":"2px",this.c[1].textContent=r?this.onName:this.name}t=!0}return t}update(n){this.mode(),n&&this.send()}rSize(){super.rSize();let n=this.s,t=this.w-10-this.inw;this.model===0?(n[2].left=t+"px",n[3].left=t+"px"):(n[2].left=this.sa+"px",n[2].width=this.sb+"px")}}class Button extends Proto{constructor(n={}){super(n),this.value="",n.value!==void 0&&(this.value=n.value),this.values=n.value||this.txt,n.values&&(this.values=n.values),!n.values&&!n.value&&(this.txt=""),this.onName=n.onName||null,this.on=!1,this.bw=n.forceWidth||0,n.bw&&(this.bw=n.bw),this.space=n.space||3,typeof this.values=="string"&&(this.values=[this.values]),this.isDown=!1,this.neverlock=!0,this.res=0,this.lng=this.values.length,this.tmp=[],this.stat=[];let t,e=this.colors;for(let i=0;i<this.lng;i++)t=!1,this.values[i]===this.value&&this.isSelectable&&(t=!0),this.c[i+2]=this.dom("div",this.css.txt+this.css.button+"top:1px; height:"+(this.h-2)+"px; border:"+e.borderSize+"px solid "+e.border+"; border-radius:"+this.radius+"px;"),this.c[i+2].style.background=t?e.select:e.button,this.c[i+2].style.color=t?e.textSelect:e.text,this.c[i+2].innerHTML=this.values[i],this.stat[i]=t?3:1;this.txt===""&&(this.p=0),(!n.value&&!n.values||this.p===0)&&this.c[1]!==void 0&&(this.c[1].textContent=""),this.init()}onOff(){this.on=!this.on,this.label(this.on?this.onName:this.value)}testZone(n){let t=this.local;if(t.x===-1&&t.y===-1)return-1;let e=this.lng,i=this.tmp;for(;e--;)if(t.x>i[e][0]&&t.x<i[e][2])return e;return-1}mouseup(n){return this.isDown?(this.isDown=!1,this.res!==-1&&(this.value===this.values[this.res]&&this.unselectable?this.value="":this.value=this.values[this.res],this.onName!==null&&this.onOff(),this.send()),this.mousemove(n)):!1}mousedown(n){return this.isDown?!1:(this.isDown=!0,this.mousemove(n))}mousemove(n){let t=!1;return this.res=this.testZone(n),this.res!==-1?(this.cursor("pointer"),t=this.modes(this.isDown?3:2,this.res)):t=this.reset(),t}modes(n=1,t=-1){let e=this.lng,i,s,r=!1;for(;e--;)s=n,i=this.isSelectable?this.values[e]===this.value:!1,e===t?i&&s===2&&(s=3):(s=1,i&&(s=4)),r=this.mode(s,e);return r}mode(n,t){let e=!1,i=this.colors,s=this.s,r=t+2;if(this.stat[t]!==n){switch(this.stat[t]=n,n){case 1:s[r].color=i.text,s[r].background=i.button;break;case 2:s[r].color=i.textOver,s[r].background=i.overoff;break;case 3:s[r].color=i.textOver,s[r].background=i.over;break;case 4:s[r].color=i.textSelect,s[r].background=i.select;break}e=!0}return e}reset(){return this.res=-1,this.cursor(),this.modes()}label(n,t){t=t||2,this.c[t].textContent=n}switchValues(n,t){this.c[n+2].innerHTML=this.values[n]=t}icon(n,t=0,e=2){return this.s[e].padding=t+"px 0px",this.c[e].innerHTML=n,this}rSize(){super.rSize();let n=this.s,t=this.sb,e=this.sa,i=this.lng,s=this.colors.sx,r=(t-s*(i-1))/i;for(this.bw&&(r=this.bw<r?this.bw:r,e=(this.w-(r*i+s*(i-1)))*.5);i--;)this.tmp[i]=[e+r*i+s*i,r],this.tmp[i][2]=this.tmp[i][0]+this.tmp[i][1],n[i+2].left=this.tmp[i][0]+"px",n[i+2].width=this.tmp[i][1]+"px"}}class Circular extends Proto{constructor(n={}){super(n),this.isCyclic=n.cyclic||!1,this.model=n.stype||0,n.mode!==void 0&&(this.model=n.mode),this.autoWidth=!1,this.minw=this.w,this.diam=n.diam||this.w,this.setTypeNumber(n),this.twoPi=Tools.TwoPI,this.pi90=Tools.pi90,this.offset=new V2,this.h=n.h||this.w+10,this.c[0].style.width=this.w+"px",this.c[0].style.display="block",this.c[1]!==void 0&&(this.c[1].style.width="100%",this.c[1].style.justifyContent="center",this.top=10,this.h+=10),this.percent=0,this.cmode=0;let t=this.colors;this.c[2]=this.dom("div",this.css.txt+"justify-content:center; top:"+(this.h-20)+"px; width:100%; color:"+t.text),this.c[3]=this.getCircular(),this.setSvg(this.c[3],"stroke",t.back,0),this.setSvg(this.c[3],"d",this.makePath(),1),this.setSvg(this.c[3],"stroke",t.text,1),this.setSvg(this.c[3],"viewBox","0 0 "+this.diam+" "+this.diam),this.setCss(this.c[3],{width:this.diam,height:this.diam,left:0,top:this.top}),this.init(),this.update()}mode(n){if(this.cmode===n)return!1;let t=this.colors,e;switch(n){case 0:this.s[2].color=t.text,this.setSvg(this.c[3],"stroke",t.back,0),e=this.model>0?Tools.pack(Tools.lerpColor(Tools.unpack(Tools.ColorLuma(t.text,-.75)),Tools.unpack(t.text),this.percent)):t.text,this.setSvg(this.c[3],"stroke",e,1);break;case 1:this.s[2].color=t.textOver,this.setSvg(this.c[3],"stroke",t.backoff,0),e=this.model>0?Tools.pack(Tools.lerpColor(Tools.unpack(Tools.ColorLuma(t.text,-.75)),Tools.unpack(t.text),this.percent)):t.textOver,this.setSvg(this.c[3],"stroke",e,1);break}return this.cmode=n,!0}reset(){this.isDown=!1}testZone(n){let t=this.local;return t.x===-1&&t.y===-1?"":t.y<=this.c[1].offsetHeight?"title":t.y>this.h-this.c[2].offsetHeight?"text":"circular"}mouseup(n){return this.isDown=!1,this.sendEnd(),this.mode(0)}mousedown(n){return this.isDown=!0,this.old=this.value,this.oldr=null,this.mousemove(n),this.mode(1)}mousemove(n){if(!this.isDown)return;let t=this.offset;if(t.x=this.w*.5-(n.clientX-this.zone.x),t.y=this.diam*.5-(n.clientY-this.zone.y-this.ytop),this.r=t.angle()-this.pi90,this.r=(this.r%this.twoPi+this.twoPi)%this.twoPi,this.oldr!==null){let r=this.r-this.oldr;this.r=Math.abs(r)>Math.PI?this.oldr:this.r,r>6&&(this.r=0),r<-6&&(this.r=this.twoPi)}let e=1/this.twoPi,i=this.r*e,s=this.range*i+this.min-this.old;(s>=this.step||s<=this.step)&&(s=~~(s/this.step),this.value=this.numValue(this.old+s*this.step),this.update(!0),this.old=this.value,this.oldr=this.r)}wheel(n){if(this.testZone(n)==="circular"){let e=this.value-this.step*n.delta;return e>this.max?e=this.isCyclic?this.min:this.max:e<this.min&&(e=this.isCyclic?this.max:this.min),this.setValue(e),this.old=e,this.update(!0),!0}return!1}makePath(){let n=40,t=24,e=this.percent*this.twoPi-.001,i=n+n*Math.sin(e)+t,s=n-n*Math.cos(e)+t,r=e>Math.PI?1:0;return"M "+(n+t)+","+t+" A "+n+","+n+" 0 "+r+" 1 "+i+","+s}update(n){if(this.c[2].textContent=this.value,this.percent=(this.value-this.min)/this.range,this.setSvg(this.c[3],"d",this.makePath(),1),this.model>0){let t=this.colors,e=Tools.pack(Tools.lerpColor(Tools.unpack(Tools.ColorLuma(t.text,-.75)),Tools.unpack(t.text),this.percent));this.setSvg(this.c[3],"stroke",e,1)}n&&this.send()}}let Color$1=class extends Proto{constructor(n={}){super(n),this.ctype=n.ctype||"hex",this.wfixe=256,this.cw=this.sb>256?256:this.sb,n.cw!=null&&(this.cw=n.cw),this.side=n.side||"down",this.up=this.side==="down"?0:1,this.baseH=this.h,this.offset=new V2,this.decal=new V2,this.pp=new V2;let t=this.colors;this.c[2]=this.dom("div",`${this.css.txt} ${this.css.middle} top:1px; height:${this.h-2}px; border-radius:${this.radius}px; text-shadow:none; border:${t.borderSize}px solid ${t.border};`),this.c[0].style.display="block",this.c[3]=this.getColorRing(),this.c[3].style.visibility="hidden",this.hsl=null,this.value="#ffffff",n.value!==void 0&&(n.value.isColor?this.value="#"+n.value.getHexString():n.value instanceof Array?this.value=Tools.rgbToHex(n.value):isNaN(n.value)?this.value=n.value:this.value=Tools.hexToHtml(n.value)),this.bcolor=null,this.isDown=!1,this.fistDown=!1,this.notext=n.notext||!1,this.tr=98,this.tsl=Math.sqrt(3)*this.tr,this.hue=0,this.d=256,this.init(),this.setColor(this.value),n.open!==void 0&&this.open()}testZone(n,t){let e=this.local;if(e.x===-1&&e.y===-1)return"";if(this.up&&this.isOpen)return e.y>this.wfixe?"title":"color";if(e.y<this.baseH+2)return"title";if(this.isOpen)return"color"}mouseup(n){this.isDown=!1,this.d=256}mousedown(n){let t=this.testZone(n.clientX,n.clientY);if(t==="title")return this.isOpen?this.close():this.open(),!0;t==="color"&&(this.isDown=!0,this.fistDown=!0,this.mousemove(n))}mousemove(n){let t=this.testZone(n.clientX,n.clientY),e,i,s,r,o,h,u,p,d,f=Tools;if(t==="title"&&this.cursor("pointer"),t==="color"&&(e=this.offset,e.x=n.clientX-(this.zone.x+this.decal.x+this.mid),e.y=n.clientY-(this.zone.y+this.decal.y+this.mid)-this.ytop,i=e.length()*this.ratio,d=e.angle(),d<0&&(d+=2*f.PI),i<128?this.cursor("crosshair"):this.isDown||this.cursor(),this.isDown&&(this.fistDown&&(this.d=i,this.fistDown=!1),this.d<128)))if(this.d>this.tr)s=(d+f.pi90)/f.TwoPI,this.hue=(s+1)%1,this.setHSL([(s+1)%1,this.hsl[1],this.hsl[2]]);else{u=e.x*this.ratio,p=e.y*this.ratio;let g=this.hue*f.TwoPI+f.PI;g<0&&(g+=2*f.PI),h=Math.atan2(-p,u),h<0&&(h+=2*f.PI);let _=(h+f.pi90+f.TwoPI+g)%f.TwoPI,v=_%(2/3*f.PI)-f.pi60,y=.5*this.tr,E=Math.tan(v)*y,m=Math.sqrt(u*u+p*p),x=Math.sqrt(y*y+E*E);if(m>x){let O=Math.tan(v)*m,S=Math.atan(O/x);S>f.pi60?S=f.pi60:S<-f.pi60&&(S=-f.pi60),h+=S-v,_=(h+f.pi90+f.TwoPI+g)%f.TwoPI,v=_%(2/3*f.PI)-f.pi60,E=Math.tan(v)*y,m=x=Math.sqrt(y*y+E*E)}o=Math.sin(_)*m/this.tsl+.5;let C=1-Math.abs(o-.5)*2;r=(Math.cos(_)*m+this.tr/2)/(1.5*this.tr)/C,r=f.clamp(r,0,1),this.setHSL([this.hsl[0],r,o])}}setHeight(){this.h=this.isOpen?this.wfixe+this.baseH+5:this.baseH,this.s[0].height=this.h+"px",this.zone.h=this.h}parentHeight(n){this.group!==null?this.group.calc(n):this.isUI&&this.main.calc(n)}open(){super.open(),this.setHeight(),this.up&&(this.zone.y-=this.wfixe+5);let n=this.h-this.baseH;this.s[3].visibility="visible",this.parentHeight(n)}close(){super.close(),this.up&&(this.zone.y+=this.wfixe+5);let n=this.h-this.baseH;this.setHeight(),this.s[3].visibility="hidden",this.parentHeight(-n)}update(n){let t=Tools.rgbToHex(Tools.hslToRgb([this.hsl[0],1,.5]));this.moveMarkers(),this.value=this.bcolor,this.setSvg(this.c[3],"fill",t,2,0),this.s[2].background=this.bcolor,this.notext||(this.c[2].textContent=Tools.htmlToHex(this.bcolor)),this.invert=Tools.findDeepInver(this.rgb),this.s[2].color=this.invert?"#fff":"#000",n&&(this.ctype==="array"&&this.send(this.rgb),this.ctype==="rgb"&&this.send(Tools.htmlRgb(this.rgb)),this.ctype==="hex"&&this.send(Tools.htmlToHex(this.value)),this.ctype==="html"&&this.send())}setValue(n){n instanceof Array?this.value=Tools.rgbToHex(n):isNaN(n)?this.value=n:this.value=Tools.hexToHtml(n),this.setColor(this.value),this.update()}setColor(n){let t=Tools.unpack(n);return this.bcolor!==n&&t&&(this.bcolor=n,this.rgb=t,this.hsl=Tools.rgbToHsl(this.rgb),this.hue=this.hsl[0],this.update()),this}setHSL(n){return this.hsl=n,this.rgb=Tools.hslToRgb(n),this.bcolor=Tools.rgbToHex(this.rgb),this.update(!0),this}moveMarkers(){let n=this.pp,t=Tools;this.invert;let e=this.hsl[0]*t.TwoPI,i=2/3*t.PI,s=this.tr,r=this.hsl[0],o=this.hsl[1],h=this.hsl[2],u=(e-t.pi90)*t.todeg;r=-e+t.pi90;let p=Math.cos(r)*s,d=-Math.sin(r)*s,f=Math.cos(r-i)*s,g=-Math.sin(r-i)*s,_=Math.cos(r+i)*s,v=-Math.sin(r+i)*s,y=(f+_)/2,E=(g+v)/2;e=(1-2*Math.abs(h-.5))*o;let m=f+(_-f)*h+(p-y)*e,x=g+(v-g)*h+(d-E)*e;n.set(m,x).addScalar(128),this.setSvg(this.c[3],"transform","rotate("+u+" )",2),this.setSvg(this.c[3],"cx",n.x,3),this.setSvg(this.c[3],"cy",n.y,3),this.setSvg(this.c[3],"stroke",this.invert?"#fff":"#000",2,3),this.setSvg(this.c[3],"stroke",this.invert?"#fff":"#000",3),this.setSvg(this.c[3],"fill",this.bcolor,3)}rSize(){super.rSize();let n=this.s;n[2].width=this.sb+"px",n[2].left=this.sa+"px",this.cw=this.sb>256?256:this.sb,this.rSizeColor(this.cw),this.decal.x=Math.floor((this.w-this.wfixe)*.5)}rSizeColor(n){if(n===this.wfixe)return;this.wfixe=n;let t=this.s;this.decal.y=this.side==="up"?2:this.baseH+2,this.mid=Math.floor(this.wfixe*.5),this.setSvg(this.c[3],"viewBox","0 0 "+this.wfixe+" "+this.wfixe),t[3].width=this.wfixe+"px",t[3].height=this.wfixe+"px",t[3].top=this.decal.y+"px",this.ratio=256/this.wfixe,this.square=1/(60*(this.wfixe/256)),this.setHeight()}};class Fps extends Proto{constructor(n={}){super(n),this.round=Math.round,this.baseH=this.h,this.hplus=n.hplus||50,this.res=n.res||40,this.l=1,this.precision=n.precision||0,this.custom=n.custom||!1,this.names=n.names||["FPS","MS"];let t=n.cc||["220,220,220","255,255,0"];this.adding=n.adding||!1,this.range=n.range||[165,100,100],this.alpha=n.alpha||.25,this.values=[],this.points=[],this.textDisplay=[],this.custom||(this.now=Roots.getTime(),this.startTime=0,this.prevTime=0,this.frames=0,this.ms=0,this.fps=0,this.mem=0,this.mm=0,this.isMem=!!(self.performance&&self.performance.memory),this.isMem&&(this.names.push("MEM"),t.push("0,255,255")),this.txt=n.name||"Fps");let e=Math.floor(this.h*.5)-3;const i=this.colors;this.c[1].textContent=this.txt,this.c[0].style.cursor="pointer",this.c[0].style.pointerEvents="auto";let s="display:none; left:10px; top:"+this.h+"px; height:"+(this.hplus-8)+"px; box-sizing:border-box; background: rgba(0, 0, 0, 0.2); border:1px solid "+i.border+";";this.radius!==0&&(s+="border-radius:"+this.radius+"px;"),this.c[2]=this.dom("path",this.css.basic+s,{}),this.c[2].setAttribute("viewBox","0 0 "+this.res+" 50"),this.c[2].setAttribute("height","100%"),this.c[2].setAttribute("width","100%"),this.c[2].setAttribute("preserveAspectRatio","none"),this.c[3]=this.dom("path",this.css.basic+"position:absolute; width:6px; height:6px; left:0; top:"+e+"px;",{d:this.svgs.g1,fill:i.text,stroke:"none"}),this.c[4]=this.dom("div",this.css.txt+"position:absolute; left:10px; top:"+(this.h+2)+"px; display:none; width:100%; text-align:center;"),n.bottomLine&&(this.c[4]=this.dom("div",this.css.basic+"width:100%; bottom:0px; height:1px; background: rgba(255, 255, 255, 0.2);")),this.isShow=!1;let r=this.s;r[1].lineHeight=this.h-4,r[1].color=i.text,this.radius!==0&&(r[0].borderRadius=this.radius+"px"),this.colors.gborder!=="none"&&(r[0].border="1px solid "+i.gborder);let o=0;for(o=0;o<this.names.length;o++){let h=[],u=this.res+1;for(;u--;)h.push(50);this.range[o]=1/this.range[o]*49,this.points.push(h),this.values.push(0),this.textDisplay.push("<span style='color:rgb("+t[o]+")'> "+this.names[o]+" ")}for(o=this.names.length;o--;)this.dom("path",null,{fill:"rgba("+t[o]+","+this.alpha+")","stroke-width":1,stroke:"rgba("+t[o]+",1)","vector-effect":"non-scaling-stroke"},this.c[2]);this.init()}mousedown(n){this.isShow?this.close():this.open()}tick(n){this.values=n,this.isShow&&(this.drawGraph(),this.upText())}makePath(n){let t="";t+="M -1 50";for(let e=0;e<this.res+1;e++)t+=" L "+e+" "+n[e];return t+=" L "+(this.res+1)+" 50",t}upText(n){let t=n||this.values,e="";for(let i=0,s=this.names.length;i<s;i++)e+=this.textDisplay[i]+t[i].toFixed(this.precision)+"</span>";this.c[4].innerHTML=e}drawGraph(){let n=this.c[2],t=this.names.length,e,i=0,s=0;for(;t--;)this.adding?e=(this.values[s]+i)*this.range[s]:e=this.values[s]*this.range[s],this.points[s].shift(),this.points[s].push(50-e),this.setSvg(n,"d",this.makePath(this.points[s]),t+1),i+=this.values[s],s++}open(){super.open(),this.h=this.hplus+this.baseH,this.setSvg(this.c[3],"d",this.svgs.g2),this.group!==null?this.group.calc(this.hplus):this.isUI&&this.main.calc(this.hplus),this.s[0].height=this.h+"px",this.s[2].display="block",this.s[4].display="block",this.isShow=!0,this.custom||Roots.addListen(this)}close(){super.close(),this.h=this.baseH,this.setSvg(this.c[3],"d",this.svgs.g1),this.group!==null?this.group.calc(-this.hplus):this.isUI&&this.main.calc(-this.hplus),this.s[0].height=this.h+"px",this.s[2].display="none",this.s[4].display="none",this.isShow=!1,this.custom||Roots.removeListen(this),this.c[4].innerHTML=""}begin(){this.startTime=this.now()}end(){let n=this.now();if(this.ms=n-this.startTime,this.frames++,n>this.prevTime+1e3&&(this.fps=this.round(this.frames*1e3/(n-this.prevTime)),this.prevTime=n,this.frames=0,this.isMem)){let t=performance.memory.usedJSHeapSize,e=performance.memory.jsHeapSizeLimit;this.mem=this.round(t*954e-9),this.mm=t/e}return this.values=[this.fps,this.ms,this.mm],this.drawGraph(),this.upText([this.fps,this.ms,this.mem]),n}listening(){this.custom||(this.startTime=this.end())}rSize(){let n=this.s,t=this.w;n[3].left=this.sa+this.sb-6+"px",n[0].width=t+"px",n[1].width=t+"px",n[2].left="10px",n[2].width=t-20+"px",n[4].width=t-20+"px"}}class Graph extends Proto{constructor(n={}){super(n),this.value=n.value!==void 0?n.value:[0,0,0],this.lng=this.value.length,this.precision=n.precision!==void 0?n.precision:2,this.multiplicator=n.multiplicator||1,this.neg=n.neg||!1,this.line=n.line!==void 0?n.line:!0,this.autoWidth=n.autoWidth!==void 0?n.autoWidth:!0,this.isNumber=!1,this.isDown=!1,this.h=n.h||138,this.rh=this.h-10,this.top=0,this.c[0].style.width=this.w+"px",this.c[1]!==void 0&&(this.c[1].style.width=this.w+"px",this.autoWidth||(this.c[1].style.width="100%",this.c[1].style.justifyContent="center"),this.top=10,this.h+=10),this.gh=this.rh-28,this.gw=this.w-28,this.c[2]=this.dom("div",this.css.txt+"display:block; text-align:center; padding:0px 0px; top:"+(this.h-20)+"px; left:14px; width:"+this.gw+"px;  color:"+this.colors.text),this.c[2].innerHTML=this.valueToHtml();let t=this.dom("svg",this.css.basic,{viewBox:"0 0 "+this.w+" "+this.rh,width:this.w,height:this.rh,preserveAspectRatio:"none"});this.setCss(t,{width:this.w,height:this.rh,left:0,top:this.top}),this.dom("path","",{d:"",stroke:this.colors.text,"stroke-width":2,fill:"none","stroke-linecap":"butt"},t),this.dom("rect","",{x:10,y:10,width:this.gw+8,height:this.gh+8,stroke:"rgba(0,0,0,0.3)","stroke-width":1,fill:"none"},t),this.iw=(this.gw-4*(this.lng-1))/this.lng;let e=[];this.cMode=[],this.v=[];for(let i=0;i<this.lng;i++)e[i]=[14+i*this.iw+i*4,this.iw],e[i][2]=e[i][0]+e[i][1],this.cMode[i]=0,this.neg?this.v[i]=(1+this.value[i]/this.multiplicator)*.5:this.v[i]=this.value[i]/this.multiplicator,this.dom("rect","",{x:e[i][0],y:14,width:e[i][1],height:1,fill:this.colors.text,"fill-opacity":.3},t);this.tmp=e,this.c[3]=t,this.init(),this.c[1]!==void 0&&(this.c[1].style.top="0px",this.c[1].style.height="20px",this.s[1].lineHeight="15px"),this.update(!1)}setValue(n){this.value=n,this.lng=this.value.length;for(var t=0;t<this.lng;t++)this.neg?this.v[t]=(1+n[t]/this.multiplicator)*.5:this.v[t]=n[t]/this.multiplicator;this.update()}valueToHtml(){let n=this.lng,t=0,e='<table style="width:100%;"><tr>',s="width:"+100/this.lng+"%;";for(;n--;)t===this.lng-1?e+="<td style="+s+">"+this.value[t]+"</td></tr></table>":e+="<td style="+s+">"+this.value[t]+"</td>",t++;return e}updateSVG(){this.line&&this.setSvg(this.c[3],"d",this.makePath(),0);for(let n=0;n<this.lng;n++)this.setSvg(this.c[3],"height",this.v[n]*this.gh,n+2),this.setSvg(this.c[3],"y",14+(this.gh-this.v[n]*this.gh),n+2),this.neg?this.value[n]=((this.v[n]*2-1)*this.multiplicator).toFixed(this.precision)*1:this.value[n]=(this.v[n]*this.multiplicator).toFixed(this.precision)*1;this.c[2].innerHTML=this.valueToHtml()}testZone(n){let t=this.local;if(t.x===-1&&t.y===-1)return"";let e=this.lng,i=this.tmp;if(t.y>this.top&&t.y<this.h-20){for(;e--;)if(t.x>i[e][0]&&t.x<i[e][2])return e}return""}mode(n,t){if(n===this.cMode[t])return!1;let e;switch(n){case 0:e=.3;break;case 1:e=.6;break;case 2:e=1;break}return this.reset(),this.setSvg(this.c[3],"fill-opacity",e,t+2),this.cMode[t]=n,!0}reset(){let n=!1,t=this.lng;for(;t--;)this.cMode[t]!==0&&(this.cMode[t]=0,this.setSvg(this.c[3],"fill-opacity",.3,t+2),n=!0);return n}mouseup(n){if(this.isDown=!1,this.current!==-1)return this.reset()}mousedown(n){return this.isDown=!0,this.mousemove(n)}mousemove(n){let t=!1,e=this.testZone(n);return e===""?t=this.reset():(t=this.mode(this.isDown?2:1,e),this.isDown&&(this.v[e]=this.clamp(1-(n.clientY-this.zone.y-this.ytop-10)/this.gh,0,1),this.update(!0))),t}update(n){this.updateSVG(),n&&this.send()}makePath(){let n="",t,e,i,s,r,o;for(let h=0;h<this.lng;h++)t=14+(this.gh-this.v[h]*this.gh),e=14+h*this.iw+h*4,s=e+this.iw*.5,i=e+this.iw,h===0?n+="M "+e+" "+t+" T "+s+" "+t:n+=" C "+r+" "+o+","+e+" "+t+","+s+" "+t,h===this.lng-1&&(n+=" T "+i+" "+t),r=i,o=t;return n}rSize(){super.rSize();let n=this.s;this.c[1]!==void 0&&(n[1].width=this.w+"px"),n[3].width=this.w+"px";let t=this.w-28,e=(t-4*(this.lng-1))/this.lng,i=[];n[2].width=t+"px";for(let s=0;s<this.lng;s++)i[s]=[14+s*e+s*4,e],i[s][2]=i[s][0]+i[s][1];this.tmp=i}}class Empty extends Proto{constructor(n={}){n.isSpace=!0,n.margin=0,n.h||(n.h=10),super(n),this.init()}}let Group$2=class extends Proto{constructor(n={}){super(n),this.isGroup=!0,this.ADD=n.add,this.autoHeight=!0,this.uis=[],this.current=-1,this.proto=null,this.isEmpty=!0,this.decal=n.group?8:0,this.baseH=this.h,this.radius=0;let t=Math.floor(this.h*.5)-3;const e=this.colors;this.useFlex=!0;let i=this.useFlex?"display:flex; flex-flow: row wrap;":"";this.c[2]=this.dom("div",this.css.basic+i+"width:100%; left:0;  overflow:hidden; top:"+this.h+"px"),this.c[3]=this.dom("path",this.css.basic+"position:absolute; width:6px; height:6px; left:0; top:"+t+"px;",{d:this.svgs.g1,fill:e.text,stroke:"none"}),this.mtop===0?this.margin:this.mtop,this.s,this.c[1].name="group",this.c[1].style.color=e.text,this.init(),this.setBG(n.bg),n.open&&this.open()}setBG(n){const t=this.colors,e=this.s;n!==void 0&&(t.groups=n),t.groups==="none"&&(t.groups=t.background),e[0].background=n!==void 0?"none":t.content,e[1].background=n!==void 0?t.groups:t.content,t.gborder!=="none"&&(e[1].border=t.borderSize+"px solid "+t.gborder),this.radius!==0&&(e[1].borderRadius=this.radius+"px",e[2].borderRadius=this.radius+"px")}testZone(n){let t=this.local;if(t.x===-1&&t.y===-1)return"";let e="";return t.y<this.baseH+this.margin?e="title":this.isOpen&&(e="content"),e}clearTarget(){return this.current===-1?!1:(this.proto.s&&(this.proto.uiout(),this.proto.reset()),this.proto=null,this.current=-1,this.cursor(),!0)}reset(){this.clearTarget()}handleEvent(n){let t=n.type,e=!1,i=!1,s=this.testZone(n);if(s){switch(s){case"content":Roots.isMobile&&t==="mousedown"&&this.getNext(n,e),this.proto&&(i=this.proto.handleEvent(n)),Roots.lock||this.getNext(n,e);break;case"title":this.cursor("pointer"),t==="mousedown"&&(this.isOpen?this.close():this.open());break}return this.isDown&&(e=!0),i&&(e=!0),e}}getNext(n,t){let e=Roots.findTarget(this.uis,n);e!==this.current&&(this.clearTarget(),this.current=e),e!==-1&&(this.proto=this.uis[this.current],this.proto.uiover())}add(){let n=arguments;typeof n[1]=="object"?(n[1].isUI=this.isUI,n[1].target=this.c[2],n[1].main=this.main,n[1].group=this):typeof arguments[1]=="string"&&(n[2]===void 0?[].push.call(n,{isUI:!0,target:this.c[2],main:this.main}):(n[2].isUI=!0,n[2].target=this.c[2],n[2].main=this.main,n[2].group=this));let t=this.ADD.apply(this,n);return t.isGroup&&(t.dx=8),Roots.forceZone=!0,this.uis.push(t),this.isEmpty=!1,t}remove(n){n.dispose&&n.dispose()}dispose(){this.clear(),this.isUI&&this.main.calc(),super.dispose()}clear(){this.empty()}empty(){this.close();let n=this.uis.length,t;for(;n--;)t=this.uis.pop(),this.c[2].removeChild(t.c[0]),t.clear(!0);this.isEmpty=!0,this.h=this.baseH}clearOne(n){let t=this.uis.indexOf(n);t!==-1&&(this.calc(-(this.uis[t].h+this.margin)),this.c[2].removeChild(this.uis[t].c[0]),this.uis.splice(t,1),this.uis.length===0&&(this.isEmpty=!0,this.close()))}open(){super.open(),this.setSvg(this.c[3],"d",this.svgs.g2),this.rSizeContent();const n=this.s,t=this.colors;n[2].top=this.h+this.mtop+"px",this.radius&&(n[1].borderRadius="0px",n[2].borderRadius="0px",n[1].borderTopLeftRadius=this.radius+"px",n[1].borderTopRightRadius=this.radius+"px",n[2].borderBottomLeftRadius=this.radius+"px",n[2].borderBottomRightRadius=this.radius+"px"),t.gborder!=="none"&&(n[4].borderLeft=t.borderSize+"px solid "+t.gborder,n[4].borderRight=t.borderSize+"px solid "+t.gborder,n[2].border=t.borderSize+"px solid "+t.gborder,n[2].borderTop="none",n[1].borderBottom=t.borderSize+"px solid rgba(0,0,0,0)"),this.parentHeight()}close(){super.close(),this.setSvg(this.c[3],"d",this.svgs.g1),this.h=this.baseH;const n=this.s,t=this.colors;n[0].height=this.h+"px",n[2].top=this.h+this.mtop+"px",t.gborder!=="none"&&(n[4].border="none",n[2].border="none",n[1].border=t.borderSize+"px solid "+t.gborder),this.radius&&(n[1].borderRadius=this.radius+"px"),this.parentHeight()}calcUis(){!this.isOpen||this.isEmpty?this.h=this.baseH:this.h=Roots.calcUis([...this.uis],this.zone,this.zone.y+this.baseH+this.margin,!0)+this.baseH,this.s[0].height=this.h+"px",this.s[2].height=this.h-this.baseH+"px"}parentHeight(n){this.group!==null?this.group.calc(n):this.isUI&&this.main.calc(n)}calc(n){this.isOpen&&(this.isUI?this.main.calc():this.calcUis(),this.s[0].height=this.h+"px",this.s[2].height=this.h+"px")}rSizeContent(){let n=this.uis.length;for(;n--;)this.uis[n].setSize(this.w),this.uis[n].rSize()}rSize(){super.rSize();let n=this.s;this.w=this.w-this.decal,n[3].left=this.sa+this.sb-6+"px",n[1].width=this.w+"px",n[2].width=this.w+"px",n[1].left=this.decal+"px",n[2].left=this.decal+"px",this.isOpen&&this.rSizeContent()}};class Joystick extends Proto{constructor(n={}){super(n),this.autoWidth=!1,this.value=[0,0],this.minw=this.w,this.diam=n.diam||this.w,this.joyType="analogique",this.model=n.mode!==void 0?n.mode:0,this.precision=n.precision||2,this.multiplicator=n.multiplicator||1,this.pos=new V2,this.tmp=new V2,this.interval=null,this.c[0].style.display="block",this.haveText=n.text!==void 0?n.text:!0,this.distance=this.diam*.5*.25,this.h=n.h||this.w+(this.haveText?10:0),this.c[0].style.width=this.w+"px",this.c[1]!==void 0&&(this.c[1].style.width="100%",this.c[1].style.justifyContent="center",this.top=10,this.h+=10);let t=this.colors;this.c[2]=this.dom("div",this.css.txt+"justify-content:center; top:"+(this.h-20)+"px; width:100%; color:"+t.text),this.c[2].textContent=this.haveText?this.value:"",this.c[3]=this.getJoystick(this.model),this.setSvg(this.c[3],"viewBox","0 0 "+this.diam+" "+this.diam),this.setCss(this.c[3],{width:this.diam,height:this.diam,left:0,top:this.top}),this.mode(0),this.ratio=128/this.w,this.init(),this.update(!1)}mode(n){let t=this.colors;switch(n){case 0:this.model===0?(this.setSvg(this.c[3],"fill","url(#gradIn)",4),this.setSvg(this.c[3],"stroke","#000",4)):(this.setSvg(this.c[3],"stroke",t.joyOut,2),this.setSvg(this.c[3],"stroke",t.joyOut,4),this.setSvg(this.c[3],"fill","none",4));break;case 1:this.model===0?(this.setSvg(this.c[3],"fill","url(#gradIn2)",4),this.setSvg(this.c[3],"stroke","rgba(0,0,0,0)",4)):(this.setSvg(this.c[3],"stroke",t.joyOver,2),this.setSvg(this.c[3],"stroke",t.joySelect,4),this.setSvg(this.c[3],"fill",t.joyOver,4));break}}addInterval(){this.interval!==null&&this.stopInterval(),!this.pos.isZero()&&(this.interval=setInterval((function(){this.update()}).bind(this),10))}stopInterval(){this.interval!==null&&(clearInterval(this.interval),this.interval=null)}reset(){this.addInterval(),this.mode(0)}mouseup(n){this.addInterval(),this.isDown=!1}mousedown(n){this.isDown=!0,this.mousemove(n),this.mode(2)}mousemove(n){if(this.mode(1),!this.isDown)return;if(this.tmp.x=this.w*.5-(n.clientX-this.zone.x),this.tmp.y=this.diam*.5-(n.clientY-this.zone.y-this.ytop),this.tmp.length()>this.distance){let e=Math.atan2(this.tmp.x,this.tmp.y);this.tmp.x=Math.sin(e)*this.distance,this.tmp.y=Math.cos(e)*this.distance}this.pos.copy(this.tmp).divideScalar(this.distance).negate(),this.update()}setValue(n){n===void 0&&(n=[0,0]),this.pos.set(n[0]||0,n[1]||0),this.updateSVG()}update(n){n===void 0&&(n=!0),this.interval!==null&&(this.isDown||(this.pos.lerp(null,.3),this.pos.x=Math.abs(this.pos.x)<.01?0:this.pos.x,this.pos.y=Math.abs(this.pos.y)<.01?0:this.pos.y,this.isUI&&this.main.isCanvas&&this.main.draw())),this.updateSVG(),n&&this.send(),this.pos.isZero()&&this.stopInterval()}updateSVG(){let n=this.diam*.5- -this.pos.x*this.distance,t=this.diam*.5- -this.pos.y*this.distance;if(this.model===0){let e=n+this.pos.x*5+5,i=t+this.pos.y*5+10;this.setSvg(this.c[3],"cx",e*this.ratio,3),this.setSvg(this.c[3],"cy",i*this.ratio,3)}else this.setSvg(this.c[3],"cx",n*this.ratio,3),this.setSvg(this.c[3],"cy",t*this.ratio,3);this.setSvg(this.c[3],"cx",n*this.ratio,4),this.setSvg(this.c[3],"cy",t*this.ratio,4),this.value[0]=(this.pos.x*this.multiplicator).toFixed(this.precision)*1,this.value[1]=(this.pos.y*this.multiplicator).toFixed(this.precision)*1,this.haveText&&(this.c[2].textContent=this.value)}clear(){this.stopInterval(),super.clear()}}class Knob extends Proto{constructor(n={}){super(n),this.isCyclic=n.cyclic||!1,this.model=n.stype||0,n.mode!==void 0&&(this.model=n.mode),this.autoWidth=!1,this.setTypeNumber(n),this.minw=this.w,this.diam=n.diam||this.w,this.mPI=Math.PI*.8,this.toDeg=180/Math.PI,this.cirRange=this.mPI*2,this.offset=new V2,this.h=n.h||this.w+10,this.c[0].style.width=this.w+"px",this.c[0].style.display="block",this.c[1]!==void 0&&(this.c[1].style.width="100%",this.c[1].style.justifyContent="center",this.top=10,this.h+=10),this.percent=0,this.cmode=0;let t=this.colors;this.c[2]=this.dom("div",this.css.txt+"justify-content:center; top:"+(this.h-20)+"px; width:100%; color:"+t.text),this.c[3]=this.getKnob(),this.setSvg(this.c[3],"fill",t.button,0),this.setSvg(this.c[3],"stroke",t.text,1),this.setSvg(this.c[3],"stroke",t.text,3),this.setSvg(this.c[3],"d",this.makeGrad(),3),this.setSvg(this.c[3],"viewBox","0 0 "+this.diam+" "+this.diam),this.setCss(this.c[3],{width:this.diam,height:this.diam,left:0,top:this.top}),this.model>0&&(Tools.dom("path","",{d:"",stroke:t.text,"stroke-width":2,fill:"none","stroke-linecap":"round"},this.c[3]),this.model==2&&(Tools.addSVGGlowEffect(),this.setSvg(this.c[3],"style",'filter: url("#UILGlow");',4))),this.r=0,this.init(),this.update()}mode(n){let t=this.colors;if(this.cmode===n)return!1;switch(n){case 0:this.s[2].color=t.text,this.setSvg(this.c[3],"fill",t.button,0),this.setSvg(this.c[3],"stroke",t.text,1);break;case 1:this.s[2].color=t.textOver,this.setSvg(this.c[3],"fill",t.select,0),this.setSvg(this.c[3],"stroke",t.textOver,1);break}return this.cmode=n,!0}testZone(n){let t=this.local;return t.x===-1&&t.y===-1?"":t.y<=this.c[1].offsetHeight?"title":t.y>this.h-this.c[2].offsetHeight?"text":"knob"}mouseup(n){return this.isDown=!1,this.sendEnd(),this.mode(0)}mousedown(n){return this.isDown=!0,this.old=this.value,this.oldr=null,this.mousemove(n),this.mode(1)}mousemove(n){if(!this.isDown)return;let t=this.offset;t.x=this.w*.5-(n.clientX-this.zone.x),t.y=this.diam*.5-(n.clientY-this.zone.y-this.ytop),this.r=-Math.atan2(t.x,t.y),this.oldr!==null&&(this.r=Math.abs(this.r-this.oldr)>Math.PI?this.oldr:this.r),this.r=this.r>this.mPI?this.mPI:this.r,this.r=this.r<-this.mPI?-this.mPI:this.r;let e=1/this.cirRange,i=(this.r+this.mPI)*e,s=this.range*i+this.min-this.old;(s>=this.step||s<=this.step)&&(s=Math.floor(s/this.step),this.value=this.numValue(this.old+s*this.step),this.update(!0),this.old=this.value,this.oldr=this.r)}wheel(n){if(this.testZone(n)==="knob"){let e=this.value-this.step*n.delta;return e>this.max?e=this.isCyclic?this.min:this.max:e<this.min&&(e=this.isCyclic?this.max:this.min),this.setValue(e),this.old=e,this.update(!0),!0}return!1}makeGrad(){let n="",t,e,i,s,r,o,h,u=64,p=Math.PI+this.mPI,d=Math.PI-this.mPI;this.step>5?(e=this.range/this.step,t=(p-d)/e):(t=(p-d)/u*2,e=u*.5);for(let f=0;f<=e;++f)i=p-t*f,s=u+Math.sin(i)*(u-20),r=u+Math.cos(i)*(u-20),o=u+Math.sin(i)*(u-24),h=u+Math.cos(i)*(u-24),n+="M"+s+" "+r+" L"+o+" "+h+" ";return n}update(n){this.c[2].textContent=this.value,this.percent=(this.value-this.min)/this.range;let t=Math.PI+this.mPI,e=this.percent*this.cirRange-this.mPI,i=Math.sin(e),s=Math.cos(e),r=25*i+64,o=-(25*s)+64,h=20*i+64,u=-(20*s)+64;if(this.setSvg(this.c[3],"d","M "+r+" "+o+" L "+h+" "+u,1),this.model>0){let p=36*Math.sin(t)+64,d=36*Math.cos(t)+64,f=36*i+64,g=-36*s+64,_=e<=Math.PI-this.mPI?0:1;this.setSvg(this.c[3],"d","M "+p+","+d+" A 36,36 1 "+_+" 1 "+f+","+g,4);let v=Tools.pack(Tools.lerpColor(Tools.unpack(Tools.ColorLuma(this.colors.text,-.75)),Tools.unpack(this.colors.text),this.percent));this.setSvg(this.c[3],"stroke",v,4)}n&&this.send()}}class List extends Proto{constructor(n={}){super(n),this.hideCurrent=!1,this.path=n.path||"",this.format=n.format||"",this.isWithImage=this.path!=="",this.preLoadComplete=!1,this.tmpImage={},this.tmpUrl=[],this.m=n.m!==void 0?n.m:5;let t=n.align||"left",e=n.scrollSize||10;this.ss=e+1,this.sMode=0,this.tMode=0,this.listOnly=n.listOnly||!1,this.staticTop=n.staticTop||!1,this.isSelectable=this.listOnly,n.select!==void 0&&(n.selectable=n.select),n.selectable!==void 0&&(this.isSelectable=n.selectable),this.txt===""&&(this.p=0);let i=Math.floor(this.h*.5)-3,s=this.colors;if(this.c[2]=this.dom("div",this.css.basic+"top:0; display:none; border-radius:"+this.radius+"px;"),this.c[3]=this.dom("div",this.css.item+"padding:0px "+this.m+"px; margin-bottom:0px; position:absolute; justify-content:"+t+"; text-align:"+t+"; line-height:"+(this.h-4)+"px; top:1px; background:"+s.button+"; height:"+(this.h-2)+"px; border:1px solid "+s.border+"; border-radius:"+this.radius+"px;"),this.c[4]=this.dom("path",this.css.basic+"position:absolute; width:6px; height:6px; top:"+i+"px;",{d:this.svgs.g1,fill:s.text,stroke:"none"}),this.scrollerBack=this.dom("div",this.css.basic+"right:0px; width:"+e+"px; background:"+s.back+"; display:none;"),this.scroller=this.dom("div",this.css.basic+"right:"+(e-e*.25)*.5+"px; width:"+e*.25+"px; background:"+s.text+"; display:none; "),this.c[3].style.color=s.text,this.list=[],this.refObject=null,n.list){if(n.list instanceof Array)this.list=n.list;else if(n.list instanceof Object){this.refObject=n.list;for(let r in this.refObject)this.list.push(r)}}this.items=[],this.prevName="",this.tmpId=0,this.baseH=this.h,this.itemHeight=n.itemHeight||this.h,this.full=n.full||!1,this.py=0,this.ww=this.sb,this.scroll=!1,this.isDown=!1,this.current=null,this.side=n.side||"down",this.up=this.side==="down"?0:1,this.up?(this.c[2].style.top="auto",this.c[3].style.top="auto",this.c[4].style.top="auto",this.c[2].style.bottom=this.h-2+"px",this.c[3].style.bottom="1px",this.c[4].style.bottom=i+"px"):this.c[2].style.top=this.baseH+"px",this.listIn=this.dom("div",this.css.basic+"left:0; top:0; width:100%; background:none;"),this.listIn.name="list",this.topList=0,this.c[2].appendChild(this.listIn),this.c[2].appendChild(this.scrollerBack),this.c[2].appendChild(this.scroller),n.value!==void 0?isNaN(n.value)?this.value=n.value:this.value=this.list[n.value]:this.value=this.list[0],this.isOpenOnStart=n.open||!1,this.listOnly&&(this.baseH=5,this.c[3].style.display="none",this.c[4].style.display="none",this.c[2].style.top=this.baseH+"px",this.isOpenOnStart=!0),this.miniCanvas=n.miniCanvas||!1,this.canvasBg=n.canvasBg||"rgba(0,0,0,0)",this.imageSize=n.imageSize||[20,20],this.drag=n.drag||!1,this.dragout=n.dragout||!1,this.dragstart=n.dragstart||null,this.dragend=n.dragend||null,this.setList(this.list),this.init(),this.isWithImage&&this.preloadImage(),this.isOpenOnStart&&this.open(!0),this.baseH+=this.mtop}preloadImage(){this.preLoadComplete=!1,this.tmpImage={};for(let n=0;n<this.list.length;n++)this.tmpUrl.push(this.list[n]);this.loadOne()}nextImg(){this.c!==null&&(this.tmpUrl.shift(),this.tmpUrl.length===0?(this.preLoadComplete=!0,this.addImages()):this.loadOne())}loadOne(){let n=this,t=this.tmpUrl[0],e=document.createElement("img");e.style.cssText="position:absolute; width:"+n.imageSize[0]+"px; height:"+n.imageSize[1]+"px",e.setAttribute("src",this.path+t+this.format),e.addEventListener("load",function(){n.imageSize[2]=e.width,n.imageSize[3]=e.height,n.tmpImage[t]=e,n.nextImg()})}testZone(n){let t=this.local;if(t.x===-1&&t.y===-1)return"";if(this.up&&this.isOpen){if(t.y>this.h-this.baseH)return"title";if(this.scroll&&t.x>this.sa+this.sb-this.ss)return"scroll";if(t.x>this.sa)return this.testItems(t.y-this.baseH)}else{if(t.y<this.baseH+2)return"title";if(this.isOpen){if(this.scroll&&t.x>this.sa+this.sb-this.ss)return"scroll";if(t.x>this.sa)return this.testItems(t.y-this.baseH)}}return""}testItems(n){let t="",e=this.items,i=e.length,s,r,o;for(;i--;)if(s=e[i],r=s.posy+this.topList,o=s.posy+this.itemHeight+1+this.topList,n>=r&&n<=o)return t="item"+i,this.modeItem(0),this.current=s,this.modeItem(1),t;return t}modeItem(n){if(!this.current)return;this.current.select&&n===0&&(n=2);let t=this.colors;switch(n){case 0:this.current.style.background=t.back,this.current.style.color=t.text;break;case 1:this.current.style.background=t.over,this.current.style.color=t.textOver;break;case 2:this.current.style.background=t.select,this.current.style.color=t.textSelect;break}}unSelected(){this.current&&(this.modeItem(0),this.current=null)}selected(){this.current&&(this.resetItems(),this.modeItem(2),this.current.select=!0)}resetItems(){let n=this.items.length;for(;n--;)this.items[n].select=!1,this.items[n].style.background=this.colors.back,this.items[n].style.color=this.colors.text}hideActive(){this.hideCurrent&&(this.current&&(this.tmpId=this.current.id),this.resetHide())}resetHide(){console.log(this.tmpId);let n=this.items.length;for(;n--;)n===this.tmpId?(this.items[n].style.height="0px",this.items[n].posy=-1):(this.items[n].style.height=this.itemHeight+"px",this.items[n].posy=(this.itemHeight+1)*(n-1))}mouseup(n){this.isDown=!1}mousedown(n){let t=this.testZone(n);return t?(t==="scroll"?(this.isDown=!0,this.mousemove(n)):t==="title"?(this.modeTitle(2),this.listOnly||(this.hideActive(),this.isOpen?this.close():this.open())):this.current&&(this.value=this.list[this.current.id],this.isSelectable&&this.selected(),this.send(this.value),this.listOnly||(this.close(),this.setTopItem())),!0):!1}mousemove(n){let t=!1,e=this.testZone(n);if(!e)return t;if(e==="title")this.unSelected(),this.modeTitle(1),this.cursor("pointer");else if(e==="scroll"){if(this.cursor("s-resize"),this.modeScroll(1),this.isDown){this.modeScroll(2);let i=this.zone.y+this.baseH-2;this.update(n.clientY-i-this.sh*.5)}}else this.modeTitle(0),this.modeScroll(0),this.cursor("pointer");return e!==this.prevName&&(t=!0),this.prevName=e,t}wheel(n){return this.testZone(n)==="title"?!1:(this.py+=n.delta*10,this.update(this.py),!0)}reset(){this.prevName="",this.unSelected(),this.modeTitle(0),this.modeScroll(0)}modeScroll(n){if(n===this.sMode)return;let t=this.scroller.style,e=this.colors;switch(n){case 0:t.background=e.text;break;case 1:t.background=e.select;break;case 2:t.background=e.select;break}this.sMode=n}modeTitle(n){if(n===this.tMode)return;let t=this.s,e=this.colors;switch(n){case 0:t[3].color=e.text,t[3].background=e.button;break;case 1:t[3].color=e.textOver,t[3].background=e.overoff;break;case 2:t[3].color=e.textSelect,t[3].background=e.overoff;break}this.tMode=n}clearList(){for(;this.listIn.children.length;)this.listIn.removeChild(this.listIn.lastChild);this.items=[]}setList(n){this.clearList(),this.list=n,this.length=this.list.length;let t=this.hideCurrent?this.length-1:this.length;this.maxItem=this.full?t:5,this.maxItem=t<this.maxItem?t:this.maxItem,this.maxHeight=this.maxItem*(this.itemHeight+1)+2,this.max=t*(this.itemHeight+1)+2,this.ratio=this.maxHeight/this.max,this.sh=this.maxHeight*this.ratio,this.range=this.maxHeight-this.sh,this.c[2].style.height=this.maxHeight+"px",this.scrollerBack.style.height=this.maxHeight+"px",this.scroller.style.height=this.sh+"px",this.max>this.maxHeight&&(this.ww=this.sb-this.ss,this.scroll=!0),this.miniCanvas&&(this.tmpCanvas=document.createElement("canvas"),this.tmpCanvas.width=this.imageSize[0],this.tmpCanvas.height=this.imageSize[1],this.tmpCtx=this.tmpCanvas.getContext("2d"),this.tmpCtx.fillStyle=this.canvasBg,this.tmpCtx.fillRect(0,0,this.imageSize[0],this.imageSize[1]));let e,i;for(let s=0;s<this.length;s++){if(i=this.list[s],e=this.dom("div",this.css.item+"padding:0px "+(this.m+1)+"px; width:"+this.ww+"px; height:"+this.itemHeight+"px; line-height:"+(this.itemHeight-2)+"px; color:"+this.colors.text+"; background:"+this.colors.back+";"),e.name="item"+s,e.id=s,e.select=!1,e.posy=(this.itemHeight+1)*s,this.listIn.appendChild(e),this.items.push(e),i===this.value&&(this.current=e),this.isWithImage||(e.textContent=i),this.miniCanvas){let r=new Image;r.src=this.tmpCanvas.toDataURL(),r.style.cssText="margin-right:4px;",e.appendChild(r),this.tmpImage[i]=r}this.dragout&&(e.img=this.tmpImage[i],e.style.pointerEvents="auto",e.draggable="true",e.addEventListener("dragstart",this.dragstart||function(){}),e.addEventListener("drag",this.drag||function(){}),e.addEventListener("dragleave",function(){Roots.fakeUp()}),e.addEventListener("dragend",this.dragend||(function(){}).bind(this)))}this.setTopItem(),this.isSelectable&&this.selected()}drawImage(n,t,e,i,s,r){this.tmpCtx.clearRect(0,0,this.imageSize[0],this.imageSize[1]),this.tmpCtx.drawImage(t,e,i,s,r,0,0,this.imageSize[0],this.imageSize[1]),this.tmpImage[n].src=this.tmpCanvas.toDataURL()}addImages(){let n=this.list.length;for(let t=0;t<n;t++)this.items[t].appendChild(this.tmpImage[this.list[t]]);this.setTopItem()}setValue(n){isNaN(n)?this.value=n:this.value=this.list[n],this.setTopItem()}setTopItem(){if(!this.staticTop){if(this.isWithImage){if(!this.preLoadComplete)return;this.c[3].children.length||(this.canvas=document.createElement("canvas"),this.canvas.width=this.imageSize[0],this.canvas.height=this.imageSize[1],this.canvas.style.cssText="margin-right:4px;",this.ctx=this.canvas.getContext("2d"),this.c[3].style.textAlign="left",this.c[3].style.justifyContent="left",this.c[3].appendChild(this.canvas)),this.tmpImage[this.value],this.ctx.drawImage(this.tmpImage[this.value],0,0,this.imageSize[2],this.imageSize[3],0,0,this.imageSize[0],this.imageSize[1])}else this.c[3].textContent=this.value;this.miniCanvas&&(this.c[3].children.length||(this.canvas=document.createElement("canvas"),this.canvas.width=this.imageSize[0],this.canvas.height=this.imageSize[1],this.canvas.style.cssText="margin-right:4px;",this.ctx=this.canvas.getContext("2d"),this.c[3].style.textAlign="left",this.c[3].style.justifyContent="left",this.c[3].appendChild(this.canvas)),this.ctx.drawImage(this.tmpImage[this.value],0,0))}}update(n){this.scroll&&(n=n<0?0:n,n=n>this.range?this.range:n,this.topList=-Math.floor(n/this.ratio),this.listIn.style.top=this.topList+"px",this.scroller.style.top=Math.floor(n)+"px",this.py=n)}parentHeight(n){this.group!==null?this.group.calc(n):this.isUI&&this.main.calc(n)}open(n){super.open(),this.update(0),this.h=this.maxHeight+this.baseH+5,this.scroll?(this.scroller.style.display="block",this.scrollerBack.style.display="block"):(this.topList=0,this.h=this.baseH+5+this.max,this.scroller.style.display="none",this.scrollerBack.style.display="none"),this.s[0].height=this.h+"px",this.s[2].display="block",this.up?(this.zone.y-=this.h-(this.baseH-10),this.setSvg(this.c[4],"d",this.svgs.g1)):this.setSvg(this.c[4],"d",this.svgs.g2),this.rSizeContent();let t=this.h-this.baseH;this.zone.h=this.h,n||this.parentHeight(t)}close(){super.close(),this.up&&(this.zone.y+=this.h-(this.baseH-10));let n=this.h-this.baseH;this.h=this.baseH,this.s[0].height=this.h+"px",this.s[2].display="none",this.setSvg(this.c[4],"d",this.svgs.g1),this.zone.h=this.h,this.parentHeight(-n)}text(n){this.c[3].textContent=n}rSizeContent(){let n=this.length;for(;n--;)this.listIn.children[n].style.width=this.ww+"px"}rSize(){super.rSize();let n=this.s,t=this.sb,e=this.sa;n[2]!==void 0&&(n[2].width=t+"px",n[2].left=e+"px",n[3].width=t+"px",n[3].left=e+"px",n[4].left=e+t-15+"px",this.ww=t,this.max>this.maxHeight&&(this.ww=t-this.ss),this.isOpen&&this.rSizeContent())}}class Numeric extends Proto{constructor(n={}){super(n),this.setTypeNumber(n),this.allway=n.allway||!1,this.isDown=!1,this.value=[0],this.multy=1,this.invmulty=1,this.isSingle=!0,this.isAngle=!1,this.isVector=!1,n.isAngle&&(this.isAngle=!0,this.multy=Tools.torad,this.invmulty=Tools.todeg),this.isDrag=n.drag||!1,n.value!==void 0&&(isNaN(n.value)?n.value instanceof Array?(this.value=n.value,this.isSingle=!1):n.value instanceof Object&&(this.value=[],n.value.x!==void 0&&(this.value[0]=n.value.x),n.value.y!==void 0&&(this.value[1]=n.value.y),n.value.z!==void 0&&(this.value[2]=n.value.z),n.value.w!==void 0&&(this.value[3]=n.value.w),this.isSingle=!1,this.isVector=!0):this.value=[n.value]),this.lng=this.value.length,this.tmp=[],this.current=-1,this.prev={x:0,y:0,d:0,v:0};let t=this.colors;this.c[2]=this.dom("div",this.css.basic+" background:"+t.select+"; top:4px; width:0px; height:"+(this.h-8)+"px;"),this.cMode=[];let e=this.lng;for(;e--;)this.isAngle&&(this.value[e]=(this.value[e]*180/Math.PI).toFixed(this.precision)),this.c[3+e]=this.dom("div",this.css.txtselect+"top:1px; height:"+(this.h-2)+"px; color:"+t.text+"; background:"+t.back+"; borderColor:"+t.border+"; border-radius:"+this.radius+"px;"),n.center&&(this.c[2+e].style.textAlign="center"),this.c[3+e].textContent=this.value[e],this.c[3+e].style.color=this.colors.text,this.c[3+e].isNum=!0,this.cMode[e]=0;this.selectId=3+this.lng,this.c[this.selectId]=this.dom("div",this.css.txtselect+"position:absolute; top:2px; height:"+(this.h-4)+"px; padding:0px 0px; width:0px; color:"+t.textSelect+"; background:"+t.select+"; border:none; border-radius:0px;"),this.cursorId=4+this.lng,this.c[this.cursorId]=this.dom("div",this.css.basic+"top:2px; height:"+(this.h-4)+"px; width:0px; background:"+t.text+";"),this.init()}testZone(n){let t=this.local;if(t.x===-1&&t.y===-1)return"";let e=this.lng,i=this.tmp;for(;e--;)if(t.x>i[e][0]&&t.x<i[e][2])return e;return""}mousedown(n){let t=this.testZone(n);return this.isDown?!1:(this.isDown=!0,t!==""&&(this.current=t,this.prev={x:n.clientX,y:n.clientY,d:0,v:this.isSingle?parseFloat(this.value):parseFloat(this.value[this.current])},this.setInput(this.c[3+this.current])),this.mousemove(n))}mouseup(n){return this.isDown?(this.isDown=!1,this.prev={x:0,y:0,d:0,v:0},this.mousemove(n)):!1}mousemove(n){let t=!1,e=0;if(this.testZone(n)===""?this.cursor():this.isDrag?this.cursor(this.current!==-1?"move":"pointer"):this.cursor("text"),this.isDrag){if(this.current!==-1){this.prev.d+=n.clientX-this.prev.x-(n.clientY-this.prev.y);let s=this.prev.v+this.prev.d*this.step;this.value[this.current]=this.numValue(s),this.c[3+this.current].textContent=this.value[this.current],this.validate(),this.prev.x=n.clientX,this.prev.y=n.clientY,t=!0}}else return this.isDown&&(e=n.clientX-this.zone.x-3),this.current!==-1&&(e-=this.tmp[this.current][0]),this.upInput(e,this.isDown);return t}reset(){return!1}setValue(n){this.isVector?(n.x!==void 0&&(this.value[0]=n.x),n.y!==void 0&&(this.value[1]=n.y),n.z!==void 0&&(this.value[2]=n.z),n.w!==void 0&&(this.value[3]=n.w)):this.value=this.isSingle?[n]:n,this.update()}sameStr(n){let t=this.value.length;for(;t--;)this.c[3+t].textContent=n}update(n){let t=this.value.length;for(;t--;)this.value[t]=this.numValue(this.value[t]*this.invmulty),this.c[3+t].textContent=this.value[t];n&&this.send()}send(n){n=n||this.value,this.isSend=!0,this.objectLink!==null&&(this.isVector?this.objectLink[this.objectKey].fromArray(n):this.objectLink[this.objectKey]=n),this.callback&&this.callback(n,this.objectKey),this.isSend=!1}select(n,t,e,i){let s=this.s,r=this.current!==-1?this.tmp[this.current][0]+5:0;s[this.cursorId].width="1px",s[this.cursorId].left=r+n+"px",s[this.selectId].left=r+t+"px",s[this.selectId].width=e+"px",this.c[this.selectId].innerHTML=i}unselect(){let n=this.s;n&&(this.c[this.selectId].innerHTML="",n[this.selectId].width="0px",n[this.cursorId].width="0px")}validate(n){let t=[],e=this.lng;for(this.allway&&(n=!0);e--;){if(isNaN(this.c[3+e].textContent))this.c[3+e].textContent=this.value[e];else{let i=this.numValue(this.c[3+e].textContent);this.c[3+e].textContent=i,this.value[e]=i}t[e]=this.value[e]*this.multy}n&&this.send(this.isSingle?t[0]:t)}rSize(){super.rSize();let n=this.colors.sx,t=n*(this.lng-1),e=(this.sb-t)/this.lng,i=this.s,s=this.lng;for(;s--;)this.tmp[s]=[this.sa+e*s+n*s,e],this.tmp[s][2]=this.tmp[s][0]+this.tmp[s][1],i[3+s].left=this.tmp[s][0]+"px",i[3+s].width=this.tmp[s][1]+"px"}}class Slide extends Proto{constructor(n={}){super(n),this.setTypeNumber(n),this.model=n.stype!==void 0?n.stype:2,n.mode!==void 0&&(this.model=n.mode),this.isDown=!1,this.isOver=!1,this.allway=n.allway||!1,this.autoValue=!0,n.autoValue!==void 0&&(this.autoValue=!1),this.isDeg=n.isDeg||!1,this.isCyclic=n.cyclic||!1,this.firstImput=!1;let t=this.colors;if(this.c[2]=this.dom("div",this.css.txtselect+"border:none; background:none; width:47px; color:"+t.text+";"),this.c[3]=this.dom("div",this.css.basic+" top:0; height:"+this.h+"px;"),this.c[4]=this.dom("div",this.css.basic+"background:"+t.back+"; top:2px; height:"+(this.h-4)+"px;"),this.c[5]=this.dom("div",this.css.basic+"left:4px; top:5px; height:"+(this.h-10)+"px; background:"+t.text+";"),this.c[2].isNum=!0,this.c[2].style.height=this.h-2+"px",this.c[2].style.lineHeight=this.h-10+"px",this.model!==0){let e=4,i=4,s=8,r=this.h-6,o=16;this.model===2&&(e=0,i=2,s=4,o=2,r=(this.h-6)*.5),this.model===3&&(this.c[5].style.visible="none"),this.c[4].style.borderRadius=e+"px",this.c[4].style.height=s+"px",this.c[4].style.top=this.h*.5-i+"px",this.c[5].style.borderRadius=e*.5+"px",this.c[5].style.height=i+"px",this.c[5].style.top=this.h*.5-i*.5+"px",this.c[6]=this.dom("div",this.css.basic+"border-radius:"+o+"px; margin-left:"+-r*.5+"px; background:"+t.text+"; left:4px; top:"+(this.h-r)*.5+"px; height:"+r+"px; width:"+r+"px;")}this.init()}testZone(n){let t=this.local;return t.x===-1&&t.y===-1?"":t.x>=this.txl?"text":t.x>=this.sa?"scroll":""}mouseup(n){this.isDown&&(this.isDown=!1)}mousedown(n){let t=this.testZone(n);return t?(t==="scroll"&&(this.isDown=!0,this.old=this.value,this.mousemove(n)),!0):!1}mousemove(n){let t=!1;if(this.testZone(n)==="scroll"?(this.mode(1),this.cursor("w-resize")):this.cursor(),this.isDown){let i=(n.clientX-(this.zone.x+this.sa)-3)/this.ww*this.range+this.min-this.old;(i>=this.step||i<=this.step)&&(i=Math.floor(i/this.step),this.value=this.numValue(this.old+i*this.step),this.update(!0),this.old=this.value),t=!0}return t}wheel(n){if(this.testZone(n)==="scroll"){let e=this.value-this.step*n.delta;return e>this.max?e=this.isCyclic?this.min:this.max:e<this.min&&(e=this.isCyclic?this.max:this.min),this.setValue(e),this.old=e,this.update(!0),!0}return!1}validate(){let n=this.c[2].textContent;isNaN(n)?this.autoValue&&(this.c[2].textContent=this.value+(this.isDeg?"":"")):(this.value=this.numValue(n),this.update(!0))}reset(){this.isDown=!1,this.mode(0)}mode(n){let t=this.s,e=this.colors;switch(n){case 0:t[2].color=e.text,t[4].background=e.back,t[5].background=e.text,this.model!==0&&(t[6].background=e.text);break;case 1:t[2].color=e.textOver,t[4].background=e.back,t[5].background=e.textOver,this.model!==0&&(t[6].background=e.textOver);break}}update(n){let t=Math.floor(this.ww*((this.value-this.min)/this.range));this.model!==3&&(this.s[5].width=t+"px"),this.s[6]&&(this.s[6].left=this.sa+t+3+"px"),this.autoValue&&(this.c[2].textContent=this.value+(this.isDeg?"":"")),n&&this.send()}rSize(){super.rSize();let n=this.sb-this.sc;this.ww=n-6;let t=this.sc;(this.isUI||!this.simple)&&(t=this.sc+10),this.txl=this.w-t+2;let e=this.s;e[2].width=this.sc-6+"px",e[2].left=this.txl+4+"px",e[3].left=this.sa+"px",e[3].width=n+"px",e[4].left=this.sa+"px",e[4].width=n+"px",e[5].left=this.sa+3+"px",this.update()}}class TextInput extends Proto{constructor(n={}){super(n),this.cmode=0,this.value=n.value!==void 0?n.value:"",this.placeHolder=n.placeHolder||"",this.allway=n.allway||!1,this.editable=n.edit!==void 0?n.edit:!0,this.isDown=!1;let t=this.colors;this.c[2]=this.dom("div",this.css.txtselect+"top:1px; height:"+(this.h-2)+"px; color:"+t.text+"; background:"+t.back+"; borderColor:"+t.border+"; border-radius:"+this.radius+"px;"),this.c[2].textContent=this.value,this.c[3]=this.dom("div",this.css.txtselect+"position:absolute; top:2px; height:"+(this.h-4)+"px; padding:0px 0px; width:0px; color:"+t.textSelect+"; background:"+t.select+"; border:none; border-radius:0px;"),this.c[4]=this.dom("div",this.css.basic+"top:2px; height:"+(this.h-4)+"px; width:0px; background:"+t.text+";"),this.c[5]=this.dom("div",this.css.txtselect+"top:1px; height:"+(this.h-2)+"px; border:none; justify-content: center; font-style: italic; color:"+t.border+";"),this.value===""&&(this.c[5].textContent=this.placeHolder),this.init()}testZone(n){let t=this.local;return t.x===-1&&t.y===-1?"":t.x>=this.sa?"text":""}mouseup(n){if(this.editable)return this.isDown?(this.isDown=!1,this.mousemove(n)):!1}mousedown(n){if(!this.editable)return;let t=this.testZone(n);return this.isDown?!1:(this.isDown=!0,t==="text"&&this.setInput(this.c[2]),this.mousemove(n))}mousemove(n){if(!this.editable)return;let t=this.testZone(n),e=0;return t==="text"?this.cursor("text"):this.cursor(),this.isDown&&(e=n.clientX-this.zone.x),this.upInput(e-this.sa-3,this.isDown)}update(){this.c[2].textContent=this.value}reset(){this.cursor()}select(n,t,e,i){let s=this.s,r=this.sa+5;s[4].width="1px",s[4].left=r+t+"px",s[3].left=r+t+"px",s[3].width=e+"px",this.c[3].innerHTML=i}unselect(){let n=this.s;n&&(n[3].width="0px",this.c[3].innerHTML="t",n[4].width="0px")}validate(n){this.allway&&(n=!0),this.value=this.c[2].textContent,this.value!==""?this.c[5].textContent="":this.c[5].textContent=this.placeHolder,n&&this.send()}rSize(){super.rSize();let n=this.s;n[2].left=this.sa+"px",n[2].width=this.sb+"px",n[5].left=this.sa+"px",n[5].width=this.sb+"px"}}class Title extends Proto{constructor(n={}){super(n),this.isTitle=!0;let t=n.prefix||"",e=n.color||this.colors.text;this.c[2]=this.dom("div",this.css.txt+"justify-content:right; width:60px; line-height:"+(this.h-8)+"px; color:"+e),this.h===31&&(this.s[0].height=this.h+"px",this.s[1].top="8px",this.c[2].style.top="8px");let i=this.s;i[1].justifyContent=n.align||"left",i[1].fontWeight=n.fontWeight||"bold",i[1].color=n.color||this.colors.text,this.c[1].textContent=this.txt.substring(0,1).toUpperCase()+this.txt.substring(1).replace("-"," "),this.c[2].textContent=t,this.init()}text(n){this.c[1].textContent=n}text2(n){this.c[2].textContent=n}rSize(){super.rSize(),this.s[1].width=this.w+"px",this.s[2].left=this.w+"px"}setColor(n){this.s[1].color=n,this.s[2].color=n}}class Select extends Proto{constructor(n={}){super(n),this.value=n.value||"",this.isDown=!1,this.onActif=n.onActif||function(){};const t=this.colors;this.c[2]=this.dom("div",this.css.txt+this.css.button+" top:1px; background:"+t.button+"; height:"+(this.h-2)+"px; border:"+t.buttonBorder+"; border-radius:15px; width:30px; left:10px;"),this.c[3]=this.dom("div",this.css.txtselect+"height:"+(this.h-4)+"px; background:"+t.inputBg+"; borderColor:"+t.inputBorder+"; border-radius:"+this.radius+"px;"),this.c[3].textContent=this.value;let e=Math.floor(this.h*.5)-7;this.c[4]=this.dom("path",this.css.basic+"position:absolute; width:14px; height:14px; left:5px; top:"+e+"px;",{d:this.svgs.cursor,fill:t.text,stroke:"none"}),this.stat=1,this.isActif=!1,this.init()}testZone(n){let t=this.local;return t.x===-1&&t.y===-1?"":t.x>this.sa&&t.x<this.sa+30?"over":"0"}mouseup(n){return this.isDown?(this.isDown=!1,this.mousemove(n)):!1}mousedown(n){return this.testZone(n)?(this.isDown=!0,this.mousemove(n)):!1}mousemove(n){let t=!1;return this.testZone(n)==="over"?(this.cursor("pointer"),t=this.mode(this.isDown?3:2)):t=this.reset(),t}apply(n){n=n||"",n!==this.value&&(this.value=n,this.c[3].textContent=this.value,this.send()),this.mode(1)}update(){this.mode(3)}mode(n){let t=!1,e=this.colors;if(this.stat!==n){switch(n===1&&(this.isActif=!1),n===3&&(this.isActif?this.isActif=!1:(this.isActif=!0,n=4,this.onActif(this))),n===2&&this.isActif&&(n=4),this.stat=n,n){case 1:this.s[2].color=e.text,this.s[2].background=e.button;break;case 2:this.s[2].color=e.textOver,this.s[2].background=e.overoff;break;case 3:this.s[2].color=e.textOver,this.s[2].background=e.action;break;case 4:this.s[2].color=e.textSelect,this.s[2].background=e.action;break}t=!0}return t}reset(){return this.cursor(),this.mode(this.isActif?4:1)}text(n){this.c[3].textContent=n}rSize(){super.rSize();let n=this.s;n[2].left=this.sa+"px",n[3].left=this.sa+40+"px",n[3].width=this.sb-40+"px",n[4].left=this.sa+8+"px"}}class Bitmap extends Proto{constructor(n={}){super(n),this.value=n.value||"",this.colorSpace=n.colorSpace||"",this.img=null,this.value.isTexture&&this.value.image&&(this.img=this.value.image),this.isDown=!1,this.neverlock=!0;const t=this.colors;this.c[2]=this.dom("div",this.css.txt+this.css.button+" top:1px; background:"+t.button+"; height:"+(this.h-2)+"px; border:"+t.buttonBorder+"; border-radius:2px; width:30px; "),this.c[3]=this.dom("div",this.css.txtselect+"height:"+(this.h-4)+"px; background:"+t.back+"; borderColor:"+t.inputBorder+"; border-radius:"+this.radius+"px;"),this.img||(this.c[3].textContent="null");let e=Math.floor(this.h*.5)-7;this.c[4]=this.dom("path",this.css.basic+"position:absolute; width:14px; height:14px; left:5px; top:"+e+"px;",{d:this.svgs.load,fill:t.text,stroke:"none"}),this.stat=1,this.makePreview(),this.init()}testZone(n){let t=this.local;return t.x===-1&&t.y===-1?"":t.x>this.sa&&t.x<this.sa+30?"over":t.x>this.sa-30&&t.x<this.sa?"delete":"0"}mouseup(n){return this.isDown?(this.isDown=!1,this.mousemove(n)):!1}mousedown(n){let t=this.testZone(n);return t?(t==="over"&&(this.isDown=!0,Files.load({callback:this.changeBitmap.bind(this),always:!0,type:"image"})),this.mousemove(n)):!1}mousemove(n){let t=!1;return this.testZone(n)==="over"?(this.cursor("pointer"),t=this.mode(this.isDown?3:2)):t=this.reset(),t}makePreview(){this.img?(this.c[3].style.background="url("+this.img.src+")",this.c[3].style.backgroundSize=this.sb-40+"px "+(this.sb-40)+"px",this.c[3].style.backgroundPosition="center",this.c[3].style.backgroundRepeat="no-repeat"):(this.c[3].style.background=this.colors.back,this.c[3].style.backgroundImage="none")}changeBitmap(n,t,e){n?(this.img=n,this.apply(t)):(this.img=null,this.apply("null")),this.makePreview(),this.threeTexture()}threeTexture(){if(this.objectLink===null)return;let n=this.objectLink[this.objectKey];this.img?n!==null&&(n.image=this.img,this.objectLink[this.objectKey]=n.clone(),n.dispose(),this.objectLink[this.objectKey].needsUpdate=!0):this.objectLink[this.objectKey]=null,this.objectLink.needsUpdate=!0}apply(n){n=n||"";let t=this.objectLink!==null?this.objectKey:this.name;n!==this.value&&(this.value=n,this.img!==null?(this.c[3].textContent="",this.callback&&this.callback(this.value,this.img,t)):(this.c[3].textContent="null",this.callback&&this.callback(null,null,t))),this.mode(1)}update(){this.mode(3)}mode(n,t){let e=!1,i=this.colors;if(this.stat!==n){switch(this.stat=n,n){case 1:this.s[2].color=i.text,this.s[2].background=i.button;break;case 2:this.s[2].color=i.textOver,this.s[2].background=i.overoff;break;case 3:this.s[2].color=i.textOver,this.s[2].background=i.over;break;case 4:this.s[2].color=i.textSelect,this.s[2].background=i.select;break}e=!0}return e}reset(){return this.cursor(),this.mode(this.isActif?4:1)}text(n){this.c[3].textContent=n}rSize(){super.rSize();let n=this.s;n[2].left=this.sa+"px",n[3].left=this.sa+40+"px",n[3].width=this.sb-40+"px",n[4].left=this.sa+8+"px"}}class Selector extends Button{constructor(n={}){n.selectable===void 0&&(n.selectable=!0),super(n)}}class Item extends Proto{constructor(n={}){super(n),this.p=100,this.value=this.txt,this.status=1,this.itype=n.itype||"none",this.val=this.itype,this.graph=this.svgs[this.itype];let t=Math.floor(this.h*.5)-7;this.c[2]=this.dom("path",this.css.basic+"position:absolute; width:14px; height:14px; left:5px; top:"+t+"px;",{d:this.graph,fill:this.colors.text,stroke:"none"}),this.s[1].marginLeft="20px",this.init()}mousemove(n){this.cursor("pointer")}mousedown(n){return this.isUI&&this.main.resetItem(),this.selected(!0),this.send(),!0}uiout(){this.isSelect?this.mode(3):this.mode(1)}uiover(){this.isSelect?this.mode(4):this.mode(2)}update(){}mode(n){let t=!1;if(this.status!==n){this.status=n;let e=this.s,i=this.colors;switch(n){case 1:this.status=1,e[1].color=i.text,e[0].background="none";break;case 2:this.status=2,e[1].color=i.textOver,e[0].background=i.back;break;case 3:this.status=3,e[1].color=i.textSelect,e[0].background=i.select;break;case 4:this.status=4,e[1].color=i.textOver,e[0].background=i.over;break}t=!0}return t}reset(){this.cursor()}selected(n){this.isSelect&&this.mode(1),this.isSelect=n||!1,this.isSelect&&this.mode(3)}}class Grid extends Proto{constructor(n={}){if(super(n),this.values=[],n.values){if(n.values instanceof Array)this.values=n.values;else if(n.values instanceof String)this.values=[n.values];else if(n.values instanceof Object){this.refObject=n.values;for(let h in this.refObject)this.values.push(h)}}this.lng=this.values.length,this.value=n.value||null;let t=this.colors;this.isSelectable=n.selectable||!1,this.spaces=n.spaces||[t.sx,t.sy],this.bsize=n.bsize||[90,this.h],this.bsizeMax=this.bsize[0],this.tmp=[],this.stat=[],this.grid=[2,Math.round(this.lng*.5)],this.h=this.grid[1]*this.bsize[1]+this.grid[1]*this.spaces[1],this.c[1].textContent="",this.c[2]=this.dom("table",this.css.basic+"width:100%; border-spacing: "+(this.spaces[0]-2)+"px "+this.spaces[1]+"px; border:none;");let e=0,i,s,r,o;this.res=-1,this.isDown=!1,this.neverlock=!0,this.buttons=[],this.stat=[],this.tmpX=[],this.tmpY=[];for(let h=0;h<this.grid[1];h++){r=this.c[2].insertRow(),r.style.cssText="pointer-events:none;";for(let u=0;u<this.grid[0];u++)s=r.insertCell(),s.style.cssText="pointer-events:none;",this.values[e]?(o=!1,this.values[e]===this.value&&this.isSelectable&&(o=!0),i=document.createElement("div"),i.style.cssText=this.css.txt+this.css.button+"position:static; top:1px; width:"+this.bsize[0]+"px; height:"+(this.bsize[1]-2)+"px; border:"+t.borderSize+"px solid "+t.border+"; left:auto; right:auto; border-radius:"+this.radius+"px;",i.style.background=o?t.select:t.button,i.style.color=o?t.textSelect:t.text,i.innerHTML=this.values[e],s.appendChild(i),this.buttons.push(i),this.stat.push(1)):(i=document.createElement("div"),i.style.cssText=this.css.txt+"position:static; width:"+this.bsize[0]+"px; height:"+this.bsize[1]+"px; text-align:center; left:auto; right:auto; background:none;",s.appendChild(i)),u===0?i.style.cssText+="float:right;":i.style.cssText+="float:left;",e++}this.s[0].border="none",this.init()}testZone(n){let t=this.local;if(t.x===-1&&t.y===-1)return-1;t.y+=this.mtop;let e=this.tmpX,i=this.tmpY,s=-1,r=-1,o=-1,h=this.grid[0];for(;h--;)t.x>e[h][0]&&t.x<e[h][1]&&(r=h);for(h=this.grid[1];h--;)t.y>i[h][0]&&t.y<i[h][1]&&(o=h);return r!==-1&&o!==-1&&(s=r+o*2,s>this.lng-1&&(s=-1)),s}mouseup(n){return this.isDown?(this.isDown=!1,this.res!==-1&&(this.value=this.values[this.res],this.send()),this.mousemove(n)):!1}mousedown(n){return this.isDown?!1:(this.isDown=!0,this.mousemove(n))}mousemove(n){let t=!1;return this.res=this.testZone(n),this.res!==-1?(this.cursor("pointer"),t=this.modes(this.isDown?3:2,this.res)):t=this.reset(),t}update(){this.modes(2,this.values.indexOf(this.value))}modes(n=1,t=-1){let e=this.lng,i,s,r=!1;for(;e--;)s=n,i=this.isSelectable?this.values[e]===this.value:!1,e===t?i&&s===2&&(s=3):(s=1,i&&(s=4)),this.mode(s,e)&&(r=!0);return r}mode(n,t){let e=!1,i=this.colors,s=this.buttons,r=t;if(this.stat[t]!==n){switch(this.stat[t]=n,n){case 1:s[r].style.color=i.text,s[r].style.background=i.button;break;case 2:s[r].style.color=i.textOver,s[r].style.background=i.overoff;break;case 3:s[r].style.color=i.textOver,s[r].style.background=i.over;break;case 4:s[r].style.color=i.textSelect,s[r].style.background=i.select;break}e=!0}return e}reset(){return this.res=-1,this.cursor(),this.modes()}label(n,t){this.buttons[t].textContent=n}icon(n,t,e){this.buttons[e].style.padding=(t||0)+"px 0px",this.buttons[e].innerHTML=n}testW(){let n=this.spaces[0]*3+this.bsizeMax*2,t=!1;if(n>this.w?(this.bsize[0]=(this.w-this.spaces[0]*3)*.5,t=!0):this.bsize[0]!==this.bsizeMax&&(this.bsize[0]=this.bsizeMax,t=!0),!t)return;let e=this.buttons.length;for(;e--;)this.buttons[e].style.width=this.bsize[0]+"px"}rSize(){super.rSize(),this.testW();let n;this.tmpX=[],this.tmpY=[];for(let t=0;t<this.grid[0];t++)t===0?(n=this.w*.5-this.spaces[0]*.5,this.tmpX.push([n-this.bsize[0],n])):(n=this.w*.5+this.spaces[0]*.5,this.tmpX.push([n,n+this.bsize[0]]));n=this.spaces[1];for(let t=0;t<this.grid[1];t++)this.tmpY.push([n,n+this.bsize[1]]),n+=this.bsize[1]+this.spaces[1]}}class Pad2D extends Proto{constructor(n={}){super(n),this.autoWidth=!1,this.minw=this.w,this.diam=n.diam||this.w,this.pos=new V2(0,0),this.maxPos=90,this.model=n.stype||0,n.mode!==void 0&&(this.model=n.mode),this.min=n.min===void 0?-1:n.min,this.max=n.max===void 0?1:n.max,this.range=(this.max-this.min)*.5,this.cmode=0,this.c[0].style.display="block",this.precision=n.precision===void 0?2:n.precision,this.value=Array.isArray(n.value)&&n.value.length==2?n.value:[0,0],this.h=n.h||this.w+10,this.c[0].style.width=this.w+"px",this.c[1]!==void 0&&(this.c[1].style.width="100%",this.c[1].style.justifyContent="center",this.top=10,this.h+=10);let t=this.colors;this.c[2]=this.dom("div",this.css.txt+"justify-content:center; top:"+(this.h-20)+"px; width:100%; color:"+t.text),this.c[2].textContent=this.value;let e=this.getPad2d();this.setSvg(e,"fill",t.back,0),this.setSvg(e,"fill",t.button,1),this.setSvg(e,"stroke",t.back,2),this.setSvg(e,"stroke",t.back,3),this.setSvg(e,"stroke",t.text,4),this.setSvg(e,"viewBox","0 0 "+this.diam+" "+this.diam),this.setCss(e,{width:this.diam,height:this.diam,left:0,top:this.top}),this.c[3]=e,this.init(),this.setValue()}testZone(n){let t=this.local;return t.x===-1&&t.y===-1?"":t.y<=this.c[1].offsetHeight?"title":t.y>this.h-this.c[2].offsetHeight?"text":"pad"}mouseup(n){return this.isDown=!1,this.mode(0)}mousedown(n){if(this.testZone(n)==="pad")return this.isDown=!0,this.mousemove(n),this.mode(1)}mousemove(n){if(!this.isDown)return;let t=this.w*.5-(n.clientX-this.zone.x),e=this.diam*.5-(n.clientY-this.zone.y-this.ytop),i=256/this.diam;t=-(t*i),e=-(e*i),t=Tools.clamp(t,-this.maxPos,this.maxPos),e=Tools.clamp(e,-this.maxPos,this.maxPos),this.setPos([t,e]),this.update(!0)}mode(n){if(this.cmode===n)return!1;let t=this.colors;switch(n){case 0:this.s[2].color=t.text,this.setSvg(this.c[3],"fill",t.back,0),this.setSvg(this.c[3],"fill",t.button,1),this.setSvg(this.c[3],"stroke",t.back,2),this.setSvg(this.c[3],"stroke",t.back,3),this.setSvg(this.c[3],"stroke",t.text,4);break;case 1:this.s[2].color=t.textSelect,this.setSvg(this.c[3],"fill",t.backoff,0),this.setSvg(this.c[3],"fill",t.overoff,1),this.setSvg(this.c[3],"stroke",t.backoff,2),this.setSvg(this.c[3],"stroke",t.backoff,3),this.setSvg(this.c[3],"stroke",t.textSelect,4);break}return this.cmode=n,!0}update(n){this.c[2].textContent=this.value,this.updateSVG(),n&&this.send()}updateSVG(){this.model==1&&(this.setSvg(this.c[3],"y1",this.pos.y,2),this.setSvg(this.c[3],"y2",this.pos.y,2),this.setSvg(this.c[3],"x1",this.pos.x,3),this.setSvg(this.c[3],"x2",this.pos.x,3)),this.setSvg(this.c[3],"cx",this.pos.x,4),this.setSvg(this.c[3],"cy",this.pos.y,4)}setPos(n){this.pos.set(n[0]+128,n[1]+128);let t=1/this.maxPos;this.value[0]=(n[0]*t*this.range).toFixed(this.precision),this.value[1]=(n[1]*t*this.range).toFixed(this.precision)}setValue(n,t=!1){n===void 0&&(n=this.value),this.value[0]=Math.min(this.max,Math.max(this.min,n[0])).toFixed(this.precision)*1,this.value[1]=Math.min(this.max,Math.max(this.min,n[1])).toFixed(this.precision)*1,this.pos.set(this.value[0]/this.range*this.maxPos+128,this.value[1]/this.range*this.maxPos+128),this.update(t)}}const add$2=function(){let l=arguments,n,t,e=!1,i=null;typeof l[0]=="string"?(n=l[0],t=l[1]||{}):typeof l[0]=="object"&&(e=!0,l[2]===void 0&&[].push.call(l,{}),n=l[2].type?l[2].type:autoType(l[0][l[1]],l[2]),t=l[2],t.name=l[1],n==="list"&&!t.list?t.list=l[0][l[1]]:t.value=l[0][l[1]]);let s=n.toLowerCase();switch(s==="group"&&(t.add=add$2),s){case"bool":case"boolean":i=new Bool(t);break;case"button":i=new Button(t);break;case"circular":i=new Circular(t);break;case"color":i=new Color$1(t);break;case"fps":i=new Fps(t);break;case"graph":i=new Graph(t);break;case"group":i=new Group$2(t);break;case"joystick":i=new Joystick(t);break;case"knob":i=new Knob(t);break;case"list":i=new List(t);break;case"numeric":case"number":i=new Numeric(t);break;case"slide":i=new Slide(t);break;case"textInput":case"string":i=new TextInput(t);break;case"title":case"text":i=new Title(t);break;case"select":i=new Select(t);break;case"bitmap":i=new Bitmap(t);break;case"selector":i=new Selector(t);break;case"empty":case"space":i=new Empty(t);break;case"item":i=new Item(t);break;case"grid":i=new Grid(t);break;case"pad2d":case"pad":i=new Pad2D(t);break}if(i!==null)return Roots.needResize=!0,e&&i.setReferency(l[0],l[1]),i},autoType=function(l,n){let t="slide";return l.isColor?t="color":l.isTexture?t="bitmap":typeof l=="boolean"?t="bool":typeof l=="string"?l.substring(0,1)==="#"?t="color":t="string":typeof l=="number"?n.ctype?t="color":t="slide":typeof l=="array"&&l instanceof Array?typeof l[0]=="number"?t="number":typeof l[0]=="string"&&(t="list"):typeof l=="object"&&l instanceof Object&&(l.x!==void 0?t="number":t="list"),t};class Gui{constructor(n={}){this.isGui=!0,this.name="gui",this.canvas=null,this.screen=null,this.plane=n.plane||null,n.config&&(n.colors=n.config),n.colors?this.setConfig(n.colors):this.colors=Tools.defineColor(n),this.css=Tools.cloneCss(),this.isReset=!0,this.tmpAdd=null,this.isCanvas=n.isCanvas||!1,this.isCanvasOnly=!1,this.callback=n.callback===void 0?null:n.callback,this.forceHeight=n.maxHeight||0,this.lockHeight=n.lockHeight||!1,this.isItemMode=n.itemMode!==void 0?n.itemMode:!1,this.cn="",this.size=Tools.size,n.p!==void 0&&(this.size.p=n.p),n.w!==void 0&&(this.size.w=n.w),n.h!==void 0&&(this.size.h=n.h),n.s!==void 0&&(this.size.s=n.s),this.size.h=this.size.h<11?11:this.size.h,this.local=new V2().neg(),this.zone={x:0,y:0,w:this.size.w,h:0},this.mouse=new V2().neg(),this.h=0,this.sw=0,this.margin=this.colors.sy,this.marginDiv=Tools.isDivid(this.margin),this.isWithClose=n.close!==void 0?n.close:!0,this.bh=this.isWithClose?this.size.h:0,this.autoResize=n.autoResize===void 0?!0:n.autoResize,this.isCenter=n.center||!1,this.isBottom=n.bottom!==void 0,this.realTop=0,this.bottomPosition=n.bottom||0,this.cssGui=n.css!==void 0?n.css:this.isCenter?"":"right:10px;",this.isOpen=n.open!==void 0?n.open:!0,this.isDown=!1,this.isScroll=!1,this.uis=[],this.current=-1,this.proto=null,this.isEmpty=!0,this.decal=0,this.ratio=1,this.oy=0,this.isNewTarget=!1;let t=this.colors,e="border: 2px solid "+t.content+"; ";this.content=Tools.dom("div",this.css.basic+" width:0px; height:auto; top:0px; background:"+t.content+"; "+this.cssGui+e),this.innerContent=Tools.dom("div",this.css.basic+"width:100%; top:0; left:0; height:auto; overflow:hidden;"),this.content.appendChild(this.innerContent),this.useFlex=!0;let i=this.useFlex?"display:flex; flex-flow: row wrap;":"";this.inner=Tools.dom("div",this.css.basic+i+"width:100%; left:0; "),this.innerContent.appendChild(this.inner),this.scrollBG=Tools.dom("div",this.css.basic+"right:0; top:0; width:"+(this.size.s-1)+"px; height:10px; display:none; background:"+t.background+";"),this.content.appendChild(this.scrollBG),this.scroll=Tools.dom("div",this.css.basic+"background:"+t.button+"; right:2px; top:0; width:"+(this.size.s-4)+"px; height:10px;"),this.scrollBG.appendChild(this.scroll),this.bottomText=n.bottomText||["open","close"];let s=t.radius;this.bottom=Tools.dom("div",this.css.txt+"width:100%; top:auto; bottom:0; left:0; border-bottom-right-radius:"+s+"px; border-bottom-left-radius:"+s+"px; justify-content:center; height:"+this.bh+"px; line-height:"+(this.bh-5)+"px; color:"+t.text+";"),this.content.appendChild(this.bottom),this.bottom.textContent=this.isOpen?this.bottomText[1]:this.bottomText[0],this.bottom.style.background=t.background,this.parent=n.parent!==void 0?n.parent:null,this.parent=n.target!==void 0?n.target:this.parent,this.parent===null&&!this.isCanvas&&(this.parent=document.body),this.parent!==null&&this.parent.appendChild(this.content),this.isCanvas&&this.parent===null&&(this.isCanvasOnly=!0),this.isCanvasOnly?(this.content.style.left="0px",this.content.style.right="auto",n.transition=0):this.content.style.pointerEvents="auto",this.transition=n.transition!==void 0?n.transition:Tools.transition,this.transition&&setTimeout(this.addTransition.bind(this),1e3),this.setWidth(),this.isCanvas&&this.makeCanvas(),Roots.add(this)}setLeft(n){this.content.style.left=n+"px",Roots.needReZone=!0}setTop(n,t){this.content.style.top=n+"px",t!==void 0&&(this.forceHeight=t),this.calc(),Roots.needReZone=!0}addTransition(){this.transition&&!this.isCanvas&&(this.innerContent.style.transition="height "+this.transition+"s ease-out",this.content.style.transition="height "+this.transition+"s ease-out",this.bottom.style.transition="top "+this.transition+"s ease-out");let n=this.uis.length;for(;n--;)this.uis[n].addTransition()}onDraw(){}makeCanvas(){this.canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.canvas.width=this.zone.w,this.canvas.height=this.forceHeight?this.forceHeight:this.zone.h}draw(n){if(this.canvas===null)return;let t=this.zone.w,e=this.forceHeight?this.forceHeight:this.zone.h;Roots.toCanvas(this,t,e,n)}getDom(){return this.content}noMouse(){this.mouse.neg()}setMouse(n,t=!0){t?this.mouse.set(Math.round(n.x*this.canvas.width),this.canvas.height-Math.round(n.y*this.canvas.height)):this.mouse.set(Math.round(n.x*this.canvas.width),Math.round(n.y*this.canvas.height))}setConfig(n){Tools.setText(),this.colors=Tools.defineColor(n)}setColors(n){for(let t in n)this.colors[t]&&(this.colors[t]=n[t])}setText(n,t,e,i){Tools.setText(n,t,e,i)}hide(n){this.content.style.visibility=n?"hidden":"visible"}display(n=!1){this.content.style.visibility=n?"visible":"hidden"}onChange(n){return this.callback=n||null,this}mode(n){let t=!1,e=this.colors;if(n!==this.cn){switch(this.cn=n,n){case"def":Roots.cursor(),this.scroll.style.background=e.button,this.bottom.style.background=e.background,this.bottom.style.color=e.text;break;case"scrollOver":Roots.cursor("ns-resize"),this.scroll.style.background=e.select;break;case"scrollDown":this.scroll.style.background=e.select;break;case"bottomOver":Roots.cursor("pointer"),this.bottom.style.background=e.backgroundOver,this.bottom.style.color=e.textOver;break}t=!0}return t}clearTarget(){return this.current===-1?!1:(this.proto.s&&(this.proto.uiout(),this.proto.reset()),this.proto=null,this.current=-1,Roots.cursor(),!0)}testZone(n){let t=this.local;if(t.x===-1&&t.y===-1)return"";this.isReset=!1;let e="",i=this.isScroll?this.zone.w-this.size.s:this.zone.w;return t.y>this.zone.h-this.bh&&t.y<this.zone.h?e="bottom":e=t.x>i?"scroll":"content",e}handleEvent(n){let t=n.type,e=!1,i=!1,s=this.testZone(n);if(t==="mouseup"&&this.isDown&&(this.isDown=!1),t==="mousedown"&&!this.isDown&&(this.isDown=!0),this.isDown&&this.isNewTarget&&(Roots.clearInput(),this.isNewTarget=!1),!!s){switch(s){case"content":n.clientY=this.isScroll?n.clientY+this.decal:n.clientY,Roots.isMobile&&t==="mousedown"&&this.getNext(n,e),this.proto&&(i=this.proto.handleEvent(n)),t==="mousemove"&&(e=this.mode("def")),t==="wheel"&&!i&&this.isScroll&&(e=this.onWheel(n)),Roots.lock||this.getNext(n,e);break;case"bottom":this.clearTarget(),t==="mousemove"&&(e=this.mode("bottomOver")),t==="mousedown"&&(this.isOpen=!this.isOpen,this.bottom.textContent=this.isOpen?this.bottomText[1]:this.bottomText[0],this.calc(),this.mode("def"),e=!0);break;case"scroll":this.clearTarget(),t==="mousemove"&&(e=this.mode("scrollOver")),t==="mousedown"&&(e=this.mode("scrollDown")),t==="wheel"&&(e=this.onWheel(n)),this.isDown&&this.update(n.clientY-this.zone.y-this.sh*.5);break}this.isDown&&(e=!0),i&&(e=!0),t==="keyup"&&(e=!0),t==="keydown"&&(e=!0),e&&this.draw()}}getNext(n,t){let e=Roots.findTarget(this.uis,n);e!==this.current&&(this.clearTarget(),this.current=e,this.isNewTarget=!0),e!==-1&&(this.proto=this.uis[this.current],this.proto.uiover())}onWheel(n){return this.oy+=20*n.delta,this.update(this.oy),!0}reset(n){if(this.isReset)return;this.mouse.neg(),this.isDown=!1;let t=this.mode("def"),e=this.clearTarget();(t||e)&&this.draw(!0),this.isReset=!0}add(){let n=arguments,t=!1;typeof n[1]=="object"?(n[1].isUI=!0,n[1].main=this,t=n[1].ontop?n[1].ontop:!1):typeof n[1]=="string"&&(n[2]===void 0?[].push.call(n,{isUI:!0,main:this}):(n[2].isUI=!0,n[2].main=this,t=n[2].ontop?n[2].ontop:!1));let e=add$2.apply(this,n);if(e!==null)return t?this.uis.unshift(e):this.uis.push(e),this.calc(),this.isEmpty=!1,e}remove(n){n.dispose&&n.dispose()}clearOne(n){let t=this.uis.indexOf(n);t!==-1&&(this.inner.removeChild(this.uis[t].c[0]),this.uis.splice(t,1),this.calc())}empty(){let n=this.uis.length,t;for(;n--;)t=this.uis.pop(),this.inner.removeChild(t.c[0]),t.dispose();this.uis=[],this.isEmpty=!0,this.calc()}clear(){this.empty()}clear2(){setTimeout(this.empty.bind(this),0)}dispose(){this.clear(),this.parent!==null&&this.parent.removeChild(this.content),Roots.remove(this)}resetItem(){if(!this.isItemMode)return;let n=this.uis.length;for(;n--;)this.uis[n].selected()}setItem(n){if(!this.isItemMode)return;if(n=n||"",this.resetItem(),!n){this.update(0);return}let t=this.uis.length;for(;t--;)this.uis[t].value===n&&(this.uis[t].selected(!0),this.isScroll&&this.update(t*(this.uis[t].h+this.margin)*this.ratio))}upScroll(n){this.sw=n?this.size.s:0,this.oy=n?this.oy:0,this.scrollBG.style.display=n?"block":"none",n&&(this.total=this.h,this.maxView=this.maxHeight,this.ratio=this.maxView/this.total,this.sh=this.maxView*this.ratio,this.range=this.maxView-this.sh,this.oy=Tools.clamp(this.oy,0,this.range),this.scrollBG.style.height=this.maxView+"px",this.scroll.style.height=this.sh+"px"),this.setItemWidth(this.zone.w-this.sw),this.update(this.oy)}update(n){n=Tools.clamp(n,0,this.range),this.decal=Math.floor(n/this.ratio),this.inner.style.top=-this.decal+"px",this.scroll.style.top=Math.floor(n)+"px",this.oy=n}calcUis(){return Roots.calcUis(this.uis,this.zone,this.zone.y)}calc(){clearTimeout(this.tmp),this.tmp=setTimeout(this.setHeight.bind(this),10)}setHeight(){if(this.tmp&&clearTimeout(this.tmp),this.zone.h=this.bh,this.isScroll=!1,this.isOpen){this.h=this.calcUis();let n=this.forceHeight?this.forceHeight+this.zone.y:window.innerHeight,t=this.isBottom?this.bottomPosition:this.zone.y;this.maxHeight=n-t-this.bh,this.h-this.maxHeight>1?(this.isScroll=!0,this.zone.h=this.maxHeight+this.bh):this.zone.h=this.h+this.bh}this.upScroll(this.isScroll),this.innerContent.style.height=this.zone.h-this.bh+"px",this.content.style.height=this.zone.h+"px",this.bottom.style.top=this.zone.h-this.bh+"px",this.isBottom&&(this.realTop=window.innerHeight-this.zone.h-this.bottomPosition,this.zone.y=this.realTop,this.content.style.top=this.realTop+"px",this.calcUis()),this.forceHeight&&this.lockHeight&&(this.content.style.height=this.forceHeight+"px"),this.isCanvas&&this.draw(!0)}resizeRoot(){Roots.resize(),Roots.initEvents()}rezone(){Roots.needReZone=!0}getRoot(){return Roots}zoneReset(){}setWidth(n){n&&(this.zone.w=n),this.zone.w=Math.floor(this.zone.w),this.content.style.width=this.zone.w+"px",this.isCenter&&(this.content.style.marginLeft=-Math.floor(this.zone.w*.5)+"px"),this.setItemWidth(this.zone.w-this.sw)}setItemWidth(n){let t=this.uis.length;for(;t--;)this.uis[t].setSize(n),this.uis[t].rSize()}}function getDesiredRobot(){return new URLSearchParams(location.search).get("robot")||"franka"}function getDesiredLanguage(){let n=new URLSearchParams(location.search).get("lang");if(!n){n="en";for(let t of navigator.languages){let e=t.split("-")[0].toLowerCase();if(["de","en"].includes(e)){n=e;break}}}return n.toLowerCase()}window.matchMedia("(hover: none) and (pointer: coarse)").matches;const _canHover=window.matchMedia("(hover: hover)").matches;function canHover(){return _canHover}function isNarrowScreen(){return document.body.clientWidth<768}function localize(l,...n){return $.i18n(l,...n)}/**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const REVISION="129",MOUSE={ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,FlatShading=1,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,CubeUVRefractionMapping=307,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipmapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipmapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedShort565Type=1019,UnsignedInt248Type=1020,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBIntegerFormat=1032,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,SRGB8_ALPHA8_ASTC_4x4_Format=37840,SRGB8_ALPHA8_ASTC_5x4_Format=37841,SRGB8_ALPHA8_ASTC_5x5_Format=37842,SRGB8_ALPHA8_ASTC_6x5_Format=37843,SRGB8_ALPHA8_ASTC_6x6_Format=37844,SRGB8_ALPHA8_ASTC_8x5_Format=37845,SRGB8_ALPHA8_ASTC_8x6_Format=37846,SRGB8_ALPHA8_ASTC_8x8_Format=37847,SRGB8_ALPHA8_ASTC_10x5_Format=37848,SRGB8_ALPHA8_ASTC_10x6_Format=37849,SRGB8_ALPHA8_ASTC_10x8_Format=37850,SRGB8_ALPHA8_ASTC_10x10_Format=37851,SRGB8_ALPHA8_ASTC_12x10_Format=37852,SRGB8_ALPHA8_ASTC_12x12_Format=37853,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,AdditiveAnimationBlendMode=2501,TrianglesDrawMode=0,LinearEncoding=3e3,sRGBEncoding=3001,GammaEncoding=3007,RGBEEncoding=3002,LogLuvEncoding=3003,RGBM7Encoding=3004,RGBM16Encoding=3005,RGBDEncoding=3006,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,KeepStencilOp=7680,AlwaysStencilFunc=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,GLSL3="300 es";class EventDispatcher{addEventListener(n,t){this._listeners===void 0&&(this._listeners={});const e=this._listeners;e[n]===void 0&&(e[n]=[]),e[n].indexOf(t)===-1&&e[n].push(t)}hasEventListener(n,t){if(this._listeners===void 0)return!1;const e=this._listeners;return e[n]!==void 0&&e[n].indexOf(t)!==-1}removeEventListener(n,t){if(this._listeners===void 0)return;const i=this._listeners[n];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(n){if(this._listeners===void 0)return;const e=this._listeners[n.type];if(e!==void 0){n.target=this;const i=e.slice(0);for(let s=0,r=i.length;s<r;s++)i[s].call(this,n);n.target=null}}}const _lut=[];for(let l=0;l<256;l++)_lut[l]=(l<16?"0":"")+l.toString(16);let _seed=1234567;const DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID(){const l=Math.random()*4294967295|0,n=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0;return(_lut[l&255]+_lut[l>>8&255]+_lut[l>>16&255]+_lut[l>>24&255]+"-"+_lut[n&255]+_lut[n>>8&255]+"-"+_lut[n>>16&15|64]+_lut[n>>24&255]+"-"+_lut[t&63|128]+_lut[t>>8&255]+"-"+_lut[t>>16&255]+_lut[t>>24&255]+_lut[e&255]+_lut[e>>8&255]+_lut[e>>16&255]+_lut[e>>24&255]).toUpperCase()}function clamp(l,n,t){return Math.max(n,Math.min(t,l))}function euclideanModulo(l,n){return(l%n+n)%n}function mapLinear(l,n,t,e,i){return e+(l-n)*(i-e)/(t-n)}function inverseLerp(l,n,t){return l!==n?(t-l)/(n-l):0}function lerp(l,n,t){return(1-t)*l+t*n}function damp(l,n,t,e){return lerp(l,n,1-Math.exp(-t*e))}function pingpong(l,n=1){return n-Math.abs(euclideanModulo(l,n*2)-n)}function smoothstep(l,n,t){return l<=n?0:l>=t?1:(l=(l-n)/(t-n),l*l*(3-2*l))}function smootherstep(l,n,t){return l<=n?0:l>=t?1:(l=(l-n)/(t-n),l*l*l*(l*(l*6-15)+10))}function randInt(l,n){return l+Math.floor(Math.random()*(n-l+1))}function randFloat(l,n){return l+Math.random()*(n-l)}function randFloatSpread(l){return l*(.5-Math.random())}function seededRandom(l){return l!==void 0&&(_seed=l%2147483647),_seed=_seed*16807%2147483647,(_seed-1)/2147483646}function degToRad(l){return l*DEG2RAD}function radToDeg(l){return l*RAD2DEG}function isPowerOfTwo(l){return(l&l-1)===0&&l!==0}function ceilPowerOfTwo(l){return Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))}function floorPowerOfTwo(l){return Math.pow(2,Math.floor(Math.log(l)/Math.LN2))}function setQuaternionFromProperEuler(l,n,t,e,i){const s=Math.cos,r=Math.sin,o=s(t/2),h=r(t/2),u=s((n+e)/2),p=r((n+e)/2),d=s((n-e)/2),f=r((n-e)/2),g=s((e-n)/2),_=r((e-n)/2);switch(i){case"XYX":l.set(o*p,h*d,h*f,o*u);break;case"YZY":l.set(h*f,o*p,h*d,o*u);break;case"ZXZ":l.set(h*d,h*f,o*p,o*u);break;case"XZX":l.set(o*p,h*_,h*g,o*u);break;case"YXY":l.set(h*g,o*p,h*_,o*u);break;case"ZYZ":l.set(h*_,h*g,o*p,o*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}var MathUtils=Object.freeze({__proto__:null,DEG2RAD,RAD2DEG,generateUUID,clamp,euclideanModulo,mapLinear,inverseLerp,lerp,damp,pingpong,smoothstep,smootherstep,randInt,randFloat,randFloatSpread,seededRandom,degToRad,radToDeg,isPowerOfTwo,ceilPowerOfTwo,floorPowerOfTwo,setQuaternionFromProperEuler});class Vector2{constructor(n=0,t=0){this.x=n,this.y=t}get width(){return this.x}set width(n){this.x=n}get height(){return this.y}set height(n){this.y=n}set(n,t){return this.x=n,this.y=t,this}setScalar(n){return this.x=n,this.y=n,this}setX(n){return this.x=n,this}setY(n){return this.y=n,this}setComponent(n,t){switch(n){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+n)}return this}getComponent(n){switch(n){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+n)}}clone(){return new this.constructor(this.x,this.y)}copy(n){return this.x=n.x,this.y=n.y,this}add(n,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(n,t)):(this.x+=n.x,this.y+=n.y,this)}addScalar(n){return this.x+=n,this.y+=n,this}addVectors(n,t){return this.x=n.x+t.x,this.y=n.y+t.y,this}addScaledVector(n,t){return this.x+=n.x*t,this.y+=n.y*t,this}sub(n,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(n,t)):(this.x-=n.x,this.y-=n.y,this)}subScalar(n){return this.x-=n,this.y-=n,this}subVectors(n,t){return this.x=n.x-t.x,this.y=n.y-t.y,this}multiply(n){return this.x*=n.x,this.y*=n.y,this}multiplyScalar(n){return this.x*=n,this.y*=n,this}divide(n){return this.x/=n.x,this.y/=n.y,this}divideScalar(n){return this.multiplyScalar(1/n)}applyMatrix3(n){const t=this.x,e=this.y,i=n.elements;return this.x=i[0]*t+i[3]*e+i[6],this.y=i[1]*t+i[4]*e+i[7],this}min(n){return this.x=Math.min(this.x,n.x),this.y=Math.min(this.y,n.y),this}max(n){return this.x=Math.max(this.x,n.x),this.y=Math.max(this.y,n.y),this}clamp(n,t){return this.x=Math.max(n.x,Math.min(t.x,this.x)),this.y=Math.max(n.y,Math.min(t.y,this.y)),this}clampScalar(n,t){return this.x=Math.max(n,Math.min(t,this.x)),this.y=Math.max(n,Math.min(t,this.y)),this}clampLength(n,t){const e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(n,Math.min(t,e)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(n){return this.x*n.x+this.y*n.y}cross(n){return this.x*n.y-this.y*n.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(n){return Math.sqrt(this.distanceToSquared(n))}distanceToSquared(n){const t=this.x-n.x,e=this.y-n.y;return t*t+e*e}manhattanDistanceTo(n){return Math.abs(this.x-n.x)+Math.abs(this.y-n.y)}setLength(n){return this.normalize().multiplyScalar(n)}lerp(n,t){return this.x+=(n.x-this.x)*t,this.y+=(n.y-this.y)*t,this}lerpVectors(n,t,e){return this.x=n.x+(t.x-n.x)*e,this.y=n.y+(t.y-n.y)*e,this}equals(n){return n.x===this.x&&n.y===this.y}fromArray(n,t=0){return this.x=n[t],this.y=n[t+1],this}toArray(n=[],t=0){return n[t]=this.x,n[t+1]=this.y,n}fromBufferAttribute(n,t,e){return e!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=n.getX(t),this.y=n.getY(t),this}rotateAround(n,t){const e=Math.cos(t),i=Math.sin(t),s=this.x-n.x,r=this.y-n.y;return this.x=s*e-r*i+n.x,this.y=s*i+r*e+n.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}Vector2.prototype.isVector2=!0;class Matrix3{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(n,t,e,i,s,r,o,h,u){const p=this.elements;return p[0]=n,p[1]=i,p[2]=o,p[3]=t,p[4]=s,p[5]=h,p[6]=e,p[7]=r,p[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(n){const t=this.elements,e=n.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this}extractBasis(n,t,e){return n.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),e.setFromMatrix3Column(this,2),this}setFromMatrix4(n){const t=n.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(n){return this.multiplyMatrices(this,n)}premultiply(n){return this.multiplyMatrices(n,this)}multiplyMatrices(n,t){const e=n.elements,i=t.elements,s=this.elements,r=e[0],o=e[3],h=e[6],u=e[1],p=e[4],d=e[7],f=e[2],g=e[5],_=e[8],v=i[0],y=i[3],E=i[6],m=i[1],x=i[4],C=i[7],O=i[2],S=i[5],P=i[8];return s[0]=r*v+o*m+h*O,s[3]=r*y+o*x+h*S,s[6]=r*E+o*C+h*P,s[1]=u*v+p*m+d*O,s[4]=u*y+p*x+d*S,s[7]=u*E+p*C+d*P,s[2]=f*v+g*m+_*O,s[5]=f*y+g*x+_*S,s[8]=f*E+g*C+_*P,this}multiplyScalar(n){const t=this.elements;return t[0]*=n,t[3]*=n,t[6]*=n,t[1]*=n,t[4]*=n,t[7]*=n,t[2]*=n,t[5]*=n,t[8]*=n,this}determinant(){const n=this.elements,t=n[0],e=n[1],i=n[2],s=n[3],r=n[4],o=n[5],h=n[6],u=n[7],p=n[8];return t*r*p-t*o*u-e*s*p+e*o*h+i*s*u-i*r*h}invert(){const n=this.elements,t=n[0],e=n[1],i=n[2],s=n[3],r=n[4],o=n[5],h=n[6],u=n[7],p=n[8],d=p*r-o*u,f=o*h-p*s,g=u*s-r*h,_=t*d+e*f+i*g;if(_===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/_;return n[0]=d*v,n[1]=(i*u-p*e)*v,n[2]=(o*e-i*r)*v,n[3]=f*v,n[4]=(p*t-i*h)*v,n[5]=(i*s-o*t)*v,n[6]=g*v,n[7]=(e*h-u*t)*v,n[8]=(r*t-e*s)*v,this}transpose(){let n;const t=this.elements;return n=t[1],t[1]=t[3],t[3]=n,n=t[2],t[2]=t[6],t[6]=n,n=t[5],t[5]=t[7],t[7]=n,this}getNormalMatrix(n){return this.setFromMatrix4(n).invert().transpose()}transposeIntoArray(n){const t=this.elements;return n[0]=t[0],n[1]=t[3],n[2]=t[6],n[3]=t[1],n[4]=t[4],n[5]=t[7],n[6]=t[2],n[7]=t[5],n[8]=t[8],this}setUvTransform(n,t,e,i,s,r,o){const h=Math.cos(s),u=Math.sin(s);return this.set(e*h,e*u,-e*(h*r+u*o)+r+n,-i*u,i*h,-i*(-u*r+h*o)+o+t,0,0,1),this}scale(n,t){const e=this.elements;return e[0]*=n,e[3]*=n,e[6]*=n,e[1]*=t,e[4]*=t,e[7]*=t,this}rotate(n){const t=Math.cos(n),e=Math.sin(n),i=this.elements,s=i[0],r=i[3],o=i[6],h=i[1],u=i[4],p=i[7];return i[0]=t*s+e*h,i[3]=t*r+e*u,i[6]=t*o+e*p,i[1]=-e*s+t*h,i[4]=-e*r+t*u,i[7]=-e*o+t*p,this}translate(n,t){const e=this.elements;return e[0]+=n*e[2],e[3]+=n*e[5],e[6]+=n*e[8],e[1]+=t*e[2],e[4]+=t*e[5],e[7]+=t*e[8],this}equals(n){const t=this.elements,e=n.elements;for(let i=0;i<9;i++)if(t[i]!==e[i])return!1;return!0}fromArray(n,t=0){for(let e=0;e<9;e++)this.elements[e]=n[e+t];return this}toArray(n=[],t=0){const e=this.elements;return n[t]=e[0],n[t+1]=e[1],n[t+2]=e[2],n[t+3]=e[3],n[t+4]=e[4],n[t+5]=e[5],n[t+6]=e[6],n[t+7]=e[7],n[t+8]=e[8],n}clone(){return new this.constructor().fromArray(this.elements)}}Matrix3.prototype.isMatrix3=!0;let _canvas;class ImageUtils{static getDataURL(n){if(/^data:/i.test(n.src)||typeof HTMLCanvasElement>"u")return n.src;let t;if(n instanceof HTMLCanvasElement)t=n;else{_canvas===void 0&&(_canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),_canvas.width=n.width,_canvas.height=n.height;const e=_canvas.getContext("2d");n instanceof ImageData?e.putImageData(n,0,0):e.drawImage(n,0,0,n.width,n.height),t=_canvas}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",n),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let textureId=0;class Texture extends EventDispatcher{constructor(n=Texture.DEFAULT_IMAGE,t=Texture.DEFAULT_MAPPING,e=ClampToEdgeWrapping,i=ClampToEdgeWrapping,s=LinearFilter,r=LinearMipmapLinearFilter,o=RGBAFormat,h=UnsignedByteType,u=1,p=LinearEncoding){super(),Object.defineProperty(this,"id",{value:textureId++}),this.uuid=generateUUID(),this.name="",this.image=n,this.mipmaps=[],this.mapping=t,this.wrapS=e,this.wrapT=i,this.magFilter=s,this.minFilter=r,this.anisotropy=u,this.format=o,this.internalFormat=null,this.type=h,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=p,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(n){return this.name=n.name,this.image=n.image,this.mipmaps=n.mipmaps.slice(0),this.mapping=n.mapping,this.wrapS=n.wrapS,this.wrapT=n.wrapT,this.magFilter=n.magFilter,this.minFilter=n.minFilter,this.anisotropy=n.anisotropy,this.format=n.format,this.internalFormat=n.internalFormat,this.type=n.type,this.offset.copy(n.offset),this.repeat.copy(n.repeat),this.center.copy(n.center),this.rotation=n.rotation,this.matrixAutoUpdate=n.matrixAutoUpdate,this.matrix.copy(n.matrix),this.generateMipmaps=n.generateMipmaps,this.premultiplyAlpha=n.premultiplyAlpha,this.flipY=n.flipY,this.unpackAlignment=n.unpackAlignment,this.encoding=n.encoding,this}toJSON(n){const t=n===void 0||typeof n=="string";if(!t&&n.textures[this.uuid]!==void 0)return n.textures[this.uuid];const e={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){const i=this.image;if(i.uuid===void 0&&(i.uuid=generateUUID()),!t&&n.images[i.uuid]===void 0){let s;if(Array.isArray(i)){s=[];for(let r=0,o=i.length;r<o;r++)i[r].isDataTexture?s.push(serializeImage(i[r].image)):s.push(serializeImage(i[r]))}else s=serializeImage(i);n.images[i.uuid]={uuid:i.uuid,url:s}}e.image=i.uuid}return t||(n.textures[this.uuid]=e),e}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(n){if(this.mapping!==UVMapping)return n;if(n.applyMatrix3(this.matrix),n.x<0||n.x>1)switch(this.wrapS){case RepeatWrapping:n.x=n.x-Math.floor(n.x);break;case ClampToEdgeWrapping:n.x=n.x<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(n.x)%2)===1?n.x=Math.ceil(n.x)-n.x:n.x=n.x-Math.floor(n.x);break}if(n.y<0||n.y>1)switch(this.wrapT){case RepeatWrapping:n.y=n.y-Math.floor(n.y);break;case ClampToEdgeWrapping:n.y=n.y<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(n.y)%2)===1?n.y=Math.ceil(n.y)-n.y:n.y=n.y-Math.floor(n.y);break}return this.flipY&&(n.y=1-n.y),n}set needsUpdate(n){n===!0&&this.version++}}Texture.DEFAULT_IMAGE=void 0;Texture.DEFAULT_MAPPING=UVMapping;Texture.prototype.isTexture=!0;function serializeImage(l){return typeof HTMLImageElement<"u"&&l instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&l instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&l instanceof ImageBitmap?ImageUtils.getDataURL(l):l.data?{data:Array.prototype.slice.call(l.data),width:l.width,height:l.height,type:l.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}class Vector4{constructor(n=0,t=0,e=0,i=1){this.x=n,this.y=t,this.z=e,this.w=i}get width(){return this.z}set width(n){this.z=n}get height(){return this.w}set height(n){this.w=n}set(n,t,e,i){return this.x=n,this.y=t,this.z=e,this.w=i,this}setScalar(n){return this.x=n,this.y=n,this.z=n,this.w=n,this}setX(n){return this.x=n,this}setY(n){return this.y=n,this}setZ(n){return this.z=n,this}setW(n){return this.w=n,this}setComponent(n,t){switch(n){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+n)}return this}getComponent(n){switch(n){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+n)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(n){return this.x=n.x,this.y=n.y,this.z=n.z,this.w=n.w!==void 0?n.w:1,this}add(n,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(n,t)):(this.x+=n.x,this.y+=n.y,this.z+=n.z,this.w+=n.w,this)}addScalar(n){return this.x+=n,this.y+=n,this.z+=n,this.w+=n,this}addVectors(n,t){return this.x=n.x+t.x,this.y=n.y+t.y,this.z=n.z+t.z,this.w=n.w+t.w,this}addScaledVector(n,t){return this.x+=n.x*t,this.y+=n.y*t,this.z+=n.z*t,this.w+=n.w*t,this}sub(n,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(n,t)):(this.x-=n.x,this.y-=n.y,this.z-=n.z,this.w-=n.w,this)}subScalar(n){return this.x-=n,this.y-=n,this.z-=n,this.w-=n,this}subVectors(n,t){return this.x=n.x-t.x,this.y=n.y-t.y,this.z=n.z-t.z,this.w=n.w-t.w,this}multiply(n){return this.x*=n.x,this.y*=n.y,this.z*=n.z,this.w*=n.w,this}multiplyScalar(n){return this.x*=n,this.y*=n,this.z*=n,this.w*=n,this}applyMatrix4(n){const t=this.x,e=this.y,i=this.z,s=this.w,r=n.elements;return this.x=r[0]*t+r[4]*e+r[8]*i+r[12]*s,this.y=r[1]*t+r[5]*e+r[9]*i+r[13]*s,this.z=r[2]*t+r[6]*e+r[10]*i+r[14]*s,this.w=r[3]*t+r[7]*e+r[11]*i+r[15]*s,this}divideScalar(n){return this.multiplyScalar(1/n)}setAxisAngleFromQuaternion(n){this.w=2*Math.acos(n.w);const t=Math.sqrt(1-n.w*n.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=n.x/t,this.y=n.y/t,this.z=n.z/t),this}setAxisAngleFromRotationMatrix(n){let t,e,i,s;const h=n.elements,u=h[0],p=h[4],d=h[8],f=h[1],g=h[5],_=h[9],v=h[2],y=h[6],E=h[10];if(Math.abs(p-f)<.01&&Math.abs(d-v)<.01&&Math.abs(_-y)<.01){if(Math.abs(p+f)<.1&&Math.abs(d+v)<.1&&Math.abs(_+y)<.1&&Math.abs(u+g+E-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const x=(u+1)/2,C=(g+1)/2,O=(E+1)/2,S=(p+f)/4,P=(d+v)/4,F=(_+y)/4;return x>C&&x>O?x<.01?(e=0,i=.707106781,s=.707106781):(e=Math.sqrt(x),i=S/e,s=P/e):C>O?C<.01?(e=.707106781,i=0,s=.707106781):(i=Math.sqrt(C),e=S/i,s=F/i):O<.01?(e=.707106781,i=.707106781,s=0):(s=Math.sqrt(O),e=P/s,i=F/s),this.set(e,i,s,t),this}let m=Math.sqrt((y-_)*(y-_)+(d-v)*(d-v)+(f-p)*(f-p));return Math.abs(m)<.001&&(m=1),this.x=(y-_)/m,this.y=(d-v)/m,this.z=(f-p)/m,this.w=Math.acos((u+g+E-1)/2),this}min(n){return this.x=Math.min(this.x,n.x),this.y=Math.min(this.y,n.y),this.z=Math.min(this.z,n.z),this.w=Math.min(this.w,n.w),this}max(n){return this.x=Math.max(this.x,n.x),this.y=Math.max(this.y,n.y),this.z=Math.max(this.z,n.z),this.w=Math.max(this.w,n.w),this}clamp(n,t){return this.x=Math.max(n.x,Math.min(t.x,this.x)),this.y=Math.max(n.y,Math.min(t.y,this.y)),this.z=Math.max(n.z,Math.min(t.z,this.z)),this.w=Math.max(n.w,Math.min(t.w,this.w)),this}clampScalar(n,t){return this.x=Math.max(n,Math.min(t,this.x)),this.y=Math.max(n,Math.min(t,this.y)),this.z=Math.max(n,Math.min(t,this.z)),this.w=Math.max(n,Math.min(t,this.w)),this}clampLength(n,t){const e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(n,Math.min(t,e)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(n){return this.x*n.x+this.y*n.y+this.z*n.z+this.w*n.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(n){return this.normalize().multiplyScalar(n)}lerp(n,t){return this.x+=(n.x-this.x)*t,this.y+=(n.y-this.y)*t,this.z+=(n.z-this.z)*t,this.w+=(n.w-this.w)*t,this}lerpVectors(n,t,e){return this.x=n.x+(t.x-n.x)*e,this.y=n.y+(t.y-n.y)*e,this.z=n.z+(t.z-n.z)*e,this.w=n.w+(t.w-n.w)*e,this}equals(n){return n.x===this.x&&n.y===this.y&&n.z===this.z&&n.w===this.w}fromArray(n,t=0){return this.x=n[t],this.y=n[t+1],this.z=n[t+2],this.w=n[t+3],this}toArray(n=[],t=0){return n[t]=this.x,n[t+1]=this.y,n[t+2]=this.z,n[t+3]=this.w,n}fromBufferAttribute(n,t,e){return e!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=n.getX(t),this.y=n.getY(t),this.z=n.getZ(t),this.w=n.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}Vector4.prototype.isVector4=!0;class WebGLRenderTarget extends EventDispatcher{constructor(n,t,e){super(),this.width=n,this.height=t,this.depth=1,this.scissor=new Vector4(0,0,n,t),this.scissorTest=!1,this.viewport=new Vector4(0,0,n,t),e=e||{},this.texture=new Texture(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.image={},this.texture.image.width=n,this.texture.image.height=t,this.texture.image.depth=1,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:LinearFilter,this.depthBuffer=e.depthBuffer!==void 0?e.depthBuffer:!0,this.stencilBuffer=e.stencilBuffer!==void 0?e.stencilBuffer:!1,this.depthTexture=e.depthTexture!==void 0?e.depthTexture:null}setTexture(n){n.image={width:this.width,height:this.height,depth:this.depth},this.texture=n}setSize(n,t,e=1){(this.width!==n||this.height!==t||this.depth!==e)&&(this.width=n,this.height=t,this.depth=e,this.texture.image.width=n,this.texture.image.height=t,this.texture.image.depth=e,this.dispose()),this.viewport.set(0,0,n,t),this.scissor.set(0,0,n,t)}clone(){return new this.constructor().copy(this)}copy(n){return this.width=n.width,this.height=n.height,this.depth=n.depth,this.viewport.copy(n.viewport),this.texture=n.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}WebGLRenderTarget.prototype.isWebGLRenderTarget=!0;class WebGLMultipleRenderTargets extends WebGLRenderTarget{constructor(n,t,e){super(n,t);const i=this.texture;this.texture=[];for(let s=0;s<e;s++)this.texture[s]=i.clone()}setSize(n,t,e=1){if(this.width!==n||this.height!==t||this.depth!==e){this.width=n,this.height=t,this.depth=e;for(let i=0,s=this.texture.length;i<s;i++)this.texture[i].image.width=n,this.texture[i].image.height=t,this.texture[i].image.depth=e;this.dispose()}return this.viewport.set(0,0,n,t),this.scissor.set(0,0,n,t),this}copy(n){this.dispose(),this.width=n.width,this.height=n.height,this.depth=n.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.texture.length=0;for(let t=0,e=n.texture.length;t<e;t++)this.texture[t]=n.texture[t].clone();return this}}WebGLMultipleRenderTargets.prototype.isWebGLMultipleRenderTargets=!0;class WebGLMultisampleRenderTarget extends WebGLRenderTarget{constructor(n,t,e){super(n,t,e),this.samples=4}copy(n){return super.copy.call(this,n),this.samples=n.samples,this}}WebGLMultisampleRenderTarget.prototype.isWebGLMultisampleRenderTarget=!0;let Quaternion$1=class{constructor(n=0,t=0,e=0,i=1){this._x=n,this._y=t,this._z=e,this._w=i}static slerp(n,t,e,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),e.slerpQuaternions(n,t,i)}static slerpFlat(n,t,e,i,s,r,o){let h=e[i+0],u=e[i+1],p=e[i+2],d=e[i+3];const f=s[r+0],g=s[r+1],_=s[r+2],v=s[r+3];if(o===0){n[t+0]=h,n[t+1]=u,n[t+2]=p,n[t+3]=d;return}if(o===1){n[t+0]=f,n[t+1]=g,n[t+2]=_,n[t+3]=v;return}if(d!==v||h!==f||u!==g||p!==_){let y=1-o;const E=h*f+u*g+p*_+d*v,m=E>=0?1:-1,x=1-E*E;if(x>Number.EPSILON){const O=Math.sqrt(x),S=Math.atan2(O,E*m);y=Math.sin(y*S)/O,o=Math.sin(o*S)/O}const C=o*m;if(h=h*y+f*C,u=u*y+g*C,p=p*y+_*C,d=d*y+v*C,y===1-o){const O=1/Math.sqrt(h*h+u*u+p*p+d*d);h*=O,u*=O,p*=O,d*=O}}n[t]=h,n[t+1]=u,n[t+2]=p,n[t+3]=d}static multiplyQuaternionsFlat(n,t,e,i,s,r){const o=e[i],h=e[i+1],u=e[i+2],p=e[i+3],d=s[r],f=s[r+1],g=s[r+2],_=s[r+3];return n[t]=o*_+p*d+h*g-u*f,n[t+1]=h*_+p*f+u*d-o*g,n[t+2]=u*_+p*g+o*f-h*d,n[t+3]=p*_-o*d-h*f-u*g,n}get x(){return this._x}set x(n){this._x=n,this._onChangeCallback()}get y(){return this._y}set y(n){this._y=n,this._onChangeCallback()}get z(){return this._z}set z(n){this._z=n,this._onChangeCallback()}get w(){return this._w}set w(n){this._w=n,this._onChangeCallback()}set(n,t,e,i){return this._x=n,this._y=t,this._z=e,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(n){return this._x=n.x,this._y=n.y,this._z=n.z,this._w=n.w,this._onChangeCallback(),this}setFromEuler(n,t){if(!(n&&n.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const e=n._x,i=n._y,s=n._z,r=n._order,o=Math.cos,h=Math.sin,u=o(e/2),p=o(i/2),d=o(s/2),f=h(e/2),g=h(i/2),_=h(s/2);switch(r){case"XYZ":this._x=f*p*d+u*g*_,this._y=u*g*d-f*p*_,this._z=u*p*_+f*g*d,this._w=u*p*d-f*g*_;break;case"YXZ":this._x=f*p*d+u*g*_,this._y=u*g*d-f*p*_,this._z=u*p*_-f*g*d,this._w=u*p*d+f*g*_;break;case"ZXY":this._x=f*p*d-u*g*_,this._y=u*g*d+f*p*_,this._z=u*p*_+f*g*d,this._w=u*p*d-f*g*_;break;case"ZYX":this._x=f*p*d-u*g*_,this._y=u*g*d+f*p*_,this._z=u*p*_-f*g*d,this._w=u*p*d+f*g*_;break;case"YZX":this._x=f*p*d+u*g*_,this._y=u*g*d+f*p*_,this._z=u*p*_-f*g*d,this._w=u*p*d-f*g*_;break;case"XZY":this._x=f*p*d-u*g*_,this._y=u*g*d-f*p*_,this._z=u*p*_+f*g*d,this._w=u*p*d+f*g*_;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(n,t){const e=t/2,i=Math.sin(e);return this._x=n.x*i,this._y=n.y*i,this._z=n.z*i,this._w=Math.cos(e),this._onChangeCallback(),this}setFromRotationMatrix(n){const t=n.elements,e=t[0],i=t[4],s=t[8],r=t[1],o=t[5],h=t[9],u=t[2],p=t[6],d=t[10],f=e+o+d;if(f>0){const g=.5/Math.sqrt(f+1);this._w=.25/g,this._x=(p-h)*g,this._y=(s-u)*g,this._z=(r-i)*g}else if(e>o&&e>d){const g=2*Math.sqrt(1+e-o-d);this._w=(p-h)/g,this._x=.25*g,this._y=(i+r)/g,this._z=(s+u)/g}else if(o>d){const g=2*Math.sqrt(1+o-e-d);this._w=(s-u)/g,this._x=(i+r)/g,this._y=.25*g,this._z=(h+p)/g}else{const g=2*Math.sqrt(1+d-e-o);this._w=(r-i)/g,this._x=(s+u)/g,this._y=(h+p)/g,this._z=.25*g}return this._onChangeCallback(),this}setFromUnitVectors(n,t){let e=n.dot(t)+1;return e<Number.EPSILON?(e=0,Math.abs(n.x)>Math.abs(n.z)?(this._x=-n.y,this._y=n.x,this._z=0,this._w=e):(this._x=0,this._y=-n.z,this._z=n.y,this._w=e)):(this._x=n.y*t.z-n.z*t.y,this._y=n.z*t.x-n.x*t.z,this._z=n.x*t.y-n.y*t.x,this._w=e),this.normalize()}angleTo(n){return 2*Math.acos(Math.abs(clamp(this.dot(n),-1,1)))}rotateTowards(n,t){const e=this.angleTo(n);if(e===0)return this;const i=Math.min(1,t/e);return this.slerp(n,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(n){return this._x*n._x+this._y*n._y+this._z*n._z+this._w*n._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let n=this.length();return n===0?(this._x=0,this._y=0,this._z=0,this._w=1):(n=1/n,this._x=this._x*n,this._y=this._y*n,this._z=this._z*n,this._w=this._w*n),this._onChangeCallback(),this}multiply(n,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(n,t)):this.multiplyQuaternions(this,n)}premultiply(n){return this.multiplyQuaternions(n,this)}multiplyQuaternions(n,t){const e=n._x,i=n._y,s=n._z,r=n._w,o=t._x,h=t._y,u=t._z,p=t._w;return this._x=e*p+r*o+i*u-s*h,this._y=i*p+r*h+s*o-e*u,this._z=s*p+r*u+e*h-i*o,this._w=r*p-e*o-i*h-s*u,this._onChangeCallback(),this}slerp(n,t){if(t===0)return this;if(t===1)return this.copy(n);const e=this._x,i=this._y,s=this._z,r=this._w;let o=r*n._w+e*n._x+i*n._y+s*n._z;if(o<0?(this._w=-n._w,this._x=-n._x,this._y=-n._y,this._z=-n._z,o=-o):this.copy(n),o>=1)return this._w=r,this._x=e,this._y=i,this._z=s,this;const h=1-o*o;if(h<=Number.EPSILON){const g=1-t;return this._w=g*r+t*this._w,this._x=g*e+t*this._x,this._y=g*i+t*this._y,this._z=g*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const u=Math.sqrt(h),p=Math.atan2(u,o),d=Math.sin((1-t)*p)/u,f=Math.sin(t*p)/u;return this._w=r*d+this._w*f,this._x=e*d+this._x*f,this._y=i*d+this._y*f,this._z=s*d+this._z*f,this._onChangeCallback(),this}slerpQuaternions(n,t,e){this.copy(n).slerp(t,e)}equals(n){return n._x===this._x&&n._y===this._y&&n._z===this._z&&n._w===this._w}fromArray(n,t=0){return this._x=n[t],this._y=n[t+1],this._z=n[t+2],this._w=n[t+3],this._onChangeCallback(),this}toArray(n=[],t=0){return n[t]=this._x,n[t+1]=this._y,n[t+2]=this._z,n[t+3]=this._w,n}fromBufferAttribute(n,t){return this._x=n.getX(t),this._y=n.getY(t),this._z=n.getZ(t),this._w=n.getW(t),this}_onChange(n){return this._onChangeCallback=n,this}_onChangeCallback(){}};Quaternion$1.prototype.isQuaternion=!0;class Vector3{constructor(n=0,t=0,e=0){this.x=n,this.y=t,this.z=e}set(n,t,e){return e===void 0&&(e=this.z),this.x=n,this.y=t,this.z=e,this}setScalar(n){return this.x=n,this.y=n,this.z=n,this}setX(n){return this.x=n,this}setY(n){return this.y=n,this}setZ(n){return this.z=n,this}setComponent(n,t){switch(n){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+n)}return this}getComponent(n){switch(n){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+n)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(n){return this.x=n.x,this.y=n.y,this.z=n.z,this}add(n,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(n,t)):(this.x+=n.x,this.y+=n.y,this.z+=n.z,this)}addScalar(n){return this.x+=n,this.y+=n,this.z+=n,this}addVectors(n,t){return this.x=n.x+t.x,this.y=n.y+t.y,this.z=n.z+t.z,this}addScaledVector(n,t){return this.x+=n.x*t,this.y+=n.y*t,this.z+=n.z*t,this}sub(n,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(n,t)):(this.x-=n.x,this.y-=n.y,this.z-=n.z,this)}subScalar(n){return this.x-=n,this.y-=n,this.z-=n,this}subVectors(n,t){return this.x=n.x-t.x,this.y=n.y-t.y,this.z=n.z-t.z,this}multiply(n,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(n,t)):(this.x*=n.x,this.y*=n.y,this.z*=n.z,this)}multiplyScalar(n){return this.x*=n,this.y*=n,this.z*=n,this}multiplyVectors(n,t){return this.x=n.x*t.x,this.y=n.y*t.y,this.z=n.z*t.z,this}applyEuler(n){return n&&n.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(_quaternion$4.setFromEuler(n))}applyAxisAngle(n,t){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(n,t))}applyMatrix3(n){const t=this.x,e=this.y,i=this.z,s=n.elements;return this.x=s[0]*t+s[3]*e+s[6]*i,this.y=s[1]*t+s[4]*e+s[7]*i,this.z=s[2]*t+s[5]*e+s[8]*i,this}applyNormalMatrix(n){return this.applyMatrix3(n).normalize()}applyMatrix4(n){const t=this.x,e=this.y,i=this.z,s=n.elements,r=1/(s[3]*t+s[7]*e+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*e+s[8]*i+s[12])*r,this.y=(s[1]*t+s[5]*e+s[9]*i+s[13])*r,this.z=(s[2]*t+s[6]*e+s[10]*i+s[14])*r,this}applyQuaternion(n){const t=this.x,e=this.y,i=this.z,s=n.x,r=n.y,o=n.z,h=n.w,u=h*t+r*i-o*e,p=h*e+o*t-s*i,d=h*i+s*e-r*t,f=-s*t-r*e-o*i;return this.x=u*h+f*-s+p*-o-d*-r,this.y=p*h+f*-r+d*-s-u*-o,this.z=d*h+f*-o+u*-r-p*-s,this}project(n){return this.applyMatrix4(n.matrixWorldInverse).applyMatrix4(n.projectionMatrix)}unproject(n){return this.applyMatrix4(n.projectionMatrixInverse).applyMatrix4(n.matrixWorld)}transformDirection(n){const t=this.x,e=this.y,i=this.z,s=n.elements;return this.x=s[0]*t+s[4]*e+s[8]*i,this.y=s[1]*t+s[5]*e+s[9]*i,this.z=s[2]*t+s[6]*e+s[10]*i,this.normalize()}divide(n){return this.x/=n.x,this.y/=n.y,this.z/=n.z,this}divideScalar(n){return this.multiplyScalar(1/n)}min(n){return this.x=Math.min(this.x,n.x),this.y=Math.min(this.y,n.y),this.z=Math.min(this.z,n.z),this}max(n){return this.x=Math.max(this.x,n.x),this.y=Math.max(this.y,n.y),this.z=Math.max(this.z,n.z),this}clamp(n,t){return this.x=Math.max(n.x,Math.min(t.x,this.x)),this.y=Math.max(n.y,Math.min(t.y,this.y)),this.z=Math.max(n.z,Math.min(t.z,this.z)),this}clampScalar(n,t){return this.x=Math.max(n,Math.min(t,this.x)),this.y=Math.max(n,Math.min(t,this.y)),this.z=Math.max(n,Math.min(t,this.z)),this}clampLength(n,t){const e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(n,Math.min(t,e)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(n){return this.x*n.x+this.y*n.y+this.z*n.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(n){return this.normalize().multiplyScalar(n)}lerp(n,t){return this.x+=(n.x-this.x)*t,this.y+=(n.y-this.y)*t,this.z+=(n.z-this.z)*t,this}lerpVectors(n,t,e){return this.x=n.x+(t.x-n.x)*e,this.y=n.y+(t.y-n.y)*e,this.z=n.z+(t.z-n.z)*e,this}cross(n,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(n,t)):this.crossVectors(this,n)}crossVectors(n,t){const e=n.x,i=n.y,s=n.z,r=t.x,o=t.y,h=t.z;return this.x=i*h-s*o,this.y=s*r-e*h,this.z=e*o-i*r,this}projectOnVector(n){const t=n.lengthSq();if(t===0)return this.set(0,0,0);const e=n.dot(this)/t;return this.copy(n).multiplyScalar(e)}projectOnPlane(n){return _vector$c.copy(this).projectOnVector(n),this.sub(_vector$c)}reflect(n){return this.sub(_vector$c.copy(n).multiplyScalar(2*this.dot(n)))}angleTo(n){const t=Math.sqrt(this.lengthSq()*n.lengthSq());if(t===0)return Math.PI/2;const e=this.dot(n)/t;return Math.acos(clamp(e,-1,1))}distanceTo(n){return Math.sqrt(this.distanceToSquared(n))}distanceToSquared(n){const t=this.x-n.x,e=this.y-n.y,i=this.z-n.z;return t*t+e*e+i*i}manhattanDistanceTo(n){return Math.abs(this.x-n.x)+Math.abs(this.y-n.y)+Math.abs(this.z-n.z)}setFromSpherical(n){return this.setFromSphericalCoords(n.radius,n.phi,n.theta)}setFromSphericalCoords(n,t,e){const i=Math.sin(t)*n;return this.x=i*Math.sin(e),this.y=Math.cos(t)*n,this.z=i*Math.cos(e),this}setFromCylindrical(n){return this.setFromCylindricalCoords(n.radius,n.theta,n.y)}setFromCylindricalCoords(n,t,e){return this.x=n*Math.sin(t),this.y=e,this.z=n*Math.cos(t),this}setFromMatrixPosition(n){const t=n.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(n){const t=this.setFromMatrixColumn(n,0).length(),e=this.setFromMatrixColumn(n,1).length(),i=this.setFromMatrixColumn(n,2).length();return this.x=t,this.y=e,this.z=i,this}setFromMatrixColumn(n,t){return this.fromArray(n.elements,t*4)}setFromMatrix3Column(n,t){return this.fromArray(n.elements,t*3)}equals(n){return n.x===this.x&&n.y===this.y&&n.z===this.z}fromArray(n,t=0){return this.x=n[t],this.y=n[t+1],this.z=n[t+2],this}toArray(n=[],t=0){return n[t]=this.x,n[t+1]=this.y,n[t+2]=this.z,n}fromBufferAttribute(n,t,e){return e!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=n.getX(t),this.y=n.getY(t),this.z=n.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}Vector3.prototype.isVector3=!0;const _vector$c=new Vector3,_quaternion$4=new Quaternion$1;class Box3{constructor(n=new Vector3(1/0,1/0,1/0),t=new Vector3(-1/0,-1/0,-1/0)){this.min=n,this.max=t}set(n,t){return this.min.copy(n),this.max.copy(t),this}setFromArray(n){let t=1/0,e=1/0,i=1/0,s=-1/0,r=-1/0,o=-1/0;for(let h=0,u=n.length;h<u;h+=3){const p=n[h],d=n[h+1],f=n[h+2];p<t&&(t=p),d<e&&(e=d),f<i&&(i=f),p>s&&(s=p),d>r&&(r=d),f>o&&(o=f)}return this.min.set(t,e,i),this.max.set(s,r,o),this}setFromBufferAttribute(n){let t=1/0,e=1/0,i=1/0,s=-1/0,r=-1/0,o=-1/0;for(let h=0,u=n.count;h<u;h++){const p=n.getX(h),d=n.getY(h),f=n.getZ(h);p<t&&(t=p),d<e&&(e=d),f<i&&(i=f),p>s&&(s=p),d>r&&(r=d),f>o&&(o=f)}return this.min.set(t,e,i),this.max.set(s,r,o),this}setFromPoints(n){this.makeEmpty();for(let t=0,e=n.length;t<e;t++)this.expandByPoint(n[t]);return this}setFromCenterAndSize(n,t){const e=_vector$b.copy(t).multiplyScalar(.5);return this.min.copy(n).sub(e),this.max.copy(n).add(e),this}setFromObject(n){return this.makeEmpty(),this.expandByObject(n)}clone(){return new this.constructor().copy(this)}copy(n){return this.min.copy(n.min),this.max.copy(n.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(n){return n===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),n=new Vector3),this.isEmpty()?n.set(0,0,0):n.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(n){return n===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),n=new Vector3),this.isEmpty()?n.set(0,0,0):n.subVectors(this.max,this.min)}expandByPoint(n){return this.min.min(n),this.max.max(n),this}expandByVector(n){return this.min.sub(n),this.max.add(n),this}expandByScalar(n){return this.min.addScalar(-n),this.max.addScalar(n),this}expandByObject(n){n.updateWorldMatrix(!1,!1);const t=n.geometry;t!==void 0&&(t.boundingBox===null&&t.computeBoundingBox(),_box$3.copy(t.boundingBox),_box$3.applyMatrix4(n.matrixWorld),this.union(_box$3));const e=n.children;for(let i=0,s=e.length;i<s;i++)this.expandByObject(e[i]);return this}containsPoint(n){return!(n.x<this.min.x||n.x>this.max.x||n.y<this.min.y||n.y>this.max.y||n.z<this.min.z||n.z>this.max.z)}containsBox(n){return this.min.x<=n.min.x&&n.max.x<=this.max.x&&this.min.y<=n.min.y&&n.max.y<=this.max.y&&this.min.z<=n.min.z&&n.max.z<=this.max.z}getParameter(n,t){return t===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Vector3),t.set((n.x-this.min.x)/(this.max.x-this.min.x),(n.y-this.min.y)/(this.max.y-this.min.y),(n.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(n){return!(n.max.x<this.min.x||n.min.x>this.max.x||n.max.y<this.min.y||n.min.y>this.max.y||n.max.z<this.min.z||n.min.z>this.max.z)}intersectsSphere(n){return this.clampPoint(n.center,_vector$b),_vector$b.distanceToSquared(n.center)<=n.radius*n.radius}intersectsPlane(n){let t,e;return n.normal.x>0?(t=n.normal.x*this.min.x,e=n.normal.x*this.max.x):(t=n.normal.x*this.max.x,e=n.normal.x*this.min.x),n.normal.y>0?(t+=n.normal.y*this.min.y,e+=n.normal.y*this.max.y):(t+=n.normal.y*this.max.y,e+=n.normal.y*this.min.y),n.normal.z>0?(t+=n.normal.z*this.min.z,e+=n.normal.z*this.max.z):(t+=n.normal.z*this.max.z,e+=n.normal.z*this.min.z),t<=-n.constant&&e>=-n.constant}intersectsTriangle(n){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$2.subVectors(n.a,_center),_v1$7.subVectors(n.b,_center),_v2$3.subVectors(n.c,_center),_f0.subVectors(_v1$7,_v0$2),_f1.subVectors(_v2$3,_v1$7),_f2.subVectors(_v0$2,_v2$3);let t=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!satForAxes(t,_v0$2,_v1$7,_v2$3,_extents)||(t=[1,0,0,0,1,0,0,0,1],!satForAxes(t,_v0$2,_v1$7,_v2$3,_extents))?!1:(_triangleNormal.crossVectors(_f0,_f1),t=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(t,_v0$2,_v1$7,_v2$3,_extents))}clampPoint(n,t){return t===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Vector3),t.copy(n).clamp(this.min,this.max)}distanceToPoint(n){return _vector$b.copy(n).clamp(this.min,this.max).sub(n).length()}getBoundingSphere(n){return n===void 0&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(n.center),n.radius=this.getSize(_vector$b).length()*.5,n}intersect(n){return this.min.max(n.min),this.max.min(n.max),this.isEmpty()&&this.makeEmpty(),this}union(n){return this.min.min(n.min),this.max.max(n.max),this}applyMatrix4(n){return this.isEmpty()?this:(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(n),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(n),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(n),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(n),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(n),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(n),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(n),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(n),this.setFromPoints(_points),this)}translate(n){return this.min.add(n),this.max.add(n),this}equals(n){return n.min.equals(this.min)&&n.max.equals(this.max)}}Box3.prototype.isBox3=!0;const _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$b=new Vector3,_box$3=new Box3,_v0$2=new Vector3,_v1$7=new Vector3,_v2$3=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function satForAxes(l,n,t,e,i){for(let s=0,r=l.length-3;s<=r;s+=3){_testAxis.fromArray(l,s);const o=i.x*Math.abs(_testAxis.x)+i.y*Math.abs(_testAxis.y)+i.z*Math.abs(_testAxis.z),h=n.dot(_testAxis),u=t.dot(_testAxis),p=e.dot(_testAxis);if(Math.max(-Math.max(h,u,p),Math.min(h,u,p))>o)return!1}return!0}const _box$2=new Box3,_v1$6=new Vector3,_toFarthestPoint=new Vector3,_toPoint=new Vector3;let Sphere$1=class{constructor(n=new Vector3,t=-1){this.center=n,this.radius=t}set(n,t){return this.center.copy(n),this.radius=t,this}setFromPoints(n,t){const e=this.center;t!==void 0?e.copy(t):_box$2.setFromPoints(n).getCenter(e);let i=0;for(let s=0,r=n.length;s<r;s++)i=Math.max(i,e.distanceToSquared(n[s]));return this.radius=Math.sqrt(i),this}copy(n){return this.center.copy(n.center),this.radius=n.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(n){return n.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(n){return n.distanceTo(this.center)-this.radius}intersectsSphere(n){const t=this.radius+n.radius;return n.center.distanceToSquared(this.center)<=t*t}intersectsBox(n){return n.intersectsSphere(this)}intersectsPlane(n){return Math.abs(n.distanceToPoint(this.center))<=this.radius}clampPoint(n,t){const e=this.center.distanceToSquared(n);return t===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Vector3),t.copy(n),e>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(n){return n===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),n=new Box3),this.isEmpty()?(n.makeEmpty(),n):(n.set(this.center,this.center),n.expandByScalar(this.radius),n)}applyMatrix4(n){return this.center.applyMatrix4(n),this.radius=this.radius*n.getMaxScaleOnAxis(),this}translate(n){return this.center.add(n),this}expandByPoint(n){_toPoint.subVectors(n,this.center);const t=_toPoint.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),i=(e-this.radius)*.5;this.center.add(_toPoint.multiplyScalar(i/e)),this.radius+=i}return this}union(n){return _toFarthestPoint.subVectors(n.center,this.center).normalize().multiplyScalar(n.radius),this.expandByPoint(_v1$6.copy(n.center).add(_toFarthestPoint)),this.expandByPoint(_v1$6.copy(n.center).sub(_toFarthestPoint)),this}equals(n){return n.center.equals(this.center)&&n.radius===this.radius}clone(){return new this.constructor().copy(this)}};const _vector$a=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal$1=new Vector3;let Ray$1=class{constructor(n=new Vector3,t=new Vector3(0,0,-1)){this.origin=n,this.direction=t}set(n,t){return this.origin.copy(n),this.direction.copy(t),this}copy(n){return this.origin.copy(n.origin),this.direction.copy(n.direction),this}at(n,t){return t===void 0&&(console.warn("THREE.Ray: .at() target is now required"),t=new Vector3),t.copy(this.direction).multiplyScalar(n).add(this.origin)}lookAt(n){return this.direction.copy(n).sub(this.origin).normalize(),this}recast(n){return this.origin.copy(this.at(n,_vector$a)),this}closestPointToPoint(n,t){t===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Vector3),t.subVectors(n,this.origin);const e=t.dot(this.direction);return e<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(e).add(this.origin)}distanceToPoint(n){return Math.sqrt(this.distanceSqToPoint(n))}distanceSqToPoint(n){const t=_vector$a.subVectors(n,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(n):(_vector$a.copy(this.direction).multiplyScalar(t).add(this.origin),_vector$a.distanceToSquared(n))}distanceSqToSegment(n,t,e,i){_segCenter.copy(n).add(t).multiplyScalar(.5),_segDir.copy(t).sub(n).normalize(),_diff.copy(this.origin).sub(_segCenter);const s=n.distanceTo(t)*.5,r=-this.direction.dot(_segDir),o=_diff.dot(this.direction),h=-_diff.dot(_segDir),u=_diff.lengthSq(),p=Math.abs(1-r*r);let d,f,g,_;if(p>0)if(d=r*h-o,f=r*o-h,_=s*p,d>=0)if(f>=-_)if(f<=_){const v=1/p;d*=v,f*=v,g=d*(d+r*f+2*o)+f*(r*d+f+2*h)+u}else f=s,d=Math.max(0,-(r*f+o)),g=-d*d+f*(f+2*h)+u;else f=-s,d=Math.max(0,-(r*f+o)),g=-d*d+f*(f+2*h)+u;else f<=-_?(d=Math.max(0,-(-r*s+o)),f=d>0?-s:Math.min(Math.max(-s,-h),s),g=-d*d+f*(f+2*h)+u):f<=_?(d=0,f=Math.min(Math.max(-s,-h),s),g=f*(f+2*h)+u):(d=Math.max(0,-(r*s+o)),f=d>0?s:Math.min(Math.max(-s,-h),s),g=-d*d+f*(f+2*h)+u);else f=r>0?-s:s,d=Math.max(0,-(r*f+o)),g=-d*d+f*(f+2*h)+u;return e&&e.copy(this.direction).multiplyScalar(d).add(this.origin),i&&i.copy(_segDir).multiplyScalar(f).add(_segCenter),g}intersectSphere(n,t){_vector$a.subVectors(n.center,this.origin);const e=_vector$a.dot(this.direction),i=_vector$a.dot(_vector$a)-e*e,s=n.radius*n.radius;if(i>s)return null;const r=Math.sqrt(s-i),o=e-r,h=e+r;return o<0&&h<0?null:o<0?this.at(h,t):this.at(o,t)}intersectsSphere(n){return this.distanceSqToPoint(n.center)<=n.radius*n.radius}distanceToPlane(n){const t=n.normal.dot(this.direction);if(t===0)return n.distanceToPoint(this.origin)===0?0:null;const e=-(this.origin.dot(n.normal)+n.constant)/t;return e>=0?e:null}intersectPlane(n,t){const e=this.distanceToPlane(n);return e===null?null:this.at(e,t)}intersectsPlane(n){const t=n.distanceToPoint(this.origin);return t===0||n.normal.dot(this.direction)*t<0}intersectBox(n,t){let e,i,s,r,o,h;const u=1/this.direction.x,p=1/this.direction.y,d=1/this.direction.z,f=this.origin;return u>=0?(e=(n.min.x-f.x)*u,i=(n.max.x-f.x)*u):(e=(n.max.x-f.x)*u,i=(n.min.x-f.x)*u),p>=0?(s=(n.min.y-f.y)*p,r=(n.max.y-f.y)*p):(s=(n.max.y-f.y)*p,r=(n.min.y-f.y)*p),e>r||s>i||((s>e||e!==e)&&(e=s),(r<i||i!==i)&&(i=r),d>=0?(o=(n.min.z-f.z)*d,h=(n.max.z-f.z)*d):(o=(n.max.z-f.z)*d,h=(n.min.z-f.z)*d),e>h||o>i)||((o>e||e!==e)&&(e=o),(h<i||i!==i)&&(i=h),i<0)?null:this.at(e>=0?e:i,t)}intersectsBox(n){return this.intersectBox(n,_vector$a)!==null}intersectTriangle(n,t,e,i,s){_edge1.subVectors(t,n),_edge2.subVectors(e,n),_normal$1.crossVectors(_edge1,_edge2);let r=this.direction.dot(_normal$1),o;if(r>0){if(i)return null;o=1}else if(r<0)o=-1,r=-r;else return null;_diff.subVectors(this.origin,n);const h=o*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(h<0)return null;const u=o*this.direction.dot(_edge1.cross(_diff));if(u<0||h+u>r)return null;const p=-o*_diff.dot(_normal$1);return p<0?null:this.at(p/r,s)}applyMatrix4(n){return this.origin.applyMatrix4(n),this.direction.transformDirection(n),this}equals(n){return n.origin.equals(this.origin)&&n.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};class Matrix4{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(n,t,e,i,s,r,o,h,u,p,d,f,g,_,v,y){const E=this.elements;return E[0]=n,E[4]=t,E[8]=e,E[12]=i,E[1]=s,E[5]=r,E[9]=o,E[13]=h,E[2]=u,E[6]=p,E[10]=d,E[14]=f,E[3]=g,E[7]=_,E[11]=v,E[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Matrix4().fromArray(this.elements)}copy(n){const t=this.elements,e=n.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],this}copyPosition(n){const t=this.elements,e=n.elements;return t[12]=e[12],t[13]=e[13],t[14]=e[14],this}setFromMatrix3(n){const t=n.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(n,t,e){return n.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),e.setFromMatrixColumn(this,2),this}makeBasis(n,t,e){return this.set(n.x,t.x,e.x,0,n.y,t.y,e.y,0,n.z,t.z,e.z,0,0,0,0,1),this}extractRotation(n){const t=this.elements,e=n.elements,i=1/_v1$5.setFromMatrixColumn(n,0).length(),s=1/_v1$5.setFromMatrixColumn(n,1).length(),r=1/_v1$5.setFromMatrixColumn(n,2).length();return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=0,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=0,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(n){n&&n.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,e=n.x,i=n.y,s=n.z,r=Math.cos(e),o=Math.sin(e),h=Math.cos(i),u=Math.sin(i),p=Math.cos(s),d=Math.sin(s);if(n.order==="XYZ"){const f=r*p,g=r*d,_=o*p,v=o*d;t[0]=h*p,t[4]=-h*d,t[8]=u,t[1]=g+_*u,t[5]=f-v*u,t[9]=-o*h,t[2]=v-f*u,t[6]=_+g*u,t[10]=r*h}else if(n.order==="YXZ"){const f=h*p,g=h*d,_=u*p,v=u*d;t[0]=f+v*o,t[4]=_*o-g,t[8]=r*u,t[1]=r*d,t[5]=r*p,t[9]=-o,t[2]=g*o-_,t[6]=v+f*o,t[10]=r*h}else if(n.order==="ZXY"){const f=h*p,g=h*d,_=u*p,v=u*d;t[0]=f-v*o,t[4]=-r*d,t[8]=_+g*o,t[1]=g+_*o,t[5]=r*p,t[9]=v-f*o,t[2]=-r*u,t[6]=o,t[10]=r*h}else if(n.order==="ZYX"){const f=r*p,g=r*d,_=o*p,v=o*d;t[0]=h*p,t[4]=_*u-g,t[8]=f*u+v,t[1]=h*d,t[5]=v*u+f,t[9]=g*u-_,t[2]=-u,t[6]=o*h,t[10]=r*h}else if(n.order==="YZX"){const f=r*h,g=r*u,_=o*h,v=o*u;t[0]=h*p,t[4]=v-f*d,t[8]=_*d+g,t[1]=d,t[5]=r*p,t[9]=-o*p,t[2]=-u*p,t[6]=g*d+_,t[10]=f-v*d}else if(n.order==="XZY"){const f=r*h,g=r*u,_=o*h,v=o*u;t[0]=h*p,t[4]=-d,t[8]=u*p,t[1]=f*d+v,t[5]=r*p,t[9]=g*d-_,t[2]=_*d-g,t[6]=o*p,t[10]=v*d+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(n){return this.compose(_zero,n,_one)}lookAt(n,t,e){const i=this.elements;return _z.subVectors(n,t),_z.lengthSq()===0&&(_z.z=1),_z.normalize(),_x.crossVectors(e,_z),_x.lengthSq()===0&&(Math.abs(e.z)===1?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(e,_z)),_x.normalize(),_y.crossVectors(_z,_x),i[0]=_x.x,i[4]=_y.x,i[8]=_z.x,i[1]=_x.y,i[5]=_y.y,i[9]=_z.y,i[2]=_x.z,i[6]=_y.z,i[10]=_z.z,this}multiply(n,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(n,t)):this.multiplyMatrices(this,n)}premultiply(n){return this.multiplyMatrices(n,this)}multiplyMatrices(n,t){const e=n.elements,i=t.elements,s=this.elements,r=e[0],o=e[4],h=e[8],u=e[12],p=e[1],d=e[5],f=e[9],g=e[13],_=e[2],v=e[6],y=e[10],E=e[14],m=e[3],x=e[7],C=e[11],O=e[15],S=i[0],P=i[4],F=i[8],V=i[12],N=i[1],B=i[5],W=i[9],A=i[13],G=i[2],D=i[6],M=i[10],J=i[14],et=i[3],Q=i[7],ot=i[11],tt=i[15];return s[0]=r*S+o*N+h*G+u*et,s[4]=r*P+o*B+h*D+u*Q,s[8]=r*F+o*W+h*M+u*ot,s[12]=r*V+o*A+h*J+u*tt,s[1]=p*S+d*N+f*G+g*et,s[5]=p*P+d*B+f*D+g*Q,s[9]=p*F+d*W+f*M+g*ot,s[13]=p*V+d*A+f*J+g*tt,s[2]=_*S+v*N+y*G+E*et,s[6]=_*P+v*B+y*D+E*Q,s[10]=_*F+v*W+y*M+E*ot,s[14]=_*V+v*A+y*J+E*tt,s[3]=m*S+x*N+C*G+O*et,s[7]=m*P+x*B+C*D+O*Q,s[11]=m*F+x*W+C*M+O*ot,s[15]=m*V+x*A+C*J+O*tt,this}multiplyScalar(n){const t=this.elements;return t[0]*=n,t[4]*=n,t[8]*=n,t[12]*=n,t[1]*=n,t[5]*=n,t[9]*=n,t[13]*=n,t[2]*=n,t[6]*=n,t[10]*=n,t[14]*=n,t[3]*=n,t[7]*=n,t[11]*=n,t[15]*=n,this}determinant(){const n=this.elements,t=n[0],e=n[4],i=n[8],s=n[12],r=n[1],o=n[5],h=n[9],u=n[13],p=n[2],d=n[6],f=n[10],g=n[14],_=n[3],v=n[7],y=n[11],E=n[15];return _*(+s*h*d-i*u*d-s*o*f+e*u*f+i*o*g-e*h*g)+v*(+t*h*g-t*u*f+s*r*f-i*r*g+i*u*p-s*h*p)+y*(+t*u*d-t*o*g-s*r*d+e*r*g+s*o*p-e*u*p)+E*(-i*o*p-t*h*d+t*o*f+i*r*d-e*r*f+e*h*p)}transpose(){const n=this.elements;let t;return t=n[1],n[1]=n[4],n[4]=t,t=n[2],n[2]=n[8],n[8]=t,t=n[6],n[6]=n[9],n[9]=t,t=n[3],n[3]=n[12],n[12]=t,t=n[7],n[7]=n[13],n[13]=t,t=n[11],n[11]=n[14],n[14]=t,this}setPosition(n,t,e){const i=this.elements;return n.isVector3?(i[12]=n.x,i[13]=n.y,i[14]=n.z):(i[12]=n,i[13]=t,i[14]=e),this}invert(){const n=this.elements,t=n[0],e=n[1],i=n[2],s=n[3],r=n[4],o=n[5],h=n[6],u=n[7],p=n[8],d=n[9],f=n[10],g=n[11],_=n[12],v=n[13],y=n[14],E=n[15],m=d*y*u-v*f*u+v*h*g-o*y*g-d*h*E+o*f*E,x=_*f*u-p*y*u-_*h*g+r*y*g+p*h*E-r*f*E,C=p*v*u-_*d*u+_*o*g-r*v*g-p*o*E+r*d*E,O=_*d*h-p*v*h-_*o*f+r*v*f+p*o*y-r*d*y,S=t*m+e*x+i*C+s*O;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const P=1/S;return n[0]=m*P,n[1]=(v*f*s-d*y*s-v*i*g+e*y*g+d*i*E-e*f*E)*P,n[2]=(o*y*s-v*h*s+v*i*u-e*y*u-o*i*E+e*h*E)*P,n[3]=(d*h*s-o*f*s-d*i*u+e*f*u+o*i*g-e*h*g)*P,n[4]=x*P,n[5]=(p*y*s-_*f*s+_*i*g-t*y*g-p*i*E+t*f*E)*P,n[6]=(_*h*s-r*y*s-_*i*u+t*y*u+r*i*E-t*h*E)*P,n[7]=(r*f*s-p*h*s+p*i*u-t*f*u-r*i*g+t*h*g)*P,n[8]=C*P,n[9]=(_*d*s-p*v*s-_*e*g+t*v*g+p*e*E-t*d*E)*P,n[10]=(r*v*s-_*o*s+_*e*u-t*v*u-r*e*E+t*o*E)*P,n[11]=(p*o*s-r*d*s-p*e*u+t*d*u+r*e*g-t*o*g)*P,n[12]=O*P,n[13]=(p*v*i-_*d*i+_*e*f-t*v*f-p*e*y+t*d*y)*P,n[14]=(_*o*i-r*v*i-_*e*h+t*v*h+r*e*y-t*o*y)*P,n[15]=(r*d*i-p*o*i+p*e*h-t*d*h-r*e*f+t*o*f)*P,this}scale(n){const t=this.elements,e=n.x,i=n.y,s=n.z;return t[0]*=e,t[4]*=i,t[8]*=s,t[1]*=e,t[5]*=i,t[9]*=s,t[2]*=e,t[6]*=i,t[10]*=s,t[3]*=e,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const n=this.elements,t=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],e=n[4]*n[4]+n[5]*n[5]+n[6]*n[6],i=n[8]*n[8]+n[9]*n[9]+n[10]*n[10];return Math.sqrt(Math.max(t,e,i))}makeTranslation(n,t,e){return this.set(1,0,0,n,0,1,0,t,0,0,1,e,0,0,0,1),this}makeRotationX(n){const t=Math.cos(n),e=Math.sin(n);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this}makeRotationY(n){const t=Math.cos(n),e=Math.sin(n);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this}makeRotationZ(n){const t=Math.cos(n),e=Math.sin(n);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(n,t){const e=Math.cos(t),i=Math.sin(t),s=1-e,r=n.x,o=n.y,h=n.z,u=s*r,p=s*o;return this.set(u*r+e,u*o-i*h,u*h+i*o,0,u*o+i*h,p*o+e,p*h-i*r,0,u*h-i*o,p*h+i*r,s*h*h+e,0,0,0,0,1),this}makeScale(n,t,e){return this.set(n,0,0,0,0,t,0,0,0,0,e,0,0,0,0,1),this}makeShear(n,t,e,i,s,r){return this.set(1,e,s,0,n,1,r,0,t,i,1,0,0,0,0,1),this}compose(n,t,e){const i=this.elements,s=t._x,r=t._y,o=t._z,h=t._w,u=s+s,p=r+r,d=o+o,f=s*u,g=s*p,_=s*d,v=r*p,y=r*d,E=o*d,m=h*u,x=h*p,C=h*d,O=e.x,S=e.y,P=e.z;return i[0]=(1-(v+E))*O,i[1]=(g+C)*O,i[2]=(_-x)*O,i[3]=0,i[4]=(g-C)*S,i[5]=(1-(f+E))*S,i[6]=(y+m)*S,i[7]=0,i[8]=(_+x)*P,i[9]=(y-m)*P,i[10]=(1-(f+v))*P,i[11]=0,i[12]=n.x,i[13]=n.y,i[14]=n.z,i[15]=1,this}decompose(n,t,e){const i=this.elements;let s=_v1$5.set(i[0],i[1],i[2]).length();const r=_v1$5.set(i[4],i[5],i[6]).length(),o=_v1$5.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),n.x=i[12],n.y=i[13],n.z=i[14],_m1$2.copy(this);const u=1/s,p=1/r,d=1/o;return _m1$2.elements[0]*=u,_m1$2.elements[1]*=u,_m1$2.elements[2]*=u,_m1$2.elements[4]*=p,_m1$2.elements[5]*=p,_m1$2.elements[6]*=p,_m1$2.elements[8]*=d,_m1$2.elements[9]*=d,_m1$2.elements[10]*=d,t.setFromRotationMatrix(_m1$2),e.x=s,e.y=r,e.z=o,this}makePerspective(n,t,e,i,s,r){r===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,h=2*s/(t-n),u=2*s/(e-i),p=(t+n)/(t-n),d=(e+i)/(e-i),f=-(r+s)/(r-s),g=-2*r*s/(r-s);return o[0]=h,o[4]=0,o[8]=p,o[12]=0,o[1]=0,o[5]=u,o[9]=d,o[13]=0,o[2]=0,o[6]=0,o[10]=f,o[14]=g,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(n,t,e,i,s,r){const o=this.elements,h=1/(t-n),u=1/(e-i),p=1/(r-s),d=(t+n)*h,f=(e+i)*u,g=(r+s)*p;return o[0]=2*h,o[4]=0,o[8]=0,o[12]=-d,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-f,o[2]=0,o[6]=0,o[10]=-2*p,o[14]=-g,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(n){const t=this.elements,e=n.elements;for(let i=0;i<16;i++)if(t[i]!==e[i])return!1;return!0}fromArray(n,t=0){for(let e=0;e<16;e++)this.elements[e]=n[e+t];return this}toArray(n=[],t=0){const e=this.elements;return n[t]=e[0],n[t+1]=e[1],n[t+2]=e[2],n[t+3]=e[3],n[t+4]=e[4],n[t+5]=e[5],n[t+6]=e[6],n[t+7]=e[7],n[t+8]=e[8],n[t+9]=e[9],n[t+10]=e[10],n[t+11]=e[11],n[t+12]=e[12],n[t+13]=e[13],n[t+14]=e[14],n[t+15]=e[15],n}}Matrix4.prototype.isMatrix4=!0;const _v1$5=new Vector3,_m1$2=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3,_matrix$1=new Matrix4,_quaternion$3=new Quaternion$1;class Euler{constructor(n=0,t=0,e=0,i=Euler.DefaultOrder){this._x=n,this._y=t,this._z=e,this._order=i}get x(){return this._x}set x(n){this._x=n,this._onChangeCallback()}get y(){return this._y}set y(n){this._y=n,this._onChangeCallback()}get z(){return this._z}set z(n){this._z=n,this._onChangeCallback()}get order(){return this._order}set order(n){this._order=n,this._onChangeCallback()}set(n,t,e,i){return this._x=n,this._y=t,this._z=e,this._order=i||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(n){return this._x=n._x,this._y=n._y,this._z=n._z,this._order=n._order,this._onChangeCallback(),this}setFromRotationMatrix(n,t,e){const i=n.elements,s=i[0],r=i[4],o=i[8],h=i[1],u=i[5],p=i[9],d=i[2],f=i[6],g=i[10];switch(t=t||this._order,t){case"XYZ":this._y=Math.asin(clamp(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-p,g),this._z=Math.atan2(-r,s)):(this._x=Math.atan2(f,u),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(o,g),this._z=Math.atan2(h,u)):(this._y=Math.atan2(-d,s),this._z=0);break;case"ZXY":this._x=Math.asin(clamp(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,g),this._z=Math.atan2(-r,u)):(this._y=0,this._z=Math.atan2(h,s));break;case"ZYX":this._y=Math.asin(-clamp(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,g),this._z=Math.atan2(h,s)):(this._x=0,this._z=Math.atan2(-r,u));break;case"YZX":this._z=Math.asin(clamp(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-p,u),this._y=Math.atan2(-d,s)):(this._x=0,this._y=Math.atan2(o,g));break;case"XZY":this._z=Math.asin(-clamp(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(f,u),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-p,g),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,e!==!1&&this._onChangeCallback(),this}setFromQuaternion(n,t,e){return _matrix$1.makeRotationFromQuaternion(n),this.setFromRotationMatrix(_matrix$1,t,e)}setFromVector3(n,t){return this.set(n.x,n.y,n.z,t||this._order)}reorder(n){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,n)}equals(n){return n._x===this._x&&n._y===this._y&&n._z===this._z&&n._order===this._order}fromArray(n){return this._x=n[0],this._y=n[1],this._z=n[2],n[3]!==void 0&&(this._order=n[3]),this._onChangeCallback(),this}toArray(n=[],t=0){return n[t]=this._x,n[t+1]=this._y,n[t+2]=this._z,n[t+3]=this._order,n}toVector3(n){return n?n.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)}_onChange(n){return this._onChangeCallback=n,this}_onChangeCallback(){}}Euler.prototype.isEuler=!0;Euler.DefaultOrder="XYZ";Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Layers{constructor(){this.mask=1}set(n){this.mask=1<<n|0}enable(n){this.mask|=1<<n|0}enableAll(){this.mask=-1}toggle(n){this.mask^=1<<n|0}disable(n){this.mask&=~(1<<n|0)}disableAll(){this.mask=0}test(n){return(this.mask&n.mask)!==0}}let _object3DId=0;const _v1$4=new Vector3,_q1=new Quaternion$1,_m1$1=new Matrix4,_target=new Vector3,_position$3=new Vector3,_scale$2=new Vector3,_quaternion$2=new Quaternion$1,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"};class Object3D extends EventDispatcher{constructor(){super(),Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();const n=new Vector3,t=new Euler,e=new Quaternion$1,i=new Vector3(1,1,1);function s(){e.setFromEuler(t,!1)}function r(){t.setFromQuaternion(e,void 0,!1)}t._onChange(s),e._onChange(r),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:n},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:e},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(n){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(n),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(n){return this.quaternion.premultiply(n),this}setRotationFromAxisAngle(n,t){this.quaternion.setFromAxisAngle(n,t)}setRotationFromEuler(n){this.quaternion.setFromEuler(n,!0)}setRotationFromMatrix(n){this.quaternion.setFromRotationMatrix(n)}setRotationFromQuaternion(n){this.quaternion.copy(n)}rotateOnAxis(n,t){return _q1.setFromAxisAngle(n,t),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(n,t){return _q1.setFromAxisAngle(n,t),this.quaternion.premultiply(_q1),this}rotateX(n){return this.rotateOnAxis(_xAxis,n)}rotateY(n){return this.rotateOnAxis(_yAxis,n)}rotateZ(n){return this.rotateOnAxis(_zAxis,n)}translateOnAxis(n,t){return _v1$4.copy(n).applyQuaternion(this.quaternion),this.position.add(_v1$4.multiplyScalar(t)),this}translateX(n){return this.translateOnAxis(_xAxis,n)}translateY(n){return this.translateOnAxis(_yAxis,n)}translateZ(n){return this.translateOnAxis(_zAxis,n)}localToWorld(n){return n.applyMatrix4(this.matrixWorld)}worldToLocal(n){return n.applyMatrix4(_m1$1.copy(this.matrixWorld).invert())}lookAt(n,t,e){n.isVector3?_target.copy(n):_target.set(n,t,e);const i=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position$3,_target,this.up):_m1$1.lookAt(_target,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$1),i&&(_m1$1.extractRotation(i.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.invert()))}add(n){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return n===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",n),this):(n&&n.isObject3D?(n.parent!==null&&n.parent.remove(n),n.parent=this,this.children.push(n),n.dispatchEvent(_addedEvent)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",n),this)}remove(n){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(n);return t!==-1&&(n.parent=null,this.children.splice(t,1),n.dispatchEvent(_removedEvent)),this}removeFromParent(){const n=this.parent;return n!==null&&n.remove(this),this}clear(){for(let n=0;n<this.children.length;n++){const t=this.children[n];t.parent=null,t.dispatchEvent(_removedEvent)}return this.children.length=0,this}attach(n){return this.updateWorldMatrix(!0,!1),_m1$1.copy(this.matrixWorld).invert(),n.parent!==null&&(n.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(n.parent.matrixWorld)),n.applyMatrix4(_m1$1),this.add(n),n.updateWorldMatrix(!1,!0),this}getObjectById(n){return this.getObjectByProperty("id",n)}getObjectByName(n){return this.getObjectByProperty("name",n)}getObjectByProperty(n,t){if(this[n]===t)return this;for(let e=0,i=this.children.length;e<i;e++){const r=this.children[e].getObjectByProperty(n,t);if(r!==void 0)return r}}getWorldPosition(n){return n===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),n=new Vector3),this.updateWorldMatrix(!0,!1),n.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(n){return n===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),n=new Quaternion$1),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,n,_scale$2),n}getWorldScale(n){return n===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),n=new Vector3),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2,n),n}getWorldDirection(n){n===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),n=new Vector3),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return n.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(n){n(this);const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].traverse(n)}traverseVisible(n){if(this.visible===!1)return;n(this);const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].traverseVisible(n)}traverseAncestors(n){const t=this.parent;t!==null&&(n(t),t.traverseAncestors(n))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(n){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||n)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,n=!0);const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateMatrixWorld(n)}updateWorldMatrix(n,t){const e=this.parent;if(n===!0&&e!==null&&e.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const i=this.children;for(let s=0,r=i.length;s<r;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(n){const t=n===void 0||typeof n=="string",e={};t&&(n={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},e.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON()));function s(o,h){return o[h.uuid]===void 0&&(o[h.uuid]=h.toJSON(n)),h.uuid}if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(n.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const h=o.shapes;if(Array.isArray(h))for(let u=0,p=h.length;u<p;u++){const d=h[u];s(n.shapes,d)}else s(n.shapes,h)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(n.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let h=0,u=this.material.length;h<u;h++)o.push(s(n.materials,this.material[h]));i.material=o}else i.material=s(n.materials,this.material);if(this.children.length>0){i.children=[];for(let o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(n).object)}if(this.animations.length>0){i.animations=[];for(let o=0;o<this.animations.length;o++){const h=this.animations[o];i.animations.push(s(n.animations,h))}}if(t){const o=r(n.geometries),h=r(n.materials),u=r(n.textures),p=r(n.images),d=r(n.shapes),f=r(n.skeletons),g=r(n.animations);o.length>0&&(e.geometries=o),h.length>0&&(e.materials=h),u.length>0&&(e.textures=u),p.length>0&&(e.images=p),d.length>0&&(e.shapes=d),f.length>0&&(e.skeletons=f),g.length>0&&(e.animations=g)}return e.object=i,e;function r(o){const h=[];for(const u in o){const p=o[u];delete p.metadata,h.push(p)}return h}}clone(n){return new this.constructor().copy(this,n)}copy(n,t=!0){if(this.name=n.name,this.up.copy(n.up),this.position.copy(n.position),this.rotation.order=n.rotation.order,this.quaternion.copy(n.quaternion),this.scale.copy(n.scale),this.matrix.copy(n.matrix),this.matrixWorld.copy(n.matrixWorld),this.matrixAutoUpdate=n.matrixAutoUpdate,this.matrixWorldNeedsUpdate=n.matrixWorldNeedsUpdate,this.layers.mask=n.layers.mask,this.visible=n.visible,this.castShadow=n.castShadow,this.receiveShadow=n.receiveShadow,this.frustumCulled=n.frustumCulled,this.renderOrder=n.renderOrder,this.userData=JSON.parse(JSON.stringify(n.userData)),t===!0)for(let e=0;e<n.children.length;e++){const i=n.children[e];this.add(i.clone())}return this}}Object3D.DefaultUp=new Vector3(0,1,0);Object3D.DefaultMatrixAutoUpdate=!0;Object3D.prototype.isObject3D=!0;const _vector1=new Vector3,_vector2$1=new Vector3,_normalMatrix=new Matrix3;let Plane$1=class{constructor(n=new Vector3(1,0,0),t=0){this.normal=n,this.constant=t}set(n,t){return this.normal.copy(n),this.constant=t,this}setComponents(n,t,e,i){return this.normal.set(n,t,e),this.constant=i,this}setFromNormalAndCoplanarPoint(n,t){return this.normal.copy(n),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(n,t,e){const i=_vector1.subVectors(e,t).cross(_vector2$1.subVectors(n,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,n),this}copy(n){return this.normal.copy(n.normal),this.constant=n.constant,this}normalize(){const n=1/this.normal.length();return this.normal.multiplyScalar(n),this.constant*=n,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(n){return this.normal.dot(n)+this.constant}distanceToSphere(n){return this.distanceToPoint(n.center)-n.radius}projectPoint(n,t){return t===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Vector3),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(n)).add(n)}intersectLine(n,t){t===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new Vector3);const e=n.delta(_vector1),i=this.normal.dot(e);if(i===0)return this.distanceToPoint(n.start)===0?t.copy(n.start):null;const s=-(n.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(e).multiplyScalar(s).add(n.start)}intersectsLine(n){const t=this.distanceToPoint(n.start),e=this.distanceToPoint(n.end);return t<0&&e>0||e<0&&t>0}intersectsBox(n){return n.intersectsPlane(this)}intersectsSphere(n){return n.intersectsPlane(this)}coplanarPoint(n){return n===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),n=new Vector3),n.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(n,t){const e=t||_normalMatrix.getNormalMatrix(n),i=this.coplanarPoint(_vector1).applyMatrix4(n),s=this.normal.applyMatrix3(e).normalize();return this.constant=-i.dot(s),this}translate(n){return this.constant-=n.dot(this.normal),this}equals(n){return n.normal.equals(this.normal)&&n.constant===this.constant}clone(){return new this.constructor().copy(this)}};Plane$1.prototype.isPlane=!0;const _v0$1=new Vector3,_v1$3=new Vector3,_v2$2=new Vector3,_v3$1=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3;class Triangle{constructor(n=new Vector3,t=new Vector3,e=new Vector3){this.a=n,this.b=t,this.c=e}static getNormal(n,t,e,i){i===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new Vector3),i.subVectors(e,t),_v0$1.subVectors(n,t),i.cross(_v0$1);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(n,t,e,i,s){_v0$1.subVectors(i,t),_v1$3.subVectors(e,t),_v2$2.subVectors(n,t);const r=_v0$1.dot(_v0$1),o=_v0$1.dot(_v1$3),h=_v0$1.dot(_v2$2),u=_v1$3.dot(_v1$3),p=_v1$3.dot(_v2$2),d=r*u-o*o;if(s===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),s=new Vector3),d===0)return s.set(-2,-1,-1);const f=1/d,g=(u*h-o*p)*f,_=(r*p-o*h)*f;return s.set(1-g-_,_,g)}static containsPoint(n,t,e,i){return this.getBarycoord(n,t,e,i,_v3$1),_v3$1.x>=0&&_v3$1.y>=0&&_v3$1.x+_v3$1.y<=1}static getUV(n,t,e,i,s,r,o,h){return this.getBarycoord(n,t,e,i,_v3$1),h.set(0,0),h.addScaledVector(s,_v3$1.x),h.addScaledVector(r,_v3$1.y),h.addScaledVector(o,_v3$1.z),h}static isFrontFacing(n,t,e,i){return _v0$1.subVectors(e,t),_v1$3.subVectors(n,t),_v0$1.cross(_v1$3).dot(i)<0}set(n,t,e){return this.a.copy(n),this.b.copy(t),this.c.copy(e),this}setFromPointsAndIndices(n,t,e,i){return this.a.copy(n[t]),this.b.copy(n[e]),this.c.copy(n[i]),this}clone(){return new this.constructor().copy(this)}copy(n){return this.a.copy(n.a),this.b.copy(n.b),this.c.copy(n.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),_v0$1.cross(_v1$3).length()*.5}getMidpoint(n){return n===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),n=new Vector3),n.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(n){return Triangle.getNormal(this.a,this.b,this.c,n)}getPlane(n){return n===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),n=new Plane$1),n.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(n,t){return Triangle.getBarycoord(n,this.a,this.b,this.c,t)}getUV(n,t,e,i,s){return Triangle.getUV(n,this.a,this.b,this.c,t,e,i,s)}containsPoint(n){return Triangle.containsPoint(n,this.a,this.b,this.c)}isFrontFacing(n){return Triangle.isFrontFacing(this.a,this.b,this.c,n)}intersectsBox(n){return n.intersectsTriangle(this)}closestPointToPoint(n,t){t===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new Vector3);const e=this.a,i=this.b,s=this.c;let r,o;_vab.subVectors(i,e),_vac.subVectors(s,e),_vap.subVectors(n,e);const h=_vab.dot(_vap),u=_vac.dot(_vap);if(h<=0&&u<=0)return t.copy(e);_vbp.subVectors(n,i);const p=_vab.dot(_vbp),d=_vac.dot(_vbp);if(p>=0&&d<=p)return t.copy(i);const f=h*d-p*u;if(f<=0&&h>=0&&p<=0)return r=h/(h-p),t.copy(e).addScaledVector(_vab,r);_vcp.subVectors(n,s);const g=_vab.dot(_vcp),_=_vac.dot(_vcp);if(_>=0&&g<=_)return t.copy(s);const v=g*u-h*_;if(v<=0&&u>=0&&_<=0)return o=u/(u-_),t.copy(e).addScaledVector(_vac,o);const y=p*_-g*d;if(y<=0&&d-p>=0&&g-_>=0)return _vbc.subVectors(s,i),o=(d-p)/(d-p+(g-_)),t.copy(i).addScaledVector(_vbc,o);const E=1/(y+v+f);return r=v*E,o=f*E,t.copy(e).addScaledVector(_vab,r).addScaledVector(_vac,o)}equals(n){return n.a.equals(this.a)&&n.b.equals(this.b)&&n.c.equals(this.c)}}let materialId=0,Material$1=class extends EventDispatcher{constructor(){super(),Object.defineProperty(this,"id",{value:materialId++}),this.uuid=generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(n){if(n!==void 0)for(const t in n){const e=n[t];if(e===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===FlatShading;continue}const i=this[t];if(i===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}i&&i.isColor?i.set(e):i&&i.isVector3&&e&&e.isVector3?i.copy(e):this[t]=e}}toJSON(n){const t=n===void 0||typeof n=="string";t&&(n={textures:{},images:{}});const e={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.color&&this.color.isColor&&(e.color=this.color.getHex()),this.roughness!==void 0&&(e.roughness=this.roughness),this.metalness!==void 0&&(e.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(e.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(e.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(e.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(e.specular=this.specular.getHex()),this.shininess!==void 0&&(e.shininess=this.shininess),this.clearcoat!==void 0&&(e.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(e.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(e.clearcoatMap=this.clearcoatMap.toJSON(n).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(e.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(n).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(e.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(n).uuid,e.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(e.map=this.map.toJSON(n).uuid),this.matcap&&this.matcap.isTexture&&(e.matcap=this.matcap.toJSON(n).uuid),this.alphaMap&&this.alphaMap.isTexture&&(e.alphaMap=this.alphaMap.toJSON(n).uuid),this.lightMap&&this.lightMap.isTexture&&(e.lightMap=this.lightMap.toJSON(n).uuid,e.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(e.aoMap=this.aoMap.toJSON(n).uuid,e.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(e.bumpMap=this.bumpMap.toJSON(n).uuid,e.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(e.normalMap=this.normalMap.toJSON(n).uuid,e.normalMapType=this.normalMapType,e.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(e.displacementMap=this.displacementMap.toJSON(n).uuid,e.displacementScale=this.displacementScale,e.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(e.roughnessMap=this.roughnessMap.toJSON(n).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(e.metalnessMap=this.metalnessMap.toJSON(n).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(e.emissiveMap=this.emissiveMap.toJSON(n).uuid),this.specularMap&&this.specularMap.isTexture&&(e.specularMap=this.specularMap.toJSON(n).uuid),this.envMap&&this.envMap.isTexture&&(e.envMap=this.envMap.toJSON(n).uuid,this.combine!==void 0&&(e.combine=this.combine)),this.envMapIntensity!==void 0&&(e.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(e.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(e.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(e.gradientMap=this.gradientMap.toJSON(n).uuid),this.transmission!==void 0&&(e.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(e.transmissionMap=this.transmissionMap.toJSON(n).uuid),this.thickness!==void 0&&(e.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(e.thicknessMap=this.thicknessMap.toJSON(n).uuid),this.attenuationDistance!==void 0&&(e.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(e.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(e.size=this.size),this.shadowSide!==null&&(e.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(e.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(e.blending=this.blending),this.side!==FrontSide&&(e.side=this.side),this.vertexColors&&(e.vertexColors=!0),this.opacity<1&&(e.opacity=this.opacity),this.transparent===!0&&(e.transparent=this.transparent),e.depthFunc=this.depthFunc,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.colorWrite=this.colorWrite,e.stencilWrite=this.stencilWrite,e.stencilWriteMask=this.stencilWriteMask,e.stencilFunc=this.stencilFunc,e.stencilRef=this.stencilRef,e.stencilFuncMask=this.stencilFuncMask,e.stencilFail=this.stencilFail,e.stencilZFail=this.stencilZFail,e.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(e.rotation=this.rotation),this.polygonOffset===!0&&(e.polygonOffset=!0),this.polygonOffsetFactor!==0&&(e.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(e.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(e.linewidth=this.linewidth),this.dashSize!==void 0&&(e.dashSize=this.dashSize),this.gapSize!==void 0&&(e.gapSize=this.gapSize),this.scale!==void 0&&(e.scale=this.scale),this.dithering===!0&&(e.dithering=!0),this.alphaTest>0&&(e.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(e.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(e.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(e.wireframe=this.wireframe),this.wireframeLinewidth>1&&(e.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(e.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(e.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(e.morphTargets=!0),this.morphNormals===!0&&(e.morphNormals=!0),this.flatShading===!0&&(e.flatShading=this.flatShading),this.visible===!1&&(e.visible=!1),this.toneMapped===!1&&(e.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(e.userData=this.userData);function i(s){const r=[];for(const o in s){const h=s[o];delete h.metadata,r.push(h)}return r}if(t){const s=i(n.textures),r=i(n.images);s.length>0&&(e.textures=s),r.length>0&&(e.images=r)}return e}clone(){return new this.constructor().copy(this)}copy(n){this.name=n.name,this.fog=n.fog,this.blending=n.blending,this.side=n.side,this.vertexColors=n.vertexColors,this.opacity=n.opacity,this.transparent=n.transparent,this.blendSrc=n.blendSrc,this.blendDst=n.blendDst,this.blendEquation=n.blendEquation,this.blendSrcAlpha=n.blendSrcAlpha,this.blendDstAlpha=n.blendDstAlpha,this.blendEquationAlpha=n.blendEquationAlpha,this.depthFunc=n.depthFunc,this.depthTest=n.depthTest,this.depthWrite=n.depthWrite,this.stencilWriteMask=n.stencilWriteMask,this.stencilFunc=n.stencilFunc,this.stencilRef=n.stencilRef,this.stencilFuncMask=n.stencilFuncMask,this.stencilFail=n.stencilFail,this.stencilZFail=n.stencilZFail,this.stencilZPass=n.stencilZPass,this.stencilWrite=n.stencilWrite;const t=n.clippingPlanes;let e=null;if(t!==null){const i=t.length;e=new Array(i);for(let s=0;s!==i;++s)e[s]=t[s].clone()}return this.clippingPlanes=e,this.clipIntersection=n.clipIntersection,this.clipShadows=n.clipShadows,this.shadowSide=n.shadowSide,this.colorWrite=n.colorWrite,this.precision=n.precision,this.polygonOffset=n.polygonOffset,this.polygonOffsetFactor=n.polygonOffsetFactor,this.polygonOffsetUnits=n.polygonOffsetUnits,this.dithering=n.dithering,this.alphaTest=n.alphaTest,this.alphaToCoverage=n.alphaToCoverage,this.premultipliedAlpha=n.premultipliedAlpha,this.visible=n.visible,this.toneMapped=n.toneMapped,this.userData=JSON.parse(JSON.stringify(n.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(n){n===!0&&this.version++}};Material$1.prototype.isMaterial=!0;const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(l,n,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?l+(n-l)*6*t:t<1/2?n:t<2/3?l+(n-l)*6*(2/3-t):l}function SRGBToLinear(l){return l<.04045?l*.0773993808:Math.pow(l*.9478672986+.0521327014,2.4)}function LinearToSRGB(l){return l<.0031308?l*12.92:1.055*Math.pow(l,.41666)-.055}class Color{constructor(n,t,e){return t===void 0&&e===void 0?this.set(n):this.setRGB(n,t,e)}set(n){return n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n),this}setScalar(n){return this.r=n,this.g=n,this.b=n,this}setHex(n){return n=Math.floor(n),this.r=(n>>16&255)/255,this.g=(n>>8&255)/255,this.b=(n&255)/255,this}setRGB(n,t,e){return this.r=n,this.g=t,this.b=e,this}setHSL(n,t,e){if(n=euclideanModulo(n,1),t=clamp(t,0,1),e=clamp(e,0,1),t===0)this.r=this.g=this.b=e;else{const i=e<=.5?e*(1+t):e+t-e*t,s=2*e-i;this.r=hue2rgb(s,i,n+1/3),this.g=hue2rgb(s,i,n),this.b=hue2rgb(s,i,n-1/3)}return this}setStyle(n){function t(i){i!==void 0&&parseFloat(i)<1&&console.warn("THREE.Color: Alpha component of "+n+" will be ignored.")}let e;if(e=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(n)){let i;const s=e[1],r=e[2];switch(s){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[4]),this;if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[4]),this;break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const o=parseFloat(i[1])/360,h=parseInt(i[2],10)/100,u=parseInt(i[3],10)/100;return t(i[4]),this.setHSL(o,h,u)}break}}else if(e=/^\#([A-Fa-f\d]+)$/.exec(n)){const i=e[1],s=i.length;if(s===3)return this.r=parseInt(i.charAt(0)+i.charAt(0),16)/255,this.g=parseInt(i.charAt(1)+i.charAt(1),16)/255,this.b=parseInt(i.charAt(2)+i.charAt(2),16)/255,this;if(s===6)return this.r=parseInt(i.charAt(0)+i.charAt(1),16)/255,this.g=parseInt(i.charAt(2)+i.charAt(3),16)/255,this.b=parseInt(i.charAt(4)+i.charAt(5),16)/255,this}return n&&n.length>0?this.setColorName(n):this}setColorName(n){const t=_colorKeywords[n.toLowerCase()];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+n),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(n){return this.r=n.r,this.g=n.g,this.b=n.b,this}copyGammaToLinear(n,t=2){return this.r=Math.pow(n.r,t),this.g=Math.pow(n.g,t),this.b=Math.pow(n.b,t),this}copyLinearToGamma(n,t=2){const e=t>0?1/t:1;return this.r=Math.pow(n.r,e),this.g=Math.pow(n.g,e),this.b=Math.pow(n.b,e),this}convertGammaToLinear(n){return this.copyGammaToLinear(this,n),this}convertLinearToGamma(n){return this.copyLinearToGamma(this,n),this}copySRGBToLinear(n){return this.r=SRGBToLinear(n.r),this.g=SRGBToLinear(n.g),this.b=SRGBToLinear(n.b),this}copyLinearToSRGB(n){return this.r=LinearToSRGB(n.r),this.g=LinearToSRGB(n.g),this.b=LinearToSRGB(n.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return this.r*255<<16^this.g*255<<8^this.b*255<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(n){n===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),n={h:0,s:0,l:0});const t=this.r,e=this.g,i=this.b,s=Math.max(t,e,i),r=Math.min(t,e,i);let o,h;const u=(r+s)/2;if(r===s)o=0,h=0;else{const p=s-r;switch(h=u<=.5?p/(s+r):p/(2-s-r),s){case t:o=(e-i)/p+(e<i?6:0);break;case e:o=(i-t)/p+2;break;case i:o=(t-e)/p+4;break}o/=6}return n.h=o,n.s=h,n.l=u,n}getStyle(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"}offsetHSL(n,t,e){return this.getHSL(_hslA),_hslA.h+=n,_hslA.s+=t,_hslA.l+=e,this.setHSL(_hslA.h,_hslA.s,_hslA.l),this}add(n){return this.r+=n.r,this.g+=n.g,this.b+=n.b,this}addColors(n,t){return this.r=n.r+t.r,this.g=n.g+t.g,this.b=n.b+t.b,this}addScalar(n){return this.r+=n,this.g+=n,this.b+=n,this}sub(n){return this.r=Math.max(0,this.r-n.r),this.g=Math.max(0,this.g-n.g),this.b=Math.max(0,this.b-n.b),this}multiply(n){return this.r*=n.r,this.g*=n.g,this.b*=n.b,this}multiplyScalar(n){return this.r*=n,this.g*=n,this.b*=n,this}lerp(n,t){return this.r+=(n.r-this.r)*t,this.g+=(n.g-this.g)*t,this.b+=(n.b-this.b)*t,this}lerpColors(n,t,e){return this.r=n.r+(t.r-n.r)*e,this.g=n.g+(t.g-n.g)*e,this.b=n.b+(t.b-n.b)*e,this}lerpHSL(n,t){this.getHSL(_hslA),n.getHSL(_hslB);const e=lerp(_hslA.h,_hslB.h,t),i=lerp(_hslA.s,_hslB.s,t),s=lerp(_hslA.l,_hslB.l,t);return this.setHSL(e,i,s),this}equals(n){return n.r===this.r&&n.g===this.g&&n.b===this.b}fromArray(n,t=0){return this.r=n[t],this.g=n[t+1],this.b=n[t+2],this}toArray(n=[],t=0){return n[t]=this.r,n[t+1]=this.g,n[t+2]=this.b,n}fromBufferAttribute(n,t){return this.r=n.getX(t),this.g=n.getY(t),this.b=n.getZ(t),n.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Color.NAMES=_colorKeywords;Color.prototype.isColor=!0;Color.prototype.r=1;Color.prototype.g=1;Color.prototype.b=1;class MeshBasicMaterial extends Material$1{constructor(n){super(),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.morphTargets=n.morphTargets,this}}MeshBasicMaterial.prototype.isMeshBasicMaterial=!0;const _vector$9=new Vector3,_vector2=new Vector2;class BufferAttribute{constructor(n,t,e){if(Array.isArray(n))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=n,this.itemSize=t,this.count=n!==void 0?n.length/t:0,this.normalized=e===!0,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(n){n===!0&&this.version++}setUsage(n){return this.usage=n,this}copy(n){return this.name=n.name,this.array=new n.array.constructor(n.array),this.itemSize=n.itemSize,this.count=n.count,this.normalized=n.normalized,this.usage=n.usage,this}copyAt(n,t,e){n*=this.itemSize,e*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[n+i]=t.array[e+i];return this}copyArray(n){return this.array.set(n),this}copyColorsArray(n){const t=this.array;let e=0;for(let i=0,s=n.length;i<s;i++){let r=n[i];r===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),r=new Color),t[e++]=r.r,t[e++]=r.g,t[e++]=r.b}return this}copyVector2sArray(n){const t=this.array;let e=0;for(let i=0,s=n.length;i<s;i++){let r=n[i];r===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),r=new Vector2),t[e++]=r.x,t[e++]=r.y}return this}copyVector3sArray(n){const t=this.array;let e=0;for(let i=0,s=n.length;i<s;i++){let r=n[i];r===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),r=new Vector3),t[e++]=r.x,t[e++]=r.y,t[e++]=r.z}return this}copyVector4sArray(n){const t=this.array;let e=0;for(let i=0,s=n.length;i<s;i++){let r=n[i];r===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),r=new Vector4),t[e++]=r.x,t[e++]=r.y,t[e++]=r.z,t[e++]=r.w}return this}applyMatrix3(n){if(this.itemSize===2)for(let t=0,e=this.count;t<e;t++)_vector2.fromBufferAttribute(this,t),_vector2.applyMatrix3(n),this.setXY(t,_vector2.x,_vector2.y);else if(this.itemSize===3)for(let t=0,e=this.count;t<e;t++)_vector$9.fromBufferAttribute(this,t),_vector$9.applyMatrix3(n),this.setXYZ(t,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyMatrix4(n){for(let t=0,e=this.count;t<e;t++)_vector$9.x=this.getX(t),_vector$9.y=this.getY(t),_vector$9.z=this.getZ(t),_vector$9.applyMatrix4(n),this.setXYZ(t,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyNormalMatrix(n){for(let t=0,e=this.count;t<e;t++)_vector$9.x=this.getX(t),_vector$9.y=this.getY(t),_vector$9.z=this.getZ(t),_vector$9.applyNormalMatrix(n),this.setXYZ(t,_vector$9.x,_vector$9.y,_vector$9.z);return this}transformDirection(n){for(let t=0,e=this.count;t<e;t++)_vector$9.x=this.getX(t),_vector$9.y=this.getY(t),_vector$9.z=this.getZ(t),_vector$9.transformDirection(n),this.setXYZ(t,_vector$9.x,_vector$9.y,_vector$9.z);return this}set(n,t=0){return this.array.set(n,t),this}getX(n){return this.array[n*this.itemSize]}setX(n,t){return this.array[n*this.itemSize]=t,this}getY(n){return this.array[n*this.itemSize+1]}setY(n,t){return this.array[n*this.itemSize+1]=t,this}getZ(n){return this.array[n*this.itemSize+2]}setZ(n,t){return this.array[n*this.itemSize+2]=t,this}getW(n){return this.array[n*this.itemSize+3]}setW(n,t){return this.array[n*this.itemSize+3]=t,this}setXY(n,t,e){return n*=this.itemSize,this.array[n+0]=t,this.array[n+1]=e,this}setXYZ(n,t,e,i){return n*=this.itemSize,this.array[n+0]=t,this.array[n+1]=e,this.array[n+2]=i,this}setXYZW(n,t,e,i,s){return n*=this.itemSize,this.array[n+0]=t,this.array[n+1]=e,this.array[n+2]=i,this.array[n+3]=s,this}onUpload(n){return this.onUploadCallback=n,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const n={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(n.name=this.name),this.usage!==StaticDrawUsage&&(n.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(n.updateRange=this.updateRange),n}}BufferAttribute.prototype.isBufferAttribute=!0;class Uint16BufferAttribute extends BufferAttribute{constructor(n,t,e){super(new Uint16Array(n),t,e)}}class Uint32BufferAttribute extends BufferAttribute{constructor(n,t,e){super(new Uint32Array(n),t,e)}}class Float16BufferAttribute extends BufferAttribute{constructor(n,t,e){super(new Uint16Array(n),t,e)}}Float16BufferAttribute.prototype.isFloat16BufferAttribute=!0;class Float32BufferAttribute extends BufferAttribute{constructor(n,t,e){super(new Float32Array(n),t,e)}}function arrayMax(l){if(l.length===0)return-1/0;let n=l[0];for(let t=1,e=l.length;t<e;++t)l[t]>n&&(n=l[t]);return n}let _id=0;const _m1=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$1=new Box3,_boxMorphTargets=new Box3,_vector$8=new Vector3;class BufferGeometry extends EventDispatcher{constructor(){super(),Object.defineProperty(this,"id",{value:_id++}),this.uuid=generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(n){return Array.isArray(n)?this.index=new(arrayMax(n)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(n,1):this.index=n,this}getAttribute(n){return this.attributes[n]}setAttribute(n,t){return this.attributes[n]=t,this}deleteAttribute(n){return delete this.attributes[n],this}hasAttribute(n){return this.attributes[n]!==void 0}addGroup(n,t,e=0){this.groups.push({start:n,count:t,materialIndex:e})}clearGroups(){this.groups=[]}setDrawRange(n,t){this.drawRange.start=n,this.drawRange.count=t}applyMatrix4(n){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(n),t.needsUpdate=!0);const e=this.attributes.normal;if(e!==void 0){const s=new Matrix3().getNormalMatrix(n);e.applyNormalMatrix(s),e.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(n),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(n){return _m1.makeRotationFromQuaternion(n),this.applyMatrix4(_m1),this}rotateX(n){return _m1.makeRotationX(n),this.applyMatrix4(_m1),this}rotateY(n){return _m1.makeRotationY(n),this.applyMatrix4(_m1),this}rotateZ(n){return _m1.makeRotationZ(n),this.applyMatrix4(_m1),this}translate(n,t,e){return _m1.makeTranslation(n,t,e),this.applyMatrix4(_m1),this}scale(n,t,e){return _m1.makeScale(n,t,e),this.applyMatrix4(_m1),this}lookAt(n){return _obj.lookAt(n),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this}setFromPoints(n){const t=[];for(let e=0,i=n.length;e<i;e++){const s=n[e];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Float32BufferAttribute(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const n=this.attributes.position,t=this.morphAttributes.position;if(n&&n.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));return}if(n!==void 0){if(this.boundingBox.setFromBufferAttribute(n),t)for(let e=0,i=t.length;e<i;e++){const s=t[e];_box$1.setFromBufferAttribute(s),this.morphTargetsRelative?(_vector$8.addVectors(this.boundingBox.min,_box$1.min),this.boundingBox.expandByPoint(_vector$8),_vector$8.addVectors(this.boundingBox.max,_box$1.max),this.boundingBox.expandByPoint(_vector$8)):(this.boundingBox.expandByPoint(_box$1.min),this.boundingBox.expandByPoint(_box$1.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere$1);const n=this.attributes.position,t=this.morphAttributes.position;if(n&&n.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Vector3,1/0);return}if(n){const e=this.boundingSphere.center;if(_box$1.setFromBufferAttribute(n),t)for(let s=0,r=t.length;s<r;s++){const o=t[s];_boxMorphTargets.setFromBufferAttribute(o),this.morphTargetsRelative?(_vector$8.addVectors(_box$1.min,_boxMorphTargets.min),_box$1.expandByPoint(_vector$8),_vector$8.addVectors(_box$1.max,_boxMorphTargets.max),_box$1.expandByPoint(_vector$8)):(_box$1.expandByPoint(_boxMorphTargets.min),_box$1.expandByPoint(_boxMorphTargets.max))}_box$1.getCenter(e);let i=0;for(let s=0,r=n.count;s<r;s++)_vector$8.fromBufferAttribute(n,s),i=Math.max(i,e.distanceToSquared(_vector$8));if(t)for(let s=0,r=t.length;s<r;s++){const o=t[s],h=this.morphTargetsRelative;for(let u=0,p=o.count;u<p;u++)_vector$8.fromBufferAttribute(o,u),h&&(_offset.fromBufferAttribute(n,u),_vector$8.add(_offset)),i=Math.max(i,e.distanceToSquared(_vector$8))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeFaceNormals(){}computeTangents(){const n=this.index,t=this.attributes;if(n===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const e=n.array,i=t.position.array,s=t.normal.array,r=t.uv.array,o=i.length/3;t.tangent===void 0&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*o),4));const h=t.tangent.array,u=[],p=[];for(let N=0;N<o;N++)u[N]=new Vector3,p[N]=new Vector3;const d=new Vector3,f=new Vector3,g=new Vector3,_=new Vector2,v=new Vector2,y=new Vector2,E=new Vector3,m=new Vector3;function x(N,B,W){d.fromArray(i,N*3),f.fromArray(i,B*3),g.fromArray(i,W*3),_.fromArray(r,N*2),v.fromArray(r,B*2),y.fromArray(r,W*2),f.sub(d),g.sub(d),v.sub(_),y.sub(_);const A=1/(v.x*y.y-y.x*v.y);isFinite(A)&&(E.copy(f).multiplyScalar(y.y).addScaledVector(g,-v.y).multiplyScalar(A),m.copy(g).multiplyScalar(v.x).addScaledVector(f,-y.x).multiplyScalar(A),u[N].add(E),u[B].add(E),u[W].add(E),p[N].add(m),p[B].add(m),p[W].add(m))}let C=this.groups;C.length===0&&(C=[{start:0,count:e.length}]);for(let N=0,B=C.length;N<B;++N){const W=C[N],A=W.start,G=W.count;for(let D=A,M=A+G;D<M;D+=3)x(e[D+0],e[D+1],e[D+2])}const O=new Vector3,S=new Vector3,P=new Vector3,F=new Vector3;function V(N){P.fromArray(s,N*3),F.copy(P);const B=u[N];O.copy(B),O.sub(P.multiplyScalar(P.dot(B))).normalize(),S.crossVectors(F,B);const A=S.dot(p[N])<0?-1:1;h[N*4]=O.x,h[N*4+1]=O.y,h[N*4+2]=O.z,h[N*4+3]=A}for(let N=0,B=C.length;N<B;++N){const W=C[N],A=W.start,G=W.count;for(let D=A,M=A+G;D<M;D+=3)V(e[D+0]),V(e[D+1]),V(e[D+2])}}computeVertexNormals(){const n=this.index,t=this.getAttribute("position");if(t!==void 0){let e=this.getAttribute("normal");if(e===void 0)e=new BufferAttribute(new Float32Array(t.count*3),3),this.setAttribute("normal",e);else for(let f=0,g=e.count;f<g;f++)e.setXYZ(f,0,0,0);const i=new Vector3,s=new Vector3,r=new Vector3,o=new Vector3,h=new Vector3,u=new Vector3,p=new Vector3,d=new Vector3;if(n)for(let f=0,g=n.count;f<g;f+=3){const _=n.getX(f+0),v=n.getX(f+1),y=n.getX(f+2);i.fromBufferAttribute(t,_),s.fromBufferAttribute(t,v),r.fromBufferAttribute(t,y),p.subVectors(r,s),d.subVectors(i,s),p.cross(d),o.fromBufferAttribute(e,_),h.fromBufferAttribute(e,v),u.fromBufferAttribute(e,y),o.add(p),h.add(p),u.add(p),e.setXYZ(_,o.x,o.y,o.z),e.setXYZ(v,h.x,h.y,h.z),e.setXYZ(y,u.x,u.y,u.z)}else for(let f=0,g=t.count;f<g;f+=3)i.fromBufferAttribute(t,f+0),s.fromBufferAttribute(t,f+1),r.fromBufferAttribute(t,f+2),p.subVectors(r,s),d.subVectors(i,s),p.cross(d),e.setXYZ(f+0,p.x,p.y,p.z),e.setXYZ(f+1,p.x,p.y,p.z),e.setXYZ(f+2,p.x,p.y,p.z);this.normalizeNormals(),e.needsUpdate=!0}}merge(n,t){if(!(n&&n.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",n);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const e=this.attributes;for(const i in e){if(n.attributes[i]===void 0)continue;const r=e[i].array,o=n.attributes[i],h=o.array,u=o.itemSize*t,p=Math.min(h.length,r.length-u);for(let d=0,f=u;d<p;d++,f++)r[f]=h[d]}return this}normalizeNormals(){const n=this.attributes.normal;for(let t=0,e=n.count;t<e;t++)_vector$8.fromBufferAttribute(n,t),_vector$8.normalize(),n.setXYZ(t,_vector$8.x,_vector$8.y,_vector$8.z)}toNonIndexed(){function n(o,h){const u=o.array,p=o.itemSize,d=o.normalized,f=new u.constructor(h.length*p);let g=0,_=0;for(let v=0,y=h.length;v<y;v++){g=h[v]*p;for(let E=0;E<p;E++)f[_++]=u[g++]}return new BufferAttribute(f,p,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new BufferGeometry,e=this.index.array,i=this.attributes;for(const o in i){const h=i[o],u=n(h,e);t.setAttribute(o,u)}const s=this.morphAttributes;for(const o in s){const h=[],u=s[o];for(let p=0,d=u.length;p<d;p++){const f=u[p],g=n(f,e);h.push(g)}t.morphAttributes[o]=h}t.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let o=0,h=r.length;o<h;o++){const u=r[o];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const n={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),Object.keys(this.userData).length>0&&(n.userData=this.userData),this.parameters!==void 0){const h=this.parameters;for(const u in h)h[u]!==void 0&&(n[u]=h[u]);return n}n.data={attributes:{}};const t=this.index;t!==null&&(n.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const e=this.attributes;for(const h in e){const u=e[h];n.data.attributes[h]=u.toJSON(n.data)}const i={};let s=!1;for(const h in this.morphAttributes){const u=this.morphAttributes[h],p=[];for(let d=0,f=u.length;d<f;d++){const g=u[d];p.push(g.toJSON(n.data))}p.length>0&&(i[h]=p,s=!0)}s&&(n.data.morphAttributes=i,n.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(n.data.groups=JSON.parse(JSON.stringify(r)));const o=this.boundingSphere;return o!==null&&(n.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),n}clone(){return new BufferGeometry().copy(this)}copy(n){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=n.name;const e=n.index;e!==null&&this.setIndex(e.clone(t));const i=n.attributes;for(const u in i){const p=i[u];this.setAttribute(u,p.clone(t))}const s=n.morphAttributes;for(const u in s){const p=[],d=s[u];for(let f=0,g=d.length;f<g;f++)p.push(d[f].clone(t));this.morphAttributes[u]=p}this.morphTargetsRelative=n.morphTargetsRelative;const r=n.groups;for(let u=0,p=r.length;u<p;u++){const d=r[u];this.addGroup(d.start,d.count,d.materialIndex)}const o=n.boundingBox;o!==null&&(this.boundingBox=o.clone());const h=n.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.drawRange.start=n.drawRange.start,this.drawRange.count=n.drawRange.count,this.userData=n.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}BufferGeometry.prototype.isBufferGeometry=!0;const _inverseMatrix$2=new Matrix4,_ray$2=new Ray$1,_sphere$3=new Sphere$1,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_tempA=new Vector3,_tempB=new Vector3,_tempC=new Vector3,_morphA=new Vector3,_morphB=new Vector3,_morphC=new Vector3,_uvA$1=new Vector2,_uvB$1=new Vector2,_uvC$1=new Vector2,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;class Mesh extends Object3D{constructor(n=new BufferGeometry,t=new MeshBasicMaterial){super(),this.type="Mesh",this.geometry=n,this.material=t,this.updateMorphTargets()}copy(n){return super.copy(n),n.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=n.morphTargetInfluences.slice()),n.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},n.morphTargetDictionary)),this.material=n.material,this.geometry=n.geometry,this}updateMorphTargets(){const n=this.geometry;if(n.isBufferGeometry){const t=n.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,r=i.length;s<r;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}else{const t=n.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(n,t){const e=this.geometry,i=this.material,s=this.matrixWorld;if(i===void 0||(e.boundingSphere===null&&e.computeBoundingSphere(),_sphere$3.copy(e.boundingSphere),_sphere$3.applyMatrix4(s),n.ray.intersectsSphere(_sphere$3)===!1)||(_inverseMatrix$2.copy(s).invert(),_ray$2.copy(n.ray).applyMatrix4(_inverseMatrix$2),e.boundingBox!==null&&_ray$2.intersectsBox(e.boundingBox)===!1))return;let r;if(e.isBufferGeometry){const o=e.index,h=e.attributes.position,u=e.morphAttributes.position,p=e.morphTargetsRelative,d=e.attributes.uv,f=e.attributes.uv2,g=e.groups,_=e.drawRange;if(o!==null)if(Array.isArray(i))for(let v=0,y=g.length;v<y;v++){const E=g[v],m=i[E.materialIndex],x=Math.max(E.start,_.start),C=Math.min(E.start+E.count,_.start+_.count);for(let O=x,S=C;O<S;O+=3){const P=o.getX(O),F=o.getX(O+1),V=o.getX(O+2);r=checkBufferGeometryIntersection(this,m,n,_ray$2,h,u,p,d,f,P,F,V),r&&(r.faceIndex=Math.floor(O/3),r.face.materialIndex=E.materialIndex,t.push(r))}}else{const v=Math.max(0,_.start),y=Math.min(o.count,_.start+_.count);for(let E=v,m=y;E<m;E+=3){const x=o.getX(E),C=o.getX(E+1),O=o.getX(E+2);r=checkBufferGeometryIntersection(this,i,n,_ray$2,h,u,p,d,f,x,C,O),r&&(r.faceIndex=Math.floor(E/3),t.push(r))}}else if(h!==void 0)if(Array.isArray(i))for(let v=0,y=g.length;v<y;v++){const E=g[v],m=i[E.materialIndex],x=Math.max(E.start,_.start),C=Math.min(E.start+E.count,_.start+_.count);for(let O=x,S=C;O<S;O+=3){const P=O,F=O+1,V=O+2;r=checkBufferGeometryIntersection(this,m,n,_ray$2,h,u,p,d,f,P,F,V),r&&(r.faceIndex=Math.floor(O/3),r.face.materialIndex=E.materialIndex,t.push(r))}}else{const v=Math.max(0,_.start),y=Math.min(h.count,_.start+_.count);for(let E=v,m=y;E<m;E+=3){const x=E,C=E+1,O=E+2;r=checkBufferGeometryIntersection(this,i,n,_ray$2,h,u,p,d,f,x,C,O),r&&(r.faceIndex=Math.floor(E/3),t.push(r))}}}else e.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}Mesh.prototype.isMesh=!0;function checkIntersection(l,n,t,e,i,s,r,o){let h;if(n.side===BackSide?h=e.intersectTriangle(r,s,i,!0,o):h=e.intersectTriangle(i,s,r,n.side!==DoubleSide,o),h===null)return null;_intersectionPointWorld.copy(o),_intersectionPointWorld.applyMatrix4(l.matrixWorld);const u=t.ray.origin.distanceTo(_intersectionPointWorld);return u<t.near||u>t.far?null:{distance:u,point:_intersectionPointWorld.clone(),object:l}}function checkBufferGeometryIntersection(l,n,t,e,i,s,r,o,h,u,p,d){_vA$1.fromBufferAttribute(i,u),_vB$1.fromBufferAttribute(i,p),_vC$1.fromBufferAttribute(i,d);const f=l.morphTargetInfluences;if(n.morphTargets&&s&&f){_morphA.set(0,0,0),_morphB.set(0,0,0),_morphC.set(0,0,0);for(let _=0,v=s.length;_<v;_++){const y=f[_],E=s[_];y!==0&&(_tempA.fromBufferAttribute(E,u),_tempB.fromBufferAttribute(E,p),_tempC.fromBufferAttribute(E,d),r?(_morphA.addScaledVector(_tempA,y),_morphB.addScaledVector(_tempB,y),_morphC.addScaledVector(_tempC,y)):(_morphA.addScaledVector(_tempA.sub(_vA$1),y),_morphB.addScaledVector(_tempB.sub(_vB$1),y),_morphC.addScaledVector(_tempC.sub(_vC$1),y)))}_vA$1.add(_morphA),_vB$1.add(_morphB),_vC$1.add(_morphC)}l.isSkinnedMesh&&(l.boneTransform(u,_vA$1),l.boneTransform(p,_vB$1),l.boneTransform(d,_vC$1));const g=checkIntersection(l,n,t,e,_vA$1,_vB$1,_vC$1,_intersectionPoint);if(g){o&&(_uvA$1.fromBufferAttribute(o,u),_uvB$1.fromBufferAttribute(o,p),_uvC$1.fromBufferAttribute(o,d),g.uv=Triangle.getUV(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2)),h&&(_uvA$1.fromBufferAttribute(h,u),_uvB$1.fromBufferAttribute(h,p),_uvC$1.fromBufferAttribute(h,d),g.uv2=Triangle.getUV(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2));const _={a:u,b:p,c:d,normal:new Vector3,materialIndex:0};Triangle.getNormal(_vA$1,_vB$1,_vC$1,_.normal),g.face=_}return g}class BoxGeometry extends BufferGeometry{constructor(n=1,t=1,e=1,i=1,s=1,r=1){super(),this.type="BoxGeometry",this.parameters={width:n,height:t,depth:e,widthSegments:i,heightSegments:s,depthSegments:r};const o=this;i=Math.floor(i),s=Math.floor(s),r=Math.floor(r);const h=[],u=[],p=[],d=[];let f=0,g=0;_("z","y","x",-1,-1,e,t,n,r,s,0),_("z","y","x",1,-1,e,t,-n,r,s,1),_("x","z","y",1,1,n,e,t,i,r,2),_("x","z","y",1,-1,n,e,-t,i,r,3),_("x","y","z",1,-1,n,t,e,i,s,4),_("x","y","z",-1,-1,n,t,-e,i,s,5),this.setIndex(h),this.setAttribute("position",new Float32BufferAttribute(u,3)),this.setAttribute("normal",new Float32BufferAttribute(p,3)),this.setAttribute("uv",new Float32BufferAttribute(d,2));function _(v,y,E,m,x,C,O,S,P,F,V){const N=C/P,B=O/F,W=C/2,A=O/2,G=S/2,D=P+1,M=F+1;let J=0,et=0;const Q=new Vector3;for(let ot=0;ot<M;ot++){const tt=ot*B-A;for(let rt=0;rt<D;rt++){const ft=rt*N-W;Q[v]=ft*m,Q[y]=tt*x,Q[E]=G,u.push(Q.x,Q.y,Q.z),Q[v]=0,Q[y]=0,Q[E]=S>0?1:-1,p.push(Q.x,Q.y,Q.z),d.push(rt/P),d.push(1-ot/F),J+=1}}for(let ot=0;ot<F;ot++)for(let tt=0;tt<P;tt++){const rt=f+tt+D*ot,ft=f+tt+D*(ot+1),_t=f+(tt+1)+D*(ot+1),yt=f+(tt+1)+D*ot;h.push(rt,ft,yt),h.push(ft,_t,yt),et+=6}o.addGroup(g,et,V),g+=et,f+=J}}}function cloneUniforms(l){const n={};for(const t in l){n[t]={};for(const e in l[t]){const i=l[t][e];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?n[t][e]=i.clone():Array.isArray(i)?n[t][e]=i.slice():n[t][e]=i}}return n}function mergeUniforms(l){const n={};for(let t=0;t<l.length;t++){const e=cloneUniforms(l[t]);for(const i in e)n[i]=e[i]}return n}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,default_fragment=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ShaderMaterial extends Material$1{constructor(n){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,n!==void 0&&(n.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(n))}copy(n){return super.copy(n),this.fragmentShader=n.fragmentShader,this.vertexShader=n.vertexShader,this.uniforms=cloneUniforms(n.uniforms),this.defines=Object.assign({},n.defines),this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.lights=n.lights,this.clipping=n.clipping,this.morphTargets=n.morphTargets,this.morphNormals=n.morphNormals,this.extensions=Object.assign({},n.extensions),this.glslVersion=n.glslVersion,this}toJSON(n){const t=super.toJSON(n);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const r=this.uniforms[i].value;r&&r.isTexture?t.uniforms[i]={type:"t",value:r.toJSON(n).uuid}:r&&r.isColor?t.uniforms[i]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[i]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[i]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[i]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[i]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[i]={type:"m4",value:r.toArray()}:t.uniforms[i]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const e={};for(const i in this.extensions)this.extensions[i]===!0&&(e[i]=!0);return Object.keys(e).length>0&&(t.extensions=e),t}}ShaderMaterial.prototype.isShaderMaterial=!0;class Camera extends Object3D{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}copy(n,t){return super.copy(n,t),this.matrixWorldInverse.copy(n.matrixWorldInverse),this.projectionMatrix.copy(n.projectionMatrix),this.projectionMatrixInverse.copy(n.projectionMatrixInverse),this}getWorldDirection(n){n===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),n=new Vector3),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return n.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(n){super.updateMatrixWorld(n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(n,t){super.updateWorldMatrix(n,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}Camera.prototype.isCamera=!0;class PerspectiveCamera extends Camera{constructor(n=50,t=1,e=.1,i=2e3){super(),this.type="PerspectiveCamera",this.fov=n,this.zoom=1,this.near=e,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(n,t){return super.copy(n,t),this.fov=n.fov,this.zoom=n.zoom,this.near=n.near,this.far=n.far,this.focus=n.focus,this.aspect=n.aspect,this.view=n.view===null?null:Object.assign({},n.view),this.filmGauge=n.filmGauge,this.filmOffset=n.filmOffset,this}setFocalLength(n){const t=.5*this.getFilmHeight()/n;this.fov=RAD2DEG*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const n=Math.tan(DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/n}getEffectiveFOV(){return RAD2DEG*2*Math.atan(Math.tan(DEG2RAD*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(n,t,e,i,s,r){this.aspect=n/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=n,this.view.fullHeight=t,this.view.offsetX=e,this.view.offsetY=i,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const n=this.near;let t=n*Math.tan(DEG2RAD*.5*this.fov)/this.zoom,e=2*t,i=this.aspect*e,s=-.5*i;const r=this.view;if(this.view!==null&&this.view.enabled){const h=r.fullWidth,u=r.fullHeight;s+=r.offsetX*i/h,t-=r.offsetY*e/u,i*=r.width/h,e*=r.height/u}const o=this.filmOffset;o!==0&&(s+=n*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-e,n,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(n){const t=super.toJSON(n);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}PerspectiveCamera.prototype.isPerspectiveCamera=!0;const fov=90,aspect=1;class CubeCamera extends Object3D{constructor(n,t,e){if(super(),this.type="CubeCamera",e.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=e;const i=new PerspectiveCamera(fov,aspect,n,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Vector3(1,0,0)),this.add(i);const s=new PerspectiveCamera(fov,aspect,n,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new Vector3(-1,0,0)),this.add(s);const r=new PerspectiveCamera(fov,aspect,n,t);r.layers=this.layers,r.up.set(0,0,1),r.lookAt(new Vector3(0,1,0)),this.add(r);const o=new PerspectiveCamera(fov,aspect,n,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new Vector3(0,-1,0)),this.add(o);const h=new PerspectiveCamera(fov,aspect,n,t);h.layers=this.layers,h.up.set(0,-1,0),h.lookAt(new Vector3(0,0,1)),this.add(h);const u=new PerspectiveCamera(fov,aspect,n,t);u.layers=this.layers,u.up.set(0,-1,0),u.lookAt(new Vector3(0,0,-1)),this.add(u)}update(n,t){this.parent===null&&this.updateMatrixWorld();const e=this.renderTarget,[i,s,r,o,h,u]=this.children,p=n.xr.enabled,d=n.getRenderTarget();n.xr.enabled=!1;const f=e.texture.generateMipmaps;e.texture.generateMipmaps=!1,n.setRenderTarget(e,0),n.render(t,i),n.setRenderTarget(e,1),n.render(t,s),n.setRenderTarget(e,2),n.render(t,r),n.setRenderTarget(e,3),n.render(t,o),n.setRenderTarget(e,4),n.render(t,h),e.texture.generateMipmaps=f,n.setRenderTarget(e,5),n.render(t,u),n.setRenderTarget(d),n.xr.enabled=p}}class CubeTexture extends Texture{constructor(n,t,e,i,s,r,o,h,u,p){n=n!==void 0?n:[],t=t!==void 0?t:CubeReflectionMapping,o=o!==void 0?o:RGBFormat,super(n,t,e,i,s,r,o,h,u,p),this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(n){this.image=n}}CubeTexture.prototype.isCubeTexture=!0;class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(n,t,e){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=e),super(n,n,t),t=t||{},this.texture=new CubeTexture(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:LinearFilter,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(n,t){this.texture.type=t.type,this.texture.format=RGBAFormat,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const e={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new BoxGeometry(5,5,5),s=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(e.uniforms),vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,side:BackSide,blending:NoBlending});s.uniforms.tEquirect.value=t;const r=new Mesh(i,s),o=t.minFilter;return t.minFilter===LinearMipmapLinearFilter&&(t.minFilter=LinearFilter),new CubeCamera(1,10,this).update(n,r),t.minFilter=o,r.geometry.dispose(),r.material.dispose(),this}clear(n,t,e,i){const s=n.getRenderTarget();for(let r=0;r<6;r++)n.setRenderTarget(this,r),n.clear(t,e,i);n.setRenderTarget(s)}}WebGLCubeRenderTarget.prototype.isWebGLCubeRenderTarget=!0;const _sphere$2=new Sphere$1,_vector$7=new Vector3;class Frustum{constructor(n=new Plane$1,t=new Plane$1,e=new Plane$1,i=new Plane$1,s=new Plane$1,r=new Plane$1){this.planes=[n,t,e,i,s,r]}set(n,t,e,i,s,r){const o=this.planes;return o[0].copy(n),o[1].copy(t),o[2].copy(e),o[3].copy(i),o[4].copy(s),o[5].copy(r),this}copy(n){const t=this.planes;for(let e=0;e<6;e++)t[e].copy(n.planes[e]);return this}setFromProjectionMatrix(n){const t=this.planes,e=n.elements,i=e[0],s=e[1],r=e[2],o=e[3],h=e[4],u=e[5],p=e[6],d=e[7],f=e[8],g=e[9],_=e[10],v=e[11],y=e[12],E=e[13],m=e[14],x=e[15];return t[0].setComponents(o-i,d-h,v-f,x-y).normalize(),t[1].setComponents(o+i,d+h,v+f,x+y).normalize(),t[2].setComponents(o+s,d+u,v+g,x+E).normalize(),t[3].setComponents(o-s,d-u,v-g,x-E).normalize(),t[4].setComponents(o-r,d-p,v-_,x-m).normalize(),t[5].setComponents(o+r,d+p,v+_,x+m).normalize(),this}intersectsObject(n){const t=n.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),_sphere$2.copy(t.boundingSphere).applyMatrix4(n.matrixWorld),this.intersectsSphere(_sphere$2)}intersectsSprite(n){return _sphere$2.center.set(0,0,0),_sphere$2.radius=.7071067811865476,_sphere$2.applyMatrix4(n.matrixWorld),this.intersectsSphere(_sphere$2)}intersectsSphere(n){const t=this.planes,e=n.center,i=-n.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(e)<i)return!1;return!0}intersectsBox(n){const t=this.planes;for(let e=0;e<6;e++){const i=t[e];if(_vector$7.x=i.normal.x>0?n.max.x:n.min.x,_vector$7.y=i.normal.y>0?n.max.y:n.min.y,_vector$7.z=i.normal.z>0?n.max.z:n.min.z,i.distanceToPoint(_vector$7)<0)return!1}return!0}containsPoint(n){const t=this.planes;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function WebGLAnimation(){let l=null,n=!1,t=null,e=null;function i(s,r){t(s,r),e=l.requestAnimationFrame(i)}return{start:function(){n!==!0&&t!==null&&(e=l.requestAnimationFrame(i),n=!0)},stop:function(){l.cancelAnimationFrame(e),n=!1},setAnimationLoop:function(s){t=s},setContext:function(s){l=s}}}function WebGLAttributes(l,n){const t=n.isWebGL2,e=new WeakMap;function i(u,p){const d=u.array,f=u.usage,g=l.createBuffer();l.bindBuffer(p,g),l.bufferData(p,d,f),u.onUploadCallback();let _=5126;return d instanceof Float32Array?_=5126:d instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):d instanceof Uint16Array?u.isFloat16BufferAttribute?t?_=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):_=5123:d instanceof Int16Array?_=5122:d instanceof Uint32Array?_=5125:d instanceof Int32Array?_=5124:d instanceof Int8Array?_=5120:(d instanceof Uint8Array||d instanceof Uint8ClampedArray)&&(_=5121),{buffer:g,type:_,bytesPerElement:d.BYTES_PER_ELEMENT,version:u.version}}function s(u,p,d){const f=p.array,g=p.updateRange;l.bindBuffer(d,u),g.count===-1?l.bufferSubData(d,0,f):(t?l.bufferSubData(d,g.offset*f.BYTES_PER_ELEMENT,f,g.offset,g.count):l.bufferSubData(d,g.offset*f.BYTES_PER_ELEMENT,f.subarray(g.offset,g.offset+g.count)),g.count=-1)}function r(u){return u.isInterleavedBufferAttribute&&(u=u.data),e.get(u)}function o(u){u.isInterleavedBufferAttribute&&(u=u.data);const p=e.get(u);p&&(l.deleteBuffer(p.buffer),e.delete(u))}function h(u,p){if(u.isGLBufferAttribute){const f=e.get(u);(!f||f.version<u.version)&&e.set(u,{buffer:u.buffer,type:u.type,bytesPerElement:u.elementSize,version:u.version});return}u.isInterleavedBufferAttribute&&(u=u.data);const d=e.get(u);d===void 0?e.set(u,i(u,p)):d.version<u.version&&(s(d.buffer,u,p),d.version=u.version)}return{get:r,remove:o,update:h}}class PlaneGeometry extends BufferGeometry{constructor(n=1,t=1,e=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:n,height:t,widthSegments:e,heightSegments:i};const s=n/2,r=t/2,o=Math.floor(e),h=Math.floor(i),u=o+1,p=h+1,d=n/o,f=t/h,g=[],_=[],v=[],y=[];for(let E=0;E<p;E++){const m=E*f-r;for(let x=0;x<u;x++){const C=x*d-s;_.push(C,-m,0),v.push(0,0,1),y.push(x/o),y.push(1-E/h)}}for(let E=0;E<h;E++)for(let m=0;m<o;m++){const x=m+u*E,C=m+u*(E+1),O=m+1+u*(E+1),S=m+1+u*E;g.push(x,C,S),g.push(C,O,S)}this.setIndex(g),this.setAttribute("position",new Float32BufferAttribute(_,3)),this.setAttribute("normal",new Float32BufferAttribute(v,3)),this.setAttribute("uv",new Float32BufferAttribute(y,2))}}var alphamap_fragment=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,alphamap_pars_fragment=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,aomap_fragment=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,aomap_pars_fragment=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex="vec3 transformed = vec3( position );",beginnormal_vertex=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs=`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,bumpmap_pars_fragment=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,cube_uv_reflection_fragment=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,envmap_fragment=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_vertex=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex=`#ifdef USE_FOG
	fogDepth = - mvPosition.z;
#endif`,fog_pars_vertex=`#ifdef USE_FOG
	varying float fogDepth;
#endif`,fog_fragment=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,lightmap_fragment=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,lightmap_pars_fragment=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_vertex=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,lights_pars_begin=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,envmap_physical_pars_fragment=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( -viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
			vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,lights_toon_fragment=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), rawDiffuseColor, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), rawDiffuseColor, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,lights_physical_pars_fragment=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float specularRoughness;
	vec3 specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,lights_fragment_end=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,map_pars_fragment=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphnormal_vertex=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,morphtarget_pars_vertex=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
		uniform float morphTargetInfluences[ 8 ];
	#else
		uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,morphtarget_vertex=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
		transformed += morphTarget4 * morphTargetInfluences[ 4 ];
		transformed += morphTarget5 * morphTargetInfluences[ 5 ];
		transformed += morphTarget6 * morphTargetInfluences[ 6 ];
		transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,normal_fragment_begin=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normalmap_pars_fragment=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,clearcoat_normal_fragment_begin=`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,clearcoat_pars_fragment=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,packing=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,shadowmask_pars_fragment=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,skinning_vertex=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment=`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment=`#ifdef USE_TRANSMISSION
	#ifdef USE_TRANSMISSIONMAP
		totalTransmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSNMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition.xyz / vWorldPosition.w;
	vec3 v = normalize( cameraPosition - pos );
	vec3 viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
	float ior = ( 1.0 + 0.4 * reflectivity ) / ( 1.0 - 0.4 * reflectivity );
	vec3 f0 = vec3( pow( ior - 1.0, 2.0 ) / pow( ior + 1.0, 2.0 ) );
	vec3 f90 = vec3( 1.0 );
	vec3 f_transmission = totalTransmission * getIBLVolumeRefraction(
		normal, v, viewDir, roughnessFactor, diffuseColor.rgb, f0, f90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance);
	diffuseColor.rgb = mix( diffuseColor.rgb, f_transmission, totalTransmission );
#endif`,transmission_pars_fragment=`#ifdef USE_TRANSMISSION
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec4 vWorldPosition;
	vec3 getVolumeTransmissionRay(vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix) {
		vec3 refractionVector = refract(-v, normalize(n), 1.0 / ior);
		vec3 modelScale;
		modelScale.x = length(vec3(modelMatrix[0].xyz));
		modelScale.y = length(vec3(modelMatrix[1].xyz));
		modelScale.z = length(vec3(modelMatrix[2].xyz));
		return normalize(refractionVector) * thickness * modelScale;
	}
	float applyIorToRoughness(float roughness, float ior) {
		return roughness * clamp(ior * 2.0 - 2.0, 0.0, 1.0);
	}
	vec3 getTransmissionSample(vec2 fragCoord, float roughness, float ior) {
		float framebufferLod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness, ior);
		return texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod).rgb;
	}
	vec3 applyVolumeAttenuation(vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance) {
		if (attenuationDistance == 0.0) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log(attenuationColor) / attenuationDistance;
			vec3 transmittance = exp(-attenuationCoefficient * transmissionDistance);			return transmittance * radiance;
		}
	}
	vec3 getIBLVolumeRefraction(vec3 n, vec3 v, vec3 viewDir, float perceptualRoughness, vec3 baseColor, vec3 f0, vec3 f90,
		vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec3 attenuationColor, float attenuationDistance) {
		vec3 transmissionRay = getVolumeTransmissionRay(n, v, thickness, ior, modelMatrix);
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4(refractedRayExit, 1.0);
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec3 transmittedLight = getTransmissionSample(refractionCoords, perceptualRoughness, ior);
		vec3 attenuatedColor = applyVolumeAttenuation(transmittedLight, length(transmissionRay), attenuationColor, attenuationDistance);
		float NdotV = saturate(dot(n, viewDir));
		vec2 brdf = integrateSpecularBRDF(NdotV, perceptualRoughness);
		vec3 specularColor = f0 * brdf.x + f90 * brdf.y;
		return (1.0 - specularColor) * attenuatedColor * baseColor;
	}
#endif`,uv_pars_fragment=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_frag=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,background_vert=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,cube_frag=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,depth_frag=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,depth_vert=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,distanceRGBA_frag=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,distanceRGBA_vert=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,equirect_frag=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,equirect_vert=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,linedashed_frag=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,linedashed_vert=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,meshbasic_frag=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshbasic_vert=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshmatcap_frag=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert=`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshtoon_frag=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert=`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphong_vert=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphysical_frag=`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform vec3 attenuationColor;
	uniform float attenuationDistance;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <transmission_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#ifdef USE_TRANSMISSION
		float totalTransmission = transmission;
		float thicknessFactor = thickness;
	#endif
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	vec3 rawDiffuseColor = diffuseColor.rgb;
	#include <transmission_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert=`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#ifdef USE_TRANSMISSION
	varying vec4 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition;
#endif
}`,normal_frag=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,normal_vert=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,points_frag=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,points_vert=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,shadow_frag=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,shadow_vert=`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sprite_frag=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`;const ShaderChunk={alphamap_fragment,alphamap_pars_fragment,alphatest_fragment,aomap_fragment,aomap_pars_fragment,begin_vertex,beginnormal_vertex,bsdfs,bumpmap_pars_fragment,clipping_planes_fragment,clipping_planes_pars_fragment,clipping_planes_pars_vertex,clipping_planes_vertex,color_fragment,color_pars_fragment,color_pars_vertex,color_vertex,common,cube_uv_reflection_fragment,defaultnormal_vertex,displacementmap_pars_vertex,displacementmap_vertex,emissivemap_fragment,emissivemap_pars_fragment,encodings_fragment,encodings_pars_fragment,envmap_fragment,envmap_common_pars_fragment,envmap_pars_fragment,envmap_pars_vertex,envmap_physical_pars_fragment,envmap_vertex,fog_vertex,fog_pars_vertex,fog_fragment,fog_pars_fragment,gradientmap_pars_fragment,lightmap_fragment,lightmap_pars_fragment,lights_lambert_vertex,lights_pars_begin,lights_toon_fragment,lights_toon_pars_fragment,lights_phong_fragment,lights_phong_pars_fragment,lights_physical_fragment,lights_physical_pars_fragment,lights_fragment_begin,lights_fragment_maps,lights_fragment_end,logdepthbuf_fragment,logdepthbuf_pars_fragment,logdepthbuf_pars_vertex,logdepthbuf_vertex,map_fragment,map_pars_fragment,map_particle_fragment,map_particle_pars_fragment,metalnessmap_fragment,metalnessmap_pars_fragment,morphnormal_vertex,morphtarget_pars_vertex,morphtarget_vertex,normal_fragment_begin,normal_fragment_maps,normalmap_pars_fragment,clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps,clearcoat_pars_fragment,packing,premultiplied_alpha_fragment,project_vertex,dithering_fragment,dithering_pars_fragment,roughnessmap_fragment,roughnessmap_pars_fragment,shadowmap_pars_fragment,shadowmap_pars_vertex,shadowmap_vertex,shadowmask_pars_fragment,skinbase_vertex,skinning_pars_vertex,skinning_vertex,skinnormal_vertex,specularmap_fragment,specularmap_pars_fragment,tonemapping_fragment,tonemapping_pars_fragment,transmission_fragment,transmission_pars_fragment,uv_pars_fragment,uv_pars_vertex,uv_vertex,uv2_pars_fragment,uv2_pars_vertex,uv2_vertex,worldpos_vertex,background_frag,background_vert,cube_frag,cube_vert,depth_frag,depth_vert,distanceRGBA_frag,distanceRGBA_vert,equirect_frag,equirect_vert,linedashed_frag,linedashed_vert,meshbasic_frag,meshbasic_vert,meshlambert_frag,meshlambert_vert,meshmatcap_frag,meshmatcap_vert,meshtoon_frag,meshtoon_vert,meshphong_frag,meshphong_vert,meshphysical_frag,meshphysical_vert,normal_frag,normal_vert,points_frag,points_vert,shadow_frag,shadow_vert,sprite_frag,sprite_vert},UniformsLib={common:{diffuse:{value:new Color(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},uv2Transform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.normal_vert,fragmentShader:ShaderChunk.normal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},cube:{uniforms:mergeUniforms([UniformsLib.envmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Color(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};function WebGLBackground(l,n,t,e,i){const s=new Color(0);let r=0,o,h,u=null,p=0,d=null;function f(_,v){let y=!1,E=v.isScene===!0?v.background:null;E&&E.isTexture&&(E=n.get(E));const m=l.xr,x=m.getSession&&m.getSession();x&&x.environmentBlendMode==="additive"&&(E=null),E===null?g(s,r):E&&E.isColor&&(g(E,1),y=!0),(l.autoClear||y)&&l.clear(l.autoClearColor,l.autoClearDepth,l.autoClearStencil),E&&(E.isCubeTexture||E.mapping===CubeUVReflectionMapping)?(h===void 0&&(h=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.cube.uniforms),vertexShader:ShaderLib.cube.vertexShader,fragmentShader:ShaderLib.cube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(C,O,S){this.matrixWorld.copyPosition(S.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),e.update(h)),h.material.uniforms.envMap.value=E,h.material.uniforms.flipEnvMap.value=E.isCubeTexture&&E._needsFlipEnvMap?-1:1,(u!==E||p!==E.version||d!==l.toneMapping)&&(h.material.needsUpdate=!0,u=E,p=E.version,d=l.toneMapping),_.unshift(h,h.geometry,h.material,0,0,null)):E&&E.isTexture&&(o===void 0&&(o=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),e.update(o)),o.material.uniforms.t2D.value=E,E.matrixAutoUpdate===!0&&E.updateMatrix(),o.material.uniforms.uvTransform.value.copy(E.matrix),(u!==E||p!==E.version||d!==l.toneMapping)&&(o.material.needsUpdate=!0,u=E,p=E.version,d=l.toneMapping),_.unshift(o,o.geometry,o.material,0,0,null))}function g(_,v){t.buffers.color.setClear(_.r,_.g,_.b,v,i)}return{getClearColor:function(){return s},setClearColor:function(_,v=1){s.set(_),r=v,g(s,r)},getClearAlpha:function(){return r},setClearAlpha:function(_){r=_,g(s,r)},render:f}}function WebGLBindingStates(l,n,t,e){const i=l.getParameter(34921),s=e.isWebGL2?null:n.get("OES_vertex_array_object"),r=e.isWebGL2||s!==null,o={},h=v(null);let u=h;function p(A,G,D,M,J){let et=!1;if(r){const Q=_(M,D,G);u!==Q&&(u=Q,f(u.object)),et=y(M,J),et&&E(M,J)}else{const Q=G.wireframe===!0;(u.geometry!==M.id||u.program!==D.id||u.wireframe!==Q)&&(u.geometry=M.id,u.program=D.id,u.wireframe=Q,et=!0)}A.isInstancedMesh===!0&&(et=!0),J!==null&&t.update(J,34963),et&&(P(A,G,D,M),J!==null&&l.bindBuffer(34963,t.get(J).buffer))}function d(){return e.isWebGL2?l.createVertexArray():s.createVertexArrayOES()}function f(A){return e.isWebGL2?l.bindVertexArray(A):s.bindVertexArrayOES(A)}function g(A){return e.isWebGL2?l.deleteVertexArray(A):s.deleteVertexArrayOES(A)}function _(A,G,D){const M=D.wireframe===!0;let J=o[A.id];J===void 0&&(J={},o[A.id]=J);let et=J[G.id];et===void 0&&(et={},J[G.id]=et);let Q=et[M];return Q===void 0&&(Q=v(d()),et[M]=Q),Q}function v(A){const G=[],D=[],M=[];for(let J=0;J<i;J++)G[J]=0,D[J]=0,M[J]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:G,enabledAttributes:D,attributeDivisors:M,object:A,attributes:{},index:null}}function y(A,G){const D=u.attributes,M=A.attributes;let J=0;for(const et in M){const Q=D[et],ot=M[et];if(Q===void 0||Q.attribute!==ot||Q.data!==ot.data)return!0;J++}return u.attributesNum!==J||u.index!==G}function E(A,G){const D={},M=A.attributes;let J=0;for(const et in M){const Q=M[et],ot={};ot.attribute=Q,Q.data&&(ot.data=Q.data),D[et]=ot,J++}u.attributes=D,u.attributesNum=J,u.index=G}function m(){const A=u.newAttributes;for(let G=0,D=A.length;G<D;G++)A[G]=0}function x(A){C(A,0)}function C(A,G){const D=u.newAttributes,M=u.enabledAttributes,J=u.attributeDivisors;D[A]=1,M[A]===0&&(l.enableVertexAttribArray(A),M[A]=1),J[A]!==G&&((e.isWebGL2?l:n.get("ANGLE_instanced_arrays"))[e.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](A,G),J[A]=G)}function O(){const A=u.newAttributes,G=u.enabledAttributes;for(let D=0,M=G.length;D<M;D++)G[D]!==A[D]&&(l.disableVertexAttribArray(D),G[D]=0)}function S(A,G,D,M,J,et){e.isWebGL2===!0&&(D===5124||D===5125)?l.vertexAttribIPointer(A,G,D,J,et):l.vertexAttribPointer(A,G,D,M,J,et)}function P(A,G,D,M){if(e.isWebGL2===!1&&(A.isInstancedMesh||M.isInstancedBufferGeometry)&&n.get("ANGLE_instanced_arrays")===null)return;m();const J=M.attributes,et=D.getAttributes(),Q=G.defaultAttributeValues;for(const ot in et){const tt=et[ot];if(tt>=0){const rt=J[ot];if(rt!==void 0){const ft=rt.normalized,_t=rt.itemSize,yt=t.get(rt);if(yt===void 0)continue;const Z=yt.buffer,bt=yt.type,at=yt.bytesPerElement;if(rt.isInterleavedBufferAttribute){const nt=rt.data,ht=nt.stride,Ct=rt.offset;nt&&nt.isInstancedInterleavedBuffer?(C(tt,nt.meshPerAttribute),M._maxInstanceCount===void 0&&(M._maxInstanceCount=nt.meshPerAttribute*nt.count)):x(tt),l.bindBuffer(34962,Z),S(tt,_t,bt,ft,ht*at,Ct*at)}else rt.isInstancedBufferAttribute?(C(tt,rt.meshPerAttribute),M._maxInstanceCount===void 0&&(M._maxInstanceCount=rt.meshPerAttribute*rt.count)):x(tt),l.bindBuffer(34962,Z),S(tt,_t,bt,ft,0,0)}else if(ot==="instanceMatrix"){const ft=t.get(A.instanceMatrix);if(ft===void 0)continue;const _t=ft.buffer,yt=ft.type;C(tt+0,1),C(tt+1,1),C(tt+2,1),C(tt+3,1),l.bindBuffer(34962,_t),l.vertexAttribPointer(tt+0,4,yt,!1,64,0),l.vertexAttribPointer(tt+1,4,yt,!1,64,16),l.vertexAttribPointer(tt+2,4,yt,!1,64,32),l.vertexAttribPointer(tt+3,4,yt,!1,64,48)}else if(ot==="instanceColor"){const ft=t.get(A.instanceColor);if(ft===void 0)continue;const _t=ft.buffer,yt=ft.type;C(tt,1),l.bindBuffer(34962,_t),l.vertexAttribPointer(tt,3,yt,!1,12,0)}else if(Q!==void 0){const ft=Q[ot];if(ft!==void 0)switch(ft.length){case 2:l.vertexAttrib2fv(tt,ft);break;case 3:l.vertexAttrib3fv(tt,ft);break;case 4:l.vertexAttrib4fv(tt,ft);break;default:l.vertexAttrib1fv(tt,ft)}}}}O()}function F(){B();for(const A in o){const G=o[A];for(const D in G){const M=G[D];for(const J in M)g(M[J].object),delete M[J];delete G[D]}delete o[A]}}function V(A){if(o[A.id]===void 0)return;const G=o[A.id];for(const D in G){const M=G[D];for(const J in M)g(M[J].object),delete M[J];delete G[D]}delete o[A.id]}function N(A){for(const G in o){const D=o[G];if(D[A.id]===void 0)continue;const M=D[A.id];for(const J in M)g(M[J].object),delete M[J];delete D[A.id]}}function B(){W(),u!==h&&(u=h,f(u.object))}function W(){h.geometry=null,h.program=null,h.wireframe=!1}return{setup:p,reset:B,resetDefaultState:W,dispose:F,releaseStatesOfGeometry:V,releaseStatesOfProgram:N,initAttributes:m,enableAttribute:x,disableUnusedAttributes:O}}function WebGLBufferRenderer(l,n,t,e){const i=e.isWebGL2;let s;function r(u){s=u}function o(u,p){l.drawArrays(s,u,p),t.update(p,s,1)}function h(u,p,d){if(d===0)return;let f,g;if(i)f=l,g="drawArraysInstanced";else if(f=n.get("ANGLE_instanced_arrays"),g="drawArraysInstancedANGLE",f===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}f[g](s,u,p,d),t.update(p,s,d)}this.setMode=r,this.render=o,this.renderInstances=h}function WebGLCapabilities(l,n,t){let e;function i(){if(e!==void 0)return e;if(n.has("EXT_texture_filter_anisotropic")===!0){const P=n.get("EXT_texture_filter_anisotropic");e=l.getParameter(P.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else e=0;return e}function s(P){if(P==="highp"){if(l.getShaderPrecisionFormat(35633,36338).precision>0&&l.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";P="mediump"}return P==="mediump"&&l.getShaderPrecisionFormat(35633,36337).precision>0&&l.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const r=typeof WebGL2RenderingContext<"u"&&l instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&l instanceof WebGL2ComputeRenderingContext;let o=t.precision!==void 0?t.precision:"highp";const h=s(o);h!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",h,"instead."),o=h);const u=r||n.has("WEBGL_draw_buffers"),p=t.logarithmicDepthBuffer===!0,d=l.getParameter(34930),f=l.getParameter(35660),g=l.getParameter(3379),_=l.getParameter(34076),v=l.getParameter(34921),y=l.getParameter(36347),E=l.getParameter(36348),m=l.getParameter(36349),x=f>0,C=r||n.has("OES_texture_float"),O=x&&C,S=r?l.getParameter(36183):0;return{isWebGL2:r,drawBuffers:u,getMaxAnisotropy:i,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:p,maxTextures:d,maxVertexTextures:f,maxTextureSize:g,maxCubemapSize:_,maxAttributes:v,maxVertexUniforms:y,maxVaryings:E,maxFragmentUniforms:m,vertexTextures:x,floatFragmentTextures:C,floatVertexTextures:O,maxSamples:S}}function WebGLClipping(l){const n=this;let t=null,e=0,i=!1,s=!1;const r=new Plane$1,o=new Matrix3,h={value:null,needsUpdate:!1};this.uniform=h,this.numPlanes=0,this.numIntersection=0,this.init=function(d,f,g){const _=d.length!==0||f||e!==0||i;return i=f,t=p(d,g,0),e=d.length,_},this.beginShadows=function(){s=!0,p(null)},this.endShadows=function(){s=!1,u()},this.setState=function(d,f,g){const _=d.clippingPlanes,v=d.clipIntersection,y=d.clipShadows,E=l.get(d);if(!i||_===null||_.length===0||s&&!y)s?p(null):u();else{const m=s?0:e,x=m*4;let C=E.clippingState||null;h.value=C,C=p(_,f,x,g);for(let O=0;O!==x;++O)C[O]=t[O];E.clippingState=C,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=m}};function u(){h.value!==t&&(h.value=t,h.needsUpdate=e>0),n.numPlanes=e,n.numIntersection=0}function p(d,f,g,_){const v=d!==null?d.length:0;let y=null;if(v!==0){if(y=h.value,_!==!0||y===null){const E=g+v*4,m=f.matrixWorldInverse;o.getNormalMatrix(m),(y===null||y.length<E)&&(y=new Float32Array(E));for(let x=0,C=g;x!==v;++x,C+=4)r.copy(d[x]).applyMatrix4(m,o),r.normal.toArray(y,C),y[C+3]=r.constant}h.value=y,h.needsUpdate=!0}return n.numPlanes=v,n.numIntersection=0,y}}function WebGLCubeMaps(l){let n=new WeakMap;function t(r,o){return o===EquirectangularReflectionMapping?r.mapping=CubeReflectionMapping:o===EquirectangularRefractionMapping&&(r.mapping=CubeRefractionMapping),r}function e(r){if(r&&r.isTexture){const o=r.mapping;if(o===EquirectangularReflectionMapping||o===EquirectangularRefractionMapping)if(n.has(r)){const h=n.get(r).texture;return t(h,r.mapping)}else{const h=r.image;if(h&&h.height>0){const u=l.getRenderTarget(),p=new WebGLCubeRenderTarget(h.height/2);return p.fromEquirectangularTexture(l,r),n.set(r,p),l.setRenderTarget(u),r.addEventListener("dispose",i),t(p.texture,r.mapping)}else return null}}return r}function i(r){const o=r.target;o.removeEventListener("dispose",i);const h=n.get(o);h!==void 0&&(n.delete(o),h.dispose())}function s(){n=new WeakMap}return{get:e,dispose:s}}function WebGLExtensions(l){const n={};function t(e){if(n[e]!==void 0)return n[e];let i;switch(e){case"WEBGL_depth_texture":i=l.getExtension("WEBGL_depth_texture")||l.getExtension("MOZ_WEBGL_depth_texture")||l.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=l.getExtension("WEBGL_compressed_texture_s3tc")||l.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||l.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=l.getExtension("WEBGL_compressed_texture_pvrtc")||l.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=l.getExtension(e)}return n[e]=i,i}return{has:function(e){return t(e)!==null},init:function(e){e.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float")},get:function(e){const i=t(e);return i===null&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),i}}}function WebGLGeometries(l,n,t,e){const i={},s=new WeakMap;function r(d){const f=d.target;f.index!==null&&n.remove(f.index);for(const _ in f.attributes)n.remove(f.attributes[_]);f.removeEventListener("dispose",r),delete i[f.id];const g=s.get(f);g&&(n.remove(g),s.delete(f)),e.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}function o(d,f){return i[f.id]===!0||(f.addEventListener("dispose",r),i[f.id]=!0,t.memory.geometries++),f}function h(d){const f=d.attributes;for(const _ in f)n.update(f[_],34962);const g=d.morphAttributes;for(const _ in g){const v=g[_];for(let y=0,E=v.length;y<E;y++)n.update(v[y],34962)}}function u(d){const f=[],g=d.index,_=d.attributes.position;let v=0;if(g!==null){const m=g.array;v=g.version;for(let x=0,C=m.length;x<C;x+=3){const O=m[x+0],S=m[x+1],P=m[x+2];f.push(O,S,S,P,P,O)}}else{const m=_.array;v=_.version;for(let x=0,C=m.length/3-1;x<C;x+=3){const O=x+0,S=x+1,P=x+2;f.push(O,S,S,P,P,O)}}const y=new(arrayMax(f)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(f,1);y.version=v;const E=s.get(d);E&&n.remove(E),s.set(d,y)}function p(d){const f=s.get(d);if(f){const g=d.index;g!==null&&f.version<g.version&&u(d)}else u(d);return s.get(d)}return{get:o,update:h,getWireframeAttribute:p}}function WebGLIndexedBufferRenderer(l,n,t,e){const i=e.isWebGL2;let s;function r(f){s=f}let o,h;function u(f){o=f.type,h=f.bytesPerElement}function p(f,g){l.drawElements(s,g,o,f*h),t.update(g,s,1)}function d(f,g,_){if(_===0)return;let v,y;if(i)v=l,y="drawElementsInstanced";else if(v=n.get("ANGLE_instanced_arrays"),y="drawElementsInstancedANGLE",v===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}v[y](s,g,o,f*h,_),t.update(g,s,_)}this.setMode=r,this.setIndex=u,this.render=p,this.renderInstances=d}function WebGLInfo(l){const n={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function e(s,r,o){switch(t.calls++,r){case 4:t.triangles+=o*(s/3);break;case 1:t.lines+=o*(s/2);break;case 3:t.lines+=o*(s-1);break;case 2:t.lines+=o*s;break;case 0:t.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r);break}}function i(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:n,render:t,programs:null,autoReset:!0,reset:i,update:e}}function numericalSort(l,n){return l[0]-n[0]}function absNumericalSort(l,n){return Math.abs(n[1])-Math.abs(l[1])}function WebGLMorphtargets(l){const n={},t=new Float32Array(8),e=[];for(let s=0;s<8;s++)e[s]=[s,0];function i(s,r,o,h){const u=s.morphTargetInfluences,p=u===void 0?0:u.length;let d=n[r.id];if(d===void 0){d=[];for(let y=0;y<p;y++)d[y]=[y,0];n[r.id]=d}for(let y=0;y<p;y++){const E=d[y];E[0]=y,E[1]=u[y]}d.sort(absNumericalSort);for(let y=0;y<8;y++)y<p&&d[y][1]?(e[y][0]=d[y][0],e[y][1]=d[y][1]):(e[y][0]=Number.MAX_SAFE_INTEGER,e[y][1]=0);e.sort(numericalSort);const f=o.morphTargets&&r.morphAttributes.position,g=o.morphNormals&&r.morphAttributes.normal;let _=0;for(let y=0;y<8;y++){const E=e[y],m=E[0],x=E[1];m!==Number.MAX_SAFE_INTEGER&&x?(f&&r.getAttribute("morphTarget"+y)!==f[m]&&r.setAttribute("morphTarget"+y,f[m]),g&&r.getAttribute("morphNormal"+y)!==g[m]&&r.setAttribute("morphNormal"+y,g[m]),t[y]=x,_+=x):(f&&r.hasAttribute("morphTarget"+y)===!0&&r.deleteAttribute("morphTarget"+y),g&&r.hasAttribute("morphNormal"+y)===!0&&r.deleteAttribute("morphNormal"+y),t[y]=0)}const v=r.morphTargetsRelative?1:1-_;h.getUniforms().setValue(l,"morphTargetBaseInfluence",v),h.getUniforms().setValue(l,"morphTargetInfluences",t)}return{update:i}}function WebGLObjects(l,n,t,e){let i=new WeakMap;function s(h){const u=e.render.frame,p=h.geometry,d=n.get(h,p);return i.get(d)!==u&&(n.update(d),i.set(d,u)),h.isInstancedMesh&&(h.hasEventListener("dispose",o)===!1&&h.addEventListener("dispose",o),t.update(h.instanceMatrix,34962),h.instanceColor!==null&&t.update(h.instanceColor,34962)),d}function r(){i=new WeakMap}function o(h){const u=h.target;u.removeEventListener("dispose",o),t.remove(u.instanceMatrix),u.instanceColor!==null&&t.remove(u.instanceColor)}return{update:s,dispose:r}}class DataTexture2DArray extends Texture{constructor(n=null,t=1,e=1,i=1){super(null),this.image={data:n,width:t,height:e,depth:i},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}DataTexture2DArray.prototype.isDataTexture2DArray=!0;class DataTexture3D extends Texture{constructor(n=null,t=1,e=1,i=1){super(null),this.image={data:n,width:t,height:e,depth:i},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}DataTexture3D.prototype.isDataTexture3D=!0;const emptyTexture=new Texture,emptyTexture2dArray=new DataTexture2DArray,emptyTexture3d=new DataTexture3D,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(l,n,t){const e=l[0];if(e<=0||e>0)return l;const i=n*t;let s=arrayCacheF32[i];if(s===void 0&&(s=new Float32Array(i),arrayCacheF32[i]=s),n!==0){e.toArray(s,0);for(let r=1,o=0;r!==n;++r)o+=t,l[r].toArray(s,o)}return s}function arraysEqual(l,n){if(l.length!==n.length)return!1;for(let t=0,e=l.length;t<e;t++)if(l[t]!==n[t])return!1;return!0}function copyArray(l,n){for(let t=0,e=n.length;t<e;t++)l[t]=n[t]}function allocTexUnits(l,n){let t=arrayCacheI32[n];t===void 0&&(t=new Int32Array(n),arrayCacheI32[n]=t);for(let e=0;e!==n;++e)t[e]=l.allocateTextureUnit();return t}function setValueV1f(l,n){const t=this.cache;t[0]!==n&&(l.uniform1f(this.addr,n),t[0]=n)}function setValueV2f(l,n){const t=this.cache;if(n.x!==void 0)(t[0]!==n.x||t[1]!==n.y)&&(l.uniform2f(this.addr,n.x,n.y),t[0]=n.x,t[1]=n.y);else{if(arraysEqual(t,n))return;l.uniform2fv(this.addr,n),copyArray(t,n)}}function setValueV3f(l,n){const t=this.cache;if(n.x!==void 0)(t[0]!==n.x||t[1]!==n.y||t[2]!==n.z)&&(l.uniform3f(this.addr,n.x,n.y,n.z),t[0]=n.x,t[1]=n.y,t[2]=n.z);else if(n.r!==void 0)(t[0]!==n.r||t[1]!==n.g||t[2]!==n.b)&&(l.uniform3f(this.addr,n.r,n.g,n.b),t[0]=n.r,t[1]=n.g,t[2]=n.b);else{if(arraysEqual(t,n))return;l.uniform3fv(this.addr,n),copyArray(t,n)}}function setValueV4f(l,n){const t=this.cache;if(n.x!==void 0)(t[0]!==n.x||t[1]!==n.y||t[2]!==n.z||t[3]!==n.w)&&(l.uniform4f(this.addr,n.x,n.y,n.z,n.w),t[0]=n.x,t[1]=n.y,t[2]=n.z,t[3]=n.w);else{if(arraysEqual(t,n))return;l.uniform4fv(this.addr,n),copyArray(t,n)}}function setValueM2(l,n){const t=this.cache,e=n.elements;if(e===void 0){if(arraysEqual(t,n))return;l.uniformMatrix2fv(this.addr,!1,n),copyArray(t,n)}else{if(arraysEqual(t,e))return;mat2array.set(e),l.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(t,e)}}function setValueM3(l,n){const t=this.cache,e=n.elements;if(e===void 0){if(arraysEqual(t,n))return;l.uniformMatrix3fv(this.addr,!1,n),copyArray(t,n)}else{if(arraysEqual(t,e))return;mat3array.set(e),l.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(t,e)}}function setValueM4(l,n){const t=this.cache,e=n.elements;if(e===void 0){if(arraysEqual(t,n))return;l.uniformMatrix4fv(this.addr,!1,n),copyArray(t,n)}else{if(arraysEqual(t,e))return;mat4array.set(e),l.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(t,e)}}function setValueV1i(l,n){const t=this.cache;t[0]!==n&&(l.uniform1i(this.addr,n),t[0]=n)}function setValueV2i(l,n){const t=this.cache;arraysEqual(t,n)||(l.uniform2iv(this.addr,n),copyArray(t,n))}function setValueV3i(l,n){const t=this.cache;arraysEqual(t,n)||(l.uniform3iv(this.addr,n),copyArray(t,n))}function setValueV4i(l,n){const t=this.cache;arraysEqual(t,n)||(l.uniform4iv(this.addr,n),copyArray(t,n))}function setValueV1ui(l,n){const t=this.cache;t[0]!==n&&(l.uniform1ui(this.addr,n),t[0]=n)}function setValueV2ui(l,n){const t=this.cache;arraysEqual(t,n)||(l.uniform2uiv(this.addr,n),copyArray(t,n))}function setValueV3ui(l,n){const t=this.cache;arraysEqual(t,n)||(l.uniform3uiv(this.addr,n),copyArray(t,n))}function setValueV4ui(l,n){const t=this.cache;arraysEqual(t,n)||(l.uniform4uiv(this.addr,n),copyArray(t,n))}function setValueT1(l,n,t){const e=this.cache,i=t.allocateTextureUnit();e[0]!==i&&(l.uniform1i(this.addr,i),e[0]=i),t.safeSetTexture2D(n||emptyTexture,i)}function setValueT3D1(l,n,t){const e=this.cache,i=t.allocateTextureUnit();e[0]!==i&&(l.uniform1i(this.addr,i),e[0]=i),t.setTexture3D(n||emptyTexture3d,i)}function setValueT6(l,n,t){const e=this.cache,i=t.allocateTextureUnit();e[0]!==i&&(l.uniform1i(this.addr,i),e[0]=i),t.safeSetTextureCube(n||emptyCubeTexture,i)}function setValueT2DArray1(l,n,t){const e=this.cache,i=t.allocateTextureUnit();e[0]!==i&&(l.uniform1i(this.addr,i),e[0]=i),t.setTexture2DArray(n||emptyTexture2dArray,i)}function getSingularSetter(l){switch(l){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(l,n){l.uniform1fv(this.addr,n)}function setValueV2fArray(l,n){const t=flatten(n,this.size,2);l.uniform2fv(this.addr,t)}function setValueV3fArray(l,n){const t=flatten(n,this.size,3);l.uniform3fv(this.addr,t)}function setValueV4fArray(l,n){const t=flatten(n,this.size,4);l.uniform4fv(this.addr,t)}function setValueM2Array(l,n){const t=flatten(n,this.size,4);l.uniformMatrix2fv(this.addr,!1,t)}function setValueM3Array(l,n){const t=flatten(n,this.size,9);l.uniformMatrix3fv(this.addr,!1,t)}function setValueM4Array(l,n){const t=flatten(n,this.size,16);l.uniformMatrix4fv(this.addr,!1,t)}function setValueV1iArray(l,n){l.uniform1iv(this.addr,n)}function setValueV2iArray(l,n){l.uniform2iv(this.addr,n)}function setValueV3iArray(l,n){l.uniform3iv(this.addr,n)}function setValueV4iArray(l,n){l.uniform4iv(this.addr,n)}function setValueV1uiArray(l,n){l.uniform1uiv(this.addr,n)}function setValueV2uiArray(l,n){l.uniform2uiv(this.addr,n)}function setValueV3uiArray(l,n){l.uniform3uiv(this.addr,n)}function setValueV4uiArray(l,n){l.uniform4uiv(this.addr,n)}function setValueT1Array(l,n,t){const e=n.length,i=allocTexUnits(t,e);l.uniform1iv(this.addr,i);for(let s=0;s!==e;++s)t.safeSetTexture2D(n[s]||emptyTexture,i[s])}function setValueT6Array(l,n,t){const e=n.length,i=allocTexUnits(t,e);l.uniform1iv(this.addr,i);for(let s=0;s!==e;++s)t.safeSetTextureCube(n[s]||emptyCubeTexture,i[s])}function getPureArraySetter(l){switch(l){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35680:case 36300:case 36308:case 36293:return setValueT6Array}}function SingleUniform(l,n,t){this.id=l,this.addr=t,this.cache=[],this.setValue=getSingularSetter(n.type)}function PureArrayUniform(l,n,t){this.id=l,this.addr=t,this.cache=[],this.size=n.size,this.setValue=getPureArraySetter(n.type)}PureArrayUniform.prototype.updateCache=function(l){const n=this.cache;l instanceof Float32Array&&n.length!==l.length&&(this.cache=new Float32Array(l.length)),copyArray(n,l)};function StructuredUniform(l){this.id=l,this.seq=[],this.map={}}StructuredUniform.prototype.setValue=function(l,n,t){const e=this.seq;for(let i=0,s=e.length;i!==s;++i){const r=e[i];r.setValue(l,n[r.id],t)}};const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(l,n){l.seq.push(n),l.map[n.id]=n}function parseUniform(l,n,t){const e=l.name,i=e.length;for(RePathPart.lastIndex=0;;){const s=RePathPart.exec(e),r=RePathPart.lastIndex;let o=s[1];const h=s[2]==="]",u=s[3];if(h&&(o=o|0),u===void 0||u==="["&&r+2===i){addUniform(t,u===void 0?new SingleUniform(o,l,n):new PureArrayUniform(o,l,n));break}else{let d=t.map[o];d===void 0&&(d=new StructuredUniform(o),addUniform(t,d)),t=d}}}function WebGLUniforms(l,n){this.seq=[],this.map={};const t=l.getProgramParameter(n,35718);for(let e=0;e<t;++e){const i=l.getActiveUniform(n,e),s=l.getUniformLocation(n,i.name);parseUniform(i,s,this)}}WebGLUniforms.prototype.setValue=function(l,n,t,e){const i=this.map[n];i!==void 0&&i.setValue(l,t,e)};WebGLUniforms.prototype.setOptional=function(l,n,t){const e=n[t];e!==void 0&&this.setValue(l,t,e)};WebGLUniforms.upload=function(l,n,t,e){for(let i=0,s=n.length;i!==s;++i){const r=n[i],o=t[r.id];o.needsUpdate!==!1&&r.setValue(l,o.value,e)}};WebGLUniforms.seqWithValue=function(l,n){const t=[];for(let e=0,i=l.length;e!==i;++e){const s=l[e];s.id in n&&t.push(s)}return t};function WebGLShader(l,n,t){const e=l.createShader(n);return l.shaderSource(e,t),l.compileShader(e),e}let programIdCount=0;function addLineNumbers(l){const n=l.split(`
`);for(let t=0;t<n.length;t++)n[t]=t+1+": "+n[t];return n.join(`
`)}function getEncodingComponents(l){switch(l){case LinearEncoding:return["Linear","( value )"];case sRGBEncoding:return["sRGB","( value )"];case RGBEEncoding:return["RGBE","( value )"];case RGBM7Encoding:return["RGBM","( value, 7.0 )"];case RGBM16Encoding:return["RGBM","( value, 16.0 )"];case RGBDEncoding:return["RGBD","( value, 256.0 )"];case GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case LogLuvEncoding:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",l),["Linear","( value )"]}}function getShaderErrors(l,n,t){const e=l.getShaderParameter(n,35713),i=l.getShaderInfoLog(n).trim();if(e&&i==="")return"";const s=l.getShaderSource(n);return"THREE.WebGLShader: gl.getShaderInfoLog() "+t+`
`+i+addLineNumbers(s)}function getTexelDecodingFunction(l,n){const t=getEncodingComponents(n);return"vec4 "+l+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function getTexelEncodingFunction(l,n){const t=getEncodingComponents(n);return"vec4 "+l+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function getToneMappingFunction(l,n){let t;switch(n){case LinearToneMapping:t="Linear";break;case ReinhardToneMapping:t="Reinhard";break;case CineonToneMapping:t="OptimizedCineon";break;case ACESFilmicToneMapping:t="ACESFilmic";break;case CustomToneMapping:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",n),t="Linear"}return"vec3 "+l+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function generateExtensions(l){return[l.extensionDerivatives||l.envMapCubeUV||l.bumpMap||l.tangentSpaceNormalMap||l.clearcoatNormalMap||l.flatShading||l.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(l.extensionFragDepth||l.logarithmicDepthBuffer)&&l.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",l.extensionDrawBuffers&&l.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(l.extensionShaderTextureLOD||l.envMap||l.transmission>0)&&l.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join(`
`)}function generateDefines(l){const n=[];for(const t in l){const e=l[t];e!==!1&&n.push("#define "+t+" "+e)}return n.join(`
`)}function fetchAttributeLocations(l,n){const t={},e=l.getProgramParameter(n,35721);for(let i=0;i<e;i++){const r=l.getActiveAttrib(n,i).name;t[r]=l.getAttribLocation(n,r)}return t}function filterEmptyLine(l){return l!==""}function replaceLightNums(l,n){return l.replace(/NUM_DIR_LIGHTS/g,n.numDirLights).replace(/NUM_SPOT_LIGHTS/g,n.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,n.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,n.numPointLights).replace(/NUM_HEMI_LIGHTS/g,n.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,n.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,n.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,n.numPointLightShadows)}function replaceClippingPlaneNums(l,n){return l.replace(/NUM_CLIPPING_PLANES/g,n.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,n.numClippingPlanes-n.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(l){return l.replace(includePattern,includeReplacer)}function includeReplacer(l,n){const t=ShaderChunk[n];if(t===void 0)throw new Error("Can not resolve #include <"+n+">");return resolveIncludes(t)}const deprecatedUnrollLoopPattern=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(l){return l.replace(unrollLoopPattern,loopReplacer).replace(deprecatedUnrollLoopPattern,deprecatedLoopReplacer)}function deprecatedLoopReplacer(l,n,t,e){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),loopReplacer(l,n,t,e)}function loopReplacer(l,n,t,e){let i="";for(let s=parseInt(n);s<parseInt(t);s++)i+=e.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function generatePrecision(l){let n="precision "+l.precision+` float;
precision `+l.precision+" int;";return l.precision==="highp"?n+=`
#define HIGH_PRECISION`:l.precision==="mediump"?n+=`
#define MEDIUM_PRECISION`:l.precision==="lowp"&&(n+=`
#define LOW_PRECISION`),n}function generateShadowMapTypeDefine(l){let n="SHADOWMAP_TYPE_BASIC";return l.shadowMapType===PCFShadowMap?n="SHADOWMAP_TYPE_PCF":l.shadowMapType===PCFSoftShadowMap?n="SHADOWMAP_TYPE_PCF_SOFT":l.shadowMapType===VSMShadowMap&&(n="SHADOWMAP_TYPE_VSM"),n}function generateEnvMapTypeDefine(l){let n="ENVMAP_TYPE_CUBE";if(l.envMap)switch(l.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:n="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:case CubeUVRefractionMapping:n="ENVMAP_TYPE_CUBE_UV";break}return n}function generateEnvMapModeDefine(l){let n="ENVMAP_MODE_REFLECTION";if(l.envMap)switch(l.envMapMode){case CubeRefractionMapping:case CubeUVRefractionMapping:n="ENVMAP_MODE_REFRACTION";break}return n}function generateEnvMapBlendingDefine(l){let n="ENVMAP_BLENDING_NONE";if(l.envMap)switch(l.combine){case MultiplyOperation:n="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:n="ENVMAP_BLENDING_MIX";break;case AddOperation:n="ENVMAP_BLENDING_ADD";break}return n}function WebGLProgram(l,n,t,e){const i=l.getContext(),s=t.defines;let r=t.vertexShader,o=t.fragmentShader;const h=generateShadowMapTypeDefine(t),u=generateEnvMapTypeDefine(t),p=generateEnvMapModeDefine(t),d=generateEnvMapBlendingDefine(t),f=l.gammaFactor>0?l.gammaFactor:1,g=t.isWebGL2?"":generateExtensions(t),_=generateDefines(s),v=i.createProgram();let y,E,m=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(y=[_].filter(filterEmptyLine).join(`
`),y.length>0&&(y+=`
`),E=[g,_].filter(filterEmptyLine).join(`
`),E.length>0&&(E+=`
`)):(y=[generatePrecision(t),"#define SHADER_NAME "+t.shaderName,_,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+f,"#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+p:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+h:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(filterEmptyLine).join(`
`),E=[g,generatePrecision(t),"#define SHADER_NAME "+t.shaderName,_,t.alphaTest?"#define ALPHATEST "+t.alphaTest+(t.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+f,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+p:"",t.envMap?"#define "+d:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.sheen?"#define USE_SHEEN":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+h:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",t.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",t.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",ShaderChunk.encodings_pars_fragment,t.map?getTexelDecodingFunction("mapTexelToLinear",t.mapEncoding):"",t.matcap?getTexelDecodingFunction("matcapTexelToLinear",t.matcapEncoding):"",t.envMap?getTexelDecodingFunction("envMapTexelToLinear",t.envMapEncoding):"",t.emissiveMap?getTexelDecodingFunction("emissiveMapTexelToLinear",t.emissiveMapEncoding):"",t.lightMap?getTexelDecodingFunction("lightMapTexelToLinear",t.lightMapEncoding):"",getTexelEncodingFunction("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(filterEmptyLine).join(`
`)),r=resolveIncludes(r),r=replaceLightNums(r,t),r=replaceClippingPlaneNums(r,t),o=resolveIncludes(o),o=replaceLightNums(o,t),o=replaceClippingPlaneNums(o,t),r=unrollLoops(r),o=unrollLoops(o),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(m=`#version 300 es
`,y=["#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+y,E=["#define varying in",t.glslVersion===GLSL3?"":"out highp vec4 pc_fragColor;",t.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+E);const x=m+y+r,C=m+E+o,O=WebGLShader(i,35633,x),S=WebGLShader(i,35632,C);if(i.attachShader(v,O),i.attachShader(v,S),t.index0AttributeName!==void 0?i.bindAttribLocation(v,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(v,0,"position"),i.linkProgram(v),l.debug.checkShaderErrors){const V=i.getProgramInfoLog(v).trim(),N=i.getShaderInfoLog(O).trim(),B=i.getShaderInfoLog(S).trim();let W=!0,A=!0;if(i.getProgramParameter(v,35714)===!1){W=!1;const G=getShaderErrors(i,O,"vertex"),D=getShaderErrors(i,S,"fragment");console.error("THREE.WebGLProgram: shader error: ",i.getError(),"35715",i.getProgramParameter(v,35715),"gl.getProgramInfoLog",V,G,D)}else V!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",V):(N===""||B==="")&&(A=!1);A&&(this.diagnostics={runnable:W,programLog:V,vertexShader:{log:N,prefix:y},fragmentShader:{log:B,prefix:E}})}i.deleteShader(O),i.deleteShader(S);let P;this.getUniforms=function(){return P===void 0&&(P=new WebGLUniforms(i,v)),P};let F;return this.getAttributes=function(){return F===void 0&&(F=fetchAttributeLocations(i,v)),F},this.destroy=function(){e.releaseStatesOfProgram(this),i.deleteProgram(v),this.program=void 0},this.name=t.shaderName,this.id=programIdCount++,this.cacheKey=n,this.usedTimes=1,this.program=v,this.vertexShader=O,this.fragmentShader=S,this}function WebGLPrograms(l,n,t,e,i,s){const r=[],o=e.isWebGL2,h=e.logarithmicDepthBuffer,u=e.floatVertexTextures,p=e.maxVertexUniforms,d=e.vertexTextures;let f=e.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},_=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmission","transmissionMap","thicknessMap"];function v(S){const F=S.skeleton.bones;if(u)return 1024;{const N=Math.floor((p-20)/4),B=Math.min(N,F.length);return B<F.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+F.length+" bones. This GPU supports "+B+"."),0):B}}function y(S){let P;return S&&S.isTexture?P=S.encoding:S&&S.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),P=S.texture.encoding):P=LinearEncoding,P}function E(S,P,F,V,N){const B=V.fog,W=S.isMeshStandardMaterial?V.environment:null,A=n.get(S.envMap||W),G=g[S.type],D=N.isSkinnedMesh?v(N):0;S.precision!==null&&(f=e.getMaxPrecision(S.precision),f!==S.precision&&console.warn("THREE.WebGLProgram.getParameters:",S.precision,"not supported, using",f,"instead."));let M,J;if(G){const ot=ShaderLib[G];M=ot.vertexShader,J=ot.fragmentShader}else M=S.vertexShader,J=S.fragmentShader;const et=l.getRenderTarget();return{isWebGL2:o,shaderID:G,shaderName:S.type,vertexShader:M,fragmentShader:J,defines:S.defines,isRawShaderMaterial:S.isRawShaderMaterial===!0,glslVersion:S.glslVersion,precision:f,instancing:N.isInstancedMesh===!0,instancingColor:N.isInstancedMesh===!0&&N.instanceColor!==null,supportsVertexTextures:d,outputEncoding:et!==null?y(et.texture):l.outputEncoding,map:!!S.map,mapEncoding:y(S.map),matcap:!!S.matcap,matcapEncoding:y(S.matcap),envMap:!!A,envMapMode:A&&A.mapping,envMapEncoding:y(A),envMapCubeUV:!!A&&(A.mapping===CubeUVReflectionMapping||A.mapping===CubeUVRefractionMapping),lightMap:!!S.lightMap,lightMapEncoding:y(S.lightMap),aoMap:!!S.aoMap,emissiveMap:!!S.emissiveMap,emissiveMapEncoding:y(S.emissiveMap),bumpMap:!!S.bumpMap,normalMap:!!S.normalMap,objectSpaceNormalMap:S.normalMapType===ObjectSpaceNormalMap,tangentSpaceNormalMap:S.normalMapType===TangentSpaceNormalMap,clearcoatMap:!!S.clearcoatMap,clearcoatRoughnessMap:!!S.clearcoatRoughnessMap,clearcoatNormalMap:!!S.clearcoatNormalMap,displacementMap:!!S.displacementMap,roughnessMap:!!S.roughnessMap,metalnessMap:!!S.metalnessMap,specularMap:!!S.specularMap,alphaMap:!!S.alphaMap,gradientMap:!!S.gradientMap,sheen:!!S.sheen,transmission:!!S.transmission,transmissionMap:!!S.transmissionMap,thicknessMap:!!S.thicknessMap,combine:S.combine,vertexTangents:S.normalMap&&S.vertexTangents,vertexColors:S.vertexColors,vertexAlphas:S.vertexColors===!0&&N.geometry&&N.geometry.attributes.color&&N.geometry.attributes.color.itemSize===4,vertexUvs:!!S.map||!!S.bumpMap||!!S.normalMap||!!S.specularMap||!!S.alphaMap||!!S.emissiveMap||!!S.roughnessMap||!!S.metalnessMap||!!S.clearcoatMap||!!S.clearcoatRoughnessMap||!!S.clearcoatNormalMap||!!S.displacementMap||!!S.transmission||!!S.transmissionMap||!!S.thicknessMap,uvsVertexOnly:!(S.map||S.bumpMap||S.normalMap||S.specularMap||S.alphaMap||S.emissiveMap||S.roughnessMap||S.metalnessMap||S.clearcoatNormalMap||S.transmission||S.transmissionMap||S.thicknessMap)&&!!S.displacementMap,fog:!!B,useFog:S.fog,fogExp2:B&&B.isFogExp2,flatShading:!!S.flatShading,sizeAttenuation:S.sizeAttenuation,logarithmicDepthBuffer:h,skinning:N.isSkinnedMesh===!0&&D>0,maxBones:D,useVertexTexture:u,morphTargets:S.morphTargets,morphNormals:S.morphNormals,numDirLights:P.directional.length,numPointLights:P.point.length,numSpotLights:P.spot.length,numRectAreaLights:P.rectArea.length,numHemiLights:P.hemi.length,numDirLightShadows:P.directionalShadowMap.length,numPointLightShadows:P.pointShadowMap.length,numSpotLightShadows:P.spotShadowMap.length,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:S.dithering,shadowMapEnabled:l.shadowMap.enabled&&F.length>0,shadowMapType:l.shadowMap.type,toneMapping:S.toneMapped?l.toneMapping:NoToneMapping,physicallyCorrectLights:l.physicallyCorrectLights,premultipliedAlpha:S.premultipliedAlpha,alphaTest:S.alphaTest,doubleSided:S.side===DoubleSide,flipSided:S.side===BackSide,depthPacking:S.depthPacking!==void 0?S.depthPacking:!1,index0AttributeName:S.index0AttributeName,extensionDerivatives:S.extensions&&S.extensions.derivatives,extensionFragDepth:S.extensions&&S.extensions.fragDepth,extensionDrawBuffers:S.extensions&&S.extensions.drawBuffers,extensionShaderTextureLOD:S.extensions&&S.extensions.shaderTextureLOD,rendererExtensionFragDepth:o||t.has("EXT_frag_depth"),rendererExtensionDrawBuffers:o||t.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:o||t.has("EXT_shader_texture_lod"),customProgramCacheKey:S.customProgramCacheKey()}}function m(S){const P=[];if(S.shaderID?P.push(S.shaderID):(P.push(S.fragmentShader),P.push(S.vertexShader)),S.defines!==void 0)for(const F in S.defines)P.push(F),P.push(S.defines[F]);if(S.isRawShaderMaterial===!1){for(let F=0;F<_.length;F++)P.push(S[_[F]]);P.push(l.outputEncoding),P.push(l.gammaFactor)}return P.push(S.customProgramCacheKey),P.join()}function x(S){const P=g[S.type];let F;if(P){const V=ShaderLib[P];F=UniformsUtils.clone(V.uniforms)}else F=S.uniforms;return F}function C(S,P){let F;for(let V=0,N=r.length;V<N;V++){const B=r[V];if(B.cacheKey===P){F=B,++F.usedTimes;break}}return F===void 0&&(F=new WebGLProgram(l,P,S,i),r.push(F)),F}function O(S){if(--S.usedTimes===0){const P=r.indexOf(S);r[P]=r[r.length-1],r.pop(),S.destroy()}}return{getParameters:E,getProgramCacheKey:m,getUniforms:x,acquireProgram:C,releaseProgram:O,programs:r}}function WebGLProperties(){let l=new WeakMap;function n(s){let r=l.get(s);return r===void 0&&(r={},l.set(s,r)),r}function t(s){l.delete(s)}function e(s,r,o){l.get(s)[r]=o}function i(){l=new WeakMap}return{get:n,remove:t,update:e,dispose:i}}function painterSortStable(l,n){return l.groupOrder!==n.groupOrder?l.groupOrder-n.groupOrder:l.renderOrder!==n.renderOrder?l.renderOrder-n.renderOrder:l.program!==n.program?l.program.id-n.program.id:l.material.id!==n.material.id?l.material.id-n.material.id:l.z!==n.z?l.z-n.z:l.id-n.id}function reversePainterSortStable(l,n){return l.groupOrder!==n.groupOrder?l.groupOrder-n.groupOrder:l.renderOrder!==n.renderOrder?l.renderOrder-n.renderOrder:l.z!==n.z?n.z-l.z:l.id-n.id}function WebGLRenderList(l){const n=[];let t=0;const e=[],i=[],s=[],r={id:-1};function o(){t=0,e.length=0,i.length=0,s.length=0}function h(g,_,v,y,E,m){let x=n[t];const C=l.get(v);return x===void 0?(x={id:g.id,object:g,geometry:_,material:v,program:C.program||r,groupOrder:y,renderOrder:g.renderOrder,z:E,group:m},n[t]=x):(x.id=g.id,x.object=g,x.geometry=_,x.material=v,x.program=C.program||r,x.groupOrder=y,x.renderOrder=g.renderOrder,x.z=E,x.group=m),t++,x}function u(g,_,v,y,E,m){const x=h(g,_,v,y,E,m);v.transmission>0?i.push(x):v.transparent===!0?s.push(x):e.push(x)}function p(g,_,v,y,E,m){const x=h(g,_,v,y,E,m);v.transmission>0?i.unshift(x):v.transparent===!0?s.unshift(x):e.unshift(x)}function d(g,_){e.length>1&&e.sort(g||painterSortStable),i.length>1&&i.sort(_||reversePainterSortStable),s.length>1&&s.sort(_||reversePainterSortStable)}function f(){for(let g=t,_=n.length;g<_;g++){const v=n[g];if(v.id===null)break;v.id=null,v.object=null,v.geometry=null,v.material=null,v.program=null,v.group=null}}return{opaque:e,transmissive:i,transparent:s,init:o,push:u,unshift:p,finish:f,sort:d}}function WebGLRenderLists(l){let n=new WeakMap;function t(i,s){let r;return n.has(i)===!1?(r=new WebGLRenderList(l),n.set(i,[r])):s>=n.get(i).length?(r=new WebGLRenderList(l),n.get(i).push(r)):r=n.get(i)[s],r}function e(){n=new WeakMap}return{get:t,dispose:e}}function UniformsCache(){const l={};return{get:function(n){if(l[n.id]!==void 0)return l[n.id];let t;switch(n.type){case"DirectionalLight":t={direction:new Vector3,color:new Color};break;case"SpotLight":t={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":t={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3};break}return l[n.id]=t,t}}}function ShadowUniformsCache(){const l={};return{get:function(n){if(l[n.id]!==void 0)return l[n.id];let t;switch(n.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break}return l[n.id]=t,t}}}let nextVersion=0;function shadowCastingLightsFirst(l,n){return(n.castShadow?1:0)-(l.castShadow?1:0)}function WebGLLights(l,n){const t=new UniformsCache,e=ShadowUniformsCache(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let p=0;p<9;p++)i.probe.push(new Vector3);const s=new Vector3,r=new Matrix4,o=new Matrix4;function h(p){let d=0,f=0,g=0;for(let P=0;P<9;P++)i.probe[P].set(0,0,0);let _=0,v=0,y=0,E=0,m=0,x=0,C=0,O=0;p.sort(shadowCastingLightsFirst);for(let P=0,F=p.length;P<F;P++){const V=p[P],N=V.color,B=V.intensity,W=V.distance,A=V.shadow&&V.shadow.map?V.shadow.map.texture:null;if(V.isAmbientLight)d+=N.r*B,f+=N.g*B,g+=N.b*B;else if(V.isLightProbe)for(let G=0;G<9;G++)i.probe[G].addScaledVector(V.sh.coefficients[G],B);else if(V.isDirectionalLight){const G=t.get(V);if(G.color.copy(V.color).multiplyScalar(V.intensity),V.castShadow){const D=V.shadow,M=e.get(V);M.shadowBias=D.bias,M.shadowNormalBias=D.normalBias,M.shadowRadius=D.radius,M.shadowMapSize=D.mapSize,i.directionalShadow[_]=M,i.directionalShadowMap[_]=A,i.directionalShadowMatrix[_]=V.shadow.matrix,x++}i.directional[_]=G,_++}else if(V.isSpotLight){const G=t.get(V);if(G.position.setFromMatrixPosition(V.matrixWorld),G.color.copy(N).multiplyScalar(B),G.distance=W,G.coneCos=Math.cos(V.angle),G.penumbraCos=Math.cos(V.angle*(1-V.penumbra)),G.decay=V.decay,V.castShadow){const D=V.shadow,M=e.get(V);M.shadowBias=D.bias,M.shadowNormalBias=D.normalBias,M.shadowRadius=D.radius,M.shadowMapSize=D.mapSize,i.spotShadow[y]=M,i.spotShadowMap[y]=A,i.spotShadowMatrix[y]=V.shadow.matrix,O++}i.spot[y]=G,y++}else if(V.isRectAreaLight){const G=t.get(V);G.color.copy(N).multiplyScalar(B),G.halfWidth.set(V.width*.5,0,0),G.halfHeight.set(0,V.height*.5,0),i.rectArea[E]=G,E++}else if(V.isPointLight){const G=t.get(V);if(G.color.copy(V.color).multiplyScalar(V.intensity),G.distance=V.distance,G.decay=V.decay,V.castShadow){const D=V.shadow,M=e.get(V);M.shadowBias=D.bias,M.shadowNormalBias=D.normalBias,M.shadowRadius=D.radius,M.shadowMapSize=D.mapSize,M.shadowCameraNear=D.camera.near,M.shadowCameraFar=D.camera.far,i.pointShadow[v]=M,i.pointShadowMap[v]=A,i.pointShadowMatrix[v]=V.shadow.matrix,C++}i.point[v]=G,v++}else if(V.isHemisphereLight){const G=t.get(V);G.skyColor.copy(V.color).multiplyScalar(B),G.groundColor.copy(V.groundColor).multiplyScalar(B),i.hemi[m]=G,m++}}E>0&&(n.isWebGL2||l.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,i.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):l.has("OES_texture_half_float_linear")===!0?(i.rectAreaLTC1=UniformsLib.LTC_HALF_1,i.rectAreaLTC2=UniformsLib.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=d,i.ambient[1]=f,i.ambient[2]=g;const S=i.hash;(S.directionalLength!==_||S.pointLength!==v||S.spotLength!==y||S.rectAreaLength!==E||S.hemiLength!==m||S.numDirectionalShadows!==x||S.numPointShadows!==C||S.numSpotShadows!==O)&&(i.directional.length=_,i.spot.length=y,i.rectArea.length=E,i.point.length=v,i.hemi.length=m,i.directionalShadow.length=x,i.directionalShadowMap.length=x,i.pointShadow.length=C,i.pointShadowMap.length=C,i.spotShadow.length=O,i.spotShadowMap.length=O,i.directionalShadowMatrix.length=x,i.pointShadowMatrix.length=C,i.spotShadowMatrix.length=O,S.directionalLength=_,S.pointLength=v,S.spotLength=y,S.rectAreaLength=E,S.hemiLength=m,S.numDirectionalShadows=x,S.numPointShadows=C,S.numSpotShadows=O,i.version=nextVersion++)}function u(p,d){let f=0,g=0,_=0,v=0,y=0;const E=d.matrixWorldInverse;for(let m=0,x=p.length;m<x;m++){const C=p[m];if(C.isDirectionalLight){const O=i.directional[f];O.direction.setFromMatrixPosition(C.matrixWorld),s.setFromMatrixPosition(C.target.matrixWorld),O.direction.sub(s),O.direction.transformDirection(E),f++}else if(C.isSpotLight){const O=i.spot[_];O.position.setFromMatrixPosition(C.matrixWorld),O.position.applyMatrix4(E),O.direction.setFromMatrixPosition(C.matrixWorld),s.setFromMatrixPosition(C.target.matrixWorld),O.direction.sub(s),O.direction.transformDirection(E),_++}else if(C.isRectAreaLight){const O=i.rectArea[v];O.position.setFromMatrixPosition(C.matrixWorld),O.position.applyMatrix4(E),o.identity(),r.copy(C.matrixWorld),r.premultiply(E),o.extractRotation(r),O.halfWidth.set(C.width*.5,0,0),O.halfHeight.set(0,C.height*.5,0),O.halfWidth.applyMatrix4(o),O.halfHeight.applyMatrix4(o),v++}else if(C.isPointLight){const O=i.point[g];O.position.setFromMatrixPosition(C.matrixWorld),O.position.applyMatrix4(E),g++}else if(C.isHemisphereLight){const O=i.hemi[y];O.direction.setFromMatrixPosition(C.matrixWorld),O.direction.transformDirection(E),O.direction.normalize(),y++}}}return{setup:h,setupView:u,state:i}}function WebGLRenderState(l,n){const t=new WebGLLights(l,n),e=[],i=[];function s(){e.length=0,i.length=0}function r(d){e.push(d)}function o(d){i.push(d)}function h(){t.setup(e)}function u(d){t.setupView(e,d)}return{init:s,state:{lightsArray:e,shadowsArray:i,lights:t},setupLights:h,setupLightsView:u,pushLight:r,pushShadow:o}}function WebGLRenderStates(l,n){let t=new WeakMap;function e(s,r=0){let o;return t.has(s)===!1?(o=new WebGLRenderState(l,n),t.set(s,[o])):r>=t.get(s).length?(o=new WebGLRenderState(l,n),t.get(s).push(o)):o=t.get(s)[r],o}function i(){t=new WeakMap}return{get:e,dispose:i}}class MeshDepthMaterial extends Material$1{constructor(n){super(),this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(n)}copy(n){return super.copy(n),this.depthPacking=n.depthPacking,this.morphTargets=n.morphTargets,this.map=n.map,this.alphaMap=n.alphaMap,this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this}}MeshDepthMaterial.prototype.isMeshDepthMaterial=!0;class MeshDistanceMaterial extends Material$1{constructor(n){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(n)}copy(n){return super.copy(n),this.referencePosition.copy(n.referencePosition),this.nearDistance=n.nearDistance,this.farDistance=n.farDistance,this.morphTargets=n.morphTargets,this.map=n.map,this.alphaMap=n.alphaMap,this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this}}MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0;var vsm_frag=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );
	for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean * HALF_SAMPLE_RATE;
	squared_mean = squared_mean * HALF_SAMPLE_RATE;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,vsm_vert=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function WebGLShadowMap(l,n,t){let e=new Frustum;const i=new Vector2,s=new Vector2,r=new Vector4,o=[],h=[],u={},p=t.maxTextureSize,d={0:BackSide,1:FrontSide,2:DoubleSide},f=new ShaderMaterial({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vsm_vert,fragmentShader:vsm_frag}),g=f.clone();g.defines.HORIZONTAL_PASS=1;const _=new BufferGeometry;_.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new Mesh(_,f),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap,this.render=function(S,P,F){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||S.length===0)return;const V=l.getRenderTarget(),N=l.getActiveCubeFace(),B=l.getActiveMipmapLevel(),W=l.state;W.setBlending(NoBlending),W.buffers.color.setClear(1,1,1,1),W.buffers.depth.setTest(!0),W.setScissorTest(!1);for(let A=0,G=S.length;A<G;A++){const D=S[A],M=D.shadow;if(M===void 0){console.warn("THREE.WebGLShadowMap:",D,"has no shadow.");continue}if(M.autoUpdate===!1&&M.needsUpdate===!1)continue;i.copy(M.mapSize);const J=M.getFrameExtents();if(i.multiply(J),s.copy(M.mapSize),(i.x>p||i.y>p)&&(i.x>p&&(s.x=Math.floor(p/J.x),i.x=s.x*J.x,M.mapSize.x=s.x),i.y>p&&(s.y=Math.floor(p/J.y),i.y=s.y*J.y,M.mapSize.y=s.y)),M.map===null&&!M.isPointLightShadow&&this.type===VSMShadowMap){const Q={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat};M.map=new WebGLRenderTarget(i.x,i.y,Q),M.map.texture.name=D.name+".shadowMap",M.mapPass=new WebGLRenderTarget(i.x,i.y,Q),M.camera.updateProjectionMatrix()}if(M.map===null){const Q={minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat};M.map=new WebGLRenderTarget(i.x,i.y,Q),M.map.texture.name=D.name+".shadowMap",M.camera.updateProjectionMatrix()}l.setRenderTarget(M.map),l.clear();const et=M.getViewportCount();for(let Q=0;Q<et;Q++){const ot=M.getViewport(Q);r.set(s.x*ot.x,s.y*ot.y,s.x*ot.z,s.y*ot.w),W.viewport(r),M.updateMatrices(D,Q),e=M.getFrustum(),O(P,F,M.camera,D,this.type)}!M.isPointLightShadow&&this.type===VSMShadowMap&&E(M,F),M.needsUpdate=!1}y.needsUpdate=!1,l.setRenderTarget(V,N,B)};function E(S,P){const F=n.update(v);f.uniforms.shadow_pass.value=S.map.texture,f.uniforms.resolution.value=S.mapSize,f.uniforms.radius.value=S.radius,l.setRenderTarget(S.mapPass),l.clear(),l.renderBufferDirect(P,null,F,f,v,null),g.uniforms.shadow_pass.value=S.mapPass.texture,g.uniforms.resolution.value=S.mapSize,g.uniforms.radius.value=S.radius,l.setRenderTarget(S.map),l.clear(),l.renderBufferDirect(P,null,F,g,v,null)}function m(S){const P=S<<0;let F=o[P];return F===void 0&&(F=new MeshDepthMaterial({depthPacking:RGBADepthPacking,morphTargets:S}),o[P]=F),F}function x(S){const P=S<<0;let F=h[P];return F===void 0&&(F=new MeshDistanceMaterial({morphTargets:S}),h[P]=F),F}function C(S,P,F,V,N,B,W){let A=null,G=m,D=S.customDepthMaterial;if(V.isPointLight===!0&&(G=x,D=S.customDistanceMaterial),D===void 0){let M=!1;F.morphTargets===!0&&(M=P.morphAttributes&&P.morphAttributes.position&&P.morphAttributes.position.length>0),A=G(M)}else A=D;if(l.localClippingEnabled&&F.clipShadows===!0&&F.clippingPlanes.length!==0){const M=A.uuid,J=F.uuid;let et=u[M];et===void 0&&(et={},u[M]=et);let Q=et[J];Q===void 0&&(Q=A.clone(),et[J]=Q),A=Q}return A.visible=F.visible,A.wireframe=F.wireframe,W===VSMShadowMap?A.side=F.shadowSide!==null?F.shadowSide:F.side:A.side=F.shadowSide!==null?F.shadowSide:d[F.side],A.clipShadows=F.clipShadows,A.clippingPlanes=F.clippingPlanes,A.clipIntersection=F.clipIntersection,A.wireframeLinewidth=F.wireframeLinewidth,A.linewidth=F.linewidth,V.isPointLight===!0&&A.isMeshDistanceMaterial===!0&&(A.referencePosition.setFromMatrixPosition(V.matrixWorld),A.nearDistance=N,A.farDistance=B),A}function O(S,P,F,V,N){if(S.visible===!1)return;if(S.layers.test(P.layers)&&(S.isMesh||S.isLine||S.isPoints)&&(S.castShadow||S.receiveShadow&&N===VSMShadowMap)&&(!S.frustumCulled||e.intersectsObject(S))){S.modelViewMatrix.multiplyMatrices(F.matrixWorldInverse,S.matrixWorld);const A=n.update(S),G=S.material;if(Array.isArray(G)){const D=A.groups;for(let M=0,J=D.length;M<J;M++){const et=D[M],Q=G[et.materialIndex];if(Q&&Q.visible){const ot=C(S,A,Q,V,F.near,F.far,N);l.renderBufferDirect(F,null,A,ot,S,et)}}}else if(G.visible){const D=C(S,A,G,V,F.near,F.far,N);l.renderBufferDirect(F,null,A,D,S,null)}}const W=S.children;for(let A=0,G=W.length;A<G;A++)O(W[A],P,F,V,N)}}function WebGLState(l,n,t){const e=t.isWebGL2;function i(){let q=!1;const xt=new Vector4;let pt=null;const Bt=new Vector4(0,0,0,0);return{setMask:function(Ot){pt!==Ot&&!q&&(l.colorMask(Ot,Ot,Ot,Ot),pt=Ot)},setLocked:function(Ot){q=Ot},setClear:function(Ot,te,ce,Ee,Ie){Ie===!0&&(Ot*=Ee,te*=Ee,ce*=Ee),xt.set(Ot,te,ce,Ee),Bt.equals(xt)===!1&&(l.clearColor(Ot,te,ce,Ee),Bt.copy(xt))},reset:function(){q=!1,pt=null,Bt.set(-1,0,0,0)}}}function s(){let q=!1,xt=null,pt=null,Bt=null;return{setTest:function(Ot){Ot?_t(2929):yt(2929)},setMask:function(Ot){xt!==Ot&&!q&&(l.depthMask(Ot),xt=Ot)},setFunc:function(Ot){if(pt!==Ot){if(Ot)switch(Ot){case NeverDepth:l.depthFunc(512);break;case AlwaysDepth:l.depthFunc(519);break;case LessDepth:l.depthFunc(513);break;case LessEqualDepth:l.depthFunc(515);break;case EqualDepth:l.depthFunc(514);break;case GreaterEqualDepth:l.depthFunc(518);break;case GreaterDepth:l.depthFunc(516);break;case NotEqualDepth:l.depthFunc(517);break;default:l.depthFunc(515)}else l.depthFunc(515);pt=Ot}},setLocked:function(Ot){q=Ot},setClear:function(Ot){Bt!==Ot&&(l.clearDepth(Ot),Bt=Ot)},reset:function(){q=!1,xt=null,pt=null,Bt=null}}}function r(){let q=!1,xt=null,pt=null,Bt=null,Ot=null,te=null,ce=null,Ee=null,Ie=null;return{setTest:function(fe){q||(fe?_t(2960):yt(2960))},setMask:function(fe){xt!==fe&&!q&&(l.stencilMask(fe),xt=fe)},setFunc:function(fe,Te,we){(pt!==fe||Bt!==Te||Ot!==we)&&(l.stencilFunc(fe,Te,we),pt=fe,Bt=Te,Ot=we)},setOp:function(fe,Te,we){(te!==fe||ce!==Te||Ee!==we)&&(l.stencilOp(fe,Te,we),te=fe,ce=Te,Ee=we)},setLocked:function(fe){q=fe},setClear:function(fe){Ie!==fe&&(l.clearStencil(fe),Ie=fe)},reset:function(){q=!1,xt=null,pt=null,Bt=null,Ot=null,te=null,ce=null,Ee=null,Ie=null}}}const o=new i,h=new s,u=new r;let p={},d=null,f={},g=null,_=!1,v=null,y=null,E=null,m=null,x=null,C=null,O=null,S=!1,P=null,F=null,V=null,N=null,B=null;const W=l.getParameter(35661);let A=!1,G=0;const D=l.getParameter(7938);D.indexOf("WebGL")!==-1?(G=parseFloat(/^WebGL (\d)/.exec(D)[1]),A=G>=1):D.indexOf("OpenGL ES")!==-1&&(G=parseFloat(/^OpenGL ES (\d)/.exec(D)[1]),A=G>=2);let M=null,J={};const et=l.getParameter(3088),Q=l.getParameter(2978),ot=new Vector4().fromArray(et),tt=new Vector4().fromArray(Q);function rt(q,xt,pt){const Bt=new Uint8Array(4),Ot=l.createTexture();l.bindTexture(q,Ot),l.texParameteri(q,10241,9728),l.texParameteri(q,10240,9728);for(let te=0;te<pt;te++)l.texImage2D(xt+te,0,6408,1,1,0,6408,5121,Bt);return Ot}const ft={};ft[3553]=rt(3553,3553,1),ft[34067]=rt(34067,34069,6),o.setClear(0,0,0,1),h.setClear(1),u.setClear(0),_t(2929),h.setFunc(LessEqualDepth),mt(!1),Rt(CullFaceBack),_t(2884),Ct(NoBlending);function _t(q){p[q]!==!0&&(l.enable(q),p[q]=!0)}function yt(q){p[q]!==!1&&(l.disable(q),p[q]=!1)}function Z(q){q!==d&&(l.bindFramebuffer(36160,q),d=q)}function bt(q,xt){return xt===null&&d!==null&&(xt=d),f[q]!==xt?(l.bindFramebuffer(q,xt),f[q]=xt,e&&(q===36009&&(f[36160]=xt),q===36160&&(f[36009]=xt)),!0):!1}function at(q){return g!==q?(l.useProgram(q),g=q,!0):!1}const nt={[AddEquation]:32774,[SubtractEquation]:32778,[ReverseSubtractEquation]:32779};if(e)nt[MinEquation]=32775,nt[MaxEquation]=32776;else{const q=n.get("EXT_blend_minmax");q!==null&&(nt[MinEquation]=q.MIN_EXT,nt[MaxEquation]=q.MAX_EXT)}const ht={[ZeroFactor]:0,[OneFactor]:1,[SrcColorFactor]:768,[SrcAlphaFactor]:770,[SrcAlphaSaturateFactor]:776,[DstColorFactor]:774,[DstAlphaFactor]:772,[OneMinusSrcColorFactor]:769,[OneMinusSrcAlphaFactor]:771,[OneMinusDstColorFactor]:775,[OneMinusDstAlphaFactor]:773};function Ct(q,xt,pt,Bt,Ot,te,ce,Ee){if(q===NoBlending){_===!0&&(yt(3042),_=!1);return}if(_===!1&&(_t(3042),_=!0),q!==CustomBlending){if(q!==v||Ee!==S){if((y!==AddEquation||x!==AddEquation)&&(l.blendEquation(32774),y=AddEquation,x=AddEquation),Ee)switch(q){case NormalBlending:l.blendFuncSeparate(1,771,1,771);break;case AdditiveBlending:l.blendFunc(1,1);break;case SubtractiveBlending:l.blendFuncSeparate(0,0,769,771);break;case MultiplyBlending:l.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",q);break}else switch(q){case NormalBlending:l.blendFuncSeparate(770,771,1,771);break;case AdditiveBlending:l.blendFunc(770,1);break;case SubtractiveBlending:l.blendFunc(0,769);break;case MultiplyBlending:l.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",q);break}E=null,m=null,C=null,O=null,v=q,S=Ee}return}Ot=Ot||xt,te=te||pt,ce=ce||Bt,(xt!==y||Ot!==x)&&(l.blendEquationSeparate(nt[xt],nt[Ot]),y=xt,x=Ot),(pt!==E||Bt!==m||te!==C||ce!==O)&&(l.blendFuncSeparate(ht[pt],ht[Bt],ht[te],ht[ce]),E=pt,m=Bt,C=te,O=ce),v=q,S=null}function gt(q,xt){q.side===DoubleSide?yt(2884):_t(2884);let pt=q.side===BackSide;xt&&(pt=!pt),mt(pt),q.blending===NormalBlending&&q.transparent===!1?Ct(NoBlending):Ct(q.blending,q.blendEquation,q.blendSrc,q.blendDst,q.blendEquationAlpha,q.blendSrcAlpha,q.blendDstAlpha,q.premultipliedAlpha),h.setFunc(q.depthFunc),h.setTest(q.depthTest),h.setMask(q.depthWrite),o.setMask(q.colorWrite);const Bt=q.stencilWrite;u.setTest(Bt),Bt&&(u.setMask(q.stencilWriteMask),u.setFunc(q.stencilFunc,q.stencilRef,q.stencilFuncMask),u.setOp(q.stencilFail,q.stencilZFail,q.stencilZPass)),Pt(q.polygonOffset,q.polygonOffsetFactor,q.polygonOffsetUnits),q.alphaToCoverage===!0?_t(32926):yt(32926)}function mt(q){P!==q&&(q?l.frontFace(2304):l.frontFace(2305),P=q)}function Rt(q){q!==CullFaceNone?(_t(2884),q!==F&&(q===CullFaceBack?l.cullFace(1029):q===CullFaceFront?l.cullFace(1028):l.cullFace(1032))):yt(2884),F=q}function Ft(q){q!==V&&(A&&l.lineWidth(q),V=q)}function Pt(q,xt,pt){q?(_t(32823),(N!==xt||B!==pt)&&(l.polygonOffset(xt,pt),N=xt,B=pt)):yt(32823)}function X(q){q?_t(3089):yt(3089)}function z(q){q===void 0&&(q=33984+W-1),M!==q&&(l.activeTexture(q),M=q)}function vt(q,xt){M===null&&z();let pt=J[M];pt===void 0&&(pt={type:void 0,texture:void 0},J[M]=pt),(pt.type!==q||pt.texture!==xt)&&(l.bindTexture(q,xt||ft[q]),pt.type=q,pt.texture=xt)}function St(){const q=J[M];q!==void 0&&q.type!==void 0&&(l.bindTexture(q.type,null),q.type=void 0,q.texture=void 0)}function Dt(){try{l.compressedTexImage2D.apply(l,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function kt(){try{l.texImage2D.apply(l,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Wt(){try{l.texImage3D.apply(l,arguments)}catch(q){console.error("THREE.WebGLState:",q)}}function Y(q){ot.equals(q)===!1&&(l.scissor(q.x,q.y,q.z,q.w),ot.copy(q))}function At(q){tt.equals(q)===!1&&(l.viewport(q.x,q.y,q.z,q.w),tt.copy(q))}function Mt(){l.disable(3042),l.disable(2884),l.disable(2929),l.disable(32823),l.disable(3089),l.disable(2960),l.disable(32926),l.blendEquation(32774),l.blendFunc(1,0),l.blendFuncSeparate(1,0,1,0),l.colorMask(!0,!0,!0,!0),l.clearColor(0,0,0,0),l.depthMask(!0),l.depthFunc(513),l.clearDepth(1),l.stencilMask(4294967295),l.stencilFunc(519,0,4294967295),l.stencilOp(7680,7680,7680),l.clearStencil(0),l.cullFace(1029),l.frontFace(2305),l.polygonOffset(0,0),l.activeTexture(33984),l.bindFramebuffer(36160,null),e===!0&&(l.bindFramebuffer(36009,null),l.bindFramebuffer(36008,null)),l.useProgram(null),l.lineWidth(1),l.scissor(0,0,l.canvas.width,l.canvas.height),l.viewport(0,0,l.canvas.width,l.canvas.height),p={},M=null,J={},d=null,f={},g=null,_=!1,v=null,y=null,E=null,m=null,x=null,C=null,O=null,S=!1,P=null,F=null,V=null,N=null,B=null,ot.set(0,0,l.canvas.width,l.canvas.height),tt.set(0,0,l.canvas.width,l.canvas.height),o.reset(),h.reset(),u.reset()}return{buffers:{color:o,depth:h,stencil:u},enable:_t,disable:yt,bindFramebuffer:bt,bindXRFramebuffer:Z,useProgram:at,setBlending:Ct,setMaterial:gt,setFlipSided:mt,setCullFace:Rt,setLineWidth:Ft,setPolygonOffset:Pt,setScissorTest:X,activeTexture:z,bindTexture:vt,unbindTexture:St,compressedTexImage2D:Dt,texImage2D:kt,texImage3D:Wt,scissor:Y,viewport:At,reset:Mt}}function WebGLTextures(l,n,t,e,i,s,r){const o=i.isWebGL2,h=i.maxTextures,u=i.maxCubemapSize,p=i.maxTextureSize,d=i.maxSamples,f=new WeakMap;let g,_=!1;try{_=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function v(X,z){return _?new OffscreenCanvas(X,z):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function y(X,z,vt,St){let Dt=1;if((X.width>St||X.height>St)&&(Dt=St/Math.max(X.width,X.height)),Dt<1||z===!0)if(typeof HTMLImageElement<"u"&&X instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&X instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&X instanceof ImageBitmap){const kt=z?floorPowerOfTwo:Math.floor,Wt=kt(Dt*X.width),Y=kt(Dt*X.height);g===void 0&&(g=v(Wt,Y));const At=vt?v(Wt,Y):g;return At.width=Wt,At.height=Y,At.getContext("2d").drawImage(X,0,0,Wt,Y),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+X.width+"x"+X.height+") to ("+Wt+"x"+Y+")."),At}else return"data"in X&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+X.width+"x"+X.height+")."),X;return X}function E(X){return isPowerOfTwo(X.width)&&isPowerOfTwo(X.height)}function m(X){return o?!1:X.wrapS!==ClampToEdgeWrapping||X.wrapT!==ClampToEdgeWrapping||X.minFilter!==NearestFilter&&X.minFilter!==LinearFilter}function x(X,z){return X.generateMipmaps&&z&&X.minFilter!==NearestFilter&&X.minFilter!==LinearFilter}function C(X,z,vt,St){l.generateMipmap(X);const Dt=e.get(z);Dt.__maxMipLevel=Math.log2(Math.max(vt,St))}function O(X,z,vt){if(o===!1)return z;if(X!==null){if(l[X]!==void 0)return l[X];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+X+"'")}let St=z;return z===6403&&(vt===5126&&(St=33326),vt===5131&&(St=33325),vt===5121&&(St=33321)),z===6407&&(vt===5126&&(St=34837),vt===5131&&(St=34843),vt===5121&&(St=32849)),z===6408&&(vt===5126&&(St=34836),vt===5131&&(St=34842),vt===5121&&(St=32856)),(St===33325||St===33326||St===34842||St===34836)&&n.get("EXT_color_buffer_float"),St}function S(X){return X===NearestFilter||X===NearestMipmapNearestFilter||X===NearestMipmapLinearFilter?9728:9729}function P(X){const z=X.target;z.removeEventListener("dispose",P),V(z),z.isVideoTexture&&f.delete(z),r.memory.textures--}function F(X){const z=X.target;z.removeEventListener("dispose",F),N(z)}function V(X){const z=e.get(X);z.__webglInit!==void 0&&(l.deleteTexture(z.__webglTexture),e.remove(X))}function N(X){const z=X.texture,vt=e.get(X),St=e.get(z);if(X){if(St.__webglTexture!==void 0&&(l.deleteTexture(St.__webglTexture),r.memory.textures--),X.depthTexture&&X.depthTexture.dispose(),X.isWebGLCubeRenderTarget)for(let Dt=0;Dt<6;Dt++)l.deleteFramebuffer(vt.__webglFramebuffer[Dt]),vt.__webglDepthbuffer&&l.deleteRenderbuffer(vt.__webglDepthbuffer[Dt]);else l.deleteFramebuffer(vt.__webglFramebuffer),vt.__webglDepthbuffer&&l.deleteRenderbuffer(vt.__webglDepthbuffer),vt.__webglMultisampledFramebuffer&&l.deleteFramebuffer(vt.__webglMultisampledFramebuffer),vt.__webglColorRenderbuffer&&l.deleteRenderbuffer(vt.__webglColorRenderbuffer),vt.__webglDepthRenderbuffer&&l.deleteRenderbuffer(vt.__webglDepthRenderbuffer);if(X.isWebGLMultipleRenderTargets)for(let Dt=0,kt=z.length;Dt<kt;Dt++){const Wt=e.get(z[Dt]);Wt.__webglTexture&&(l.deleteTexture(Wt.__webglTexture),r.memory.textures--),e.remove(z[Dt])}e.remove(z),e.remove(X)}}let B=0;function W(){B=0}function A(){const X=B;return X>=h&&console.warn("THREE.WebGLTextures: Trying to use "+X+" texture units while this GPU supports only "+h),B+=1,X}function G(X,z){const vt=e.get(X);if(X.isVideoTexture&&gt(X),X.version>0&&vt.__version!==X.version){const St=X.image;if(St===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(St.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{rt(vt,X,z);return}}t.activeTexture(33984+z),t.bindTexture(3553,vt.__webglTexture)}function D(X,z){const vt=e.get(X);if(X.version>0&&vt.__version!==X.version){rt(vt,X,z);return}t.activeTexture(33984+z),t.bindTexture(35866,vt.__webglTexture)}function M(X,z){const vt=e.get(X);if(X.version>0&&vt.__version!==X.version){rt(vt,X,z);return}t.activeTexture(33984+z),t.bindTexture(32879,vt.__webglTexture)}function J(X,z){const vt=e.get(X);if(X.version>0&&vt.__version!==X.version){ft(vt,X,z);return}t.activeTexture(33984+z),t.bindTexture(34067,vt.__webglTexture)}const et={[RepeatWrapping]:10497,[ClampToEdgeWrapping]:33071,[MirroredRepeatWrapping]:33648},Q={[NearestFilter]:9728,[NearestMipmapNearestFilter]:9984,[NearestMipmapLinearFilter]:9986,[LinearFilter]:9729,[LinearMipmapNearestFilter]:9985,[LinearMipmapLinearFilter]:9987};function ot(X,z,vt){if(vt?(l.texParameteri(X,10242,et[z.wrapS]),l.texParameteri(X,10243,et[z.wrapT]),(X===32879||X===35866)&&l.texParameteri(X,32882,et[z.wrapR]),l.texParameteri(X,10240,Q[z.magFilter]),l.texParameteri(X,10241,Q[z.minFilter])):(l.texParameteri(X,10242,33071),l.texParameteri(X,10243,33071),(X===32879||X===35866)&&l.texParameteri(X,32882,33071),(z.wrapS!==ClampToEdgeWrapping||z.wrapT!==ClampToEdgeWrapping)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),l.texParameteri(X,10240,S(z.magFilter)),l.texParameteri(X,10241,S(z.minFilter)),z.minFilter!==NearestFilter&&z.minFilter!==LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),n.has("EXT_texture_filter_anisotropic")===!0){const St=n.get("EXT_texture_filter_anisotropic");if(z.type===FloatType&&n.has("OES_texture_float_linear")===!1||o===!1&&z.type===HalfFloatType&&n.has("OES_texture_half_float_linear")===!1)return;(z.anisotropy>1||e.get(z).__currentAnisotropy)&&(l.texParameterf(X,St.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(z.anisotropy,i.getMaxAnisotropy())),e.get(z).__currentAnisotropy=z.anisotropy)}}function tt(X,z){X.__webglInit===void 0&&(X.__webglInit=!0,z.addEventListener("dispose",P),X.__webglTexture=l.createTexture(),r.memory.textures++)}function rt(X,z,vt){let St=3553;z.isDataTexture2DArray&&(St=35866),z.isDataTexture3D&&(St=32879),tt(X,z),t.activeTexture(33984+vt),t.bindTexture(St,X.__webglTexture),l.pixelStorei(37440,z.flipY),l.pixelStorei(37441,z.premultiplyAlpha),l.pixelStorei(3317,z.unpackAlignment),l.pixelStorei(37443,0);const Dt=m(z)&&E(z.image)===!1,kt=y(z.image,Dt,!1,p),Wt=E(kt)||o,Y=s.convert(z.format);let At=s.convert(z.type),Mt=O(z.internalFormat,Y,At);ot(St,z,Wt);let q;const xt=z.mipmaps;if(z.isDepthTexture)Mt=6402,o?z.type===FloatType?Mt=36012:z.type===UnsignedIntType?Mt=33190:z.type===UnsignedInt248Type?Mt=35056:Mt=33189:z.type===FloatType&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),z.format===DepthFormat&&Mt===6402&&z.type!==UnsignedShortType&&z.type!==UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),z.type=UnsignedShortType,At=s.convert(z.type)),z.format===DepthStencilFormat&&Mt===6402&&(Mt=34041,z.type!==UnsignedInt248Type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),z.type=UnsignedInt248Type,At=s.convert(z.type))),t.texImage2D(3553,0,Mt,kt.width,kt.height,0,Y,At,null);else if(z.isDataTexture)if(xt.length>0&&Wt){for(let pt=0,Bt=xt.length;pt<Bt;pt++)q=xt[pt],t.texImage2D(3553,pt,Mt,q.width,q.height,0,Y,At,q.data);z.generateMipmaps=!1,X.__maxMipLevel=xt.length-1}else t.texImage2D(3553,0,Mt,kt.width,kt.height,0,Y,At,kt.data),X.__maxMipLevel=0;else if(z.isCompressedTexture){for(let pt=0,Bt=xt.length;pt<Bt;pt++)q=xt[pt],z.format!==RGBAFormat&&z.format!==RGBFormat?Y!==null?t.compressedTexImage2D(3553,pt,Mt,q.width,q.height,0,q.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):t.texImage2D(3553,pt,Mt,q.width,q.height,0,Y,At,q.data);X.__maxMipLevel=xt.length-1}else if(z.isDataTexture2DArray)t.texImage3D(35866,0,Mt,kt.width,kt.height,kt.depth,0,Y,At,kt.data),X.__maxMipLevel=0;else if(z.isDataTexture3D)t.texImage3D(32879,0,Mt,kt.width,kt.height,kt.depth,0,Y,At,kt.data),X.__maxMipLevel=0;else if(xt.length>0&&Wt){for(let pt=0,Bt=xt.length;pt<Bt;pt++)q=xt[pt],t.texImage2D(3553,pt,Mt,Y,At,q);z.generateMipmaps=!1,X.__maxMipLevel=xt.length-1}else t.texImage2D(3553,0,Mt,Y,At,kt),X.__maxMipLevel=0;x(z,Wt)&&C(St,z,kt.width,kt.height),X.__version=z.version,z.onUpdate&&z.onUpdate(z)}function ft(X,z,vt){if(z.image.length!==6)return;tt(X,z),t.activeTexture(33984+vt),t.bindTexture(34067,X.__webglTexture),l.pixelStorei(37440,z.flipY),l.pixelStorei(37441,z.premultiplyAlpha),l.pixelStorei(3317,z.unpackAlignment),l.pixelStorei(37443,0);const St=z&&(z.isCompressedTexture||z.image[0].isCompressedTexture),Dt=z.image[0]&&z.image[0].isDataTexture,kt=[];for(let pt=0;pt<6;pt++)!St&&!Dt?kt[pt]=y(z.image[pt],!1,!0,u):kt[pt]=Dt?z.image[pt].image:z.image[pt];const Wt=kt[0],Y=E(Wt)||o,At=s.convert(z.format),Mt=s.convert(z.type),q=O(z.internalFormat,At,Mt);ot(34067,z,Y);let xt;if(St){for(let pt=0;pt<6;pt++){xt=kt[pt].mipmaps;for(let Bt=0;Bt<xt.length;Bt++){const Ot=xt[Bt];z.format!==RGBAFormat&&z.format!==RGBFormat?At!==null?t.compressedTexImage2D(34069+pt,Bt,q,Ot.width,Ot.height,0,Ot.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):t.texImage2D(34069+pt,Bt,q,Ot.width,Ot.height,0,At,Mt,Ot.data)}}X.__maxMipLevel=xt.length-1}else{xt=z.mipmaps;for(let pt=0;pt<6;pt++)if(Dt){t.texImage2D(34069+pt,0,q,kt[pt].width,kt[pt].height,0,At,Mt,kt[pt].data);for(let Bt=0;Bt<xt.length;Bt++){const te=xt[Bt].image[pt].image;t.texImage2D(34069+pt,Bt+1,q,te.width,te.height,0,At,Mt,te.data)}}else{t.texImage2D(34069+pt,0,q,At,Mt,kt[pt]);for(let Bt=0;Bt<xt.length;Bt++){const Ot=xt[Bt];t.texImage2D(34069+pt,Bt+1,q,At,Mt,Ot.image[pt])}}X.__maxMipLevel=xt.length}x(z,Y)&&C(34067,z,Wt.width,Wt.height),X.__version=z.version,z.onUpdate&&z.onUpdate(z)}function _t(X,z,vt,St,Dt){const kt=s.convert(vt.format),Wt=s.convert(vt.type),Y=O(vt.internalFormat,kt,Wt);Dt===32879||Dt===35866?t.texImage3D(Dt,0,Y,z.width,z.height,z.depth,0,kt,Wt,null):t.texImage2D(Dt,0,Y,z.width,z.height,0,kt,Wt,null),t.bindFramebuffer(36160,X),l.framebufferTexture2D(36160,St,Dt,e.get(vt).__webglTexture,0),t.bindFramebuffer(36160,null)}function yt(X,z,vt){if(l.bindRenderbuffer(36161,X),z.depthBuffer&&!z.stencilBuffer){let St=33189;if(vt){const Dt=z.depthTexture;Dt&&Dt.isDepthTexture&&(Dt.type===FloatType?St=36012:Dt.type===UnsignedIntType&&(St=33190));const kt=Ct(z);l.renderbufferStorageMultisample(36161,kt,St,z.width,z.height)}else l.renderbufferStorage(36161,St,z.width,z.height);l.framebufferRenderbuffer(36160,36096,36161,X)}else if(z.depthBuffer&&z.stencilBuffer){if(vt){const St=Ct(z);l.renderbufferStorageMultisample(36161,St,35056,z.width,z.height)}else l.renderbufferStorage(36161,34041,z.width,z.height);l.framebufferRenderbuffer(36160,33306,36161,X)}else{const St=z.isWebGLMultipleRenderTargets===!0?z.texture[0]:z.texture,Dt=s.convert(St.format),kt=s.convert(St.type),Wt=O(St.internalFormat,Dt,kt);if(vt){const Y=Ct(z);l.renderbufferStorageMultisample(36161,Y,Wt,z.width,z.height)}else l.renderbufferStorage(36161,Wt,z.width,z.height)}l.bindRenderbuffer(36161,null)}function Z(X,z){if(z&&z.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,X),!(z.depthTexture&&z.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!e.get(z.depthTexture).__webglTexture||z.depthTexture.image.width!==z.width||z.depthTexture.image.height!==z.height)&&(z.depthTexture.image.width=z.width,z.depthTexture.image.height=z.height,z.depthTexture.needsUpdate=!0),G(z.depthTexture,0);const St=e.get(z.depthTexture).__webglTexture;if(z.depthTexture.format===DepthFormat)l.framebufferTexture2D(36160,36096,3553,St,0);else if(z.depthTexture.format===DepthStencilFormat)l.framebufferTexture2D(36160,33306,3553,St,0);else throw new Error("Unknown depthTexture format")}function bt(X){const z=e.get(X),vt=X.isWebGLCubeRenderTarget===!0;if(X.depthTexture){if(vt)throw new Error("target.depthTexture not supported in Cube render targets");Z(z.__webglFramebuffer,X)}else if(vt){z.__webglDepthbuffer=[];for(let St=0;St<6;St++)t.bindFramebuffer(36160,z.__webglFramebuffer[St]),z.__webglDepthbuffer[St]=l.createRenderbuffer(),yt(z.__webglDepthbuffer[St],X,!1)}else t.bindFramebuffer(36160,z.__webglFramebuffer),z.__webglDepthbuffer=l.createRenderbuffer(),yt(z.__webglDepthbuffer,X,!1);t.bindFramebuffer(36160,null)}function at(X){const z=X.texture,vt=e.get(X),St=e.get(z);X.addEventListener("dispose",F),X.isWebGLMultipleRenderTargets!==!0&&(St.__webglTexture=l.createTexture(),St.__version=z.version,r.memory.textures++);const Dt=X.isWebGLCubeRenderTarget===!0,kt=X.isWebGLMultipleRenderTargets===!0,Wt=X.isWebGLMultisampleRenderTarget===!0,Y=z.isDataTexture3D||z.isDataTexture2DArray,At=E(X)||o;if(o&&z.format===RGBFormat&&(z.type===FloatType||z.type===HalfFloatType)&&(z.format=RGBAFormat,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),Dt){vt.__webglFramebuffer=[];for(let Mt=0;Mt<6;Mt++)vt.__webglFramebuffer[Mt]=l.createFramebuffer()}else if(vt.__webglFramebuffer=l.createFramebuffer(),kt)if(i.drawBuffers){const Mt=X.texture;for(let q=0,xt=Mt.length;q<xt;q++){const pt=e.get(Mt[q]);pt.__webglTexture===void 0&&(pt.__webglTexture=l.createTexture(),r.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(Wt)if(o){vt.__webglMultisampledFramebuffer=l.createFramebuffer(),vt.__webglColorRenderbuffer=l.createRenderbuffer(),l.bindRenderbuffer(36161,vt.__webglColorRenderbuffer);const Mt=s.convert(z.format),q=s.convert(z.type),xt=O(z.internalFormat,Mt,q),pt=Ct(X);l.renderbufferStorageMultisample(36161,pt,xt,X.width,X.height),t.bindFramebuffer(36160,vt.__webglMultisampledFramebuffer),l.framebufferRenderbuffer(36160,36064,36161,vt.__webglColorRenderbuffer),l.bindRenderbuffer(36161,null),X.depthBuffer&&(vt.__webglDepthRenderbuffer=l.createRenderbuffer(),yt(vt.__webglDepthRenderbuffer,X,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(Dt){t.bindTexture(34067,St.__webglTexture),ot(34067,z,At);for(let Mt=0;Mt<6;Mt++)_t(vt.__webglFramebuffer[Mt],X,z,36064,34069+Mt);x(z,At)&&C(34067,z,X.width,X.height),t.bindTexture(34067,null)}else if(kt){const Mt=X.texture;for(let q=0,xt=Mt.length;q<xt;q++){const pt=Mt[q],Bt=e.get(pt);t.bindTexture(3553,Bt.__webglTexture),ot(3553,pt,At),_t(vt.__webglFramebuffer,X,pt,36064+q,3553),x(pt,At)&&C(3553,pt,X.width,X.height)}t.bindTexture(3553,null)}else{let Mt=3553;Y&&(o?Mt=z.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),t.bindTexture(Mt,St.__webglTexture),ot(Mt,z,At),_t(vt.__webglFramebuffer,X,z,36064,Mt),x(z,At)&&C(3553,z,X.width,X.height),t.bindTexture(3553,null)}X.depthBuffer&&bt(X)}function nt(X){const z=E(X)||o,vt=X.isWebGLMultipleRenderTargets===!0?X.texture:[X.texture];for(let St=0,Dt=vt.length;St<Dt;St++){const kt=vt[St];if(x(kt,z)){const Wt=X.isWebGLCubeRenderTarget?34067:3553,Y=e.get(kt).__webglTexture;t.bindTexture(Wt,Y),C(Wt,kt,X.width,X.height),t.bindTexture(Wt,null)}}}function ht(X){if(X.isWebGLMultisampleRenderTarget)if(o){const z=X.width,vt=X.height;let St=16384;X.depthBuffer&&(St|=256),X.stencilBuffer&&(St|=1024);const Dt=e.get(X);t.bindFramebuffer(36008,Dt.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,Dt.__webglFramebuffer),l.blitFramebuffer(0,0,z,vt,0,0,z,vt,St,9728),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,Dt.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function Ct(X){return o&&X.isWebGLMultisampleRenderTarget?Math.min(d,X.samples):0}function gt(X){const z=r.render.frame;f.get(X)!==z&&(f.set(X,z),X.update())}let mt=!1,Rt=!1;function Ft(X,z){X&&X.isWebGLRenderTarget&&(mt===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),mt=!0),X=X.texture),G(X,z)}function Pt(X,z){X&&X.isWebGLCubeRenderTarget&&(Rt===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),Rt=!0),X=X.texture),J(X,z)}this.allocateTextureUnit=A,this.resetTextureUnits=W,this.setTexture2D=G,this.setTexture2DArray=D,this.setTexture3D=M,this.setTextureCube=J,this.setupRenderTarget=at,this.updateRenderTargetMipmap=nt,this.updateMultisampleRenderTarget=ht,this.safeSetTexture2D=Ft,this.safeSetTextureCube=Pt}function WebGLUtils(l,n,t){const e=t.isWebGL2;function i(s){let r;if(s===UnsignedByteType)return 5121;if(s===UnsignedShort4444Type)return 32819;if(s===UnsignedShort5551Type)return 32820;if(s===UnsignedShort565Type)return 33635;if(s===ByteType)return 5120;if(s===ShortType)return 5122;if(s===UnsignedShortType)return 5123;if(s===IntType)return 5124;if(s===UnsignedIntType)return 5125;if(s===FloatType)return 5126;if(s===HalfFloatType)return e?5131:(r=n.get("OES_texture_half_float"),r!==null?r.HALF_FLOAT_OES:null);if(s===AlphaFormat)return 6406;if(s===RGBFormat)return 6407;if(s===RGBAFormat)return 6408;if(s===LuminanceFormat)return 6409;if(s===LuminanceAlphaFormat)return 6410;if(s===DepthFormat)return 6402;if(s===DepthStencilFormat)return 34041;if(s===RedFormat)return 6403;if(s===RedIntegerFormat)return 36244;if(s===RGFormat)return 33319;if(s===RGIntegerFormat)return 33320;if(s===RGBIntegerFormat)return 36248;if(s===RGBAIntegerFormat)return 36249;if(s===RGB_S3TC_DXT1_Format||s===RGBA_S3TC_DXT1_Format||s===RGBA_S3TC_DXT3_Format||s===RGBA_S3TC_DXT5_Format)if(r=n.get("WEBGL_compressed_texture_s3tc"),r!==null){if(s===RGB_S3TC_DXT1_Format)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===RGBA_S3TC_DXT1_Format)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===RGBA_S3TC_DXT3_Format)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===RGBA_S3TC_DXT5_Format)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===RGB_PVRTC_4BPPV1_Format||s===RGB_PVRTC_2BPPV1_Format||s===RGBA_PVRTC_4BPPV1_Format||s===RGBA_PVRTC_2BPPV1_Format)if(r=n.get("WEBGL_compressed_texture_pvrtc"),r!==null){if(s===RGB_PVRTC_4BPPV1_Format)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===RGB_PVRTC_2BPPV1_Format)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===RGBA_PVRTC_4BPPV1_Format)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===RGBA_PVRTC_2BPPV1_Format)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===RGB_ETC1_Format)return r=n.get("WEBGL_compressed_texture_etc1"),r!==null?r.COMPRESSED_RGB_ETC1_WEBGL:null;if((s===RGB_ETC2_Format||s===RGBA_ETC2_EAC_Format)&&(r=n.get("WEBGL_compressed_texture_etc"),r!==null)){if(s===RGB_ETC2_Format)return r.COMPRESSED_RGB8_ETC2;if(s===RGBA_ETC2_EAC_Format)return r.COMPRESSED_RGBA8_ETC2_EAC}if(s===RGBA_ASTC_4x4_Format||s===RGBA_ASTC_5x4_Format||s===RGBA_ASTC_5x5_Format||s===RGBA_ASTC_6x5_Format||s===RGBA_ASTC_6x6_Format||s===RGBA_ASTC_8x5_Format||s===RGBA_ASTC_8x6_Format||s===RGBA_ASTC_8x8_Format||s===RGBA_ASTC_10x5_Format||s===RGBA_ASTC_10x6_Format||s===RGBA_ASTC_10x8_Format||s===RGBA_ASTC_10x10_Format||s===RGBA_ASTC_12x10_Format||s===RGBA_ASTC_12x12_Format||s===SRGB8_ALPHA8_ASTC_4x4_Format||s===SRGB8_ALPHA8_ASTC_5x4_Format||s===SRGB8_ALPHA8_ASTC_5x5_Format||s===SRGB8_ALPHA8_ASTC_6x5_Format||s===SRGB8_ALPHA8_ASTC_6x6_Format||s===SRGB8_ALPHA8_ASTC_8x5_Format||s===SRGB8_ALPHA8_ASTC_8x6_Format||s===SRGB8_ALPHA8_ASTC_8x8_Format||s===SRGB8_ALPHA8_ASTC_10x5_Format||s===SRGB8_ALPHA8_ASTC_10x6_Format||s===SRGB8_ALPHA8_ASTC_10x8_Format||s===SRGB8_ALPHA8_ASTC_10x10_Format||s===SRGB8_ALPHA8_ASTC_12x10_Format||s===SRGB8_ALPHA8_ASTC_12x12_Format)return r=n.get("WEBGL_compressed_texture_astc"),r!==null?s:null;if(s===RGBA_BPTC_Format)return r=n.get("EXT_texture_compression_bptc"),r!==null?s:null;if(s===UnsignedInt248Type)return e?34042:(r=n.get("WEBGL_depth_texture"),r!==null?r.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:i}}class ArrayCamera extends PerspectiveCamera{constructor(n=[]){super(),this.cameras=n}}ArrayCamera.prototype.isArrayCamera=!0;let Group$1=class extends Object3D{constructor(){super(),this.type="Group"}};Group$1.prototype.isGroup=!0;const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Group$1,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Group$1,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Group$1,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip}dispatchEvent(n){return this._targetRay!==null&&this._targetRay.dispatchEvent(n),this._grip!==null&&this._grip.dispatchEvent(n),this._hand!==null&&this._hand.dispatchEvent(n),this}disconnect(n){return this.dispatchEvent({type:"disconnected",data:n}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(n,t,e){let i=null,s=null,r=null;const o=this._targetRay,h=this._grip,u=this._hand;if(n&&t.session.visibilityState!=="visible-blurred")if(o!==null&&(i=t.getPose(n.targetRaySpace,e),i!==null&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent))),u&&n.hand){r=!0;for(const v of n.hand.values()){const y=t.getJointPose(v,e);if(u.joints[v.jointName]===void 0){const m=new Group$1;m.matrixAutoUpdate=!1,m.visible=!1,u.joints[v.jointName]=m,u.add(m)}const E=u.joints[v.jointName];y!==null&&(E.matrix.fromArray(y.transform.matrix),E.matrix.decompose(E.position,E.rotation,E.scale),E.jointRadius=y.radius),E.visible=y!==null}const p=u.joints["index-finger-tip"],d=u.joints["thumb-tip"],f=p.position.distanceTo(d.position),g=.02,_=.005;u.inputState.pinching&&f>g+_?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:n.handedness,target:this})):!u.inputState.pinching&&f<=g-_&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:n.handedness,target:this}))}else h!==null&&n.gripSpace&&(s=t.getPose(n.gripSpace,e),s!==null&&(h.matrix.fromArray(s.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),s.linearVelocity?(h.hasLinearVelocity=!0,h.linearVelocity.copy(s.linearVelocity)):h.hasLinearVelocity=!1,s.angularVelocity?(h.hasAngularVelocity=!0,h.angularVelocity.copy(s.angularVelocity)):h.hasAngularVelocity=!1));return o!==null&&(o.visible=i!==null),h!==null&&(h.visible=s!==null),u!==null&&(u.visible=r!==null),this}}class WebXRManager extends EventDispatcher{constructor(n,t){super();const e=this,i=n.state;let s=null,r=1,o=null,h="local-floor",u=null;const p=[],d=new Map,f=new PerspectiveCamera;f.layers.enable(1),f.viewport=new Vector4;const g=new PerspectiveCamera;g.layers.enable(2),g.viewport=new Vector4;const _=[f,g],v=new ArrayCamera;v.layers.enable(1),v.layers.enable(2);let y=null,E=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(W){let A=p[W];return A===void 0&&(A=new WebXRController,p[W]=A),A.getTargetRaySpace()},this.getControllerGrip=function(W){let A=p[W];return A===void 0&&(A=new WebXRController,p[W]=A),A.getGripSpace()},this.getHand=function(W){let A=p[W];return A===void 0&&(A=new WebXRController,p[W]=A),A.getHandSpace()};function m(W){const A=d.get(W.inputSource);A&&A.dispatchEvent({type:W.type,data:W.inputSource})}function x(){d.forEach(function(W,A){W.disconnect(A)}),d.clear(),y=null,E=null,i.bindXRFramebuffer(null),n.setRenderTarget(n.getRenderTarget()),B.stop(),e.isPresenting=!1,e.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(W){r=W,e.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(W){h=W,e.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return s},this.setSession=async function(W){if(s=W,s!==null){s.addEventListener("select",m),s.addEventListener("selectstart",m),s.addEventListener("selectend",m),s.addEventListener("squeeze",m),s.addEventListener("squeezestart",m),s.addEventListener("squeezeend",m),s.addEventListener("end",x),s.addEventListener("inputsourceschange",C);const A=t.getContextAttributes();A.xrCompatible!==!0&&await t.makeXRCompatible();const G={antialias:A.antialias,alpha:A.alpha,depth:A.depth,stencil:A.stencil,framebufferScaleFactor:r},D=new XRWebGLLayer(s,t,G);s.updateRenderState({baseLayer:D}),o=await s.requestReferenceSpace(h),B.setContext(s),B.start(),e.isPresenting=!0,e.dispatchEvent({type:"sessionstart"})}};function C(W){const A=s.inputSources;for(let G=0;G<p.length;G++)d.set(A[G],p[G]);for(let G=0;G<W.removed.length;G++){const D=W.removed[G],M=d.get(D);M&&(M.dispatchEvent({type:"disconnected",data:D}),d.delete(D))}for(let G=0;G<W.added.length;G++){const D=W.added[G],M=d.get(D);M&&M.dispatchEvent({type:"connected",data:D})}}const O=new Vector3,S=new Vector3;function P(W,A,G){O.setFromMatrixPosition(A.matrixWorld),S.setFromMatrixPosition(G.matrixWorld);const D=O.distanceTo(S),M=A.projectionMatrix.elements,J=G.projectionMatrix.elements,et=M[14]/(M[10]-1),Q=M[14]/(M[10]+1),ot=(M[9]+1)/M[5],tt=(M[9]-1)/M[5],rt=(M[8]-1)/M[0],ft=(J[8]+1)/J[0],_t=et*rt,yt=et*ft,Z=D/(-rt+ft),bt=Z*-rt;A.matrixWorld.decompose(W.position,W.quaternion,W.scale),W.translateX(bt),W.translateZ(Z),W.matrixWorld.compose(W.position,W.quaternion,W.scale),W.matrixWorldInverse.copy(W.matrixWorld).invert();const at=et+Z,nt=Q+Z,ht=_t-bt,Ct=yt+(D-bt),gt=ot*Q/nt*at,mt=tt*Q/nt*at;W.projectionMatrix.makePerspective(ht,Ct,gt,mt,at,nt)}function F(W,A){A===null?W.matrixWorld.copy(W.matrix):W.matrixWorld.multiplyMatrices(A.matrixWorld,W.matrix),W.matrixWorldInverse.copy(W.matrixWorld).invert()}this.updateCamera=function(W){if(s===null)return;v.near=g.near=f.near=W.near,v.far=g.far=f.far=W.far,(y!==v.near||E!==v.far)&&(s.updateRenderState({depthNear:v.near,depthFar:v.far}),y=v.near,E=v.far);const A=W.parent,G=v.cameras;F(v,A);for(let M=0;M<G.length;M++)F(G[M],A);W.matrixWorld.copy(v.matrixWorld),W.matrix.copy(v.matrix),W.matrix.decompose(W.position,W.quaternion,W.scale);const D=W.children;for(let M=0,J=D.length;M<J;M++)D[M].updateMatrixWorld(!0);G.length===2?P(v,f,g):v.projectionMatrix.copy(f.projectionMatrix)},this.getCamera=function(){return v};let V=null;function N(W,A){if(u=A.getViewerPose(o),u!==null){const D=u.views,M=s.renderState.baseLayer;i.bindXRFramebuffer(M.framebuffer);let J=!1;D.length!==v.cameras.length&&(v.cameras.length=0,J=!0);for(let et=0;et<D.length;et++){const Q=D[et],ot=M.getViewport(Q),tt=_[et];tt.matrix.fromArray(Q.transform.matrix),tt.projectionMatrix.fromArray(Q.projectionMatrix),tt.viewport.set(ot.x,ot.y,ot.width,ot.height),et===0&&v.matrix.copy(tt.matrix),J===!0&&v.cameras.push(tt)}}const G=s.inputSources;for(let D=0;D<p.length;D++){const M=p[D],J=G[D];M.update(J,A,o)}V&&V(W,A)}const B=new WebGLAnimation;B.setAnimationLoop(N),this.setAnimationLoop=function(W){V=W},this.dispose=function(){}}}function WebGLMaterials(l){function n(E,m){E.fogColor.value.copy(m.color),m.isFog?(E.fogNear.value=m.near,E.fogFar.value=m.far):m.isFogExp2&&(E.fogDensity.value=m.density)}function t(E,m,x,C,O){m.isMeshBasicMaterial?e(E,m):m.isMeshLambertMaterial?(e(E,m),h(E,m)):m.isMeshToonMaterial?(e(E,m),p(E,m)):m.isMeshPhongMaterial?(e(E,m),u(E,m)):m.isMeshStandardMaterial?(e(E,m),m.isMeshPhysicalMaterial?f(E,m,O):d(E,m)):m.isMeshMatcapMaterial?(e(E,m),g(E,m)):m.isMeshDepthMaterial?(e(E,m),_(E,m)):m.isMeshDistanceMaterial?(e(E,m),v(E,m)):m.isMeshNormalMaterial?(e(E,m),y(E,m)):m.isLineBasicMaterial?(i(E,m),m.isLineDashedMaterial&&s(E,m)):m.isPointsMaterial?r(E,m,x,C):m.isSpriteMaterial?o(E,m):m.isShadowMaterial?(E.color.value.copy(m.color),E.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function e(E,m){E.opacity.value=m.opacity,m.color&&E.diffuse.value.copy(m.color),m.emissive&&E.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(E.map.value=m.map),m.alphaMap&&(E.alphaMap.value=m.alphaMap),m.specularMap&&(E.specularMap.value=m.specularMap);const x=l.get(m).envMap;if(x){E.envMap.value=x,E.flipEnvMap.value=x.isCubeTexture&&x._needsFlipEnvMap?-1:1,E.reflectivity.value=m.reflectivity,E.refractionRatio.value=m.refractionRatio;const S=l.get(x).__maxMipLevel;S!==void 0&&(E.maxMipLevel.value=S)}m.lightMap&&(E.lightMap.value=m.lightMap,E.lightMapIntensity.value=m.lightMapIntensity),m.aoMap&&(E.aoMap.value=m.aoMap,E.aoMapIntensity.value=m.aoMapIntensity);let C;m.map?C=m.map:m.specularMap?C=m.specularMap:m.displacementMap?C=m.displacementMap:m.normalMap?C=m.normalMap:m.bumpMap?C=m.bumpMap:m.roughnessMap?C=m.roughnessMap:m.metalnessMap?C=m.metalnessMap:m.alphaMap?C=m.alphaMap:m.emissiveMap?C=m.emissiveMap:m.clearcoatMap?C=m.clearcoatMap:m.clearcoatNormalMap?C=m.clearcoatNormalMap:m.clearcoatRoughnessMap&&(C=m.clearcoatRoughnessMap),C!==void 0&&(C.isWebGLRenderTarget&&(C=C.texture),C.matrixAutoUpdate===!0&&C.updateMatrix(),E.uvTransform.value.copy(C.matrix));let O;m.aoMap?O=m.aoMap:m.lightMap&&(O=m.lightMap),O!==void 0&&(O.isWebGLRenderTarget&&(O=O.texture),O.matrixAutoUpdate===!0&&O.updateMatrix(),E.uv2Transform.value.copy(O.matrix))}function i(E,m){E.diffuse.value.copy(m.color),E.opacity.value=m.opacity}function s(E,m){E.dashSize.value=m.dashSize,E.totalSize.value=m.dashSize+m.gapSize,E.scale.value=m.scale}function r(E,m,x,C){E.diffuse.value.copy(m.color),E.opacity.value=m.opacity,E.size.value=m.size*x,E.scale.value=C*.5,m.map&&(E.map.value=m.map),m.alphaMap&&(E.alphaMap.value=m.alphaMap);let O;m.map?O=m.map:m.alphaMap&&(O=m.alphaMap),O!==void 0&&(O.matrixAutoUpdate===!0&&O.updateMatrix(),E.uvTransform.value.copy(O.matrix))}function o(E,m){E.diffuse.value.copy(m.color),E.opacity.value=m.opacity,E.rotation.value=m.rotation,m.map&&(E.map.value=m.map),m.alphaMap&&(E.alphaMap.value=m.alphaMap);let x;m.map?x=m.map:m.alphaMap&&(x=m.alphaMap),x!==void 0&&(x.matrixAutoUpdate===!0&&x.updateMatrix(),E.uvTransform.value.copy(x.matrix))}function h(E,m){m.emissiveMap&&(E.emissiveMap.value=m.emissiveMap)}function u(E,m){E.specular.value.copy(m.specular),E.shininess.value=Math.max(m.shininess,1e-4),m.emissiveMap&&(E.emissiveMap.value=m.emissiveMap),m.bumpMap&&(E.bumpMap.value=m.bumpMap,E.bumpScale.value=m.bumpScale,m.side===BackSide&&(E.bumpScale.value*=-1)),m.normalMap&&(E.normalMap.value=m.normalMap,E.normalScale.value.copy(m.normalScale),m.side===BackSide&&E.normalScale.value.negate()),m.displacementMap&&(E.displacementMap.value=m.displacementMap,E.displacementScale.value=m.displacementScale,E.displacementBias.value=m.displacementBias)}function p(E,m){m.gradientMap&&(E.gradientMap.value=m.gradientMap),m.emissiveMap&&(E.emissiveMap.value=m.emissiveMap),m.bumpMap&&(E.bumpMap.value=m.bumpMap,E.bumpScale.value=m.bumpScale,m.side===BackSide&&(E.bumpScale.value*=-1)),m.normalMap&&(E.normalMap.value=m.normalMap,E.normalScale.value.copy(m.normalScale),m.side===BackSide&&E.normalScale.value.negate()),m.displacementMap&&(E.displacementMap.value=m.displacementMap,E.displacementScale.value=m.displacementScale,E.displacementBias.value=m.displacementBias)}function d(E,m){E.roughness.value=m.roughness,E.metalness.value=m.metalness,m.roughnessMap&&(E.roughnessMap.value=m.roughnessMap),m.metalnessMap&&(E.metalnessMap.value=m.metalnessMap),m.emissiveMap&&(E.emissiveMap.value=m.emissiveMap),m.bumpMap&&(E.bumpMap.value=m.bumpMap,E.bumpScale.value=m.bumpScale,m.side===BackSide&&(E.bumpScale.value*=-1)),m.normalMap&&(E.normalMap.value=m.normalMap,E.normalScale.value.copy(m.normalScale),m.side===BackSide&&E.normalScale.value.negate()),m.displacementMap&&(E.displacementMap.value=m.displacementMap,E.displacementScale.value=m.displacementScale,E.displacementBias.value=m.displacementBias),l.get(m).envMap&&(E.envMapIntensity.value=m.envMapIntensity)}function f(E,m,x){d(E,m),E.reflectivity.value=m.reflectivity,E.clearcoat.value=m.clearcoat,E.clearcoatRoughness.value=m.clearcoatRoughness,m.sheen&&E.sheen.value.copy(m.sheen),m.clearcoatMap&&(E.clearcoatMap.value=m.clearcoatMap),m.clearcoatRoughnessMap&&(E.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap),m.clearcoatNormalMap&&(E.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),E.clearcoatNormalMap.value=m.clearcoatNormalMap,m.side===BackSide&&E.clearcoatNormalScale.value.negate()),E.transmission.value=m.transmission,m.transmissionMap&&(E.transmissionMap.value=m.transmissionMap),m.transmission>0&&(E.transmissionSamplerMap.value=x.texture,E.transmissionSamplerSize.value.set(x.width,x.height)),E.thickness.value=m.thickness,m.thicknessMap&&(E.thicknessMap.value=m.thicknessMap),E.attenuationDistance.value=m.attenuationDistance,E.attenuationColor.value.copy(m.attenuationColor)}function g(E,m){m.matcap&&(E.matcap.value=m.matcap),m.bumpMap&&(E.bumpMap.value=m.bumpMap,E.bumpScale.value=m.bumpScale,m.side===BackSide&&(E.bumpScale.value*=-1)),m.normalMap&&(E.normalMap.value=m.normalMap,E.normalScale.value.copy(m.normalScale),m.side===BackSide&&E.normalScale.value.negate()),m.displacementMap&&(E.displacementMap.value=m.displacementMap,E.displacementScale.value=m.displacementScale,E.displacementBias.value=m.displacementBias)}function _(E,m){m.displacementMap&&(E.displacementMap.value=m.displacementMap,E.displacementScale.value=m.displacementScale,E.displacementBias.value=m.displacementBias)}function v(E,m){m.displacementMap&&(E.displacementMap.value=m.displacementMap,E.displacementScale.value=m.displacementScale,E.displacementBias.value=m.displacementBias),E.referencePosition.value.copy(m.referencePosition),E.nearDistance.value=m.nearDistance,E.farDistance.value=m.farDistance}function y(E,m){m.bumpMap&&(E.bumpMap.value=m.bumpMap,E.bumpScale.value=m.bumpScale,m.side===BackSide&&(E.bumpScale.value*=-1)),m.normalMap&&(E.normalMap.value=m.normalMap,E.normalScale.value.copy(m.normalScale),m.side===BackSide&&E.normalScale.value.negate()),m.displacementMap&&(E.displacementMap.value=m.displacementMap,E.displacementScale.value=m.displacementScale,E.displacementBias.value=m.displacementBias)}return{refreshFogUniforms:n,refreshMaterialUniforms:t}}function createCanvasElement(){const l=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return l.style.display="block",l}function WebGLRenderer(l){l=l||{};const n=l.canvas!==void 0?l.canvas:createCanvasElement(),t=l.context!==void 0?l.context:null,e=l.alpha!==void 0?l.alpha:!1,i=l.depth!==void 0?l.depth:!0,s=l.stencil!==void 0?l.stencil:!0,r=l.antialias!==void 0?l.antialias:!1,o=l.premultipliedAlpha!==void 0?l.premultipliedAlpha:!0,h=l.preserveDrawingBuffer!==void 0?l.preserveDrawingBuffer:!1,u=l.powerPreference!==void 0?l.powerPreference:"default",p=l.failIfMajorPerformanceCaveat!==void 0?l.failIfMajorPerformanceCaveat:!1;let d=null,f=null;const g=[],_=[];this.domElement=n,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=LinearEncoding,this.physicallyCorrectLights=!1,this.toneMapping=NoToneMapping,this.toneMappingExposure=1;const v=this;let y=!1,E=0,m=0,x=null,C=-1,O=null;const S=new Vector4,P=new Vector4;let F=null,V=n.width,N=n.height,B=1,W=null,A=null;const G=new Vector4(0,0,V,N),D=new Vector4(0,0,V,N);let M=!1;const J=[],et=new Frustum;let Q=!1,ot=!1,tt=null;const rt=new Matrix4,ft=new Vector3,_t={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function yt(){return x===null?B:1}let Z=t;function bt(H,ct){for(let st=0;st<H.length;st++){const ut=H[st],Lt=n.getContext(ut,ct);if(Lt!==null)return Lt}return null}try{const H={alpha:e,depth:i,stencil:s,antialias:r,premultipliedAlpha:o,preserveDrawingBuffer:h,powerPreference:u,failIfMajorPerformanceCaveat:p};if(n.addEventListener("webglcontextlost",te,!1),n.addEventListener("webglcontextrestored",ce,!1),Z===null){const ct=["webgl2","webgl","experimental-webgl"];if(v.isWebGL1Renderer===!0&&ct.shift(),Z=bt(ct,H),Z===null)throw bt(ct)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Z.getShaderPrecisionFormat===void 0&&(Z.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(H){throw console.error("THREE.WebGLRenderer: "+H.message),H}let at,nt,ht,Ct,gt,mt,Rt,Ft,Pt,X,z,vt,St,Dt,kt,Wt,Y,At,Mt,q,xt,pt;function Bt(){at=new WebGLExtensions(Z),nt=new WebGLCapabilities(Z,at,l),at.init(nt),xt=new WebGLUtils(Z,at,nt),ht=new WebGLState(Z,at,nt),J[0]=1029,Ct=new WebGLInfo,gt=new WebGLProperties,mt=new WebGLTextures(Z,at,ht,gt,nt,xt,Ct),Rt=new WebGLCubeMaps(v),Ft=new WebGLAttributes(Z,nt),pt=new WebGLBindingStates(Z,at,Ft,nt),Pt=new WebGLGeometries(Z,Ft,Ct,pt),X=new WebGLObjects(Z,Pt,Ft,Ct),At=new WebGLMorphtargets(Z),kt=new WebGLClipping(gt),z=new WebGLPrograms(v,Rt,at,nt,pt,kt),vt=new WebGLMaterials(gt),St=new WebGLRenderLists(gt),Dt=new WebGLRenderStates(at,nt),Y=new WebGLBackground(v,Rt,ht,X,o),Wt=new WebGLShadowMap(v,X,nt),Mt=new WebGLBufferRenderer(Z,at,Ct,nt),q=new WebGLIndexedBufferRenderer(Z,at,Ct,nt),Ct.programs=z.programs,v.capabilities=nt,v.extensions=at,v.properties=gt,v.renderLists=St,v.shadowMap=Wt,v.state=ht,v.info=Ct}Bt();const Ot=new WebXRManager(v,Z);this.xr=Ot,this.getContext=function(){return Z},this.getContextAttributes=function(){return Z.getContextAttributes()},this.forceContextLoss=function(){const H=at.get("WEBGL_lose_context");H&&H.loseContext()},this.forceContextRestore=function(){const H=at.get("WEBGL_lose_context");H&&H.restoreContext()},this.getPixelRatio=function(){return B},this.setPixelRatio=function(H){H!==void 0&&(B=H,this.setSize(V,N,!1))},this.getSize=function(H){return H===void 0&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),H=new Vector2),H.set(V,N)},this.setSize=function(H,ct,st){if(Ot.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}V=H,N=ct,n.width=Math.floor(H*B),n.height=Math.floor(ct*B),st!==!1&&(n.style.width=H+"px",n.style.height=ct+"px"),this.setViewport(0,0,H,ct)},this.getDrawingBufferSize=function(H){return H===void 0&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),H=new Vector2),H.set(V*B,N*B).floor()},this.setDrawingBufferSize=function(H,ct,st){V=H,N=ct,B=st,n.width=Math.floor(H*st),n.height=Math.floor(ct*st),this.setViewport(0,0,H,ct)},this.getCurrentViewport=function(H){return H===void 0&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),H=new Vector4),H.copy(S)},this.getViewport=function(H){return H.copy(G)},this.setViewport=function(H,ct,st,ut){H.isVector4?G.set(H.x,H.y,H.z,H.w):G.set(H,ct,st,ut),ht.viewport(S.copy(G).multiplyScalar(B).floor())},this.getScissor=function(H){return H.copy(D)},this.setScissor=function(H,ct,st,ut){H.isVector4?D.set(H.x,H.y,H.z,H.w):D.set(H,ct,st,ut),ht.scissor(P.copy(D).multiplyScalar(B).floor())},this.getScissorTest=function(){return M},this.setScissorTest=function(H){ht.setScissorTest(M=H)},this.setOpaqueSort=function(H){W=H},this.setTransparentSort=function(H){A=H},this.getClearColor=function(H){return H===void 0&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),H=new Color),H.copy(Y.getClearColor())},this.setClearColor=function(){Y.setClearColor.apply(Y,arguments)},this.getClearAlpha=function(){return Y.getClearAlpha()},this.setClearAlpha=function(){Y.setClearAlpha.apply(Y,arguments)},this.clear=function(H,ct,st){let ut=0;(H===void 0||H)&&(ut|=16384),(ct===void 0||ct)&&(ut|=256),(st===void 0||st)&&(ut|=1024),Z.clear(ut)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",te,!1),n.removeEventListener("webglcontextrestored",ce,!1),St.dispose(),Dt.dispose(),gt.dispose(),Rt.dispose(),X.dispose(),pt.dispose(),Ot.dispose(),Ot.removeEventListener("sessionstart",Fe),Ot.removeEventListener("sessionend",ze),tt&&(tt.dispose(),tt=null),Ae.stop()};function te(H){H.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),y=!0}function ce(){console.log("THREE.WebGLRenderer: Context Restored."),y=!1;const H=Ct.autoReset,ct=Wt.enabled,st=Wt.autoUpdate,ut=Wt.needsUpdate,Lt=Wt.type;Bt(),Ct.autoReset=H,Wt.enabled=ct,Wt.autoUpdate=st,Wt.needsUpdate=ut,Wt.type=Lt}function Ee(H){const ct=H.target;ct.removeEventListener("dispose",Ee),Ie(ct)}function Ie(H){fe(H),gt.remove(H)}function fe(H){const ct=gt.get(H).programs;ct!==void 0&&ct.forEach(function(st){z.releaseProgram(st)})}function Te(H,ct){H.render(function(st){v.renderBufferImmediate(st,ct)})}this.renderBufferImmediate=function(H,ct){pt.initAttributes();const st=gt.get(H);H.hasPositions&&!st.position&&(st.position=Z.createBuffer()),H.hasNormals&&!st.normal&&(st.normal=Z.createBuffer()),H.hasUvs&&!st.uv&&(st.uv=Z.createBuffer()),H.hasColors&&!st.color&&(st.color=Z.createBuffer());const ut=ct.getAttributes();H.hasPositions&&(Z.bindBuffer(34962,st.position),Z.bufferData(34962,H.positionArray,35048),pt.enableAttribute(ut.position),Z.vertexAttribPointer(ut.position,3,5126,!1,0,0)),H.hasNormals&&(Z.bindBuffer(34962,st.normal),Z.bufferData(34962,H.normalArray,35048),pt.enableAttribute(ut.normal),Z.vertexAttribPointer(ut.normal,3,5126,!1,0,0)),H.hasUvs&&(Z.bindBuffer(34962,st.uv),Z.bufferData(34962,H.uvArray,35048),pt.enableAttribute(ut.uv),Z.vertexAttribPointer(ut.uv,2,5126,!1,0,0)),H.hasColors&&(Z.bindBuffer(34962,st.color),Z.bufferData(34962,H.colorArray,35048),pt.enableAttribute(ut.color),Z.vertexAttribPointer(ut.color,3,5126,!1,0,0)),pt.disableUnusedAttributes(),Z.drawArrays(4,0,H.count),H.count=0},this.renderBufferDirect=function(H,ct,st,ut,Lt,oe){ct===null&&(ct=_t);const ee=Lt.isMesh&&Lt.matrixWorld.determinant()<0,Yt=ti(H,ct,ut,Lt);ht.setMaterial(ut,ee);let ne=st.index;const jt=st.attributes.position;if(ne===null){if(jt===void 0||jt.count===0)return}else if(ne.count===0)return;let se=1;ut.wireframe===!0&&(ne=Pt.getWireframeAttribute(st),se=2),(ut.morphTargets||ut.morphNormals)&&At.update(Lt,st,ut,Yt),pt.setup(Lt,ut,Yt,st,ne);let Xt,ae=Mt;ne!==null&&(Xt=Ft.get(ne),ae=q,ae.setIndex(Xt));const Ce=ne!==null?ne.count:jt.count,_e=st.drawRange.start*se,Oe=st.drawRange.count*se,Jt=oe!==null?oe.start*se:0,xe=oe!==null?oe.count*se:1/0,me=Math.max(_e,Jt),Le=Math.min(Ce,_e+Oe,Jt+xe)-1,Ve=Math.max(0,Le-me+1);if(Ve!==0){if(Lt.isMesh)ut.wireframe===!0?(ht.setLineWidth(ut.wireframeLinewidth*yt()),ae.setMode(1)):ae.setMode(4);else if(Lt.isLine){let Pe=ut.linewidth;Pe===void 0&&(Pe=1),ht.setLineWidth(Pe*yt()),Lt.isLineSegments?ae.setMode(1):Lt.isLineLoop?ae.setMode(2):ae.setMode(3)}else Lt.isPoints?ae.setMode(0):Lt.isSprite&&ae.setMode(4);if(Lt.isInstancedMesh)ae.renderInstances(me,Ve,Lt.count);else if(st.isInstancedBufferGeometry){const Pe=Math.min(st.instanceCount,st._maxInstanceCount);ae.renderInstances(me,Ve,Pe)}else ae.render(me,Ve)}},this.compile=function(H,ct){f=Dt.get(H),f.init(),H.traverseVisible(function(st){st.isLight&&st.layers.test(ct.layers)&&(f.pushLight(st),st.castShadow&&f.pushShadow(st))}),f.setupLights(),H.traverse(function(st){const ut=st.material;if(ut)if(Array.isArray(ut))for(let Lt=0;Lt<ut.length;Lt++){const oe=ut[Lt];Re(oe,H,st)}else Re(ut,H,st)})};let we=null;function $e(H){we&&we(H)}function Fe(){Ae.stop()}function ze(){Ae.start()}const Ae=new WebGLAnimation;Ae.setAnimationLoop($e),typeof window<"u"&&Ae.setContext(window),this.setAnimationLoop=function(H){we=H,Ot.setAnimationLoop(H),H===null?Ae.stop():Ae.start()},Ot.addEventListener("sessionstart",Fe),Ot.addEventListener("sessionend",ze),this.render=function(H,ct){if(ct!==void 0&&ct.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(y===!0)return;H.autoUpdate===!0&&H.updateMatrixWorld(),ct.parent===null&&ct.updateMatrixWorld(),Ot.enabled===!0&&Ot.isPresenting===!0&&(Ot.cameraAutoUpdate===!0&&Ot.updateCamera(ct),ct=Ot.getCamera()),H.isScene===!0&&H.onBeforeRender(v,H,ct,x),f=Dt.get(H,_.length),f.init(),_.push(f),rt.multiplyMatrices(ct.projectionMatrix,ct.matrixWorldInverse),et.setFromProjectionMatrix(rt),ot=this.localClippingEnabled,Q=kt.init(this.clippingPlanes,ot,ct),d=St.get(H,g.length),d.init(),g.push(d),Ze(H,ct,0,v.sortObjects),d.finish(),v.sortObjects===!0&&d.sort(W,A),Q===!0&&kt.beginShadows();const st=f.state.shadowsArray;Wt.render(st,H,ct),f.setupLights(),f.setupLightsView(ct),Q===!0&&kt.endShadows(),this.info.autoReset===!0&&this.info.reset(),Y.render(d,H);const ut=d.opaque,Lt=d.transmissive,oe=d.transparent;ut.length>0&&Be(ut,H,ct),Lt.length>0&&ni(ut,Lt,H,ct),oe.length>0&&Be(oe,H,ct),x!==null&&(mt.updateRenderTargetMipmap(x),mt.updateMultisampleRenderTarget(x)),H.isScene===!0&&H.onAfterRender(v,H,ct),ht.buffers.depth.setTest(!0),ht.buffers.depth.setMask(!0),ht.buffers.color.setMask(!0),ht.setPolygonOffset(!1),pt.resetDefaultState(),C=-1,O=null,_.pop(),_.length>0?f=_[_.length-1]:f=null,g.pop(),g.length>0?d=g[g.length-1]:d=null};function Ze(H,ct,st,ut){if(H.visible===!1)return;if(H.layers.test(ct.layers)){if(H.isGroup)st=H.renderOrder;else if(H.isLOD)H.autoUpdate===!0&&H.update(ct);else if(H.isLight)f.pushLight(H),H.castShadow&&f.pushShadow(H);else if(H.isSprite){if(!H.frustumCulled||et.intersectsSprite(H)){ut&&ft.setFromMatrixPosition(H.matrixWorld).applyMatrix4(rt);const ee=X.update(H),Yt=H.material;Yt.visible&&d.push(H,ee,Yt,st,ft.z,null)}}else if(H.isImmediateRenderObject)ut&&ft.setFromMatrixPosition(H.matrixWorld).applyMatrix4(rt),d.push(H,null,H.material,st,ft.z,null);else if((H.isMesh||H.isLine||H.isPoints)&&(H.isSkinnedMesh&&H.skeleton.frame!==Ct.render.frame&&(H.skeleton.update(),H.skeleton.frame=Ct.render.frame),!H.frustumCulled||et.intersectsObject(H))){ut&&ft.setFromMatrixPosition(H.matrixWorld).applyMatrix4(rt);const ee=X.update(H),Yt=H.material;if(Array.isArray(Yt)){const ne=ee.groups;for(let jt=0,se=ne.length;jt<se;jt++){const Xt=ne[jt],ae=Yt[Xt.materialIndex];ae&&ae.visible&&d.push(H,ee,ae,st,ft.z,Xt)}}else Yt.visible&&d.push(H,ee,Yt,st,ft.z,null)}}const oe=H.children;for(let ee=0,Yt=oe.length;ee<Yt;ee++)Ze(oe[ee],ct,st,ut)}function ni(H,ct,st,ut){tt===null&&(tt=new WebGLRenderTarget(1024,1024,{generateMipmaps:!0,minFilter:LinearMipmapLinearFilter,magFilter:NearestFilter,wrapS:ClampToEdgeWrapping,wrapT:ClampToEdgeWrapping}));const Lt=v.getRenderTarget();v.setRenderTarget(tt),v.clear(),Be(H,st,ut),mt.updateRenderTargetMipmap(tt),v.setRenderTarget(Lt),Be(ct,st,ut)}function Be(H,ct,st){const ut=ct.isScene===!0?ct.overrideMaterial:null;for(let Lt=0,oe=H.length;Lt<oe;Lt++){const ee=H[Lt],Yt=ee.object,ne=ee.geometry,jt=ut===null?ee.material:ut,se=ee.group;if(st.isArrayCamera){const Xt=st.cameras;for(let ae=0,Ce=Xt.length;ae<Ce;ae++){const _e=Xt[ae];Yt.layers.test(_e.layers)&&(ht.viewport(S.copy(_e.viewport)),f.setupLightsView(_e),Qe(Yt,ct,_e,ne,jt,se))}}else Qe(Yt,ct,st,ne,jt,se)}}function Qe(H,ct,st,ut,Lt,oe){if(H.onBeforeRender(v,ct,st,ut,Lt,oe),H.modelViewMatrix.multiplyMatrices(st.matrixWorldInverse,H.matrixWorld),H.normalMatrix.getNormalMatrix(H.modelViewMatrix),H.isImmediateRenderObject){const ee=ti(st,ct,Lt,H);ht.setMaterial(Lt),pt.reset(),Te(H,ee)}else v.renderBufferDirect(st,ct,ut,Lt,H,oe);H.onAfterRender(v,ct,st,ut,Lt,oe)}function Re(H,ct,st){ct.isScene!==!0&&(ct=_t);const ut=gt.get(H),Lt=f.state.lights,oe=f.state.shadowsArray,ee=Lt.state.version,Yt=z.getParameters(H,Lt.state,oe,ct,st),ne=z.getProgramCacheKey(Yt);let jt=ut.programs;ut.environment=H.isMeshStandardMaterial?ct.environment:null,ut.fog=ct.fog,ut.envMap=Rt.get(H.envMap||ut.environment),jt===void 0&&(H.addEventListener("dispose",Ee),jt=new Map,ut.programs=jt);let se=jt.get(ne);if(se!==void 0){if(ut.currentProgram===se&&ut.lightsStateVersion===ee)return Xe(H,Yt),se}else Yt.uniforms=z.getUniforms(H),H.onBuild(Yt,v),H.onBeforeCompile(Yt,v),se=z.acquireProgram(Yt,ne),jt.set(ne,se),ut.uniforms=Yt.uniforms;const Xt=ut.uniforms;(!H.isShaderMaterial&&!H.isRawShaderMaterial||H.clipping===!0)&&(Xt.clippingPlanes=kt.uniform),Xe(H,Yt),ut.needsLights=Ue(H),ut.lightsStateVersion=ee,ut.needsLights&&(Xt.ambientLightColor.value=Lt.state.ambient,Xt.lightProbe.value=Lt.state.probe,Xt.directionalLights.value=Lt.state.directional,Xt.directionalLightShadows.value=Lt.state.directionalShadow,Xt.spotLights.value=Lt.state.spot,Xt.spotLightShadows.value=Lt.state.spotShadow,Xt.rectAreaLights.value=Lt.state.rectArea,Xt.ltc_1.value=Lt.state.rectAreaLTC1,Xt.ltc_2.value=Lt.state.rectAreaLTC2,Xt.pointLights.value=Lt.state.point,Xt.pointLightShadows.value=Lt.state.pointShadow,Xt.hemisphereLights.value=Lt.state.hemi,Xt.directionalShadowMap.value=Lt.state.directionalShadowMap,Xt.directionalShadowMatrix.value=Lt.state.directionalShadowMatrix,Xt.spotShadowMap.value=Lt.state.spotShadowMap,Xt.spotShadowMatrix.value=Lt.state.spotShadowMatrix,Xt.pointShadowMap.value=Lt.state.pointShadowMap,Xt.pointShadowMatrix.value=Lt.state.pointShadowMatrix);const ae=se.getUniforms(),Ce=WebGLUniforms.seqWithValue(ae.seq,Xt);return ut.currentProgram=se,ut.uniformsList=Ce,se}function Xe(H,ct){const st=gt.get(H);st.outputEncoding=ct.outputEncoding,st.instancing=ct.instancing,st.skinning=ct.skinning,st.numClippingPlanes=ct.numClippingPlanes,st.numIntersection=ct.numClipIntersection,st.vertexAlphas=ct.vertexAlphas}function ti(H,ct,st,ut){ct.isScene!==!0&&(ct=_t),mt.resetTextureUnits();const Lt=ct.fog,oe=st.isMeshStandardMaterial?ct.environment:null,ee=x===null?v.outputEncoding:x.texture.encoding,Yt=Rt.get(st.envMap||oe),ne=st.vertexColors===!0&&ut.geometry&&ut.geometry.attributes.color&&ut.geometry.attributes.color.itemSize===4,jt=gt.get(st),se=f.state.lights;if(Q===!0&&(ot===!0||H!==O)){const me=H===O&&st.id===C;kt.setState(st,H,me)}let Xt=!1;st.version===jt.__version?(jt.needsLights&&jt.lightsStateVersion!==se.state.version||jt.outputEncoding!==ee||ut.isInstancedMesh&&jt.instancing===!1||!ut.isInstancedMesh&&jt.instancing===!0||ut.isSkinnedMesh&&jt.skinning===!1||!ut.isSkinnedMesh&&jt.skinning===!0||jt.envMap!==Yt||st.fog&&jt.fog!==Lt||jt.numClippingPlanes!==void 0&&(jt.numClippingPlanes!==kt.numPlanes||jt.numIntersection!==kt.numIntersection)||jt.vertexAlphas!==ne)&&(Xt=!0):(Xt=!0,jt.__version=st.version);let ae=jt.currentProgram;Xt===!0&&(ae=Re(st,ct,ut));let Ce=!1,_e=!1,Oe=!1;const Jt=ae.getUniforms(),xe=jt.uniforms;if(ht.useProgram(ae.program)&&(Ce=!0,_e=!0,Oe=!0),st.id!==C&&(C=st.id,_e=!0),Ce||O!==H){if(Jt.setValue(Z,"projectionMatrix",H.projectionMatrix),nt.logarithmicDepthBuffer&&Jt.setValue(Z,"logDepthBufFC",2/(Math.log(H.far+1)/Math.LN2)),O!==H&&(O=H,_e=!0,Oe=!0),st.isShaderMaterial||st.isMeshPhongMaterial||st.isMeshToonMaterial||st.isMeshStandardMaterial||st.envMap){const me=Jt.map.cameraPosition;me!==void 0&&me.setValue(Z,ft.setFromMatrixPosition(H.matrixWorld))}(st.isMeshPhongMaterial||st.isMeshToonMaterial||st.isMeshLambertMaterial||st.isMeshBasicMaterial||st.isMeshStandardMaterial||st.isShaderMaterial)&&Jt.setValue(Z,"isOrthographic",H.isOrthographicCamera===!0),(st.isMeshPhongMaterial||st.isMeshToonMaterial||st.isMeshLambertMaterial||st.isMeshBasicMaterial||st.isMeshStandardMaterial||st.isShaderMaterial||st.isShadowMaterial||ut.isSkinnedMesh)&&Jt.setValue(Z,"viewMatrix",H.matrixWorldInverse)}if(ut.isSkinnedMesh){Jt.setOptional(Z,ut,"bindMatrix"),Jt.setOptional(Z,ut,"bindMatrixInverse");const me=ut.skeleton;me&&(nt.floatVertexTextures?(me.boneTexture===null&&me.computeBoneTexture(),Jt.setValue(Z,"boneTexture",me.boneTexture,mt),Jt.setValue(Z,"boneTextureSize",me.boneTextureSize)):Jt.setOptional(Z,me,"boneMatrices"))}return(_e||jt.receiveShadow!==ut.receiveShadow)&&(jt.receiveShadow=ut.receiveShadow,Jt.setValue(Z,"receiveShadow",ut.receiveShadow)),_e&&(Jt.setValue(Z,"toneMappingExposure",v.toneMappingExposure),jt.needsLights&&ei(xe,Oe),Lt&&st.fog&&vt.refreshFogUniforms(xe,Lt),vt.refreshMaterialUniforms(xe,st,B,N,tt),WebGLUniforms.upload(Z,jt.uniformsList,xe,mt)),st.isShaderMaterial&&st.uniformsNeedUpdate===!0&&(WebGLUniforms.upload(Z,jt.uniformsList,xe,mt),st.uniformsNeedUpdate=!1),st.isSpriteMaterial&&Jt.setValue(Z,"center",ut.center),Jt.setValue(Z,"modelViewMatrix",ut.modelViewMatrix),Jt.setValue(Z,"normalMatrix",ut.normalMatrix),Jt.setValue(Z,"modelMatrix",ut.matrixWorld),ae}function ei(H,ct){H.ambientLightColor.needsUpdate=ct,H.lightProbe.needsUpdate=ct,H.directionalLights.needsUpdate=ct,H.directionalLightShadows.needsUpdate=ct,H.pointLights.needsUpdate=ct,H.pointLightShadows.needsUpdate=ct,H.spotLights.needsUpdate=ct,H.spotLightShadows.needsUpdate=ct,H.rectAreaLights.needsUpdate=ct,H.hemisphereLights.needsUpdate=ct}function Ue(H){return H.isMeshLambertMaterial||H.isMeshToonMaterial||H.isMeshPhongMaterial||H.isMeshStandardMaterial||H.isShadowMaterial||H.isShaderMaterial&&H.lights===!0}this.getActiveCubeFace=function(){return E},this.getActiveMipmapLevel=function(){return m},this.getRenderTarget=function(){return x},this.setRenderTarget=function(H,ct=0,st=0){x=H,E=ct,m=st,H&&gt.get(H).__webglFramebuffer===void 0&&mt.setupRenderTarget(H);let ut=null,Lt=!1,oe=!1;if(H){const Yt=H.texture;(Yt.isDataTexture3D||Yt.isDataTexture2DArray)&&(oe=!0);const ne=gt.get(H).__webglFramebuffer;H.isWebGLCubeRenderTarget?(ut=ne[ct],Lt=!0):H.isWebGLMultisampleRenderTarget?ut=gt.get(H).__webglMultisampledFramebuffer:ut=ne,S.copy(H.viewport),P.copy(H.scissor),F=H.scissorTest}else S.copy(G).multiplyScalar(B).floor(),P.copy(D).multiplyScalar(B).floor(),F=M;if(ht.bindFramebuffer(36160,ut)&&nt.drawBuffers){let Yt=!1;if(H)if(H.isWebGLMultipleRenderTargets){const ne=H.texture;if(J.length!==ne.length||J[0]!==36064){for(let jt=0,se=ne.length;jt<se;jt++)J[jt]=36064+jt;J.length=ne.length,Yt=!0}}else(J.length!==1||J[0]!==36064)&&(J[0]=36064,J.length=1,Yt=!0);else(J.length!==1||J[0]!==1029)&&(J[0]=1029,J.length=1,Yt=!0);Yt&&(nt.isWebGL2?Z.drawBuffers(J):at.get("WEBGL_draw_buffers").drawBuffersWEBGL(J))}if(ht.viewport(S),ht.scissor(P),ht.setScissorTest(F),Lt){const Yt=gt.get(H.texture);Z.framebufferTexture2D(36160,36064,34069+ct,Yt.__webglTexture,st)}else if(oe){const Yt=gt.get(H.texture),ne=ct||0;Z.framebufferTextureLayer(36160,36064,Yt.__webglTexture,st||0,ne)}},this.readRenderTargetPixels=function(H,ct,st,ut,Lt,oe,ee){if(!(H&&H.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Yt=gt.get(H).__webglFramebuffer;if(H.isWebGLCubeRenderTarget&&ee!==void 0&&(Yt=Yt[ee]),Yt){ht.bindFramebuffer(36160,Yt);try{const ne=H.texture,jt=ne.format,se=ne.type;if(jt!==RGBAFormat&&xt.convert(jt)!==Z.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Xt=se===HalfFloatType&&(at.has("EXT_color_buffer_half_float")||nt.isWebGL2&&at.has("EXT_color_buffer_float"));if(se!==UnsignedByteType&&xt.convert(se)!==Z.getParameter(35738)&&!(se===FloatType&&(nt.isWebGL2||at.has("OES_texture_float")||at.has("WEBGL_color_buffer_float")))&&!Xt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Z.checkFramebufferStatus(36160)===36053?ct>=0&&ct<=H.width-ut&&st>=0&&st<=H.height-Lt&&Z.readPixels(ct,st,ut,Lt,xt.convert(jt),xt.convert(se),oe):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const ne=x!==null?gt.get(x).__webglFramebuffer:null;ht.bindFramebuffer(36160,ne)}}},this.copyFramebufferToTexture=function(H,ct,st=0){const ut=Math.pow(2,-st),Lt=Math.floor(ct.image.width*ut),oe=Math.floor(ct.image.height*ut);let ee=xt.convert(ct.format);nt.isWebGL2&&(ee===6407&&(ee=32849),ee===6408&&(ee=32856)),mt.setTexture2D(ct,0),Z.copyTexImage2D(3553,st,ee,H.x,H.y,Lt,oe,0),ht.unbindTexture()},this.copyTextureToTexture=function(H,ct,st,ut=0){const Lt=ct.image.width,oe=ct.image.height,ee=xt.convert(st.format),Yt=xt.convert(st.type);mt.setTexture2D(st,0),Z.pixelStorei(37440,st.flipY),Z.pixelStorei(37441,st.premultiplyAlpha),Z.pixelStorei(3317,st.unpackAlignment),ct.isDataTexture?Z.texSubImage2D(3553,ut,H.x,H.y,Lt,oe,ee,Yt,ct.image.data):ct.isCompressedTexture?Z.compressedTexSubImage2D(3553,ut,H.x,H.y,ct.mipmaps[0].width,ct.mipmaps[0].height,ee,ct.mipmaps[0].data):Z.texSubImage2D(3553,ut,H.x,H.y,ee,Yt,ct.image),ut===0&&st.generateMipmaps&&Z.generateMipmap(3553),ht.unbindTexture()},this.copyTextureToTexture3D=function(H,ct,st,ut,Lt=0){if(v.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const{width:oe,height:ee,data:Yt}=st.image,ne=xt.convert(ut.format),jt=xt.convert(ut.type);let se;if(ut.isDataTexture3D)mt.setTexture3D(ut,0),se=32879;else if(ut.isDataTexture2DArray)mt.setTexture2DArray(ut,0),se=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Z.pixelStorei(37440,ut.flipY),Z.pixelStorei(37441,ut.premultiplyAlpha),Z.pixelStorei(3317,ut.unpackAlignment);const Xt=Z.getParameter(3314),ae=Z.getParameter(32878),Ce=Z.getParameter(3316),_e=Z.getParameter(3315),Oe=Z.getParameter(32877);Z.pixelStorei(3314,oe),Z.pixelStorei(32878,ee),Z.pixelStorei(3316,H.min.x),Z.pixelStorei(3315,H.min.y),Z.pixelStorei(32877,H.min.z),Z.texSubImage3D(se,Lt,ct.x,ct.y,ct.z,H.max.x-H.min.x+1,H.max.y-H.min.y+1,H.max.z-H.min.z+1,ne,jt,Yt),Z.pixelStorei(3314,Xt),Z.pixelStorei(32878,ae),Z.pixelStorei(3316,Ce),Z.pixelStorei(3315,_e),Z.pixelStorei(32877,Oe),Lt===0&&ut.generateMipmaps&&Z.generateMipmap(se),ht.unbindTexture()},this.initTexture=function(H){mt.setTexture2D(H,0),ht.unbindTexture()},this.resetState=function(){E=0,m=0,x=null,ht.reset(),pt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class WebGL1Renderer extends WebGLRenderer{}WebGL1Renderer.prototype.isWebGL1Renderer=!0;class Scene extends Object3D{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(n,t){return super.copy(n,t),n.background!==null&&(this.background=n.background.clone()),n.environment!==null&&(this.environment=n.environment.clone()),n.fog!==null&&(this.fog=n.fog.clone()),n.overrideMaterial!==null&&(this.overrideMaterial=n.overrideMaterial.clone()),this.autoUpdate=n.autoUpdate,this.matrixAutoUpdate=n.matrixAutoUpdate,this}toJSON(n){const t=super.toJSON(n);return this.background!==null&&(t.object.background=this.background.toJSON(n)),this.environment!==null&&(t.object.environment=this.environment.toJSON(n)),this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}}Scene.prototype.isScene=!0;class InterleavedBuffer{constructor(n,t){this.array=n,this.stride=t,this.count=n!==void 0?n.length/t:0,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=generateUUID()}onUploadCallback(){}set needsUpdate(n){n===!0&&this.version++}setUsage(n){return this.usage=n,this}copy(n){return this.array=new n.array.constructor(n.array),this.count=n.count,this.stride=n.stride,this.usage=n.usage,this}copyAt(n,t,e){n*=this.stride,e*=t.stride;for(let i=0,s=this.stride;i<s;i++)this.array[n+i]=t.array[e+i];return this}set(n,t=0){return this.array.set(n,t),this}clone(n){n.arrayBuffers===void 0&&(n.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID()),n.arrayBuffers[this.array.buffer._uuid]===void 0&&(n.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(n.arrayBuffers[this.array.buffer._uuid]),e=new this.constructor(t,this.stride);return e.setUsage(this.usage),e}onUpload(n){return this.onUploadCallback=n,this}toJSON(n){return n.arrayBuffers===void 0&&(n.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID()),n.arrayBuffers[this.array.buffer._uuid]===void 0&&(n.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}InterleavedBuffer.prototype.isInterleavedBuffer=!0;const _vector$6=new Vector3;class InterleavedBufferAttribute{constructor(n,t,e,i){this.name="",this.data=n,this.itemSize=t,this.offset=e,this.normalized=i===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(n){this.data.needsUpdate=n}applyMatrix4(n){for(let t=0,e=this.data.count;t<e;t++)_vector$6.x=this.getX(t),_vector$6.y=this.getY(t),_vector$6.z=this.getZ(t),_vector$6.applyMatrix4(n),this.setXYZ(t,_vector$6.x,_vector$6.y,_vector$6.z);return this}applyNormalMatrix(n){for(let t=0,e=this.count;t<e;t++)_vector$6.x=this.getX(t),_vector$6.y=this.getY(t),_vector$6.z=this.getZ(t),_vector$6.applyNormalMatrix(n),this.setXYZ(t,_vector$6.x,_vector$6.y,_vector$6.z);return this}transformDirection(n){for(let t=0,e=this.count;t<e;t++)_vector$6.x=this.getX(t),_vector$6.y=this.getY(t),_vector$6.z=this.getZ(t),_vector$6.transformDirection(n),this.setXYZ(t,_vector$6.x,_vector$6.y,_vector$6.z);return this}setX(n,t){return this.data.array[n*this.data.stride+this.offset]=t,this}setY(n,t){return this.data.array[n*this.data.stride+this.offset+1]=t,this}setZ(n,t){return this.data.array[n*this.data.stride+this.offset+2]=t,this}setW(n,t){return this.data.array[n*this.data.stride+this.offset+3]=t,this}getX(n){return this.data.array[n*this.data.stride+this.offset]}getY(n){return this.data.array[n*this.data.stride+this.offset+1]}getZ(n){return this.data.array[n*this.data.stride+this.offset+2]}getW(n){return this.data.array[n*this.data.stride+this.offset+3]}setXY(n,t,e){return n=n*this.data.stride+this.offset,this.data.array[n+0]=t,this.data.array[n+1]=e,this}setXYZ(n,t,e,i){return n=n*this.data.stride+this.offset,this.data.array[n+0]=t,this.data.array[n+1]=e,this.data.array[n+2]=i,this}setXYZW(n,t,e,i,s){return n=n*this.data.stride+this.offset,this.data.array[n+0]=t,this.data.array[n+1]=e,this.data.array[n+2]=i,this.data.array[n+3]=s,this}clone(n){if(n===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return new BufferAttribute(new this.array.constructor(t),this.itemSize,this.normalized)}else return n.interleavedBuffers===void 0&&(n.interleavedBuffers={}),n.interleavedBuffers[this.data.uuid]===void 0&&(n.interleavedBuffers[this.data.uuid]=this.data.clone(n)),new InterleavedBufferAttribute(n.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(n){if(n===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return n.interleavedBuffers===void 0&&(n.interleavedBuffers={}),n.interleavedBuffers[this.data.uuid]===void 0&&(n.interleavedBuffers[this.data.uuid]=this.data.toJSON(n)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}InterleavedBufferAttribute.prototype.isInterleavedBufferAttribute=!0;class SpriteMaterial extends Material$1{constructor(n){super(),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.alphaMap=n.alphaMap,this.rotation=n.rotation,this.sizeAttenuation=n.sizeAttenuation,this}}SpriteMaterial.prototype.isSpriteMaterial=!0;let _geometry;const _intersectPoint=new Vector3,_worldScale=new Vector3,_mvPosition=new Vector3,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA=new Vector3,_vB=new Vector3,_vC=new Vector3,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2;class Sprite extends Object3D{constructor(n){if(super(),this.type="Sprite",_geometry===void 0){_geometry=new BufferGeometry;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new InterleavedBuffer(t,5);_geometry.setIndex([0,1,2,0,2,3]),_geometry.setAttribute("position",new InterleavedBufferAttribute(e,3,0,!1)),_geometry.setAttribute("uv",new InterleavedBufferAttribute(e,2,3,!1))}this.geometry=_geometry,this.material=n!==void 0?n:new SpriteMaterial,this.center=new Vector2(.5,.5)}raycast(n,t){n.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(n.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(n.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),n.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&_worldScale.multiplyScalar(-_mvPosition.z);const e=this.material.rotation;let i,s;e!==0&&(s=Math.cos(e),i=Math.sin(e));const r=this.center;transformVertex(_vA.set(-.5,-.5,0),_mvPosition,r,_worldScale,i,s),transformVertex(_vB.set(.5,-.5,0),_mvPosition,r,_worldScale,i,s),transformVertex(_vC.set(.5,.5,0),_mvPosition,r,_worldScale,i,s),_uvA.set(0,0),_uvB.set(1,0),_uvC.set(1,1);let o=n.ray.intersectTriangle(_vA,_vB,_vC,!1,_intersectPoint);if(o===null&&(transformVertex(_vB.set(-.5,.5,0),_mvPosition,r,_worldScale,i,s),_uvB.set(0,1),o=n.ray.intersectTriangle(_vA,_vC,_vB,!1,_intersectPoint),o===null))return;const h=n.ray.origin.distanceTo(_intersectPoint);h<n.near||h>n.far||t.push({distance:h,point:_intersectPoint.clone(),uv:Triangle.getUV(_intersectPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2),face:null,object:this})}copy(n){return super.copy(n),n.center!==void 0&&this.center.copy(n.center),this.material=n.material,this}}Sprite.prototype.isSprite=!0;function transformVertex(l,n,t,e,i,s){_alignedPosition.subVectors(l,t).addScalar(.5).multiply(e),i!==void 0?(_rotatedPosition.x=s*_alignedPosition.x-i*_alignedPosition.y,_rotatedPosition.y=i*_alignedPosition.x+s*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),l.copy(n),l.x+=_rotatedPosition.x,l.y+=_rotatedPosition.y,l.applyMatrix4(_viewWorldMatrix)}const _basePosition=new Vector3,_skinIndex=new Vector4,_skinWeight=new Vector4,_vector$5=new Vector3,_matrix=new Matrix4;class SkinnedMesh extends Mesh{constructor(n,t){super(n,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4}copy(n){return super.copy(n),this.bindMode=n.bindMode,this.bindMatrix.copy(n.bindMatrix),this.bindMatrixInverse.copy(n.bindMatrixInverse),this.skeleton=n.skeleton,this}bind(n,t){this.skeleton=n,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const n=new Vector4,t=this.geometry.attributes.skinWeight;for(let e=0,i=t.count;e<i;e++){n.x=t.getX(e),n.y=t.getY(e),n.z=t.getZ(e),n.w=t.getW(e);const s=1/n.manhattanLength();s!==1/0?n.multiplyScalar(s):n.set(1,0,0,0),t.setXYZW(e,n.x,n.y,n.z,n.w)}}updateMatrixWorld(n){super.updateMatrixWorld(n),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(n,t){const e=this.skeleton,i=this.geometry;_skinIndex.fromBufferAttribute(i.attributes.skinIndex,n),_skinWeight.fromBufferAttribute(i.attributes.skinWeight,n),_basePosition.fromBufferAttribute(i.attributes.position,n).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const r=_skinWeight.getComponent(s);if(r!==0){const o=_skinIndex.getComponent(s);_matrix.multiplyMatrices(e.bones[o].matrixWorld,e.boneInverses[o]),t.addScaledVector(_vector$5.copy(_basePosition).applyMatrix4(_matrix),r)}}return t.applyMatrix4(this.bindMatrixInverse)}}SkinnedMesh.prototype.isSkinnedMesh=!0;class Bone extends Object3D{constructor(){super(),this.type="Bone"}}Bone.prototype.isBone=!0;class DataTexture extends Texture{constructor(n,t,e,i,s,r,o,h,u,p,d,f){super(null,r,o,h,u,p,i,s,d,f),this.image={data:n||null,width:t||1,height:e||1},this.magFilter=u!==void 0?u:NearestFilter,this.minFilter=p!==void 0?p:NearestFilter,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}DataTexture.prototype.isDataTexture=!0;const _offsetMatrix=new Matrix4,_identityMatrix=new Matrix4;class Skeleton{constructor(n=[],t=[]){this.uuid=generateUUID(),this.bones=n.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const n=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(n.length*16),t.length===0)this.calculateInverses();else if(n.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,i=this.bones.length;e<i;e++)this.boneInverses.push(new Matrix4)}}calculateInverses(){this.boneInverses.length=0;for(let n=0,t=this.bones.length;n<t;n++){const e=new Matrix4;this.bones[n]&&e.copy(this.bones[n].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let n=0,t=this.bones.length;n<t;n++){const e=this.bones[n];e&&e.matrixWorld.copy(this.boneInverses[n]).invert()}for(let n=0,t=this.bones.length;n<t;n++){const e=this.bones[n];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const n=this.bones,t=this.boneInverses,e=this.boneMatrices,i=this.boneTexture;for(let s=0,r=n.length;s<r;s++){const o=n[s]?n[s].matrixWorld:_identityMatrix;_offsetMatrix.multiplyMatrices(o,t[s]),_offsetMatrix.toArray(e,s*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}computeBoneTexture(){let n=Math.sqrt(this.bones.length*4);n=ceilPowerOfTwo(n),n=Math.max(n,4);const t=new Float32Array(n*n*4);t.set(this.boneMatrices);const e=new DataTexture(t,n,n,RGBAFormat,FloatType);return this.boneMatrices=t,this.boneTexture=e,this.boneTextureSize=n,this}getBoneByName(n){for(let t=0,e=this.bones.length;t<e;t++){const i=this.bones[t];if(i.name===n)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(n,t){this.uuid=n.uuid;for(let e=0,i=n.bones.length;e<i;e++){const s=n.bones[e];let r=t[s];r===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),r=new Bone),this.bones.push(r),this.boneInverses.push(new Matrix4().fromArray(n.boneInverses[e]))}return this.init(),this}toJSON(){const n={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};n.uuid=this.uuid;const t=this.bones,e=this.boneInverses;for(let i=0,s=t.length;i<s;i++){const r=t[i];n.bones.push(r.uuid);const o=e[i];n.boneInverses.push(o.toArray())}return n}}const _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_mesh=new Mesh;class InstancedMesh extends Mesh{constructor(n,t,e){super(n,t),this.instanceMatrix=new BufferAttribute(new Float32Array(e*16),16),this.instanceColor=null,this.count=e,this.frustumCulled=!1}copy(n){return super.copy(n),this.instanceMatrix.copy(n.instanceMatrix),n.instanceColor!==null&&(this.instanceColor=n.instanceColor.clone()),this.count=n.count,this}getColorAt(n,t){t.fromArray(this.instanceColor.array,n*3)}getMatrixAt(n,t){t.fromArray(this.instanceMatrix.array,n*16)}raycast(n,t){const e=this.matrixWorld,i=this.count;if(_mesh.geometry=this.geometry,_mesh.material=this.material,_mesh.material!==void 0)for(let s=0;s<i;s++){this.getMatrixAt(s,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(e,_instanceLocalMatrix),_mesh.matrixWorld=_instanceWorldMatrix,_mesh.raycast(n,_instanceIntersects);for(let r=0,o=_instanceIntersects.length;r<o;r++){const h=_instanceIntersects[r];h.instanceId=s,h.object=this,t.push(h)}_instanceIntersects.length=0}}setColorAt(n,t){this.instanceColor===null&&(this.instanceColor=new BufferAttribute(new Float32Array(this.count*3),3)),t.toArray(this.instanceColor.array,n*3)}setMatrixAt(n,t){t.toArray(this.instanceMatrix.array,n*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}InstancedMesh.prototype.isInstancedMesh=!0;class LineBasicMaterial extends Material$1{constructor(n){super(),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.linewidth=n.linewidth,this.linecap=n.linecap,this.linejoin=n.linejoin,this.morphTargets=n.morphTargets,this}}LineBasicMaterial.prototype.isLineBasicMaterial=!0;const _start$1=new Vector3,_end$1=new Vector3,_inverseMatrix$1=new Matrix4,_ray$1=new Ray$1,_sphere$1=new Sphere$1;class Line extends Object3D{constructor(n=new BufferGeometry,t=new LineBasicMaterial){super(),this.type="Line",this.geometry=n,this.material=t,this.updateMorphTargets()}copy(n){return super.copy(n),this.material=n.material,this.geometry=n.geometry,this}computeLineDistances(){const n=this.geometry;if(n.isBufferGeometry)if(n.index===null){const t=n.attributes.position,e=[0];for(let i=1,s=t.count;i<s;i++)_start$1.fromBufferAttribute(t,i-1),_end$1.fromBufferAttribute(t,i),e[i]=e[i-1],e[i]+=_start$1.distanceTo(_end$1);n.setAttribute("lineDistance",new Float32BufferAttribute(e,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else n.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(n,t){const e=this.geometry,i=this.matrixWorld,s=n.params.Line.threshold,r=e.drawRange;if(e.boundingSphere===null&&e.computeBoundingSphere(),_sphere$1.copy(e.boundingSphere),_sphere$1.applyMatrix4(i),_sphere$1.radius+=s,n.ray.intersectsSphere(_sphere$1)===!1)return;_inverseMatrix$1.copy(i).invert(),_ray$1.copy(n.ray).applyMatrix4(_inverseMatrix$1);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),h=o*o,u=new Vector3,p=new Vector3,d=new Vector3,f=new Vector3,g=this.isLineSegments?2:1;if(e.isBufferGeometry){const _=e.index,y=e.attributes.position;if(_!==null){const E=Math.max(0,r.start),m=Math.min(_.count,r.start+r.count);for(let x=E,C=m-1;x<C;x+=g){const O=_.getX(x),S=_.getX(x+1);if(u.fromBufferAttribute(y,O),p.fromBufferAttribute(y,S),_ray$1.distanceSqToSegment(u,p,f,d)>h)continue;f.applyMatrix4(this.matrixWorld);const F=n.ray.origin.distanceTo(f);F<n.near||F>n.far||t.push({distance:F,point:d.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}else{const E=Math.max(0,r.start),m=Math.min(y.count,r.start+r.count);for(let x=E,C=m-1;x<C;x+=g){if(u.fromBufferAttribute(y,x),p.fromBufferAttribute(y,x+1),_ray$1.distanceSqToSegment(u,p,f,d)>h)continue;f.applyMatrix4(this.matrixWorld);const S=n.ray.origin.distanceTo(f);S<n.near||S>n.far||t.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}else e.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const n=this.geometry;if(n.isBufferGeometry){const t=n.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,r=i.length;s<r;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}else{const t=n.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Line.prototype.isLine=!0;const _start=new Vector3,_end=new Vector3;class LineSegments extends Line{constructor(n,t){super(n,t),this.type="LineSegments"}computeLineDistances(){const n=this.geometry;if(n.isBufferGeometry)if(n.index===null){const t=n.attributes.position,e=[];for(let i=0,s=t.count;i<s;i+=2)_start.fromBufferAttribute(t,i),_end.fromBufferAttribute(t,i+1),e[i]=i===0?0:e[i-1],e[i+1]=e[i]+_start.distanceTo(_end);n.setAttribute("lineDistance",new Float32BufferAttribute(e,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else n.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}LineSegments.prototype.isLineSegments=!0;class LineLoop extends Line{constructor(n,t){super(n,t),this.type="LineLoop"}}LineLoop.prototype.isLineLoop=!0;class PointsMaterial extends Material$1{constructor(n){super(),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.alphaMap=n.alphaMap,this.size=n.size,this.sizeAttenuation=n.sizeAttenuation,this.morphTargets=n.morphTargets,this}}PointsMaterial.prototype.isPointsMaterial=!0;const _inverseMatrix=new Matrix4,_ray=new Ray$1,_sphere=new Sphere$1,_position$2=new Vector3;class Points extends Object3D{constructor(n=new BufferGeometry,t=new PointsMaterial){super(),this.type="Points",this.geometry=n,this.material=t,this.updateMorphTargets()}copy(n){return super.copy(n),this.material=n.material,this.geometry=n.geometry,this}raycast(n,t){const e=this.geometry,i=this.matrixWorld,s=n.params.Points.threshold,r=e.drawRange;if(e.boundingSphere===null&&e.computeBoundingSphere(),_sphere.copy(e.boundingSphere),_sphere.applyMatrix4(i),_sphere.radius+=s,n.ray.intersectsSphere(_sphere)===!1)return;_inverseMatrix.copy(i).invert(),_ray.copy(n.ray).applyMatrix4(_inverseMatrix);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),h=o*o;if(e.isBufferGeometry){const u=e.index,d=e.attributes.position;if(u!==null){const f=Math.max(0,r.start),g=Math.min(u.count,r.start+r.count);for(let _=f,v=g;_<v;_++){const y=u.getX(_);_position$2.fromBufferAttribute(d,y),testPoint(_position$2,y,h,i,n,t,this)}}else{const f=Math.max(0,r.start),g=Math.min(d.count,r.start+r.count);for(let _=f,v=g;_<v;_++)_position$2.fromBufferAttribute(d,_),testPoint(_position$2,_,h,i,n,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const n=this.geometry;if(n.isBufferGeometry){const t=n.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,r=i.length;s<r;s++){const o=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}else{const t=n.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Points.prototype.isPoints=!0;function testPoint(l,n,t,e,i,s,r){const o=_ray.distanceSqToPoint(l);if(o<t){const h=new Vector3;_ray.closestPointToPoint(l,h),h.applyMatrix4(e);const u=i.ray.origin.distanceTo(h);if(u<i.near||u>i.far)return;s.push({distance:u,distanceToRay:Math.sqrt(o),point:h,index:n,face:null,object:r})}}class VideoTexture extends Texture{constructor(n,t,e,i,s,r,o,h,u){super(n,t,e,i,s,r,o,h,u),this.format=o!==void 0?o:RGBFormat,this.minFilter=r!==void 0?r:LinearFilter,this.magFilter=s!==void 0?s:LinearFilter,this.generateMipmaps=!1;const p=this;function d(){p.needsUpdate=!0,n.requestVideoFrameCallback(d)}"requestVideoFrameCallback"in n&&n.requestVideoFrameCallback(d)}clone(){return new this.constructor(this.image).copy(this)}update(){const n=this.image;"requestVideoFrameCallback"in n===!1&&n.readyState>=n.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}VideoTexture.prototype.isVideoTexture=!0;class CompressedTexture extends Texture{constructor(n,t,e,i,s,r,o,h,u,p,d,f){super(null,r,o,h,u,p,i,s,d,f),this.image={width:t,height:e},this.mipmaps=n,this.flipY=!1,this.generateMipmaps=!1}}CompressedTexture.prototype.isCompressedTexture=!0;class CanvasTexture extends Texture{constructor(n,t,e,i,s,r,o,h,u){super(n,t,e,i,s,r,o,h,u),this.needsUpdate=!0}}CanvasTexture.prototype.isCanvasTexture=!0;class DepthTexture extends Texture{constructor(n,t,e,i,s,r,o,h,u,p){if(p=p!==void 0?p:DepthFormat,p!==DepthFormat&&p!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");e===void 0&&p===DepthFormat&&(e=UnsignedShortType),e===void 0&&p===DepthStencilFormat&&(e=UnsignedInt248Type),super(null,i,s,r,o,h,p,e,u),this.image={width:n,height:t},this.magFilter=o!==void 0?o:NearestFilter,this.minFilter=h!==void 0?h:NearestFilter,this.flipY=!1,this.generateMipmaps=!1}}DepthTexture.prototype.isDepthTexture=!0;class CylinderGeometry extends BufferGeometry{constructor(n=1,t=1,e=1,i=8,s=1,r=!1,o=0,h=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:n,radiusBottom:t,height:e,radialSegments:i,heightSegments:s,openEnded:r,thetaStart:o,thetaLength:h};const u=this;i=Math.floor(i),s=Math.floor(s);const p=[],d=[],f=[],g=[];let _=0;const v=[],y=e/2;let E=0;m(),r===!1&&(n>0&&x(!0),t>0&&x(!1)),this.setIndex(p),this.setAttribute("position",new Float32BufferAttribute(d,3)),this.setAttribute("normal",new Float32BufferAttribute(f,3)),this.setAttribute("uv",new Float32BufferAttribute(g,2));function m(){const C=new Vector3,O=new Vector3;let S=0;const P=(t-n)/e;for(let F=0;F<=s;F++){const V=[],N=F/s,B=N*(t-n)+n;for(let W=0;W<=i;W++){const A=W/i,G=A*h+o,D=Math.sin(G),M=Math.cos(G);O.x=B*D,O.y=-N*e+y,O.z=B*M,d.push(O.x,O.y,O.z),C.set(D,P,M).normalize(),f.push(C.x,C.y,C.z),g.push(A,1-N),V.push(_++)}v.push(V)}for(let F=0;F<i;F++)for(let V=0;V<s;V++){const N=v[V][F],B=v[V+1][F],W=v[V+1][F+1],A=v[V][F+1];p.push(N,B,A),p.push(B,W,A),S+=6}u.addGroup(E,S,0),E+=S}function x(C){const O=_,S=new Vector2,P=new Vector3;let F=0;const V=C===!0?n:t,N=C===!0?1:-1;for(let W=1;W<=i;W++)d.push(0,y*N,0),f.push(0,N,0),g.push(.5,.5),_++;const B=_;for(let W=0;W<=i;W++){const G=W/i*h+o,D=Math.cos(G),M=Math.sin(G);P.x=V*M,P.y=y*N,P.z=V*D,d.push(P.x,P.y,P.z),f.push(0,N,0),S.x=D*.5+.5,S.y=M*.5*N+.5,g.push(S.x,S.y),_++}for(let W=0;W<i;W++){const A=O+W,G=B+W;C===!0?p.push(G,G+1,A):p.push(G+1,G,A),F+=3}u.addGroup(E,F,C===!0?1:2),E+=F}}}class PolyhedronGeometry extends BufferGeometry{constructor(n,t,e=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:n,indices:t,radius:e,detail:i};const s=[],r=[];o(i),u(e),p(),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("normal",new Float32BufferAttribute(s.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(r,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function o(m){const x=new Vector3,C=new Vector3,O=new Vector3;for(let S=0;S<t.length;S+=3)g(t[S+0],x),g(t[S+1],C),g(t[S+2],O),h(x,C,O,m)}function h(m,x,C,O){const S=O+1,P=[];for(let F=0;F<=S;F++){P[F]=[];const V=m.clone().lerp(C,F/S),N=x.clone().lerp(C,F/S),B=S-F;for(let W=0;W<=B;W++)W===0&&F===S?P[F][W]=V:P[F][W]=V.clone().lerp(N,W/B)}for(let F=0;F<S;F++)for(let V=0;V<2*(S-F)-1;V++){const N=Math.floor(V/2);V%2===0?(f(P[F][N+1]),f(P[F+1][N]),f(P[F][N])):(f(P[F][N+1]),f(P[F+1][N+1]),f(P[F+1][N]))}}function u(m){const x=new Vector3;for(let C=0;C<s.length;C+=3)x.x=s[C+0],x.y=s[C+1],x.z=s[C+2],x.normalize().multiplyScalar(m),s[C+0]=x.x,s[C+1]=x.y,s[C+2]=x.z}function p(){const m=new Vector3;for(let x=0;x<s.length;x+=3){m.x=s[x+0],m.y=s[x+1],m.z=s[x+2];const C=y(m)/2/Math.PI+.5,O=E(m)/Math.PI+.5;r.push(C,1-O)}_(),d()}function d(){for(let m=0;m<r.length;m+=6){const x=r[m+0],C=r[m+2],O=r[m+4],S=Math.max(x,C,O),P=Math.min(x,C,O);S>.9&&P<.1&&(x<.2&&(r[m+0]+=1),C<.2&&(r[m+2]+=1),O<.2&&(r[m+4]+=1))}}function f(m){s.push(m.x,m.y,m.z)}function g(m,x){const C=m*3;x.x=n[C+0],x.y=n[C+1],x.z=n[C+2]}function _(){const m=new Vector3,x=new Vector3,C=new Vector3,O=new Vector3,S=new Vector2,P=new Vector2,F=new Vector2;for(let V=0,N=0;V<s.length;V+=9,N+=6){m.set(s[V+0],s[V+1],s[V+2]),x.set(s[V+3],s[V+4],s[V+5]),C.set(s[V+6],s[V+7],s[V+8]),S.set(r[N+0],r[N+1]),P.set(r[N+2],r[N+3]),F.set(r[N+4],r[N+5]),O.copy(m).add(x).add(C).divideScalar(3);const B=y(O);v(S,N+0,m,B),v(P,N+2,x,B),v(F,N+4,C,B)}}function v(m,x,C,O){O<0&&m.x===1&&(r[x]=m.x-1),C.x===0&&C.z===0&&(r[x]=O/2/Math.PI+.5)}function y(m){return Math.atan2(m.z,-m.x)}function E(m){return Math.atan2(-m.y,Math.sqrt(m.x*m.x+m.z*m.z))}}}const Earcut={triangulate:function(l,n,t){t=t||2;const e=n&&n.length,i=e?n[0]*t:l.length;let s=linkedList(l,0,i,t,!0);const r=[];if(!s||s.next===s.prev)return r;let o,h,u,p,d,f,g;if(e&&(s=eliminateHoles(l,n,s,t)),l.length>80*t){o=u=l[0],h=p=l[1];for(let _=t;_<i;_+=t)d=l[_],f=l[_+1],d<o&&(o=d),f<h&&(h=f),d>u&&(u=d),f>p&&(p=f);g=Math.max(u-o,p-h),g=g!==0?1/g:0}return earcutLinked(s,r,t,o,h,g),r}};function linkedList(l,n,t,e,i){let s,r;if(i===signedArea(l,n,t,e)>0)for(s=n;s<t;s+=e)r=insertNode(s,l[s],l[s+1],r);else for(s=t-e;s>=n;s-=e)r=insertNode(s,l[s],l[s+1],r);return r&&equals(r,r.next)&&(removeNode(r),r=r.next),r}function filterPoints(l,n){if(!l)return l;n||(n=l);let t=l,e;do if(e=!1,!t.steiner&&(equals(t,t.next)||area(t.prev,t,t.next)===0)){if(removeNode(t),t=n=t.prev,t===t.next)break;e=!0}else t=t.next;while(e||t!==n);return n}function earcutLinked(l,n,t,e,i,s,r){if(!l)return;!r&&s&&indexCurve(l,e,i,s);let o=l,h,u;for(;l.prev!==l.next;){if(h=l.prev,u=l.next,s?isEarHashed(l,e,i,s):isEar(l)){n.push(h.i/t),n.push(l.i/t),n.push(u.i/t),removeNode(l),l=u.next,o=u.next;continue}if(l=u,l===o){r?r===1?(l=cureLocalIntersections(filterPoints(l),n,t),earcutLinked(l,n,t,e,i,s,2)):r===2&&splitEarcut(l,n,t,e,i,s):earcutLinked(filterPoints(l),n,t,e,i,s,1);break}}}function isEar(l){const n=l.prev,t=l,e=l.next;if(area(n,t,e)>=0)return!1;let i=l.next.next;for(;i!==l.prev;){if(pointInTriangle(n.x,n.y,t.x,t.y,e.x,e.y,i.x,i.y)&&area(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function isEarHashed(l,n,t,e){const i=l.prev,s=l,r=l.next;if(area(i,s,r)>=0)return!1;const o=i.x<s.x?i.x<r.x?i.x:r.x:s.x<r.x?s.x:r.x,h=i.y<s.y?i.y<r.y?i.y:r.y:s.y<r.y?s.y:r.y,u=i.x>s.x?i.x>r.x?i.x:r.x:s.x>r.x?s.x:r.x,p=i.y>s.y?i.y>r.y?i.y:r.y:s.y>r.y?s.y:r.y,d=zOrder(o,h,n,t,e),f=zOrder(u,p,n,t,e);let g=l.prevZ,_=l.nextZ;for(;g&&g.z>=d&&_&&_.z<=f;){if(g!==l.prev&&g!==l.next&&pointInTriangle(i.x,i.y,s.x,s.y,r.x,r.y,g.x,g.y)&&area(g.prev,g,g.next)>=0||(g=g.prevZ,_!==l.prev&&_!==l.next&&pointInTriangle(i.x,i.y,s.x,s.y,r.x,r.y,_.x,_.y)&&area(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;g&&g.z>=d;){if(g!==l.prev&&g!==l.next&&pointInTriangle(i.x,i.y,s.x,s.y,r.x,r.y,g.x,g.y)&&area(g.prev,g,g.next)>=0)return!1;g=g.prevZ}for(;_&&_.z<=f;){if(_!==l.prev&&_!==l.next&&pointInTriangle(i.x,i.y,s.x,s.y,r.x,r.y,_.x,_.y)&&area(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function cureLocalIntersections(l,n,t){let e=l;do{const i=e.prev,s=e.next.next;!equals(i,s)&&intersects(i,e,e.next,s)&&locallyInside(i,s)&&locallyInside(s,i)&&(n.push(i.i/t),n.push(e.i/t),n.push(s.i/t),removeNode(e),removeNode(e.next),e=l=s),e=e.next}while(e!==l);return filterPoints(e)}function splitEarcut(l,n,t,e,i,s){let r=l;do{let o=r.next.next;for(;o!==r.prev;){if(r.i!==o.i&&isValidDiagonal(r,o)){let h=splitPolygon(r,o);r=filterPoints(r,r.next),h=filterPoints(h,h.next),earcutLinked(r,n,t,e,i,s),earcutLinked(h,n,t,e,i,s);return}o=o.next}r=r.next}while(r!==l)}function eliminateHoles(l,n,t,e){const i=[];let s,r,o,h,u;for(s=0,r=n.length;s<r;s++)o=n[s]*e,h=s<r-1?n[s+1]*e:l.length,u=linkedList(l,o,h,e,!1),u===u.next&&(u.steiner=!0),i.push(getLeftmost(u));for(i.sort(compareX),s=0;s<i.length;s++)eliminateHole(i[s],t),t=filterPoints(t,t.next);return t}function compareX(l,n){return l.x-n.x}function eliminateHole(l,n){if(n=findHoleBridge(l,n),n){const t=splitPolygon(n,l);filterPoints(n,n.next),filterPoints(t,t.next)}}function findHoleBridge(l,n){let t=n;const e=l.x,i=l.y;let s=-1/0,r;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const f=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(f<=e&&f>s){if(s=f,f===e){if(i===t.y)return t;if(i===t.next.y)return t.next}r=t.x<t.next.x?t:t.next}}t=t.next}while(t!==n);if(!r)return null;if(e===s)return r;const o=r,h=r.x,u=r.y;let p=1/0,d;t=r;do e>=t.x&&t.x>=h&&e!==t.x&&pointInTriangle(i<u?e:s,i,h,u,i<u?s:e,i,t.x,t.y)&&(d=Math.abs(i-t.y)/(e-t.x),locallyInside(t,l)&&(d<p||d===p&&(t.x>r.x||t.x===r.x&&sectorContainsSector(r,t)))&&(r=t,p=d)),t=t.next;while(t!==o);return r}function sectorContainsSector(l,n){return area(l.prev,l,n.prev)<0&&area(n.next,l,l.next)<0}function indexCurve(l,n,t,e){let i=l;do i.z===null&&(i.z=zOrder(i.x,i.y,n,t,e)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==l);i.prevZ.nextZ=null,i.prevZ=null,sortLinked(i)}function sortLinked(l){let n,t,e,i,s,r,o,h,u=1;do{for(t=l,l=null,s=null,r=0;t;){for(r++,e=t,o=0,n=0;n<u&&(o++,e=e.nextZ,!!e);n++);for(h=u;o>0||h>0&&e;)o!==0&&(h===0||!e||t.z<=e.z)?(i=t,t=t.nextZ,o--):(i=e,e=e.nextZ,h--),s?s.nextZ=i:l=i,i.prevZ=s,s=i;t=e}s.nextZ=null,u*=2}while(r>1);return l}function zOrder(l,n,t,e,i){return l=32767*(l-t)*i,n=32767*(n-e)*i,l=(l|l<<8)&16711935,l=(l|l<<4)&252645135,l=(l|l<<2)&858993459,l=(l|l<<1)&1431655765,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,l|n<<1}function getLeftmost(l){let n=l,t=l;do(n.x<t.x||n.x===t.x&&n.y<t.y)&&(t=n),n=n.next;while(n!==l);return t}function pointInTriangle(l,n,t,e,i,s,r,o){return(i-r)*(n-o)-(l-r)*(s-o)>=0&&(l-r)*(e-o)-(t-r)*(n-o)>=0&&(t-r)*(s-o)-(i-r)*(e-o)>=0}function isValidDiagonal(l,n){return l.next.i!==n.i&&l.prev.i!==n.i&&!intersectsPolygon(l,n)&&(locallyInside(l,n)&&locallyInside(n,l)&&middleInside(l,n)&&(area(l.prev,l,n.prev)||area(l,n.prev,n))||equals(l,n)&&area(l.prev,l,l.next)>0&&area(n.prev,n,n.next)>0)}function area(l,n,t){return(n.y-l.y)*(t.x-n.x)-(n.x-l.x)*(t.y-n.y)}function equals(l,n){return l.x===n.x&&l.y===n.y}function intersects(l,n,t,e){const i=sign$1(area(l,n,t)),s=sign$1(area(l,n,e)),r=sign$1(area(t,e,l)),o=sign$1(area(t,e,n));return!!(i!==s&&r!==o||i===0&&onSegment(l,t,n)||s===0&&onSegment(l,e,n)||r===0&&onSegment(t,l,e)||o===0&&onSegment(t,n,e))}function onSegment(l,n,t){return n.x<=Math.max(l.x,t.x)&&n.x>=Math.min(l.x,t.x)&&n.y<=Math.max(l.y,t.y)&&n.y>=Math.min(l.y,t.y)}function sign$1(l){return l>0?1:l<0?-1:0}function intersectsPolygon(l,n){let t=l;do{if(t.i!==l.i&&t.next.i!==l.i&&t.i!==n.i&&t.next.i!==n.i&&intersects(t,t.next,l,n))return!0;t=t.next}while(t!==l);return!1}function locallyInside(l,n){return area(l.prev,l,l.next)<0?area(l,n,l.next)>=0&&area(l,l.prev,n)>=0:area(l,n,l.prev)<0||area(l,l.next,n)<0}function middleInside(l,n){let t=l,e=!1;const i=(l.x+n.x)/2,s=(l.y+n.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(e=!e),t=t.next;while(t!==l);return e}function splitPolygon(l,n){const t=new Node$1(l.i,l.x,l.y),e=new Node$1(n.i,n.x,n.y),i=l.next,s=n.prev;return l.next=n,n.prev=l,t.next=i,i.prev=t,e.next=t,t.prev=e,s.next=e,e.prev=s,e}function insertNode(l,n,t,e){const i=new Node$1(l,n,t);return e?(i.next=e.next,i.prev=e,e.next.prev=i,e.next=i):(i.prev=i,i.next=i),i}function removeNode(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function Node$1(l,n,t){this.i=l,this.x=n,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(l,n,t,e){let i=0;for(let s=n,r=t-e;s<t;s+=e)i+=(l[r]-l[s])*(l[s+1]+l[r+1]),r=s;return i}class ShapeUtils{static area(n){const t=n.length;let e=0;for(let i=t-1,s=0;s<t;i=s++)e+=n[i].x*n[s].y-n[s].x*n[i].y;return e*.5}static isClockWise(n){return ShapeUtils.area(n)<0}static triangulateShape(n,t){const e=[],i=[],s=[];removeDupEndPts(n),addContour(e,n);let r=n.length;t.forEach(removeDupEndPts);for(let h=0;h<t.length;h++)i.push(r),r+=t[h].length,addContour(e,t[h]);const o=Earcut.triangulate(e,i);for(let h=0;h<o.length;h+=3)s.push(o.slice(h,h+3));return s}}function removeDupEndPts(l){const n=l.length;n>2&&l[n-1].equals(l[0])&&l.pop()}function addContour(l,n){for(let t=0;t<n.length;t++)l.push(n[t].x),l.push(n[t].y)}class ExtrudeGeometry extends BufferGeometry{constructor(n,t){super(),this.type="ExtrudeGeometry",this.parameters={shapes:n,options:t},n=Array.isArray(n)?n:[n];const e=this,i=[],s=[];for(let o=0,h=n.length;o<h;o++){const u=n[o];r(u)}this.setAttribute("position",new Float32BufferAttribute(i,3)),this.setAttribute("uv",new Float32BufferAttribute(s,2)),this.computeVertexNormals();function r(o){const h=[],u=t.curveSegments!==void 0?t.curveSegments:12,p=t.steps!==void 0?t.steps:1;let d=t.depth!==void 0?t.depth:100,f=t.bevelEnabled!==void 0?t.bevelEnabled:!0,g=t.bevelThickness!==void 0?t.bevelThickness:6,_=t.bevelSize!==void 0?t.bevelSize:g-2,v=t.bevelOffset!==void 0?t.bevelOffset:0,y=t.bevelSegments!==void 0?t.bevelSegments:3;const E=t.extrudePath,m=t.UVGenerator!==void 0?t.UVGenerator:WorldUVGenerator;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),d=t.amount);let x,C=!1,O,S,P,F;E&&(x=E.getSpacedPoints(p),C=!0,f=!1,O=E.computeFrenetFrames(p,!1),S=new Vector3,P=new Vector3,F=new Vector3),f||(y=0,g=0,_=0,v=0);const V=o.extractPoints(u);let N=V.shape;const B=V.holes;if(!ShapeUtils.isClockWise(N)){N=N.reverse();for(let gt=0,mt=B.length;gt<mt;gt++){const Rt=B[gt];ShapeUtils.isClockWise(Rt)&&(B[gt]=Rt.reverse())}}const A=ShapeUtils.triangulateShape(N,B),G=N;for(let gt=0,mt=B.length;gt<mt;gt++){const Rt=B[gt];N=N.concat(Rt)}function D(gt,mt,Rt){return mt||console.error("THREE.ExtrudeGeometry: vec does not exist"),mt.clone().multiplyScalar(Rt).add(gt)}const M=N.length,J=A.length;function et(gt,mt,Rt){let Ft,Pt,X;const z=gt.x-mt.x,vt=gt.y-mt.y,St=Rt.x-gt.x,Dt=Rt.y-gt.y,kt=z*z+vt*vt,Wt=z*Dt-vt*St;if(Math.abs(Wt)>Number.EPSILON){const Y=Math.sqrt(kt),At=Math.sqrt(St*St+Dt*Dt),Mt=mt.x-vt/Y,q=mt.y+z/Y,xt=Rt.x-Dt/At,pt=Rt.y+St/At,Bt=((xt-Mt)*Dt-(pt-q)*St)/(z*Dt-vt*St);Ft=Mt+z*Bt-gt.x,Pt=q+vt*Bt-gt.y;const Ot=Ft*Ft+Pt*Pt;if(Ot<=2)return new Vector2(Ft,Pt);X=Math.sqrt(Ot/2)}else{let Y=!1;z>Number.EPSILON?St>Number.EPSILON&&(Y=!0):z<-Number.EPSILON?St<-Number.EPSILON&&(Y=!0):Math.sign(vt)===Math.sign(Dt)&&(Y=!0),Y?(Ft=-vt,Pt=z,X=Math.sqrt(kt)):(Ft=z,Pt=vt,X=Math.sqrt(kt/2))}return new Vector2(Ft/X,Pt/X)}const Q=[];for(let gt=0,mt=G.length,Rt=mt-1,Ft=gt+1;gt<mt;gt++,Rt++,Ft++)Rt===mt&&(Rt=0),Ft===mt&&(Ft=0),Q[gt]=et(G[gt],G[Rt],G[Ft]);const ot=[];let tt,rt=Q.concat();for(let gt=0,mt=B.length;gt<mt;gt++){const Rt=B[gt];tt=[];for(let Ft=0,Pt=Rt.length,X=Pt-1,z=Ft+1;Ft<Pt;Ft++,X++,z++)X===Pt&&(X=0),z===Pt&&(z=0),tt[Ft]=et(Rt[Ft],Rt[X],Rt[z]);ot.push(tt),rt=rt.concat(tt)}for(let gt=0;gt<y;gt++){const mt=gt/y,Rt=g*Math.cos(mt*Math.PI/2),Ft=_*Math.sin(mt*Math.PI/2)+v;for(let Pt=0,X=G.length;Pt<X;Pt++){const z=D(G[Pt],Q[Pt],Ft);bt(z.x,z.y,-Rt)}for(let Pt=0,X=B.length;Pt<X;Pt++){const z=B[Pt];tt=ot[Pt];for(let vt=0,St=z.length;vt<St;vt++){const Dt=D(z[vt],tt[vt],Ft);bt(Dt.x,Dt.y,-Rt)}}}const ft=_+v;for(let gt=0;gt<M;gt++){const mt=f?D(N[gt],rt[gt],ft):N[gt];C?(P.copy(O.normals[0]).multiplyScalar(mt.x),S.copy(O.binormals[0]).multiplyScalar(mt.y),F.copy(x[0]).add(P).add(S),bt(F.x,F.y,F.z)):bt(mt.x,mt.y,0)}for(let gt=1;gt<=p;gt++)for(let mt=0;mt<M;mt++){const Rt=f?D(N[mt],rt[mt],ft):N[mt];C?(P.copy(O.normals[gt]).multiplyScalar(Rt.x),S.copy(O.binormals[gt]).multiplyScalar(Rt.y),F.copy(x[gt]).add(P).add(S),bt(F.x,F.y,F.z)):bt(Rt.x,Rt.y,d/p*gt)}for(let gt=y-1;gt>=0;gt--){const mt=gt/y,Rt=g*Math.cos(mt*Math.PI/2),Ft=_*Math.sin(mt*Math.PI/2)+v;for(let Pt=0,X=G.length;Pt<X;Pt++){const z=D(G[Pt],Q[Pt],Ft);bt(z.x,z.y,d+Rt)}for(let Pt=0,X=B.length;Pt<X;Pt++){const z=B[Pt];tt=ot[Pt];for(let vt=0,St=z.length;vt<St;vt++){const Dt=D(z[vt],tt[vt],Ft);C?bt(Dt.x,Dt.y+x[p-1].y,x[p-1].x+Rt):bt(Dt.x,Dt.y,d+Rt)}}}_t(),yt();function _t(){const gt=i.length/3;if(f){let mt=0,Rt=M*mt;for(let Ft=0;Ft<J;Ft++){const Pt=A[Ft];at(Pt[2]+Rt,Pt[1]+Rt,Pt[0]+Rt)}mt=p+y*2,Rt=M*mt;for(let Ft=0;Ft<J;Ft++){const Pt=A[Ft];at(Pt[0]+Rt,Pt[1]+Rt,Pt[2]+Rt)}}else{for(let mt=0;mt<J;mt++){const Rt=A[mt];at(Rt[2],Rt[1],Rt[0])}for(let mt=0;mt<J;mt++){const Rt=A[mt];at(Rt[0]+M*p,Rt[1]+M*p,Rt[2]+M*p)}}e.addGroup(gt,i.length/3-gt,0)}function yt(){const gt=i.length/3;let mt=0;Z(G,mt),mt+=G.length;for(let Rt=0,Ft=B.length;Rt<Ft;Rt++){const Pt=B[Rt];Z(Pt,mt),mt+=Pt.length}e.addGroup(gt,i.length/3-gt,1)}function Z(gt,mt){let Rt=gt.length;for(;--Rt>=0;){const Ft=Rt;let Pt=Rt-1;Pt<0&&(Pt=gt.length-1);for(let X=0,z=p+y*2;X<z;X++){const vt=M*X,St=M*(X+1),Dt=mt+Ft+vt,kt=mt+Pt+vt,Wt=mt+Pt+St,Y=mt+Ft+St;nt(Dt,kt,Wt,Y)}}}function bt(gt,mt,Rt){h.push(gt),h.push(mt),h.push(Rt)}function at(gt,mt,Rt){ht(gt),ht(mt),ht(Rt);const Ft=i.length/3,Pt=m.generateTopUV(e,i,Ft-3,Ft-2,Ft-1);Ct(Pt[0]),Ct(Pt[1]),Ct(Pt[2])}function nt(gt,mt,Rt,Ft){ht(gt),ht(mt),ht(Ft),ht(mt),ht(Rt),ht(Ft);const Pt=i.length/3,X=m.generateSideWallUV(e,i,Pt-6,Pt-3,Pt-2,Pt-1);Ct(X[0]),Ct(X[1]),Ct(X[3]),Ct(X[1]),Ct(X[2]),Ct(X[3])}function ht(gt){i.push(h[gt*3+0]),i.push(h[gt*3+1]),i.push(h[gt*3+2])}function Ct(gt){s.push(gt.x),s.push(gt.y)}}}toJSON(){const n=super.toJSON(),t=this.parameters.shapes,e=this.parameters.options;return toJSON$1(t,e,n)}}const WorldUVGenerator={generateTopUV:function(l,n,t,e,i){const s=n[t*3],r=n[t*3+1],o=n[e*3],h=n[e*3+1],u=n[i*3],p=n[i*3+1];return[new Vector2(s,r),new Vector2(o,h),new Vector2(u,p)]},generateSideWallUV:function(l,n,t,e,i,s){const r=n[t*3],o=n[t*3+1],h=n[t*3+2],u=n[e*3],p=n[e*3+1],d=n[e*3+2],f=n[i*3],g=n[i*3+1],_=n[i*3+2],v=n[s*3],y=n[s*3+1],E=n[s*3+2];return Math.abs(o-p)<Math.abs(r-u)?[new Vector2(r,1-h),new Vector2(u,1-d),new Vector2(f,1-_),new Vector2(v,1-E)]:[new Vector2(o,1-h),new Vector2(p,1-d),new Vector2(g,1-_),new Vector2(y,1-E)]}};function toJSON$1(l,n,t){if(t.shapes=[],Array.isArray(l))for(let e=0,i=l.length;e<i;e++){const s=l[e];t.shapes.push(s.uuid)}else t.shapes.push(l.uuid);return n.extrudePath!==void 0&&(t.options.extrudePath=n.extrudePath.toJSON()),t}class OctahedronGeometry extends PolyhedronGeometry{constructor(n=1,t=0){const e=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(e,i,n,t),this.type="OctahedronGeometry",this.parameters={radius:n,detail:t}}}class ShapeGeometry extends BufferGeometry{constructor(n,t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:n,curveSegments:t};const e=[],i=[],s=[],r=[];let o=0,h=0;if(Array.isArray(n)===!1)u(n);else for(let p=0;p<n.length;p++)u(n[p]),this.addGroup(o,h,p),o+=h,h=0;this.setIndex(e),this.setAttribute("position",new Float32BufferAttribute(i,3)),this.setAttribute("normal",new Float32BufferAttribute(s,3)),this.setAttribute("uv",new Float32BufferAttribute(r,2));function u(p){const d=i.length/3,f=p.extractPoints(t);let g=f.shape;const _=f.holes;ShapeUtils.isClockWise(g)===!1&&(g=g.reverse());for(let y=0,E=_.length;y<E;y++){const m=_[y];ShapeUtils.isClockWise(m)===!0&&(_[y]=m.reverse())}const v=ShapeUtils.triangulateShape(g,_);for(let y=0,E=_.length;y<E;y++){const m=_[y];g=g.concat(m)}for(let y=0,E=g.length;y<E;y++){const m=g[y];i.push(m.x,m.y,0),s.push(0,0,1),r.push(m.x,m.y)}for(let y=0,E=v.length;y<E;y++){const m=v[y],x=m[0]+d,C=m[1]+d,O=m[2]+d;e.push(x,C,O),h+=3}}}toJSON(){const n=super.toJSON(),t=this.parameters.shapes;return toJSON(t,n)}}function toJSON(l,n){if(n.shapes=[],Array.isArray(l))for(let t=0,e=l.length;t<e;t++){const i=l[t];n.shapes.push(i.uuid)}else n.shapes.push(l.uuid);return n}class SphereGeometry extends BufferGeometry{constructor(n=1,t=8,e=6,i=0,s=Math.PI*2,r=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:n,widthSegments:t,heightSegments:e,phiStart:i,phiLength:s,thetaStart:r,thetaLength:o},t=Math.max(3,Math.floor(t)),e=Math.max(2,Math.floor(e));const h=Math.min(r+o,Math.PI);let u=0;const p=[],d=new Vector3,f=new Vector3,g=[],_=[],v=[],y=[];for(let E=0;E<=e;E++){const m=[],x=E/e;let C=0;E==0&&r==0?C=.5/t:E==e&&h==Math.PI&&(C=-.5/t);for(let O=0;O<=t;O++){const S=O/t;d.x=-n*Math.cos(i+S*s)*Math.sin(r+x*o),d.y=n*Math.cos(r+x*o),d.z=n*Math.sin(i+S*s)*Math.sin(r+x*o),_.push(d.x,d.y,d.z),f.copy(d).normalize(),v.push(f.x,f.y,f.z),y.push(S+C,1-x),m.push(u++)}p.push(m)}for(let E=0;E<e;E++)for(let m=0;m<t;m++){const x=p[E][m+1],C=p[E][m],O=p[E+1][m],S=p[E+1][m+1];(E!==0||r>0)&&g.push(x,C,S),(E!==e-1||h<Math.PI)&&g.push(C,O,S)}this.setIndex(g),this.setAttribute("position",new Float32BufferAttribute(_,3)),this.setAttribute("normal",new Float32BufferAttribute(v,3)),this.setAttribute("uv",new Float32BufferAttribute(y,2))}}class TorusGeometry extends BufferGeometry{constructor(n=1,t=.4,e=8,i=6,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:n,tube:t,radialSegments:e,tubularSegments:i,arc:s},e=Math.floor(e),i=Math.floor(i);const r=[],o=[],h=[],u=[],p=new Vector3,d=new Vector3,f=new Vector3;for(let g=0;g<=e;g++)for(let _=0;_<=i;_++){const v=_/i*s,y=g/e*Math.PI*2;d.x=(n+t*Math.cos(y))*Math.cos(v),d.y=(n+t*Math.cos(y))*Math.sin(v),d.z=t*Math.sin(y),o.push(d.x,d.y,d.z),p.x=n*Math.cos(v),p.y=n*Math.sin(v),f.subVectors(d,p).normalize(),h.push(f.x,f.y,f.z),u.push(_/i),u.push(g/e)}for(let g=1;g<=e;g++)for(let _=1;_<=i;_++){const v=(i+1)*g+_-1,y=(i+1)*(g-1)+_-1,E=(i+1)*(g-1)+_,m=(i+1)*g+_;r.push(v,y,m),r.push(y,E,m)}this.setIndex(r),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(h,3)),this.setAttribute("uv",new Float32BufferAttribute(u,2))}}class ShadowMaterial extends Material$1{constructor(n){super(),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this}}ShadowMaterial.prototype.isShadowMaterial=!0;class RawShaderMaterial extends ShaderMaterial{constructor(n){super(n),this.type="RawShaderMaterial"}}RawShaderMaterial.prototype.isRawShaderMaterial=!0;class MeshStandardMaterial extends Material$1{constructor(n){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(n)}copy(n){return super.copy(n),this.defines={STANDARD:""},this.color.copy(n.color),this.roughness=n.roughness,this.metalness=n.metalness,this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.roughnessMap=n.roughnessMap,this.metalnessMap=n.metalnessMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.envMapIntensity=n.envMapIntensity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.morphTargets=n.morphTargets,this.morphNormals=n.morphNormals,this.flatShading=n.flatShading,this.vertexTangents=n.vertexTangents,this}}MeshStandardMaterial.prototype.isMeshStandardMaterial=!0;class MeshPhysicalMaterial extends MeshStandardMaterial{constructor(n){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=clamp(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Color(1,1,1),this.setValues(n)}copy(n){return super.copy(n),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=n.clearcoat,this.clearcoatMap=n.clearcoatMap,this.clearcoatRoughness=n.clearcoatRoughness,this.clearcoatRoughnessMap=n.clearcoatRoughnessMap,this.clearcoatNormalMap=n.clearcoatNormalMap,this.clearcoatNormalScale.copy(n.clearcoatNormalScale),this.reflectivity=n.reflectivity,n.sheen?this.sheen=(this.sheen||new Color).copy(n.sheen):this.sheen=null,this.transmission=n.transmission,this.transmissionMap=n.transmissionMap,this.thickness=n.thickness,this.thicknessMap=n.thicknessMap,this.attenuationDistance=n.attenuationDistance,this.attenuationColor.copy(n.attenuationColor),this}}MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0;class MeshPhongMaterial extends Material$1{constructor(n){super(),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.specular.copy(n.specular),this.shininess=n.shininess,this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.morphTargets=n.morphTargets,this.morphNormals=n.morphNormals,this.flatShading=n.flatShading,this}}MeshPhongMaterial.prototype.isMeshPhongMaterial=!0;class MeshToonMaterial extends Material$1{constructor(n){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.gradientMap=n.gradientMap,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.alphaMap=n.alphaMap,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.morphTargets=n.morphTargets,this.morphNormals=n.morphNormals,this}}MeshToonMaterial.prototype.isMeshToonMaterial=!0;class MeshNormalMaterial extends Material$1{constructor(n){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(n)}copy(n){return super.copy(n),this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.morphTargets=n.morphTargets,this.morphNormals=n.morphNormals,this.flatShading=n.flatShading,this}}MeshNormalMaterial.prototype.isMeshNormalMaterial=!0;class MeshLambertMaterial extends Material$1{constructor(n){super(),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.morphTargets=!1,this.morphNormals=!1,this.setValues(n)}copy(n){return super.copy(n),this.color.copy(n.color),this.map=n.map,this.lightMap=n.lightMap,this.lightMapIntensity=n.lightMapIntensity,this.aoMap=n.aoMap,this.aoMapIntensity=n.aoMapIntensity,this.emissive.copy(n.emissive),this.emissiveMap=n.emissiveMap,this.emissiveIntensity=n.emissiveIntensity,this.specularMap=n.specularMap,this.alphaMap=n.alphaMap,this.envMap=n.envMap,this.combine=n.combine,this.reflectivity=n.reflectivity,this.refractionRatio=n.refractionRatio,this.wireframe=n.wireframe,this.wireframeLinewidth=n.wireframeLinewidth,this.wireframeLinecap=n.wireframeLinecap,this.wireframeLinejoin=n.wireframeLinejoin,this.morphTargets=n.morphTargets,this.morphNormals=n.morphNormals,this}}MeshLambertMaterial.prototype.isMeshLambertMaterial=!0;class MeshMatcapMaterial extends Material$1{constructor(n){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(n)}copy(n){return super.copy(n),this.defines={MATCAP:""},this.color.copy(n.color),this.matcap=n.matcap,this.map=n.map,this.bumpMap=n.bumpMap,this.bumpScale=n.bumpScale,this.normalMap=n.normalMap,this.normalMapType=n.normalMapType,this.normalScale.copy(n.normalScale),this.displacementMap=n.displacementMap,this.displacementScale=n.displacementScale,this.displacementBias=n.displacementBias,this.alphaMap=n.alphaMap,this.morphTargets=n.morphTargets,this.morphNormals=n.morphNormals,this.flatShading=n.flatShading,this}}MeshMatcapMaterial.prototype.isMeshMatcapMaterial=!0;class LineDashedMaterial extends LineBasicMaterial{constructor(n){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(n)}copy(n){return super.copy(n),this.scale=n.scale,this.dashSize=n.dashSize,this.gapSize=n.gapSize,this}}LineDashedMaterial.prototype.isLineDashedMaterial=!0;const AnimationUtils={arraySlice:function(l,n,t){return AnimationUtils.isTypedArray(l)?new l.constructor(l.subarray(n,t!==void 0?t:l.length)):l.slice(n,t)},convertArray:function(l,n,t){return!l||!t&&l.constructor===n?l:typeof n.BYTES_PER_ELEMENT=="number"?new n(l):Array.prototype.slice.call(l)},isTypedArray:function(l){return ArrayBuffer.isView(l)&&!(l instanceof DataView)},getKeyframeOrder:function(l){function n(i,s){return l[i]-l[s]}const t=l.length,e=new Array(t);for(let i=0;i!==t;++i)e[i]=i;return e.sort(n),e},sortedArray:function(l,n,t){const e=l.length,i=new l.constructor(e);for(let s=0,r=0;r!==e;++s){const o=t[s]*n;for(let h=0;h!==n;++h)i[r++]=l[o+h]}return i},flattenJSON:function(l,n,t,e){let i=1,s=l[0];for(;s!==void 0&&s[e]===void 0;)s=l[i++];if(s===void 0)return;let r=s[e];if(r!==void 0)if(Array.isArray(r))do r=s[e],r!==void 0&&(n.push(s.time),t.push.apply(t,r)),s=l[i++];while(s!==void 0);else if(r.toArray!==void 0)do r=s[e],r!==void 0&&(n.push(s.time),r.toArray(t,t.length)),s=l[i++];while(s!==void 0);else do r=s[e],r!==void 0&&(n.push(s.time),t.push(r)),s=l[i++];while(s!==void 0)},subclip:function(l,n,t,e,i=30){const s=l.clone();s.name=n;const r=[];for(let h=0;h<s.tracks.length;++h){const u=s.tracks[h],p=u.getValueSize(),d=[],f=[];for(let g=0;g<u.times.length;++g){const _=u.times[g]*i;if(!(_<t||_>=e)){d.push(u.times[g]);for(let v=0;v<p;++v)f.push(u.values[g*p+v])}}d.length!==0&&(u.times=AnimationUtils.convertArray(d,u.times.constructor),u.values=AnimationUtils.convertArray(f,u.values.constructor),r.push(u))}s.tracks=r;let o=1/0;for(let h=0;h<s.tracks.length;++h)o>s.tracks[h].times[0]&&(o=s.tracks[h].times[0]);for(let h=0;h<s.tracks.length;++h)s.tracks[h].shift(-1*o);return s.resetDuration(),s},makeClipAdditive:function(l,n=0,t=l,e=30){e<=0&&(e=30);const i=t.tracks.length,s=n/e;for(let r=0;r<i;++r){const o=t.tracks[r],h=o.ValueTypeName;if(h==="bool"||h==="string")continue;const u=l.tracks.find(function(E){return E.name===o.name&&E.ValueTypeName===h});if(u===void 0)continue;let p=0;const d=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(p=d/3);let f=0;const g=u.getValueSize();u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=g/3);const _=o.times.length-1;let v;if(s<=o.times[0]){const E=p,m=d-p;v=AnimationUtils.arraySlice(o.values,E,m)}else if(s>=o.times[_]){const E=_*d+p,m=E+d-p;v=AnimationUtils.arraySlice(o.values,E,m)}else{const E=o.createInterpolant(),m=p,x=d-p;E.evaluate(s),v=AnimationUtils.arraySlice(E.resultBuffer,m,x)}h==="quaternion"&&new Quaternion$1().fromArray(v).normalize().conjugate().toArray(v);const y=u.times.length;for(let E=0;E<y;++E){const m=E*g+f;if(h==="quaternion")Quaternion$1.multiplyQuaternionsFlat(u.values,m,v,0,u.values,m);else{const x=g-f*2;for(let C=0;C<x;++C)u.values[m+C]-=v[C]}}}return l.blendMode=AdditiveAnimationBlendMode,l}};class Interpolant{constructor(n,t,e,i){this.parameterPositions=n,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(e),this.sampleValues=t,this.valueSize=e,this.settings=null,this.DefaultSettings_={}}evaluate(n){const t=this.parameterPositions;let e=this._cachedIndex,i=t[e],s=t[e-1];t:{e:{let r;i:{n:if(!(n<i)){for(let o=e+2;;){if(i===void 0){if(n<s)break n;return e=t.length,this._cachedIndex=e,this.afterEnd_(e-1,n,s)}if(e===o)break;if(s=i,i=t[++e],n<i)break e}r=t.length;break i}if(!(n>=s)){const o=t[1];n<o&&(e=2,s=o);for(let h=e-2;;){if(s===void 0)return this._cachedIndex=0,this.beforeStart_(0,n,i);if(e===h)break;if(i=s,s=t[--e-1],n>=s)break e}r=e,e=0;break i}break t}for(;e<r;){const o=e+r>>>1;n<t[o]?r=o:e=o+1}if(i=t[e],s=t[e-1],s===void 0)return this._cachedIndex=0,this.beforeStart_(0,n,i);if(i===void 0)return e=t.length,this._cachedIndex=e,this.afterEnd_(e-1,s,n)}this._cachedIndex=e,this.intervalChanged_(e,s,i)}return this.interpolate_(e,s,n,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(n){const t=this.resultBuffer,e=this.sampleValues,i=this.valueSize,s=n*i;for(let r=0;r!==i;++r)t[r]=e[s+r];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Interpolant.prototype.beforeStart_=Interpolant.prototype.copySampleValue_;Interpolant.prototype.afterEnd_=Interpolant.prototype.copySampleValue_;class CubicInterpolant extends Interpolant{constructor(n,t,e,i){super(n,t,e,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding}}intervalChanged_(n,t,e){const i=this.parameterPositions;let s=n-2,r=n+1,o=i[s],h=i[r];if(o===void 0)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:s=n,o=2*t-e;break;case WrapAroundEnding:s=i.length-2,o=t+i[s]-i[s+1];break;default:s=n,o=e}if(h===void 0)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:r=n,h=2*e-t;break;case WrapAroundEnding:r=1,h=e+i[1]-i[0];break;default:r=n-1,h=t}const u=(e-t)*.5,p=this.valueSize;this._weightPrev=u/(t-o),this._weightNext=u/(h-e),this._offsetPrev=s*p,this._offsetNext=r*p}interpolate_(n,t,e,i){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,h=n*o,u=h-o,p=this._offsetPrev,d=this._offsetNext,f=this._weightPrev,g=this._weightNext,_=(e-t)/(i-t),v=_*_,y=v*_,E=-f*y+2*f*v-f*_,m=(1+f)*y+(-1.5-2*f)*v+(-.5+f)*_+1,x=(-1-g)*y+(1.5+g)*v+.5*_,C=g*y-g*v;for(let O=0;O!==o;++O)s[O]=E*r[p+O]+m*r[u+O]+x*r[h+O]+C*r[d+O];return s}}class LinearInterpolant extends Interpolant{constructor(n,t,e,i){super(n,t,e,i)}interpolate_(n,t,e,i){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,h=n*o,u=h-o,p=(e-t)/(i-t),d=1-p;for(let f=0;f!==o;++f)s[f]=r[u+f]*d+r[h+f]*p;return s}}class DiscreteInterpolant extends Interpolant{constructor(n,t,e,i){super(n,t,e,i)}interpolate_(n){return this.copySampleValue_(n-1)}}class KeyframeTrack{constructor(n,t,e,i){if(n===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+n);this.name=n,this.times=AnimationUtils.convertArray(t,this.TimeBufferType),this.values=AnimationUtils.convertArray(e,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(n){const t=n.constructor;let e;if(t.toJSON!==this.toJSON)e=t.toJSON(n);else{e={name:n.name,times:AnimationUtils.convertArray(n.times,Array),values:AnimationUtils.convertArray(n.values,Array)};const i=n.getInterpolation();i!==n.DefaultInterpolation&&(e.interpolation=i)}return e.type=n.ValueTypeName,e}InterpolantFactoryMethodDiscrete(n){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),n)}InterpolantFactoryMethodLinear(n){return new LinearInterpolant(this.times,this.values,this.getValueSize(),n)}InterpolantFactoryMethodSmooth(n){return new CubicInterpolant(this.times,this.values,this.getValueSize(),n)}setInterpolation(n){let t;switch(n){case InterpolateDiscrete:t=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:t=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(n!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(e);return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}}getValueSize(){return this.values.length/this.times.length}shift(n){if(n!==0){const t=this.times;for(let e=0,i=t.length;e!==i;++e)t[e]+=n}return this}scale(n){if(n!==1){const t=this.times;for(let e=0,i=t.length;e!==i;++e)t[e]*=n}return this}trim(n,t){const e=this.times,i=e.length;let s=0,r=i-1;for(;s!==i&&e[s]<n;)++s;for(;r!==-1&&e[r]>t;)--r;if(++r,s!==0||r!==i){s>=r&&(r=Math.max(r,1),s=r-1);const o=this.getValueSize();this.times=AnimationUtils.arraySlice(e,s,r),this.values=AnimationUtils.arraySlice(this.values,s*o,r*o)}return this}validate(){let n=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),n=!1);const e=this.times,i=this.values,s=e.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),n=!1);let r=null;for(let o=0;o!==s;o++){const h=e[o];if(typeof h=="number"&&isNaN(h)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,h),n=!1;break}if(r!==null&&r>h){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,h,r),n=!1;break}r=h}if(i!==void 0&&AnimationUtils.isTypedArray(i))for(let o=0,h=i.length;o!==h;++o){const u=i[o];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,u),n=!1;break}}return n}optimize(){const n=AnimationUtils.arraySlice(this.times),t=AnimationUtils.arraySlice(this.values),e=this.getValueSize(),i=this.getInterpolation()===InterpolateSmooth,s=n.length-1;let r=1;for(let o=1;o<s;++o){let h=!1;const u=n[o],p=n[o+1];if(u!==p&&(o!==1||u!==n[0]))if(i)h=!0;else{const d=o*e,f=d-e,g=d+e;for(let _=0;_!==e;++_){const v=t[d+_];if(v!==t[f+_]||v!==t[g+_]){h=!0;break}}}if(h){if(o!==r){n[r]=n[o];const d=o*e,f=r*e;for(let g=0;g!==e;++g)t[f+g]=t[d+g]}++r}}if(s>0){n[r]=n[s];for(let o=s*e,h=r*e,u=0;u!==e;++u)t[h+u]=t[o+u];++r}return r!==n.length?(this.times=AnimationUtils.arraySlice(n,0,r),this.values=AnimationUtils.arraySlice(t,0,r*e)):(this.times=n,this.values=t),this}clone(){const n=AnimationUtils.arraySlice(this.times,0),t=AnimationUtils.arraySlice(this.values,0),e=this.constructor,i=new e(this.name,n,t);return i.createInterpolant=this.createInterpolant,i}}KeyframeTrack.prototype.TimeBufferType=Float32Array;KeyframeTrack.prototype.ValueBufferType=Float32Array;KeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;class BooleanKeyframeTrack extends KeyframeTrack{}BooleanKeyframeTrack.prototype.ValueTypeName="bool";BooleanKeyframeTrack.prototype.ValueBufferType=Array;BooleanKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(n,t,e,i){super(n,t,e,i)}interpolate_(n,t,e,i){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,h=(e-t)/(i-t);let u=n*o;for(let p=u+o;u!==p;u+=4)Quaternion$1.slerpFlat(s,0,r,u-o,r,u,h);return s}}class QuaternionKeyframeTrack extends KeyframeTrack{InterpolantFactoryMethodLinear(n){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),n)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion";QuaternionKeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{}StringKeyframeTrack.prototype.ValueTypeName="string";StringKeyframeTrack.prototype.ValueBufferType=Array;StringKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(n,t=-1,e,i=NormalAnimationBlendMode){this.name=n,this.tracks=e,this.duration=t,this.blendMode=i,this.uuid=generateUUID(),this.duration<0&&this.resetDuration()}static parse(n){const t=[],e=n.tracks,i=1/(n.fps||1);for(let r=0,o=e.length;r!==o;++r)t.push(parseKeyframeTrack(e[r]).scale(i));const s=new this(n.name,n.duration,t,n.blendMode);return s.uuid=n.uuid,s}static toJSON(n){const t=[],e=n.tracks,i={name:n.name,duration:n.duration,tracks:t,uuid:n.uuid,blendMode:n.blendMode};for(let s=0,r=e.length;s!==r;++s)t.push(KeyframeTrack.toJSON(e[s]));return i}static CreateFromMorphTargetSequence(n,t,e,i){const s=t.length,r=[];for(let o=0;o<s;o++){let h=[],u=[];h.push((o+s-1)%s,o,(o+1)%s),u.push(0,1,0);const p=AnimationUtils.getKeyframeOrder(h);h=AnimationUtils.sortedArray(h,1,p),u=AnimationUtils.sortedArray(u,1,p),!i&&h[0]===0&&(h.push(s),u.push(u[0])),r.push(new NumberKeyframeTrack(".morphTargetInfluences["+t[o].name+"]",h,u).scale(1/e))}return new this(n,-1,r)}static findByName(n,t){let e=n;if(!Array.isArray(n)){const i=n;e=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<e.length;i++)if(e[i].name===t)return e[i];return null}static CreateClipsFromMorphTargetSequences(n,t,e){const i={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,h=n.length;o<h;o++){const u=n[o],p=u.name.match(s);if(p&&p.length>1){const d=p[1];let f=i[d];f||(i[d]=f=[]),f.push(u)}}const r=[];for(const o in i)r.push(this.CreateFromMorphTargetSequence(o,i[o],t,e));return r}static parseAnimation(n,t){if(!n)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const e=function(d,f,g,_,v){if(g.length!==0){const y=[],E=[];AnimationUtils.flattenJSON(g,y,E,_),y.length!==0&&v.push(new d(f,y,E))}},i=[],s=n.name||"default",r=n.fps||30,o=n.blendMode;let h=n.length||-1;const u=n.hierarchy||[];for(let d=0;d<u.length;d++){const f=u[d].keys;if(!(!f||f.length===0))if(f[0].morphTargets){const g={};let _;for(_=0;_<f.length;_++)if(f[_].morphTargets)for(let v=0;v<f[_].morphTargets.length;v++)g[f[_].morphTargets[v]]=-1;for(const v in g){const y=[],E=[];for(let m=0;m!==f[_].morphTargets.length;++m){const x=f[_];y.push(x.time),E.push(x.morphTarget===v?1:0)}i.push(new NumberKeyframeTrack(".morphTargetInfluence["+v+"]",y,E))}h=g.length*r}else{const g=".bones["+t[d].name+"]";e(VectorKeyframeTrack,g+".position",f,"pos",i),e(QuaternionKeyframeTrack,g+".quaternion",f,"rot",i),e(VectorKeyframeTrack,g+".scale",f,"scl",i)}}return i.length===0?null:new this(s,h,i,o)}resetDuration(){const n=this.tracks;let t=0;for(let e=0,i=n.length;e!==i;++e){const s=this.tracks[e];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let n=0;n<this.tracks.length;n++)this.tracks[n].trim(0,this.duration);return this}validate(){let n=!0;for(let t=0;t<this.tracks.length;t++)n=n&&this.tracks[t].validate();return n}optimize(){for(let n=0;n<this.tracks.length;n++)this.tracks[n].optimize();return this}clone(){const n=[];for(let t=0;t<this.tracks.length;t++)n.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,n,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function getTrackTypeForValueTypeName(l){switch(l.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+l)}function parseKeyframeTrack(l){if(l.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const n=getTrackTypeForValueTypeName(l.type);if(l.times===void 0){const t=[],e=[];AnimationUtils.flattenJSON(l.keys,t,e,"value"),l.times=t,l.values=e}return n.parse!==void 0?n.parse(l):new n(l.name,l.times,l.values,l.interpolation)}const Cache={enabled:!1,files:{},add:function(l,n){this.enabled!==!1&&(this.files[l]=n)},get:function(l){if(this.enabled!==!1)return this.files[l]},remove:function(l){delete this.files[l]},clear:function(){this.files={}}};class LoadingManager{constructor(n,t,e){const i=this;let s=!1,r=0,o=0,h;const u=[];this.onStart=void 0,this.onLoad=n,this.onProgress=t,this.onError=e,this.itemStart=function(p){o++,s===!1&&i.onStart!==void 0&&i.onStart(p,r,o),s=!0},this.itemEnd=function(p){r++,i.onProgress!==void 0&&i.onProgress(p,r,o),r===o&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(p){i.onError!==void 0&&i.onError(p)},this.resolveURL=function(p){return h?h(p):p},this.setURLModifier=function(p){return h=p,this},this.addHandler=function(p,d){return u.push(p,d),this},this.removeHandler=function(p){const d=u.indexOf(p);return d!==-1&&u.splice(d,2),this},this.getHandler=function(p){for(let d=0,f=u.length;d<f;d+=2){const g=u[d],_=u[d+1];if(g.global&&(g.lastIndex=0),g.test(p))return _}return null}}}const DefaultLoadingManager=new LoadingManager;class Loader{constructor(n){this.manager=n!==void 0?n:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(n,t){const e=this;return new Promise(function(i,s){e.load(n,i,t,s)})}parse(){}setCrossOrigin(n){return this.crossOrigin=n,this}setWithCredentials(n){return this.withCredentials=n,this}setPath(n){return this.path=n,this}setResourcePath(n){return this.resourcePath=n,this}setRequestHeader(n){return this.requestHeader=n,this}}const loading={};class FileLoader extends Loader{constructor(n){super(n)}load(n,t,e,i){n===void 0&&(n=""),this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);const s=this,r=Cache.get(n);if(r!==void 0)return s.manager.itemStart(n),setTimeout(function(){t&&t(r),s.manager.itemEnd(n)},0),r;if(loading[n]!==void 0){loading[n].push({onLoad:t,onProgress:e,onError:i});return}const o=/^data:(.*?)(;base64)?,(.*)$/,h=n.match(o);let u;if(h){const p=h[1],d=!!h[2];let f=h[3];f=decodeURIComponent(f),d&&(f=atob(f));try{let g;const _=(this.responseType||"").toLowerCase();switch(_){case"arraybuffer":case"blob":const v=new Uint8Array(f.length);for(let E=0;E<f.length;E++)v[E]=f.charCodeAt(E);_==="blob"?g=new Blob([v.buffer],{type:p}):g=v.buffer;break;case"document":g=new DOMParser().parseFromString(f,p);break;case"json":g=JSON.parse(f);break;default:g=f;break}setTimeout(function(){t&&t(g),s.manager.itemEnd(n)},0)}catch(g){setTimeout(function(){i&&i(g),s.manager.itemError(n),s.manager.itemEnd(n)},0)}}else{loading[n]=[],loading[n].push({onLoad:t,onProgress:e,onError:i}),u=new XMLHttpRequest,u.open("GET",n,!0),u.addEventListener("load",function(p){const d=this.response,f=loading[n];if(delete loading[n],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Cache.add(n,d);for(let g=0,_=f.length;g<_;g++){const v=f[g];v.onLoad&&v.onLoad(d)}s.manager.itemEnd(n)}else{for(let g=0,_=f.length;g<_;g++){const v=f[g];v.onError&&v.onError(p)}s.manager.itemError(n),s.manager.itemEnd(n)}},!1),u.addEventListener("progress",function(p){const d=loading[n];for(let f=0,g=d.length;f<g;f++){const _=d[f];_.onProgress&&_.onProgress(p)}},!1),u.addEventListener("error",function(p){const d=loading[n];delete loading[n];for(let f=0,g=d.length;f<g;f++){const _=d[f];_.onError&&_.onError(p)}s.manager.itemError(n),s.manager.itemEnd(n)},!1),u.addEventListener("abort",function(p){const d=loading[n];delete loading[n];for(let f=0,g=d.length;f<g;f++){const _=d[f];_.onError&&_.onError(p)}s.manager.itemError(n),s.manager.itemEnd(n)},!1),this.responseType!==void 0&&(u.responseType=this.responseType),this.withCredentials!==void 0&&(u.withCredentials=this.withCredentials),u.overrideMimeType&&u.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(const p in this.requestHeader)u.setRequestHeader(p,this.requestHeader[p]);u.send(null)}return s.manager.itemStart(n),u}setResponseType(n){return this.responseType=n,this}setMimeType(n){return this.mimeType=n,this}}class ImageLoader extends Loader{constructor(n){super(n)}load(n,t,e,i){this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);const s=this,r=Cache.get(n);if(r!==void 0)return s.manager.itemStart(n),setTimeout(function(){t&&t(r),s.manager.itemEnd(n)},0),r;const o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function h(){o.removeEventListener("load",h,!1),o.removeEventListener("error",u,!1),Cache.add(n,this),t&&t(this),s.manager.itemEnd(n)}function u(p){o.removeEventListener("load",h,!1),o.removeEventListener("error",u,!1),i&&i(p),s.manager.itemError(n),s.manager.itemEnd(n)}return o.addEventListener("load",h,!1),o.addEventListener("error",u,!1),n.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(n),o.src=n,o}}class CubeTextureLoader extends Loader{constructor(n){super(n)}load(n,t,e,i){const s=new CubeTexture,r=new ImageLoader(this.manager);r.setCrossOrigin(this.crossOrigin),r.setPath(this.path);let o=0;function h(u){r.load(n[u],function(p){s.images[u]=p,o++,o===6&&(s.needsUpdate=!0,t&&t(s))},void 0,i)}for(let u=0;u<n.length;++u)h(u);return s}}class DataTextureLoader extends Loader{constructor(n){super(n)}load(n,t,e,i){const s=this,r=new DataTexture,o=new FileLoader(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(n,function(h){const u=s.parse(h);u&&(u.image!==void 0?r.image=u.image:u.data!==void 0&&(r.image.width=u.width,r.image.height=u.height,r.image.data=u.data),r.wrapS=u.wrapS!==void 0?u.wrapS:ClampToEdgeWrapping,r.wrapT=u.wrapT!==void 0?u.wrapT:ClampToEdgeWrapping,r.magFilter=u.magFilter!==void 0?u.magFilter:LinearFilter,r.minFilter=u.minFilter!==void 0?u.minFilter:LinearFilter,r.anisotropy=u.anisotropy!==void 0?u.anisotropy:1,u.encoding!==void 0&&(r.encoding=u.encoding),u.flipY!==void 0&&(r.flipY=u.flipY),u.format!==void 0&&(r.format=u.format),u.type!==void 0&&(r.type=u.type),u.mipmaps!==void 0&&(r.mipmaps=u.mipmaps,r.minFilter=LinearMipmapLinearFilter),u.mipmapCount===1&&(r.minFilter=LinearFilter),u.generateMipmaps!==void 0&&(r.generateMipmaps=u.generateMipmaps),r.needsUpdate=!0,t&&t(r,u))},e,i),r}}class TextureLoader extends Loader{constructor(n){super(n)}load(n,t,e,i){const s=new Texture,r=new ImageLoader(this.manager);return r.setCrossOrigin(this.crossOrigin),r.setPath(this.path),r.load(n,function(o){s.image=o;const h=n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0;s.format=h?RGBFormat:RGBAFormat,s.needsUpdate=!0,t!==void 0&&t(s)},e,i),s}}class Curve{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(n,t){const e=this.getUtoTmapping(n);return this.getPoint(e,t)}getPoints(n=5){const t=[];for(let e=0;e<=n;e++)t.push(this.getPoint(e/n));return t}getSpacedPoints(n=5){const t=[];for(let e=0;e<=n;e++)t.push(this.getPointAt(e/n));return t}getLength(){const n=this.getLengths();return n[n.length-1]}getLengths(n=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===n+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let e,i=this.getPoint(0),s=0;t.push(0);for(let r=1;r<=n;r++)e=this.getPoint(r/n),s+=e.distanceTo(i),t.push(s),i=e;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(n,t){const e=this.getLengths();let i=0;const s=e.length;let r;t?r=t:r=n*e[s-1];let o=0,h=s-1,u;for(;o<=h;)if(i=Math.floor(o+(h-o)/2),u=e[i]-r,u<0)o=i+1;else if(u>0)h=i-1;else{h=i;break}if(i=h,e[i]===r)return i/(s-1);const p=e[i],f=e[i+1]-p,g=(r-p)/f;return(i+g)/(s-1)}getTangent(n,t){let i=n-1e-4,s=n+1e-4;i<0&&(i=0),s>1&&(s=1);const r=this.getPoint(i),o=this.getPoint(s),h=t||(r.isVector2?new Vector2:new Vector3);return h.copy(o).sub(r).normalize(),h}getTangentAt(n,t){const e=this.getUtoTmapping(n);return this.getTangent(e,t)}computeFrenetFrames(n,t){const e=new Vector3,i=[],s=[],r=[],o=new Vector3,h=new Matrix4;for(let g=0;g<=n;g++){const _=g/n;i[g]=this.getTangentAt(_,new Vector3),i[g].normalize()}s[0]=new Vector3,r[0]=new Vector3;let u=Number.MAX_VALUE;const p=Math.abs(i[0].x),d=Math.abs(i[0].y),f=Math.abs(i[0].z);p<=u&&(u=p,e.set(1,0,0)),d<=u&&(u=d,e.set(0,1,0)),f<=u&&e.set(0,0,1),o.crossVectors(i[0],e).normalize(),s[0].crossVectors(i[0],o),r[0].crossVectors(i[0],s[0]);for(let g=1;g<=n;g++){if(s[g]=s[g-1].clone(),r[g]=r[g-1].clone(),o.crossVectors(i[g-1],i[g]),o.length()>Number.EPSILON){o.normalize();const _=Math.acos(clamp(i[g-1].dot(i[g]),-1,1));s[g].applyMatrix4(h.makeRotationAxis(o,_))}r[g].crossVectors(i[g],s[g])}if(t===!0){let g=Math.acos(clamp(s[0].dot(s[n]),-1,1));g/=n,i[0].dot(o.crossVectors(s[0],s[n]))>0&&(g=-g);for(let _=1;_<=n;_++)s[_].applyMatrix4(h.makeRotationAxis(i[_],g*_)),r[_].crossVectors(i[_],s[_])}return{tangents:i,normals:s,binormals:r}}clone(){return new this.constructor().copy(this)}copy(n){return this.arcLengthDivisions=n.arcLengthDivisions,this}toJSON(){const n={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return n.arcLengthDivisions=this.arcLengthDivisions,n.type=this.type,n}fromJSON(n){return this.arcLengthDivisions=n.arcLengthDivisions,this}}class EllipseCurve extends Curve{constructor(n=0,t=0,e=1,i=1,s=0,r=Math.PI*2,o=!1,h=0){super(),this.type="EllipseCurve",this.aX=n,this.aY=t,this.xRadius=e,this.yRadius=i,this.aStartAngle=s,this.aEndAngle=r,this.aClockwise=o,this.aRotation=h}getPoint(n,t){const e=t||new Vector2,i=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const r=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=i;for(;s>i;)s-=i;s<Number.EPSILON&&(r?s=0:s=i),this.aClockwise===!0&&!r&&(s===i?s=-i:s=s-i);const o=this.aStartAngle+n*s;let h=this.aX+this.xRadius*Math.cos(o),u=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const p=Math.cos(this.aRotation),d=Math.sin(this.aRotation),f=h-this.aX,g=u-this.aY;h=f*p-g*d+this.aX,u=f*d+g*p+this.aY}return e.set(h,u)}copy(n){return super.copy(n),this.aX=n.aX,this.aY=n.aY,this.xRadius=n.xRadius,this.yRadius=n.yRadius,this.aStartAngle=n.aStartAngle,this.aEndAngle=n.aEndAngle,this.aClockwise=n.aClockwise,this.aRotation=n.aRotation,this}toJSON(){const n=super.toJSON();return n.aX=this.aX,n.aY=this.aY,n.xRadius=this.xRadius,n.yRadius=this.yRadius,n.aStartAngle=this.aStartAngle,n.aEndAngle=this.aEndAngle,n.aClockwise=this.aClockwise,n.aRotation=this.aRotation,n}fromJSON(n){return super.fromJSON(n),this.aX=n.aX,this.aY=n.aY,this.xRadius=n.xRadius,this.yRadius=n.yRadius,this.aStartAngle=n.aStartAngle,this.aEndAngle=n.aEndAngle,this.aClockwise=n.aClockwise,this.aRotation=n.aRotation,this}}EllipseCurve.prototype.isEllipseCurve=!0;class ArcCurve extends EllipseCurve{constructor(n,t,e,i,s,r){super(n,t,e,e,i,s,r),this.type="ArcCurve"}}ArcCurve.prototype.isArcCurve=!0;function CubicPoly(){let l=0,n=0,t=0,e=0;function i(s,r,o,h){l=s,n=o,t=-3*s+3*r-2*o-h,e=2*s-2*r+o+h}return{initCatmullRom:function(s,r,o,h,u){i(r,o,u*(o-s),u*(h-r))},initNonuniformCatmullRom:function(s,r,o,h,u,p,d){let f=(r-s)/u-(o-s)/(u+p)+(o-r)/p,g=(o-r)/p-(h-r)/(p+d)+(h-o)/d;f*=p,g*=p,i(r,o,f,g)},calc:function(s){const r=s*s,o=r*s;return l+n*s+t*r+e*o}}}const tmp$2=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;class CatmullRomCurve3 extends Curve{constructor(n=[],t=!1,e="centripetal",i=.5){super(),this.type="CatmullRomCurve3",this.points=n,this.closed=t,this.curveType=e,this.tension=i}getPoint(n,t=new Vector3){const e=t,i=this.points,s=i.length,r=(s-(this.closed?0:1))*n;let o=Math.floor(r),h=r-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:h===0&&o===s-1&&(o=s-2,h=1);let u,p;this.closed||o>0?u=i[(o-1)%s]:(tmp$2.subVectors(i[0],i[1]).add(i[0]),u=tmp$2);const d=i[o%s],f=i[(o+1)%s];if(this.closed||o+2<s?p=i[(o+2)%s]:(tmp$2.subVectors(i[s-1],i[s-2]).add(i[s-1]),p=tmp$2),this.curveType==="centripetal"||this.curveType==="chordal"){const g=this.curveType==="chordal"?.5:.25;let _=Math.pow(u.distanceToSquared(d),g),v=Math.pow(d.distanceToSquared(f),g),y=Math.pow(f.distanceToSquared(p),g);v<1e-4&&(v=1),_<1e-4&&(_=v),y<1e-4&&(y=v),px.initNonuniformCatmullRom(u.x,d.x,f.x,p.x,_,v,y),py.initNonuniformCatmullRom(u.y,d.y,f.y,p.y,_,v,y),pz.initNonuniformCatmullRom(u.z,d.z,f.z,p.z,_,v,y)}else this.curveType==="catmullrom"&&(px.initCatmullRom(u.x,d.x,f.x,p.x,this.tension),py.initCatmullRom(u.y,d.y,f.y,p.y,this.tension),pz.initCatmullRom(u.z,d.z,f.z,p.z,this.tension));return e.set(px.calc(h),py.calc(h),pz.calc(h)),e}copy(n){super.copy(n),this.points=[];for(let t=0,e=n.points.length;t<e;t++){const i=n.points[t];this.points.push(i.clone())}return this.closed=n.closed,this.curveType=n.curveType,this.tension=n.tension,this}toJSON(){const n=super.toJSON();n.points=[];for(let t=0,e=this.points.length;t<e;t++){const i=this.points[t];n.points.push(i.toArray())}return n.closed=this.closed,n.curveType=this.curveType,n.tension=this.tension,n}fromJSON(n){super.fromJSON(n),this.points=[];for(let t=0,e=n.points.length;t<e;t++){const i=n.points[t];this.points.push(new Vector3().fromArray(i))}return this.closed=n.closed,this.curveType=n.curveType,this.tension=n.tension,this}}CatmullRomCurve3.prototype.isCatmullRomCurve3=!0;function CatmullRom(l,n,t,e,i){const s=(e-n)*.5,r=(i-t)*.5,o=l*l,h=l*o;return(2*t-2*e+s+r)*h+(-3*t+3*e-2*s-r)*o+s*l+t}function QuadraticBezierP0(l,n){const t=1-l;return t*t*n}function QuadraticBezierP1(l,n){return 2*(1-l)*l*n}function QuadraticBezierP2(l,n){return l*l*n}function QuadraticBezier(l,n,t,e){return QuadraticBezierP0(l,n)+QuadraticBezierP1(l,t)+QuadraticBezierP2(l,e)}function CubicBezierP0(l,n){const t=1-l;return t*t*t*n}function CubicBezierP1(l,n){const t=1-l;return 3*t*t*l*n}function CubicBezierP2(l,n){return 3*(1-l)*l*l*n}function CubicBezierP3(l,n){return l*l*l*n}function CubicBezier(l,n,t,e,i){return CubicBezierP0(l,n)+CubicBezierP1(l,t)+CubicBezierP2(l,e)+CubicBezierP3(l,i)}class CubicBezierCurve extends Curve{constructor(n=new Vector2,t=new Vector2,e=new Vector2,i=new Vector2){super(),this.type="CubicBezierCurve",this.v0=n,this.v1=t,this.v2=e,this.v3=i}getPoint(n,t=new Vector2){const e=t,i=this.v0,s=this.v1,r=this.v2,o=this.v3;return e.set(CubicBezier(n,i.x,s.x,r.x,o.x),CubicBezier(n,i.y,s.y,r.y,o.y)),e}copy(n){return super.copy(n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this.v3.copy(n.v3),this}toJSON(){const n=super.toJSON();return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n.v3=this.v3.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this.v3.fromArray(n.v3),this}}CubicBezierCurve.prototype.isCubicBezierCurve=!0;class CubicBezierCurve3 extends Curve{constructor(n=new Vector3,t=new Vector3,e=new Vector3,i=new Vector3){super(),this.type="CubicBezierCurve3",this.v0=n,this.v1=t,this.v2=e,this.v3=i}getPoint(n,t=new Vector3){const e=t,i=this.v0,s=this.v1,r=this.v2,o=this.v3;return e.set(CubicBezier(n,i.x,s.x,r.x,o.x),CubicBezier(n,i.y,s.y,r.y,o.y),CubicBezier(n,i.z,s.z,r.z,o.z)),e}copy(n){return super.copy(n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this.v3.copy(n.v3),this}toJSON(){const n=super.toJSON();return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n.v3=this.v3.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this.v3.fromArray(n.v3),this}}CubicBezierCurve3.prototype.isCubicBezierCurve3=!0;class LineCurve extends Curve{constructor(n=new Vector2,t=new Vector2){super(),this.type="LineCurve",this.v1=n,this.v2=t}getPoint(n,t=new Vector2){const e=t;return n===1?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(n).add(this.v1)),e}getPointAt(n,t){return this.getPoint(n,t)}getTangent(n,t){const e=t||new Vector2;return e.copy(this.v2).sub(this.v1).normalize(),e}copy(n){return super.copy(n),this.v1.copy(n.v1),this.v2.copy(n.v2),this}toJSON(){const n=super.toJSON();return n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this}}LineCurve.prototype.isLineCurve=!0;class LineCurve3 extends Curve{constructor(n=new Vector3,t=new Vector3){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=n,this.v2=t}getPoint(n,t=new Vector3){const e=t;return n===1?e.copy(this.v2):(e.copy(this.v2).sub(this.v1),e.multiplyScalar(n).add(this.v1)),e}getPointAt(n,t){return this.getPoint(n,t)}copy(n){return super.copy(n),this.v1.copy(n.v1),this.v2.copy(n.v2),this}toJSON(){const n=super.toJSON();return n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this}}class QuadraticBezierCurve extends Curve{constructor(n=new Vector2,t=new Vector2,e=new Vector2){super(),this.type="QuadraticBezierCurve",this.v0=n,this.v1=t,this.v2=e}getPoint(n,t=new Vector2){const e=t,i=this.v0,s=this.v1,r=this.v2;return e.set(QuadraticBezier(n,i.x,s.x,r.x),QuadraticBezier(n,i.y,s.y,r.y)),e}copy(n){return super.copy(n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this}toJSON(){const n=super.toJSON();return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this}}QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0;class QuadraticBezierCurve3 extends Curve{constructor(n=new Vector3,t=new Vector3,e=new Vector3){super(),this.type="QuadraticBezierCurve3",this.v0=n,this.v1=t,this.v2=e}getPoint(n,t=new Vector3){const e=t,i=this.v0,s=this.v1,r=this.v2;return e.set(QuadraticBezier(n,i.x,s.x,r.x),QuadraticBezier(n,i.y,s.y,r.y),QuadraticBezier(n,i.z,s.z,r.z)),e}copy(n){return super.copy(n),this.v0.copy(n.v0),this.v1.copy(n.v1),this.v2.copy(n.v2),this}toJSON(){const n=super.toJSON();return n.v0=this.v0.toArray(),n.v1=this.v1.toArray(),n.v2=this.v2.toArray(),n}fromJSON(n){return super.fromJSON(n),this.v0.fromArray(n.v0),this.v1.fromArray(n.v1),this.v2.fromArray(n.v2),this}}QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0;class SplineCurve extends Curve{constructor(n=[]){super(),this.type="SplineCurve",this.points=n}getPoint(n,t=new Vector2){const e=t,i=this.points,s=(i.length-1)*n,r=Math.floor(s),o=s-r,h=i[r===0?r:r-1],u=i[r],p=i[r>i.length-2?i.length-1:r+1],d=i[r>i.length-3?i.length-1:r+2];return e.set(CatmullRom(o,h.x,u.x,p.x,d.x),CatmullRom(o,h.y,u.y,p.y,d.y)),e}copy(n){super.copy(n),this.points=[];for(let t=0,e=n.points.length;t<e;t++){const i=n.points[t];this.points.push(i.clone())}return this}toJSON(){const n=super.toJSON();n.points=[];for(let t=0,e=this.points.length;t<e;t++){const i=this.points[t];n.points.push(i.toArray())}return n}fromJSON(n){super.fromJSON(n),this.points=[];for(let t=0,e=n.points.length;t<e;t++){const i=n.points[t];this.points.push(new Vector2().fromArray(i))}return this}}SplineCurve.prototype.isSplineCurve=!0;var Curves=Object.freeze({__proto__:null,ArcCurve,CatmullRomCurve3,CubicBezierCurve,CubicBezierCurve3,EllipseCurve,LineCurve,LineCurve3,QuadraticBezierCurve,QuadraticBezierCurve3,SplineCurve});class CurvePath extends Curve{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(n){this.curves.push(n)}closePath(){const n=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);n.equals(t)||this.curves.push(new LineCurve(t,n))}getPoint(n){const t=n*this.getLength(),e=this.getCurveLengths();let i=0;for(;i<e.length;){if(e[i]>=t){const s=e[i]-t,r=this.curves[i],o=r.getLength(),h=o===0?0:1-s/o;return r.getPointAt(h)}i++}return null}getLength(){const n=this.getCurveLengths();return n[n.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const n=[];let t=0;for(let e=0,i=this.curves.length;e<i;e++)t+=this.curves[e].getLength(),n.push(t);return this.cacheLengths=n,n}getSpacedPoints(n=40){const t=[];for(let e=0;e<=n;e++)t.push(this.getPoint(e/n));return this.autoClose&&t.push(t[0]),t}getPoints(n=12){const t=[];let e;for(let i=0,s=this.curves;i<s.length;i++){const r=s[i],o=r&&r.isEllipseCurve?n*2:r&&(r.isLineCurve||r.isLineCurve3)?1:r&&r.isSplineCurve?n*r.points.length:n,h=r.getPoints(o);for(let u=0;u<h.length;u++){const p=h[u];e&&e.equals(p)||(t.push(p),e=p)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(n){super.copy(n),this.curves=[];for(let t=0,e=n.curves.length;t<e;t++){const i=n.curves[t];this.curves.push(i.clone())}return this.autoClose=n.autoClose,this}toJSON(){const n=super.toJSON();n.autoClose=this.autoClose,n.curves=[];for(let t=0,e=this.curves.length;t<e;t++){const i=this.curves[t];n.curves.push(i.toJSON())}return n}fromJSON(n){super.fromJSON(n),this.autoClose=n.autoClose,this.curves=[];for(let t=0,e=n.curves.length;t<e;t++){const i=n.curves[t];this.curves.push(new Curves[i.type]().fromJSON(i))}return this}}class Path extends CurvePath{constructor(n){super(),this.type="Path",this.currentPoint=new Vector2,n&&this.setFromPoints(n)}setFromPoints(n){this.moveTo(n[0].x,n[0].y);for(let t=1,e=n.length;t<e;t++)this.lineTo(n[t].x,n[t].y);return this}moveTo(n,t){return this.currentPoint.set(n,t),this}lineTo(n,t){const e=new LineCurve(this.currentPoint.clone(),new Vector2(n,t));return this.curves.push(e),this.currentPoint.set(n,t),this}quadraticCurveTo(n,t,e,i){const s=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(n,t),new Vector2(e,i));return this.curves.push(s),this.currentPoint.set(e,i),this}bezierCurveTo(n,t,e,i,s,r){const o=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(n,t),new Vector2(e,i),new Vector2(s,r));return this.curves.push(o),this.currentPoint.set(s,r),this}splineThru(n){const t=[this.currentPoint.clone()].concat(n),e=new SplineCurve(t);return this.curves.push(e),this.currentPoint.copy(n[n.length-1]),this}arc(n,t,e,i,s,r){const o=this.currentPoint.x,h=this.currentPoint.y;return this.absarc(n+o,t+h,e,i,s,r),this}absarc(n,t,e,i,s,r){return this.absellipse(n,t,e,e,i,s,r),this}ellipse(n,t,e,i,s,r,o,h){const u=this.currentPoint.x,p=this.currentPoint.y;return this.absellipse(n+u,t+p,e,i,s,r,o,h),this}absellipse(n,t,e,i,s,r,o,h){const u=new EllipseCurve(n,t,e,i,s,r,o,h);if(this.curves.length>0){const d=u.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(u);const p=u.getPoint(1);return this.currentPoint.copy(p),this}copy(n){return super.copy(n),this.currentPoint.copy(n.currentPoint),this}toJSON(){const n=super.toJSON();return n.currentPoint=this.currentPoint.toArray(),n}fromJSON(n){return super.fromJSON(n),this.currentPoint.fromArray(n.currentPoint),this}}let Shape$1=class extends Path{constructor(n){super(n),this.uuid=generateUUID(),this.type="Shape",this.holes=[]}getPointsHoles(n){const t=[];for(let e=0,i=this.holes.length;e<i;e++)t[e]=this.holes[e].getPoints(n);return t}extractPoints(n){return{shape:this.getPoints(n),holes:this.getPointsHoles(n)}}copy(n){super.copy(n),this.holes=[];for(let t=0,e=n.holes.length;t<e;t++){const i=n.holes[t];this.holes.push(i.clone())}return this}toJSON(){const n=super.toJSON();n.uuid=this.uuid,n.holes=[];for(let t=0,e=this.holes.length;t<e;t++){const i=this.holes[t];n.holes.push(i.toJSON())}return n}fromJSON(n){super.fromJSON(n),this.uuid=n.uuid,this.holes=[];for(let t=0,e=n.holes.length;t<e;t++){const i=n.holes[t];this.holes.push(new Path().fromJSON(i))}return this}};class Light extends Object3D{constructor(n,t=1){super(),this.type="Light",this.color=new Color(n),this.intensity=t}dispose(){}copy(n){return super.copy(n),this.color.copy(n.color),this.intensity=n.intensity,this}toJSON(n){const t=super.toJSON(n);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}Light.prototype.isLight=!0;class HemisphereLight extends Light{constructor(n,t,e){super(n,e),this.type="HemisphereLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(t)}copy(n){return Light.prototype.copy.call(this,n),this.groundColor.copy(n.groundColor),this}}HemisphereLight.prototype.isHemisphereLight=!0;const _projScreenMatrix$1=new Matrix4,_lightPositionWorld$1=new Vector3,_lookTarget$1=new Vector3;class LightShadow{constructor(n){this.camera=n,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(n){const t=this.camera,e=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(n.matrixWorld),t.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(n.target.matrixWorld),t.lookAt(_lookTarget$1),t.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1),e.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),e.multiply(t.projectionMatrix),e.multiply(t.matrixWorldInverse)}getViewport(n){return this._viewports[n]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(n){return this.camera=n.camera.clone(),this.bias=n.bias,this.radius=n.radius,this.mapSize.copy(n.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const n={};return this.bias!==0&&(n.bias=this.bias),this.normalBias!==0&&(n.normalBias=this.normalBias),this.radius!==1&&(n.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(n.mapSize=this.mapSize.toArray()),n.camera=this.camera.toJSON(!1).object,delete n.camera.matrix,n}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.focus=1}updateMatrices(n){const t=this.camera,e=RAD2DEG*2*n.angle*this.focus,i=this.mapSize.width/this.mapSize.height,s=n.distance||t.far;(e!==t.fov||i!==t.aspect||s!==t.far)&&(t.fov=e,t.aspect=i,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(n)}copy(n){return super.copy(n),this.focus=n.focus,this}}SpotLightShadow.prototype.isSpotLightShadow=!0;class SpotLight extends Light{constructor(n,t,e=0,i=Math.PI/3,s=0,r=1){super(n,t),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.distance=e,this.angle=i,this.penumbra=s,this.decay=r,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(n){this.intensity=n/Math.PI}dispose(){this.shadow.dispose()}copy(n){return super.copy(n),this.distance=n.distance,this.angle=n.angle,this.penumbra=n.penumbra,this.decay=n.decay,this.target=n.target.clone(),this.shadow=n.shadow.clone(),this}}SpotLight.prototype.isSpotLight=!0;const _projScreenMatrix=new Matrix4,_lightPositionWorld=new Vector3,_lookTarget=new Vector3;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}updateMatrices(n,t=0){const e=this.camera,i=this.matrix,s=n.distance||e.far;s!==e.far&&(e.far=s,e.updateProjectionMatrix()),_lightPositionWorld.setFromMatrixPosition(n.matrixWorld),e.position.copy(_lightPositionWorld),_lookTarget.copy(e.position),_lookTarget.add(this._cubeDirections[t]),e.up.copy(this._cubeUps[t]),e.lookAt(_lookTarget),e.updateMatrixWorld(),i.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z),_projScreenMatrix.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix)}}PointLightShadow.prototype.isPointLightShadow=!0;class PointLight extends Light{constructor(n,t,e=0,i=1){super(n,t),this.type="PointLight",this.distance=e,this.decay=i,this.shadow=new PointLightShadow}get power(){return this.intensity*4*Math.PI}set power(n){this.intensity=n/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(n){return super.copy(n),this.distance=n.distance,this.decay=n.decay,this.shadow=n.shadow.clone(),this}}PointLight.prototype.isPointLight=!0;class OrthographicCamera extends Camera{constructor(n=-1,t=1,e=1,i=-1,s=.1,r=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=n,this.right=t,this.top=e,this.bottom=i,this.near=s,this.far=r,this.updateProjectionMatrix()}copy(n,t){return super.copy(n,t),this.left=n.left,this.right=n.right,this.top=n.top,this.bottom=n.bottom,this.near=n.near,this.far=n.far,this.zoom=n.zoom,this.view=n.view===null?null:Object.assign({},n.view),this}setViewOffset(n,t,e,i,s,r){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=n,this.view.fullHeight=t,this.view.offsetX=e,this.view.offsetY=i,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const n=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),e=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=e-n,r=e+n,o=i+t,h=i-t;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,p=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=u*this.view.offsetX,r=s+u*this.view.width,o-=p*this.view.offsetY,h=o-p*this.view.height}this.projectionMatrix.makeOrthographic(s,r,o,h,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(n){const t=super.toJSON(n);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}OrthographicCamera.prototype.isOrthographicCamera=!0;class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500))}}DirectionalLightShadow.prototype.isDirectionalLightShadow=!0;class DirectionalLight extends Light{constructor(n,t){super(n,t),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(n){return super.copy(n),this.target=n.target.clone(),this.shadow=n.shadow.clone(),this}}DirectionalLight.prototype.isDirectionalLight=!0;class AmbientLight extends Light{constructor(n,t){super(n,t),this.type="AmbientLight"}}AmbientLight.prototype.isAmbientLight=!0;class RectAreaLight extends Light{constructor(n,t,e=10,i=10){super(n,t),this.type="RectAreaLight",this.width=e,this.height=i}copy(n){return super.copy(n),this.width=n.width,this.height=n.height,this}toJSON(n){const t=super.toJSON(n);return t.object.width=this.width,t.object.height=this.height,t}}RectAreaLight.prototype.isRectAreaLight=!0;class SphericalHarmonics3{constructor(){this.coefficients=[];for(let n=0;n<9;n++)this.coefficients.push(new Vector3)}set(n){for(let t=0;t<9;t++)this.coefficients[t].copy(n[t]);return this}zero(){for(let n=0;n<9;n++)this.coefficients[n].set(0,0,0);return this}getAt(n,t){const e=n.x,i=n.y,s=n.z,r=this.coefficients;return t.copy(r[0]).multiplyScalar(.282095),t.addScaledVector(r[1],.488603*i),t.addScaledVector(r[2],.488603*s),t.addScaledVector(r[3],.488603*e),t.addScaledVector(r[4],1.092548*(e*i)),t.addScaledVector(r[5],1.092548*(i*s)),t.addScaledVector(r[6],.315392*(3*s*s-1)),t.addScaledVector(r[7],1.092548*(e*s)),t.addScaledVector(r[8],.546274*(e*e-i*i)),t}getIrradianceAt(n,t){const e=n.x,i=n.y,s=n.z,r=this.coefficients;return t.copy(r[0]).multiplyScalar(.886227),t.addScaledVector(r[1],2*.511664*i),t.addScaledVector(r[2],2*.511664*s),t.addScaledVector(r[3],2*.511664*e),t.addScaledVector(r[4],2*.429043*e*i),t.addScaledVector(r[5],2*.429043*i*s),t.addScaledVector(r[6],.743125*s*s-.247708),t.addScaledVector(r[7],2*.429043*e*s),t.addScaledVector(r[8],.429043*(e*e-i*i)),t}add(n){for(let t=0;t<9;t++)this.coefficients[t].add(n.coefficients[t]);return this}addScaledSH(n,t){for(let e=0;e<9;e++)this.coefficients[e].addScaledVector(n.coefficients[e],t);return this}scale(n){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(n);return this}lerp(n,t){for(let e=0;e<9;e++)this.coefficients[e].lerp(n.coefficients[e],t);return this}equals(n){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(n.coefficients[t]))return!1;return!0}copy(n){return this.set(n.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(n,t=0){const e=this.coefficients;for(let i=0;i<9;i++)e[i].fromArray(n,t+i*3);return this}toArray(n=[],t=0){const e=this.coefficients;for(let i=0;i<9;i++)e[i].toArray(n,t+i*3);return n}static getBasisAt(n,t){const e=n.x,i=n.y,s=n.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*s,t[3]=.488603*e,t[4]=1.092548*e*i,t[5]=1.092548*i*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*e*s,t[8]=.546274*(e*e-i*i)}}SphericalHarmonics3.prototype.isSphericalHarmonics3=!0;class LightProbe extends Light{constructor(n=new SphericalHarmonics3,t=1){super(void 0,t),this.sh=n}copy(n){return super.copy(n),this.sh.copy(n.sh),this}fromJSON(n){return this.intensity=n.intensity,this.sh.fromArray(n.sh),this}toJSON(n){const t=super.toJSON(n);return t.object.sh=this.sh.toArray(),t}}LightProbe.prototype.isLightProbe=!0;class LoaderUtils{static decodeText(n){if(typeof TextDecoder<"u")return new TextDecoder().decode(n);let t="";for(let e=0,i=n.length;e<i;e++)t+=String.fromCharCode(n[e]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(n){const t=n.lastIndexOf("/");return t===-1?"./":n.substr(0,t+1)}}class InstancedBufferGeometry extends BufferGeometry{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(n){return super.copy(n),this.instanceCount=n.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const n=super.toJSON(this);return n.instanceCount=this.instanceCount,n.isInstancedBufferGeometry=!0,n}}InstancedBufferGeometry.prototype.isInstancedBufferGeometry=!0;class InstancedBufferAttribute extends BufferAttribute{constructor(n,t,e,i){typeof e=="number"&&(i=e,e=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(n,t,e),this.meshPerAttribute=i||1}copy(n){return super.copy(n),this.meshPerAttribute=n.meshPerAttribute,this}toJSON(){const n=super.toJSON();return n.meshPerAttribute=this.meshPerAttribute,n.isInstancedBufferAttribute=!0,n}}InstancedBufferAttribute.prototype.isInstancedBufferAttribute=!0;class ImageBitmapLoader extends Loader{constructor(n){super(n),typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(n){return this.options=n,this}load(n,t,e,i){n===void 0&&(n=""),this.path!==void 0&&(n=this.path+n),n=this.manager.resolveURL(n);const s=this,r=Cache.get(n);if(r!==void 0)return s.manager.itemStart(n),setTimeout(function(){t&&t(r),s.manager.itemEnd(n)},0),r;const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,fetch(n,o).then(function(h){return h.blob()}).then(function(h){return createImageBitmap(h,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(h){Cache.add(n,h),t&&t(h),s.manager.itemEnd(n)}).catch(function(h){i&&i(h),s.manager.itemError(n),s.manager.itemEnd(n)}),s.manager.itemStart(n)}}ImageBitmapLoader.prototype.isImageBitmapLoader=!0;let _context;const AudioContext={getContext:function(){return _context===void 0&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context},setContext:function(l){_context=l}};class AudioLoader extends Loader{constructor(n){super(n)}load(n,t,e,i){const s=this,r=new FileLoader(this.manager);r.setResponseType("arraybuffer"),r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(n,function(o){try{const h=o.slice(0);AudioContext.getContext().decodeAudioData(h,function(p){t(p)})}catch(h){i?i(h):console.error(h),s.manager.itemError(n)}},e,i)}}class HemisphereLightProbe extends LightProbe{constructor(n,t,e=1){super(void 0,e);const i=new Color().set(n),s=new Color().set(t),r=new Vector3(i.r,i.g,i.b),o=new Vector3(s.r,s.g,s.b),h=Math.sqrt(Math.PI),u=h*Math.sqrt(.75);this.sh.coefficients[0].copy(r).add(o).multiplyScalar(h),this.sh.coefficients[1].copy(r).sub(o).multiplyScalar(u)}}HemisphereLightProbe.prototype.isHemisphereLightProbe=!0;class AmbientLightProbe extends LightProbe{constructor(n,t=1){super(void 0,t);const e=new Color().set(n);this.sh.coefficients[0].set(e.r,e.g,e.b).multiplyScalar(2*Math.sqrt(Math.PI))}}AmbientLightProbe.prototype.isAmbientLightProbe=!0;class Audio extends Object3D{constructor(n){super(),this.type="Audio",this.listener=n,this.context=n.context,this.gain=this.context.createGain(),this.gain.connect(n.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(n){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=n,this.connect(),this}setMediaElementSource(n){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(n),this.connect(),this}setMediaStreamSource(n){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(n),this.connect(),this}setBuffer(n){return this.buffer=n,this.sourceType="buffer",this.autoplay&&this.play(),this}play(n=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+n;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let n=1,t=this.filters.length;n<t;n++)this.filters[n-1].connect(this.filters[n]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let n=1,t=this.filters.length;n<t;n++)this.filters[n-1].disconnect(this.filters[n]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(n){return n||(n=[]),this._connected===!0?(this.disconnect(),this.filters=n.slice(),this.connect()):this.filters=n.slice(),this}setDetune(n){if(this.detune=n,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(n){return this.setFilters(n?[n]:[])}setPlaybackRate(n){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=n,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(n){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=n,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(n){return this.loopStart=n,this}setLoopEnd(n){return this.loopEnd=n,this}getVolume(){return this.gain.gain.value}setVolume(n){return this.gain.gain.setTargetAtTime(n,this.context.currentTime,.01),this}}class PropertyMixer{constructor(n,t,e){this.binding=n,this.valueSize=e;let i,s,r;switch(t){case"quaternion":i=this._slerp,s=this._slerpAdditive,r=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(e*6),this._workIndex=5;break;case"string":case"bool":i=this._select,s=this._select,r=this._setAdditiveIdentityOther,this.buffer=new Array(e*5);break;default:i=this._lerp,s=this._lerpAdditive,r=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(e*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=s,this._setIdentity=r,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(n,t){const e=this.buffer,i=this.valueSize,s=n*i+i;let r=this.cumulativeWeight;if(r===0){for(let o=0;o!==i;++o)e[s+o]=e[o];r=t}else{r+=t;const o=t/r;this._mixBufferRegion(e,s,0,o,i)}this.cumulativeWeight=r}accumulateAdditive(n){const t=this.buffer,e=this.valueSize,i=e*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,n,e),this.cumulativeWeightAdditive+=n}apply(n){const t=this.valueSize,e=this.buffer,i=n*t+t,s=this.cumulativeWeight,r=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const h=t*this._origIndex;this._mixBufferRegion(e,i,h,1-s,t)}r>0&&this._mixBufferRegionAdditive(e,i,this._addIndex*t,1,t);for(let h=t,u=t+t;h!==u;++h)if(e[h]!==e[h+t]){o.setValue(e,i);break}}saveOriginalState(){const n=this.binding,t=this.buffer,e=this.valueSize,i=e*this._origIndex;n.getValue(t,i);for(let s=e,r=i;s!==r;++s)t[s]=t[i+s%e];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const n=this.valueSize*3;this.binding.setValue(this.buffer,n)}_setAdditiveIdentityNumeric(){const n=this._addIndex*this.valueSize,t=n+this.valueSize;for(let e=n;e<t;e++)this.buffer[e]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const n=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let e=0;e<this.valueSize;e++)this.buffer[t+e]=this.buffer[n+e]}_select(n,t,e,i,s){if(i>=.5)for(let r=0;r!==s;++r)n[t+r]=n[e+r]}_slerp(n,t,e,i){Quaternion$1.slerpFlat(n,t,n,t,n,e,i)}_slerpAdditive(n,t,e,i,s){const r=this._workIndex*s;Quaternion$1.multiplyQuaternionsFlat(n,r,n,t,n,e),Quaternion$1.slerpFlat(n,t,n,t,n,r,i)}_lerp(n,t,e,i,s){const r=1-i;for(let o=0;o!==s;++o){const h=t+o;n[h]=n[h]*r+n[e+o]*i}}_lerpAdditive(n,t,e,i,s){for(let r=0;r!==s;++r){const o=t+r;n[o]=n[o]+n[e+r]*i}}}const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones"];class Composite{constructor(n,t,e){const i=e||PropertyBinding.parseTrackName(t);this._targetGroup=n,this._bindings=n.subscribe_(t,i)}getValue(n,t){this.bind();const e=this._targetGroup.nCachedObjects_,i=this._bindings[e];i!==void 0&&i.getValue(n,t)}setValue(n,t){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=e.length;i!==s;++i)e[i].setValue(n,t)}bind(){const n=this._bindings;for(let t=this._targetGroup.nCachedObjects_,e=n.length;t!==e;++t)n[t].bind()}unbind(){const n=this._bindings;for(let t=this._targetGroup.nCachedObjects_,e=n.length;t!==e;++t)n[t].unbind()}}class PropertyBinding{constructor(n,t,e){this.path=t,this.parsedPath=e||PropertyBinding.parseTrackName(t),this.node=PropertyBinding.findNode(n,this.parsedPath.nodeName)||n,this.rootNode=n,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(n,t,e){return n&&n.isAnimationObjectGroup?new PropertyBinding.Composite(n,t,e):new PropertyBinding(n,t,e)}static sanitizeNodeName(n){return n.replace(/\s/g,"_").replace(_reservedRe,"")}static parseTrackName(n){const t=_trackRe.exec(n);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+n);const e={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=e.nodeName&&e.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const s=e.nodeName.substring(i+1);_supportedObjectNames.indexOf(s)!==-1&&(e.nodeName=e.nodeName.substring(0,i),e.objectName=s)}if(e.propertyName===null||e.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+n);return e}static findNode(n,t){if(!t||t===""||t==="."||t===-1||t===n.name||t===n.uuid)return n;if(n.skeleton){const e=n.skeleton.getBoneByName(t);if(e!==void 0)return e}if(n.children){const e=function(s){for(let r=0;r<s.length;r++){const o=s[r];if(o.name===t||o.uuid===t)return o;const h=e(o.children);if(h)return h}return null},i=e(n.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(n,t){n[t]=this.node[this.propertyName]}_getValue_array(n,t){const e=this.resolvedProperty;for(let i=0,s=e.length;i!==s;++i)n[t++]=e[i]}_getValue_arrayElement(n,t){n[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(n,t){this.resolvedProperty.toArray(n,t)}_setValue_direct(n,t){this.targetObject[this.propertyName]=n[t]}_setValue_direct_setNeedsUpdate(n,t){this.targetObject[this.propertyName]=n[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(n,t){this.targetObject[this.propertyName]=n[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(n,t){const e=this.resolvedProperty;for(let i=0,s=e.length;i!==s;++i)e[i]=n[t++]}_setValue_array_setNeedsUpdate(n,t){const e=this.resolvedProperty;for(let i=0,s=e.length;i!==s;++i)e[i]=n[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(n,t){const e=this.resolvedProperty;for(let i=0,s=e.length;i!==s;++i)e[i]=n[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(n,t){this.resolvedProperty[this.propertyIndex]=n[t]}_setValue_arrayElement_setNeedsUpdate(n,t){this.resolvedProperty[this.propertyIndex]=n[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(n,t){this.resolvedProperty[this.propertyIndex]=n[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(n,t){this.resolvedProperty.fromArray(n,t)}_setValue_fromArray_setNeedsUpdate(n,t){this.resolvedProperty.fromArray(n,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(n,t){this.resolvedProperty.fromArray(n,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(n,t){this.bind(),this.getValue(n,t)}_setValue_unbound(n,t){this.bind(),this.setValue(n,t)}bind(){let n=this.node;const t=this.parsedPath,e=t.objectName,i=t.propertyName;let s=t.propertyIndex;if(n||(n=PropertyBinding.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=n),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!n){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(e){let u=t.objectIndex;switch(e){case"materials":if(!n.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!n.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}n=n.material.materials;break;case"bones":if(!n.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}n=n.skeleton.bones;for(let p=0;p<n.length;p++)if(n[p].name===u){u=p;break}break;default:if(n[e]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}n=n[e]}if(u!==void 0){if(n[u]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,n);return}n=n[u]}}const r=n[i];if(r===void 0){const u=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+i+" but it wasn't found.",n);return}let o=this.Versioning.None;this.targetObject=n,n.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:n.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let h=this.BindingType.Direct;if(s!==void 0){if(i==="morphTargetInfluences"){if(!n.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(n.geometry.isBufferGeometry){if(!n.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}n.morphTargetDictionary[s]!==void 0&&(s=n.morphTargetDictionary[s])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}h=this.BindingType.ArrayElement,this.resolvedProperty=r,this.propertyIndex=s}else r.fromArray!==void 0&&r.toArray!==void 0?(h=this.BindingType.HasFromToArray,this.resolvedProperty=r):Array.isArray(r)?(h=this.BindingType.EntireArray,this.resolvedProperty=r):this.propertyName=i;this.getValue=this.GetterByBindingType[h],this.setValue=this.SetterByBindingTypeAndVersioning[h][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=Composite;PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray];PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class AnimationAction{constructor(n,t,e=null,i=t.blendMode){this._mixer=n,this._clip=t,this._localRoot=e,this.blendMode=i;const s=t.tracks,r=s.length,o=new Array(r),h={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding};for(let u=0;u!==r;++u){const p=s[u].createInterpolant(null);o[u]=p,p.settings=h}this._interpolantSettings=h,this._interpolants=o,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(n){return this._startTime=n,this}setLoop(n,t){return this.loop=n,this.repetitions=t,this}setEffectiveWeight(n){return this.weight=n,this._effectiveWeight=this.enabled?n:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(n){return this._scheduleFading(n,0,1)}fadeOut(n){return this._scheduleFading(n,1,0)}crossFadeFrom(n,t,e){if(n.fadeOut(t),this.fadeIn(t),e){const i=this._clip.duration,s=n._clip.duration,r=s/i,o=i/s;n.warp(1,r,t),this.warp(o,1,t)}return this}crossFadeTo(n,t,e){return n.crossFadeFrom(this,t,e)}stopFading(){const n=this._weightInterpolant;return n!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(n)),this}setEffectiveTimeScale(n){return this.timeScale=n,this._effectiveTimeScale=this.paused?0:n,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(n){return this.timeScale=this._clip.duration/n,this.stopWarping()}syncWith(n){return this.time=n.time,this.timeScale=n.timeScale,this.stopWarping()}halt(n){return this.warp(this._effectiveTimeScale,0,n)}warp(n,t,e){const i=this._mixer,s=i.time,r=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const h=o.parameterPositions,u=o.sampleValues;return h[0]=s,h[1]=s+e,u[0]=n/r,u[1]=t/r,this}stopWarping(){const n=this._timeScaleInterpolant;return n!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(n)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(n,t,e,i){if(!this.enabled){this._updateWeight(n);return}const s=this._startTime;if(s!==null){const h=(n-s)*e;if(h<0||e===0)return;this._startTime=null,t=e*h}t*=this._updateTimeScale(n);const r=this._updateTime(t),o=this._updateWeight(n);if(o>0){const h=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case AdditiveAnimationBlendMode:for(let p=0,d=h.length;p!==d;++p)h[p].evaluate(r),u[p].accumulateAdditive(o);break;case NormalAnimationBlendMode:default:for(let p=0,d=h.length;p!==d;++p)h[p].evaluate(r),u[p].accumulate(i,o)}}}_updateWeight(n){let t=0;if(this.enabled){t=this.weight;const e=this._weightInterpolant;if(e!==null){const i=e.evaluate(n)[0];t*=i,n>e.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(n){let t=0;if(!this.paused){t=this.timeScale;const e=this._timeScaleInterpolant;if(e!==null){const i=e.evaluate(n)[0];t*=i,n>e.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(n){const t=this._clip.duration,e=this.loop;let i=this.time+n,s=this._loopCount;const r=e===LoopPingPong;if(n===0)return s===-1?i:r&&(s&1)===1?t-i:i;if(e===LoopOnce){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break t}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:n<0?-1:1})}}else{if(s===-1&&(n>=0?(s=0,this._setEndings(!0,this.repetitions===0,r)):this._setEndings(this.repetitions===0,!0,r)),i>=t||i<0){const o=Math.floor(i/t);i-=t*o,s+=Math.abs(o);const h=this.repetitions-s;if(h<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=n>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:n>0?1:-1});else{if(h===1){const u=n<0;this._setEndings(u,!u,r)}else this._setEndings(!1,!1,r);this._loopCount=s,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=i;if(r&&(s&1)===1)return t-i}return i}_setEndings(n,t,e){const i=this._interpolantSettings;e?(i.endingStart=ZeroSlopeEnding,i.endingEnd=ZeroSlopeEnding):(n?i.endingStart=this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:i.endingStart=WrapAroundEnding,t?i.endingEnd=this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:i.endingEnd=WrapAroundEnding)}_scheduleFading(n,t,e){const i=this._mixer,s=i.time;let r=this._weightInterpolant;r===null&&(r=i._lendControlInterpolant(),this._weightInterpolant=r);const o=r.parameterPositions,h=r.sampleValues;return o[0]=s,h[0]=t,o[1]=s+n,h[1]=e,this}}class AnimationMixer extends EventDispatcher{constructor(n){super(),this._root=n,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(n,t){const e=n._localRoot||this._root,i=n._clip.tracks,s=i.length,r=n._propertyBindings,o=n._interpolants,h=e.uuid,u=this._bindingsByRootAndName;let p=u[h];p===void 0&&(p={},u[h]=p);for(let d=0;d!==s;++d){const f=i[d],g=f.name;let _=p[g];if(_!==void 0)r[d]=_;else{if(_=r[d],_!==void 0){_._cacheIndex===null&&(++_.referenceCount,this._addInactiveBinding(_,h,g));continue}const v=t&&t._propertyBindings[d].binding.parsedPath;_=new PropertyMixer(PropertyBinding.create(e,g,v),f.ValueTypeName,f.getValueSize()),++_.referenceCount,this._addInactiveBinding(_,h,g),r[d]=_}o[d].resultBuffer=_.buffer}}_activateAction(n){if(!this._isActiveAction(n)){if(n._cacheIndex===null){const e=(n._localRoot||this._root).uuid,i=n._clip.uuid,s=this._actionsByClip[i];this._bindAction(n,s&&s.knownActions[0]),this._addInactiveAction(n,i,e)}const t=n._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const s=t[e];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(n)}}_deactivateAction(n){if(this._isActiveAction(n)){const t=n._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const s=t[e];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(n)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const n=this;this.stats={actions:{get total(){return n._actions.length},get inUse(){return n._nActiveActions}},bindings:{get total(){return n._bindings.length},get inUse(){return n._nActiveBindings}},controlInterpolants:{get total(){return n._controlInterpolants.length},get inUse(){return n._nActiveControlInterpolants}}}}_isActiveAction(n){const t=n._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(n,t,e){const i=this._actions,s=this._actionsByClip;let r=s[t];if(r===void 0)r={knownActions:[n],actionByRoot:{}},n._byClipCacheIndex=0,s[t]=r;else{const o=r.knownActions;n._byClipCacheIndex=o.length,o.push(n)}n._cacheIndex=i.length,i.push(n),r.actionByRoot[e]=n}_removeInactiveAction(n){const t=this._actions,e=t[t.length-1],i=n._cacheIndex;e._cacheIndex=i,t[i]=e,t.pop(),n._cacheIndex=null;const s=n._clip.uuid,r=this._actionsByClip,o=r[s],h=o.knownActions,u=h[h.length-1],p=n._byClipCacheIndex;u._byClipCacheIndex=p,h[p]=u,h.pop(),n._byClipCacheIndex=null;const d=o.actionByRoot,f=(n._localRoot||this._root).uuid;delete d[f],h.length===0&&delete r[s],this._removeInactiveBindingsForAction(n)}_removeInactiveBindingsForAction(n){const t=n._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const s=t[e];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(n){const t=this._actions,e=n._cacheIndex,i=this._nActiveActions++,s=t[i];n._cacheIndex=i,t[i]=n,s._cacheIndex=e,t[e]=s}_takeBackAction(n){const t=this._actions,e=n._cacheIndex,i=--this._nActiveActions,s=t[i];n._cacheIndex=i,t[i]=n,s._cacheIndex=e,t[e]=s}_addInactiveBinding(n,t,e){const i=this._bindingsByRootAndName,s=this._bindings;let r=i[t];r===void 0&&(r={},i[t]=r),r[e]=n,n._cacheIndex=s.length,s.push(n)}_removeInactiveBinding(n){const t=this._bindings,e=n.binding,i=e.rootNode.uuid,s=e.path,r=this._bindingsByRootAndName,o=r[i],h=t[t.length-1],u=n._cacheIndex;h._cacheIndex=u,t[u]=h,t.pop(),delete o[s],Object.keys(o).length===0&&delete r[i]}_lendBinding(n){const t=this._bindings,e=n._cacheIndex,i=this._nActiveBindings++,s=t[i];n._cacheIndex=i,t[i]=n,s._cacheIndex=e,t[e]=s}_takeBackBinding(n){const t=this._bindings,e=n._cacheIndex,i=--this._nActiveBindings,s=t[i];n._cacheIndex=i,t[i]=n,s._cacheIndex=e,t[e]=s}_lendControlInterpolant(){const n=this._controlInterpolants,t=this._nActiveControlInterpolants++;let e=n[t];return e===void 0&&(e=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),e.__cacheIndex=t,n[t]=e),e}_takeBackControlInterpolant(n){const t=this._controlInterpolants,e=n.__cacheIndex,i=--this._nActiveControlInterpolants,s=t[i];n.__cacheIndex=i,t[i]=n,s.__cacheIndex=e,t[e]=s}clipAction(n,t,e){const i=t||this._root,s=i.uuid;let r=typeof n=="string"?AnimationClip.findByName(i,n):n;const o=r!==null?r.uuid:n,h=this._actionsByClip[o];let u=null;if(e===void 0&&(r!==null?e=r.blendMode:e=NormalAnimationBlendMode),h!==void 0){const d=h.actionByRoot[s];if(d!==void 0&&d.blendMode===e)return d;u=h.knownActions[0],r===null&&(r=u._clip)}if(r===null)return null;const p=new AnimationAction(this,r,t,e);return this._bindAction(p,u),this._addInactiveAction(p,o,s),p}existingAction(n,t){const e=t||this._root,i=e.uuid,s=typeof n=="string"?AnimationClip.findByName(e,n):n,r=s?s.uuid:n,o=this._actionsByClip[r];return o!==void 0&&o.actionByRoot[i]||null}stopAllAction(){const n=this._actions,t=this._nActiveActions;for(let e=t-1;e>=0;--e)n[e].stop();return this}update(n){n*=this.timeScale;const t=this._actions,e=this._nActiveActions,i=this.time+=n,s=Math.sign(n),r=this._accuIndex^=1;for(let u=0;u!==e;++u)t[u]._update(i,n,s,r);const o=this._bindings,h=this._nActiveBindings;for(let u=0;u!==h;++u)o[u].apply(r);return this}setTime(n){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(n)}getRoot(){return this._root}uncacheClip(n){const t=this._actions,e=n.uuid,i=this._actionsByClip,s=i[e];if(s!==void 0){const r=s.knownActions;for(let o=0,h=r.length;o!==h;++o){const u=r[o];this._deactivateAction(u);const p=u._cacheIndex,d=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,d._cacheIndex=p,t[p]=d,t.pop(),this._removeInactiveBindingsForAction(u)}delete i[e]}}uncacheRoot(n){const t=n.uuid,e=this._actionsByClip;for(const r in e){const o=e[r].actionByRoot,h=o[t];h!==void 0&&(this._deactivateAction(h),this._removeInactiveAction(h))}const i=this._bindingsByRootAndName,s=i[t];if(s!==void 0)for(const r in s){const o=s[r];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(n,t){const e=this.existingAction(n,t);e!==null&&(this._deactivateAction(e),this._removeInactiveAction(e))}}AnimationMixer.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class InstancedInterleavedBuffer extends InterleavedBuffer{constructor(n,t,e=1){super(n,t),this.meshPerAttribute=e||1}copy(n){return super.copy(n),this.meshPerAttribute=n.meshPerAttribute,this}clone(n){const t=super.clone(n);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(n){const t=super.toJSON(n);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}InstancedInterleavedBuffer.prototype.isInstancedInterleavedBuffer=!0;class Raycaster{constructor(n,t,e=0,i=1/0){this.ray=new Ray$1(n,t),this.near=e,this.far=i,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(n,t){this.ray.set(n,t)}setFromCamera(n,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(n.x,n.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(n.x,n.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(n,t=!1,e=[]){return intersectObject(n,this,e,t),e.sort(ascSort),e}intersectObjects(n,t=!1,e=[]){for(let i=0,s=n.length;i<s;i++)intersectObject(n[i],this,e,t);return e.sort(ascSort),e}}function ascSort(l,n){return l.distance-n.distance}function intersectObject(l,n,t,e){if(l.layers.test(n.layers)&&l.raycast(n,t),e===!0){const i=l.children;for(let s=0,r=i.length;s<r;s++)intersectObject(i[s],n,t,!0)}}class Spherical{constructor(n=1,t=0,e=0){return this.radius=n,this.phi=t,this.theta=e,this}set(n,t,e){return this.radius=n,this.phi=t,this.theta=e,this}copy(n){return this.radius=n.radius,this.phi=n.phi,this.theta=n.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(n){return this.setFromCartesianCoords(n.x,n.y,n.z)}setFromCartesianCoords(n,t,e){return this.radius=Math.sqrt(n*n+t*t+e*e),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(n,e),this.phi=Math.acos(clamp(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}const _startP=new Vector3,_startEnd=new Vector3;class Line3{constructor(n=new Vector3,t=new Vector3){this.start=n,this.end=t}set(n,t){return this.start.copy(n),this.end.copy(t),this}copy(n){return this.start.copy(n.start),this.end.copy(n.end),this}getCenter(n){return n===void 0&&(console.warn("THREE.Line3: .getCenter() target is now required"),n=new Vector3),n.addVectors(this.start,this.end).multiplyScalar(.5)}delta(n){return n===void 0&&(console.warn("THREE.Line3: .delta() target is now required"),n=new Vector3),n.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(n,t){return t===void 0&&(console.warn("THREE.Line3: .at() target is now required"),t=new Vector3),this.delta(t).multiplyScalar(n).add(this.start)}closestPointToPointParameter(n,t){_startP.subVectors(n,this.start),_startEnd.subVectors(this.end,this.start);const e=_startEnd.dot(_startEnd);let s=_startEnd.dot(_startP)/e;return t&&(s=clamp(s,0,1)),s}closestPointToPoint(n,t,e){const i=this.closestPointToPointParameter(n,t);return e===void 0&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),e=new Vector3),this.delta(e).multiplyScalar(i).add(this.start)}applyMatrix4(n){return this.start.applyMatrix4(n),this.end.applyMatrix4(n),this}equals(n){return n.start.equals(this.start)&&n.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}class ImmediateRenderObject extends Object3D{constructor(n){super(),this.material=n,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}ImmediateRenderObject.prototype.isImmediateRenderObject=!0;const _vector$2=new Vector3,_boneMatrix=new Matrix4,_matrixWorldInv=new Matrix4;class SkeletonHelper extends LineSegments{constructor(n){const t=getBoneList(n),e=new BufferGeometry,i=[],s=[],r=new Color(0,0,1),o=new Color(0,1,0);for(let u=0;u<t.length;u++){const p=t[u];p.parent&&p.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),s.push(r.r,r.g,r.b),s.push(o.r,o.g,o.b))}e.setAttribute("position",new Float32BufferAttribute(i,3)),e.setAttribute("color",new Float32BufferAttribute(s,3));const h=new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(e,h),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=n,this.bones=t,this.matrix=n.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(n){const t=this.bones,e=this.geometry,i=e.getAttribute("position");_matrixWorldInv.copy(this.root.matrixWorld).invert();for(let s=0,r=0;s<t.length;s++){const o=t[s];o.parent&&o.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,o.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),i.setXYZ(r,_vector$2.x,_vector$2.y,_vector$2.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,o.parent.matrixWorld),_vector$2.setFromMatrixPosition(_boneMatrix),i.setXYZ(r+1,_vector$2.x,_vector$2.y,_vector$2.z),r+=2)}e.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(n)}}function getBoneList(l){const n=[];l&&l.isBone&&n.push(l);for(let t=0;t<l.children.length;t++)n.push.apply(n,getBoneList(l.children[t]));return n}class GridHelper extends LineSegments{constructor(n=10,t=10,e=4473924,i=8947848){e=new Color(e),i=new Color(i);const s=t/2,r=n/t,o=n/2,h=[],u=[];for(let f=0,g=0,_=-o;f<=t;f++,_+=r){h.push(-o,0,_,o,0,_),h.push(_,0,-o,_,0,o);const v=f===s?e:i;v.toArray(u,g),g+=3,v.toArray(u,g),g+=3,v.toArray(u,g),g+=3,v.toArray(u,g),g+=3}const p=new BufferGeometry;p.setAttribute("position",new Float32BufferAttribute(h,3)),p.setAttribute("color",new Float32BufferAttribute(u,3));const d=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(p,d),this.type="GridHelper"}}const _floatView=new Float32Array(1);new Int32Array(_floatView.buffer);const backgroundMaterial=new MeshBasicMaterial({side:BackSide,depthWrite:!1,depthTest:!1});new Mesh(new BoxGeometry,backgroundMaterial);Curve.create=function(l,n){return console.log("THREE.Curve.create() has been deprecated"),l.prototype=Object.create(Curve.prototype),l.prototype.constructor=l,l.prototype.getPoint=n,l};Path.prototype.fromPoints=function(l){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(l)};GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Loader.prototype.extractUrlBase=function(l){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),LoaderUtils.extractUrlBase(l)};Loader.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};Box3.prototype.center=function(l){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(l)};Box3.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Box3.prototype.isIntersectionBox=function(l){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(l)};Box3.prototype.isIntersectionSphere=function(l){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(l)};Box3.prototype.size=function(l){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(l)};Sphere$1.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Frustum.prototype.setFromMatrix=function(l){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(l)};Line3.prototype.center=function(l){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(l)};Matrix3.prototype.flattenToArrayOffset=function(l,n){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(l,n)};Matrix3.prototype.multiplyVector3=function(l){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),l.applyMatrix3(this)};Matrix3.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};Matrix3.prototype.applyToBufferAttribute=function(l){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),l.applyMatrix3(this)};Matrix3.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};Matrix3.prototype.getInverse=function(l){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(l).invert()};Matrix4.prototype.extractPosition=function(l){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(l)};Matrix4.prototype.flattenToArrayOffset=function(l,n){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(l,n)};Matrix4.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new Vector3().setFromMatrixColumn(this,3)};Matrix4.prototype.setRotationFromQuaternion=function(l){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(l)};Matrix4.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};Matrix4.prototype.multiplyVector3=function(l){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),l.applyMatrix4(this)};Matrix4.prototype.multiplyVector4=function(l){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),l.applyMatrix4(this)};Matrix4.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};Matrix4.prototype.rotateAxis=function(l){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),l.transformDirection(this)};Matrix4.prototype.crossVector=function(l){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),l.applyMatrix4(this)};Matrix4.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};Matrix4.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};Matrix4.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};Matrix4.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};Matrix4.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};Matrix4.prototype.applyToBufferAttribute=function(l){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),l.applyMatrix4(this)};Matrix4.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};Matrix4.prototype.makeFrustum=function(l,n,t,e,i,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(l,n,e,t,i,s)};Matrix4.prototype.getInverse=function(l){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(l).invert()};Plane$1.prototype.isIntersectionLine=function(l){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(l)};Quaternion$1.prototype.multiplyVector3=function(l){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),l.applyQuaternion(this)};Quaternion$1.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};Ray$1.prototype.isIntersectionBox=function(l){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(l)};Ray$1.prototype.isIntersectionPlane=function(l){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(l)};Ray$1.prototype.isIntersectionSphere=function(l){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(l)};Triangle.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};Triangle.prototype.barycoordFromPoint=function(l,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(l,n)};Triangle.prototype.midpoint=function(l){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(l)};Triangle.prototypenormal=function(l){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(l)};Triangle.prototype.plane=function(l){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(l)};Triangle.barycoordFromPoint=function(l,n,t,e,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Triangle.getBarycoord(l,n,t,e,i)};Triangle.normal=function(l,n,t,e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Triangle.getNormal(l,n,t,e)};Shape$1.prototype.extractAllPoints=function(l){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(l)};Shape$1.prototype.extrude=function(l){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,l)};Shape$1.prototype.makeGeometry=function(l){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,l)};Vector2.prototype.fromAttribute=function(l,n,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(l,n,t)};Vector2.prototype.distanceToManhattan=function(l){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(l)};Vector2.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Vector3.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};Vector3.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};Vector3.prototype.getPositionFromMatrix=function(l){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(l)};Vector3.prototype.getScaleFromMatrix=function(l){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(l)};Vector3.prototype.getColumnFromMatrix=function(l,n){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(n,l)};Vector3.prototype.applyProjection=function(l){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(l)};Vector3.prototype.fromAttribute=function(l,n,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(l,n,t)};Vector3.prototype.distanceToManhattan=function(l){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(l)};Vector3.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Vector4.prototype.fromAttribute=function(l,n,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(l,n,t)};Vector4.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Object3D.prototype.getChildByName=function(l){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(l)};Object3D.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};Object3D.prototype.translate=function(l,n){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(n,l)};Object3D.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};Object3D.prototype.applyMatrix=function(l){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(l)};Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(l){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=l}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Mesh.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(Mesh.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),TrianglesDrawMode},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});SkinnedMesh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};PerspectiveCamera.prototype.setLens=function(l,n){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),n!==void 0&&(this.filmGauge=n),this.setFocalLength(l)};Object.defineProperties(Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(l){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=l}},shadowCameraLeft:{set:function(l){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=l}},shadowCameraRight:{set:function(l){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=l}},shadowCameraTop:{set:function(l){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=l}},shadowCameraBottom:{set:function(l){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=l}},shadowCameraNear:{set:function(l){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=l}},shadowCameraFar:{set:function(l){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=l}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(l){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=l}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(l){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=l}},shadowMapHeight:{set:function(l){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=l}}});Object.defineProperties(BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===DynamicDrawUsage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(DynamicDrawUsage)}}});BufferAttribute.prototype.setDynamic=function(l){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(l===!0?DynamicDrawUsage:StaticDrawUsage),this};BufferAttribute.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},BufferAttribute.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};BufferGeometry.prototype.addIndex=function(l){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(l)};BufferGeometry.prototype.addAttribute=function(l,n){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(n&&n.isBufferAttribute)&&!(n&&n.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(l,new BufferAttribute(arguments[1],arguments[2]))):l==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(n),this):this.setAttribute(l,n)};BufferGeometry.prototype.addDrawCall=function(l,n,t){t!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(l,n)};BufferGeometry.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};BufferGeometry.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};BufferGeometry.prototype.removeAttribute=function(l){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(l)};BufferGeometry.prototype.applyMatrix=function(l){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(l)};Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});InterleavedBuffer.prototype.setDynamic=function(l){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(l===!0?DynamicDrawUsage:StaticDrawUsage),this};InterleavedBuffer.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};ExtrudeGeometry.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};ExtrudeGeometry.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};ExtrudeGeometry.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};Scene.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};Object.defineProperties(Material$1.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Color}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(l){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=l===FlatShading}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(l){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=l}}});Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(l){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=l}}});WebGLRenderer.prototype.clearTarget=function(l,n,t,e){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(l),this.clear(n,t,e)};WebGLRenderer.prototype.animate=function(l){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(l)};WebGLRenderer.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};WebGLRenderer.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};WebGLRenderer.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};WebGLRenderer.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};WebGLRenderer.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};WebGLRenderer.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};WebGLRenderer.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};WebGLRenderer.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};WebGLRenderer.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};WebGLRenderer.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};WebGLRenderer.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};WebGLRenderer.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};WebGLRenderer.prototype.enableScissorTest=function(l){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(l)};WebGLRenderer.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};WebGLRenderer.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};WebGLRenderer.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};WebGLRenderer.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};WebGLRenderer.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};WebGLRenderer.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};WebGLRenderer.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};WebGLRenderer.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};WebGLRenderer.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};WebGLRenderer.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(l){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=l}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(l){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=l}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(l){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=l===!0?sRGBEncoding:LinearEncoding}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}});Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(l){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=l}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(l){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=l}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(l){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=l}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(l){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=l}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(l){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=l}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(l){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=l}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(l){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=l}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(l){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=l}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(l){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=l}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(l){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=l}}});Audio.prototype.load=function(l){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const n=this;return new AudioLoader().load(l,function(e){n.setBuffer(e)}),this};CubeCamera.prototype.updateCubeMap=function(l,n){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(l,n)};CubeCamera.prototype.clear=function(l,n,t,e){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(l,n,t,e)};ImageUtils.crossOrigin=void 0;ImageUtils.loadTexture=function(l,n,t,e){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new TextureLoader;i.setCrossOrigin(this.crossOrigin);const s=i.load(l,t,void 0,e);return n&&(s.mapping=n),s};ImageUtils.loadTextureCube=function(l,n,t,e){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new CubeTextureLoader;i.setCrossOrigin(this.crossOrigin);const s=i.load(l,t,void 0,e);return n&&(s.mapping=n),s};ImageUtils.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};ImageUtils.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);class Mat3{constructor(n=[0,0,0,0,0,0,0,0,0]){this.elements=void 0,this.elements=n}identity(){const n=this.elements;n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1}setZero(){const n=this.elements;n[0]=0,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=0,n[6]=0,n[7]=0,n[8]=0}setTrace(n){const t=this.elements;t[0]=n.x,t[4]=n.y,t[8]=n.z}getTrace(n=new Vec3){const t=this.elements;return n.x=t[0],n.y=t[4],n.z=t[8],n}vmult(n,t=new Vec3){const e=this.elements,i=n.x,s=n.y,r=n.z;return t.x=e[0]*i+e[1]*s+e[2]*r,t.y=e[3]*i+e[4]*s+e[5]*r,t.z=e[6]*i+e[7]*s+e[8]*r,t}smult(n){for(let t=0;t<this.elements.length;t++)this.elements[t]*=n}mmult(n,t=new Mat3){const e=this.elements,i=n.elements,s=t.elements,r=e[0],o=e[1],h=e[2],u=e[3],p=e[4],d=e[5],f=e[6],g=e[7],_=e[8],v=i[0],y=i[1],E=i[2],m=i[3],x=i[4],C=i[5],O=i[6],S=i[7],P=i[8];return s[0]=r*v+o*m+h*O,s[1]=r*y+o*x+h*S,s[2]=r*E+o*C+h*P,s[3]=u*v+p*m+d*O,s[4]=u*y+p*x+d*S,s[5]=u*E+p*C+d*P,s[6]=f*v+g*m+_*O,s[7]=f*y+g*x+_*S,s[8]=f*E+g*C+_*P,t}scale(n,t=new Mat3){const e=this.elements,i=t.elements;for(let s=0;s!==3;s++)i[3*s+0]=n.x*e[3*s+0],i[3*s+1]=n.y*e[3*s+1],i[3*s+2]=n.z*e[3*s+2];return t}solve(n,t=new Vec3){const s=[];let r,o;for(r=0;r<12;r++)s.push(0);for(r=0;r<3;r++)for(o=0;o<3;o++)s[r+4*o]=this.elements[r+3*o];s[3]=n.x,s[7]=n.y,s[11]=n.z;let h=3;const u=h;let p;const d=4;let f;do{if(r=u-h,s[r+4*r]===0){for(o=r+1;o<u;o++)if(s[r+4*o]!==0){p=d;do f=d-p,s[f+4*r]+=s[f+4*o];while(--p);break}}if(s[r+4*r]!==0)for(o=r+1;o<u;o++){const g=s[r+4*o]/s[r+4*r];p=d;do f=d-p,s[f+4*o]=f<=r?0:s[f+4*o]-s[f+4*r]*g;while(--p)}}while(--h);if(t.z=s[11]/s[10],t.y=(s[7]-s[6]*t.z)/s[5],t.x=(s[3]-s[2]*t.z-s[1]*t.y)/s[0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw"Could not solve equation! Got x=["+t.toString()+"], b=["+n.toString()+"], A=["+this.toString()+"]";return t}e(n,t,e){if(e===void 0)return this.elements[t+3*n];this.elements[t+3*n]=e}copy(n){for(let t=0;t<n.elements.length;t++)this.elements[t]=n.elements[t];return this}toString(){let n="";for(let e=0;e<9;e++)n+=this.elements[e]+",";return n}reverse(n=new Mat3){const i=reverse_eqns;let s,r;for(s=0;s<3;s++)for(r=0;r<3;r++)i[s+6*r]=this.elements[s+3*r];i[3]=1,i[9]=0,i[15]=0,i[4]=0,i[10]=1,i[16]=0,i[5]=0,i[11]=0,i[17]=1;let o=3;const h=o;let u;const p=6;let d;do{if(s=h-o,i[s+6*s]===0){for(r=s+1;r<h;r++)if(i[s+6*r]!==0){u=p;do d=p-u,i[d+6*s]+=i[d+6*r];while(--u);break}}if(i[s+6*s]!==0)for(r=s+1;r<h;r++){const f=i[s+6*r]/i[s+6*s];u=p;do d=p-u,i[d+6*r]=d<=s?0:i[d+6*r]-i[d+6*s]*f;while(--u)}}while(--o);s=2;do{r=s-1;do{const f=i[s+6*r]/i[s+6*s];u=6;do d=6-u,i[d+6*r]=i[d+6*r]-i[d+6*s]*f;while(--u)}while(r--)}while(--s);s=2;do{const f=1/i[s+6*s];u=6;do d=6-u,i[d+6*s]=i[d+6*s]*f;while(--u)}while(s--);s=2;do{r=2;do{if(d=i[3+r+6*s],isNaN(d)||d===1/0)throw"Could not reverse! A=["+this.toString()+"]";n.e(s,r,d)}while(r--)}while(s--);return n}setRotationFromQuaternion(n){const t=n.x,e=n.y,i=n.z,s=n.w,r=t+t,o=e+e,h=i+i,u=t*r,p=t*o,d=t*h,f=e*o,g=e*h,_=i*h,v=s*r,y=s*o,E=s*h,m=this.elements;return m[0]=1-(f+_),m[1]=p-E,m[2]=d+y,m[3]=p+E,m[4]=1-(u+_),m[5]=g-v,m[6]=d-y,m[7]=g+v,m[8]=1-(u+f),this}transpose(n=new Mat3){const t=this.elements,e=n.elements;let i;return e[0]=t[0],e[4]=t[4],e[8]=t[8],i=t[1],e[1]=t[3],e[3]=i,i=t[2],e[2]=t[6],e[6]=i,i=t[5],e[5]=t[7],e[7]=i,n}}const reverse_eqns=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class Vec3{constructor(n=0,t=0,e=0){this.x=void 0,this.y=void 0,this.z=void 0,this.x=n,this.y=t,this.z=e}cross(n,t=new Vec3){const e=n.x,i=n.y,s=n.z,r=this.x,o=this.y,h=this.z;return t.x=o*s-h*i,t.y=h*e-r*s,t.z=r*i-o*e,t}set(n,t,e){return this.x=n,this.y=t,this.z=e,this}setZero(){this.x=this.y=this.z=0}vadd(n,t){if(t)t.x=n.x+this.x,t.y=n.y+this.y,t.z=n.z+this.z;else return new Vec3(this.x+n.x,this.y+n.y,this.z+n.z)}vsub(n,t){if(t)t.x=this.x-n.x,t.y=this.y-n.y,t.z=this.z-n.z;else return new Vec3(this.x-n.x,this.y-n.y,this.z-n.z)}crossmat(){return new Mat3([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const n=this.x,t=this.y,e=this.z,i=Math.sqrt(n*n+t*t+e*e);if(i>0){const s=1/i;this.x*=s,this.y*=s,this.z*=s}else this.x=0,this.y=0,this.z=0;return i}unit(n=new Vec3){const t=this.x,e=this.y,i=this.z;let s=Math.sqrt(t*t+e*e+i*i);return s>0?(s=1/s,n.x=t*s,n.y=e*s,n.z=i*s):(n.x=1,n.y=0,n.z=0),n}length(){const n=this.x,t=this.y,e=this.z;return Math.sqrt(n*n+t*t+e*e)}lengthSquared(){return this.dot(this)}distanceTo(n){const t=this.x,e=this.y,i=this.z,s=n.x,r=n.y,o=n.z;return Math.sqrt((s-t)*(s-t)+(r-e)*(r-e)+(o-i)*(o-i))}distanceSquared(n){const t=this.x,e=this.y,i=this.z,s=n.x,r=n.y,o=n.z;return(s-t)*(s-t)+(r-e)*(r-e)+(o-i)*(o-i)}scale(n,t=new Vec3){const e=this.x,i=this.y,s=this.z;return t.x=n*e,t.y=n*i,t.z=n*s,t}vmul(n,t=new Vec3){return t.x=n.x*this.x,t.y=n.y*this.y,t.z=n.z*this.z,t}addScaledVector(n,t,e=new Vec3){return e.x=this.x+n*t.x,e.y=this.y+n*t.y,e.z=this.z+n*t.z,e}dot(n){return this.x*n.x+this.y*n.y+this.z*n.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(n=new Vec3){return n.x=-this.x,n.y=-this.y,n.z=-this.z,n}tangents(n,t){const e=this.length();if(e>0){const i=Vec3_tangents_n,s=1/e;i.set(this.x*s,this.y*s,this.z*s);const r=Vec3_tangents_randVec;Math.abs(i.x)<.9?(r.set(1,0,0),i.cross(r,n)):(r.set(0,1,0),i.cross(r,n)),i.cross(n,t)}else n.set(1,0,0),t.set(0,1,0)}toString(){return this.x+","+this.y+","+this.z}toArray(){return[this.x,this.y,this.z]}copy(n){return this.x=n.x,this.y=n.y,this.z=n.z,this}lerp(n,t,e){const i=this.x,s=this.y,r=this.z;e.x=i+(n.x-i)*t,e.y=s+(n.y-s)*t,e.z=r+(n.z-r)*t}almostEquals(n,t=1e-6){return!(Math.abs(this.x-n.x)>t||Math.abs(this.y-n.y)>t||Math.abs(this.z-n.z)>t)}almostZero(n=1e-6){return!(Math.abs(this.x)>n||Math.abs(this.y)>n||Math.abs(this.z)>n)}isAntiparallelTo(n,t){return this.negate(antip_neg),antip_neg.almostEquals(n,t)}clone(){return new Vec3(this.x,this.y,this.z)}}Vec3.ZERO=void 0;Vec3.UNIT_X=void 0;Vec3.UNIT_Y=void 0;Vec3.UNIT_Z=void 0;Vec3.ZERO=new Vec3(0,0,0);Vec3.UNIT_X=new Vec3(1,0,0);Vec3.UNIT_Y=new Vec3(0,1,0);Vec3.UNIT_Z=new Vec3(0,0,1);const Vec3_tangents_n=new Vec3,Vec3_tangents_randVec=new Vec3,antip_neg=new Vec3;class AABB{constructor(n={}){this.lowerBound=void 0,this.upperBound=void 0,this.lowerBound=new Vec3,this.upperBound=new Vec3,n.lowerBound&&this.lowerBound.copy(n.lowerBound),n.upperBound&&this.upperBound.copy(n.upperBound)}setFromPoints(n,t,e,i){const s=this.lowerBound,r=this.upperBound,o=e;s.copy(n[0]),o&&o.vmult(s,s),r.copy(s);for(let h=1;h<n.length;h++){let u=n[h];o&&(o.vmult(u,tmp$1),u=tmp$1),u.x>r.x&&(r.x=u.x),u.x<s.x&&(s.x=u.x),u.y>r.y&&(r.y=u.y),u.y<s.y&&(s.y=u.y),u.z>r.z&&(r.z=u.z),u.z<s.z&&(s.z=u.z)}return t&&(t.vadd(s,s),t.vadd(r,r)),i&&(s.x-=i,s.y-=i,s.z-=i,r.x+=i,r.y+=i,r.z+=i),this}copy(n){return this.lowerBound.copy(n.lowerBound),this.upperBound.copy(n.upperBound),this}clone(){return new AABB().copy(this)}extend(n){this.lowerBound.x=Math.min(this.lowerBound.x,n.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,n.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,n.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,n.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,n.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,n.upperBound.z)}overlaps(n){const t=this.lowerBound,e=this.upperBound,i=n.lowerBound,s=n.upperBound,r=i.x<=e.x&&e.x<=s.x||t.x<=s.x&&s.x<=e.x,o=i.y<=e.y&&e.y<=s.y||t.y<=s.y&&s.y<=e.y,h=i.z<=e.z&&e.z<=s.z||t.z<=s.z&&s.z<=e.z;return r&&o&&h}volume(){const n=this.lowerBound,t=this.upperBound;return(t.x-n.x)*(t.y-n.y)*(t.z-n.z)}contains(n){const t=this.lowerBound,e=this.upperBound,i=n.lowerBound,s=n.upperBound;return t.x<=i.x&&e.x>=s.x&&t.y<=i.y&&e.y>=s.y&&t.z<=i.z&&e.z>=s.z}getCorners(n,t,e,i,s,r,o,h){const u=this.lowerBound,p=this.upperBound;n.copy(u),t.set(p.x,u.y,u.z),e.set(p.x,p.y,u.z),i.set(u.x,p.y,p.z),s.set(p.x,u.y,p.z),r.set(u.x,p.y,u.z),o.set(u.x,u.y,p.z),h.copy(p)}toLocalFrame(n,t){const e=transformIntoFrame_corners,i=e[0],s=e[1],r=e[2],o=e[3],h=e[4],u=e[5],p=e[6],d=e[7];this.getCorners(i,s,r,o,h,u,p,d);for(let f=0;f!==8;f++){const g=e[f];n.pointToLocal(g,g)}return t.setFromPoints(e)}toWorldFrame(n,t){const e=transformIntoFrame_corners,i=e[0],s=e[1],r=e[2],o=e[3],h=e[4],u=e[5],p=e[6],d=e[7];this.getCorners(i,s,r,o,h,u,p,d);for(let f=0;f!==8;f++){const g=e[f];n.pointToWorld(g,g)}return t.setFromPoints(e)}overlapsRay(n){const{direction:t,from:e}=n,i=1/t.x,s=1/t.y,r=1/t.z,o=(this.lowerBound.x-e.x)*i,h=(this.upperBound.x-e.x)*i,u=(this.lowerBound.y-e.y)*s,p=(this.upperBound.y-e.y)*s,d=(this.lowerBound.z-e.z)*r,f=(this.upperBound.z-e.z)*r,g=Math.max(Math.max(Math.min(o,h),Math.min(u,p)),Math.min(d,f)),_=Math.min(Math.min(Math.max(o,h),Math.max(u,p)),Math.max(d,f));return!(_<0||g>_)}}const tmp$1=new Vec3,transformIntoFrame_corners=[new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3];class ArrayCollisionMatrix{constructor(){this.matrix=void 0,this.matrix=[]}get(n,t){let{index:e}=n,{index:i}=t;if(i>e){const s=i;i=e,e=s}return this.matrix[(e*(e+1)>>1)+i-1]}set(n,t,e){let{index:i}=n,{index:s}=t;if(s>i){const r=s;s=i,i=r}this.matrix[(i*(i+1)>>1)+s-1]=e?1:0}reset(){for(let n=0,t=this.matrix.length;n!==t;n++)this.matrix[n]=0}setNumObjects(n){this.matrix.length=n*(n-1)>>1}}class EventTarget{constructor(){this._listeners=void 0}addEventListener(n,t){this._listeners===void 0&&(this._listeners={});const e=this._listeners;return e[n]===void 0&&(e[n]=[]),e[n].includes(t)||e[n].push(t),this}hasEventListener(n,t){if(this._listeners===void 0)return!1;const e=this._listeners;return!!(e[n]!==void 0&&e[n].includes(t))}hasAnyEventListener(n){return this._listeners===void 0?!1:this._listeners[n]!==void 0}removeEventListener(n,t){if(this._listeners===void 0)return this;const e=this._listeners;if(e[n]===void 0)return this;const i=e[n].indexOf(t);return i!==-1&&e[n].splice(i,1),this}dispatchEvent(n){if(this._listeners===void 0)return this;const e=this._listeners[n.type];if(e!==void 0){n.target=this;for(let i=0,s=e.length;i<s;i++)e[i].call(this,n)}return this}}class Quaternion{constructor(n=0,t=0,e=0,i=1){this.x=void 0,this.y=void 0,this.z=void 0,this.w=void 0,this.x=n,this.y=t,this.z=e,this.w=i}set(n,t,e,i){return this.x=n,this.y=t,this.z=e,this.w=i,this}toString(){return this.x+","+this.y+","+this.z+","+this.w}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(n,t){const e=Math.sin(t*.5);return this.x=n.x*e,this.y=n.y*e,this.z=n.z*e,this.w=Math.cos(t*.5),this}toAxisAngle(n=new Vec3){this.normalize();const t=2*Math.acos(this.w),e=Math.sqrt(1-this.w*this.w);return e<.001?(n.x=this.x,n.y=this.y,n.z=this.z):(n.x=this.x/e,n.y=this.y/e,n.z=this.z/e),[n,t]}setFromVectors(n,t){if(n.isAntiparallelTo(t)){const e=sfv_t1,i=sfv_t2;n.tangents(e,i),this.setFromAxisAngle(e,Math.PI)}else{const e=n.cross(t);this.x=e.x,this.y=e.y,this.z=e.z,this.w=Math.sqrt(n.length()**2*t.length()**2)+n.dot(t),this.normalize()}return this}mult(n,t=new Quaternion){const e=this.x,i=this.y,s=this.z,r=this.w,o=n.x,h=n.y,u=n.z,p=n.w;return t.x=e*p+r*o+i*u-s*h,t.y=i*p+r*h+s*o-e*u,t.z=s*p+r*u+e*h-i*o,t.w=r*p-e*o-i*h-s*u,t}inverse(n=new Quaternion){const t=this.x,e=this.y,i=this.z,s=this.w;this.conjugate(n);const r=1/(t*t+e*e+i*i+s*s);return n.x*=r,n.y*=r,n.z*=r,n.w*=r,n}conjugate(n=new Quaternion){return n.x=-this.x,n.y=-this.y,n.z=-this.z,n.w=this.w,n}normalize(){let n=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return n===0?(this.x=0,this.y=0,this.z=0,this.w=0):(n=1/n,this.x*=n,this.y*=n,this.z*=n,this.w*=n),this}normalizeFast(){const n=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return n===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=n,this.y*=n,this.z*=n,this.w*=n),this}vmult(n,t=new Vec3){const e=n.x,i=n.y,s=n.z,r=this.x,o=this.y,h=this.z,u=this.w,p=u*e+o*s-h*i,d=u*i+h*e-r*s,f=u*s+r*i-o*e,g=-r*e-o*i-h*s;return t.x=p*u+g*-r+d*-h-f*-o,t.y=d*u+g*-o+f*-r-p*-h,t.z=f*u+g*-h+p*-o-d*-r,t}copy(n){return this.x=n.x,this.y=n.y,this.z=n.z,this.w=n.w,this}toEuler(n,t="YZX"){let e,i,s;const r=this.x,o=this.y,h=this.z,u=this.w;switch(t){case"YZX":const p=r*o+h*u;if(p>.499&&(e=2*Math.atan2(r,u),i=Math.PI/2,s=0),p<-.499&&(e=-2*Math.atan2(r,u),i=-Math.PI/2,s=0),e===void 0){const d=r*r,f=o*o,g=h*h;e=Math.atan2(2*o*u-2*r*h,1-2*f-2*g),i=Math.asin(2*p),s=Math.atan2(2*r*u-2*o*h,1-2*d-2*g)}break;default:throw new Error("Euler order "+t+" not supported yet.")}n.y=e,n.z=i,n.x=s}setFromEuler(n,t,e,i="XYZ"){const s=Math.cos(n/2),r=Math.cos(t/2),o=Math.cos(e/2),h=Math.sin(n/2),u=Math.sin(t/2),p=Math.sin(e/2);return i==="XYZ"?(this.x=h*r*o+s*u*p,this.y=s*u*o-h*r*p,this.z=s*r*p+h*u*o,this.w=s*r*o-h*u*p):i==="YXZ"?(this.x=h*r*o+s*u*p,this.y=s*u*o-h*r*p,this.z=s*r*p-h*u*o,this.w=s*r*o+h*u*p):i==="ZXY"?(this.x=h*r*o-s*u*p,this.y=s*u*o+h*r*p,this.z=s*r*p+h*u*o,this.w=s*r*o-h*u*p):i==="ZYX"?(this.x=h*r*o-s*u*p,this.y=s*u*o+h*r*p,this.z=s*r*p-h*u*o,this.w=s*r*o+h*u*p):i==="YZX"?(this.x=h*r*o+s*u*p,this.y=s*u*o+h*r*p,this.z=s*r*p-h*u*o,this.w=s*r*o-h*u*p):i==="XZY"&&(this.x=h*r*o-s*u*p,this.y=s*u*o-h*r*p,this.z=s*r*p+h*u*o,this.w=s*r*o+h*u*p),this}clone(){return new Quaternion(this.x,this.y,this.z,this.w)}slerp(n,t,e=new Quaternion){const i=this.x,s=this.y,r=this.z,o=this.w;let h=n.x,u=n.y,p=n.z,d=n.w,f,g,_,v,y;return g=i*h+s*u+r*p+o*d,g<0&&(g=-g,h=-h,u=-u,p=-p,d=-d),1-g>1e-6?(f=Math.acos(g),_=Math.sin(f),v=Math.sin((1-t)*f)/_,y=Math.sin(t*f)/_):(v=1-t,y=t),e.x=v*i+y*h,e.y=v*s+y*u,e.z=v*r+y*p,e.w=v*o+y*d,e}integrate(n,t,e,i=new Quaternion){const s=n.x*e.x,r=n.y*e.y,o=n.z*e.z,h=this.x,u=this.y,p=this.z,d=this.w,f=t*.5;return i.x+=f*(s*d+r*p-o*u),i.y+=f*(r*d+o*h-s*p),i.z+=f*(o*d+s*u-r*h),i.w+=f*(-s*h-r*u-o*p),i}}const sfv_t1=new Vec3,sfv_t2=new Vec3,SHAPE_TYPES={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Shape{constructor(n={}){this.id=void 0,this.type=void 0,this.boundingSphereRadius=void 0,this.collisionResponse=void 0,this.collisionFilterGroup=void 0,this.collisionFilterMask=void 0,this.material=void 0,this.body=void 0,this.id=Shape.idCounter++,this.type=n.type||0,this.boundingSphereRadius=0,this.collisionResponse=n.collisionResponse?n.collisionResponse:!0,this.collisionFilterGroup=n.collisionFilterGroup!==void 0?n.collisionFilterGroup:1,this.collisionFilterMask=n.collisionFilterMask!==void 0?n.collisionFilterMask:-1,this.material=n.material?n.material:null,this.body=null}updateBoundingSphereRadius(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type}volume(){throw"volume() not implemented for shape type "+this.type}calculateLocalInertia(n,t){throw"calculateLocalInertia() not implemented for shape type "+this.type}calculateWorldAABB(n,t,e,i){throw"calculateWorldAABB() not implemented for shape type "+this.type}}Shape.idCounter=0;Shape.types=SHAPE_TYPES;class Transform{constructor(n={}){this.position=void 0,this.quaternion=void 0,this.position=new Vec3,this.quaternion=new Quaternion,n.position&&this.position.copy(n.position),n.quaternion&&this.quaternion.copy(n.quaternion)}pointToLocal(n,t){return Transform.pointToLocalFrame(this.position,this.quaternion,n,t)}pointToWorld(n,t){return Transform.pointToWorldFrame(this.position,this.quaternion,n,t)}vectorToWorldFrame(n,t=new Vec3){return this.quaternion.vmult(n,t),t}static pointToLocalFrame(n,t,e,i=new Vec3){return e.vsub(n,i),t.conjugate(tmpQuat$1),tmpQuat$1.vmult(i,i),i}static pointToWorldFrame(n,t,e,i=new Vec3){return t.vmult(e,i),i.vadd(n,i),i}static vectorToWorldFrame(n,t,e=new Vec3){return n.vmult(t,e),e}static vectorToLocalFrame(n,t,e,i=new Vec3){return t.w*=-1,t.vmult(e,i),t.w*=-1,i}}const tmpQuat$1=new Quaternion;class ConvexPolyhedron extends Shape{constructor(n={}){const{vertices:t=[],faces:e=[],normals:i=[],axes:s,boundingSphereRadius:r}=n;super({type:Shape.types.CONVEXPOLYHEDRON}),this.vertices=void 0,this.faces=void 0,this.faceNormals=void 0,this.worldVertices=void 0,this.worldVerticesNeedsUpdate=void 0,this.worldFaceNormals=void 0,this.worldFaceNormalsNeedsUpdate=void 0,this.uniqueAxes=void 0,this.uniqueEdges=void 0,this.vertices=t,this.faces=e,this.faceNormals=i,this.faceNormals.length===0&&this.computeNormals(),r?this.boundingSphereRadius=r:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=s?s.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const n=this.faces,t=this.vertices,e=this.uniqueEdges;e.length=0;const i=new Vec3;for(let s=0;s!==n.length;s++){const r=n[s],o=r.length;for(let h=0;h!==o;h++){const u=(h+1)%o;t[r[h]].vsub(t[r[u]],i),i.normalize();let p=!1;for(let d=0;d!==e.length;d++)if(e[d].almostEquals(i)||e[d].almostEquals(i)){p=!0;break}p||e.push(i.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let n=0;n<this.faces.length;n++){for(let i=0;i<this.faces[n].length;i++)if(!this.vertices[this.faces[n][i]])throw new Error("Vertex "+this.faces[n][i]+" not found!");const t=this.faceNormals[n]||new Vec3;this.getFaceNormal(n,t),t.negate(t),this.faceNormals[n]=t;const e=this.vertices[this.faces[n][0]];if(t.dot(e)<0){console.error(".faceNormals["+n+"] = Vec3("+t.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(let i=0;i<this.faces[n].length;i++)console.warn(".vertices["+this.faces[n][i]+"] = Vec3("+this.vertices[this.faces[n][i]].toString()+")")}}}getFaceNormal(n,t){const e=this.faces[n],i=this.vertices[e[0]],s=this.vertices[e[1]],r=this.vertices[e[2]];ConvexPolyhedron.computeNormal(i,s,r,t)}static computeNormal(n,t,e,i){const s=new Vec3,r=new Vec3;t.vsub(n,r),e.vsub(t,s),s.cross(r,i),i.isZero()||i.normalize()}clipAgainstHull(n,t,e,i,s,r,o,h,u){const p=new Vec3;let d=-1,f=-Number.MAX_VALUE;for(let _=0;_<e.faces.length;_++){p.copy(e.faceNormals[_]),s.vmult(p,p);const v=p.dot(r);v>f&&(f=v,d=_)}const g=[];for(let _=0;_<e.faces[d].length;_++){const v=e.vertices[e.faces[d][_]],y=new Vec3;y.copy(v),s.vmult(y,y),i.vadd(y,y),g.push(y)}d>=0&&this.clipFaceAgainstHull(r,n,t,g,o,h,u)}findSeparatingAxis(n,t,e,i,s,r,o,h){const u=new Vec3,p=new Vec3,d=new Vec3,f=new Vec3,g=new Vec3,_=new Vec3;let v=Number.MAX_VALUE;const y=this;if(y.uniqueAxes)for(let E=0;E!==y.uniqueAxes.length;E++){e.vmult(y.uniqueAxes[E],u);const m=y.testSepAxis(u,n,t,e,i,s);if(m===!1)return!1;m<v&&(v=m,r.copy(u))}else{const E=o?o.length:y.faces.length;for(let m=0;m<E;m++){const x=o?o[m]:m;u.copy(y.faceNormals[x]),e.vmult(u,u);const C=y.testSepAxis(u,n,t,e,i,s);if(C===!1)return!1;C<v&&(v=C,r.copy(u))}}if(n.uniqueAxes)for(let E=0;E!==n.uniqueAxes.length;E++){s.vmult(n.uniqueAxes[E],p);const m=y.testSepAxis(p,n,t,e,i,s);if(m===!1)return!1;m<v&&(v=m,r.copy(p))}else{const E=h?h.length:n.faces.length;for(let m=0;m<E;m++){const x=h?h[m]:m;p.copy(n.faceNormals[x]),s.vmult(p,p);const C=y.testSepAxis(p,n,t,e,i,s);if(C===!1)return!1;C<v&&(v=C,r.copy(p))}}for(let E=0;E!==y.uniqueEdges.length;E++){e.vmult(y.uniqueEdges[E],f);for(let m=0;m!==n.uniqueEdges.length;m++)if(s.vmult(n.uniqueEdges[m],g),f.cross(g,_),!_.almostZero()){_.normalize();const x=y.testSepAxis(_,n,t,e,i,s);if(x===!1)return!1;x<v&&(v=x,r.copy(_))}}return i.vsub(t,d),d.dot(r)>0&&r.negate(r),!0}testSepAxis(n,t,e,i,s,r){const o=this;ConvexPolyhedron.project(o,n,e,i,maxminA),ConvexPolyhedron.project(t,n,s,r,maxminB);const h=maxminA[0],u=maxminA[1],p=maxminB[0],d=maxminB[1];if(h<d||p<u)return!1;const f=h-d,g=p-u;return f<g?f:g}calculateLocalInertia(n,t){const e=new Vec3,i=new Vec3;this.computeLocalAABB(i,e);const s=e.x-i.x,r=e.y-i.y,o=e.z-i.z;t.x=1/12*n*(2*r*2*r+2*o*2*o),t.y=1/12*n*(2*s*2*s+2*o*2*o),t.z=1/12*n*(2*r*2*r+2*s*2*s)}getPlaneConstantOfFace(n){const t=this.faces[n],e=this.faceNormals[n],i=this.vertices[t[0]];return-e.dot(i)}clipFaceAgainstHull(n,t,e,i,s,r,o){const h=new Vec3,u=new Vec3,p=new Vec3,d=new Vec3,f=new Vec3,g=new Vec3,_=new Vec3,v=new Vec3,y=this,E=[],m=i,x=E;let C=-1,O=Number.MAX_VALUE;for(let N=0;N<y.faces.length;N++){h.copy(y.faceNormals[N]),e.vmult(h,h);const B=h.dot(n);B<O&&(O=B,C=N)}if(C<0)return;const S=y.faces[C];S.connectedFaces=[];for(let N=0;N<y.faces.length;N++)for(let B=0;B<y.faces[N].length;B++)S.indexOf(y.faces[N][B])!==-1&&N!==C&&S.connectedFaces.indexOf(N)===-1&&S.connectedFaces.push(N);const P=S.length;for(let N=0;N<P;N++){const B=y.vertices[S[N]],W=y.vertices[S[(N+1)%P]];B.vsub(W,u),p.copy(u),e.vmult(p,p),t.vadd(p,p),d.copy(this.faceNormals[C]),e.vmult(d,d),t.vadd(d,d),p.cross(d,f),f.negate(f),g.copy(B),e.vmult(g,g),t.vadd(g,g);const A=S.connectedFaces[N];_.copy(this.faceNormals[A]);const G=this.getPlaneConstantOfFace(A);v.copy(_),e.vmult(v,v);const D=G-v.dot(t);for(this.clipFaceAgainstPlane(m,x,v,D);m.length;)m.shift();for(;x.length;)m.push(x.shift())}_.copy(this.faceNormals[C]);const F=this.getPlaneConstantOfFace(C);v.copy(_),e.vmult(v,v);const V=F-v.dot(t);for(let N=0;N<m.length;N++){let B=v.dot(m[N])+V;if(B<=s&&(console.log("clamped: depth="+B+" to minDist="+s),B=s),B<=r){const W=m[N];if(B<=1e-6){const A={point:W,normal:v,depth:B};o.push(A)}}}}clipFaceAgainstPlane(n,t,e,i){let s,r;const o=n.length;if(o<2)return t;let h=n[n.length-1],u=n[0];s=e.dot(h)+i;for(let p=0;p<o;p++){if(u=n[p],r=e.dot(u)+i,s<0)if(r<0){const d=new Vec3;d.copy(u),t.push(d)}else{const d=new Vec3;h.lerp(u,s/(s-r),d),t.push(d)}else if(r<0){const d=new Vec3;h.lerp(u,s/(s-r),d),t.push(d),t.push(u)}h=u,s=r}return t}computeWorldVertices(n,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new Vec3);const e=this.vertices,i=this.worldVertices;for(let s=0;s!==this.vertices.length;s++)t.vmult(e[s],i[s]),n.vadd(i[s],i[s]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(n,t){const e=this.vertices;n.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let i=0;i<this.vertices.length;i++){const s=e[i];s.x<n.x?n.x=s.x:s.x>t.x&&(t.x=s.x),s.y<n.y?n.y=s.y:s.y>t.y&&(t.y=s.y),s.z<n.z?n.z=s.z:s.z>t.z&&(t.z=s.z)}}computeWorldFaceNormals(n){const t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new Vec3);const e=this.faceNormals,i=this.worldFaceNormals;for(let s=0;s!==t;s++)n.vmult(e[s],i[s]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let n=0;const t=this.vertices;for(let e=0;e!==t.length;e++){const i=t[e].lengthSquared();i>n&&(n=i)}this.boundingSphereRadius=Math.sqrt(n)}calculateWorldAABB(n,t,e,i){const s=this.vertices;let r,o,h,u,p,d,f=new Vec3;for(let g=0;g<s.length;g++){f.copy(s[g]),t.vmult(f,f),n.vadd(f,f);const _=f;(r===void 0||_.x<r)&&(r=_.x),(u===void 0||_.x>u)&&(u=_.x),(o===void 0||_.y<o)&&(o=_.y),(p===void 0||_.y>p)&&(p=_.y),(h===void 0||_.z<h)&&(h=_.z),(d===void 0||_.z>d)&&(d=_.z)}e.set(r,o,h),i.set(u,p,d)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(n=new Vec3){const t=this.vertices;for(let e=0;e<t.length;e++)n.vadd(t[e],n);return n.scale(1/t.length,n),n}transformAllPoints(n,t){const e=this.vertices.length,i=this.vertices;if(t){for(let s=0;s<e;s++){const r=i[s];t.vmult(r,r)}for(let s=0;s<this.faceNormals.length;s++){const r=this.faceNormals[s];t.vmult(r,r)}}if(n)for(let s=0;s<e;s++){const r=i[s];r.vadd(n,r)}}pointIsInside(n){const t=this.vertices,e=this.faces,i=this.faceNormals,s=new Vec3;this.getAveragePointLocal(s);for(let r=0;r<this.faces.length;r++){let o=i[r];const h=t[e[r][0]],u=new Vec3;n.vsub(h,u);const p=o.dot(u),d=new Vec3;s.vsub(h,d);const f=o.dot(d);if(p<0&&f>0||p>0&&f<0)return!1}return-1}static project(n,t,e,i,s){const r=n.vertices.length,o=project_localAxis;let h=0,u=0;const p=project_localOrigin,d=n.vertices;p.setZero(),Transform.vectorToLocalFrame(e,i,t,o),Transform.pointToLocalFrame(e,i,p,p);const f=p.dot(o);u=h=d[0].dot(o);for(let g=1;g<r;g++){const _=d[g].dot(o);_>h&&(h=_),_<u&&(u=_)}if(u-=f,h-=f,u>h){const g=u;u=h,h=g}s[0]=h,s[1]=u}}const maxminA=[],maxminB=[],project_localAxis=new Vec3,project_localOrigin=new Vec3;class Box extends Shape{constructor(n){super({type:Shape.types.BOX}),this.halfExtents=void 0,this.convexPolyhedronRepresentation=void 0,this.halfExtents=n,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const n=this.halfExtents.x,t=this.halfExtents.y,e=this.halfExtents.z,i=Vec3,s=[new i(-n,-t,-e),new i(n,-t,-e),new i(n,t,-e),new i(-n,t,-e),new i(-n,-t,e),new i(n,-t,e),new i(n,t,e),new i(-n,t,e)],r=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],o=[new i(0,0,1),new i(0,1,0),new i(1,0,0)],h=new ConvexPolyhedron({vertices:s,faces:r,axes:o});this.convexPolyhedronRepresentation=h,h.material=this.material}calculateLocalInertia(n,t=new Vec3){return Box.calculateInertia(this.halfExtents,n,t),t}static calculateInertia(n,t,e){const i=n;e.x=1/12*t*(2*i.y*2*i.y+2*i.z*2*i.z),e.y=1/12*t*(2*i.x*2*i.x+2*i.z*2*i.z),e.z=1/12*t*(2*i.y*2*i.y+2*i.x*2*i.x)}getSideNormals(n,t){const e=n,i=this.halfExtents;if(e[0].set(i.x,0,0),e[1].set(0,i.y,0),e[2].set(0,0,i.z),e[3].set(-i.x,0,0),e[4].set(0,-i.y,0),e[5].set(0,0,-i.z),t!==void 0)for(let s=0;s!==e.length;s++)t.vmult(e[s],e[s]);return e}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(n,t,e){const i=this.halfExtents,s=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]];for(let r=0;r<s.length;r++)worldCornerTempPos.set(s[r][0],s[r][1],s[r][2]),t.vmult(worldCornerTempPos,worldCornerTempPos),n.vadd(worldCornerTempPos,worldCornerTempPos),e(worldCornerTempPos.x,worldCornerTempPos.y,worldCornerTempPos.z)}calculateWorldAABB(n,t,e,i){const s=this.halfExtents;worldCornersTemp[0].set(s.x,s.y,s.z),worldCornersTemp[1].set(-s.x,s.y,s.z),worldCornersTemp[2].set(-s.x,-s.y,s.z),worldCornersTemp[3].set(-s.x,-s.y,-s.z),worldCornersTemp[4].set(s.x,-s.y,-s.z),worldCornersTemp[5].set(s.x,s.y,-s.z),worldCornersTemp[6].set(-s.x,s.y,-s.z),worldCornersTemp[7].set(s.x,-s.y,s.z);const r=worldCornersTemp[0];t.vmult(r,r),n.vadd(r,r),i.copy(r),e.copy(r);for(let o=1;o<8;o++){const h=worldCornersTemp[o];t.vmult(h,h),n.vadd(h,h);const u=h.x,p=h.y,d=h.z;u>i.x&&(i.x=u),p>i.y&&(i.y=p),d>i.z&&(i.z=d),u<e.x&&(e.x=u),p<e.y&&(e.y=p),d<e.z&&(e.z=d)}}}const worldCornerTempPos=new Vec3,worldCornersTemp=[new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3],BODY_TYPES={DYNAMIC:1,STATIC:2,KINEMATIC:4},BODY_SLEEP_STATES={AWAKE:0,SLEEPY:1,SLEEPING:2};class Body extends EventTarget{constructor(n={}){super(),this.id=void 0,this.index=void 0,this.world=void 0,this.preStep=void 0,this.postStep=void 0,this.vlambda=void 0,this.collisionFilterGroup=void 0,this.collisionFilterMask=void 0,this.collisionResponse=void 0,this.position=void 0,this.previousPosition=void 0,this.interpolatedPosition=void 0,this.initPosition=void 0,this.velocity=void 0,this.initVelocity=void 0,this.force=void 0,this.mass=void 0,this.invMass=void 0,this.material=void 0,this.linearDamping=void 0,this.type=void 0,this.allowSleep=void 0,this.sleepState=void 0,this.sleepSpeedLimit=void 0,this.sleepTimeLimit=void 0,this.timeLastSleepy=void 0,this.wakeUpAfterNarrowphase=void 0,this.torque=void 0,this.quaternion=void 0,this.initQuaternion=void 0,this.previousQuaternion=void 0,this.interpolatedQuaternion=void 0,this.angularVelocity=void 0,this.initAngularVelocity=void 0,this.shapes=void 0,this.shapeOffsets=void 0,this.shapeOrientations=void 0,this.inertia=void 0,this.invInertia=void 0,this.invInertiaWorld=void 0,this.invMassSolve=void 0,this.invInertiaSolve=void 0,this.invInertiaWorldSolve=void 0,this.fixedRotation=void 0,this.angularDamping=void 0,this.linearFactor=void 0,this.angularFactor=void 0,this.aabb=void 0,this.aabbNeedsUpdate=void 0,this.boundingRadius=void 0,this.wlambda=void 0,this.isTrigger=void 0,this.id=Body.idCounter++,this.index=-1,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new Vec3,this.collisionFilterGroup=typeof n.collisionFilterGroup=="number"?n.collisionFilterGroup:1,this.collisionFilterMask=typeof n.collisionFilterMask=="number"?n.collisionFilterMask:-1,this.collisionResponse=typeof n.collisionResponse=="boolean"?n.collisionResponse:!0,this.position=new Vec3,this.previousPosition=new Vec3,this.interpolatedPosition=new Vec3,this.initPosition=new Vec3,n.position&&(this.position.copy(n.position),this.previousPosition.copy(n.position),this.interpolatedPosition.copy(n.position),this.initPosition.copy(n.position)),this.velocity=new Vec3,n.velocity&&this.velocity.copy(n.velocity),this.initVelocity=new Vec3,this.force=new Vec3;const t=typeof n.mass=="number"?n.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=n.material||null,this.linearDamping=typeof n.linearDamping=="number"?n.linearDamping:.01,this.type=t<=0?Body.STATIC:Body.DYNAMIC,typeof n.type==typeof Body.STATIC&&(this.type=n.type),this.allowSleep=typeof n.allowSleep<"u"?n.allowSleep:!0,this.sleepState=Body.AWAKE,this.sleepSpeedLimit=typeof n.sleepSpeedLimit<"u"?n.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof n.sleepTimeLimit<"u"?n.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new Vec3,this.quaternion=new Quaternion,this.initQuaternion=new Quaternion,this.previousQuaternion=new Quaternion,this.interpolatedQuaternion=new Quaternion,n.quaternion&&(this.quaternion.copy(n.quaternion),this.initQuaternion.copy(n.quaternion),this.previousQuaternion.copy(n.quaternion),this.interpolatedQuaternion.copy(n.quaternion)),this.angularVelocity=new Vec3,n.angularVelocity&&this.angularVelocity.copy(n.angularVelocity),this.initAngularVelocity=new Vec3,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new Vec3,this.invInertia=new Vec3,this.invInertiaWorld=new Mat3,this.invMassSolve=0,this.invInertiaSolve=new Vec3,this.invInertiaWorldSolve=new Mat3,this.fixedRotation=typeof n.fixedRotation<"u"?n.fixedRotation:!1,this.angularDamping=typeof n.angularDamping<"u"?n.angularDamping:.01,this.linearFactor=new Vec3(1,1,1),n.linearFactor&&this.linearFactor.copy(n.linearFactor),this.angularFactor=new Vec3(1,1,1),n.angularFactor&&this.angularFactor.copy(n.angularFactor),this.aabb=new AABB,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new Vec3,this.isTrigger=!!n.isTrigger,n.shape&&this.addShape(n.shape),this.updateMassProperties()}wakeUp(){const n=this.sleepState;this.sleepState=Body.AWAKE,this.wakeUpAfterNarrowphase=!1,n===Body.SLEEPING&&this.dispatchEvent(Body.wakeupEvent)}sleep(){this.sleepState=Body.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(n){if(this.allowSleep){const t=this.sleepState,e=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),i=this.sleepSpeedLimit**2;t===Body.AWAKE&&e<i?(this.sleepState=Body.SLEEPY,this.timeLastSleepy=n,this.dispatchEvent(Body.sleepyEvent)):t===Body.SLEEPY&&e>i?this.wakeUp():t===Body.SLEEPY&&n-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(Body.sleepEvent))}}updateSolveMassProperties(){this.sleepState===Body.SLEEPING||this.type===Body.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(n,t=new Vec3){return n.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(n,t=new Vec3){return this.quaternion.conjugate().vmult(n,t),t}pointToWorldFrame(n,t=new Vec3){return this.quaternion.vmult(n,t),t.vadd(this.position,t),t}vectorToWorldFrame(n,t=new Vec3){return this.quaternion.vmult(n,t),t}addShape(n,t,e){const i=new Vec3,s=new Quaternion;return t&&i.copy(t),e&&s.copy(e),this.shapes.push(n),this.shapeOffsets.push(i),this.shapeOrientations.push(s),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,n.body=this,this}removeShape(n){const t=this.shapes.indexOf(n);return t===-1?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,n.body=null,this)}updateBoundingRadius(){const n=this.shapes,t=this.shapeOffsets,e=n.length;let i=0;for(let s=0;s!==e;s++){const r=n[s];r.updateBoundingSphereRadius();const o=t[s].length(),h=r.boundingSphereRadius;o+h>i&&(i=o+h)}this.boundingRadius=i}updateAABB(){const n=this.shapes,t=this.shapeOffsets,e=this.shapeOrientations,i=n.length,s=tmpVec,r=tmpQuat,o=this.quaternion,h=this.aabb,u=updateAABB_shapeAABB;for(let p=0;p!==i;p++){const d=n[p];o.vmult(t[p],s),s.vadd(this.position,s),o.mult(e[p],r),d.calculateWorldAABB(s,r,u.lowerBound,u.upperBound),p===0?h.copy(u):h.extend(u)}this.aabbNeedsUpdate=!1}updateInertiaWorld(n){const t=this.invInertia;if(!(t.x===t.y&&t.y===t.z&&!n)){const e=uiw_m1,i=uiw_m2;e.setRotationFromQuaternion(this.quaternion),e.transpose(i),e.scale(t,e),e.mmult(i,this.invInertiaWorld)}}applyForce(n,t=new Vec3){if(this.type!==Body.DYNAMIC)return;this.sleepState===Body.SLEEPING&&this.wakeUp();const e=Body_applyForce_rotForce;t.cross(n,e),this.force.vadd(n,this.force),this.torque.vadd(e,this.torque)}applyLocalForce(n,t=new Vec3){if(this.type!==Body.DYNAMIC)return;const e=Body_applyLocalForce_worldForce,i=Body_applyLocalForce_relativePointWorld;this.vectorToWorldFrame(n,e),this.vectorToWorldFrame(t,i),this.applyForce(e,i)}applyTorque(n){this.type===Body.DYNAMIC&&(this.sleepState===Body.SLEEPING&&this.wakeUp(),this.torque.vadd(n,this.torque))}applyImpulse(n,t=new Vec3){if(this.type!==Body.DYNAMIC)return;this.sleepState===Body.SLEEPING&&this.wakeUp();const e=t,i=Body_applyImpulse_velo;i.copy(n),i.scale(this.invMass,i),this.velocity.vadd(i,this.velocity);const s=Body_applyImpulse_rotVelo;e.cross(n,s),this.invInertiaWorld.vmult(s,s),this.angularVelocity.vadd(s,this.angularVelocity)}applyLocalImpulse(n,t=new Vec3){if(this.type!==Body.DYNAMIC)return;const e=Body_applyLocalImpulse_worldImpulse,i=Body_applyLocalImpulse_relativePoint;this.vectorToWorldFrame(n,e),this.vectorToWorldFrame(t,i),this.applyImpulse(e,i)}updateMassProperties(){const n=Body_updateMassProperties_halfExtents;this.invMass=this.mass>0?1/this.mass:0;const t=this.inertia,e=this.fixedRotation;this.updateAABB(),n.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),Box.calculateInertia(n,this.mass,t),this.invInertia.set(t.x>0&&!e?1/t.x:0,t.y>0&&!e?1/t.y:0,t.z>0&&!e?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(n,t){const e=new Vec3;return n.vsub(this.position,e),this.angularVelocity.cross(e,t),this.velocity.vadd(t,t),t}integrate(n,t,e){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),!(this.type===Body.DYNAMIC||this.type===Body.KINEMATIC)||this.sleepState===Body.SLEEPING)return;const i=this.velocity,s=this.angularVelocity,r=this.position,o=this.force,h=this.torque,u=this.quaternion,p=this.invMass,d=this.invInertiaWorld,f=this.linearFactor,g=p*n;i.x+=o.x*g*f.x,i.y+=o.y*g*f.y,i.z+=o.z*g*f.z;const _=d.elements,v=this.angularFactor,y=h.x*v.x,E=h.y*v.y,m=h.z*v.z;s.x+=n*(_[0]*y+_[1]*E+_[2]*m),s.y+=n*(_[3]*y+_[4]*E+_[5]*m),s.z+=n*(_[6]*y+_[7]*E+_[8]*m),r.x+=i.x*n,r.y+=i.y*n,r.z+=i.z*n,u.integrate(this.angularVelocity,n,this.angularFactor,u),t&&(e?u.normalizeFast():u.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}Body.idCounter=0;Body.COLLIDE_EVENT_NAME="collide";Body.DYNAMIC=BODY_TYPES.DYNAMIC;Body.STATIC=BODY_TYPES.STATIC;Body.KINEMATIC=BODY_TYPES.KINEMATIC;Body.AWAKE=BODY_SLEEP_STATES.AWAKE;Body.SLEEPY=BODY_SLEEP_STATES.SLEEPY;Body.SLEEPING=BODY_SLEEP_STATES.SLEEPING;Body.wakeupEvent={type:"wakeup"};Body.sleepyEvent={type:"sleepy"};Body.sleepEvent={type:"sleep"};const tmpVec=new Vec3,tmpQuat=new Quaternion,updateAABB_shapeAABB=new AABB,uiw_m1=new Mat3,uiw_m2=new Mat3,Body_applyForce_rotForce=new Vec3,Body_applyLocalForce_worldForce=new Vec3,Body_applyLocalForce_relativePointWorld=new Vec3,Body_applyImpulse_velo=new Vec3,Body_applyImpulse_rotVelo=new Vec3,Body_applyLocalImpulse_worldImpulse=new Vec3,Body_applyLocalImpulse_relativePoint=new Vec3,Body_updateMassProperties_halfExtents=new Vec3;class Broadphase{constructor(){this.world=void 0,this.useBoundingBoxes=void 0,this.dirty=void 0,this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(n,t,e){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(n,t){return!((n.collisionFilterGroup&t.collisionFilterMask)===0||(t.collisionFilterGroup&n.collisionFilterMask)===0||((n.type&Body.STATIC)!==0||n.sleepState===Body.SLEEPING)&&((t.type&Body.STATIC)!==0||t.sleepState===Body.SLEEPING))}intersectionTest(n,t,e,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(n,t,e,i):this.doBoundingSphereBroadphase(n,t,e,i)}doBoundingSphereBroadphase(n,t,e,i){const s=Broadphase_collisionPairs_r;t.position.vsub(n.position,s);const r=(n.boundingRadius+t.boundingRadius)**2;s.lengthSquared()<r&&(e.push(n),i.push(t))}doBoundingBoxBroadphase(n,t,e,i){n.aabbNeedsUpdate&&n.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),n.aabb.overlaps(t.aabb)&&(e.push(n),i.push(t))}makePairsUnique(n,t){const e=Broadphase_makePairsUnique_temp,i=Broadphase_makePairsUnique_p1,s=Broadphase_makePairsUnique_p2,r=n.length;for(let o=0;o!==r;o++)i[o]=n[o],s[o]=t[o];n.length=0,t.length=0;for(let o=0;o!==r;o++){const h=i[o].id,u=s[o].id,p=h<u?h+","+u:u+","+h;e[p]=o,e.keys.push(p)}for(let o=0;o!==e.keys.length;o++){const h=e.keys.pop(),u=e[h];n.push(i[u]),t.push(s[u]),delete e[h]}}setWorld(n){}static boundingSphereCheck(n,t){const e=new Vec3;n.position.vsub(t.position,e);const i=n.shapes[0],s=t.shapes[0];return Math.pow(i.boundingSphereRadius+s.boundingSphereRadius,2)>e.lengthSquared()}aabbQuery(n,t,e){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const Broadphase_collisionPairs_r=new Vec3,Broadphase_makePairsUnique_temp={keys:[]},Broadphase_makePairsUnique_p1=[],Broadphase_makePairsUnique_p2=[];class NaiveBroadphase extends Broadphase{constructor(){super()}collisionPairs(n,t,e){const i=n.bodies,s=i.length;let r,o;for(let h=0;h!==s;h++)for(let u=0;u!==h;u++)r=i[h],o=i[u],this.needBroadphaseCollision(r,o)&&this.intersectionTest(r,o,t,e)}aabbQuery(n,t,e=[]){for(let i=0;i<n.bodies.length;i++){const s=n.bodies[i];s.aabbNeedsUpdate&&s.updateAABB(),s.aabb.overlaps(t)&&e.push(s)}return e}}class RaycastResult{constructor(){this.rayFromWorld=void 0,this.rayToWorld=void 0,this.hitNormalWorld=void 0,this.hitPointWorld=void 0,this.hasHit=void 0,this.shape=void 0,this.body=void 0,this.hitFaceIndex=void 0,this.distance=void 0,this.shouldStop=void 0,this.rayFromWorld=new Vec3,this.rayToWorld=new Vec3,this.hitNormalWorld=new Vec3,this.hitPointWorld=new Vec3,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(n,t,e,i,s,r,o){this.rayFromWorld.copy(n),this.rayToWorld.copy(t),this.hitNormalWorld.copy(e),this.hitPointWorld.copy(i),this.shape=s,this.body=r,this.distance=o}}let _Shape$types$SPHERE,_Shape$types$PLANE,_Shape$types$BOX,_Shape$types$CYLINDER,_Shape$types$CONVEXPO,_Shape$types$HEIGHTFI,_Shape$types$TRIMESH;const RAY_MODES={CLOSEST:1,ANY:2,ALL:4};_Shape$types$SPHERE=Shape.types.SPHERE;_Shape$types$PLANE=Shape.types.PLANE;_Shape$types$BOX=Shape.types.BOX;_Shape$types$CYLINDER=Shape.types.CYLINDER;_Shape$types$CONVEXPO=Shape.types.CONVEXPOLYHEDRON;_Shape$types$HEIGHTFI=Shape.types.HEIGHTFIELD;_Shape$types$TRIMESH=Shape.types.TRIMESH;class Ray{get[_Shape$types$SPHERE](){return this._intersectSphere}get[_Shape$types$PLANE](){return this._intersectPlane}get[_Shape$types$BOX](){return this._intersectBox}get[_Shape$types$CYLINDER](){return this._intersectConvex}get[_Shape$types$CONVEXPO](){return this._intersectConvex}get[_Shape$types$HEIGHTFI](){return this._intersectHeightfield}get[_Shape$types$TRIMESH](){return this._intersectTrimesh}constructor(n=new Vec3,t=new Vec3){this.from=void 0,this.to=void 0,this.direction=void 0,this.precision=void 0,this.checkCollisionResponse=void 0,this.skipBackfaces=void 0,this.collisionFilterMask=void 0,this.collisionFilterGroup=void 0,this.mode=void 0,this.result=void 0,this.hasHit=void 0,this.callback=void 0,this.from=n.clone(),this.to=t.clone(),this.direction=new Vec3,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ray.ANY,this.result=new RaycastResult,this.hasHit=!1,this.callback=e=>{}}intersectWorld(n,t){return this.mode=t.mode||Ray.ANY,this.result=t.result||new RaycastResult,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(tmpAABB$1),tmpArray.length=0,n.broadphase.aabbQuery(n,tmpAABB$1,tmpArray),this.intersectBodies(tmpArray),this.hasHit}intersectBody(n,t){t&&(this.result=t,this.updateDirection());const e=this.checkCollisionResponse;if(e&&!n.collisionResponse||(this.collisionFilterGroup&n.collisionFilterMask)===0||(n.collisionFilterGroup&this.collisionFilterMask)===0)return;const i=intersectBody_xi,s=intersectBody_qi;for(let r=0,o=n.shapes.length;r<o;r++){const h=n.shapes[r];if(!(e&&!h.collisionResponse)&&(n.quaternion.mult(n.shapeOrientations[r],s),n.quaternion.vmult(n.shapeOffsets[r],i),i.vadd(n.position,i),this.intersectShape(h,s,i,n),this.result.shouldStop))break}}intersectBodies(n,t){t&&(this.result=t,this.updateDirection());for(let e=0,i=n.length;!this.result.shouldStop&&e<i;e++)this.intersectBody(n[e])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(n,t,e,i){const s=this.from;if(distanceFromIntersection(s,this.direction,e)>n.boundingSphereRadius)return;const o=this[n.type];o&&o.call(this,n,t,e,i,n)}_intersectBox(n,t,e,i,s){return this._intersectConvex(n.convexPolyhedronRepresentation,t,e,i,s)}_intersectPlane(n,t,e,i,s){const r=this.from,o=this.to,h=this.direction,u=new Vec3(0,0,1);t.vmult(u,u);const p=new Vec3;r.vsub(e,p);const d=p.dot(u);o.vsub(e,p);const f=p.dot(u);if(d*f>0||r.distanceTo(o)<d)return;const g=u.dot(h);if(Math.abs(g)<this.precision)return;const _=new Vec3,v=new Vec3,y=new Vec3;r.vsub(e,_);const E=-u.dot(_)/g;h.scale(E,v),r.vadd(v,y),this.reportIntersection(u,y,s,i,-1)}getAABB(n){const{lowerBound:t,upperBound:e}=n,i=this.to,s=this.from;t.x=Math.min(i.x,s.x),t.y=Math.min(i.y,s.y),t.z=Math.min(i.z,s.z),e.x=Math.max(i.x,s.x),e.y=Math.max(i.y,s.y),e.z=Math.max(i.z,s.z)}_intersectHeightfield(n,t,e,i,s){n.data,n.elementSize;const r=intersectHeightfield_localRay;r.from.copy(this.from),r.to.copy(this.to),Transform.pointToLocalFrame(e,t,r.from,r.from),Transform.pointToLocalFrame(e,t,r.to,r.to),r.updateDirection();const o=intersectHeightfield_index;let h,u,p,d;h=u=0,p=d=n.data.length-1;const f=new AABB;r.getAABB(f),n.getIndexOfPosition(f.lowerBound.x,f.lowerBound.y,o,!0),h=Math.max(h,o[0]),u=Math.max(u,o[1]),n.getIndexOfPosition(f.upperBound.x,f.upperBound.y,o,!0),p=Math.min(p,o[0]+1),d=Math.min(d,o[1]+1);for(let g=h;g<p;g++)for(let _=u;_<d;_++){if(this.result.shouldStop)return;if(n.getAabbAtIndex(g,_,f),!!f.overlapsRay(r)){if(n.getConvexTrianglePillar(g,_,!1),Transform.pointToWorldFrame(e,t,n.pillarOffset,worldPillarOffset),this._intersectConvex(n.pillarConvex,t,worldPillarOffset,i,s,intersectConvexOptions),this.result.shouldStop)return;n.getConvexTrianglePillar(g,_,!0),Transform.pointToWorldFrame(e,t,n.pillarOffset,worldPillarOffset),this._intersectConvex(n.pillarConvex,t,worldPillarOffset,i,s,intersectConvexOptions)}}}_intersectSphere(n,t,e,i,s){const r=this.from,o=this.to,h=n.radius,u=(o.x-r.x)**2+(o.y-r.y)**2+(o.z-r.z)**2,p=2*((o.x-r.x)*(r.x-e.x)+(o.y-r.y)*(r.y-e.y)+(o.z-r.z)*(r.z-e.z)),d=(r.x-e.x)**2+(r.y-e.y)**2+(r.z-e.z)**2-h**2,f=p**2-4*u*d,g=Ray_intersectSphere_intersectionPoint,_=Ray_intersectSphere_normal;if(!(f<0))if(f===0)r.lerp(o,f,g),g.vsub(e,_),_.normalize(),this.reportIntersection(_,g,s,i,-1);else{const v=(-p-Math.sqrt(f))/(2*u),y=(-p+Math.sqrt(f))/(2*u);if(v>=0&&v<=1&&(r.lerp(o,v,g),g.vsub(e,_),_.normalize(),this.reportIntersection(_,g,s,i,-1)),this.result.shouldStop)return;y>=0&&y<=1&&(r.lerp(o,y,g),g.vsub(e,_),_.normalize(),this.reportIntersection(_,g,s,i,-1))}}_intersectConvex(n,t,e,i,s,r){const o=intersectConvex_normal,h=intersectConvex_vector,u=r&&r.faceList||null,p=n.faces,d=n.vertices,f=n.faceNormals,g=this.direction,_=this.from,v=this.to,y=_.distanceTo(v),E=u?u.length:p.length,m=this.result;for(let x=0;!m.shouldStop&&x<E;x++){const C=u?u[x]:x,O=p[C],S=f[C],P=t,F=e;h.copy(d[O[0]]),P.vmult(h,h),h.vadd(F,h),h.vsub(_,h),P.vmult(S,o);const V=g.dot(o);if(Math.abs(V)<this.precision)continue;const N=o.dot(h)/V;if(!(N<0)){g.scale(N,intersectPoint),intersectPoint.vadd(_,intersectPoint),a.copy(d[O[0]]),P.vmult(a,a),F.vadd(a,a);for(let B=1;!m.shouldStop&&B<O.length-1;B++){b.copy(d[O[B]]),c.copy(d[O[B+1]]),P.vmult(b,b),P.vmult(c,c),F.vadd(b,b),F.vadd(c,c);const W=intersectPoint.distanceTo(_);!(Ray.pointInTriangle(intersectPoint,a,b,c)||Ray.pointInTriangle(intersectPoint,b,a,c))||W>y||this.reportIntersection(o,intersectPoint,s,i,C)}}}}_intersectTrimesh(n,t,e,i,s,r){const o=intersectTrimesh_normal,h=intersectTrimesh_triangles,u=intersectTrimesh_treeTransform,p=intersectConvex_vector,d=intersectTrimesh_localDirection,f=intersectTrimesh_localFrom,g=intersectTrimesh_localTo,_=intersectTrimesh_worldIntersectPoint,v=intersectTrimesh_worldNormal,y=n.indices;n.vertices;const E=this.from,m=this.to,x=this.direction;u.position.copy(e),u.quaternion.copy(t),Transform.vectorToLocalFrame(e,t,x,d),Transform.pointToLocalFrame(e,t,E,f),Transform.pointToLocalFrame(e,t,m,g),g.x*=n.scale.x,g.y*=n.scale.y,g.z*=n.scale.z,f.x*=n.scale.x,f.y*=n.scale.y,f.z*=n.scale.z,g.vsub(f,d),d.normalize();const C=f.distanceSquared(g);n.tree.rayQuery(this,u,h);for(let O=0,S=h.length;!this.result.shouldStop&&O!==S;O++){const P=h[O];n.getNormal(P,o),n.getVertex(y[P*3],a),a.vsub(f,p);const F=d.dot(o),V=o.dot(p)/F;if(V<0)continue;d.scale(V,intersectPoint),intersectPoint.vadd(f,intersectPoint),n.getVertex(y[P*3+1],b),n.getVertex(y[P*3+2],c);const N=intersectPoint.distanceSquared(f);!(Ray.pointInTriangle(intersectPoint,b,a,c)||Ray.pointInTriangle(intersectPoint,a,b,c))||N>C||(Transform.vectorToWorldFrame(t,o,v),Transform.pointToWorldFrame(e,t,intersectPoint,_),this.reportIntersection(v,_,s,i,P))}h.length=0}reportIntersection(n,t,e,i,s){const r=this.from,o=this.to,h=r.distanceTo(t),u=this.result;if(!(this.skipBackfaces&&n.dot(this.direction)>0))switch(u.hitFaceIndex=typeof s<"u"?s:-1,this.mode){case Ray.ALL:this.hasHit=!0,u.set(r,o,n,t,e,i,h),u.hasHit=!0,this.callback(u);break;case Ray.CLOSEST:(h<u.distance||!u.hasHit)&&(this.hasHit=!0,u.hasHit=!0,u.set(r,o,n,t,e,i,h));break;case Ray.ANY:this.hasHit=!0,u.hasHit=!0,u.set(r,o,n,t,e,i,h),u.shouldStop=!0;break}}static pointInTriangle(n,t,e,i){i.vsub(t,v0),e.vsub(t,v1),n.vsub(t,v2);const s=v0.dot(v0),r=v0.dot(v1),o=v0.dot(v2),h=v1.dot(v1),u=v1.dot(v2);let p,d;return(p=h*o-r*u)>=0&&(d=s*u-r*o)>=0&&p+d<s*h-r*r}}Ray.CLOSEST=RAY_MODES.CLOSEST;Ray.ANY=RAY_MODES.ANY;Ray.ALL=RAY_MODES.ALL;const tmpAABB$1=new AABB,tmpArray=[],v1=new Vec3,v2=new Vec3,intersectBody_xi=new Vec3,intersectBody_qi=new Quaternion,intersectPoint=new Vec3,a=new Vec3,b=new Vec3,c=new Vec3,intersectConvexOptions={faceList:[0]},worldPillarOffset=new Vec3,intersectHeightfield_localRay=new Ray,intersectHeightfield_index=[],Ray_intersectSphere_intersectionPoint=new Vec3,Ray_intersectSphere_normal=new Vec3,intersectConvex_normal=new Vec3,intersectConvex_vector=new Vec3,intersectTrimesh_normal=new Vec3,intersectTrimesh_localDirection=new Vec3,intersectTrimesh_localFrom=new Vec3,intersectTrimesh_localTo=new Vec3,intersectTrimesh_worldNormal=new Vec3,intersectTrimesh_worldIntersectPoint=new Vec3;new AABB;const intersectTrimesh_triangles=[],intersectTrimesh_treeTransform=new Transform,v0=new Vec3,intersect=new Vec3;function distanceFromIntersection(l,n,t){t.vsub(l,v0);const e=v0.dot(n);return n.scale(e,intersect),intersect.vadd(l,intersect),t.distanceTo(intersect)}class Utils{static defaults(n={},t){for(let e in t)e in n||(n[e]=t[e]);return n}}class JacobianElement{constructor(){this.spatial=void 0,this.rotational=void 0,this.spatial=new Vec3,this.rotational=new Vec3}multiplyElement(n){return n.spatial.dot(this.spatial)+n.rotational.dot(this.rotational)}multiplyVectors(n,t){return n.dot(this.spatial)+t.dot(this.rotational)}}class Equation{constructor(n,t,e=-1e6,i=1e6){this.id=void 0,this.minForce=void 0,this.maxForce=void 0,this.bi=void 0,this.bj=void 0,this.si=void 0,this.sj=void 0,this.a=void 0,this.b=void 0,this.eps=void 0,this.jacobianElementA=void 0,this.jacobianElementB=void 0,this.enabled=void 0,this.multiplier=void 0,this.id=Equation.idCounter++,this.minForce=e,this.maxForce=i,this.bi=n,this.bj=t,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new JacobianElement,this.jacobianElementB=new JacobianElement,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(n,t,e){const i=t,s=n,r=e;this.a=4/(r*(1+4*i)),this.b=4*i/(1+4*i),this.eps=4/(r*r*s*(1+4*i))}computeB(n,t,e){const i=this.computeGW(),s=this.computeGq(),r=this.computeGiMf();return-s*n-i*t-r*e}computeGq(){const n=this.jacobianElementA,t=this.jacobianElementB,e=this.bi,i=this.bj,s=e.position,r=i.position;return n.spatial.dot(s)+t.spatial.dot(r)}computeGW(){const n=this.jacobianElementA,t=this.jacobianElementB,e=this.bi,i=this.bj,s=e.velocity,r=i.velocity,o=e.angularVelocity,h=i.angularVelocity;return n.multiplyVectors(s,o)+t.multiplyVectors(r,h)}computeGWlambda(){const n=this.jacobianElementA,t=this.jacobianElementB,e=this.bi,i=this.bj,s=e.vlambda,r=i.vlambda,o=e.wlambda,h=i.wlambda;return n.multiplyVectors(s,o)+t.multiplyVectors(r,h)}computeGiMf(){const n=this.jacobianElementA,t=this.jacobianElementB,e=this.bi,i=this.bj,s=e.force,r=e.torque,o=i.force,h=i.torque,u=e.invMassSolve,p=i.invMassSolve;return s.scale(u,iMfi),o.scale(p,iMfj),e.invInertiaWorldSolve.vmult(r,invIi_vmult_taui),i.invInertiaWorldSolve.vmult(h,invIj_vmult_tauj),n.multiplyVectors(iMfi,invIi_vmult_taui)+t.multiplyVectors(iMfj,invIj_vmult_tauj)}computeGiMGt(){const n=this.jacobianElementA,t=this.jacobianElementB,e=this.bi,i=this.bj,s=e.invMassSolve,r=i.invMassSolve,o=e.invInertiaWorldSolve,h=i.invInertiaWorldSolve;let u=s+r;return o.vmult(n.rotational,tmp),u+=tmp.dot(n.rotational),h.vmult(t.rotational,tmp),u+=tmp.dot(t.rotational),u}addToWlambda(n){const t=this.jacobianElementA,e=this.jacobianElementB,i=this.bi,s=this.bj,r=addToWlambda_temp;i.vlambda.addScaledVector(i.invMassSolve*n,t.spatial,i.vlambda),s.vlambda.addScaledVector(s.invMassSolve*n,e.spatial,s.vlambda),i.invInertiaWorldSolve.vmult(t.rotational,r),i.wlambda.addScaledVector(n,r,i.wlambda),s.invInertiaWorldSolve.vmult(e.rotational,r),s.wlambda.addScaledVector(n,r,s.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}Equation.idCounter=0;const iMfi=new Vec3,iMfj=new Vec3,invIi_vmult_taui=new Vec3,invIj_vmult_tauj=new Vec3,tmp=new Vec3,addToWlambda_temp=new Vec3;class ContactEquation extends Equation{constructor(n,t,e=1e6){super(n,t,0,e),this.restitution=void 0,this.ri=void 0,this.rj=void 0,this.ni=void 0,this.restitution=0,this.ri=new Vec3,this.rj=new Vec3,this.ni=new Vec3}computeB(n){const t=this.a,e=this.b,i=this.bi,s=this.bj,r=this.ri,o=this.rj,h=ContactEquation_computeB_temp1,u=ContactEquation_computeB_temp2,p=i.velocity,d=i.angularVelocity;i.force,i.torque;const f=s.velocity,g=s.angularVelocity;s.force,s.torque;const _=ContactEquation_computeB_temp3,v=this.jacobianElementA,y=this.jacobianElementB,E=this.ni;r.cross(E,h),o.cross(E,u),E.negate(v.spatial),h.negate(v.rotational),y.spatial.copy(E),y.rotational.copy(u),_.copy(s.position),_.vadd(o,_),_.vsub(i.position,_),_.vsub(r,_);const m=E.dot(_),x=this.restitution+1,C=x*f.dot(E)-x*p.dot(E)+g.dot(u)-d.dot(h),O=this.computeGiMf();return-m*t-C*e-n*O}getImpactVelocityAlongNormal(){const n=ContactEquation_getImpactVelocityAlongNormal_vi,t=ContactEquation_getImpactVelocityAlongNormal_vj,e=ContactEquation_getImpactVelocityAlongNormal_xi,i=ContactEquation_getImpactVelocityAlongNormal_xj,s=ContactEquation_getImpactVelocityAlongNormal_relVel;return this.bi.position.vadd(this.ri,e),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(e,n),this.bj.getVelocityAtWorldPoint(i,t),n.vsub(t,s),this.ni.dot(s)}}const ContactEquation_computeB_temp1=new Vec3,ContactEquation_computeB_temp2=new Vec3,ContactEquation_computeB_temp3=new Vec3,ContactEquation_getImpactVelocityAlongNormal_vi=new Vec3,ContactEquation_getImpactVelocityAlongNormal_vj=new Vec3,ContactEquation_getImpactVelocityAlongNormal_xi=new Vec3,ContactEquation_getImpactVelocityAlongNormal_xj=new Vec3,ContactEquation_getImpactVelocityAlongNormal_relVel=new Vec3;class FrictionEquation extends Equation{constructor(n,t,e){super(n,t,-e,e),this.ri=void 0,this.rj=void 0,this.t=void 0,this.ri=new Vec3,this.rj=new Vec3,this.t=new Vec3}computeB(n){this.a;const t=this.b;this.bi,this.bj;const e=this.ri,i=this.rj,s=FrictionEquation_computeB_temp1,r=FrictionEquation_computeB_temp2,o=this.t;e.cross(o,s),i.cross(o,r);const h=this.jacobianElementA,u=this.jacobianElementB;o.negate(h.spatial),s.negate(h.rotational),u.spatial.copy(o),u.rotational.copy(r);const p=this.computeGW(),d=this.computeGiMf();return-p*t-n*d}}const FrictionEquation_computeB_temp1=new Vec3,FrictionEquation_computeB_temp2=new Vec3;class ContactMaterial{constructor(n,t,e){this.id=void 0,this.materials=void 0,this.friction=void 0,this.restitution=void 0,this.contactEquationStiffness=void 0,this.contactEquationRelaxation=void 0,this.frictionEquationStiffness=void 0,this.frictionEquationRelaxation=void 0,e=Utils.defaults(e,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=ContactMaterial.idCounter++,this.materials=[n,t],this.friction=e.friction,this.restitution=e.restitution,this.contactEquationStiffness=e.contactEquationStiffness,this.contactEquationRelaxation=e.contactEquationRelaxation,this.frictionEquationStiffness=e.frictionEquationStiffness,this.frictionEquationRelaxation=e.frictionEquationRelaxation}}ContactMaterial.idCounter=0;class Material{constructor(n={}){this.name=void 0,this.id=void 0,this.friction=void 0,this.restitution=void 0;let t="";typeof n=="string"&&(t=n,n={}),this.name=t,this.id=Material.idCounter++,this.friction=typeof n.friction<"u"?n.friction:-1,this.restitution=typeof n.restitution<"u"?n.restitution:-1}}Material.idCounter=0;new Ray;class Sphere extends Shape{constructor(n){if(super({type:Shape.types.SPHERE}),this.radius=void 0,this.radius=n!==void 0?n:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(n,t=new Vec3){const e=2*n*this.radius*this.radius/5;return t.x=e,t.y=e,t.z=e,t}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(n,t,e,i){const s=this.radius,r=["x","y","z"];for(let o=0;o<r.length;o++){const h=r[o];e[h]=n[h]-s,i[h]=n[h]+s}}}class Cylinder extends ConvexPolyhedron{constructor(n=1,t=1,e=1,i=8){if(n<0)throw new Error("The cylinder radiusTop cannot be negative.");if(t<0)throw new Error("The cylinder radiusBottom cannot be negative.");const s=i,r=[],o=[],h=[],u=[],p=[],d=Math.cos,f=Math.sin;r.push(new Vec3(-t*f(0),-e*.5,t*d(0))),u.push(0),r.push(new Vec3(-n*f(0),e*.5,n*d(0))),p.push(1);for(let _=0;_<s;_++){const v=2*Math.PI/s*(_+1),y=2*Math.PI/s*(_+.5);_<s-1?(r.push(new Vec3(-t*f(v),-e*.5,t*d(v))),u.push(2*_+2),r.push(new Vec3(-n*f(v),e*.5,n*d(v))),p.push(2*_+3),h.push([2*_,2*_+1,2*_+3,2*_+2])):h.push([2*_,2*_+1,1,0]),(s%2===1||_<s/2)&&o.push(new Vec3(-f(y),0,d(y)))}h.push(u),o.push(new Vec3(0,1,0));const g=[];for(let _=0;_<p.length;_++)g.push(p[p.length-_-1]);h.push(g),super({vertices:r,faces:h,axes:o}),this.radiusTop=void 0,this.radiusBottom=void 0,this.height=void 0,this.numSegments=void 0,this.type=Shape.types.CYLINDER,this.radiusTop=n,this.radiusBottom=t,this.height=e,this.numSegments=i}}class Plane extends Shape{constructor(){super({type:Shape.types.PLANE}),this.worldNormal=void 0,this.worldNormalNeedsUpdate=void 0,this.boundingSphereRadius=void 0,this.worldNormal=new Vec3,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(n){const t=this.worldNormal;t.set(0,0,1),n.vmult(t,t),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(n,t=new Vec3){return t}volume(){return Number.MAX_VALUE}calculateWorldAABB(n,t,e,i){tempNormal.set(0,0,1),t.vmult(tempNormal,tempNormal);const s=Number.MAX_VALUE;e.set(-s,-s,-s),i.set(s,s,s),tempNormal.x===1?i.x=n.x:tempNormal.x===-1&&(e.x=n.x),tempNormal.y===1?i.y=n.y:tempNormal.y===-1&&(e.y=n.y),tempNormal.z===1?i.z=n.z:tempNormal.z===-1&&(e.z=n.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const tempNormal=new Vec3;new AABB;new AABB;new AABB;new Transform;new AABB;class Solver{constructor(){this.equations=void 0,this.equations=[]}solve(n,t){return 0}addEquation(n){n.enabled&&!n.bi.isTrigger&&!n.bj.isTrigger&&this.equations.push(n)}removeEquation(n){const t=this.equations,e=t.indexOf(n);e!==-1&&t.splice(e,1)}removeAllEquations(){this.equations.length=0}}class GSSolver extends Solver{constructor(){super(),this.iterations=void 0,this.tolerance=void 0,this.iterations=10,this.tolerance=1e-7}solve(n,t){let e=0;const i=this.iterations,s=this.tolerance*this.tolerance,r=this.equations,o=r.length,h=t.bodies,u=h.length,p=n;let d,f,g,_,v,y;if(o!==0)for(let C=0;C!==u;C++)h[C].updateSolveMassProperties();const E=GSSolver_solve_invCs,m=GSSolver_solve_Bs,x=GSSolver_solve_lambda;E.length=o,m.length=o,x.length=o;for(let C=0;C!==o;C++){const O=r[C];x[C]=0,m[C]=O.computeB(p),E[C]=1/O.computeC()}if(o!==0){for(let S=0;S!==u;S++){const P=h[S],F=P.vlambda,V=P.wlambda;F.set(0,0,0),V.set(0,0,0)}for(e=0;e!==i;e++){_=0;for(let S=0;S!==o;S++){const P=r[S];d=m[S],f=E[S],y=x[S],v=P.computeGWlambda(),g=f*(d-v-P.eps*y),y+g<P.minForce?g=P.minForce-y:y+g>P.maxForce&&(g=P.maxForce-y),x[S]+=g,_+=g>0?g:-g,P.addToWlambda(g)}if(_*_<s)break}for(let S=0;S!==u;S++){const P=h[S],F=P.velocity,V=P.angularVelocity;P.vlambda.vmul(P.linearFactor,P.vlambda),F.vadd(P.vlambda,F),P.wlambda.vmul(P.angularFactor,P.wlambda),V.vadd(P.wlambda,V)}let C=r.length;const O=1/p;for(;C--;)r[C].multiplier=x[C]*O}return e}}const GSSolver_solve_lambda=[],GSSolver_solve_invCs=[],GSSolver_solve_Bs=[];class Pool{constructor(){this.objects=[],this.type=Object}release(...n){const t=n.length;for(let e=0;e!==t;e++)this.objects.push(n[e]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(n){const t=this.objects;for(;t.length>n;)t.pop();for(;t.length<n;)t.push(this.constructObject());return this}}class Vec3Pool extends Pool{constructor(...n){super(...n),this.type=Vec3}constructObject(){return new Vec3}}let _COLLISION_TYPES$sphe,_COLLISION_TYPES$sphe2,_COLLISION_TYPES$boxB,_COLLISION_TYPES$sphe3,_COLLISION_TYPES$plan,_COLLISION_TYPES$conv,_COLLISION_TYPES$sphe4,_COLLISION_TYPES$plan2,_COLLISION_TYPES$boxC,_COLLISION_TYPES$sphe5,_COLLISION_TYPES$boxH,_COLLISION_TYPES$conv2,_COLLISION_TYPES$sphe6,_COLLISION_TYPES$plan3,_COLLISION_TYPES$boxP,_COLLISION_TYPES$conv3,_COLLISION_TYPES$cyli,_COLLISION_TYPES$sphe7,_COLLISION_TYPES$plan4,_COLLISION_TYPES$boxC2,_COLLISION_TYPES$conv4,_COLLISION_TYPES$heig,_COLLISION_TYPES$part,_COLLISION_TYPES$sphe8,_COLLISION_TYPES$plan5;const COLLISION_TYPES={sphereSphere:Shape.types.SPHERE,spherePlane:Shape.types.SPHERE|Shape.types.PLANE,boxBox:Shape.types.BOX|Shape.types.BOX,sphereBox:Shape.types.SPHERE|Shape.types.BOX,planeBox:Shape.types.PLANE|Shape.types.BOX,convexConvex:Shape.types.CONVEXPOLYHEDRON,sphereConvex:Shape.types.SPHERE|Shape.types.CONVEXPOLYHEDRON,planeConvex:Shape.types.PLANE|Shape.types.CONVEXPOLYHEDRON,boxConvex:Shape.types.BOX|Shape.types.CONVEXPOLYHEDRON,sphereHeightfield:Shape.types.SPHERE|Shape.types.HEIGHTFIELD,boxHeightfield:Shape.types.BOX|Shape.types.HEIGHTFIELD,convexHeightfield:Shape.types.CONVEXPOLYHEDRON|Shape.types.HEIGHTFIELD,sphereParticle:Shape.types.PARTICLE|Shape.types.SPHERE,planeParticle:Shape.types.PLANE|Shape.types.PARTICLE,boxParticle:Shape.types.BOX|Shape.types.PARTICLE,convexParticle:Shape.types.PARTICLE|Shape.types.CONVEXPOLYHEDRON,cylinderCylinder:Shape.types.CYLINDER,sphereCylinder:Shape.types.SPHERE|Shape.types.CYLINDER,planeCylinder:Shape.types.PLANE|Shape.types.CYLINDER,boxCylinder:Shape.types.BOX|Shape.types.CYLINDER,convexCylinder:Shape.types.CONVEXPOLYHEDRON|Shape.types.CYLINDER,heightfieldCylinder:Shape.types.HEIGHTFIELD|Shape.types.CYLINDER,particleCylinder:Shape.types.PARTICLE|Shape.types.CYLINDER,sphereTrimesh:Shape.types.SPHERE|Shape.types.TRIMESH,planeTrimesh:Shape.types.PLANE|Shape.types.TRIMESH};_COLLISION_TYPES$sphe=COLLISION_TYPES.sphereSphere;_COLLISION_TYPES$sphe2=COLLISION_TYPES.spherePlane;_COLLISION_TYPES$boxB=COLLISION_TYPES.boxBox;_COLLISION_TYPES$sphe3=COLLISION_TYPES.sphereBox;_COLLISION_TYPES$plan=COLLISION_TYPES.planeBox;_COLLISION_TYPES$conv=COLLISION_TYPES.convexConvex;_COLLISION_TYPES$sphe4=COLLISION_TYPES.sphereConvex;_COLLISION_TYPES$plan2=COLLISION_TYPES.planeConvex;_COLLISION_TYPES$boxC=COLLISION_TYPES.boxConvex;_COLLISION_TYPES$sphe5=COLLISION_TYPES.sphereHeightfield;_COLLISION_TYPES$boxH=COLLISION_TYPES.boxHeightfield;_COLLISION_TYPES$conv2=COLLISION_TYPES.convexHeightfield;_COLLISION_TYPES$sphe6=COLLISION_TYPES.sphereParticle;_COLLISION_TYPES$plan3=COLLISION_TYPES.planeParticle;_COLLISION_TYPES$boxP=COLLISION_TYPES.boxParticle;_COLLISION_TYPES$conv3=COLLISION_TYPES.convexParticle;_COLLISION_TYPES$cyli=COLLISION_TYPES.cylinderCylinder;_COLLISION_TYPES$sphe7=COLLISION_TYPES.sphereCylinder;_COLLISION_TYPES$plan4=COLLISION_TYPES.planeCylinder;_COLLISION_TYPES$boxC2=COLLISION_TYPES.boxCylinder;_COLLISION_TYPES$conv4=COLLISION_TYPES.convexCylinder;_COLLISION_TYPES$heig=COLLISION_TYPES.heightfieldCylinder;_COLLISION_TYPES$part=COLLISION_TYPES.particleCylinder;_COLLISION_TYPES$sphe8=COLLISION_TYPES.sphereTrimesh;_COLLISION_TYPES$plan5=COLLISION_TYPES.planeTrimesh;class Narrowphase{get[_COLLISION_TYPES$sphe](){return this.sphereSphere}get[_COLLISION_TYPES$sphe2](){return this.spherePlane}get[_COLLISION_TYPES$boxB](){return this.boxBox}get[_COLLISION_TYPES$sphe3](){return this.sphereBox}get[_COLLISION_TYPES$plan](){return this.planeBox}get[_COLLISION_TYPES$conv](){return this.convexConvex}get[_COLLISION_TYPES$sphe4](){return this.sphereConvex}get[_COLLISION_TYPES$plan2](){return this.planeConvex}get[_COLLISION_TYPES$boxC](){return this.boxConvex}get[_COLLISION_TYPES$sphe5](){return this.sphereHeightfield}get[_COLLISION_TYPES$boxH](){return this.boxHeightfield}get[_COLLISION_TYPES$conv2](){return this.convexHeightfield}get[_COLLISION_TYPES$sphe6](){return this.sphereParticle}get[_COLLISION_TYPES$plan3](){return this.planeParticle}get[_COLLISION_TYPES$boxP](){return this.boxParticle}get[_COLLISION_TYPES$conv3](){return this.convexParticle}get[_COLLISION_TYPES$cyli](){return this.convexConvex}get[_COLLISION_TYPES$sphe7](){return this.sphereConvex}get[_COLLISION_TYPES$plan4](){return this.planeConvex}get[_COLLISION_TYPES$boxC2](){return this.boxConvex}get[_COLLISION_TYPES$conv4](){return this.convexConvex}get[_COLLISION_TYPES$heig](){return this.heightfieldCylinder}get[_COLLISION_TYPES$part](){return this.particleCylinder}get[_COLLISION_TYPES$sphe8](){return this.sphereTrimesh}get[_COLLISION_TYPES$plan5](){return this.planeTrimesh}constructor(n){this.contactPointPool=void 0,this.frictionEquationPool=void 0,this.result=void 0,this.frictionResult=void 0,this.v3pool=void 0,this.world=void 0,this.currentContactMaterial=void 0,this.enableFrictionReduction=void 0,this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new Vec3Pool,this.world=n,this.currentContactMaterial=n.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(n,t,e,i,s,r){let o;this.contactPointPool.length?(o=this.contactPointPool.pop(),o.bi=n,o.bj=t):o=new ContactEquation(n,t),o.enabled=n.collisionResponse&&t.collisionResponse&&e.collisionResponse&&i.collisionResponse;const h=this.currentContactMaterial;o.restitution=h.restitution,o.setSpookParams(h.contactEquationStiffness,h.contactEquationRelaxation,this.world.dt);const u=e.material||n.material,p=i.material||t.material;return u&&p&&u.restitution>=0&&p.restitution>=0&&(o.restitution=u.restitution*p.restitution),o.si=s||e,o.sj=r||i,o}createFrictionEquationsFromContact(n,t){const e=n.bi,i=n.bj,s=n.si,r=n.sj,o=this.world,h=this.currentContactMaterial;let u=h.friction;const p=s.material||e.material,d=r.material||i.material;if(p&&d&&p.friction>=0&&d.friction>=0&&(u=p.friction*d.friction),u>0){const f=u*o.gravity.length();let g=e.invMass+i.invMass;g>0&&(g=1/g);const _=this.frictionEquationPool,v=_.length?_.pop():new FrictionEquation(e,i,f*g),y=_.length?_.pop():new FrictionEquation(e,i,f*g);return v.bi=y.bi=e,v.bj=y.bj=i,v.minForce=y.minForce=-f*g,v.maxForce=y.maxForce=f*g,v.ri.copy(n.ri),v.rj.copy(n.rj),y.ri.copy(n.ri),y.rj.copy(n.rj),n.ni.tangents(v.t,y.t),v.setSpookParams(h.frictionEquationStiffness,h.frictionEquationRelaxation,o.dt),y.setSpookParams(h.frictionEquationStiffness,h.frictionEquationRelaxation,o.dt),v.enabled=y.enabled=n.enabled,t.push(v,y),!0}return!1}createFrictionFromAverage(n){let t=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(t,this.frictionResult)||n===1)return;const e=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1];averageNormal.setZero(),averageContactPointA.setZero(),averageContactPointB.setZero();const s=t.bi;t.bj;for(let o=0;o!==n;o++)t=this.result[this.result.length-1-o],t.bi!==s?(averageNormal.vadd(t.ni,averageNormal),averageContactPointA.vadd(t.ri,averageContactPointA),averageContactPointB.vadd(t.rj,averageContactPointB)):(averageNormal.vsub(t.ni,averageNormal),averageContactPointA.vadd(t.rj,averageContactPointA),averageContactPointB.vadd(t.ri,averageContactPointB));const r=1/n;averageContactPointA.scale(r,e.ri),averageContactPointB.scale(r,e.rj),i.ri.copy(e.ri),i.rj.copy(e.rj),averageNormal.normalize(),averageNormal.tangents(e.t,i.t)}getContacts(n,t,e,i,s,r,o){this.contactPointPool=s,this.frictionEquationPool=o,this.result=i,this.frictionResult=r;const h=tmpQuat1,u=tmpQuat2,p=tmpVec1,d=tmpVec2;for(let f=0,g=n.length;f!==g;f++){const _=n[f],v=t[f];let y=null;_.material&&v.material&&(y=e.getContactMaterial(_.material,v.material)||null);const E=_.type&Body.KINEMATIC&&v.type&Body.STATIC||_.type&Body.STATIC&&v.type&Body.KINEMATIC||_.type&Body.KINEMATIC&&v.type&Body.KINEMATIC;for(let m=0;m<_.shapes.length;m++){_.quaternion.mult(_.shapeOrientations[m],h),_.quaternion.vmult(_.shapeOffsets[m],p),p.vadd(_.position,p);const x=_.shapes[m];for(let C=0;C<v.shapes.length;C++){v.quaternion.mult(v.shapeOrientations[C],u),v.quaternion.vmult(v.shapeOffsets[C],d),d.vadd(v.position,d);const O=v.shapes[C];if(!(x.collisionFilterMask&O.collisionFilterGroup&&O.collisionFilterMask&x.collisionFilterGroup)||p.distanceTo(d)>x.boundingSphereRadius+O.boundingSphereRadius)continue;let S=null;x.material&&O.material&&(S=e.getContactMaterial(x.material,O.material)||null),this.currentContactMaterial=S||y||e.defaultContactMaterial;const P=x.type|O.type,F=this[P];if(F){let V=!1;x.type<O.type?V=F.call(this,x,O,p,d,h,u,_,v,x,O,E):V=F.call(this,O,x,d,p,u,h,v,_,x,O,E),V&&E&&(e.shapeOverlapKeeper.set(x.id,O.id),e.bodyOverlapKeeper.set(_.id,v.id))}}}}}sphereSphere(n,t,e,i,s,r,o,h,u,p,d){if(d)return e.distanceSquared(i)<(n.radius+t.radius)**2;const f=this.createContactEquation(o,h,n,t,u,p);i.vsub(e,f.ni),f.ni.normalize(),f.ri.copy(f.ni),f.rj.copy(f.ni),f.ri.scale(n.radius,f.ri),f.rj.scale(-t.radius,f.rj),f.ri.vadd(e,f.ri),f.ri.vsub(o.position,f.ri),f.rj.vadd(i,f.rj),f.rj.vsub(h.position,f.rj),this.result.push(f),this.createFrictionEquationsFromContact(f,this.frictionResult)}spherePlane(n,t,e,i,s,r,o,h,u,p,d){const f=this.createContactEquation(o,h,n,t,u,p);if(f.ni.set(0,0,1),r.vmult(f.ni,f.ni),f.ni.negate(f.ni),f.ni.normalize(),f.ni.scale(n.radius,f.ri),e.vsub(i,point_on_plane_to_sphere),f.ni.scale(f.ni.dot(point_on_plane_to_sphere),plane_to_sphere_ortho),point_on_plane_to_sphere.vsub(plane_to_sphere_ortho,f.rj),-point_on_plane_to_sphere.dot(f.ni)<=n.radius){if(d)return!0;const g=f.ri,_=f.rj;g.vadd(e,g),g.vsub(o.position,g),_.vadd(i,_),_.vsub(h.position,_),this.result.push(f),this.createFrictionEquationsFromContact(f,this.frictionResult)}}boxBox(n,t,e,i,s,r,o,h,u,p,d){return n.convexPolyhedronRepresentation.material=n.material,t.convexPolyhedronRepresentation.material=t.material,n.convexPolyhedronRepresentation.collisionResponse=n.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(n.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,e,i,s,r,o,h,n,t,d)}sphereBox(n,t,e,i,s,r,o,h,u,p,d){const f=this.v3pool,g=sphereBox_sides;e.vsub(i,box_to_sphere),t.getSideNormals(g,r);const _=n.radius;let v=!1;const y=sphereBox_side_ns,E=sphereBox_side_ns1,m=sphereBox_side_ns2;let x=null,C=0,O=0,S=0,P=null;for(let M=0,J=g.length;M!==J&&v===!1;M++){const et=sphereBox_ns;et.copy(g[M]);const Q=et.length();et.normalize();const ot=box_to_sphere.dot(et);if(ot<Q+_&&ot>0){const tt=sphereBox_ns1,rt=sphereBox_ns2;tt.copy(g[(M+1)%3]),rt.copy(g[(M+2)%3]);const ft=tt.length(),_t=rt.length();tt.normalize(),rt.normalize();const yt=box_to_sphere.dot(tt),Z=box_to_sphere.dot(rt);if(yt<ft&&yt>-ft&&Z<_t&&Z>-_t){const bt=Math.abs(ot-Q-_);if((P===null||bt<P)&&(P=bt,O=yt,S=Z,x=Q,y.copy(et),E.copy(tt),m.copy(rt),C++,d))return!0}}}if(C){v=!0;const M=this.createContactEquation(o,h,n,t,u,p);y.scale(-_,M.ri),M.ni.copy(y),M.ni.negate(M.ni),y.scale(x,y),E.scale(O,E),y.vadd(E,y),m.scale(S,m),y.vadd(m,M.rj),M.ri.vadd(e,M.ri),M.ri.vsub(o.position,M.ri),M.rj.vadd(i,M.rj),M.rj.vsub(h.position,M.rj),this.result.push(M),this.createFrictionEquationsFromContact(M,this.frictionResult)}let F=f.get();const V=sphereBox_sphere_to_corner;for(let M=0;M!==2&&!v;M++)for(let J=0;J!==2&&!v;J++)for(let et=0;et!==2&&!v;et++)if(F.set(0,0,0),M?F.vadd(g[0],F):F.vsub(g[0],F),J?F.vadd(g[1],F):F.vsub(g[1],F),et?F.vadd(g[2],F):F.vsub(g[2],F),i.vadd(F,V),V.vsub(e,V),V.lengthSquared()<_*_){if(d)return!0;v=!0;const Q=this.createContactEquation(o,h,n,t,u,p);Q.ri.copy(V),Q.ri.normalize(),Q.ni.copy(Q.ri),Q.ri.scale(_,Q.ri),Q.rj.copy(F),Q.ri.vadd(e,Q.ri),Q.ri.vsub(o.position,Q.ri),Q.rj.vadd(i,Q.rj),Q.rj.vsub(h.position,Q.rj),this.result.push(Q),this.createFrictionEquationsFromContact(Q,this.frictionResult)}f.release(F),F=null;const N=f.get(),B=f.get(),W=f.get(),A=f.get(),G=f.get(),D=g.length;for(let M=0;M!==D&&!v;M++)for(let J=0;J!==D&&!v;J++)if(M%3!==J%3){g[J].cross(g[M],N),N.normalize(),g[M].vadd(g[J],B),W.copy(e),W.vsub(B,W),W.vsub(i,W);const et=W.dot(N);N.scale(et,A);let Q=0;for(;Q===M%3||Q===J%3;)Q++;G.copy(e),G.vsub(A,G),G.vsub(B,G),G.vsub(i,G);const ot=Math.abs(et),tt=G.length();if(ot<g[Q].length()&&tt<_){if(d)return!0;v=!0;const rt=this.createContactEquation(o,h,n,t,u,p);B.vadd(A,rt.rj),rt.rj.copy(rt.rj),G.negate(rt.ni),rt.ni.normalize(),rt.ri.copy(rt.rj),rt.ri.vadd(i,rt.ri),rt.ri.vsub(e,rt.ri),rt.ri.normalize(),rt.ri.scale(_,rt.ri),rt.ri.vadd(e,rt.ri),rt.ri.vsub(o.position,rt.ri),rt.rj.vadd(i,rt.rj),rt.rj.vsub(h.position,rt.rj),this.result.push(rt),this.createFrictionEquationsFromContact(rt,this.frictionResult)}}f.release(N,B,W,A,G)}planeBox(n,t,e,i,s,r,o,h,u,p,d){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(n,t.convexPolyhedronRepresentation,e,i,s,r,o,h,n,t,d)}convexConvex(n,t,e,i,s,r,o,h,u,p,d,f,g){const _=convexConvex_sepAxis;if(!(e.distanceTo(i)>n.boundingSphereRadius+t.boundingSphereRadius)&&n.findSeparatingAxis(t,e,s,i,r,_,f,g)){const v=[],y=convexConvex_q;n.clipAgainstHull(e,s,t,i,r,_,-100,100,v);let E=0;for(let m=0;m!==v.length;m++){if(d)return!0;const x=this.createContactEquation(o,h,n,t,u,p),C=x.ri,O=x.rj;_.negate(x.ni),v[m].normal.negate(y),y.scale(v[m].depth,y),v[m].point.vadd(y,C),O.copy(v[m].point),C.vsub(e,C),O.vsub(i,O),C.vadd(e,C),C.vsub(o.position,C),O.vadd(i,O),O.vsub(h.position,O),this.result.push(x),E++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(x,this.frictionResult)}this.enableFrictionReduction&&E&&this.createFrictionFromAverage(E)}}sphereConvex(n,t,e,i,s,r,o,h,u,p,d){const f=this.v3pool;e.vsub(i,convex_to_sphere);const g=t.faceNormals,_=t.faces,v=t.vertices,y=n.radius;let E=!1;for(let m=0;m!==v.length;m++){const x=v[m],C=sphereConvex_worldCorner;r.vmult(x,C),i.vadd(C,C);const O=sphereConvex_sphereToCorner;if(C.vsub(e,O),O.lengthSquared()<y*y){if(d)return!0;E=!0;const S=this.createContactEquation(o,h,n,t,u,p);S.ri.copy(O),S.ri.normalize(),S.ni.copy(S.ri),S.ri.scale(y,S.ri),C.vsub(i,S.rj),S.ri.vadd(e,S.ri),S.ri.vsub(o.position,S.ri),S.rj.vadd(i,S.rj),S.rj.vsub(h.position,S.rj),this.result.push(S),this.createFrictionEquationsFromContact(S,this.frictionResult);return}}for(let m=0,x=_.length;m!==x&&E===!1;m++){const C=g[m],O=_[m],S=sphereConvex_worldNormal;r.vmult(C,S);const P=sphereConvex_worldPoint;r.vmult(v[O[0]],P),P.vadd(i,P);const F=sphereConvex_worldSpherePointClosestToPlane;S.scale(-y,F),e.vadd(F,F);const V=sphereConvex_penetrationVec;F.vsub(P,V);const N=V.dot(S),B=sphereConvex_sphereToWorldPoint;if(e.vsub(P,B),N<0&&B.dot(S)>0){const W=[];for(let A=0,G=O.length;A!==G;A++){const D=f.get();r.vmult(v[O[A]],D),i.vadd(D,D),W.push(D)}if(pointInPolygon(W,S,e)){if(d)return!0;E=!0;const A=this.createContactEquation(o,h,n,t,u,p);S.scale(-y,A.ri),S.negate(A.ni);const G=f.get();S.scale(-N,G);const D=f.get();S.scale(-y,D),e.vsub(i,A.rj),A.rj.vadd(D,A.rj),A.rj.vadd(G,A.rj),A.rj.vadd(i,A.rj),A.rj.vsub(h.position,A.rj),A.ri.vadd(e,A.ri),A.ri.vsub(o.position,A.ri),f.release(G),f.release(D),this.result.push(A),this.createFrictionEquationsFromContact(A,this.frictionResult);for(let M=0,J=W.length;M!==J;M++)f.release(W[M]);return}else for(let A=0;A!==O.length;A++){const G=f.get(),D=f.get();r.vmult(v[O[(A+1)%O.length]],G),r.vmult(v[O[(A+2)%O.length]],D),i.vadd(G,G),i.vadd(D,D);const M=sphereConvex_edge;D.vsub(G,M);const J=sphereConvex_edgeUnit;M.unit(J);const et=f.get(),Q=f.get();e.vsub(G,Q);const ot=Q.dot(J);J.scale(ot,et),et.vadd(G,et);const tt=f.get();if(et.vsub(e,tt),ot>0&&ot*ot<M.lengthSquared()&&tt.lengthSquared()<y*y){if(d)return!0;const rt=this.createContactEquation(o,h,n,t,u,p);et.vsub(i,rt.rj),et.vsub(e,rt.ni),rt.ni.normalize(),rt.ni.scale(y,rt.ri),rt.rj.vadd(i,rt.rj),rt.rj.vsub(h.position,rt.rj),rt.ri.vadd(e,rt.ri),rt.ri.vsub(o.position,rt.ri),this.result.push(rt),this.createFrictionEquationsFromContact(rt,this.frictionResult);for(let ft=0,_t=W.length;ft!==_t;ft++)f.release(W[ft]);f.release(G),f.release(D),f.release(et),f.release(tt),f.release(Q);return}f.release(G),f.release(D),f.release(et),f.release(tt),f.release(Q)}for(let A=0,G=W.length;A!==G;A++)f.release(W[A])}}}planeConvex(n,t,e,i,s,r,o,h,u,p,d){const f=planeConvex_v,g=planeConvex_normal;g.set(0,0,1),s.vmult(g,g);let _=0;const v=planeConvex_relpos;for(let y=0;y!==t.vertices.length;y++)if(f.copy(t.vertices[y]),r.vmult(f,f),i.vadd(f,f),f.vsub(e,v),g.dot(v)<=0){if(d)return!0;const m=this.createContactEquation(o,h,n,t,u,p),x=planeConvex_projected;g.scale(g.dot(v),x),f.vsub(x,x),x.vsub(e,m.ri),m.ni.copy(g),f.vsub(i,m.rj),m.ri.vadd(e,m.ri),m.ri.vsub(o.position,m.ri),m.rj.vadd(i,m.rj),m.rj.vsub(h.position,m.rj),this.result.push(m),_++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(m,this.frictionResult)}this.enableFrictionReduction&&_&&this.createFrictionFromAverage(_)}boxConvex(n,t,e,i,s,r,o,h,u,p,d){return n.convexPolyhedronRepresentation.material=n.material,n.convexPolyhedronRepresentation.collisionResponse=n.collisionResponse,this.convexConvex(n.convexPolyhedronRepresentation,t,e,i,s,r,o,h,n,t,d)}sphereHeightfield(n,t,e,i,s,r,o,h,u,p,d){const f=t.data,g=n.radius,_=t.elementSize,v=sphereHeightfield_tmp2,y=sphereHeightfield_tmp1;Transform.pointToLocalFrame(i,r,e,y);let E=Math.floor((y.x-g)/_)-1,m=Math.ceil((y.x+g)/_)+1,x=Math.floor((y.y-g)/_)-1,C=Math.ceil((y.y+g)/_)+1;if(m<0||C<0||E>f.length||x>f[0].length)return;E<0&&(E=0),m<0&&(m=0),x<0&&(x=0),C<0&&(C=0),E>=f.length&&(E=f.length-1),m>=f.length&&(m=f.length-1),C>=f[0].length&&(C=f[0].length-1),x>=f[0].length&&(x=f[0].length-1);const O=[];t.getRectMinMax(E,x,m,C,O);const S=O[0],P=O[1];if(y.z-g>P||y.z+g<S)return;const F=this.result;for(let V=E;V<m;V++)for(let N=x;N<C;N++){const B=F.length;let W=!1;if(t.getConvexTrianglePillar(V,N,!1),Transform.pointToWorldFrame(i,r,t.pillarOffset,v),e.distanceTo(v)<t.pillarConvex.boundingSphereRadius+n.boundingSphereRadius&&(W=this.sphereConvex(n,t.pillarConvex,e,v,s,r,o,h,n,t,d)),d&&W||(t.getConvexTrianglePillar(V,N,!0),Transform.pointToWorldFrame(i,r,t.pillarOffset,v),e.distanceTo(v)<t.pillarConvex.boundingSphereRadius+n.boundingSphereRadius&&(W=this.sphereConvex(n,t.pillarConvex,e,v,s,r,o,h,n,t,d)),d&&W))return!0;if(F.length-B>2)return}}boxHeightfield(n,t,e,i,s,r,o,h,u,p,d){return n.convexPolyhedronRepresentation.material=n.material,n.convexPolyhedronRepresentation.collisionResponse=n.collisionResponse,this.convexHeightfield(n.convexPolyhedronRepresentation,t,e,i,s,r,o,h,n,t,d)}convexHeightfield(n,t,e,i,s,r,o,h,u,p,d){const f=t.data,g=t.elementSize,_=n.boundingSphereRadius,v=convexHeightfield_tmp2,y=convexHeightfield_faceList,E=convexHeightfield_tmp1;Transform.pointToLocalFrame(i,r,e,E);let m=Math.floor((E.x-_)/g)-1,x=Math.ceil((E.x+_)/g)+1,C=Math.floor((E.y-_)/g)-1,O=Math.ceil((E.y+_)/g)+1;if(x<0||O<0||m>f.length||C>f[0].length)return;m<0&&(m=0),x<0&&(x=0),C<0&&(C=0),O<0&&(O=0),m>=f.length&&(m=f.length-1),x>=f.length&&(x=f.length-1),O>=f[0].length&&(O=f[0].length-1),C>=f[0].length&&(C=f[0].length-1);const S=[];t.getRectMinMax(m,C,x,O,S);const P=S[0],F=S[1];if(!(E.z-_>F||E.z+_<P))for(let V=m;V<x;V++)for(let N=C;N<O;N++){let B=!1;if(t.getConvexTrianglePillar(V,N,!1),Transform.pointToWorldFrame(i,r,t.pillarOffset,v),e.distanceTo(v)<t.pillarConvex.boundingSphereRadius+n.boundingSphereRadius&&(B=this.convexConvex(n,t.pillarConvex,e,v,s,r,o,h,null,null,d,y,null)),d&&B||(t.getConvexTrianglePillar(V,N,!0),Transform.pointToWorldFrame(i,r,t.pillarOffset,v),e.distanceTo(v)<t.pillarConvex.boundingSphereRadius+n.boundingSphereRadius&&(B=this.convexConvex(n,t.pillarConvex,e,v,s,r,o,h,null,null,d,y,null)),d&&B))return!0}}sphereParticle(n,t,e,i,s,r,o,h,u,p,d){const f=particleSphere_normal;if(f.set(0,0,1),i.vsub(e,f),f.lengthSquared()<=n.radius*n.radius){if(d)return!0;const _=this.createContactEquation(h,o,t,n,u,p);f.normalize(),_.rj.copy(f),_.rj.scale(n.radius,_.rj),_.ni.copy(f),_.ni.negate(_.ni),_.ri.set(0,0,0),this.result.push(_),this.createFrictionEquationsFromContact(_,this.frictionResult)}}planeParticle(n,t,e,i,s,r,o,h,u,p,d){const f=particlePlane_normal;f.set(0,0,1),o.quaternion.vmult(f,f);const g=particlePlane_relpos;if(i.vsub(o.position,g),f.dot(g)<=0){if(d)return!0;const v=this.createContactEquation(h,o,t,n,u,p);v.ni.copy(f),v.ni.negate(v.ni),v.ri.set(0,0,0);const y=particlePlane_projected;f.scale(f.dot(i),y),i.vsub(y,y),v.rj.copy(y),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult)}}boxParticle(n,t,e,i,s,r,o,h,u,p,d){return n.convexPolyhedronRepresentation.material=n.material,n.convexPolyhedronRepresentation.collisionResponse=n.collisionResponse,this.convexParticle(n.convexPolyhedronRepresentation,t,e,i,s,r,o,h,n,t,d)}convexParticle(n,t,e,i,s,r,o,h,u,p,d){let f=-1;const g=convexParticle_penetratedFaceNormal,_=convexParticle_worldPenetrationVec;let v=null;const y=convexParticle_local;if(y.copy(i),y.vsub(e,y),s.conjugate(cqj),cqj.vmult(y,y),n.pointIsInside(y)){n.worldVerticesNeedsUpdate&&n.computeWorldVertices(e,s),n.worldFaceNormalsNeedsUpdate&&n.computeWorldFaceNormals(s);for(let E=0,m=n.faces.length;E!==m;E++){const x=[n.worldVertices[n.faces[E][0]]],C=n.worldFaceNormals[E];i.vsub(x[0],convexParticle_vertexToParticle);const O=-C.dot(convexParticle_vertexToParticle);if(v===null||Math.abs(O)<Math.abs(v)){if(d)return!0;v=O,f=E,g.copy(C)}}if(f!==-1){const E=this.createContactEquation(h,o,t,n,u,p);g.scale(v,_),_.vadd(i,_),_.vsub(e,_),E.rj.copy(_),g.negate(E.ni),E.ri.set(0,0,0);const m=E.ri,x=E.rj;m.vadd(i,m),m.vsub(h.position,m),x.vadd(e,x),x.vsub(o.position,x),this.result.push(E),this.createFrictionEquationsFromContact(E,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(n,t,e,i,s,r,o,h,u,p,d){return this.convexHeightfield(t,n,i,e,r,s,h,o,u,p,d)}particleCylinder(n,t,e,i,s,r,o,h,u,p,d){return this.convexParticle(t,n,i,e,r,s,h,o,u,p,d)}sphereTrimesh(n,t,e,i,s,r,o,h,u,p,d){const f=sphereTrimesh_edgeVertexA,g=sphereTrimesh_edgeVertexB,_=sphereTrimesh_edgeVector,v=sphereTrimesh_edgeVectorUnit,y=sphereTrimesh_localSpherePos,E=sphereTrimesh_tmp,m=sphereTrimesh_localSphereAABB,x=sphereTrimesh_v2,C=sphereTrimesh_relpos,O=sphereTrimesh_triangles;Transform.pointToLocalFrame(i,r,e,y);const S=n.radius;m.lowerBound.set(y.x-S,y.y-S,y.z-S),m.upperBound.set(y.x+S,y.y+S,y.z+S),t.getTrianglesInAABB(m,O);const P=sphereTrimesh_v,F=n.radius*n.radius;for(let A=0;A<O.length;A++)for(let G=0;G<3;G++)if(t.getVertex(t.indices[O[A]*3+G],P),P.vsub(y,C),C.lengthSquared()<=F){if(x.copy(P),Transform.pointToWorldFrame(i,r,x,P),P.vsub(e,C),d)return!0;let D=this.createContactEquation(o,h,n,t,u,p);D.ni.copy(C),D.ni.normalize(),D.ri.copy(D.ni),D.ri.scale(n.radius,D.ri),D.ri.vadd(e,D.ri),D.ri.vsub(o.position,D.ri),D.rj.copy(P),D.rj.vsub(h.position,D.rj),this.result.push(D),this.createFrictionEquationsFromContact(D,this.frictionResult)}for(let A=0;A<O.length;A++)for(let G=0;G<3;G++){t.getVertex(t.indices[O[A]*3+G],f),t.getVertex(t.indices[O[A]*3+(G+1)%3],g),g.vsub(f,_),y.vsub(g,E);const D=E.dot(_);y.vsub(f,E);let M=E.dot(_);if(M>0&&D<0&&(y.vsub(f,E),v.copy(_),v.normalize(),M=E.dot(v),v.scale(M,E),E.vadd(f,E),E.distanceTo(y)<n.radius)){if(d)return!0;const et=this.createContactEquation(o,h,n,t,u,p);E.vsub(y,et.ni),et.ni.normalize(),et.ni.scale(n.radius,et.ri),et.ri.vadd(e,et.ri),et.ri.vsub(o.position,et.ri),Transform.pointToWorldFrame(i,r,E,E),E.vsub(h.position,et.rj),Transform.vectorToWorldFrame(r,et.ni,et.ni),Transform.vectorToWorldFrame(r,et.ri,et.ri),this.result.push(et),this.createFrictionEquationsFromContact(et,this.frictionResult)}}const V=sphereTrimesh_va,N=sphereTrimesh_vb,B=sphereTrimesh_vc,W=sphereTrimesh_normal;for(let A=0,G=O.length;A!==G;A++){t.getTriangleVertices(O[A],V,N,B),t.getNormal(O[A],W),y.vsub(V,E);let D=E.dot(W);if(W.scale(D,E),y.vsub(E,E),D=E.distanceTo(y),Ray.pointInTriangle(E,V,N,B)&&D<n.radius){if(d)return!0;let M=this.createContactEquation(o,h,n,t,u,p);E.vsub(y,M.ni),M.ni.normalize(),M.ni.scale(n.radius,M.ri),M.ri.vadd(e,M.ri),M.ri.vsub(o.position,M.ri),Transform.pointToWorldFrame(i,r,E,E),E.vsub(h.position,M.rj),Transform.vectorToWorldFrame(r,M.ni,M.ni),Transform.vectorToWorldFrame(r,M.ri,M.ri),this.result.push(M),this.createFrictionEquationsFromContact(M,this.frictionResult)}}O.length=0}planeTrimesh(n,t,e,i,s,r,o,h,u,p,d){const f=new Vec3,g=planeTrimesh_normal;g.set(0,0,1),s.vmult(g,g);for(let _=0;_<t.vertices.length/3;_++){t.getVertex(_,f);const v=new Vec3;v.copy(f),Transform.pointToWorldFrame(i,r,v,f);const y=planeTrimesh_relpos;if(f.vsub(e,y),g.dot(y)<=0){if(d)return!0;const m=this.createContactEquation(o,h,n,t,u,p);m.ni.copy(g);const x=planeTrimesh_projected;g.scale(y.dot(g),x),f.vsub(x,x),m.ri.copy(x),m.ri.vsub(o.position,m.ri),m.rj.copy(f),m.rj.vsub(h.position,m.rj),this.result.push(m),this.createFrictionEquationsFromContact(m,this.frictionResult)}}}}const averageNormal=new Vec3,averageContactPointA=new Vec3,averageContactPointB=new Vec3,tmpVec1=new Vec3,tmpVec2=new Vec3,tmpQuat1=new Quaternion,tmpQuat2=new Quaternion,planeTrimesh_normal=new Vec3,planeTrimesh_relpos=new Vec3,planeTrimesh_projected=new Vec3,sphereTrimesh_normal=new Vec3,sphereTrimesh_relpos=new Vec3,sphereTrimesh_v=new Vec3,sphereTrimesh_v2=new Vec3,sphereTrimesh_edgeVertexA=new Vec3,sphereTrimesh_edgeVertexB=new Vec3,sphereTrimesh_edgeVector=new Vec3,sphereTrimesh_edgeVectorUnit=new Vec3,sphereTrimesh_localSpherePos=new Vec3,sphereTrimesh_tmp=new Vec3,sphereTrimesh_va=new Vec3,sphereTrimesh_vb=new Vec3,sphereTrimesh_vc=new Vec3,sphereTrimesh_localSphereAABB=new AABB,sphereTrimesh_triangles=[],point_on_plane_to_sphere=new Vec3,plane_to_sphere_ortho=new Vec3,pointInPolygon_edge=new Vec3,pointInPolygon_edge_x_normal=new Vec3,pointInPolygon_vtp=new Vec3;function pointInPolygon(l,n,t){let e=null;const i=l.length;for(let s=0;s!==i;s++){const r=l[s],o=pointInPolygon_edge;l[(s+1)%i].vsub(r,o);const h=pointInPolygon_edge_x_normal;o.cross(n,h);const u=pointInPolygon_vtp;t.vsub(r,u);const p=h.dot(u);if(e===null||p>0&&e===!0||p<=0&&e===!1){e===null&&(e=p>0);continue}else return!1}return!0}const box_to_sphere=new Vec3,sphereBox_ns=new Vec3,sphereBox_ns1=new Vec3,sphereBox_ns2=new Vec3,sphereBox_sides=[new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3],sphereBox_sphere_to_corner=new Vec3,sphereBox_side_ns=new Vec3,sphereBox_side_ns1=new Vec3,sphereBox_side_ns2=new Vec3,convex_to_sphere=new Vec3,sphereConvex_edge=new Vec3,sphereConvex_edgeUnit=new Vec3,sphereConvex_sphereToCorner=new Vec3,sphereConvex_worldCorner=new Vec3,sphereConvex_worldNormal=new Vec3,sphereConvex_worldPoint=new Vec3,sphereConvex_worldSpherePointClosestToPlane=new Vec3,sphereConvex_penetrationVec=new Vec3,sphereConvex_sphereToWorldPoint=new Vec3,planeConvex_v=new Vec3,planeConvex_normal=new Vec3,planeConvex_relpos=new Vec3,planeConvex_projected=new Vec3,convexConvex_sepAxis=new Vec3,convexConvex_q=new Vec3,particlePlane_normal=new Vec3,particlePlane_relpos=new Vec3,particlePlane_projected=new Vec3,particleSphere_normal=new Vec3,cqj=new Quaternion,convexParticle_local=new Vec3,convexParticle_penetratedFaceNormal=new Vec3,convexParticle_vertexToParticle=new Vec3,convexParticle_worldPenetrationVec=new Vec3,convexHeightfield_tmp1=new Vec3,convexHeightfield_tmp2=new Vec3,convexHeightfield_faceList=[0],sphereHeightfield_tmp1=new Vec3,sphereHeightfield_tmp2=new Vec3;class OverlapKeeper{constructor(){this.current=void 0,this.previous=void 0,this.current=[],this.previous=[]}getKey(n,t){if(t<n){const e=t;t=n,n=e}return n<<16|t}set(n,t){const e=this.getKey(n,t),i=this.current;let s=0;for(;e>i[s];)s++;if(e!==i[s]){for(let r=i.length-1;r>=s;r--)i[r+1]=i[r];i[s]=e}}tick(){const n=this.current;this.current=this.previous,this.previous=n,this.current.length=0}getDiff(n,t){const e=this.current,i=this.previous,s=e.length,r=i.length;let o=0;for(let h=0;h<s;h++){let u=!1;const p=e[h];for(;p>i[o];)o++;u=p===i[o],u||unpackAndPush(n,p)}o=0;for(let h=0;h<r;h++){let u=!1;const p=i[h];for(;p>e[o];)o++;u=e[o]===p,u||unpackAndPush(t,p)}}}function unpackAndPush(l,n){l.push((n&4294901760)>>16,n&65535)}class TupleDictionary{constructor(){this.data={keys:[]}}get(n,t){if(n>t){const e=t;t=n,n=e}return this.data[n+"-"+t]}set(n,t,e){if(n>t){const s=t;t=n,n=s}const i=n+"-"+t;this.get(n,t)||this.data.keys.push(i),this.data[i]=e}reset(){const n=this.data,t=n.keys;for(;t.length>0;){const e=t.pop();delete n[e]}}}class World extends EventTarget{constructor(n={}){super(),this.dt=void 0,this.allowSleep=void 0,this.contacts=void 0,this.frictionEquations=void 0,this.quatNormalizeSkip=void 0,this.quatNormalizeFast=void 0,this.time=void 0,this.stepnumber=void 0,this.default_dt=void 0,this.nextId=void 0,this.gravity=void 0,this.broadphase=void 0,this.bodies=void 0,this.hasActiveBodies=void 0,this.solver=void 0,this.constraints=void 0,this.narrowphase=void 0,this.collisionMatrix=void 0,this.collisionMatrixPrevious=void 0,this.bodyOverlapKeeper=void 0,this.shapeOverlapKeeper=void 0,this.materials=void 0,this.contactmaterials=void 0,this.contactMaterialTable=void 0,this.defaultMaterial=void 0,this.defaultContactMaterial=void 0,this.doProfiling=void 0,this.profile=void 0,this.accumulator=void 0,this.subsystems=void 0,this.addBodyEvent=void 0,this.removeBodyEvent=void 0,this.idToBodyMap=void 0,this.dt=-1,this.allowSleep=!!n.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=n.quatNormalizeSkip!==void 0?n.quatNormalizeSkip:0,this.quatNormalizeFast=n.quatNormalizeFast!==void 0?n.quatNormalizeFast:!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new Vec3,n.gravity&&this.gravity.copy(n.gravity),this.broadphase=n.broadphase!==void 0?n.broadphase:new NaiveBroadphase,this.bodies=[],this.hasActiveBodies=!1,this.solver=n.solver!==void 0?n.solver:new GSSolver,this.constraints=[],this.narrowphase=new Narrowphase(this),this.collisionMatrix=new ArrayCollisionMatrix,this.collisionMatrixPrevious=new ArrayCollisionMatrix,this.bodyOverlapKeeper=new OverlapKeeper,this.shapeOverlapKeeper=new OverlapKeeper,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new TupleDictionary,this.defaultMaterial=new Material("default"),this.defaultContactMaterial=new ContactMaterial(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(n,t){return this.contactMaterialTable.get(n.id,t.id)}numObjects(){return this.bodies.length}collisionMatrixTick(){const n=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=n,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(n){this.constraints.push(n)}removeConstraint(n){const t=this.constraints.indexOf(n);t!==-1&&this.constraints.splice(t,1)}rayTest(n,t,e){e instanceof RaycastResult?this.raycastClosest(n,t,{skipBackfaces:!0},e):this.raycastAll(n,t,{skipBackfaces:!0},e)}raycastAll(n,t,e={},i){return e.mode=Ray.ALL,e.from=n,e.to=t,e.callback=i,tmpRay.intersectWorld(this,e)}raycastAny(n,t,e={},i){return e.mode=Ray.ANY,e.from=n,e.to=t,e.result=i,tmpRay.intersectWorld(this,e)}raycastClosest(n,t,e={},i){return e.mode=Ray.CLOSEST,e.from=n,e.to=t,e.result=i,tmpRay.intersectWorld(this,e)}addBody(n){this.bodies.includes(n)||(n.index=this.bodies.length,this.bodies.push(n),n.world=this,n.initPosition.copy(n.position),n.initVelocity.copy(n.velocity),n.timeLastSleepy=this.time,n instanceof Body&&(n.initAngularVelocity.copy(n.angularVelocity),n.initQuaternion.copy(n.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=n,this.idToBodyMap[n.id]=n,this.dispatchEvent(this.addBodyEvent))}removeBody(n){n.world=null;const t=this.bodies.length-1,e=this.bodies,i=e.indexOf(n);if(i!==-1){e.splice(i,1);for(let s=0;s!==e.length;s++)e[s].index=s;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=n,delete this.idToBodyMap[n.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(n){return this.idToBodyMap[n]}getShapeById(n){const t=this.bodies;for(let e=0;e<t.length;e++){const i=t[e].shapes;for(let s=0;s<i.length;s++){const r=i[s];if(r.id===n)return r}}return null}addMaterial(n){this.materials.push(n)}addContactMaterial(n){this.contactmaterials.push(n),this.contactMaterialTable.set(n.materials[0].id,n.materials[1].id,n)}step(n,t,e=10){if(t===void 0)this.internalStep(n),this.time+=n;else{this.accumulator+=t;const i=performance$1.now();let s=0;for(;this.accumulator>=n&&s<e&&(this.internalStep(n),this.accumulator-=n,s++,!(performance$1.now()-i>n*1e3)););this.accumulator=this.accumulator%n;const r=this.accumulator/n;for(let o=0;o!==this.bodies.length;o++){const h=this.bodies[o];h.previousPosition.lerp(h.position,r,h.interpolatedPosition),h.previousQuaternion.slerp(h.quaternion,r,h.interpolatedQuaternion),h.previousQuaternion.normalize()}this.time+=t}}internalStep(n){this.dt=n;const t=this.contacts,e=World_step_p1,i=World_step_p2,s=this.numObjects(),r=this.bodies,o=this.solver,h=this.gravity,u=this.doProfiling,p=this.profile,d=Body.DYNAMIC;let f=-1/0;const g=this.constraints,_=World_step_frictionEquationPool;h.length();const v=h.x,y=h.y,E=h.z;let m=0;for(u&&(f=performance$1.now()),m=0;m!==s;m++){const A=r[m];if(A.type===d){const G=A.force,D=A.mass;G.x+=D*v,G.y+=D*y,G.z+=D*E}}for(let A=0,G=this.subsystems.length;A!==G;A++)this.subsystems[A].update();u&&(f=performance$1.now()),e.length=0,i.length=0,this.broadphase.collisionPairs(this,e,i),u&&(p.broadphase=performance$1.now()-f);let x=g.length;for(m=0;m!==x;m++){const A=g[m];if(!A.collideConnected)for(let G=e.length-1;G>=0;G-=1)(A.bodyA===e[G]&&A.bodyB===i[G]||A.bodyB===e[G]&&A.bodyA===i[G])&&(e.splice(G,1),i.splice(G,1))}this.collisionMatrixTick(),u&&(f=performance$1.now());const C=World_step_oldContacts,O=t.length;for(m=0;m!==O;m++)C.push(t[m]);t.length=0;const S=this.frictionEquations.length;for(m=0;m!==S;m++)_.push(this.frictionEquations[m]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(e,i,this,t,C,this.frictionEquations,_),u&&(p.narrowphase=performance$1.now()-f),u&&(f=performance$1.now()),m=0;m<this.frictionEquations.length;m++)o.addEquation(this.frictionEquations[m]);const P=t.length;for(let A=0;A!==P;A++){const G=t[A],D=G.bi,M=G.bj,J=G.si,et=G.sj;let Q;if(D.material&&M.material?Q=this.getContactMaterial(D.material,M.material)||this.defaultContactMaterial:Q=this.defaultContactMaterial,Q.friction,D.material&&M.material&&(D.material.friction>=0&&M.material.friction>=0&&D.material.friction*M.material.friction,D.material.restitution>=0&&M.material.restitution>=0&&(G.restitution=D.material.restitution*M.material.restitution)),o.addEquation(G),D.allowSleep&&D.type===Body.DYNAMIC&&D.sleepState===Body.SLEEPING&&M.sleepState===Body.AWAKE&&M.type!==Body.STATIC){const ot=M.velocity.lengthSquared()+M.angularVelocity.lengthSquared(),tt=M.sleepSpeedLimit**2;ot>=tt*2&&(D.wakeUpAfterNarrowphase=!0)}if(M.allowSleep&&M.type===Body.DYNAMIC&&M.sleepState===Body.SLEEPING&&D.sleepState===Body.AWAKE&&D.type!==Body.STATIC){const ot=D.velocity.lengthSquared()+D.angularVelocity.lengthSquared(),tt=D.sleepSpeedLimit**2;ot>=tt*2&&(M.wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(D,M,!0),this.collisionMatrixPrevious.get(D,M)||(World_step_collideEvent.body=M,World_step_collideEvent.contact=G,D.dispatchEvent(World_step_collideEvent),World_step_collideEvent.body=D,M.dispatchEvent(World_step_collideEvent)),this.bodyOverlapKeeper.set(D.id,M.id),this.shapeOverlapKeeper.set(J.id,et.id)}for(this.emitContactEvents(),u&&(p.makeContactConstraints=performance$1.now()-f,f=performance$1.now()),m=0;m!==s;m++){const A=r[m];A.wakeUpAfterNarrowphase&&(A.wakeUp(),A.wakeUpAfterNarrowphase=!1)}for(x=g.length,m=0;m!==x;m++){const A=g[m];A.update();for(let G=0,D=A.equations.length;G!==D;G++){const M=A.equations[G];o.addEquation(M)}}o.solve(n,this),u&&(p.solve=performance$1.now()-f),o.removeAllEquations();const F=Math.pow;for(m=0;m!==s;m++){const A=r[m];if(A.type&d){const G=F(1-A.linearDamping,n),D=A.velocity;D.scale(G,D);const M=A.angularVelocity;if(M){const J=F(1-A.angularDamping,n);M.scale(J,M)}}}for(this.dispatchEvent(World_step_preStepEvent),m=0;m!==s;m++){const A=r[m];A.preStep&&A.preStep.call(A)}u&&(f=performance$1.now());const N=this.stepnumber%(this.quatNormalizeSkip+1)===0,B=this.quatNormalizeFast;for(m=0;m!==s;m++)r[m].integrate(n,N,B);for(this.clearForces(),this.broadphase.dirty=!0,u&&(p.integrate=performance$1.now()-f),this.stepnumber+=1,this.dispatchEvent(World_step_postStepEvent),m=0;m!==s;m++){const A=r[m],G=A.postStep;G&&G.call(A)}let W=!0;if(this.allowSleep)for(W=!1,m=0;m!==s;m++){const A=r[m];A.sleepTick(this.time),A.sleepState!==Body.SLEEPING&&(W=!0)}this.hasActiveBodies=W}emitContactEvents(){const n=this.hasAnyEventListener("beginContact"),t=this.hasAnyEventListener("endContact");if((n||t)&&this.bodyOverlapKeeper.getDiff(additions,removals),n){for(let s=0,r=additions.length;s<r;s+=2)beginContactEvent.bodyA=this.getBodyById(additions[s]),beginContactEvent.bodyB=this.getBodyById(additions[s+1]),this.dispatchEvent(beginContactEvent);beginContactEvent.bodyA=beginContactEvent.bodyB=null}if(t){for(let s=0,r=removals.length;s<r;s+=2)endContactEvent.bodyA=this.getBodyById(removals[s]),endContactEvent.bodyB=this.getBodyById(removals[s+1]),this.dispatchEvent(endContactEvent);endContactEvent.bodyA=endContactEvent.bodyB=null}additions.length=removals.length=0;const e=this.hasAnyEventListener("beginShapeContact"),i=this.hasAnyEventListener("endShapeContact");if((e||i)&&this.shapeOverlapKeeper.getDiff(additions,removals),e){for(let s=0,r=additions.length;s<r;s+=2){const o=this.getShapeById(additions[s]),h=this.getShapeById(additions[s+1]);beginShapeContactEvent.shapeA=o,beginShapeContactEvent.shapeB=h,o&&(beginShapeContactEvent.bodyA=o.body),h&&(beginShapeContactEvent.bodyB=h.body),this.dispatchEvent(beginShapeContactEvent)}beginShapeContactEvent.bodyA=beginShapeContactEvent.bodyB=beginShapeContactEvent.shapeA=beginShapeContactEvent.shapeB=null}if(i){for(let s=0,r=removals.length;s<r;s+=2){const o=this.getShapeById(removals[s]),h=this.getShapeById(removals[s+1]);endShapeContactEvent.shapeA=o,endShapeContactEvent.shapeB=h,o&&(endShapeContactEvent.bodyA=o.body),h&&(endShapeContactEvent.bodyB=h.body),this.dispatchEvent(endShapeContactEvent)}endShapeContactEvent.bodyA=endShapeContactEvent.bodyB=endShapeContactEvent.shapeA=endShapeContactEvent.shapeB=null}}clearForces(){const n=this.bodies,t=n.length;for(let e=0;e!==t;e++){const i=n[e];i.force,i.torque,i.force.set(0,0,0),i.torque.set(0,0,0)}}}new AABB;const tmpRay=new Ray,performance$1=globalThis.performance||{};if(!performance$1.now){let l=Date.now();performance$1.timing&&performance$1.timing.navigationStart&&(l=performance$1.timing.navigationStart),performance$1.now=()=>Date.now()-l}const World_step_postStepEvent={type:"postStep"},World_step_preStepEvent={type:"preStep"},World_step_collideEvent={type:Body.COLLIDE_EVENT_NAME,body:null,contact:null},World_step_oldContacts=[],World_step_frictionEquationPool=[],World_step_p1=[],World_step_p2=[],additions=[],removals=[],beginContactEvent={type:"beginContact",bodyA:null,bodyB:null},endContactEvent={type:"endContact",bodyA:null,bodyB:null},beginShapeContactEvent={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},endShapeContactEvent={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},_raycaster=new Raycaster,_tempVector=new Vector3,_tempVector2=new Vector3,_tempQuaternion=new Quaternion$1,_unit={X:new Vector3(1,0,0),Y:new Vector3(0,1,0),Z:new Vector3(0,0,1)},_changeEvent$1={type:"change"},_mouseDownEvent={type:"mouseDown"},_mouseUpEvent={type:"mouseUp",mode:null},_objectChangeEvent={type:"objectChange"};class TransformControls extends Object3D{constructor(n,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.visible=!1,this.domElement=t;const e=new TransformControlsGizmo;this._gizmo=e,this.add(e);const i=new TransformControlsPlane;this._plane=i,this.add(i);const s=this;function r(m,x){let C=x;Object.defineProperty(s,m,{get:function(){return C!==void 0?C:x},set:function(O){C!==O&&(C=O,i[m]=O,e[m]=O,s.dispatchEvent({type:m+"-changed",value:O}),s.dispatchEvent(_changeEvent$1))}}),s[m]=x,i[m]=x,e[m]=x}r("camera",n),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("scaleSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0);const o=new Vector3,h=new Vector3,u=new Quaternion$1,p=new Quaternion$1,d=new Vector3,f=new Quaternion$1,g=new Vector3,_=new Vector3,v=new Vector3,y=0,E=new Vector3;r("worldPosition",o),r("worldPositionStart",h),r("worldQuaternion",u),r("worldQuaternionStart",p),r("cameraPosition",d),r("cameraQuaternion",f),r("pointStart",g),r("pointEnd",_),r("rotationAxis",v),r("rotationAngle",y),r("eye",E),this._offset=new Vector3,this._startNorm=new Vector3,this._endNorm=new Vector3,this._cameraScale=new Vector3,this._parentPosition=new Vector3,this._parentQuaternion=new Quaternion$1,this._parentQuaternionInv=new Quaternion$1,this._parentScale=new Vector3,this._worldScaleStart=new Vector3,this._worldQuaternionInv=new Quaternion$1,this._worldScale=new Vector3,this._positionStart=new Vector3,this._quaternionStart=new Quaternion$1,this._scaleStart=new Vector3,this._getPointer=getPointer.bind(this),this._onPointerDown=onPointerDown.bind(this),this._onPointerHover=onPointerHover.bind(this),this._onPointerMove=onPointerMove.bind(this),this._onPointerUp=onPointerUp.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.ownerDocument.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(n){if(this.object===void 0||this.dragging===!0)return;_raycaster.setFromCamera(n,this.camera);const t=intersectObjectWithRay(this._gizmo.picker[this.mode],_raycaster);t?this.axis=t.object.name:this.axis=null}pointerDown(n){if(!(this.object===void 0||this.dragging===!0||n.button!==0)&&this.axis!==null){_raycaster.setFromCamera(n,this.camera);const t=intersectObjectWithRay(this._plane,_raycaster,!0);if(t){let e=this.space;if(this.mode==="scale"?e="local":(this.axis==="E"||this.axis==="XYZE"||this.axis==="XYZ")&&(e="world"),e==="local"&&this.mode==="rotate"){const i=this.rotationSnap;this.axis==="X"&&i&&(this.object.rotation.x=Math.round(this.object.rotation.x/i)*i),this.axis==="Y"&&i&&(this.object.rotation.y=Math.round(this.object.rotation.y/i)*i),this.axis==="Z"&&i&&(this.object.rotation.z=Math.round(this.object.rotation.z/i)*i)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)}this.dragging=!0,_mouseDownEvent.mode=this.mode,this.dispatchEvent(_mouseDownEvent)}}pointerMove(n){const t=this.axis,e=this.mode,i=this.object;let s=this.space;if(e==="scale"?s="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(s="world"),i===void 0||t===null||this.dragging===!1||n.button!==-1)return;_raycaster.setFromCamera(n,this.camera);const r=intersectObjectWithRay(this._plane,_raycaster,!0);if(r){if(this.pointEnd.copy(r.point).sub(this.worldPositionStart),e==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),s==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),s==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(s==="local"&&(i.position.applyQuaternion(_tempQuaternion.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),s==="world"&&(i.parent&&i.position.add(_tempVector.setFromMatrixPosition(i.parent.matrixWorld)),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(_tempVector.setFromMatrixPosition(i.parent.matrixWorld))));else if(e==="scale"){if(t.search("XYZ")!==-1){let o=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(o*=-1),_tempVector2.set(o,o,o)}else _tempVector.copy(this.pointStart),_tempVector2.copy(this.pointEnd),_tempVector.applyQuaternion(this._worldQuaternionInv),_tempVector2.applyQuaternion(this._worldQuaternionInv),_tempVector2.divide(_tempVector),t.search("X")===-1&&(_tempVector2.x=1),t.search("Y")===-1&&(_tempVector2.y=1),t.search("Z")===-1&&(_tempVector2.z=1);i.scale.copy(this._scaleStart).multiply(_tempVector2),this.scaleSnap&&(t.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(e==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const o=20/this.worldPosition.distanceTo(_tempVector.setFromMatrixPosition(this.camera.matrixWorld));t==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(_tempVector.copy(this.rotationAxis).cross(this.eye))*o):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(_unit[t]),_tempVector.copy(_unit[t]),s==="local"&&_tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(_tempVector.cross(this.eye).normalize())*o),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),s==="local"&&t!=="E"&&t!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(_tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(_tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(_changeEvent$1),this.dispatchEvent(_objectChangeEvent)}}pointerUp(n){n.button===0&&(this.dragging&&this.axis!==null&&(_mouseUpEvent.mode=this.mode,this.dispatchEvent(_mouseUpEvent)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(n){n.geometry&&n.geometry.dispose(),n.material&&n.material.dispose()})}attach(n){return this.object=n,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}getMode(){return this.mode}setMode(n){this.mode=n}setTranslationSnap(n){this.translationSnap=n}setRotationSnap(n){this.rotationSnap=n}setScaleSnap(n){this.scaleSnap=n}setSize(n){this.size=n}setSpace(n){this.space=n}update(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}}TransformControls.prototype.isTransformControls=!0;function getPointer(l){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:l.button};{const n=l.changedTouches?l.changedTouches[0]:l,t=this.domElement.getBoundingClientRect();return{x:(n.clientX-t.left)/t.width*2-1,y:-(n.clientY-t.top)/t.height*2+1,button:l.button}}}function onPointerHover(l){if(this.enabled)switch(l.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(l));break}}function onPointerDown(l){this.enabled&&(this.domElement.style.touchAction="none",this.domElement.ownerDocument.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(l)),this.pointerDown(this._getPointer(l)))}function onPointerMove(l){this.enabled&&this.pointerMove(this._getPointer(l))}function onPointerUp(l){this.enabled&&(this.domElement.style.touchAction="",this.domElement.ownerDocument.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(l)))}function intersectObjectWithRay(l,n,t){const e=n.intersectObject(l,!0);for(let i=0;i<e.length;i++)if(e[i].object.visible||t)return e[i];return!1}const _tempEuler=new Euler,_alignVector=new Vector3(0,1,0),_zeroVector=new Vector3(0,0,0),_lookAtMatrix=new Matrix4,_tempQuaternion2=new Quaternion$1,_identityQuaternion=new Quaternion$1,_dirVector=new Vector3,_tempMatrix=new Matrix4,_unitX=new Vector3(1,0,0),_unitY=new Vector3(0,1,0),_unitZ=new Vector3(0,0,1),_v1$1=new Vector3,_v2=new Vector3,_v3=new Vector3;class TransformControlsGizmo extends Object3D{constructor(){super(),this.type="TransformControlsGizmo";const n=new MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:DoubleSide,fog:!1,toneMapped:!1}),t=new LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),e=n.clone();e.opacity=.15;const i=n.clone();i.opacity=.33;const s=n.clone();s.color.set(16711680);const r=n.clone();r.color.set(65280);const o=n.clone();o.color.set(255);const h=n.clone();h.opacity=.25;const u=h.clone();u.color.set(16776960);const p=h.clone();p.color.set(65535);const d=h.clone();d.color.set(16711935),n.clone().color.set(16776960);const g=t.clone();g.color.set(16711680);const _=t.clone();_.color.set(65280);const v=t.clone();v.color.set(255);const y=t.clone();y.color.set(65535);const E=t.clone();E.color.set(16711935);const m=t.clone();m.color.set(16776960);const x=t.clone();x.color.set(7895160);const C=m.clone();C.opacity=.25;const O=new CylinderGeometry(0,.05,.2,12,1,!1),S=new BoxGeometry(.125,.125,.125),P=new BufferGeometry;P.setAttribute("position",new Float32BufferAttribute([0,0,0,1,0,0],3));function F(ot,tt){const rt=new BufferGeometry,ft=[];for(let _t=0;_t<=64*tt;++_t)ft.push(0,Math.cos(_t/32*Math.PI)*ot,Math.sin(_t/32*Math.PI)*ot);return rt.setAttribute("position",new Float32BufferAttribute(ft,3)),rt}function V(){const ot=new BufferGeometry;return ot.setAttribute("position",new Float32BufferAttribute([0,0,0,1,1,1],3)),ot}const N={X:[[new Mesh(O,s),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new Mesh(O,s),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new Line(P,g)]],Y:[[new Mesh(O,r),[0,1,0],null,null,"fwd"],[new Mesh(O,r),[0,1,0],[Math.PI,0,0],null,"bwd"],[new Line(P,_),null,[0,0,Math.PI/2]]],Z:[[new Mesh(O,o),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new Mesh(O,o),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new Line(P,v),null,[0,-Math.PI/2,0]]],XYZ:[[new Mesh(new OctahedronGeometry(.1,0),h.clone()),[0,0,0],[0,0,0]]],XY:[[new Mesh(new PlaneGeometry(.295,.295),u.clone()),[.15,.15,0]],[new Line(P,m),[.18,.3,0],null,[.125,1,1]],[new Line(P,m),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new Mesh(new PlaneGeometry(.295,.295),p.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new Line(P,y),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new Line(P,y),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new Mesh(new PlaneGeometry(.295,.295),d.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new Line(P,E),[.18,0,.3],null,[.125,1,1]],[new Line(P,E),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},B={X:[[new Mesh(new CylinderGeometry(.2,0,1,4,1,!1),e),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new Mesh(new CylinderGeometry(.2,0,1,4,1,!1),e),[0,.6,0]]],Z:[[new Mesh(new CylinderGeometry(.2,0,1,4,1,!1),e),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new Mesh(new OctahedronGeometry(.2,0),e)]],XY:[[new Mesh(new PlaneGeometry(.4,.4),e),[.2,.2,0]]],YZ:[[new Mesh(new PlaneGeometry(.4,.4),e),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new Mesh(new PlaneGeometry(.4,.4),e),[.2,0,.2],[-Math.PI/2,0,0]]]},W={START:[[new Mesh(new OctahedronGeometry(.01,2),i),null,null,null,"helper"]],END:[[new Mesh(new OctahedronGeometry(.01,2),i),null,null,null,"helper"]],DELTA:[[new Line(V(),i),null,null,null,"helper"]],X:[[new Line(P,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Line(P,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Line(P,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},A={X:[[new Line(F(1,.5),g)],[new Mesh(new OctahedronGeometry(.04,0),s),[0,0,.99],null,[1,3,1]]],Y:[[new Line(F(1,.5),_),null,[0,0,-Math.PI/2]],[new Mesh(new OctahedronGeometry(.04,0),r),[0,0,.99],null,[3,1,1]]],Z:[[new Line(F(1,.5),v),null,[0,Math.PI/2,0]],[new Mesh(new OctahedronGeometry(.04,0),o),[.99,0,0],null,[1,3,1]]],E:[[new Line(F(1.25,1),C),null,[0,Math.PI/2,0]],[new Mesh(new CylinderGeometry(.03,0,.15,4,1,!1),C),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new Mesh(new CylinderGeometry(.03,0,.15,4,1,!1),C),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new Mesh(new CylinderGeometry(.03,0,.15,4,1,!1),C),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new Mesh(new CylinderGeometry(.03,0,.15,4,1,!1),C),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new Line(F(1,1),x),null,[0,Math.PI/2,0]]]},G={AXIS:[[new Line(P,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},D={X:[[new Mesh(new TorusGeometry(1,.1,4,24),e),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Mesh(new TorusGeometry(1,.1,4,24),e),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Mesh(new TorusGeometry(1,.1,4,24),e),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Mesh(new TorusGeometry(1.25,.1,2,24),e)]],XYZE:[[new Mesh(new SphereGeometry(.7,10,8),e)]]},M={X:[[new Mesh(S,s),[.8,0,0],[0,0,-Math.PI/2]],[new Line(P,g),null,null,[.8,1,1]]],Y:[[new Mesh(S,r),[0,.8,0]],[new Line(P,_),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new Mesh(S,o),[0,0,.8],[Math.PI/2,0,0]],[new Line(P,v),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new Mesh(S,u),[.85,.85,0],null,[2,2,.2]],[new Line(P,m),[.855,.98,0],null,[.125,1,1]],[new Line(P,m),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new Mesh(S,p),[0,.85,.85],null,[.2,2,2]],[new Line(P,y),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new Line(P,y),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new Mesh(S,d),[.85,0,.85],null,[2,.2,2]],[new Line(P,E),[.855,0,.98],null,[.125,1,1]],[new Line(P,E),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new Mesh(new BoxGeometry(.125,.125,.125),h.clone()),[1.1,0,0]]],XYZY:[[new Mesh(new BoxGeometry(.125,.125,.125),h.clone()),[0,1.1,0]]],XYZZ:[[new Mesh(new BoxGeometry(.125,.125,.125),h.clone()),[0,0,1.1]]]},J={X:[[new Mesh(new CylinderGeometry(.2,0,.8,4,1,!1),e),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new Mesh(new CylinderGeometry(.2,0,.8,4,1,!1),e),[0,.5,0]]],Z:[[new Mesh(new CylinderGeometry(.2,0,.8,4,1,!1),e),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new Mesh(S,e),[.85,.85,0],null,[3,3,.2]]],YZ:[[new Mesh(S,e),[0,.85,.85],null,[.2,3,3]]],XZ:[[new Mesh(S,e),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new Mesh(new BoxGeometry(.2,.2,.2),e),[1.1,0,0]]],XYZY:[[new Mesh(new BoxGeometry(.2,.2,.2),e),[0,1.1,0]]],XYZZ:[[new Mesh(new BoxGeometry(.2,.2,.2),e),[0,0,1.1]]]},et={X:[[new Line(P,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Line(P,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Line(P,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function Q(ot){const tt=new Object3D;for(const rt in ot)for(let ft=ot[rt].length;ft--;){const _t=ot[rt][ft][0].clone(),yt=ot[rt][ft][1],Z=ot[rt][ft][2],bt=ot[rt][ft][3],at=ot[rt][ft][4];_t.name=rt,_t.tag=at,yt&&_t.position.set(yt[0],yt[1],yt[2]),Z&&_t.rotation.set(Z[0],Z[1],Z[2]),bt&&_t.scale.set(bt[0],bt[1],bt[2]),_t.updateMatrix();const nt=_t.geometry.clone();nt.applyMatrix4(_t.matrix),_t.geometry=nt,_t.renderOrder=1/0,_t.position.set(0,0,0),_t.rotation.set(0,0,0),_t.scale.set(1,1,1),tt.add(_t)}return tt}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=Q(N)),this.add(this.gizmo.rotate=Q(A)),this.add(this.gizmo.scale=Q(M)),this.add(this.picker.translate=Q(B)),this.add(this.picker.rotate=Q(D)),this.add(this.picker.scale=Q(J)),this.add(this.helper.translate=Q(W)),this.add(this.helper.rotate=Q(G)),this.add(this.helper.scale=Q(et)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(n){const e=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:_identityQuaternion;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let s=0;s<i.length;s++){const r=i[s];r.visible=!0,r.rotation.set(0,0,0),r.position.copy(this.worldPosition);let o;if(this.camera.isOrthographicCamera?o=(this.camera.top-this.camera.bottom)/this.camera.zoom:o=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),r.scale.set(1,1,1).multiplyScalar(o*this.size/7),r.tag==="helper"){r.visible=!1,r.name==="AXIS"?(r.position.copy(this.worldPositionStart),r.visible=!!this.axis,this.axis==="X"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,0,0)),r.quaternion.copy(e).multiply(_tempQuaternion),Math.abs(_alignVector.copy(_unitX).applyQuaternion(e).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Y"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,0,Math.PI/2)),r.quaternion.copy(e).multiply(_tempQuaternion),Math.abs(_alignVector.copy(_unitY).applyQuaternion(e).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Z"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,Math.PI/2,0)),r.quaternion.copy(e).multiply(_tempQuaternion),Math.abs(_alignVector.copy(_unitZ).applyQuaternion(e).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="XYZE"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,Math.PI/2,0)),_alignVector.copy(this.rotationAxis),r.quaternion.setFromRotationMatrix(_lookAtMatrix.lookAt(_zeroVector,_alignVector,_unitY)),r.quaternion.multiply(_tempQuaternion),r.visible=this.dragging),this.axis==="E"&&(r.visible=!1)):r.name==="START"?(r.position.copy(this.worldPositionStart),r.visible=this.dragging):r.name==="END"?(r.position.copy(this.worldPosition),r.visible=this.dragging):r.name==="DELTA"?(r.position.copy(this.worldPositionStart),r.quaternion.copy(this.worldQuaternionStart),_tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),_tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),r.scale.copy(_tempVector),r.visible=this.dragging):(r.quaternion.copy(e),this.dragging?r.position.copy(this.worldPositionStart):r.position.copy(this.worldPosition),this.axis&&(r.visible=this.axis.search(r.name)!==-1));continue}r.quaternion.copy(e),this.mode==="translate"||this.mode==="scale"?((r.name==="X"||r.name==="XYZX")&&Math.abs(_alignVector.copy(_unitX).applyQuaternion(e).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),(r.name==="Y"||r.name==="XYZY")&&Math.abs(_alignVector.copy(_unitY).applyQuaternion(e).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),(r.name==="Z"||r.name==="XYZZ")&&Math.abs(_alignVector.copy(_unitZ).applyQuaternion(e).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XY"&&Math.abs(_alignVector.copy(_unitZ).applyQuaternion(e).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="YZ"&&Math.abs(_alignVector.copy(_unitX).applyQuaternion(e).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XZ"&&Math.abs(_alignVector.copy(_unitY).applyQuaternion(e).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name.search("X")!==-1&&(_alignVector.copy(_unitX).applyQuaternion(e).dot(this.eye)<0?r.tag==="fwd"?r.visible=!1:r.scale.x*=-1:r.tag==="bwd"&&(r.visible=!1)),r.name.search("Y")!==-1&&(_alignVector.copy(_unitY).applyQuaternion(e).dot(this.eye)<0?r.tag==="fwd"?r.visible=!1:r.scale.y*=-1:r.tag==="bwd"&&(r.visible=!1)),r.name.search("Z")!==-1&&(_alignVector.copy(_unitZ).applyQuaternion(e).dot(this.eye)<0?r.tag==="fwd"?r.visible=!1:r.scale.z*=-1:r.tag==="bwd"&&(r.visible=!1))):this.mode==="rotate"&&(_tempQuaternion2.copy(e),_alignVector.copy(this.eye).applyQuaternion(_tempQuaternion.copy(e).invert()),r.name.search("E")!==-1&&r.quaternion.setFromRotationMatrix(_lookAtMatrix.lookAt(this.eye,_zeroVector,_unitY)),r.name==="X"&&(_tempQuaternion.setFromAxisAngle(_unitX,Math.atan2(-_alignVector.y,_alignVector.z)),_tempQuaternion.multiplyQuaternions(_tempQuaternion2,_tempQuaternion),r.quaternion.copy(_tempQuaternion)),r.name==="Y"&&(_tempQuaternion.setFromAxisAngle(_unitY,Math.atan2(_alignVector.x,_alignVector.z)),_tempQuaternion.multiplyQuaternions(_tempQuaternion2,_tempQuaternion),r.quaternion.copy(_tempQuaternion)),r.name==="Z"&&(_tempQuaternion.setFromAxisAngle(_unitZ,Math.atan2(_alignVector.y,_alignVector.x)),_tempQuaternion.multiplyQuaternions(_tempQuaternion2,_tempQuaternion),r.quaternion.copy(_tempQuaternion))),r.visible=r.visible&&(r.name.indexOf("X")===-1||this.showX),r.visible=r.visible&&(r.name.indexOf("Y")===-1||this.showY),r.visible=r.visible&&(r.name.indexOf("Z")===-1||this.showZ),r.visible=r.visible&&(r.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),r.material._opacity=r.material._opacity||r.material.opacity,r.material._color=r.material._color||r.material.color.clone(),r.material.color.copy(r.material._color),r.material.opacity=r.material._opacity,this.enabled?this.axis&&(r.name===this.axis?(r.material.opacity=1,r.material.color.lerp(new Color(1,1,1),.5)):this.axis.split("").some(function(h){return r.name===h})?(r.material.opacity=1,r.material.color.lerp(new Color(1,1,1),.5)):(r.material.opacity*=.25,r.material.color.lerp(new Color(1,1,1),.5))):(r.material.opacity*=.5,r.material.color.lerp(new Color(1,1,1),.5))}super.updateMatrixWorld(n)}}TransformControlsGizmo.prototype.isTransformControlsGizmo=!0;class TransformControlsPlane extends Mesh{constructor(){super(new PlaneGeometry(1e5,1e5,2,2),new MeshBasicMaterial({visible:!1,wireframe:!0,side:DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.type="TransformControlsPlane"}updateMatrixWorld(n){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),_v1$1.copy(_unitX).applyQuaternion(t==="local"?this.worldQuaternion:_identityQuaternion),_v2.copy(_unitY).applyQuaternion(t==="local"?this.worldQuaternion:_identityQuaternion),_v3.copy(_unitZ).applyQuaternion(t==="local"?this.worldQuaternion:_identityQuaternion),_alignVector.copy(_v2),this.mode){case"translate":case"scale":switch(this.axis){case"X":_alignVector.copy(this.eye).cross(_v1$1),_dirVector.copy(_v1$1).cross(_alignVector);break;case"Y":_alignVector.copy(this.eye).cross(_v2),_dirVector.copy(_v2).cross(_alignVector);break;case"Z":_alignVector.copy(this.eye).cross(_v3),_dirVector.copy(_v3).cross(_alignVector);break;case"XY":_dirVector.copy(_v3);break;case"YZ":_dirVector.copy(_v1$1);break;case"XZ":_alignVector.copy(_v3),_dirVector.copy(_v2);break;case"XYZ":case"E":_dirVector.set(0,0,0);break}break;case"rotate":default:_dirVector.set(0,0,0)}_dirVector.length()===0?this.quaternion.copy(this.cameraQuaternion):(_tempMatrix.lookAt(_tempVector.set(0,0,0),_dirVector,_alignVector),this.quaternion.setFromRotationMatrix(_tempMatrix)),super.updateMatrixWorld(n)}}TransformControlsPlane.prototype.isTransformControlsPlane=!0;class STLLoader extends Loader{constructor(n){super(n)}load(n,t,e,i){const s=this,r=new FileLoader(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(n,function(o){try{t(s.parse(o))}catch(h){i?i(h):console.error(h),s.manager.itemError(n)}},e,i)}parse(n){function t(u){const p=new DataView(u),d=32/8*3+32/8*3*3+16/8,f=p.getUint32(80,!0);if(80+32/8+f*d===p.byteLength)return!0;const _=[115,111,108,105,100];for(let v=0;v<5;v++)if(e(_,p,v))return!1;return!0}function e(u,p,d){for(let f=0,g=u.length;f<g;f++)if(u[f]!==p.getUint8(d+f,!1))return!1;return!0}function i(u){const p=new DataView(u),d=p.getUint32(80,!0);let f,g,_,v=!1,y,E,m,x,C;for(let N=0;N<70;N++)p.getUint32(N,!1)==1129270351&&p.getUint8(N+4)==82&&p.getUint8(N+5)==61&&(v=!0,y=new Float32Array(d*3*3),E=p.getUint8(N+6)/255,m=p.getUint8(N+7)/255,x=p.getUint8(N+8)/255,C=p.getUint8(N+9)/255);const O=84,S=50,P=new BufferGeometry,F=new Float32Array(d*3*3),V=new Float32Array(d*3*3);for(let N=0;N<d;N++){const B=O+N*S,W=p.getFloat32(B,!0),A=p.getFloat32(B+4,!0),G=p.getFloat32(B+8,!0);if(v){const D=p.getUint16(B+48,!0);(D&32768)===0?(f=(D&31)/31,g=(D>>5&31)/31,_=(D>>10&31)/31):(f=E,g=m,_=x)}for(let D=1;D<=3;D++){const M=B+D*12,J=N*3*3+(D-1)*3;F[J]=p.getFloat32(M,!0),F[J+1]=p.getFloat32(M+4,!0),F[J+2]=p.getFloat32(M+8,!0),V[J]=W,V[J+1]=A,V[J+2]=G,v&&(y[J]=f,y[J+1]=g,y[J+2]=_)}}return P.setAttribute("position",new BufferAttribute(F,3)),P.setAttribute("normal",new BufferAttribute(V,3)),v&&(P.setAttribute("color",new BufferAttribute(y,3)),P.hasColors=!0,P.alpha=C),P}function s(u){const p=new BufferGeometry,d=/solid([\s\S]*?)endsolid/g,f=/facet([\s\S]*?)endfacet/g;let g=0;const _=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,v=new RegExp("vertex"+_+_+_,"g"),y=new RegExp("normal"+_+_+_,"g"),E=[],m=[],x=new Vector3;let C,O=0,S=0,P=0;for(;(C=d.exec(u))!==null;){S=P;const F=C[0];for(;(C=f.exec(F))!==null;){let B=0,W=0;const A=C[0];for(;(C=y.exec(A))!==null;)x.x=parseFloat(C[1]),x.y=parseFloat(C[2]),x.z=parseFloat(C[3]),W++;for(;(C=v.exec(A))!==null;)E.push(parseFloat(C[1]),parseFloat(C[2]),parseFloat(C[3])),m.push(x.x,x.y,x.z),B++,P++;W!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+g),B!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+g),g++}const V=S,N=P-S;p.addGroup(V,N,O),O++}return p.setAttribute("position",new Float32BufferAttribute(E,3)),p.setAttribute("normal",new Float32BufferAttribute(m,3)),p}function r(u){return typeof u!="string"?LoaderUtils.decodeText(new Uint8Array(u)):u}function o(u){if(typeof u=="string"){const p=new Uint8Array(u.length);for(let d=0;d<u.length;d++)p[d]=u.charCodeAt(d)&255;return p.buffer||p}else return u}const h=o(n);return t(h)?i(h):s(r(n))}}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var coreBrowser$1={exports:{}},blockly$3={exports:{}},blockly_compressed$1={exports:{}},blockly_compressed=blockly_compressed$1.exports,hasRequiredBlockly_compressed;function requireBlockly_compressed(){return hasRequiredBlockly_compressed||(hasRequiredBlockly_compressed=1,function(l,n){(function(t,e){l.exports=e()})(blockly_compressed,function(){var t={connectionTypes:{INPUT_VALUE:1,OUTPUT_VALUE:2,NEXT_STATEMENT:3,PREVIOUS_STATEMENT:4}};return t.constants={},t.LINE_MODE_MULTIPLIER=40,t.PAGE_MODE_MULTIPLIER=125,t.DRAG_RADIUS=5,t.FLYOUT_DRAG_RADIUS=10,t.SNAP_RADIUS=28,t.CONNECTING_SNAP_RADIUS=t.SNAP_RADIUS,t.CURRENT_CONNECTION_PREFERENCE=8,t.BUMP_DELAY=250,t.BUMP_RANDOMNESS=10,t.COLLAPSE_CHARS=30,t.LONGPRESS=750,t.SOUND_LIMIT=100,t.DRAG_STACK=!0,t.HSV_SATURATION=.45,t.HSV_VALUE=.65,t.SPRITE={width:96,height:124,url:"sprites.png"},t.constants.ALIGN={LEFT:-1,CENTRE:0,RIGHT:1},t.DRAG_NONE=0,t.DRAG_STICKY=1,t.DRAG_BEGIN=1,t.DRAG_FREE=2,t.OPPOSITE_TYPE=[],t.OPPOSITE_TYPE[t.connectionTypes.INPUT_VALUE]=t.connectionTypes.OUTPUT_VALUE,t.OPPOSITE_TYPE[t.connectionTypes.OUTPUT_VALUE]=t.connectionTypes.INPUT_VALUE,t.OPPOSITE_TYPE[t.connectionTypes.NEXT_STATEMENT]=t.connectionTypes.PREVIOUS_STATEMENT,t.OPPOSITE_TYPE[t.connectionTypes.PREVIOUS_STATEMENT]=t.connectionTypes.NEXT_STATEMENT,t.DELETE_AREA_NONE=null,t.DELETE_AREA_TRASH=1,t.DELETE_AREA_TOOLBOX=2,t.VARIABLE_CATEGORY_NAME="VARIABLE",t.VARIABLE_DYNAMIC_CATEGORY_NAME="VARIABLE_DYNAMIC",t.PROCEDURE_CATEGORY_NAME="PROCEDURE",t.RENAME_VARIABLE_ID="RENAME_VARIABLE_ID",t.DELETE_VARIABLE_ID="DELETE_VARIABLE_ID",t.constants.COLLAPSED_INPUT_NAME="_TEMP_COLLAPSED_INPUT",t.constants.COLLAPSED_FIELD_NAME="_TEMP_COLLAPSED_FIELD",t.utils={},t.utils.global=function(){return typeof self=="object"?self:typeof window=="object"?window:typeof commonjsGlobal=="object"?commonjsGlobal:this}(),t.Msg={},t.utils.global.Blockly||(t.utils.global.Blockly={}),t.utils.global.Blockly.Msg||(t.utils.global.Blockly.Msg=t.Msg),t.utils.colour={},t.utils.colour.parse=function(e){e=String(e).toLowerCase().trim();var i=t.utils.colour.names[e];if(i||(i=e.substring(0,2)=="0x"?"#"+e.substring(2):e,i=i[0]=="#"?i:"#"+i,/^#[0-9a-f]{6}$/.test(i)))return i;if(/^#[0-9a-f]{3}$/.test(i))return["#",i[1],i[1],i[2],i[2],i[3],i[3]].join("");var s=e.match(/^(?:rgb)?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/);return s&&(e=Number(s[1]),i=Number(s[2]),s=Number(s[3]),0<=e&&256>e&&0<=i&&256>i&&0<=s&&256>s)?t.utils.colour.rgbToHex(e,i,s):null},t.utils.colour.rgbToHex=function(e,i,s){return i=e<<16|i<<8|s,16>e?"#"+(16777216|i).toString(16).substr(1):"#"+i.toString(16)},t.utils.colour.hexToRgb=function(e){return e=t.utils.colour.parse(e),e?(e=parseInt(e.substr(1),16),[e>>16,e>>8&255,e&255]):[0,0,0]},t.utils.colour.hsvToHex=function(e,i,s){var r=0,o=0,h=0;if(i==0)h=o=r=s;else{var u=Math.floor(e/60),p=e/60-u;e=s*(1-i);var d=s*(1-i*p);switch(i=s*(1-i*(1-p)),u){case 1:r=d,o=s,h=e;break;case 2:r=e,o=s,h=i;break;case 3:r=e,o=d,h=s;break;case 4:r=i,o=e,h=s;break;case 5:r=s,o=e,h=d;break;case 6:case 0:r=s,o=i,h=e}}return t.utils.colour.rgbToHex(Math.floor(r),Math.floor(o),Math.floor(h))},t.utils.colour.blend=function(e,i,s){return e=t.utils.colour.parse(e),!e||(i=t.utils.colour.parse(i),!i)?null:(e=t.utils.colour.hexToRgb(e),i=t.utils.colour.hexToRgb(i),t.utils.colour.rgbToHex(Math.round(i[0]+s*(e[0]-i[0])),Math.round(i[1]+s*(e[1]-i[1])),Math.round(i[2]+s*(e[2]-i[2]))))},t.utils.colour.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"},t.utils.Coordinate=function(e,i){this.x=e,this.y=i},t.utils.Coordinate.equals=function(e,i){return e==i?!0:e&&i?e.x==i.x&&e.y==i.y:!1},t.utils.Coordinate.distance=function(e,i){var s=e.x-i.x;return e=e.y-i.y,Math.sqrt(s*s+e*e)},t.utils.Coordinate.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},t.utils.Coordinate.difference=function(e,i){return new t.utils.Coordinate(e.x-i.x,e.y-i.y)},t.utils.Coordinate.sum=function(e,i){return new t.utils.Coordinate(e.x+i.x,e.y+i.y)},t.utils.Coordinate.prototype.scale=function(e){return this.x*=e,this.y*=e,this},t.utils.Coordinate.prototype.translate=function(e,i){return this.x+=e,this.y+=i,this},t.utils.Rect=function(e,i,s,r){this.top=e,this.bottom=i,this.left=s,this.right=r},t.utils.Rect.prototype.contains=function(e,i){return e>=this.left&&e<=this.right&&i>=this.top&&i<=this.bottom},t.utils.Rect.prototype.intersects=function(e){return!(this.left>e.right||this.right<e.left||this.top>e.bottom||this.bottom<e.top)},t.utils.string={},t.utils.string.startsWith=function(e,i){return e.lastIndexOf(i,0)==0},t.utils.string.shortestStringLength=function(e){return e.length?e.reduce(function(i,s){return i.length<s.length?i:s}).length:0},t.utils.string.commonWordPrefix=function(e,i){if(!e.length)return 0;if(e.length==1)return e[0].length;var s=0;i=i||t.utils.string.shortestStringLength(e);for(var r=0;r<i;r++){for(var o=e[0][r],h=1;h<e.length;h++)if(o!=e[h][r])return s;o==" "&&(s=r+1)}for(h=1;h<e.length;h++)if((o=e[h][r])&&o!=" ")return s;return i},t.utils.string.commonWordSuffix=function(e,i){if(!e.length)return 0;if(e.length==1)return e[0].length;var s=0;i=i||t.utils.string.shortestStringLength(e);for(var r=0;r<i;r++){for(var o=e[0].substr(-r-1,1),h=1;h<e.length;h++)if(o!=e[h].substr(-r-1,1))return s;o==" "&&(s=r+1)}for(h=1;h<e.length;h++)if((o=e[h].charAt(e[h].length-r-1))&&o!=" ")return s;return i},t.utils.string.wrap=function(e,i){e=e.split(`
`);for(var s=0;s<e.length;s++)e[s]=t.utils.string.wrapLine_(e[s],i);return e.join(`
`)},t.utils.string.wrapLine_=function(e,i){if(e.length<=i)return e;for(var s=e.trim().split(/\s+/),r=0;r<s.length;r++)s[r].length>i&&(i=s[r].length);r=-1/0;var o=1;do{var h=r,u=e;e=[];var p=s.length/o,d=1;for(r=0;r<s.length-1;r++)d<(r+1.5)/p?(d++,e[r]=!0):e[r]=!1;e=t.utils.string.wrapMutate_(s,e,i),r=t.utils.string.wrapScore_(s,e,i),e=t.utils.string.wrapToText_(s,e),o++}while(r>h);return u},t.utils.string.wrapScore_=function(e,i,s){for(var r=[0],o=[],h=0;h<e.length;h++)r[r.length-1]+=e[h].length,i[h]===!0?(r.push(0),o.push(e[h].charAt(e[h].length-1))):i[h]===!1&&r[r.length-1]++;for(e=Math.max.apply(Math,r),h=i=0;h<r.length;h++)i-=2*Math.pow(Math.abs(s-r[h]),1.5),i-=Math.pow(e-r[h],1.5),".?!".indexOf(o[h])!=-1?i+=s/3:",;)]}".indexOf(o[h])!=-1&&(i+=s/4);return 1<r.length&&r[r.length-1]<=r[r.length-2]&&(i+=.5),i},t.utils.string.wrapMutate_=function(e,i,s){for(var r=t.utils.string.wrapScore_(e,i,s),o,h=0;h<i.length-1;h++)if(i[h]!=i[h+1]){var u=[].concat(i);u[h]=!u[h],u[h+1]=!u[h+1];var p=t.utils.string.wrapScore_(e,u,s);p>r&&(r=p,o=u)}return o?t.utils.string.wrapMutate_(e,o,s):i},t.utils.string.wrapToText_=function(e,i){for(var s=[],r=0;r<e.length;r++)s.push(e[r]),i[r]!==void 0&&s.push(i[r]?`
`:" ");return s.join("")},t.utils.Size=function(e,i){this.width=e,this.height=i},t.utils.Size.equals=function(e,i){return e==i?!0:e&&i?e.width==i.width&&e.height==i.height:!1},t.utils.style={},t.utils.style.getSize=function(e){if(t.utils.style.getStyle_(e,"display")!="none")return t.utils.style.getSizeWithDisplay_(e);var i=e.style,s=i.display,r=i.visibility,o=i.position;i.visibility="hidden",i.position="absolute",i.display="inline";var h=e.offsetWidth;return e=e.offsetHeight,i.display=s,i.position=o,i.visibility=r,new t.utils.Size(h,e)},t.utils.style.getSizeWithDisplay_=function(e){return new t.utils.Size(e.offsetWidth,e.offsetHeight)},t.utils.style.getStyle_=function(e,i){return t.utils.style.getComputedStyle(e,i)||t.utils.style.getCascadedStyle(e,i)||e.style&&e.style[i]},t.utils.style.getComputedStyle=function(e,i){return document.defaultView&&document.defaultView.getComputedStyle&&(e=document.defaultView.getComputedStyle(e,null))&&(e[i]||e.getPropertyValue(i))||""},t.utils.style.getCascadedStyle=function(e,i){return e.currentStyle?e.currentStyle[i]:null},t.utils.style.getPageOffset=function(e){var i=new t.utils.Coordinate(0,0);e=e.getBoundingClientRect();var s=document.documentElement;return s=new t.utils.Coordinate(window.pageXOffset||s.scrollLeft,window.pageYOffset||s.scrollTop),i.x=e.left+s.x,i.y=e.top+s.y,i},t.utils.style.getViewportPageOffset=function(){var e=document.body,i=document.documentElement;return new t.utils.Coordinate(e.scrollLeft||i.scrollLeft,e.scrollTop||i.scrollTop)},t.utils.style.setElementShown=function(e,i){e.style.display=i?"":"none"},t.utils.style.isRightToLeft=function(e){return t.utils.style.getStyle_(e,"direction")=="rtl"},t.utils.style.getBorderBox=function(e){var i=t.utils.style.getComputedStyle(e,"borderLeftWidth"),s=t.utils.style.getComputedStyle(e,"borderRightWidth"),r=t.utils.style.getComputedStyle(e,"borderTopWidth");return e=t.utils.style.getComputedStyle(e,"borderBottomWidth"),{top:parseFloat(r),right:parseFloat(s),bottom:parseFloat(e),left:parseFloat(i)}},t.utils.style.scrollIntoContainerView=function(e,i,s){e=t.utils.style.getContainerOffsetToScrollInto(e,i,s),i.scrollLeft=e.x,i.scrollTop=e.y},t.utils.style.getContainerOffsetToScrollInto=function(e,i,s){var r=t.utils.style.getPageOffset(e),o=t.utils.style.getPageOffset(i),h=t.utils.style.getBorderBox(i),u=r.x-o.x-h.left;return r=r.y-o.y-h.top,o=t.utils.style.getSizeWithDisplay_(e),e=i.clientWidth-o.width,o=i.clientHeight-o.height,h=i.scrollLeft,i=i.scrollTop,s?(h+=u-e/2,i+=r-o/2):(h+=Math.min(u,Math.max(u-e,0)),i+=Math.min(r,Math.max(r-o,0))),new t.utils.Coordinate(h,i)},t.utils.userAgent={},function(e){function i(r){return s.indexOf(r.toUpperCase())!=-1}t.utils.userAgent.raw=e;var s=t.utils.userAgent.raw.toUpperCase();t.utils.userAgent.IE=i("Trident")||i("MSIE"),t.utils.userAgent.EDGE=i("Edge"),t.utils.userAgent.JAVA_FX=i("JavaFX"),t.utils.userAgent.CHROME=(i("Chrome")||i("CriOS"))&&!t.utils.userAgent.EDGE,t.utils.userAgent.WEBKIT=i("WebKit")&&!t.utils.userAgent.EDGE,t.utils.userAgent.GECKO=i("Gecko")&&!t.utils.userAgent.WEBKIT&&!t.utils.userAgent.IE&&!t.utils.userAgent.EDGE,t.utils.userAgent.ANDROID=i("Android"),t.utils.userAgent.IPAD=i("iPad"),t.utils.userAgent.IPOD=i("iPod"),t.utils.userAgent.IPHONE=i("iPhone")&&!t.utils.userAgent.IPAD&&!t.utils.userAgent.IPOD,t.utils.userAgent.MAC=i("Macintosh"),t.utils.userAgent.TABLET=t.utils.userAgent.IPAD||t.utils.userAgent.ANDROID&&!i("Mobile")||i("Silk"),t.utils.userAgent.MOBILE=!t.utils.userAgent.TABLET&&(t.utils.userAgent.IPOD||t.utils.userAgent.IPHONE||t.utils.userAgent.ANDROID||i("IEMobile"))}(t.utils.global.navigator&&t.utils.global.navigator.userAgent||""),t.utils.noEvent=function(e){e.preventDefault(),e.stopPropagation()},t.utils.isTargetInput=function(e){return e.target.type=="textarea"||e.target.type=="text"||e.target.type=="number"||e.target.type=="email"||e.target.type=="password"||e.target.type=="search"||e.target.type=="tel"||e.target.type=="url"||e.target.isContentEditable||e.target.dataset&&e.target.dataset.isTextInput=="true"},t.utils.getRelativeXY=function(e){var i=new t.utils.Coordinate(0,0),s=e.getAttribute("x");return s&&(i.x=parseInt(s,10)),(s=e.getAttribute("y"))&&(i.y=parseInt(s,10)),(s=(s=e.getAttribute("transform"))&&s.match(t.utils.getRelativeXY.XY_REGEX_))&&(i.x+=Number(s[1]),s[3]&&(i.y+=Number(s[3]))),(e=e.getAttribute("style"))&&-1<e.indexOf("translate")&&(e=e.match(t.utils.getRelativeXY.XY_STYLE_REGEX_))&&(i.x+=Number(e[1]),e[3]&&(i.y+=Number(e[3]))),i},t.utils.getInjectionDivXY_=function(e){for(var i=0,s=0;e;){var r=t.utils.getRelativeXY(e);if(i+=r.x,s+=r.y,(" "+(e.getAttribute("class")||"")+" ").indexOf(" injectionDiv ")!=-1)break;e=e.parentNode}return new t.utils.Coordinate(i,s)},t.utils.getRelativeXY.XY_REGEX_=/translate\(\s*([-+\d.e]+)([ ,]\s*([-+\d.e]+)\s*)?/,t.utils.getRelativeXY.XY_STYLE_REGEX_=/transform:\s*translate(?:3d)?\(\s*([-+\d.e]+)\s*px([ ,]\s*([-+\d.e]+)\s*px)?/,t.utils.isRightButton=function(e){return e.ctrlKey&&t.utils.userAgent.MAC?!0:e.button==2},t.utils.mouseToSvg=function(e,i,s){var r=i.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,s||(s=i.getScreenCTM().inverse()),r.matrixTransform(s)},t.utils.getScrollDeltaPixels=function(e){switch(e.deltaMode){default:return{x:e.deltaX,y:e.deltaY};case 1:return{x:e.deltaX*t.LINE_MODE_MULTIPLIER,y:e.deltaY*t.LINE_MODE_MULTIPLIER};case 2:return{x:e.deltaX*t.PAGE_MODE_MULTIPLIER,y:e.deltaY*t.PAGE_MODE_MULTIPLIER}}},t.utils.tokenizeInterpolation=function(e){return t.utils.tokenizeInterpolation_(e,!0)},t.utils.replaceMessageReferences=function(e){return typeof e!="string"?e:(e=t.utils.tokenizeInterpolation_(e,!1),e.length?String(e[0]):"")},t.utils.checkMessageReferences=function(e){for(var i=!0,s=t.Msg,r=e.match(/%{BKY_[A-Z]\w*}/ig),o=0;o<r.length;o++){var h=r[o].toUpperCase();s[h.slice(6,-1)]==null&&(console.warn("No message string for "+r[o]+" in "+e),i=!1)}return i},t.utils.tokenizeInterpolation_=function(e,i){var s=[],r=e.split("");r.push("");var o=0;e=[];for(var h=null,u=0;u<r.length;u++){var p=r[u];o==0?p=="%"?((p=e.join(""))&&s.push(p),e.length=0,o=1):e.push(p):o==1?p=="%"?(e.push(p),o=0):i&&"0"<=p&&"9">=p?(o=2,h=p,(p=e.join(""))&&s.push(p),e.length=0):p=="{"?o=3:(e.push("%",p),o=0):o==2?"0"<=p&&"9">=p?h+=p:(s.push(parseInt(h,10)),u--,o=0):o==3&&(p==""?(e.splice(0,0,"%{"),u--,o=0):p!="}"?e.push(p):(o=e.join(""),/[A-Z]\w*/i.test(o)?(p=o.toUpperCase(),(p=t.utils.string.startsWith(p,"BKY_")?p.substring(4):null)&&p in t.Msg?(o=t.Msg[p],typeof o=="string"?Array.prototype.push.apply(s,t.utils.tokenizeInterpolation_(o,i)):i?s.push(String(o)):s.push(o)):s.push("%{"+o+"}")):s.push("%{"+o+"}"),o=e.length=0))}for((p=e.join(""))&&s.push(p),i=[],u=e.length=0;u<s.length;++u)typeof s[u]=="string"?e.push(s[u]):((p=e.join(""))&&i.push(p),e.length=0,i.push(s[u]));return(p=e.join(""))&&i.push(p),e.length=0,i},t.utils.genUid=function(){for(var e=t.utils.genUid.soup_.length,i=[],s=0;20>s;s++)i[s]=t.utils.genUid.soup_.charAt(Math.random()*e);return i.join("")},t.utils.genUid.soup_="!#$%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t.utils.is3dSupported=function(){if(t.utils.is3dSupported.cached_!==void 0)return t.utils.is3dSupported.cached_;if(!t.utils.global.getComputedStyle)return!1;var e=document.createElement("p"),i="none",s={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(e,null);for(var r in s)if(e.style[r]!==void 0){if(e.style[r]="translate3d(1px,1px,1px)",i=t.utils.global.getComputedStyle(e),!i)return document.body.removeChild(e),!1;i=i.getPropertyValue(s[r])}return document.body.removeChild(e),t.utils.is3dSupported.cached_=i!=="none",t.utils.is3dSupported.cached_},t.utils.runAfterPageLoad=function(e){if(typeof document!="object")throw Error("Blockly.utils.runAfterPageLoad() requires browser document.");if(document.readyState=="complete")e();else var i=setInterval(function(){document.readyState=="complete"&&(clearInterval(i),e())},10)},t.utils.getViewportBBox=function(){var e=t.utils.style.getViewportPageOffset();return new t.utils.Rect(e.y,document.documentElement.clientHeight+e.y,e.x,document.documentElement.clientWidth+e.x)},t.utils.arrayRemove=function(e,i){return i=e.indexOf(i),i==-1?!1:(e.splice(i,1),!0)},t.utils.getDocumentScroll=function(){var e=document.documentElement,i=window;return t.utils.userAgent.IE&&i.pageYOffset!=e.scrollTop?new t.utils.Coordinate(e.scrollLeft,e.scrollTop):new t.utils.Coordinate(i.pageXOffset||e.scrollLeft,i.pageYOffset||e.scrollTop)},t.utils.getBlockTypeCounts=function(e,i){var s=Object.create(null),r=e.getDescendants(!0);for(i&&(e=e.getNextBlock())&&(e=r.indexOf(e),r.splice(e,r.length-e)),e=0;i=r[e];e++)s[i.type]?s[i.type]++:s[i.type]=1;return s},t.utils.screenToWsCoordinates=function(e,i){var s=i.x;i=i.y;var r=e.getInjectionDiv().getBoundingClientRect();return s=new t.utils.Coordinate(s-r.left,i-r.top),i=e.getOriginOffsetInPixels(),t.utils.Coordinate.difference(s,i).scale(1/e.scale)},t.utils.parseBlockColour=function(e){var i=typeof e=="string"?t.utils.replaceMessageReferences(e):e,s=Number(i);if(!isNaN(s)&&0<=s&&360>=s)return{hue:s,hex:t.utils.colour.hsvToHex(s,t.HSV_SATURATION,255*t.HSV_VALUE)};if(s=t.utils.colour.parse(i))return{hue:null,hex:s};throw s='Invalid colour: "'+i+'"',e!=i&&(s+=' (from "'+e+'")'),Error(s)},t.Touch={},t.Touch.TOUCH_ENABLED="ontouchstart"in t.utils.global||!!(t.utils.global.document&&document.documentElement&&"ontouchstart"in document.documentElement)||!(!t.utils.global.navigator||!t.utils.global.navigator.maxTouchPoints&&!t.utils.global.navigator.msMaxTouchPoints),t.Touch.touchIdentifier_=null,t.Touch.TOUCH_MAP={},t.utils.global.PointerEvent?t.Touch.TOUCH_MAP={mousedown:["pointerdown"],mouseenter:["pointerenter"],mouseleave:["pointerleave"],mousemove:["pointermove"],mouseout:["pointerout"],mouseover:["pointerover"],mouseup:["pointerup","pointercancel"],touchend:["pointerup"],touchcancel:["pointercancel"]}:t.Touch.TOUCH_ENABLED&&(t.Touch.TOUCH_MAP={mousedown:["touchstart"],mousemove:["touchmove"],mouseup:["touchend","touchcancel"]}),t.longPid_=0,t.longStart=function(e,i){t.longStop_(),e.changedTouches&&e.changedTouches.length!=1||(t.longPid_=setTimeout(function(){e.changedTouches&&(e.button=2,e.clientX=e.changedTouches[0].clientX,e.clientY=e.changedTouches[0].clientY),i&&i.handleRightClick(e)},t.LONGPRESS))},t.longStop_=function(){t.longPid_&&(clearTimeout(t.longPid_),t.longPid_=0)},t.Touch.clearTouchIdentifier=function(){t.Touch.touchIdentifier_=null},t.Touch.shouldHandleEvent=function(e){return!t.Touch.isMouseOrTouchEvent(e)||t.Touch.checkTouchIdentifier(e)},t.Touch.getTouchIdentifierFromEvent=function(e){return e.pointerId!=null?e.pointerId:e.changedTouches&&e.changedTouches[0]&&e.changedTouches[0].identifier!==void 0&&e.changedTouches[0].identifier!==null?e.changedTouches[0].identifier:"mouse"},t.Touch.checkTouchIdentifier=function(e){var i=t.Touch.getTouchIdentifierFromEvent(e);return t.Touch.touchIdentifier_!==void 0&&t.Touch.touchIdentifier_!==null?t.Touch.touchIdentifier_==i:e.type=="mousedown"||e.type=="touchstart"||e.type=="pointerdown"?(t.Touch.touchIdentifier_=i,!0):!1},t.Touch.setClientFromTouch=function(e){if(t.utils.string.startsWith(e.type,"touch")){var i=e.changedTouches[0];e.clientX=i.clientX,e.clientY=i.clientY}},t.Touch.isMouseOrTouchEvent=function(e){return t.utils.string.startsWith(e.type,"touch")||t.utils.string.startsWith(e.type,"mouse")||t.utils.string.startsWith(e.type,"pointer")},t.Touch.isTouchEvent=function(e){return t.utils.string.startsWith(e.type,"touch")||t.utils.string.startsWith(e.type,"pointer")},t.Touch.splitEventByTouches=function(e){var i=[];if(e.changedTouches)for(var s=0;s<e.changedTouches.length;s++)i[s]={type:e.type,changedTouches:[e.changedTouches[s]],target:e.target,stopPropagation:function(){e.stopPropagation()},preventDefault:function(){e.preventDefault()}};else i.push(e);return i},t.browserEvents={},t.browserEvents.conditionalBind=function(e,i,s,r,o,h){var u=!1,p=function(v){var y=!o;v=t.Touch.splitEventByTouches(v);for(var E=0,m;m=v[E];E++)(!y||t.Touch.shouldHandleEvent(m))&&(t.Touch.setClientFromTouch(m),s?r.call(s,m):r(m),u=!0)},d=[];if(t.utils.global.PointerEvent&&i in t.Touch.TOUCH_MAP)for(var f=0,g;g=t.Touch.TOUCH_MAP[i][f];f++)e.addEventListener(g,p,!1),d.push([e,g,p]);else if(e.addEventListener(i,p,!1),d.push([e,i,p]),i in t.Touch.TOUCH_MAP){var _=function(v){p(v);var y=!h;u&&y&&v.preventDefault()};for(f=0;g=t.Touch.TOUCH_MAP[i][f];f++)e.addEventListener(g,_,!1),d.push([e,g,_])}return d},t.browserEvents.bind=function(e,i,s,r){var o=function(f){s?r.call(s,f):r(f)},h=[];if(t.utils.global.PointerEvent&&i in t.Touch.TOUCH_MAP)for(var u=0,p;p=t.Touch.TOUCH_MAP[i][u];u++)e.addEventListener(p,o,!1),h.push([e,p,o]);else if(e.addEventListener(i,o,!1),h.push([e,i,o]),i in t.Touch.TOUCH_MAP){var d=function(f){if(f.changedTouches&&f.changedTouches.length==1){var g=f.changedTouches[0];f.clientX=g.clientX,f.clientY=g.clientY}o(f),f.preventDefault()};for(u=0;p=t.Touch.TOUCH_MAP[i][u];u++)e.addEventListener(p,d,!1),h.push([e,p,d])}return h},t.browserEvents.unbind=function(e){for(;e.length;){var i=e.pop(),s=i[2];i[0].removeEventListener(i[1],s,!1)}return s},t.registry={},t.registry.typeMap_={},t.registry.DEFAULT="default",t.registry.Type=function(e){this.name_=e},t.registry.Type.prototype.toString=function(){return this.name_},t.registry.Type.CONNECTION_CHECKER=new t.registry.Type("connectionChecker"),t.registry.Type.CURSOR=new t.registry.Type("cursor"),t.registry.Type.EVENT=new t.registry.Type("event"),t.registry.Type.FIELD=new t.registry.Type("field"),t.registry.Type.RENDERER=new t.registry.Type("renderer"),t.registry.Type.TOOLBOX=new t.registry.Type("toolbox"),t.registry.Type.THEME=new t.registry.Type("theme"),t.registry.Type.TOOLBOX_ITEM=new t.registry.Type("toolboxItem"),t.registry.Type.FLYOUTS_VERTICAL_TOOLBOX=new t.registry.Type("flyoutsVerticalToolbox"),t.registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX=new t.registry.Type("flyoutsHorizontalToolbox"),t.registry.Type.METRICS_MANAGER=new t.registry.Type("metricsManager"),t.registry.register=function(e,i,s,r){if(!(e instanceof t.registry.Type)&&typeof e!="string"||String(e).trim()=="")throw Error('Invalid type "'+e+'". The type must be a non-empty string or a Blockly.registry.Type.');if(e=String(e).toLowerCase(),typeof i!="string"||i.trim()=="")throw Error('Invalid name "'+i+'". The name must be a non-empty string.');if(i=i.toLowerCase(),!s)throw Error("Can not register a null value");var o=t.registry.typeMap_[e];if(o||(o=t.registry.typeMap_[e]={}),t.registry.validate_(e,s),!r&&o[i])throw Error('Name "'+i+'" with type "'+e+'" already registered.');o[i]=s},t.registry.validate_=function(e,i){switch(e){case String(t.registry.Type.FIELD):if(typeof i.fromJson!="function")throw Error('Type "'+e+'" must have a fromJson function')}},t.registry.unregister=function(e,i){e=String(e).toLowerCase(),i=i.toLowerCase();var s=t.registry.typeMap_[e];s&&s[i]?delete t.registry.typeMap_[e][i]:console.warn("Unable to unregister ["+i+"]["+e+"] from the registry.")},t.registry.getItem_=function(e,i,s){e=String(e).toLowerCase(),i=i.toLowerCase();var r=t.registry.typeMap_[e];if(!r||!r[i]){if(i="Unable to find ["+i+"]["+e+"] in the registry.",s)throw Error(i+" You must require or register a "+e+" plugin.");return console.warn(i),null}return r[i]},t.registry.hasItem=function(e,i){return e=String(e).toLowerCase(),i=i.toLowerCase(),(e=t.registry.typeMap_[e])?!!e[i]:!1},t.registry.getClass=function(e,i,s){return t.registry.getItem_(e,i,s)},t.registry.getObject=function(e,i,s){return t.registry.getItem_(e,i,s)},t.registry.getClassFromOptions=function(e,i,s){return i=i.plugins[e.toString()]||t.registry.DEFAULT,typeof i=="function"?i:t.registry.getClass(e,i,s)},t.Events={},t.Events.group_="",t.Events.recordUndo=!0,t.Events.disabled_=0,t.Events.CREATE="create",t.Events.BLOCK_CREATE=t.Events.CREATE,t.Events.DELETE="delete",t.Events.BLOCK_DELETE=t.Events.DELETE,t.Events.CHANGE="change",t.Events.BLOCK_CHANGE=t.Events.CHANGE,t.Events.MOVE="move",t.Events.BLOCK_MOVE=t.Events.MOVE,t.Events.VAR_CREATE="var_create",t.Events.VAR_DELETE="var_delete",t.Events.VAR_RENAME="var_rename",t.Events.UI="ui",t.Events.BLOCK_DRAG="drag",t.Events.SELECTED="selected",t.Events.CLICK="click",t.Events.MARKER_MOVE="marker_move",t.Events.BUBBLE_OPEN="bubble_open",t.Events.TRASHCAN_OPEN="trashcan_open",t.Events.TOOLBOX_ITEM_SELECT="toolbox_item_select",t.Events.THEME_CHANGE="theme_change",t.Events.VIEWPORT_CHANGE="viewport_change",t.Events.COMMENT_CREATE="comment_create",t.Events.COMMENT_DELETE="comment_delete",t.Events.COMMENT_CHANGE="comment_change",t.Events.COMMENT_MOVE="comment_move",t.Events.FINISHED_LOADING="finished_loading",t.Events.BUMP_EVENTS=[t.Events.BLOCK_CREATE,t.Events.BLOCK_MOVE,t.Events.COMMENT_CREATE,t.Events.COMMENT_MOVE],t.Events.FIRE_QUEUE_=[],t.Events.fire=function(e){t.Events.isEnabled()&&(t.Events.FIRE_QUEUE_.length||setTimeout(t.Events.fireNow_,0),t.Events.FIRE_QUEUE_.push(e))},t.Events.fireNow_=function(){for(var e=t.Events.filter(t.Events.FIRE_QUEUE_,!0),i=t.Events.FIRE_QUEUE_.length=0,s;s=e[i];i++)if(s.workspaceId){var r=t.Workspace.getById(s.workspaceId);r&&r.fireChangeListener(s)}},t.Events.filter=function(e,i){e=e.slice(),i||e.reverse();for(var s=[],r=Object.create(null),o=0,h;h=e[o];o++)if(!h.isNull()){var u=[h.isUiEvent?t.Events.UI:h.type,h.blockId,h.workspaceId].join(" "),p=r[u],d=p?p.event:null;p?h.type==t.Events.MOVE&&p.index==o-1?(d.newParentId=h.newParentId,d.newInputName=h.newInputName,d.newCoordinate=h.newCoordinate,p.index=o):h.type==t.Events.CHANGE&&h.element==d.element&&h.name==d.name?d.newValue=h.newValue:(h.type!=t.Events.CLICK||d.type!=t.Events.BUBBLE_OPEN)&&(r[u]={event:h,index:o},s.push(h)):(r[u]={event:h,index:o},s.push(h))}for(e=s.filter(function(f){return!f.isNull()}),i||e.reverse(),o=1;h=e[o];o++)h.type==t.Events.CHANGE&&h.element=="mutation"&&e.unshift(e.splice(o,1)[0]);return e},t.Events.clearPendingUndo=function(){for(var e=0,i;i=t.Events.FIRE_QUEUE_[e];e++)i.recordUndo=!1},t.Events.disable=function(){t.Events.disabled_++},t.Events.enable=function(){t.Events.disabled_--},t.Events.isEnabled=function(){return t.Events.disabled_==0},t.Events.getGroup=function(){return t.Events.group_},t.Events.setGroup=function(e){t.Events.group_=typeof e=="boolean"?e?t.utils.genUid():"":e},t.Events.getDescendantIds=function(e){var i=[];e=e.getDescendants(!1);for(var s=0,r;r=e[s];s++)i[s]=r.id;return i},t.Events.fromJson=function(e,i){var s=t.Events.get(e.type);if(!s)throw Error("Unknown event type.");return s=new s,s.fromJson(e),s.workspaceId=i.id,s},t.Events.get=function(e){return t.registry.getClass(t.registry.Type.EVENT,e)},t.Events.disableOrphans=function(e){if((e.type==t.Events.MOVE||e.type==t.Events.CREATE)&&e.workspaceId){var i=t.Workspace.getById(e.workspaceId),s=i.getBlockById(e.blockId);if(s){e=t.Events.recordUndo;try{t.Events.recordUndo=!1;var r=s.getParent();if(r&&r.isEnabled()){var o=s.getDescendants(!1);i=0;for(var h;h=o[i];i++)h.setEnabled(!0)}else if((s.outputConnection||s.previousConnection)&&!i.isDragging())do s.setEnabled(!1),s=s.getNextBlock();while(s)}finally{t.Events.recordUndo=e}}}},t.Events.Abstract=function(){this.isBlank=null,this.workspaceId=void 0,this.group=t.Events.getGroup(),this.recordUndo=t.Events.recordUndo},t.Events.Abstract.prototype.isUiEvent=!1,t.Events.Abstract.prototype.toJson=function(){var e={type:this.type};return this.group&&(e.group=this.group),e},t.Events.Abstract.prototype.fromJson=function(e){this.isBlank=!1,this.group=e.group},t.Events.Abstract.prototype.isNull=function(){return!1},t.Events.Abstract.prototype.run=function(e){},t.Events.Abstract.prototype.getEventWorkspace_=function(){if(this.workspaceId)var e=t.Workspace.getById(this.workspaceId);if(!e)throw Error("Workspace is null. Event must have been generated from real Blockly events.");return e},t.utils.object={},t.utils.object.inherits=function(e,i){e.superClass_=i.prototype,e.prototype=Object.create(i.prototype),e.prototype.constructor=e},t.utils.object.mixin=function(e,i){for(var s in i)e[s]=i[s]},t.utils.object.deepMerge=function(e,i){for(var s in i)e[s]=i[s]!=null&&typeof i[s]=="object"?t.utils.object.deepMerge(e[s]||Object.create(null),i[s]):i[s];return e},t.utils.object.values=function(e){return Object.values?Object.values(e):Object.keys(e).map(function(i){return e[i]})},t.utils.xml={},t.utils.xml.NAME_SPACE="https://developers.google.com/blockly/xml",t.utils.xml.document=function(){return document},t.utils.xml.createElement=function(e){return t.utils.xml.document().createElementNS(t.utils.xml.NAME_SPACE,e)},t.utils.xml.createTextNode=function(e){return t.utils.xml.document().createTextNode(e)},t.utils.xml.textToDomDocument=function(e){return new DOMParser().parseFromString(e,"text/xml")},t.utils.xml.domToText=function(e){return new XMLSerializer().serializeToString(e)},t.inputTypes={VALUE:t.connectionTypes.INPUT_VALUE,STATEMENT:t.connectionTypes.NEXT_STATEMENT,DUMMY:5},t.utils.Svg=function(e){this.tagName_=e},t.utils.Svg.prototype.toString=function(){return this.tagName_},t.utils.Svg.ANIMATE=new t.utils.Svg("animate"),t.utils.Svg.CIRCLE=new t.utils.Svg("circle"),t.utils.Svg.CLIPPATH=new t.utils.Svg("clipPath"),t.utils.Svg.DEFS=new t.utils.Svg("defs"),t.utils.Svg.FECOMPOSITE=new t.utils.Svg("feComposite"),t.utils.Svg.FECOMPONENTTRANSFER=new t.utils.Svg("feComponentTransfer"),t.utils.Svg.FEFLOOD=new t.utils.Svg("feFlood"),t.utils.Svg.FEFUNCA=new t.utils.Svg("feFuncA"),t.utils.Svg.FEGAUSSIANBLUR=new t.utils.Svg("feGaussianBlur"),t.utils.Svg.FEPOINTLIGHT=new t.utils.Svg("fePointLight"),t.utils.Svg.FESPECULARLIGHTING=new t.utils.Svg("feSpecularLighting"),t.utils.Svg.FILTER=new t.utils.Svg("filter"),t.utils.Svg.FOREIGNOBJECT=new t.utils.Svg("foreignObject"),t.utils.Svg.G=new t.utils.Svg("g"),t.utils.Svg.IMAGE=new t.utils.Svg("image"),t.utils.Svg.LINE=new t.utils.Svg("line"),t.utils.Svg.PATH=new t.utils.Svg("path"),t.utils.Svg.PATTERN=new t.utils.Svg("pattern"),t.utils.Svg.POLYGON=new t.utils.Svg("polygon"),t.utils.Svg.RECT=new t.utils.Svg("rect"),t.utils.Svg.SVG=new t.utils.Svg("svg"),t.utils.Svg.TEXT=new t.utils.Svg("text"),t.utils.Svg.TSPAN=new t.utils.Svg("tspan"),t.utils.dom={},t.utils.dom.SVG_NS="http://www.w3.org/2000/svg",t.utils.dom.HTML_NS="http://www.w3.org/1999/xhtml",t.utils.dom.XLINK_NS="http://www.w3.org/1999/xlink",t.utils.dom.NodeType={ELEMENT_NODE:1,TEXT_NODE:3,COMMENT_NODE:8,DOCUMENT_POSITION_CONTAINED_BY:16},t.utils.dom.cacheWidths_=null,t.utils.dom.cacheReference_=0,t.utils.dom.canvasContext_=null,t.utils.dom.createSvgElement=function(e,i,s){e=document.createElementNS(t.utils.dom.SVG_NS,String(e));for(var r in i)e.setAttribute(r,i[r]);return document.body.runtimeStyle&&(e.runtimeStyle=e.currentStyle=e.style),s&&s.appendChild(e),e},t.utils.dom.addClass=function(e,i){var s=e.getAttribute("class")||"";return(" "+s+" ").indexOf(" "+i+" ")!=-1?!1:(s&&(s+=" "),e.setAttribute("class",s+i),!0)},t.utils.dom.removeClasses=function(e,i){i=i.split(" ");for(var s=0;s<i.length;s++)t.utils.dom.removeClass(e,i[s])},t.utils.dom.removeClass=function(e,i){var s=e.getAttribute("class");if((" "+s+" ").indexOf(" "+i+" ")==-1)return!1;s=s.split(/\s+/);for(var r=0;r<s.length;r++)s[r]&&s[r]!=i||(s.splice(r,1),r--);return s.length?e.setAttribute("class",s.join(" ")):e.removeAttribute("class"),!0},t.utils.dom.hasClass=function(e,i){return(" "+e.getAttribute("class")+" ").indexOf(" "+i+" ")!=-1},t.utils.dom.removeNode=function(e){return e&&e.parentNode?e.parentNode.removeChild(e):null},t.utils.dom.insertAfter=function(e,i){var s=i.nextSibling;if(i=i.parentNode,!i)throw Error("Reference node has no parent.");s?i.insertBefore(e,s):i.appendChild(e)},t.utils.dom.containsNode=function(e,i){return!!(e.compareDocumentPosition(i)&t.utils.dom.NodeType.DOCUMENT_POSITION_CONTAINED_BY)},t.utils.dom.setCssTransform=function(e,i){e.style.transform=i,e.style["-webkit-transform"]=i},t.utils.dom.startTextWidthCache=function(){t.utils.dom.cacheReference_++,t.utils.dom.cacheWidths_||(t.utils.dom.cacheWidths_={})},t.utils.dom.stopTextWidthCache=function(){t.utils.dom.cacheReference_--,t.utils.dom.cacheReference_||(t.utils.dom.cacheWidths_=null)},t.utils.dom.getTextWidth=function(e){var i=e.textContent+`
`+e.className.baseVal,s;if(t.utils.dom.cacheWidths_&&(s=t.utils.dom.cacheWidths_[i]))return s;try{s=t.utils.userAgent.IE||t.utils.userAgent.EDGE?e.getBBox().width:e.getComputedTextLength()}catch{return 8*e.textContent.length}return t.utils.dom.cacheWidths_&&(t.utils.dom.cacheWidths_[i]=s),s},t.utils.dom.getFastTextWidth=function(e,i,s,r){return t.utils.dom.getFastTextWidthWithSizeString(e,i+"pt",s,r)},t.utils.dom.getFastTextWidthWithSizeString=function(e,i,s,r){var o=e.textContent;e=o+`
`+e.className.baseVal;var h;return t.utils.dom.cacheWidths_&&(h=t.utils.dom.cacheWidths_[e])||(t.utils.dom.canvasContext_||(h=document.createElement("canvas"),h.className="blocklyComputeCanvas",document.body.appendChild(h),t.utils.dom.canvasContext_=h.getContext("2d")),t.utils.dom.canvasContext_.font=s+" "+i+" "+r,h=t.utils.dom.canvasContext_.measureText(o).width,t.utils.dom.cacheWidths_&&(t.utils.dom.cacheWidths_[e]=h)),h},t.utils.dom.measureFontMetrics=function(e,i,s,r){var o=document.createElement("span");o.style.font=s+" "+i+" "+r,o.textContent=e,e=document.createElement("div"),e.style.width="1px",e.style.height="0px",i=document.createElement("div"),i.setAttribute("style","position: fixed; top: 0; left: 0; display: flex;"),i.appendChild(o),i.appendChild(e),document.body.appendChild(i);try{s={},i.style.alignItems="baseline",s.baseline=e.offsetTop-o.offsetTop,i.style.alignItems="flex-end",s.height=e.offsetTop-o.offsetTop}finally{document.body.removeChild(i)}return s},t.Xml={},t.Xml.workspaceToDom=function(e,i){var s=t.utils.xml.createElement("xml"),r=t.Xml.variablesToDom(t.Variables.allUsedVarModels(e));r.hasChildNodes()&&s.appendChild(r);var o=e.getTopComments(!0);r=0;for(var h;h=o[r];r++)s.appendChild(h.toXmlWithXY(i));for(e=e.getTopBlocks(!0),r=0;o=e[r];r++)s.appendChild(t.Xml.blockToDomWithXY(o,i));return s},t.Xml.variablesToDom=function(e){for(var i=t.utils.xml.createElement("variables"),s=0,r;r=e[s];s++){var o=t.utils.xml.createElement("variable");o.appendChild(t.utils.xml.createTextNode(r.name)),r.type&&o.setAttribute("type",r.type),o.id=r.getId(),i.appendChild(o)}return i},t.Xml.blockToDomWithXY=function(e,i){if(e.isInsertionMarker()&&(e=e.getChildren(!1)[0],!e))return new DocumentFragment;var s;e.workspace.RTL&&(s=e.workspace.getWidth()),i=t.Xml.blockToDom(e,i);var r=e.getRelativeToSurfaceXY();return i.setAttribute("x",Math.round(e.workspace.RTL?s-r.x:r.x)),i.setAttribute("y",Math.round(r.y)),i},t.Xml.fieldToDom_=function(e){if(e.isSerializable()){var i=t.utils.xml.createElement("field");return i.setAttribute("name",e.name||""),e.toXml(i)}return null},t.Xml.allFieldsToDom_=function(e,i){for(var s=0,r;r=e.inputList[s];s++)for(var o=0,h;h=r.fieldRow[o];o++)(h=t.Xml.fieldToDom_(h))&&i.appendChild(h)},t.Xml.blockToDom=function(e,i){if(e.isInsertionMarker())return(e=e.getChildren(!1)[0])?t.Xml.blockToDom(e):new DocumentFragment;var s=t.utils.xml.createElement(e.isShadow()?"shadow":"block");if(s.setAttribute("type",e.type),i||s.setAttribute("id",e.id),e.mutationToDom){var r=e.mutationToDom();r&&(r.hasChildNodes()||r.hasAttributes())&&s.appendChild(r)}if(t.Xml.allFieldsToDom_(e,s),r=e.getCommentText()){var o=e.commentModel.size,h=e.commentModel.pinned,u=t.utils.xml.createElement("comment");u.appendChild(t.utils.xml.createTextNode(r)),u.setAttribute("pinned",h),u.setAttribute("h",o.height),u.setAttribute("w",o.width),s.appendChild(u)}for(e.data&&(r=t.utils.xml.createElement("data"),r.appendChild(t.utils.xml.createTextNode(e.data)),s.appendChild(r)),r=0;o=e.inputList[r];r++){var p;if(h=!0,o.type!=t.inputTypes.DUMMY){var d=o.connection.targetBlock();o.type==t.inputTypes.VALUE?p=t.utils.xml.createElement("value"):o.type==t.inputTypes.STATEMENT&&(p=t.utils.xml.createElement("statement")),u=o.connection.getShadowDom(),!u||d&&d.isShadow()||p.appendChild(t.Xml.cloneShadow_(u,i)),d&&(u=t.Xml.blockToDom(d,i),u.nodeType==t.utils.dom.NodeType.ELEMENT_NODE&&(p.appendChild(u),h=!1)),p.setAttribute("name",o.name),h||s.appendChild(p)}}return e.inputsInline!=null&&e.inputsInline!=e.inputsInlineDefault&&s.setAttribute("inline",e.inputsInline),e.isCollapsed()&&s.setAttribute("collapsed",!0),e.isEnabled()||s.setAttribute("disabled",!0),e.isDeletable()||e.isShadow()||s.setAttribute("deletable",!1),e.isMovable()||e.isShadow()||s.setAttribute("movable",!1),e.isEditable()||s.setAttribute("editable",!1),(r=e.getNextBlock())&&(u=t.Xml.blockToDom(r,i),u.nodeType==t.utils.dom.NodeType.ELEMENT_NODE&&(p=t.utils.xml.createElement("next"),p.appendChild(u),s.appendChild(p))),u=e.nextConnection&&e.nextConnection.getShadowDom(),!u||r&&r.isShadow()||p.appendChild(t.Xml.cloneShadow_(u,i)),s},t.Xml.cloneShadow_=function(e,i){for(var s=e=e.cloneNode(!0),r;s;)if(i&&s.nodeName=="shadow"&&s.removeAttribute("id"),s.firstChild)s=s.firstChild;else{for(;s&&!s.nextSibling;)r=s,s=s.parentNode,r.nodeType==t.utils.dom.NodeType.TEXT_NODE&&r.data.trim()==""&&s.firstChild!=r&&t.utils.dom.removeNode(r);s&&(r=s,s=s.nextSibling,r.nodeType==t.utils.dom.NodeType.TEXT_NODE&&r.data.trim()==""&&t.utils.dom.removeNode(r))}return e},t.Xml.domToText=function(e){return t.utils.xml.domToText(e).replace(/<(\w+)([^<]*)\/>/g,"<$1$2></$1>")},t.Xml.domToPrettyText=function(e){e=t.Xml.domToText(e).split("<");for(var i="",s=1;s<e.length;s++){var r=e[s];r[0]=="/"&&(i=i.substring(2)),e[s]=i+"<"+r,r[0]!="/"&&r.slice(-2)!="/>"&&(i+="  ")}return e=e.join(`
`),e=e.replace(/(<(\w+)\b[^>]*>[^\n]*)\n *<\/\2>/g,"$1</$2>"),e.replace(/^\n/,"")},t.Xml.textToDom=function(e){var i=t.utils.xml.textToDomDocument(e);if(!i||!i.documentElement||i.getElementsByTagName("parsererror").length)throw Error("textToDom was unable to parse: "+e);return i.documentElement},t.Xml.clearWorkspaceAndLoadFromXml=function(e,i){return i.setResizesEnabled(!1),i.clear(),e=t.Xml.domToWorkspace(e,i),i.setResizesEnabled(!0),e},t.Xml.domToWorkspace=function(e,i){if(e instanceof t.Workspace){var s=e;e=i,i=s,console.warn("Deprecated call to Blockly.Xml.domToWorkspace, swap the arguments.")}var r;i.RTL&&(r=i.getWidth()),s=[],t.utils.dom.startTextWidthCache();var o=t.Events.getGroup();o||t.Events.setGroup(!0),i.setResizesEnabled&&i.setResizesEnabled(!1);var h=!0;try{for(var u=0,p;p=e.childNodes[u];u++){var d=p.nodeName.toLowerCase(),f=p;if(d=="block"||d=="shadow"&&!t.Events.recordUndo){var g=t.Xml.domToBlock(f,i);s.push(g.id);var _=f.hasAttribute("x")?parseInt(f.getAttribute("x"),10):10,v=f.hasAttribute("y")?parseInt(f.getAttribute("y"),10):10;isNaN(_)||isNaN(v)||g.moveBy(i.RTL?r-_:_,v),h=!1}else{if(d=="shadow")throw TypeError("Shadow block cannot be a top-level block.");if(d=="comment")i.rendered?t.WorkspaceCommentSvg?t.WorkspaceCommentSvg.fromXml(f,i,r):console.warn("Missing require for Blockly.WorkspaceCommentSvg, ignoring workspace comment."):t.WorkspaceComment?t.WorkspaceComment.fromXml(f,i):console.warn("Missing require for Blockly.WorkspaceComment, ignoring workspace comment.");else if(d=="variables"){if(h)t.Xml.domToVariables(f,i);else throw Error("'variables' tag must exist once before block and shadow tag elements in the workspace XML, but it was found in another location.");h=!1}}}}finally{o||t.Events.setGroup(!1),t.utils.dom.stopTextWidthCache()}return i.setResizesEnabled&&i.setResizesEnabled(!0),t.Events.fire(new(t.Events.get(t.Events.FINISHED_LOADING))(i)),s},t.Xml.appendDomToWorkspace=function(e,i){var s;if(Object.prototype.hasOwnProperty.call(i,"scale")&&(s=i.getBlocksBoundingBox()),e=t.Xml.domToWorkspace(e,i),s&&s.top!=s.bottom){var r=s.bottom,o=i.RTL?s.right:s.left,h=1/0,u=-1/0,p=1/0;for(s=0;s<e.length;s++){var d=i.getBlockById(e[s]).getRelativeToSurfaceXY();d.y<p&&(p=d.y),d.x<h&&(h=d.x),d.x>u&&(u=d.x)}for(r=r-p+10,o=i.RTL?o-u:o-h,s=0;s<e.length;s++)i.getBlockById(e[s]).moveBy(o,r)}return e},t.Xml.domToBlock=function(e,i){if(e instanceof t.Workspace){var s=e;e=i,i=s,console.warn("Deprecated call to Blockly.Xml.domToBlock, swap the arguments.")}t.Events.disable(),s=i.getAllVariables();try{var r=t.Xml.domToBlockHeadless_(e,i),o=r.getDescendants(!1);if(i.rendered){r.setConnectionTracking(!1);for(var h=o.length-1;0<=h;h--)o[h].initSvg();for(h=o.length-1;0<=h;h--)o[h].render(!1);setTimeout(function(){r.disposed||r.setConnectionTracking(!0)},1),r.updateDisabled(),i.resizeContents()}else for(h=o.length-1;0<=h;h--)o[h].initModel()}finally{t.Events.enable()}if(t.Events.isEnabled()){for(e=t.Variables.getAddedVariables(i,s),h=0;h<e.length;h++)i=e[h],t.Events.fire(new(t.Events.get(t.Events.VAR_CREATE))(i));t.Events.fire(new(t.Events.get(t.Events.CREATE))(r))}return r},t.Xml.domToVariables=function(e,i){for(var s=0,r;r=e.childNodes[s];s++)if(r.nodeType==t.utils.dom.NodeType.ELEMENT_NODE){var o=r.getAttribute("type"),h=r.getAttribute("id");i.createVariable(r.textContent,o,h)}},t.Xml.mapSupportedXmlTags_=function(e){for(var i={mutation:[],comment:[],data:[],field:[],input:[],next:[]},s=0,r;r=e.childNodes[s];s++)if(r.nodeType!=t.utils.dom.NodeType.TEXT_NODE)switch(r.nodeName.toLowerCase()){case"mutation":i.mutation.push(r);break;case"comment":if(!t.Comment){console.warn("Missing require for Blockly.Comment, ignoring block comment.");break}i.comment.push(r);break;case"data":i.data.push(r);break;case"title":case"field":i.field.push(r);break;case"value":case"statement":i.input.push(r);break;case"next":i.next.push(r);break;default:console.warn("Ignoring unknown tag: "+r.nodeName)}return i},t.Xml.applyMutationTagNodes_=function(e,i){for(var s=!1,r=0,o;o=e[r];r++)i.domToMutation&&(i.domToMutation(o),i.initSvg&&(s=!0));return s},t.Xml.applyCommentTagNodes_=function(e,i){for(var s=0,r;r=e[s];s++){var o=r.textContent,h=r.getAttribute("pinned")=="true",u=parseInt(r.getAttribute("w"),10);r=parseInt(r.getAttribute("h"),10),i.setCommentText(o),i.commentModel.pinned=h,isNaN(u)||isNaN(r)||(i.commentModel.size=new t.utils.Size(u,r)),h&&i.getCommentIcon&&!i.isInFlyout&&setTimeout(function(){i.getCommentIcon().setVisible(!0)},1)}},t.Xml.applyDataTagNodes_=function(e,i){for(var s=0,r;r=e[s];s++)i.data=r.textContent},t.Xml.applyFieldTagNodes_=function(e,i){for(var s=0,r;r=e[s];s++){var o=r.getAttribute("name");t.Xml.domToField_(i,o,r)}},t.Xml.findChildBlocks_=function(e){for(var i={childBlockElement:null,childShadowElement:null},s=0,r;r=e.childNodes[s];s++)r.nodeType==t.utils.dom.NodeType.ELEMENT_NODE&&(r.nodeName.toLowerCase()=="block"?i.childBlockElement=r:r.nodeName.toLowerCase()=="shadow"&&(i.childShadowElement=r));return i},t.Xml.applyInputTagNodes_=function(e,i,s,r){for(var o=0,h;h=e[o];o++){var u=h.getAttribute("name"),p=s.getInput(u);if(!p){console.warn("Ignoring non-existent input "+u+" in block "+r);break}if(h=t.Xml.findChildBlocks_(h),h.childBlockElement){if(!p.connection)throw TypeError("Input connection does not exist.");t.Xml.domToBlockHeadless_(h.childBlockElement,i,p.connection,!1)}h.childShadowElement&&p.connection.setShadowDom(h.childShadowElement)}},t.Xml.applyNextTagNodes_=function(e,i,s){for(var r=0,o;o=e[r];r++){if(o=t.Xml.findChildBlocks_(o),o.childBlockElement){if(!s.nextConnection)throw TypeError("Next statement does not exist.");if(s.nextConnection.isConnected())throw TypeError("Next statement is already connected.");t.Xml.domToBlockHeadless_(o.childBlockElement,i,s.nextConnection,!0)}o.childShadowElement&&s.nextConnection&&s.nextConnection.setShadowDom(o.childShadowElement)}},t.Xml.domToBlockHeadless_=function(e,i,s,r){var o=e.getAttribute("type");if(!o)throw TypeError("Block type unspecified: "+e.outerHTML);var h=e.getAttribute("id");h=i.newBlock(o,h);var u=t.Xml.mapSupportedXmlTags_(e),p=t.Xml.applyMutationTagNodes_(u.mutation,h);if(t.Xml.applyCommentTagNodes_(u.comment,h),t.Xml.applyDataTagNodes_(u.data,h),s)if(r)if(h.previousConnection)s.connect(h.previousConnection);else throw TypeError("Next block does not have previous statement.");else if(h.outputConnection)s.connect(h.outputConnection);else if(h.previousConnection)s.connect(h.previousConnection);else throw TypeError("Child block does not have output or previous statement.");if(t.Xml.applyFieldTagNodes_(u.field,h),t.Xml.applyInputTagNodes_(u.input,i,h,o),t.Xml.applyNextTagNodes_(u.next,i,h),p&&h.initSvg(),(i=e.getAttribute("inline"))&&h.setInputsInline(i=="true"),(i=e.getAttribute("disabled"))&&h.setEnabled(i!="true"&&i!="disabled"),(i=e.getAttribute("deletable"))&&h.setDeletable(i=="true"),(i=e.getAttribute("movable"))&&h.setMovable(i=="true"),(i=e.getAttribute("editable"))&&h.setEditable(i=="true"),(i=e.getAttribute("collapsed"))&&h.setCollapsed(i=="true"),e.nodeName.toLowerCase()=="shadow"){for(e=h.getChildren(!1),i=0;s=e[i];i++)if(!s.isShadow())throw TypeError("Shadow block not allowed non-shadow child.");if(h.getVarModels().length)throw TypeError("Shadow blocks cannot have variable references.");h.setShadow(!0)}return h},t.Xml.domToField_=function(e,i,s){var r=e.getField(i);r?r.fromXml(s):console.warn("Ignoring non-existent field "+i+" in block "+e.type)},t.Xml.deleteNext=function(e){for(var i=0,s;s=e.childNodes[i];i++)if(s.nodeName.toLowerCase()=="next"){e.removeChild(s);break}},t.Events.BlockBase=function(e){t.Events.BlockBase.superClass_.constructor.call(this),this.blockId=(this.isBlank=typeof e>"u")?"":e.id,this.workspaceId=this.isBlank?"":e.workspace.id},t.utils.object.inherits(t.Events.BlockBase,t.Events.Abstract),t.Events.BlockBase.prototype.toJson=function(){var e=t.Events.BlockBase.superClass_.toJson.call(this);return e.blockId=this.blockId,e},t.Events.BlockBase.prototype.fromJson=function(e){t.Events.BlockBase.superClass_.fromJson.call(this,e),this.blockId=e.blockId},t.Events.Change=function(e,i,s,r,o){t.Events.Change.superClass_.constructor.call(this,e),e&&(this.element=typeof i>"u"?"":i,this.name=typeof s>"u"?"":s,this.oldValue=typeof r>"u"?"":r,this.newValue=typeof o>"u"?"":o)},t.utils.object.inherits(t.Events.Change,t.Events.BlockBase),t.Events.BlockChange=t.Events.Change,t.Events.Change.prototype.type=t.Events.CHANGE,t.Events.Change.prototype.toJson=function(){var e=t.Events.Change.superClass_.toJson.call(this);return e.element=this.element,this.name&&(e.name=this.name),e.oldValue=this.oldValue,e.newValue=this.newValue,e},t.Events.Change.prototype.fromJson=function(e){t.Events.Change.superClass_.fromJson.call(this,e),this.element=e.element,this.name=e.name,this.oldValue=e.oldValue,this.newValue=e.newValue},t.Events.Change.prototype.isNull=function(){return this.oldValue==this.newValue},t.Events.Change.prototype.run=function(e){var i=this.getEventWorkspace_().getBlockById(this.blockId);if(i)switch(i.mutator&&i.mutator.setVisible(!1),e=e?this.newValue:this.oldValue,this.element){case"field":(i=i.getField(this.name))?i.setValue(e):console.warn("Can't set non-existent field: "+this.name);break;case"comment":i.setCommentText(e||null);break;case"collapsed":i.setCollapsed(!!e);break;case"disabled":i.setEnabled(!e);break;case"inline":i.setInputsInline(!!e);break;case"mutation":var s="";if(i.mutationToDom&&(s=(s=i.mutationToDom())&&t.Xml.domToText(s)),i.domToMutation){var r=t.Xml.textToDom(e||"<mutation/>");i.domToMutation(r)}t.Events.fire(new(t.Events.get(t.Events.CHANGE))(i,"mutation",null,s,e));break;default:console.warn("Unknown change type: "+this.element)}else console.warn("Can't change non-existent block: "+this.blockId)},t.Events.Create=function(e){t.Events.Create.superClass_.constructor.call(this,e),e&&(e.isShadow()&&(this.recordUndo=!1),this.xml=e.workspace.rendered?t.Xml.blockToDomWithXY(e):t.Xml.blockToDom(e),this.ids=t.Events.getDescendantIds(e))},t.utils.object.inherits(t.Events.Create,t.Events.BlockBase),t.Events.BlockCreate=t.Events.Create,t.Events.Create.prototype.type=t.Events.CREATE,t.Events.Create.prototype.toJson=function(){var e=t.Events.Create.superClass_.toJson.call(this);return e.xml=t.Xml.domToText(this.xml),e.ids=this.ids,this.recordUndo||(e.recordUndo=this.recordUndo),e},t.Events.Create.prototype.fromJson=function(e){t.Events.Create.superClass_.fromJson.call(this,e),this.xml=t.Xml.textToDom(e.xml),this.ids=e.ids,e.recordUndo!==void 0&&(this.recordUndo=e.recordUndo)},t.Events.Create.prototype.run=function(e){var i=this.getEventWorkspace_();if(e)e=t.utils.xml.createElement("xml"),e.appendChild(this.xml),t.Xml.domToWorkspace(e,i);else{e=0;for(var s;s=this.ids[e];e++){var r=i.getBlockById(s);r?r.dispose(!1):s==this.blockId&&console.warn("Can't uncreate non-existent block: "+s)}}},t.Events.Delete=function(e){if(t.Events.Delete.superClass_.constructor.call(this,e),e){if(e.getParent())throw Error("Connected blocks cannot be deleted.");e.isShadow()&&(this.recordUndo=!1),this.oldXml=e.workspace.rendered?t.Xml.blockToDomWithXY(e):t.Xml.blockToDom(e),this.ids=t.Events.getDescendantIds(e)}},t.utils.object.inherits(t.Events.Delete,t.Events.BlockBase),t.Events.BlockDelete=t.Events.Delete,t.Events.Delete.prototype.type=t.Events.DELETE,t.Events.Delete.prototype.toJson=function(){var e=t.Events.Delete.superClass_.toJson.call(this);return e.oldXml=t.Xml.domToText(this.oldXml),e.ids=this.ids,this.recordUndo||(e.recordUndo=this.recordUndo),e},t.Events.Delete.prototype.fromJson=function(e){t.Events.Delete.superClass_.fromJson.call(this,e),this.oldXml=t.Xml.textToDom(e.oldXml),this.ids=e.ids,e.recordUndo!==void 0&&(this.recordUndo=e.recordUndo)},t.Events.Delete.prototype.run=function(e){var i=this.getEventWorkspace_();if(e){e=0;for(var s;s=this.ids[e];e++){var r=i.getBlockById(s);r?r.dispose(!1):s==this.blockId&&console.warn("Can't delete non-existent block: "+s)}}else e=t.utils.xml.createElement("xml"),e.appendChild(this.oldXml),t.Xml.domToWorkspace(e,i)},t.Events.Move=function(e){t.Events.Move.superClass_.constructor.call(this,e),e&&(e.isShadow()&&(this.recordUndo=!1),e=this.currentLocation_(),this.oldParentId=e.parentId,this.oldInputName=e.inputName,this.oldCoordinate=e.coordinate)},t.utils.object.inherits(t.Events.Move,t.Events.BlockBase),t.Events.BlockMove=t.Events.Move,t.Events.Move.prototype.type=t.Events.MOVE,t.Events.Move.prototype.toJson=function(){var e=t.Events.Move.superClass_.toJson.call(this);return this.newParentId&&(e.newParentId=this.newParentId),this.newInputName&&(e.newInputName=this.newInputName),this.newCoordinate&&(e.newCoordinate=Math.round(this.newCoordinate.x)+","+Math.round(this.newCoordinate.y)),this.recordUndo||(e.recordUndo=this.recordUndo),e},t.Events.Move.prototype.fromJson=function(e){if(t.Events.Move.superClass_.fromJson.call(this,e),this.newParentId=e.newParentId,this.newInputName=e.newInputName,e.newCoordinate){var i=e.newCoordinate.split(",");this.newCoordinate=new t.utils.Coordinate(Number(i[0]),Number(i[1]))}e.recordUndo!==void 0&&(this.recordUndo=e.recordUndo)},t.Events.Move.prototype.recordNew=function(){var e=this.currentLocation_();this.newParentId=e.parentId,this.newInputName=e.inputName,this.newCoordinate=e.coordinate},t.Events.Move.prototype.currentLocation_=function(){var e=this.getEventWorkspace_().getBlockById(this.blockId),i={},s=e.getParent();return s?(i.parentId=s.id,(e=s.getInputWithBlock(e))&&(i.inputName=e.name)):i.coordinate=e.getRelativeToSurfaceXY(),i},t.Events.Move.prototype.isNull=function(){return this.oldParentId==this.newParentId&&this.oldInputName==this.newInputName&&t.utils.Coordinate.equals(this.oldCoordinate,this.newCoordinate)},t.Events.Move.prototype.run=function(e){var i=this.getEventWorkspace_(),s=i.getBlockById(this.blockId);if(s){var r=e?this.newParentId:this.oldParentId,o=e?this.newInputName:this.oldInputName,h=e?this.newCoordinate:this.oldCoordinate;if(e=null,r&&(e=i.getBlockById(r),!e)){console.warn("Can't connect to non-existent block: "+r);return}if(s.getParent()&&s.unplug(),h)o=s.getRelativeToSurfaceXY(),s.moveBy(h.x-o.x,h.y-o.y);else{if(s=s.outputConnection||s.previousConnection,i=s.type,o){if(e=e.getInput(o))var u=e.connection}else i==t.connectionTypes.PREVIOUS_STATEMENT&&(u=e.nextConnection);u?s.connect(u):console.warn("Can't connect to non-existent input: "+o)}}else console.warn("Can't move non-existent block: "+this.blockId)},t.registry.register(t.registry.Type.EVENT,t.Events.CREATE,t.Events.Create),t.registry.register(t.registry.Type.EVENT,t.Events.DELETE,t.Events.Delete),t.registry.register(t.registry.Type.EVENT,t.Events.CHANGE,t.Events.Change),t.registry.register(t.registry.Type.EVENT,t.Events.MOVE,t.Events.Move),t.Events.FinishedLoading=function(e){this.isBlank=typeof e>"u",this.workspaceId=e?e.id:"",this.group=t.Events.getGroup(),this.recordUndo=!1},t.utils.object.inherits(t.Events.FinishedLoading,t.Events.Abstract),t.Events.FinishedLoading.prototype.type=t.Events.FINISHED_LOADING,t.Events.FinishedLoading.prototype.toJson=function(){var e={type:this.type};return this.group&&(e.group=this.group),this.workspaceId&&(e.workspaceId=this.workspaceId),e},t.Events.FinishedLoading.prototype.fromJson=function(e){this.isBlank=!1,this.workspaceId=e.workspaceId,this.group=e.group},t.registry.register(t.registry.Type.EVENT,t.Events.FINISHED_LOADING,t.Events.FinishedLoading),t.Events.UiBase=function(e){t.Events.UiBase.superClass_.constructor.call(this),this.isBlank=typeof e>"u",this.workspaceId=e||"",this.recordUndo=!1},t.utils.object.inherits(t.Events.UiBase,t.Events.Abstract),t.Events.UiBase.prototype.isUiEvent=!0,t.Events.Ui=function(e,i,s,r){t.Events.Ui.superClass_.constructor.call(this,e?e.workspace.id:void 0),this.blockId=e?e.id:null,this.element=typeof i>"u"?"":i,this.oldValue=typeof s>"u"?"":s,this.newValue=typeof r>"u"?"":r},t.utils.object.inherits(t.Events.Ui,t.Events.UiBase),t.Events.Ui.prototype.type=t.Events.UI,t.Events.Ui.prototype.toJson=function(){var e=t.Events.Ui.superClass_.toJson.call(this);return e.element=this.element,this.newValue!==void 0&&(e.newValue=this.newValue),this.blockId&&(e.blockId=this.blockId),e},t.Events.Ui.prototype.fromJson=function(e){t.Events.Ui.superClass_.fromJson.call(this,e),this.element=e.element,this.newValue=e.newValue,this.blockId=e.blockId},t.registry.register(t.registry.Type.EVENT,t.Events.UI,t.Events.Ui),t.Events.VarBase=function(e){t.Events.VarBase.superClass_.constructor.call(this),this.varId=(this.isBlank=typeof e>"u")?"":e.getId(),this.workspaceId=this.isBlank?"":e.workspace.id},t.utils.object.inherits(t.Events.VarBase,t.Events.Abstract),t.Events.VarBase.prototype.toJson=function(){var e=t.Events.VarBase.superClass_.toJson.call(this);return e.varId=this.varId,e},t.Events.VarBase.prototype.fromJson=function(e){t.Events.VarBase.superClass_.toJson.call(this),this.varId=e.varId},t.Events.VarCreate=function(e){t.Events.VarCreate.superClass_.constructor.call(this,e),e&&(this.varType=e.type,this.varName=e.name)},t.utils.object.inherits(t.Events.VarCreate,t.Events.VarBase),t.Events.VarCreate.prototype.type=t.Events.VAR_CREATE,t.Events.VarCreate.prototype.toJson=function(){var e=t.Events.VarCreate.superClass_.toJson.call(this);return e.varType=this.varType,e.varName=this.varName,e},t.Events.VarCreate.prototype.fromJson=function(e){t.Events.VarCreate.superClass_.fromJson.call(this,e),this.varType=e.varType,this.varName=e.varName},t.Events.VarCreate.prototype.run=function(e){var i=this.getEventWorkspace_();e?i.createVariable(this.varName,this.varType,this.varId):i.deleteVariableById(this.varId)},t.Events.VarDelete=function(e){t.Events.VarDelete.superClass_.constructor.call(this,e),e&&(this.varType=e.type,this.varName=e.name)},t.utils.object.inherits(t.Events.VarDelete,t.Events.VarBase),t.Events.VarDelete.prototype.type=t.Events.VAR_DELETE,t.Events.VarDelete.prototype.toJson=function(){var e=t.Events.VarDelete.superClass_.toJson.call(this);return e.varType=this.varType,e.varName=this.varName,e},t.Events.VarDelete.prototype.fromJson=function(e){t.Events.VarDelete.superClass_.fromJson.call(this,e),this.varType=e.varType,this.varName=e.varName},t.Events.VarDelete.prototype.run=function(e){var i=this.getEventWorkspace_();e?i.deleteVariableById(this.varId):i.createVariable(this.varName,this.varType,this.varId)},t.Events.VarRename=function(e,i){t.Events.VarRename.superClass_.constructor.call(this,e),e&&(this.oldName=e.name,this.newName=typeof i>"u"?"":i)},t.utils.object.inherits(t.Events.VarRename,t.Events.VarBase),t.Events.VarRename.prototype.type=t.Events.VAR_RENAME,t.Events.VarRename.prototype.toJson=function(){var e=t.Events.VarRename.superClass_.toJson.call(this);return e.oldName=this.oldName,e.newName=this.newName,e},t.Events.VarRename.prototype.fromJson=function(e){t.Events.VarRename.superClass_.fromJson.call(this,e),this.oldName=e.oldName,this.newName=e.newName},t.Events.VarRename.prototype.run=function(e){var i=this.getEventWorkspace_();e?i.renameVariableById(this.varId,this.newName):i.renameVariableById(this.varId,this.oldName)},t.registry.register(t.registry.Type.EVENT,t.Events.VAR_CREATE,t.Events.VarCreate),t.registry.register(t.registry.Type.EVENT,t.Events.VAR_DELETE,t.Events.VarDelete),t.registry.register(t.registry.Type.EVENT,t.Events.VAR_RENAME,t.Events.VarRename),t.BlockDragSurfaceSvg=function(e){this.container_=e,this.createDom()},t.BlockDragSurfaceSvg.prototype.SVG_=null,t.BlockDragSurfaceSvg.prototype.dragGroup_=null,t.BlockDragSurfaceSvg.prototype.container_=null,t.BlockDragSurfaceSvg.prototype.scale_=1,t.BlockDragSurfaceSvg.prototype.surfaceXY_=null,t.BlockDragSurfaceSvg.prototype.createDom=function(){this.SVG_||(this.SVG_=t.utils.dom.createSvgElement(t.utils.Svg.SVG,{xmlns:t.utils.dom.SVG_NS,"xmlns:html":t.utils.dom.HTML_NS,"xmlns:xlink":t.utils.dom.XLINK_NS,version:"1.1",class:"blocklyBlockDragSurface"},this.container_),this.dragGroup_=t.utils.dom.createSvgElement(t.utils.Svg.G,{},this.SVG_))},t.BlockDragSurfaceSvg.prototype.setBlocksAndShow=function(e){if(this.dragGroup_.childNodes.length)throw Error("Already dragging a block.");this.dragGroup_.appendChild(e),this.SVG_.style.display="block",this.surfaceXY_=new t.utils.Coordinate(0,0)},t.BlockDragSurfaceSvg.prototype.translateAndScaleGroup=function(e,i,s){this.scale_=s,e=e.toFixed(0),i=i.toFixed(0),this.dragGroup_.setAttribute("transform","translate("+e+","+i+") scale("+s+")")},t.BlockDragSurfaceSvg.prototype.translateSurfaceInternal_=function(){var e=this.surfaceXY_.x,i=this.surfaceXY_.y;e=e.toFixed(0),i=i.toFixed(0),this.SVG_.style.display="block",t.utils.dom.setCssTransform(this.SVG_,"translate3d("+e+"px, "+i+"px, 0px)")},t.BlockDragSurfaceSvg.prototype.translateSurface=function(e,i){this.surfaceXY_=new t.utils.Coordinate(e*this.scale_,i*this.scale_),this.translateSurfaceInternal_()},t.BlockDragSurfaceSvg.prototype.getSurfaceTranslation=function(){var e=t.utils.getRelativeXY(this.SVG_);return new t.utils.Coordinate(e.x/this.scale_,e.y/this.scale_)},t.BlockDragSurfaceSvg.prototype.getGroup=function(){return this.dragGroup_},t.BlockDragSurfaceSvg.prototype.getCurrentBlock=function(){return this.dragGroup_.firstChild},t.BlockDragSurfaceSvg.prototype.clearAndHide=function(e){if(e?e.appendChild(this.getCurrentBlock()):this.dragGroup_.removeChild(this.getCurrentBlock()),this.SVG_.style.display="none",this.dragGroup_.childNodes.length)throw Error("Drag group was not cleared.");this.surfaceXY_=null},t.Css={},t.Css.injected_=!1,t.Css.register=function(e){if(t.Css.injected_)throw Error("CSS already injected");Array.prototype.push.apply(t.Css.CONTENT,e),e.length=0},t.Css.inject=function(e,i){if(!t.Css.injected_){t.Css.injected_=!0;var s=t.Css.CONTENT.join(`
`);t.Css.CONTENT.length=0,e&&(e=i.replace(/[\\/]$/,""),s=s.replace(/<<<PATH>>>/g,e),e=document.createElement("style"),e.id="blockly-common-style",s=document.createTextNode(s),e.appendChild(s),document.head.insertBefore(e,document.head.firstChild))}},t.Css.CONTENT=[".blocklySvg {","background-color: #fff;","outline: none;","overflow: hidden;","position: absolute;","display: block;","}",".blocklyWidgetDiv {","display: none;","position: absolute;","z-index: 99999;","}",".injectionDiv {","height: 100%;","position: relative;","overflow: hidden;","touch-action: none;","}",".blocklyNonSelectable {","user-select: none;","-ms-user-select: none;","-webkit-user-select: none;","}",".blocklyWsDragSurface {","display: none;","position: absolute;","top: 0;","left: 0;","}",".blocklyWsDragSurface.blocklyOverflowVisible {","overflow: visible;","}",".blocklyBlockDragSurface {","display: none;","position: absolute;","top: 0;","left: 0;","right: 0;","bottom: 0;","overflow: visible !important;","z-index: 50;","}",".blocklyBlockCanvas.blocklyCanvasTransitioning,",".blocklyBubbleCanvas.blocklyCanvasTransitioning {","transition: transform .5s;","}",".blocklyTooltipDiv {","background-color: #ffffc7;","border: 1px solid #ddc;","box-shadow: 4px 4px 20px 1px rgba(0,0,0,.15);","color: #000;","display: none;","font: 9pt sans-serif;","opacity: .9;","padding: 2px;","position: absolute;","z-index: 100000;","}",".blocklyDropDownDiv {","position: absolute;","left: 0;","top: 0;","z-index: 1000;","display: none;","border: 1px solid;","border-color: #dadce0;","background-color: #fff;","border-radius: 2px;","padding: 4px;","box-shadow: 0 0 3px 1px rgba(0,0,0,.3);","}",".blocklyDropDownDiv.blocklyFocused {","box-shadow: 0 0 6px 1px rgba(0,0,0,.3);","}",".blocklyDropDownContent {","max-height: 300px;","overflow: auto;","overflow-x: hidden;","position: relative;","}",".blocklyDropDownArrow {","position: absolute;","left: 0;","top: 0;","width: 16px;","height: 16px;","z-index: -1;","background-color: inherit;","border-color: inherit;","}",".blocklyDropDownButton {","display: inline-block;","float: left;","padding: 0;","margin: 4px;","border-radius: 4px;","outline: none;","border: 1px solid;","transition: box-shadow .1s;","cursor: pointer;","}",".blocklyArrowTop {","border-top: 1px solid;","border-left: 1px solid;","border-top-left-radius: 4px;","border-color: inherit;","}",".blocklyArrowBottom {","border-bottom: 1px solid;","border-right: 1px solid;","border-bottom-right-radius: 4px;","border-color: inherit;","}",".blocklyResizeSE {","cursor: se-resize;","fill: #aaa;","}",".blocklyResizeSW {","cursor: sw-resize;","fill: #aaa;","}",".blocklyResizeLine {","stroke: #515A5A;","stroke-width: 1;","}",".blocklyHighlightedConnectionPath {","fill: none;","stroke: #fc3;","stroke-width: 4px;","}",".blocklyPathLight {","fill: none;","stroke-linecap: round;","stroke-width: 1;","}",".blocklySelected>.blocklyPathLight {","display: none;","}",".blocklyDraggable {",'cursor: url("<<<PATH>>>/handopen.cur"), auto;',"cursor: grab;","cursor: -webkit-grab;","}",".blocklyDragging {",'cursor: url("<<<PATH>>>/handclosed.cur"), auto;',"cursor: grabbing;","cursor: -webkit-grabbing;","}",".blocklyDraggable:active {",'cursor: url("<<<PATH>>>/handclosed.cur"), auto;',"cursor: grabbing;","cursor: -webkit-grabbing;","}",".blocklyBlockDragSurface .blocklyDraggable {",'cursor: url("<<<PATH>>>/handclosed.cur"), auto;',"cursor: grabbing;","cursor: -webkit-grabbing;","}",".blocklyDragging.blocklyDraggingDelete {",'cursor: url("<<<PATH>>>/handdelete.cur"), auto;',"}",".blocklyDragging>.blocklyPath,",".blocklyDragging>.blocklyPathLight {","fill-opacity: .8;","stroke-opacity: .8;","}",".blocklyDragging>.blocklyPathDark {","display: none;","}",".blocklyDisabled>.blocklyPath {","fill-opacity: .5;","stroke-opacity: .5;","}",".blocklyDisabled>.blocklyPathLight,",".blocklyDisabled>.blocklyPathDark {","display: none;","}",".blocklyInsertionMarker>.blocklyPath,",".blocklyInsertionMarker>.blocklyPathLight,",".blocklyInsertionMarker>.blocklyPathDark {","fill-opacity: .2;","stroke: none;","}",".blocklyMultilineText {","font-family: monospace;","}",".blocklyNonEditableText>text {","pointer-events: none;","}",".blocklyFlyout {","position: absolute;","z-index: 20;","}",".blocklyText text {","cursor: default;","}",".blocklySvg text,",".blocklyBlockDragSurface text {","user-select: none;","-ms-user-select: none;","-webkit-user-select: none;","cursor: inherit;","}",".blocklyHidden {","display: none;","}",".blocklyFieldDropdown:not(.blocklyHidden) {","display: block;","}",".blocklyIconGroup {","cursor: default;","}",".blocklyIconGroup:not(:hover),",".blocklyIconGroupReadonly {","opacity: .6;","}",".blocklyIconShape {","fill: #00f;","stroke: #fff;","stroke-width: 1px;","}",".blocklyIconSymbol {","fill: #fff;","}",".blocklyMinimalBody {","margin: 0;","padding: 0;","}",".blocklyHtmlInput {","border: none;","border-radius: 4px;","height: 100%;","margin: 0;","outline: none;","padding: 0;","width: 100%;","text-align: center;","display: block;","box-sizing: border-box;","}",".blocklyHtmlInput::-ms-clear {","display: none;","}",".blocklyMainBackground {","stroke-width: 1;","stroke: #c6c6c6;","}",".blocklyMutatorBackground {","fill: #fff;","stroke: #ddd;","stroke-width: 1;","}",".blocklyFlyoutBackground {","fill: #ddd;","fill-opacity: .8;","}",".blocklyMainWorkspaceScrollbar {","z-index: 20;","}",".blocklyFlyoutScrollbar {","z-index: 30;","}",".blocklyScrollbarHorizontal,",".blocklyScrollbarVertical {","position: absolute;","outline: none;","}",".blocklyScrollbarBackground {","opacity: 0;","}",".blocklyScrollbarHandle {","fill: #ccc;","}",".blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,",".blocklyScrollbarHandle:hover {","fill: #bbb;","}",".blocklyFlyout .blocklyScrollbarHandle {","fill: #bbb;","}",".blocklyFlyout .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,",".blocklyFlyout .blocklyScrollbarHandle:hover {","fill: #aaa;","}",".blocklyInvalidInput {","background: #faa;","}",".blocklyVerticalMarker {","stroke-width: 3px;","fill: rgba(255,255,255,.5);","pointer-events: none;","}",".blocklyComputeCanvas {","position: absolute;","width: 0;","height: 0;","}",".blocklyNoPointerEvents {","pointer-events: none;","}",".blocklyContextMenu {","border-radius: 4px;","max-height: 100%;","}",".blocklyDropdownMenu {","border-radius: 2px;","padding: 0 !important;","}",".blocklyDropdownMenu .blocklyMenuItem {","padding-left: 28px;","}",".blocklyDropdownMenu .blocklyMenuItemRtl {","padding-left: 5px;","padding-right: 28px;","}",".blocklyWidgetDiv .blocklyMenu {","background: #fff;","border: 1px solid transparent;","box-shadow: 0 0 3px 1px rgba(0,0,0,.3);","font: normal 13px Arial, sans-serif;","margin: 0;","outline: none;","padding: 4px 0;","position: absolute;","overflow-y: auto;","overflow-x: hidden;","max-height: 100%;","z-index: 20000;","}",".blocklyWidgetDiv .blocklyMenu.blocklyFocused {","box-shadow: 0 0 6px 1px rgba(0,0,0,.3);","}",".blocklyDropDownDiv .blocklyMenu {","background: inherit;","border: inherit;",'font: normal 13px "Helvetica Neue", Helvetica, sans-serif;',"outline: none;","position: relative;","z-index: 20000;","}",".blocklyMenuItem {","border: none;","color: #000;","cursor: pointer;","list-style: none;","margin: 0;","min-width: 7em;","padding: 6px 15px;","white-space: nowrap;","}",".blocklyMenuItemDisabled {","color: #ccc;","cursor: inherit;","}",".blocklyMenuItemHighlight {","background-color: rgba(0,0,0,.1);","}",".blocklyMenuItemCheckbox {","height: 16px;","position: absolute;","width: 16px;","}",".blocklyMenuItemSelected .blocklyMenuItemCheckbox {","background: url(<<<PATH>>>/sprites.png) no-repeat -48px -16px;","float: left;","margin-left: -24px;","position: static;","}",".blocklyMenuItemRtl .blocklyMenuItemCheckbox {","float: right;","margin-right: -24px;","}"],t.utils.math={},t.utils.math.toRadians=function(e){return e*Math.PI/180},t.utils.math.toDegrees=function(e){return 180*e/Math.PI},t.utils.math.clamp=function(e,i,s){if(s<e){var r=s;s=e,e=r}return Math.max(e,Math.min(i,s))},t.DropDownDiv=function(){},t.DropDownDiv.boundsElement_=null,t.DropDownDiv.owner_=null,t.DropDownDiv.positionToField_=null,t.DropDownDiv.ARROW_SIZE=16,t.DropDownDiv.BORDER_SIZE=1,t.DropDownDiv.ARROW_HORIZONTAL_PADDING=12,t.DropDownDiv.PADDING_Y=16,t.DropDownDiv.ANIMATION_TIME=.25,t.DropDownDiv.animateOutTimer_=null,t.DropDownDiv.onHide_=null,t.DropDownDiv.rendererClassName_="",t.DropDownDiv.themeClassName_="",t.DropDownDiv.createDom=function(){if(!t.DropDownDiv.DIV_){var e=document.createElement("div");e.className="blocklyDropDownDiv",(t.parentContainer||document.body).appendChild(e),t.DropDownDiv.DIV_=e;var i=document.createElement("div");i.className="blocklyDropDownContent",e.appendChild(i),t.DropDownDiv.content_=i,i=document.createElement("div"),i.className="blocklyDropDownArrow",e.appendChild(i),t.DropDownDiv.arrow_=i,t.DropDownDiv.DIV_.style.opacity=0,t.DropDownDiv.DIV_.style.transition="transform "+t.DropDownDiv.ANIMATION_TIME+"s, opacity "+t.DropDownDiv.ANIMATION_TIME+"s",e.addEventListener("focusin",function(){t.utils.dom.addClass(e,"blocklyFocused")}),e.addEventListener("focusout",function(){t.utils.dom.removeClass(e,"blocklyFocused")})}},t.DropDownDiv.setBoundsElement=function(e){t.DropDownDiv.boundsElement_=e},t.DropDownDiv.getContentDiv=function(){return t.DropDownDiv.content_},t.DropDownDiv.clearContent=function(){t.DropDownDiv.content_.textContent="",t.DropDownDiv.content_.style.width=""},t.DropDownDiv.setColour=function(e,i){t.DropDownDiv.DIV_.style.backgroundColor=e,t.DropDownDiv.DIV_.style.borderColor=i},t.DropDownDiv.showPositionedByBlock=function(e,i,s,r){return t.DropDownDiv.showPositionedByRect_(t.DropDownDiv.getScaledBboxOfBlock_(i),e,s,r)},t.DropDownDiv.showPositionedByField=function(e,i,s){return t.DropDownDiv.positionToField_=!0,t.DropDownDiv.showPositionedByRect_(t.DropDownDiv.getScaledBboxOfField_(e),e,i,s)},t.DropDownDiv.getScaledBboxOfBlock_=function(e){var i=e.getSvgRoot(),s=i.getBBox(),r=e.workspace.scale;return e=s.height*r,s=s.width*r,i=t.utils.style.getPageOffset(i),new t.utils.Rect(i.y,i.y+e,i.x,i.x+s)},t.DropDownDiv.getScaledBboxOfField_=function(e){return e=e.getScaledBBox(),new t.utils.Rect(e.top,e.bottom,e.left,e.right)},t.DropDownDiv.showPositionedByRect_=function(e,i,s,r){var o=e.left+(e.right-e.left)/2,h=e.bottom;e=e.top,r&&(e+=r),r=i.getSourceBlock();for(var u=r.workspace;u.options.parentWorkspace;)u=u.options.parentWorkspace;return t.DropDownDiv.setBoundsElement(u.getParentSvg().parentNode),t.DropDownDiv.show(i,r.RTL,o,h,o,e,s)},t.DropDownDiv.show=function(e,i,s,r,o,h,u){return t.DropDownDiv.owner_=e,t.DropDownDiv.onHide_=u||null,e=t.DropDownDiv.DIV_,e.style.direction=i?"rtl":"ltr",i=t.getMainWorkspace(),t.DropDownDiv.rendererClassName_=i.getRenderer().getClassName(),t.DropDownDiv.themeClassName_=i.getTheme().getClassName(),t.utils.dom.addClass(e,t.DropDownDiv.rendererClassName_),t.utils.dom.addClass(e,t.DropDownDiv.themeClassName_),t.DropDownDiv.positionInternal_(s,r,o,h)},t.DropDownDiv.getBoundsInfo_=function(){var e=t.utils.style.getPageOffset(t.DropDownDiv.boundsElement_),i=t.utils.style.getSize(t.DropDownDiv.boundsElement_);return{left:e.x,right:e.x+i.width,top:e.y,bottom:e.y+i.height,width:i.width,height:i.height}},t.DropDownDiv.getPositionMetrics_=function(e,i,s,r){var o=t.DropDownDiv.getBoundsInfo_(),h=t.utils.style.getSize(t.DropDownDiv.DIV_);return i+h.height<o.bottom?t.DropDownDiv.getPositionBelowMetrics_(e,i,o,h):r-h.height>o.top?t.DropDownDiv.getPositionAboveMetrics_(s,r,o,h):i+h.height<document.documentElement.clientHeight?t.DropDownDiv.getPositionBelowMetrics_(e,i,o,h):r-h.height>document.documentElement.clientTop?t.DropDownDiv.getPositionAboveMetrics_(s,r,o,h):t.DropDownDiv.getPositionTopOfPageMetrics_(e,o,h)},t.DropDownDiv.getPositionBelowMetrics_=function(e,i,s,r){return e=t.DropDownDiv.getPositionX(e,s.left,s.right,r.width),{initialX:e.divX,initialY:i,finalX:e.divX,finalY:i+t.DropDownDiv.PADDING_Y,arrowX:e.arrowX,arrowY:-(t.DropDownDiv.ARROW_SIZE/2+t.DropDownDiv.BORDER_SIZE),arrowAtTop:!0,arrowVisible:!0}},t.DropDownDiv.getPositionAboveMetrics_=function(e,i,s,r){return e=t.DropDownDiv.getPositionX(e,s.left,s.right,r.width),{initialX:e.divX,initialY:i-r.height,finalX:e.divX,finalY:i-r.height-t.DropDownDiv.PADDING_Y,arrowX:e.arrowX,arrowY:r.height-2*t.DropDownDiv.BORDER_SIZE-t.DropDownDiv.ARROW_SIZE/2,arrowAtTop:!1,arrowVisible:!0}},t.DropDownDiv.getPositionTopOfPageMetrics_=function(e,i,s){return e=t.DropDownDiv.getPositionX(e,i.left,i.right,s.width),{initialX:e.divX,initialY:0,finalX:e.divX,finalY:0,arrowAtTop:null,arrowX:null,arrowY:null,arrowVisible:!1}},t.DropDownDiv.getPositionX=function(e,i,s,r){var o=e;return e=t.utils.math.clamp(i,e-r/2,s-r),o-=t.DropDownDiv.ARROW_SIZE/2,i=t.DropDownDiv.ARROW_HORIZONTAL_PADDING,r=t.utils.math.clamp(i,o-e,r-i-t.DropDownDiv.ARROW_SIZE),{arrowX:r,divX:e}},t.DropDownDiv.isVisible=function(){return!!t.DropDownDiv.owner_},t.DropDownDiv.hideIfOwner=function(e,i){return t.DropDownDiv.owner_===e?(i?t.DropDownDiv.hideWithoutAnimation():t.DropDownDiv.hide(),!0):!1},t.DropDownDiv.hide=function(){var e=t.DropDownDiv.DIV_;e.style.transform="translate(0, 0)",e.style.opacity=0,t.DropDownDiv.animateOutTimer_=setTimeout(function(){t.DropDownDiv.hideWithoutAnimation()},1e3*t.DropDownDiv.ANIMATION_TIME),t.DropDownDiv.onHide_&&(t.DropDownDiv.onHide_(),t.DropDownDiv.onHide_=null)},t.DropDownDiv.hideWithoutAnimation=function(){if(t.DropDownDiv.isVisible()){t.DropDownDiv.animateOutTimer_&&clearTimeout(t.DropDownDiv.animateOutTimer_);var e=t.DropDownDiv.DIV_;e.style.transform="",e.style.left="",e.style.top="",e.style.opacity=0,e.style.display="none",e.style.backgroundColor="",e.style.borderColor="",t.DropDownDiv.onHide_&&(t.DropDownDiv.onHide_(),t.DropDownDiv.onHide_=null),t.DropDownDiv.clearContent(),t.DropDownDiv.owner_=null,t.DropDownDiv.rendererClassName_&&(t.utils.dom.removeClass(e,t.DropDownDiv.rendererClassName_),t.DropDownDiv.rendererClassName_=""),t.DropDownDiv.themeClassName_&&(t.utils.dom.removeClass(e,t.DropDownDiv.themeClassName_),t.DropDownDiv.themeClassName_=""),t.getMainWorkspace().markFocused()}},t.DropDownDiv.positionInternal_=function(e,i,s,r){e=t.DropDownDiv.getPositionMetrics_(e,i,s,r),e.arrowVisible?(t.DropDownDiv.arrow_.style.display="",t.DropDownDiv.arrow_.style.transform="translate("+e.arrowX+"px,"+e.arrowY+"px) rotate(45deg)",t.DropDownDiv.arrow_.setAttribute("class",e.arrowAtTop?"blocklyDropDownArrow blocklyArrowTop":"blocklyDropDownArrow blocklyArrowBottom")):t.DropDownDiv.arrow_.style.display="none",i=Math.floor(e.initialX),s=Math.floor(e.initialY),r=Math.floor(e.finalX);var o=Math.floor(e.finalY),h=t.DropDownDiv.DIV_;return h.style.left=i+"px",h.style.top=s+"px",h.style.display="block",h.style.opacity=1,h.style.transform="translate("+(r-i)+"px,"+(o-s)+"px)",!!e.arrowAtTop},t.DropDownDiv.repositionForWindowResize=function(){if(t.DropDownDiv.owner_){var e=t.DropDownDiv.owner_,i=e.getSourceBlock();e=t.DropDownDiv.positionToField_?t.DropDownDiv.getScaledBboxOfField_(e):t.DropDownDiv.getScaledBboxOfBlock_(i),i=e.left+(e.right-e.left)/2,t.DropDownDiv.positionInternal_(i,e.bottom,i,e.top)}else t.DropDownDiv.hide()},t.Grid=function(e,i){this.gridPattern_=e,this.spacing_=i.spacing,this.length_=i.length,this.line2_=(this.line1_=e.firstChild)&&this.line1_.nextSibling,this.snapToGrid_=i.snap},t.Grid.prototype.scale_=1,t.Grid.prototype.dispose=function(){this.gridPattern_=null},t.Grid.prototype.shouldSnap=function(){return this.snapToGrid_},t.Grid.prototype.getSpacing=function(){return this.spacing_},t.Grid.prototype.getPatternId=function(){return this.gridPattern_.id},t.Grid.prototype.update=function(e){this.scale_=e;var i=this.spacing_*e||100;this.gridPattern_.setAttribute("width",i),this.gridPattern_.setAttribute("height",i),i=Math.floor(this.spacing_/2)+.5;var s=i-this.length_/2,r=i+this.length_/2;i*=e,s*=e,r*=e,this.setLineAttributes_(this.line1_,e,s,r,i,i),this.setLineAttributes_(this.line2_,e,i,i,s,r)},t.Grid.prototype.setLineAttributes_=function(e,i,s,r,o,h){e&&(e.setAttribute("stroke-width",i),e.setAttribute("x1",s),e.setAttribute("y1",o),e.setAttribute("x2",r),e.setAttribute("y2",h))},t.Grid.prototype.moveTo=function(e,i){this.gridPattern_.setAttribute("x",e),this.gridPattern_.setAttribute("y",i),(t.utils.userAgent.IE||t.utils.userAgent.EDGE)&&this.update(this.scale_)},t.Grid.createDom=function(e,i,s){return e=t.utils.dom.createSvgElement(t.utils.Svg.PATTERN,{id:"blocklyGridPattern"+e,patternUnits:"userSpaceOnUse"},s),0<i.length&&0<i.spacing?(t.utils.dom.createSvgElement(t.utils.Svg.LINE,{stroke:i.colour},e),1<i.length&&t.utils.dom.createSvgElement(t.utils.Svg.LINE,{stroke:i.colour},e)):t.utils.dom.createSvgElement(t.utils.Svg.LINE,{},e),e},t.Theme=function(e,i,s,r){this.name=e,this.blockStyles=i||Object.create(null),this.categoryStyles=s||Object.create(null),this.componentStyles=r||Object.create(null),this.fontStyle=Object.create(null),this.startHats=null,t.registry.register(t.registry.Type.THEME,e,this)},t.Theme.prototype.getClassName=function(){return this.name+"-theme"},t.Theme.prototype.setBlockStyle=function(e,i){this.blockStyles[e]=i},t.Theme.prototype.setCategoryStyle=function(e,i){this.categoryStyles[e]=i},t.Theme.prototype.getComponentStyle=function(e){return(e=this.componentStyles[e])&&typeof e=="string"&&this.getComponentStyle(e)?this.getComponentStyle(e):e?String(e):null},t.Theme.prototype.setComponentStyle=function(e,i){this.componentStyles[e]=i},t.Theme.prototype.setFontStyle=function(e){this.fontStyle=e},t.Theme.prototype.setStartHats=function(e){this.startHats=e},t.Theme.defineTheme=function(e,i){var s=new t.Theme(e),r=i.base;return r&&(typeof r=="string"&&(r=t.registry.getObject(t.registry.Type.THEME,r)),r instanceof t.Theme&&(t.utils.object.deepMerge(s,r),s.name=e)),t.utils.object.deepMerge(s.blockStyles,i.blockStyles),t.utils.object.deepMerge(s.categoryStyles,i.categoryStyles),t.utils.object.deepMerge(s.componentStyles,i.componentStyles),t.utils.object.deepMerge(s.fontStyle,i.fontStyle),i.startHats!=null&&(s.startHats=i.startHats),s},t.Themes={},t.Themes.Classic={},t.Themes.Classic.defaultBlockStyles={colour_blocks:{colourPrimary:"20"},list_blocks:{colourPrimary:"260"},logic_blocks:{colourPrimary:"210"},loop_blocks:{colourPrimary:"120"},math_blocks:{colourPrimary:"230"},procedure_blocks:{colourPrimary:"290"},text_blocks:{colourPrimary:"160"},variable_blocks:{colourPrimary:"330"},variable_dynamic_blocks:{colourPrimary:"310"},hat_blocks:{colourPrimary:"330",hat:"cap"}},t.Themes.Classic.categoryStyles={colour_category:{colour:"20"},list_category:{colour:"260"},logic_category:{colour:"210"},loop_category:{colour:"120"},math_category:{colour:"230"},procedure_category:{colour:"290"},text_category:{colour:"160"},variable_category:{colour:"330"},variable_dynamic_category:{colour:"310"}},t.Themes.Classic=new t.Theme("classic",t.Themes.Classic.defaultBlockStyles,t.Themes.Classic.categoryStyles),t.utils.IdGenerator={},t.utils.IdGenerator.nextId_=0,t.utils.IdGenerator.getNextUniqueId=function(){return"blockly-"+(t.utils.IdGenerator.nextId_++).toString(36)},t.utils.Metrics=function(){},t.utils.toolbox={},t.utils.toolbox.CATEGORY_TOOLBOX_KIND="categoryToolbox",t.utils.toolbox.FLYOUT_TOOLBOX_KIND="flyoutToolbox",t.utils.toolbox.Position={TOP:0,BOTTOM:1,LEFT:2,RIGHT:3},t.utils.toolbox.convertToolboxDefToJson=function(e){return e?((e instanceof Element||typeof e=="string")&&(e=t.utils.toolbox.parseToolboxTree(e),e=t.utils.toolbox.convertToToolboxJson_(e)),t.utils.toolbox.validateToolbox_(e),e):null},t.utils.toolbox.validateToolbox_=function(e){var i=e.kind;if(e=e.contents,i&&i!=t.utils.toolbox.FLYOUT_TOOLBOX_KIND&&i!=t.utils.toolbox.CATEGORY_TOOLBOX_KIND)throw Error("Invalid toolbox kind "+i+". Please supply either "+t.utils.toolbox.FLYOUT_TOOLBOX_KIND+" or "+t.utils.toolbox.CATEGORY_TOOLBOX_KIND);if(!e)throw Error("Toolbox must have a contents attribute.")},t.utils.toolbox.convertFlyoutDefToJsonArray=function(e){return e?e.contents?e.contents:Array.isArray(e)&&0<e.length&&!e[0].nodeType?e:t.utils.toolbox.xmlToJsonArray_(e):[]},t.utils.toolbox.hasCategories=function(e){if(!e)return!1;var i=e.kind;return i?i==t.utils.toolbox.CATEGORY_TOOLBOX_KIND:!!e.contents.filter(function(s){return s.kind.toUpperCase()=="CATEGORY"}).length},t.utils.toolbox.isCategoryCollapsible=function(e){return e&&e.contents?!!e.contents.filter(function(i){return i.kind.toUpperCase()=="CATEGORY"}).length:!1},t.utils.toolbox.convertToToolboxJson_=function(e){var i={contents:t.utils.toolbox.xmlToJsonArray_(e)};return e instanceof Node&&t.utils.toolbox.addAttributes_(e,i),i},t.utils.toolbox.xmlToJsonArray_=function(e){var i=[],s=e.childNodes;s||(s=e),e=0;for(var r;r=s[e];e++)if(r.tagName){var o={},h=r.tagName.toUpperCase();o.kind=h,h=="BLOCK"?o.blockxml=r:r.childNodes&&0<r.childNodes.length&&(o.contents=t.utils.toolbox.xmlToJsonArray_(r)),t.utils.toolbox.addAttributes_(r,o),i.push(o)}return i},t.utils.toolbox.addAttributes_=function(e,i){for(var s=0;s<e.attributes.length;s++){var r=e.attributes[s];-1<r.nodeName.indexOf("css-")?(i.cssconfig=i.cssconfig||{},i.cssconfig[r.nodeName.replace("css-","")]=r.value):i[r.nodeName]=r.value}},t.utils.toolbox.parseToolboxTree=function(e){if(e){if(typeof e!="string"&&(t.utils.userAgent.IE&&e.outerHTML?e=e.outerHTML:e instanceof Element||(e=null)),typeof e=="string"&&(e=t.Xml.textToDom(e),e.nodeName.toLowerCase()!="xml"))throw TypeError("Toolbox should be an <xml> document.")}else e=null;return e},t.Options=function(e){var i=!!e.readOnly;if(i)var s=null,r=!1,o=!1,h=!1,u=!1,p=!1,d=!1;else{s=t.utils.toolbox.convertToolboxDefToJson(e.toolbox),r=t.utils.toolbox.hasCategories(s),o=e.trashcan,o===void 0&&(o=r);var f=e.maxTrashcanContents;o?f===void 0&&(f=32):f=0,h=e.collapse,h===void 0&&(h=r),u=e.comments,u===void 0&&(u=r),p=e.disable,p===void 0&&(p=r),d=e.sounds,d===void 0&&(d=!0)}var g=!!e.rtl,_=e.horizontalLayout;_===void 0&&(_=!1);var v=e.toolboxPosition;v=v!=="end",v=_?v?t.utils.toolbox.Position.TOP:t.utils.toolbox.Position.BOTTOM:v==g?t.utils.toolbox.Position.RIGHT:t.utils.toolbox.Position.LEFT;var y=e.css;y===void 0&&(y=!0);var E="https://blockly-demo.appspot.com/static/media/";e.media?E=e.media:e.path&&(E=e.path+"media/");var m=e.oneBasedIndex===void 0?!0:!!e.oneBasedIndex,x=e.renderer||"geras",C=e.plugins||{};this.RTL=g,this.oneBasedIndex=m,this.collapse=h,this.comments=u,this.disable=p,this.readOnly=i,this.maxBlocks=e.maxBlocks||1/0,this.maxInstances=e.maxInstances,this.pathToMedia=E,this.hasCategories=r,this.moveOptions=t.Options.parseMoveOptions_(e,r),this.hasScrollbars=!!this.moveOptions.scrollbars,this.hasTrashcan=o,this.maxTrashcanContents=f,this.hasSounds=d,this.hasCss=y,this.horizontalLayout=_,this.languageTree=s,this.gridOptions=t.Options.parseGridOptions_(e),this.zoomOptions=t.Options.parseZoomOptions_(e),this.toolboxPosition=v,this.theme=t.Options.parseThemeOptions_(e),this.renderer=x,this.rendererOverrides=e.rendererOverrides,this.gridPattern=null,this.parentWorkspace=e.parentWorkspace,this.plugins=C},t.BlocklyOptions=function(){},t.Options.parseMoveOptions_=function(e,i){var s=e.move||{},r={};return s.scrollbars===void 0&&e.scrollbars===void 0?r.scrollbars=i:typeof s.scrollbars=="object"?(r.scrollbars={},r.scrollbars.horizontal=!!s.scrollbars.horizontal,r.scrollbars.vertical=!!s.scrollbars.vertical,r.scrollbars.horizontal&&r.scrollbars.vertical?r.scrollbars=!0:r.scrollbars.horizontal||r.scrollbars.vertical||(r.scrollbars=!1)):r.scrollbars=!!s.scrollbars||!!e.scrollbars,r.wheel=r.scrollbars&&s.wheel!==void 0?!!s.wheel:typeof r.scrollbars=="object",r.drag=r.scrollbars?s.drag===void 0?!0:!!s.drag:!1,r},t.Options.parseZoomOptions_=function(e){e=e.zoom||{};var i={};return i.controls=e.controls===void 0?!1:!!e.controls,i.wheel=e.wheel===void 0?!1:!!e.wheel,i.startScale=e.startScale===void 0?1:Number(e.startScale),i.maxScale=e.maxScale===void 0?3:Number(e.maxScale),i.minScale=e.minScale===void 0?.3:Number(e.minScale),i.scaleSpeed=e.scaleSpeed===void 0?1.2:Number(e.scaleSpeed),i.pinch=e.pinch===void 0?i.wheel||i.controls:!!e.pinch,i},t.Options.parseGridOptions_=function(e){e=e.grid||{};var i={};return i.spacing=Number(e.spacing)||0,i.colour=e.colour||"#888",i.length=e.length===void 0?1:Number(e.length),i.snap=0<i.spacing&&!!e.snap,i},t.Options.parseThemeOptions_=function(e){return e=e.theme||t.Themes.Classic,typeof e=="string"?t.registry.getObject(t.registry.Type.THEME,e):e instanceof t.Theme?e:t.Theme.defineTheme(e.name||"builtin"+t.utils.IdGenerator.getNextUniqueId(),e)},t.Options.parseToolboxTree=function(e){return t.utils.deprecation.warn("Blockly.Options.parseToolboxTree","September 2020","September 2021","Blockly.utils.toolbox.parseToolboxTree"),t.utils.toolbox.parseToolboxTree(e)},t.ScrollbarPair=function(e,i,s,r){this.workspace_=e,i=i===void 0?!0:i,s=s===void 0?!0:s;var o=i&&s;i&&(this.hScroll=new t.Scrollbar(e,!0,o,r)),s&&(this.vScroll=new t.Scrollbar(e,!1,o,r)),o&&(this.corner_=t.utils.dom.createSvgElement(t.utils.Svg.RECT,{height:t.Scrollbar.scrollbarThickness,width:t.Scrollbar.scrollbarThickness,class:"blocklyScrollbarBackground"},null),t.utils.dom.insertAfter(this.corner_,e.getBubbleCanvas())),this.oldHostMetrics_=null},t.ScrollbarPair.prototype.dispose=function(){t.utils.dom.removeNode(this.corner_),this.oldHostMetrics_=this.workspace_=this.corner_=null,this.hScroll&&(this.hScroll.dispose(),this.hScroll=null),this.vScroll&&(this.vScroll.dispose(),this.vScroll=null)},t.ScrollbarPair.prototype.resize=function(){var e=this.workspace_.getMetrics();if(e){var i=!1,s=!1;if(this.oldHostMetrics_&&this.oldHostMetrics_.viewWidth==e.viewWidth&&this.oldHostMetrics_.viewHeight==e.viewHeight&&this.oldHostMetrics_.absoluteTop==e.absoluteTop&&this.oldHostMetrics_.absoluteLeft==e.absoluteLeft?(this.oldHostMetrics_&&this.oldHostMetrics_.scrollWidth==e.scrollWidth&&this.oldHostMetrics_.viewLeft==e.viewLeft&&this.oldHostMetrics_.scrollLeft==e.scrollLeft||(i=!0),this.oldHostMetrics_&&this.oldHostMetrics_.scrollHeight==e.scrollHeight&&this.oldHostMetrics_.viewTop==e.viewTop&&this.oldHostMetrics_.scrollTop==e.scrollTop||(s=!0)):s=i=!0,i||s){try{t.Events.disable(),this.hScroll&&i&&this.hScroll.resize(e),this.vScroll&&s&&this.vScroll.resize(e)}finally{t.Events.enable()}this.workspace_.maybeFireViewportChangeEvent()}this.hScroll&&this.vScroll&&(this.oldHostMetrics_&&this.oldHostMetrics_.viewWidth==e.viewWidth&&this.oldHostMetrics_.absoluteLeft==e.absoluteLeft||this.corner_.setAttribute("x",this.vScroll.position.x),this.oldHostMetrics_&&this.oldHostMetrics_.viewHeight==e.viewHeight&&this.oldHostMetrics_.absoluteTop==e.absoluteTop||this.corner_.setAttribute("y",this.hScroll.position.y)),this.oldHostMetrics_=e}},t.ScrollbarPair.prototype.canScrollHorizontally=function(){return!!this.hScroll},t.ScrollbarPair.prototype.canScrollVertically=function(){return!!this.vScroll},t.ScrollbarPair.prototype.setOrigin=function(e,i){this.hScroll&&this.hScroll.setOrigin(e,i),this.vScroll&&this.vScroll.setOrigin(e,i)},t.ScrollbarPair.prototype.set=function(e,i,s){this.hScroll&&this.hScroll.set(e,!1),this.vScroll&&this.vScroll.set(i,!1),(s||s===void 0)&&(e={},this.hScroll&&(e.x=this.hScroll.getRatio_()),this.vScroll&&(e.y=this.vScroll.getRatio_()),this.workspace_.setMetrics(e))},t.ScrollbarPair.prototype.setX=function(e){this.hScroll&&this.hScroll.set(e,!0)},t.ScrollbarPair.prototype.setY=function(e){this.vScroll&&this.vScroll.set(e,!0)},t.ScrollbarPair.prototype.setContainerVisible=function(e){this.hScroll&&this.hScroll.setContainerVisible(e),this.vScroll&&this.vScroll.setContainerVisible(e)},t.ScrollbarPair.prototype.isVisible=function(){var e=!1;return this.hScroll&&(e=this.hScroll.isVisible()),this.vScroll&&(e=e||this.vScroll.isVisible()),e},t.ScrollbarPair.prototype.resizeContent=function(e){this.hScroll&&this.hScroll.resizeContentHorizontal(e),this.vScroll&&this.vScroll.resizeContentVertical(e)},t.ScrollbarPair.prototype.resizeView=function(e){this.hScroll&&this.hScroll.resizeViewHorizontal(e),this.vScroll&&this.vScroll.resizeViewVertical(e)},t.Scrollbar=function(e,i,s,r){this.workspace_=e,this.pair_=s||!1,this.horizontal_=i,this.ratio=this.oldHostMetrics_=null,this.createDom_(r),this.position=new t.utils.Coordinate(0,0),e=t.Scrollbar.scrollbarThickness,i?(this.svgBackground_.setAttribute("height",e),this.outerSvg_.setAttribute("height",e),this.svgHandle_.setAttribute("height",e-5),this.svgHandle_.setAttribute("y",2.5),this.lengthAttribute_="width",this.positionAttribute_="x"):(this.svgBackground_.setAttribute("width",e),this.outerSvg_.setAttribute("width",e),this.svgHandle_.setAttribute("width",e-5),this.svgHandle_.setAttribute("x",2.5),this.lengthAttribute_="height",this.positionAttribute_="y"),this.onMouseDownBarWrapper_=t.browserEvents.conditionalBind(this.svgBackground_,"mousedown",this,this.onMouseDownBar_),this.onMouseDownHandleWrapper_=t.browserEvents.conditionalBind(this.svgHandle_,"mousedown",this,this.onMouseDownHandle_)},t.Scrollbar.prototype.origin_=new t.utils.Coordinate(0,0),t.Scrollbar.prototype.startDragMouse_=0,t.Scrollbar.prototype.scrollbarLength_=0,t.Scrollbar.prototype.handleLength_=0,t.Scrollbar.prototype.handlePosition_=0,t.Scrollbar.prototype.isVisible_=!0,t.Scrollbar.prototype.containerVisible_=!0,t.Scrollbar.scrollbarThickness=15,t.Touch.TOUCH_ENABLED&&(t.Scrollbar.scrollbarThickness=25),t.Scrollbar.SCROLLBAR_MARGIN=.5,t.Scrollbar.metricsAreEquivalent_=function(e,i){return!!(e&&i&&e.viewWidth==i.viewWidth&&e.viewHeight==i.viewHeight&&e.viewLeft==i.viewLeft&&e.viewTop==i.viewTop&&e.absoluteTop==i.absoluteTop&&e.absoluteLeft==i.absoluteLeft&&e.scrollWidth==i.scrollWidth&&e.scrollHeight==i.scrollHeight&&e.scrollLeft==i.scrollLeft&&e.scrollTop==i.scrollTop)},t.Scrollbar.prototype.dispose=function(){this.cleanUp_(),t.browserEvents.unbind(this.onMouseDownBarWrapper_),this.onMouseDownBarWrapper_=null,t.browserEvents.unbind(this.onMouseDownHandleWrapper_),this.onMouseDownHandleWrapper_=null,t.utils.dom.removeNode(this.outerSvg_),this.svgBackground_=this.svgGroup_=this.outerSvg_=null,this.svgHandle_&&(this.workspace_.getThemeManager().unsubscribe(this.svgHandle_),this.svgHandle_=null),this.workspace_=null},t.Scrollbar.prototype.constrainHandleLength_=function(e){return e=0>=e||isNaN(e)?0:Math.min(e,this.scrollbarLength_)},t.Scrollbar.prototype.setHandleLength_=function(e){this.handleLength_=e,this.svgHandle_.setAttribute(this.lengthAttribute_,this.handleLength_)},t.Scrollbar.prototype.constrainHandlePosition_=function(e){return e=0>=e||isNaN(e)?0:Math.min(e,this.scrollbarLength_-this.handleLength_)},t.Scrollbar.prototype.setHandlePosition=function(e){this.handlePosition_=e,this.svgHandle_.setAttribute(this.positionAttribute_,this.handlePosition_)},t.Scrollbar.prototype.setScrollbarLength_=function(e){this.scrollbarLength_=e,this.outerSvg_.setAttribute(this.lengthAttribute_,this.scrollbarLength_),this.svgBackground_.setAttribute(this.lengthAttribute_,this.scrollbarLength_)},t.Scrollbar.prototype.setPosition=function(e,i){this.position.x=e,this.position.y=i,t.utils.dom.setCssTransform(this.outerSvg_,"translate("+(this.position.x+this.origin_.x)+"px,"+(this.position.y+this.origin_.y)+"px)")},t.Scrollbar.prototype.resize=function(e){!e&&(e=this.workspace_.getMetrics(),!e)||t.Scrollbar.metricsAreEquivalent_(e,this.oldHostMetrics_)||(this.horizontal_?this.resizeHorizontal_(e):this.resizeVertical_(e),this.oldHostMetrics_=e,this.updateMetrics_())},t.Scrollbar.prototype.requiresViewResize_=function(e){return this.oldHostMetrics_?this.oldHostMetrics_.viewWidth!==e.viewWidth||this.oldHostMetrics_.viewHeight!==e.viewHeight||this.oldHostMetrics_.absoluteLeft!==e.absoluteLeft||this.oldHostMetrics_.absoluteTop!==e.absoluteTop:!0},t.Scrollbar.prototype.resizeHorizontal_=function(e){this.requiresViewResize_(e)?this.resizeViewHorizontal(e):this.resizeContentHorizontal(e)},t.Scrollbar.prototype.resizeViewHorizontal=function(e){var i=e.viewWidth-2*t.Scrollbar.SCROLLBAR_MARGIN;this.pair_&&(i-=t.Scrollbar.scrollbarThickness),this.setScrollbarLength_(Math.max(0,i)),i=e.absoluteLeft+t.Scrollbar.SCROLLBAR_MARGIN,this.pair_&&this.workspace_.RTL&&(i+=t.Scrollbar.scrollbarThickness),this.setPosition(i,e.absoluteTop+e.viewHeight-t.Scrollbar.scrollbarThickness-t.Scrollbar.SCROLLBAR_MARGIN),this.resizeContentHorizontal(e)},t.Scrollbar.prototype.resizeContentHorizontal=function(e){if(e.viewWidth>=e.scrollWidth)this.setHandleLength_(this.scrollbarLength_),this.setHandlePosition(0),this.pair_||this.setVisible(!1);else{this.pair_||this.setVisible(!0);var i=this.scrollbarLength_*e.viewWidth/e.scrollWidth;i=this.constrainHandleLength_(i),this.setHandleLength_(i),i=e.scrollWidth-e.viewWidth;var s=this.scrollbarLength_-this.handleLength_;e=(e.viewLeft-e.scrollLeft)/i*s,e=this.constrainHandlePosition_(e),this.setHandlePosition(e),this.ratio=s/i}},t.Scrollbar.prototype.resizeVertical_=function(e){this.requiresViewResize_(e)?this.resizeViewVertical(e):this.resizeContentVertical(e)},t.Scrollbar.prototype.resizeViewVertical=function(e){var i=e.viewHeight-2*t.Scrollbar.SCROLLBAR_MARGIN;this.pair_&&(i-=t.Scrollbar.scrollbarThickness),this.setScrollbarLength_(Math.max(0,i)),this.setPosition(this.workspace_.RTL?e.absoluteLeft+t.Scrollbar.SCROLLBAR_MARGIN:e.absoluteLeft+e.viewWidth-t.Scrollbar.scrollbarThickness-t.Scrollbar.SCROLLBAR_MARGIN,e.absoluteTop+t.Scrollbar.SCROLLBAR_MARGIN),this.resizeContentVertical(e)},t.Scrollbar.prototype.resizeContentVertical=function(e){if(e.viewHeight>=e.scrollHeight)this.setHandleLength_(this.scrollbarLength_),this.setHandlePosition(0),this.pair_||this.setVisible(!1);else{this.pair_||this.setVisible(!0);var i=this.scrollbarLength_*e.viewHeight/e.scrollHeight;i=this.constrainHandleLength_(i),this.setHandleLength_(i),i=e.scrollHeight-e.viewHeight;var s=this.scrollbarLength_-this.handleLength_;e=(e.viewTop-e.scrollTop)/i*s,e=this.constrainHandlePosition_(e),this.setHandlePosition(e),this.ratio=s/i}},t.Scrollbar.prototype.createDom_=function(e){var i="blocklyScrollbar"+(this.horizontal_?"Horizontal":"Vertical");e&&(i+=" "+e),this.outerSvg_=t.utils.dom.createSvgElement(t.utils.Svg.SVG,{class:i},null),this.svgGroup_=t.utils.dom.createSvgElement(t.utils.Svg.G,{},this.outerSvg_),this.svgBackground_=t.utils.dom.createSvgElement(t.utils.Svg.RECT,{class:"blocklyScrollbarBackground"},this.svgGroup_),e=Math.floor((t.Scrollbar.scrollbarThickness-5)/2),this.svgHandle_=t.utils.dom.createSvgElement(t.utils.Svg.RECT,{class:"blocklyScrollbarHandle",rx:e,ry:e},this.svgGroup_),this.workspace_.getThemeManager().subscribe(this.svgHandle_,"scrollbarColour","fill"),this.workspace_.getThemeManager().subscribe(this.svgHandle_,"scrollbarOpacity","fill-opacity"),t.utils.dom.insertAfter(this.outerSvg_,this.workspace_.getParentSvg())},t.Scrollbar.prototype.isVisible=function(){return this.isVisible_},t.Scrollbar.prototype.setContainerVisible=function(e){var i=e!=this.containerVisible_;this.containerVisible_=e,i&&this.updateDisplay_()},t.Scrollbar.prototype.setVisible=function(e){var i=e!=this.isVisible();if(this.pair_)throw Error("Unable to toggle visibility of paired scrollbars.");this.isVisible_=e,i&&this.updateDisplay_()},t.Scrollbar.prototype.updateDisplay_=function(){this.containerVisible_&&this.isVisible()?this.outerSvg_.setAttribute("display","block"):this.outerSvg_.setAttribute("display","none")},t.Scrollbar.prototype.onMouseDownBar_=function(e){if(this.workspace_.markFocused(),t.Touch.clearTouchIdentifier(),this.cleanUp_(),t.utils.isRightButton(e))e.stopPropagation();else{var i=t.utils.mouseToSvg(e,this.workspace_.getParentSvg(),this.workspace_.getInverseScreenCTM());i=this.horizontal_?i.x:i.y;var s=t.utils.getInjectionDivXY_(this.svgHandle_);s=this.horizontal_?s.x:s.y;var r=this.handlePosition_,o=.95*this.handleLength_;i<=s?r-=o:i>=s+this.handleLength_&&(r+=o),this.setHandlePosition(this.constrainHandlePosition_(r)),this.updateMetrics_(),e.stopPropagation(),e.preventDefault()}},t.Scrollbar.prototype.onMouseDownHandle_=function(e){this.workspace_.markFocused(),this.cleanUp_(),t.utils.isRightButton(e)?e.stopPropagation():(this.startDragHandle=this.handlePosition_,this.workspace_.setupDragSurface(),this.startDragMouse_=this.horizontal_?e.clientX:e.clientY,t.Scrollbar.onMouseUpWrapper_=t.browserEvents.conditionalBind(document,"mouseup",this,this.onMouseUpHandle_),t.Scrollbar.onMouseMoveWrapper_=t.browserEvents.conditionalBind(document,"mousemove",this,this.onMouseMoveHandle_),e.stopPropagation(),e.preventDefault())},t.Scrollbar.prototype.onMouseMoveHandle_=function(e){this.setHandlePosition(this.constrainHandlePosition_(this.startDragHandle+((this.horizontal_?e.clientX:e.clientY)-this.startDragMouse_))),this.updateMetrics_()},t.Scrollbar.prototype.onMouseUpHandle_=function(){this.workspace_.resetDragSurface(),t.Touch.clearTouchIdentifier(),this.cleanUp_()},t.Scrollbar.prototype.cleanUp_=function(){t.hideChaff(!0),t.Scrollbar.onMouseUpWrapper_&&(t.browserEvents.unbind(t.Scrollbar.onMouseUpWrapper_),t.Scrollbar.onMouseUpWrapper_=null),t.Scrollbar.onMouseMoveWrapper_&&(t.browserEvents.unbind(t.Scrollbar.onMouseMoveWrapper_),t.Scrollbar.onMouseMoveWrapper_=null)},t.Scrollbar.prototype.getRatio_=function(){var e=this.handlePosition_/(this.scrollbarLength_-this.handleLength_);return isNaN(e)&&(e=0),e},t.Scrollbar.prototype.updateMetrics_=function(){var e=this.getRatio_(),i={};this.horizontal_?i.x=e:i.y=e,this.workspace_.setMetrics(i)},t.Scrollbar.prototype.set=function(e,i){this.setHandlePosition(this.constrainHandlePosition_(e*this.ratio)),(i||i===void 0)&&this.updateMetrics_()},t.Scrollbar.prototype.setOrigin=function(e,i){this.origin_=new t.utils.Coordinate(e,i)},t.Tooltip={},t.Tooltip.visible=!1,t.Tooltip.blocked_=!1,t.Tooltip.LIMIT=50,t.Tooltip.mouseOutPid_=0,t.Tooltip.showPid_=0,t.Tooltip.lastX_=0,t.Tooltip.lastY_=0,t.Tooltip.element_=null,t.Tooltip.poisonedElement_=null,t.Tooltip.OFFSET_X=0,t.Tooltip.OFFSET_Y=10,t.Tooltip.RADIUS_OK=10,t.Tooltip.HOVER_MS=750,t.Tooltip.MARGINS=5,t.Tooltip.DIV=null,t.Tooltip.getTooltipOfObject=function(e){if(e=t.Tooltip.getTargetObject_(e)){for(e=e.tooltip;typeof e=="function";)e=e();if(typeof e!="string")throw Error("Tooltip function must return a string.");return e}return""},t.Tooltip.getTargetObject_=function(e){for(;e&&e.tooltip;){if(typeof e.tooltip=="string"||typeof e.tooltip=="function")return e;e=e.tooltip}return null},t.Tooltip.createDom=function(){t.Tooltip.DIV||(t.Tooltip.DIV=document.createElement("div"),t.Tooltip.DIV.className="blocklyTooltipDiv",(t.parentContainer||document.body).appendChild(t.Tooltip.DIV))},t.Tooltip.bindMouseEvents=function(e){e.mouseOverWrapper_=t.browserEvents.bind(e,"mouseover",null,t.Tooltip.onMouseOver_),e.mouseOutWrapper_=t.browserEvents.bind(e,"mouseout",null,t.Tooltip.onMouseOut_),e.addEventListener("mousemove",t.Tooltip.onMouseMove_,!1)},t.Tooltip.unbindMouseEvents=function(e){e&&(t.browserEvents.unbind(e.mouseOverWrapper_),t.browserEvents.unbind(e.mouseOutWrapper_),e.removeEventListener("mousemove",t.Tooltip.onMouseMove_))},t.Tooltip.onMouseOver_=function(e){t.Tooltip.blocked_||(e=t.Tooltip.getTargetObject_(e.currentTarget),t.Tooltip.element_!=e&&(t.Tooltip.hide(),t.Tooltip.poisonedElement_=null,t.Tooltip.element_=e),clearTimeout(t.Tooltip.mouseOutPid_))},t.Tooltip.onMouseOut_=function(e){t.Tooltip.blocked_||(t.Tooltip.mouseOutPid_=setTimeout(function(){t.Tooltip.element_=null,t.Tooltip.poisonedElement_=null,t.Tooltip.hide()},1),clearTimeout(t.Tooltip.showPid_))},t.Tooltip.onMouseMove_=function(e){if(t.Tooltip.element_&&t.Tooltip.element_.tooltip&&!t.Tooltip.blocked_)if(t.Tooltip.visible){var i=t.Tooltip.lastX_-e.pageX;e=t.Tooltip.lastY_-e.pageY,Math.sqrt(i*i+e*e)>t.Tooltip.RADIUS_OK&&t.Tooltip.hide()}else t.Tooltip.poisonedElement_!=t.Tooltip.element_&&(clearTimeout(t.Tooltip.showPid_),t.Tooltip.lastX_=e.pageX,t.Tooltip.lastY_=e.pageY,t.Tooltip.showPid_=setTimeout(t.Tooltip.show_,t.Tooltip.HOVER_MS))},t.Tooltip.dispose=function(){t.Tooltip.element_=null,t.Tooltip.poisonedElement_=null,t.Tooltip.hide()},t.Tooltip.hide=function(){t.Tooltip.visible&&(t.Tooltip.visible=!1,t.Tooltip.DIV&&(t.Tooltip.DIV.style.display="none")),t.Tooltip.showPid_&&clearTimeout(t.Tooltip.showPid_)},t.Tooltip.block=function(){t.Tooltip.hide(),t.Tooltip.blocked_=!0},t.Tooltip.unblock=function(){t.Tooltip.blocked_=!1},t.Tooltip.show_=function(){if(!t.Tooltip.blocked_&&(t.Tooltip.poisonedElement_=t.Tooltip.element_,t.Tooltip.DIV)){t.Tooltip.DIV.textContent="";var e=t.Tooltip.getTooltipOfObject(t.Tooltip.element_);e=t.utils.string.wrap(e,t.Tooltip.LIMIT),e=e.split(`
`);for(var i=0;i<e.length;i++){var s=document.createElement("div");s.appendChild(document.createTextNode(e[i])),t.Tooltip.DIV.appendChild(s)}e=t.Tooltip.element_.RTL,i=document.documentElement.clientWidth,s=document.documentElement.clientHeight,t.Tooltip.DIV.style.direction=e?"rtl":"ltr",t.Tooltip.DIV.style.display="block",t.Tooltip.visible=!0;var r=t.Tooltip.lastX_;r=e?r-(t.Tooltip.OFFSET_X+t.Tooltip.DIV.offsetWidth):r+t.Tooltip.OFFSET_X;var o=t.Tooltip.lastY_+t.Tooltip.OFFSET_Y;o+t.Tooltip.DIV.offsetHeight>s+window.scrollY&&(o-=t.Tooltip.DIV.offsetHeight+2*t.Tooltip.OFFSET_Y),e?r=Math.max(t.Tooltip.MARGINS-window.scrollX,r):r+t.Tooltip.DIV.offsetWidth>i+window.scrollX-2*t.Tooltip.MARGINS&&(r=i-t.Tooltip.DIV.offsetWidth-2*t.Tooltip.MARGINS),t.Tooltip.DIV.style.top=o+"px",t.Tooltip.DIV.style.left=r+"px"}},t.utils.aria={},t.utils.aria.ARIA_PREFIX_="aria-",t.utils.aria.ROLE_ATTRIBUTE_="role",t.utils.aria.Role={GRID:"grid",GRIDCELL:"gridcell",GROUP:"group",LISTBOX:"listbox",MENU:"menu",MENUITEM:"menuitem",MENUITEMCHECKBOX:"menuitemcheckbox",OPTION:"option",PRESENTATION:"presentation",ROW:"row",TREE:"tree",TREEITEM:"treeitem"},t.utils.aria.State={ACTIVEDESCENDANT:"activedescendant",COLCOUNT:"colcount",DISABLED:"disabled",EXPANDED:"expanded",INVALID:"invalid",LABEL:"label",LABELLEDBY:"labelledby",LEVEL:"level",ORIENTATION:"orientation",POSINSET:"posinset",ROWCOUNT:"rowcount",SELECTED:"selected",SETSIZE:"setsize",VALUEMAX:"valuemax",VALUEMIN:"valuemin"},t.utils.aria.setRole=function(e,i){e.setAttribute(t.utils.aria.ROLE_ATTRIBUTE_,i)},t.utils.aria.setState=function(e,i,s){Array.isArray(s)&&(s=s.join(" ")),e.setAttribute(t.utils.aria.ARIA_PREFIX_+i,s)},t.WorkspaceDragSurfaceSvg=function(e){this.container_=e,this.createDom()},t.WorkspaceDragSurfaceSvg.prototype.SVG_=null,t.WorkspaceDragSurfaceSvg.prototype.container_=null,t.WorkspaceDragSurfaceSvg.prototype.createDom=function(){this.SVG_||(this.SVG_=t.utils.dom.createSvgElement(t.utils.Svg.SVG,{xmlns:t.utils.dom.SVG_NS,"xmlns:html":t.utils.dom.HTML_NS,"xmlns:xlink":t.utils.dom.XLINK_NS,version:"1.1",class:"blocklyWsDragSurface blocklyOverflowVisible"},null),this.container_.appendChild(this.SVG_))},t.WorkspaceDragSurfaceSvg.prototype.translateSurface=function(e,i){e=e.toFixed(0),i=i.toFixed(0),this.SVG_.style.display="block",t.utils.dom.setCssTransform(this.SVG_,"translate3d("+e+"px, "+i+"px, 0px)")},t.WorkspaceDragSurfaceSvg.prototype.getSurfaceTranslation=function(){return t.utils.getRelativeXY(this.SVG_)},t.WorkspaceDragSurfaceSvg.prototype.clearAndHide=function(e){if(!e)throw Error("Couldn't clear and hide the drag surface: missing new surface.");var i=this.SVG_.childNodes[0],s=this.SVG_.childNodes[1];if(!(i&&s&&t.utils.dom.hasClass(i,"blocklyBlockCanvas")&&t.utils.dom.hasClass(s,"blocklyBubbleCanvas")))throw Error("Couldn't clear and hide the drag surface. A node was missing.");if(this.previousSibling_!=null?t.utils.dom.insertAfter(i,this.previousSibling_):e.insertBefore(i,e.firstChild),t.utils.dom.insertAfter(s,i),this.SVG_.style.display="none",this.SVG_.childNodes.length)throw Error("Drag surface was not cleared.");t.utils.dom.setCssTransform(this.SVG_,""),this.previousSibling_=null},t.WorkspaceDragSurfaceSvg.prototype.setContentsAndShow=function(e,i,s,r,o,h){if(this.SVG_.childNodes.length)throw Error("Already dragging a block.");this.previousSibling_=s,e.setAttribute("transform","translate(0, 0) scale("+h+")"),i.setAttribute("transform","translate(0, 0) scale("+h+")"),this.SVG_.setAttribute("width",r),this.SVG_.setAttribute("height",o),this.SVG_.appendChild(e),this.SVG_.appendChild(i),this.SVG_.style.display="block"},t.blockRendering={},t.blockRendering.useDebugger=!1,t.blockRendering.register=function(e,i){t.registry.register(t.registry.Type.RENDERER,e,i)},t.blockRendering.unregister=function(e){t.registry.unregister(t.registry.Type.RENDERER,e)},t.blockRendering.startDebugger=function(){t.blockRendering.useDebugger=!0},t.blockRendering.stopDebugger=function(){t.blockRendering.useDebugger=!1},t.blockRendering.init=function(e,i,s){return e=new(t.registry.getClass(t.registry.Type.RENDERER,e))(e),e.init(i,s),e},t.ASTNode=function(e,i,s){if(!i)throw Error("Cannot create a node without a location.");this.type_=e,this.isConnection_=t.ASTNode.isConnectionType_(e),this.location_=i,this.wsCoordinate_=null,this.processParams_(s||null)},t.ASTNode.types={FIELD:"field",BLOCK:"block",INPUT:"input",OUTPUT:"output",NEXT:"next",PREVIOUS:"previous",STACK:"stack",WORKSPACE:"workspace"},t.ASTNode.NAVIGATE_ALL_FIELDS=!1,t.ASTNode.DEFAULT_OFFSET_Y=-20,t.ASTNode.isConnectionType_=function(e){switch(e){case t.ASTNode.types.PREVIOUS:case t.ASTNode.types.NEXT:case t.ASTNode.types.INPUT:case t.ASTNode.types.OUTPUT:return!0}return!1},t.ASTNode.createFieldNode=function(e){return e?new t.ASTNode(t.ASTNode.types.FIELD,e):null},t.ASTNode.createConnectionNode=function(e){if(!e)return null;var i=e.type;return i==t.connectionTypes.INPUT_VALUE||i==t.connectionTypes.NEXT_STATEMENT&&e.getParentInput()?t.ASTNode.createInputNode(e.getParentInput()):i==t.connectionTypes.NEXT_STATEMENT?new t.ASTNode(t.ASTNode.types.NEXT,e):i==t.connectionTypes.OUTPUT_VALUE?new t.ASTNode(t.ASTNode.types.OUTPUT,e):i==t.connectionTypes.PREVIOUS_STATEMENT?new t.ASTNode(t.ASTNode.types.PREVIOUS,e):null},t.ASTNode.createInputNode=function(e){return e&&e.connection?new t.ASTNode(t.ASTNode.types.INPUT,e.connection):null},t.ASTNode.createBlockNode=function(e){return e?new t.ASTNode(t.ASTNode.types.BLOCK,e):null},t.ASTNode.createStackNode=function(e){return e?new t.ASTNode(t.ASTNode.types.STACK,e):null},t.ASTNode.createWorkspaceNode=function(e,i){return i&&e?new t.ASTNode(t.ASTNode.types.WORKSPACE,e,{wsCoordinate:i}):null},t.ASTNode.createTopNode=function(e){var i=e.previousConnection||e.outputConnection;return i?t.ASTNode.createConnectionNode(i):t.ASTNode.createBlockNode(e)},t.ASTNode.prototype.processParams_=function(e){e&&e.wsCoordinate&&(this.wsCoordinate_=e.wsCoordinate)},t.ASTNode.prototype.getLocation=function(){return this.location_},t.ASTNode.prototype.getType=function(){return this.type_},t.ASTNode.prototype.getWsCoordinate=function(){return this.wsCoordinate_},t.ASTNode.prototype.isConnection=function(){return this.isConnection_},t.ASTNode.prototype.findNextForInput_=function(){var e=this.location_.getParentInput(),i=e.getSourceBlock();e=i.inputList.indexOf(e)+1;for(var s;s=i.inputList[e];e++){for(var r=s.fieldRow,o=0,h;h=r[o];o++)if(h.isClickable()||t.ASTNode.NAVIGATE_ALL_FIELDS)return t.ASTNode.createFieldNode(h);if(s.connection)return t.ASTNode.createInputNode(s)}return null},t.ASTNode.prototype.findNextForField_=function(){var e=this.location_,i=e.getParentInput(),s=e.getSourceBlock(),r=s.inputList.indexOf(i);for(e=i.fieldRow.indexOf(e)+1;i=s.inputList[r];r++){for(var o=i.fieldRow;e<o.length;){if(o[e].isClickable()||t.ASTNode.NAVIGATE_ALL_FIELDS)return t.ASTNode.createFieldNode(o[e]);e++}if(e=0,i.connection)return t.ASTNode.createInputNode(i)}return null},t.ASTNode.prototype.findPrevForInput_=function(){for(var e=this.location_.getParentInput(),i=e.getSourceBlock(),s=i.inputList.indexOf(e),r;r=i.inputList[s];s--){if(r.connection&&r!==e)return t.ASTNode.createInputNode(r);r=r.fieldRow;for(var o=r.length-1,h;h=r[o];o--)if(h.isClickable()||t.ASTNode.NAVIGATE_ALL_FIELDS)return t.ASTNode.createFieldNode(h)}return null},t.ASTNode.prototype.findPrevForField_=function(){var e=this.location_,i=e.getParentInput(),s=e.getSourceBlock(),r=s.inputList.indexOf(i);e=i.fieldRow.indexOf(e)-1;for(var o;o=s.inputList[r];r--){if(o.connection&&o!==i)return t.ASTNode.createInputNode(o);for(o=o.fieldRow;-1<e;){if(o[e].isClickable()||t.ASTNode.NAVIGATE_ALL_FIELDS)return t.ASTNode.createFieldNode(o[e]);e--}0<=r-1&&(e=s.inputList[r-1].fieldRow.length-1)}return null},t.ASTNode.prototype.navigateBetweenStacks_=function(e){var i=this.getLocation();if(i instanceof t.Block||(i=i.getSourceBlock()),!i||!i.workspace)return null;var s=i.getRootBlock();i=s.workspace.getTopBlocks(!0);for(var r=0,o;o=i[r];r++)if(s.id==o.id)return e=r+(e?1:-1),e==-1||e==i.length?null:t.ASTNode.createStackNode(i[e]);throw Error("Couldn't find "+(e?"next":"previous")+" stack?!")},t.ASTNode.prototype.findTopASTNodeForBlock_=function(e){var i=e.previousConnection||e.outputConnection;return i?t.ASTNode.createConnectionNode(i):t.ASTNode.createBlockNode(e)},t.ASTNode.prototype.getOutAstNodeForBlock_=function(e){if(!e)return null;e=e.getTopStackBlock();var i=e.previousConnection||e.outputConnection;return i&&i.targetConnection&&i.targetConnection.getParentInput()?t.ASTNode.createInputNode(i.targetConnection.getParentInput()):t.ASTNode.createStackNode(e)},t.ASTNode.prototype.findFirstFieldOrInput_=function(e){e=e.inputList;for(var i=0,s;s=e[i];i++){for(var r=s.fieldRow,o=0,h;h=r[o];o++)if(h.isClickable()||t.ASTNode.NAVIGATE_ALL_FIELDS)return t.ASTNode.createFieldNode(h);if(s.connection)return t.ASTNode.createInputNode(s)}return null},t.ASTNode.prototype.getSourceBlock=function(){return this.getType()===t.ASTNode.types.BLOCK?this.getLocation():this.getType()===t.ASTNode.types.STACK?this.getLocation():this.getType()===t.ASTNode.types.WORKSPACE?null:this.getLocation().getSourceBlock()},t.ASTNode.prototype.next=function(){switch(this.type_){case t.ASTNode.types.STACK:return this.navigateBetweenStacks_(!0);case t.ASTNode.types.OUTPUT:var e=this.location_;return t.ASTNode.createBlockNode(e.getSourceBlock());case t.ASTNode.types.FIELD:return this.findNextForField_();case t.ASTNode.types.INPUT:return this.findNextForInput_();case t.ASTNode.types.BLOCK:return t.ASTNode.createConnectionNode(this.location_.nextConnection);case t.ASTNode.types.PREVIOUS:return e=this.location_,t.ASTNode.createBlockNode(e.getSourceBlock());case t.ASTNode.types.NEXT:return e=this.location_,t.ASTNode.createConnectionNode(e.targetConnection)}return null},t.ASTNode.prototype.in=function(){switch(this.type_){case t.ASTNode.types.WORKSPACE:var e=this.location_.getTopBlocks(!0);if(0<e.length)return t.ASTNode.createStackNode(e[0]);break;case t.ASTNode.types.STACK:return e=this.location_,this.findTopASTNodeForBlock_(e);case t.ASTNode.types.BLOCK:return e=this.location_,this.findFirstFieldOrInput_(e);case t.ASTNode.types.INPUT:return t.ASTNode.createConnectionNode(this.location_.targetConnection)}return null},t.ASTNode.prototype.prev=function(){switch(this.type_){case t.ASTNode.types.STACK:return this.navigateBetweenStacks_(!1);case t.ASTNode.types.FIELD:return this.findPrevForField_();case t.ASTNode.types.INPUT:return this.findPrevForInput_();case t.ASTNode.types.BLOCK:var e=this.location_;return t.ASTNode.createConnectionNode(e.previousConnection||e.outputConnection);case t.ASTNode.types.PREVIOUS:if(e=this.location_,(e=e.targetConnection)&&!e.getParentInput())return t.ASTNode.createConnectionNode(e);break;case t.ASTNode.types.NEXT:return e=this.location_,t.ASTNode.createBlockNode(e.getSourceBlock())}return null},t.ASTNode.prototype.out=function(){switch(this.type_){case t.ASTNode.types.STACK:var e=this.location_,i=e.getRelativeToSurfaceXY();return i=new t.utils.Coordinate(i.x,i.y+t.ASTNode.DEFAULT_OFFSET_Y),t.ASTNode.createWorkspaceNode(e.workspace,i);case t.ASTNode.types.OUTPUT:return e=this.location_,(i=e.targetConnection)?t.ASTNode.createConnectionNode(i):t.ASTNode.createStackNode(e.getSourceBlock());case t.ASTNode.types.FIELD:return t.ASTNode.createBlockNode(this.location_.getSourceBlock());case t.ASTNode.types.INPUT:return e=this.location_,t.ASTNode.createBlockNode(e.getSourceBlock());case t.ASTNode.types.BLOCK:return e=this.location_,this.getOutAstNodeForBlock_(e);case t.ASTNode.types.PREVIOUS:return e=this.location_,this.getOutAstNodeForBlock_(e.getSourceBlock());case t.ASTNode.types.NEXT:return e=this.location_,this.getOutAstNodeForBlock_(e.getSourceBlock())}return null},t.Blocks=Object.create(null),t.utils.deprecation={},t.utils.deprecation.warn=function(e,i,s,r){e=e+" was deprecated on "+i+" and will be deleted on "+s+".",r&&(e+=`
Use `+r+" instead."),console.warn(e)},t.Connection=function(e,i){this.sourceBlock_=e,this.type=i},t.Connection.CAN_CONNECT=0,t.Connection.REASON_SELF_CONNECTION=1,t.Connection.REASON_WRONG_TYPE=2,t.Connection.REASON_TARGET_NULL=3,t.Connection.REASON_CHECKS_FAILED=4,t.Connection.REASON_DIFFERENT_WORKSPACES=5,t.Connection.REASON_SHADOW_PARENT=6,t.Connection.REASON_DRAG_CHECKS_FAILED=7,t.Connection.prototype.targetConnection=null,t.Connection.prototype.disposed=!1,t.Connection.prototype.check_=null,t.Connection.prototype.shadowDom_=null,t.Connection.prototype.x=0,t.Connection.prototype.y=0,t.Connection.prototype.connect_=function(e){var i=this,s=i.getSourceBlock(),r=e.getSourceBlock();if(e.isConnected()&&e.disconnect(),i.isConnected()){var o=i.targetBlock(),h=i.getShadowDom();if(i.shadowDom_=null,o.isShadow())h=t.Xml.blockToDom(o),o.dispose(!1),o=null;else if(i.type==t.connectionTypes.INPUT_VALUE){if(!o.outputConnection)throw Error("Orphan block does not have an output connection.");var u=t.Connection.lastConnectionInRow(r,o);u&&(o.outputConnection.connect(u),o=null)}else if(i.type==t.connectionTypes.NEXT_STATEMENT){if(!o.previousConnection)throw Error("Orphan block does not have a previous connection.");for(u=r;u.nextConnection;){var p=u.getNextBlock();if(p&&!p.isShadow())u=p;else{o.workspace.connectionChecker.canConnect(o.previousConnection,u.nextConnection,!1)&&(u.nextConnection.connect(o.previousConnection),o=null);break}}}if(o&&(i.disconnect(),t.Events.recordUndo)){var d=t.Events.getGroup();setTimeout(function(){o.workspace&&!o.getParent()&&(t.Events.setGroup(d),o.outputConnection?o.outputConnection.onFailedConnect(i):o.previousConnection&&o.previousConnection.onFailedConnect(i),t.Events.setGroup(!1))},t.BUMP_DELAY)}i.shadowDom_=h}var f;t.Events.isEnabled()&&(f=new(t.Events.get(t.Events.BLOCK_MOVE))(r)),t.Connection.connectReciprocally_(i,e),r.setParent(s),f&&(f.recordNew(),t.Events.fire(f))},t.Connection.prototype.dispose=function(){if(this.isConnected()){this.setShadowDom(null);var e=this.targetBlock();e&&e.unplug()}this.disposed=!0},t.Connection.prototype.getSourceBlock=function(){return this.sourceBlock_},t.Connection.prototype.isSuperior=function(){return this.type==t.connectionTypes.INPUT_VALUE||this.type==t.connectionTypes.NEXT_STATEMENT},t.Connection.prototype.isConnected=function(){return!!this.targetConnection},t.Connection.prototype.canConnectWithReason=function(e){return t.utils.deprecation.warn("Connection.prototype.canConnectWithReason","July 2020","July 2021","the workspace's connection checker"),this.getConnectionChecker().canConnectWithReason(this,e,!1)},t.Connection.prototype.checkConnection=function(e){t.utils.deprecation.warn("Connection.prototype.checkConnection","July 2020","July 2021","the workspace's connection checker");var i=this.getConnectionChecker(),s=i.canConnectWithReason(this,e,!1);if(s!=t.Connection.CAN_CONNECT)throw Error(i.getErrorMessage(s,this,e))},t.Connection.prototype.getConnectionChecker=function(){return this.sourceBlock_.workspace.connectionChecker},t.Connection.prototype.isConnectionAllowed=function(e){return t.utils.deprecation.warn("Connection.prototype.isConnectionAllowed","July 2020","July 2021","the workspace's connection checker"),this.getConnectionChecker().canConnect(this,e,!0)},t.Connection.prototype.onFailedConnect=function(e){},t.Connection.prototype.connect=function(e){if(this.targetConnection!=e&&this.getConnectionChecker().canConnect(this,e,!1)){var i=t.Events.getGroup();i||t.Events.setGroup(!0),this.isSuperior()?this.connect_(e):e.connect_(this),i||t.Events.setGroup(!1)}},t.Connection.connectReciprocally_=function(e,i){if(!e||!i)throw Error("Cannot connect null connections.");e.targetConnection=i,i.targetConnection=e},t.Connection.singleConnection_=function(e,i){var s=null;i=i.outputConnection;for(var r=0;r<e.inputList.length;r++){var o=e.inputList[r].connection,h=i.getConnectionChecker();if(o&&o.type==t.connectionTypes.INPUT_VALUE&&h.canConnect(i,o,!1)){if(s)return null;s=o}}return s},t.Connection.lastConnectionInRow=function(e,i){for(var s;s=t.Connection.singleConnection_(e,i);)if(e=s.targetBlock(),!e||e.isShadow())return s;return null},t.Connection.prototype.disconnect=function(){var e=this.targetConnection;if(!e)throw Error("Source connection not connected.");if(e.targetConnection!=this)throw Error("Target connection not connected to source connection.");if(this.isSuperior()){var i=this.sourceBlock_,s=e.getSourceBlock();e=this}else i=e.getSourceBlock(),s=this.sourceBlock_;var r=t.Events.getGroup();r||t.Events.setGroup(!0),this.disconnectInternal_(i,s),s.isShadow()||e.respawnShadow_(),r||t.Events.setGroup(!1)},t.Connection.prototype.disconnectInternal_=function(e,i){var s;t.Events.isEnabled()&&(s=new(t.Events.get(t.Events.BLOCK_MOVE))(i)),this.targetConnection=this.targetConnection.targetConnection=null,i.setParent(null),s&&(s.recordNew(),t.Events.fire(s))},t.Connection.prototype.respawnShadow_=function(){var e=this.getSourceBlock(),i=this.getShadowDom();if(e.workspace&&i)if(e=t.Xml.domToBlock(i,e.workspace),e.outputConnection)this.connect(e.outputConnection);else if(e.previousConnection)this.connect(e.previousConnection);else throw Error("Child block does not have output or previous statement.")},t.Connection.prototype.targetBlock=function(){return this.isConnected()?this.targetConnection.getSourceBlock():null},t.Connection.prototype.checkType=function(e){return t.utils.deprecation.warn("Connection.prototype.checkType","October 2019","January 2021","the workspace's connection checker"),this.getConnectionChecker().canConnect(this,e,!1)},t.Connection.prototype.checkType_=function(e){return t.utils.deprecation.warn("Connection.prototype.checkType_","October 2019","January 2021","the workspace's connection checker"),this.checkType(e)},t.Connection.prototype.onCheckChanged_=function(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||(this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug()},t.Connection.prototype.setCheck=function(e){return e?(Array.isArray(e)||(e=[e]),this.check_=e,this.onCheckChanged_()):this.check_=null,this},t.Connection.prototype.getCheck=function(){return this.check_},t.Connection.prototype.setShadowDom=function(e){this.shadowDom_=e,e=this.targetBlock(),e?e.isShadow()&&(e.dispose(!1),this.respawnShadow_()):this.respawnShadow_()},t.Connection.prototype.getShadowDom=function(){return this.shadowDom_},t.Connection.prototype.neighbours=function(e){return[]},t.Connection.prototype.getParentInput=function(){for(var e=null,i=this.sourceBlock_,s=i.inputList,r=0;r<i.inputList.length;r++)if(s[r].connection===this){e=s[r];break}return e},t.Connection.prototype.toString=function(){var e=this.sourceBlock_;if(e)if(e.outputConnection==this)var i="Output Connection of ";else if(e.previousConnection==this)i="Previous Connection of ";else if(e.nextConnection==this)i="Next Connection of ";else{i=null;for(var s=0,r;r=e.inputList[s];s++)if(r.connection==this){i=r;break}if(i)i='Input "'+i.name+'" connection on ';else return console.warn("Connection not actually connected to sourceBlock_"),"Orphan Connection"}else return"Orphan Connection";return i+e.toDevString()},t.Extensions={},t.Extensions.ALL_={},t.Extensions.register=function(e,i){if(typeof e!="string"||e.trim()=="")throw Error('Error: Invalid extension name "'+e+'"');if(t.Extensions.ALL_[e])throw Error('Error: Extension "'+e+'" is already registered.');if(typeof i!="function")throw Error('Error: Extension "'+e+'" must be a function');t.Extensions.ALL_[e]=i},t.Extensions.registerMixin=function(e,i){if(!i||typeof i!="object")throw Error('Error: Mixin "'+e+'" must be a object');t.Extensions.register(e,function(){this.mixin(i)})},t.Extensions.registerMutator=function(e,i,s,r){var o='Error when registering mutator "'+e+'": ';t.Extensions.checkHasFunction_(o,i.domToMutation,"domToMutation"),t.Extensions.checkHasFunction_(o,i.mutationToDom,"mutationToDom");var h=t.Extensions.checkMutatorDialog_(i,o);if(s&&typeof s!="function")throw Error('Extension "'+e+'" is not a function');t.Extensions.register(e,function(){if(h){if(!t.Mutator)throw Error(o+"Missing require for Blockly.Mutator");this.setMutator(new t.Mutator(r||[]))}this.mixin(i),s&&s.apply(this)})},t.Extensions.unregister=function(e){t.Extensions.ALL_[e]?delete t.Extensions.ALL_[e]:console.warn('No extension mapping for name "'+e+'" found to unregister')},t.Extensions.apply=function(e,i,s){var r=t.Extensions.ALL_[e];if(typeof r!="function")throw Error('Error: Extension "'+e+'" not found.');if(s)t.Extensions.checkNoMutatorProperties_(e,i);else var o=t.Extensions.getMutatorProperties_(i);if(r.apply(i),s)t.Extensions.checkBlockHasMutatorProperties_('Error after applying mutator "'+e+'": ',i);else if(!t.Extensions.mutatorPropertiesMatch_(o,i))throw Error('Error when applying extension "'+e+'": mutation properties changed when applying a non-mutator extension.')},t.Extensions.checkHasFunction_=function(e,i,s){if(!i)throw Error(e+'missing required property "'+s+'"');if(typeof i!="function")throw Error(e+'" required property "'+s+'" must be a function')},t.Extensions.checkNoMutatorProperties_=function(e,i){if(t.Extensions.getMutatorProperties_(i).length)throw Error('Error: tried to apply mutation "'+e+'" to a block that already has mutator functions.  Block id: '+i.id)},t.Extensions.checkMutatorDialog_=function(e,i){var s=e.compose!==void 0,r=e.decompose!==void 0;if(s&&r){if(typeof e.compose!="function")throw Error(i+"compose must be a function.");if(typeof e.decompose!="function")throw Error(i+"decompose must be a function.");return!0}if(s||r)throw Error(i+'Must have both or neither of "compose" and "decompose"');return!1},t.Extensions.checkBlockHasMutatorProperties_=function(e,i){if(typeof i.domToMutation!="function")throw Error(e+`Applying a mutator didn't add "domToMutation"`);if(typeof i.mutationToDom!="function")throw Error(e+`Applying a mutator didn't add "mutationToDom"`);t.Extensions.checkMutatorDialog_(i,e)},t.Extensions.getMutatorProperties_=function(e){var i=[];return e.domToMutation!==void 0&&i.push(e.domToMutation),e.mutationToDom!==void 0&&i.push(e.mutationToDom),e.compose!==void 0&&i.push(e.compose),e.decompose!==void 0&&i.push(e.decompose),i},t.Extensions.mutatorPropertiesMatch_=function(e,i){if(i=t.Extensions.getMutatorProperties_(i),i.length!=e.length)return!1;for(var s=0;s<i.length;s++)if(e[s]!=i[s])return!1;return!0},t.Extensions.buildTooltipForDropdown=function(e,i){var s=[];return typeof document=="object"&&t.utils.runAfterPageLoad(function(){for(var r in i)t.utils.checkMessageReferences(i[r])}),function(){this.type&&s.indexOf(this.type)==-1&&(t.Extensions.checkDropdownOptionsInTable_(this,e,i),s.push(this.type)),this.setTooltip((function(){var r=String(this.getFieldValue(e)),o=i[r];return o==null?s.indexOf(this.type)==-1&&(r="No tooltip mapping for value "+r+" of field "+e,this.type!=null&&(r+=" of block type "+this.type),console.warn(r+".")):o=t.utils.replaceMessageReferences(o),o}).bind(this))}},t.Extensions.checkDropdownOptionsInTable_=function(e,i,s){var r=e.getField(i);if(!r.isOptionListDynamic()){r=r.getOptions();for(var o=0;o<r.length;++o){var h=r[o][1];s[h]==null&&console.warn("No tooltip mapping for value "+h+" of field "+i+" of block type "+e.type)}}},t.Extensions.buildTooltipWithFieldText=function(e,i){return typeof document=="object"&&t.utils.runAfterPageLoad(function(){t.utils.checkMessageReferences(e)}),function(){this.setTooltip((function(){var s=this.getField(i);return t.utils.replaceMessageReferences(e).replace("%1",s?s.getText():"")}).bind(this))}},t.Extensions.extensionParentTooltip_=function(){this.tooltipWhenNotConnected_=this.tooltip,this.setTooltip((function(){var e=this.getParent();return e&&e.getInputsInline()&&e.tooltip||this.tooltipWhenNotConnected_}).bind(this))},t.Extensions.register("parent_tooltip_when_inline",t.Extensions.extensionParentTooltip_),t.fieldRegistry={},t.fieldRegistry.register=function(e,i){t.registry.register(t.registry.Type.FIELD,e,i)},t.fieldRegistry.unregister=function(e){t.registry.unregister(t.registry.Type.FIELD,e)},t.fieldRegistry.fromJson=function(e){var i=t.registry.getObject(t.registry.Type.FIELD,e.type);return i?i.fromJson(e):(console.warn("Blockly could not create a field of type "+e.type+". The field is probably not being registered. This could be because the file is not loaded, the field does not register itself (Issue #1584), or the registration is not being reached."),null)},t.blockAnimations={},t.blockAnimations.disconnectPid_=0,t.blockAnimations.disconnectGroup_=null,t.blockAnimations.disposeUiEffect=function(e){var i=e.workspace,s=e.getSvgRoot();i.getAudioManager().play("delete"),e=i.getSvgXY(s),s=s.cloneNode(!0),s.translateX_=e.x,s.translateY_=e.y,s.setAttribute("transform","translate("+e.x+","+e.y+")"),i.getParentSvg().appendChild(s),s.bBox_=s.getBBox(),t.blockAnimations.disposeUiStep_(s,i.RTL,new Date,i.scale)},t.blockAnimations.disposeUiStep_=function(e,i,s,r){var o=(new Date-s)/150;1<o?t.utils.dom.removeNode(e):(e.setAttribute("transform","translate("+(e.translateX_+(i?-1:1)*e.bBox_.width*r/2*o)+","+(e.translateY_+e.bBox_.height*r*o)+") scale("+(1-o)*r+")"),setTimeout(t.blockAnimations.disposeUiStep_,10,e,i,s,r))},t.blockAnimations.connectionUiEffect=function(e){var i=e.workspace,s=i.scale;if(i.getAudioManager().play("click"),!(1>s)){var r=i.getSvgXY(e.getSvgRoot());e.outputConnection?(r.x+=(e.RTL?3:-3)*s,r.y+=13*s):e.previousConnection&&(r.x+=(e.RTL?-23:23)*s,r.y+=3*s),e=t.utils.dom.createSvgElement(t.utils.Svg.CIRCLE,{cx:r.x,cy:r.y,r:0,fill:"none",stroke:"#888","stroke-width":10},i.getParentSvg()),t.blockAnimations.connectionUiStep_(e,new Date,s)}},t.blockAnimations.connectionUiStep_=function(e,i,s){var r=(new Date-i)/150;1<r?t.utils.dom.removeNode(e):(e.setAttribute("r",25*r*s),e.style.opacity=1-r,t.blockAnimations.disconnectPid_=setTimeout(t.blockAnimations.connectionUiStep_,10,e,i,s))},t.blockAnimations.disconnectUiEffect=function(e){if(e.workspace.getAudioManager().play("disconnect"),!(1>e.workspace.scale)){var i=e.getHeightWidth().height;i=Math.atan(10/i)/Math.PI*180,e.RTL||(i*=-1),t.blockAnimations.disconnectUiStep_(e.getSvgRoot(),i,new Date)}},t.blockAnimations.disconnectUiStep_=function(e,i,s){var r=(new Date-s)/200;1<r?e.skew_="":(e.skew_="skewX("+Math.round(Math.sin(r*Math.PI*3)*(1-r)*i)+")",t.blockAnimations.disconnectGroup_=e,t.blockAnimations.disconnectPid_=setTimeout(t.blockAnimations.disconnectUiStep_,10,e,i,s)),e.setAttribute("transform",e.translate_+e.skew_)},t.blockAnimations.disconnectUiStop=function(){if(t.blockAnimations.disconnectGroup_){clearTimeout(t.blockAnimations.disconnectPid_);var e=t.blockAnimations.disconnectGroup_;e.skew_="",e.setAttribute("transform",e.translate_),t.blockAnimations.disconnectGroup_=null}},t.Events.BlockDrag=function(e,i,s){t.Events.BlockDrag.superClass_.constructor.call(this,e?e.workspace.id:void 0),this.blockId=e?e.id:null,this.isStart=i,this.blocks=s},t.utils.object.inherits(t.Events.BlockDrag,t.Events.UiBase),t.Events.BlockDrag.prototype.type=t.Events.BLOCK_DRAG,t.Events.BlockDrag.prototype.toJson=function(){var e=t.Events.BlockDrag.superClass_.toJson.call(this);return e.isStart=this.isStart,e.blockId=this.blockId,e.blocks=this.blocks,e},t.Events.BlockDrag.prototype.fromJson=function(e){t.Events.BlockDrag.superClass_.fromJson.call(this,e),this.isStart=e.isStart,this.blockId=e.blockId,this.blocks=e.blocks},t.registry.register(t.registry.Type.EVENT,t.Events.BLOCK_DRAG,t.Events.BlockDrag),t.InsertionMarkerManager=function(e){this.topBlock_=t.selected=e,this.workspace_=e.workspace,this.lastMarker_=this.lastOnStack_=null,this.firstMarker_=this.createMarkerBlock_(this.topBlock_),this.localConnection_=this.closestConnection_=null,this.wouldDeleteBlock_=!1,this.fadedBlock_=this.highlightedBlock_=this.markerConnection_=null,this.availableConnections_=this.initAvailableConnections_()},t.InsertionMarkerManager.PREVIEW_TYPE={INSERTION_MARKER:0,INPUT_OUTLINE:1,REPLACEMENT_FADE:2},t.InsertionMarkerManager.prototype.dispose=function(){this.availableConnections_.length=0,t.Events.disable();try{this.firstMarker_&&this.firstMarker_.dispose(),this.lastMarker_&&this.lastMarker_.dispose()}finally{t.Events.enable()}},t.InsertionMarkerManager.prototype.updateAvailableConnections=function(){this.availableConnections_=this.initAvailableConnections_()},t.InsertionMarkerManager.prototype.wouldDeleteBlock=function(){return this.wouldDeleteBlock_},t.InsertionMarkerManager.prototype.wouldConnectBlock=function(){return!!this.closestConnection_},t.InsertionMarkerManager.prototype.applyConnections=function(){if(this.closestConnection_&&(t.Events.disable(),this.hidePreview_(),t.Events.enable(),this.localConnection_.connect(this.closestConnection_),this.topBlock_.rendered)){var e=this.localConnection_.isSuperior()?this.closestConnection_:this.localConnection_;t.blockAnimations.connectionUiEffect(e.getSourceBlock()),this.topBlock_.getRootBlock().bringToFront()}},t.InsertionMarkerManager.prototype.update=function(e,i){var s=this.getCandidate_(e);((this.wouldDeleteBlock_=this.shouldDelete_(s,i))||this.shouldUpdatePreviews_(s,e))&&(t.Events.disable(),this.maybeHidePreview_(s),this.maybeShowPreview_(s),t.Events.enable())},t.InsertionMarkerManager.prototype.createMarkerBlock_=function(e){var i=e.type;t.Events.disable();try{var s=this.workspace_.newBlock(i);if(s.setInsertionMarker(!0),e.mutationToDom){var r=e.mutationToDom();r&&s.domToMutation(r)}for(i=0;i<e.inputList.length;i++){var o=e.inputList[i];if(o.name!=t.constants.COLLAPSED_INPUT_NAME){var h=s.inputList[i];for(r=0;r<o.fieldRow.length;r++)h.fieldRow[r].setValue(o.fieldRow[r].getValue())}}s.setCollapsed(e.isCollapsed()),s.setInputsInline(e.getInputsInline()),s.initSvg(),s.getSvgRoot().setAttribute("visibility","hidden")}finally{t.Events.enable()}return s},t.InsertionMarkerManager.prototype.initAvailableConnections_=function(){var e=this.topBlock_.getConnections_(!1),i=this.topBlock_.lastConnectionInStack();if(i&&i!=this.topBlock_.nextConnection){if(e.push(i),this.lastOnStack_=i,this.lastMarker_){t.Events.disable();try{this.lastMarker_.dispose()}finally{t.Events.enable()}}this.lastMarker_=this.createMarkerBlock_(i.getSourceBlock())}return e},t.InsertionMarkerManager.prototype.shouldUpdatePreviews_=function(e,i){var s=e.local,r=e.closest;if(e=e.radius,s&&r){if(this.localConnection_&&this.closestConnection_)return this.closestConnection_==r&&this.localConnection_==s?!1:(s=this.localConnection_.x+i.x-this.closestConnection_.x,i=this.localConnection_.y+i.y-this.closestConnection_.y,i=Math.sqrt(s*s+i*i),!(r&&e>i-t.CURRENT_CONNECTION_PREFERENCE));if(this.localConnection_||this.closestConnection_)console.error("Only one of localConnection_ and closestConnection_ was set.");else return!0}else return!(!this.localConnection_||!this.closestConnection_);return console.error("Returning true from shouldUpdatePreviews, but it's not clear why."),!0},t.InsertionMarkerManager.prototype.getCandidate_=function(e){for(var i=this.getStartRadius_(),s=null,r=null,o=0;o<this.availableConnections_.length;o++){var h=this.availableConnections_[o],u=h.closest(i,e);u.connection&&(s=u.connection,r=h,i=u.radius)}return{closest:s,local:r,radius:i}},t.InsertionMarkerManager.prototype.getStartRadius_=function(){return this.closestConnection_&&this.localConnection_?t.CONNECTING_SNAP_RADIUS:t.SNAP_RADIUS},t.InsertionMarkerManager.prototype.shouldDelete_=function(e,i){return e=e&&!!e.closest&&i!=t.DELETE_AREA_TOOLBOX,!!i&&!this.topBlock_.getParent()&&this.topBlock_.isDeletable()&&!e},t.InsertionMarkerManager.prototype.maybeShowPreview_=function(e){if(!this.wouldDeleteBlock_){var i=e.closest;e=e.local,i&&(i==this.closestConnection_||i.getSourceBlock().isInsertionMarker()?console.log("Trying to connect to an insertion marker"):(this.closestConnection_=i,this.localConnection_=e,this.showPreview_()))}},t.InsertionMarkerManager.prototype.showPreview_=function(){var e=this.closestConnection_,i=this.workspace_.getRenderer();switch(i.getConnectionPreviewMethod(e,this.localConnection_,this.topBlock_)){case t.InsertionMarkerManager.PREVIEW_TYPE.INPUT_OUTLINE:this.showInsertionInputOutline_();break;case t.InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER:this.showInsertionMarker_();break;case t.InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE:this.showReplacementFade_()}e&&i.shouldHighlightConnection(e)&&e.highlight()},t.InsertionMarkerManager.prototype.maybeHidePreview_=function(e){if(e.closest){var i=this.closestConnection_!=e.closest;e=this.localConnection_!=e.local,this.closestConnection_&&this.localConnection_&&(i||e||this.wouldDeleteBlock_)&&this.hidePreview_()}else this.hidePreview_();this.localConnection_=this.closestConnection_=this.markerConnection_=null},t.InsertionMarkerManager.prototype.hidePreview_=function(){this.closestConnection_&&this.closestConnection_.targetBlock()&&this.workspace_.getRenderer().shouldHighlightConnection(this.closestConnection_)&&this.closestConnection_.unhighlight(),this.fadedBlock_?this.hideReplacementFade_():this.highlightedBlock_?this.hideInsertionInputOutline_():this.markerConnection_&&this.hideInsertionMarker_()},t.InsertionMarkerManager.prototype.showInsertionMarker_=function(){var e=this.localConnection_,i=this.closestConnection_,s=this.lastOnStack_&&e==this.lastOnStack_?this.lastMarker_:this.firstMarker_;if(e=s.getMatchingConnection(e.getSourceBlock(),e),e==this.markerConnection_)throw Error("Made it to showInsertionMarker_ even though the marker isn't changing");s.render(),s.rendered=!0,s.getSvgRoot().setAttribute("visibility","visible"),e&&i&&s.positionNearConnection(e,i),i&&e.connect(i),this.markerConnection_=e},t.InsertionMarkerManager.prototype.hideInsertionMarker_=function(){if(this.markerConnection_){var e=this.markerConnection_,i=e.getSourceBlock(),s=i.nextConnection,r=i.previousConnection,o=i.outputConnection;if(o=e.type==t.connectionTypes.INPUT_VALUE&&!(o&&o.targetConnection),!(e!=s||r&&r.targetConnection)||o?e.targetBlock().unplug(!1):e.type==t.connectionTypes.NEXT_STATEMENT&&e!=s?(s=e.targetConnection,s.getSourceBlock().unplug(!1),r=r?r.targetConnection:null,i.unplug(!0),r&&r.connect(s)):i.unplug(!0),e.targetConnection)throw Error("markerConnection_ still connected at the end of disconnectInsertionMarker");this.markerConnection_=null,i.getSvgRoot().setAttribute("visibility","hidden")}else console.log("No insertion marker connection to disconnect")},t.InsertionMarkerManager.prototype.showInsertionInputOutline_=function(){var e=this.closestConnection_;this.highlightedBlock_=e.getSourceBlock(),this.highlightedBlock_.highlightShapeForInput(e,!0)},t.InsertionMarkerManager.prototype.hideInsertionInputOutline_=function(){this.highlightedBlock_.highlightShapeForInput(this.closestConnection_,!1),this.highlightedBlock_=null},t.InsertionMarkerManager.prototype.showReplacementFade_=function(){this.fadedBlock_=this.closestConnection_.targetBlock(),this.fadedBlock_.fadeForReplacement(!0)},t.InsertionMarkerManager.prototype.hideReplacementFade_=function(){this.fadedBlock_.fadeForReplacement(!1),this.fadedBlock_=null},t.InsertionMarkerManager.prototype.getInsertionMarkers=function(){var e=[];return this.firstMarker_&&e.push(this.firstMarker_),this.lastMarker_&&e.push(this.lastMarker_),e},t.BlockDragger=function(e,i){this.draggingBlock_=e,this.workspace_=i,this.draggedConnectionManager_=new t.InsertionMarkerManager(this.draggingBlock_),this.deleteArea_=null,this.wouldDeleteBlock_=!1,this.startXY_=this.draggingBlock_.getRelativeToSurfaceXY(),this.dragIconData_=t.BlockDragger.initIconData_(e)},t.BlockDragger.prototype.dispose=function(){this.dragIconData_.length=0,this.draggedConnectionManager_&&this.draggedConnectionManager_.dispose()},t.BlockDragger.initIconData_=function(e){var i=[];e=e.getDescendants(!1);for(var s=0,r;r=e[s];s++){r=r.getIcons();for(var o=0;o<r.length;o++){var h={location:r[o].getIconLocation(),icon:r[o]};i.push(h)}}return i},t.BlockDragger.prototype.startBlockDrag=function(e,i){t.Events.getGroup()||t.Events.setGroup(!0),this.fireDragStartEvent_(),this.workspace_.isMutator&&this.draggingBlock_.bringToFront(),t.utils.dom.startTextWidthCache(),this.workspace_.setResizesEnabled(!1),t.blockAnimations.disconnectUiStop(),(this.draggingBlock_.getParent()||i&&this.draggingBlock_.nextConnection&&this.draggingBlock_.nextConnection.targetBlock())&&(this.draggingBlock_.unplug(i),e=this.pixelsToWorkspaceUnits_(e),e=t.utils.Coordinate.sum(this.startXY_,e),this.draggingBlock_.translate(e.x,e.y),t.blockAnimations.disconnectUiEffect(this.draggingBlock_),this.draggedConnectionManager_.updateAvailableConnections()),this.draggingBlock_.setDragging(!0),this.draggingBlock_.moveToDragSurface(),(e=this.workspace_.getToolbox())&&typeof e.addStyle=="function"&&(i=this.draggingBlock_.isDeletable()?"blocklyToolboxDelete":"blocklyToolboxGrab",e.addStyle(i))},t.BlockDragger.prototype.fireDragStartEvent_=function(){var e=new(t.Events.get(t.Events.BLOCK_DRAG))(this.draggingBlock_,!0,this.draggingBlock_.getDescendants(!1));t.Events.fire(e)},t.BlockDragger.prototype.dragBlock=function(e,i){i=this.pixelsToWorkspaceUnits_(i);var s=t.utils.Coordinate.sum(this.startXY_,i);this.draggingBlock_.moveDuringDrag(s),this.dragIcons_(i),this.deleteArea_=this.workspace_.isDeleteArea(e),this.draggedConnectionManager_.update(i,this.deleteArea_),this.updateCursorDuringBlockDrag_()},t.BlockDragger.prototype.endBlockDrag=function(e,i){this.dragBlock(e,i),this.dragIconData_=[],this.fireDragEndEvent_(),t.utils.dom.stopTextWidthCache(),t.blockAnimations.disconnectUiStop(),e=this.pixelsToWorkspaceUnits_(i),i=t.utils.Coordinate.sum(this.startXY_,e),this.draggingBlock_.moveOffDragSurface(i),this.maybeDeleteBlock_()||(this.draggingBlock_.moveConnections(e.x,e.y),this.draggingBlock_.setDragging(!1),this.fireMoveEvent_(),this.draggedConnectionManager_.wouldConnectBlock()?this.draggedConnectionManager_.applyConnections():this.draggingBlock_.render(),this.draggingBlock_.scheduleSnapAndBump()),this.workspace_.setResizesEnabled(!0),(e=this.workspace_.getToolbox())&&typeof e.removeStyle=="function"&&(i=this.draggingBlock_.isDeletable()?"blocklyToolboxDelete":"blocklyToolboxGrab",e.removeStyle(i)),t.Events.setGroup(!1)},t.BlockDragger.prototype.fireDragEndEvent_=function(){var e=new(t.Events.get(t.Events.BLOCK_DRAG))(this.draggingBlock_,!1,this.draggingBlock_.getDescendants(!1));t.Events.fire(e)},t.BlockDragger.prototype.fireMoveEvent_=function(){var e=new(t.Events.get(t.Events.BLOCK_MOVE))(this.draggingBlock_);e.oldCoordinate=this.startXY_,e.recordNew(),t.Events.fire(e)},t.BlockDragger.prototype.maybeDeleteBlock_=function(){var e=this.workspace_.trashcan;return this.wouldDeleteBlock_?(e&&setTimeout(e.closeLid.bind(e),100),this.fireMoveEvent_(),this.draggingBlock_.dispose(!1,!0),t.draggingConnections=[]):e&&e.closeLid(),this.wouldDeleteBlock_},t.BlockDragger.prototype.updateCursorDuringBlockDrag_=function(){this.wouldDeleteBlock_=this.draggedConnectionManager_.wouldDeleteBlock();var e=this.workspace_.trashcan;this.wouldDeleteBlock_?(this.draggingBlock_.setDeleteStyle(!0),this.deleteArea_==t.DELETE_AREA_TRASH&&e&&e.setLidOpen(!0)):(this.draggingBlock_.setDeleteStyle(!1),e&&e.setLidOpen(!1))},t.BlockDragger.prototype.pixelsToWorkspaceUnits_=function(e){return e=new t.utils.Coordinate(e.x/this.workspace_.scale,e.y/this.workspace_.scale),this.workspace_.isMutator&&e.scale(1/this.workspace_.options.parentWorkspace.scale),e},t.BlockDragger.prototype.dragIcons_=function(e){for(var i=0;i<this.dragIconData_.length;i++){var s=this.dragIconData_[i];s.icon.setIconLocation(t.utils.Coordinate.sum(s.location,e))}},t.BlockDragger.prototype.getInsertionMarkers=function(){return this.draggedConnectionManager_&&this.draggedConnectionManager_.getInsertionMarkers?this.draggedConnectionManager_.getInsertionMarkers():[]},t.IConnectionChecker=function(){},t.ConnectionChecker=function(){},t.ConnectionChecker.prototype.canConnect=function(e,i,s,r){return this.canConnectWithReason(e,i,s,r)==t.Connection.CAN_CONNECT},t.ConnectionChecker.prototype.canConnectWithReason=function(e,i,s,r){var o=this.doSafetyChecks(e,i);return o!=t.Connection.CAN_CONNECT?o:this.doTypeChecks(e,i)?s&&!this.doDragChecks(e,i,r||0)?t.Connection.REASON_DRAG_CHECKS_FAILED:t.Connection.CAN_CONNECT:t.Connection.REASON_CHECKS_FAILED},t.ConnectionChecker.prototype.getErrorMessage=function(e,i,s){switch(e){case t.Connection.REASON_SELF_CONNECTION:return"Attempted to connect a block to itself.";case t.Connection.REASON_DIFFERENT_WORKSPACES:return"Blocks not on same workspace.";case t.Connection.REASON_WRONG_TYPE:return"Attempt to connect incompatible types.";case t.Connection.REASON_TARGET_NULL:return"Target connection is null.";case t.Connection.REASON_CHECKS_FAILED:return"Connection checks failed. "+(i+" expected "+i.getCheck()+", found "+s.getCheck());case t.Connection.REASON_SHADOW_PARENT:return"Connecting non-shadow to shadow block.";case t.Connection.REASON_DRAG_CHECKS_FAILED:return"Drag checks failed.";default:return"Unknown connection failure: this should never happen!"}},t.ConnectionChecker.prototype.doSafetyChecks=function(e,i){if(!e||!i)return t.Connection.REASON_TARGET_NULL;if(e.isSuperior())var s=e.getSourceBlock(),r=i.getSourceBlock();else r=e.getSourceBlock(),s=i.getSourceBlock();return s==r?t.Connection.REASON_SELF_CONNECTION:i.type!=t.OPPOSITE_TYPE[e.type]?t.Connection.REASON_WRONG_TYPE:s.workspace!==r.workspace?t.Connection.REASON_DIFFERENT_WORKSPACES:s.isShadow()&&!r.isShadow()?t.Connection.REASON_SHADOW_PARENT:t.Connection.CAN_CONNECT},t.ConnectionChecker.prototype.doTypeChecks=function(e,i){if(e=e.getCheck(),i=i.getCheck(),!e||!i)return!0;for(var s=0;s<e.length;s++)if(i.indexOf(e[s])!=-1)return!0;return!1},t.ConnectionChecker.prototype.doDragChecks=function(e,i,s){if(e.distanceFrom(i)>s||i.getSourceBlock().isInsertionMarker())return!1;switch(i.type){case t.connectionTypes.PREVIOUS_STATEMENT:return this.canConnectToPrevious_(e,i);case t.connectionTypes.OUTPUT_VALUE:if(i.isConnected()&&!i.targetBlock().isInsertionMarker()||e.isConnected())return!1;break;case t.connectionTypes.INPUT_VALUE:if(i.isConnected()&&!i.targetBlock().isMovable()&&!i.targetBlock().isShadow())return!1;break;case t.connectionTypes.NEXT_STATEMENT:if(i.isConnected()&&!e.getSourceBlock().nextConnection&&!i.targetBlock().isShadow()&&i.targetBlock().nextConnection)return!1;break;default:return!1}return t.draggingConnections.indexOf(i)==-1},t.ConnectionChecker.prototype.canConnectToPrevious_=function(e,i){return e.targetConnection||t.draggingConnections.indexOf(i)!=-1?!1:i.targetConnection?(e=i.targetBlock(),e.isInsertionMarker()?!e.getPreviousBlock():!1):!0},t.registry.register(t.registry.Type.CONNECTION_CHECKER,t.registry.DEFAULT,t.ConnectionChecker),t.VariableMap=function(e){this.variableMap_=Object.create(null),this.workspace=e},t.VariableMap.prototype.clear=function(){this.variableMap_=Object.create(null)},t.VariableMap.prototype.renameVariable=function(e,i){var s=this.getVariable(i,e.type),r=this.workspace.getAllBlocks(!1);t.Events.setGroup(!0);try{s&&s.getId()!=e.getId()?this.renameVariableWithConflict_(e,i,s,r):this.renameVariableAndUses_(e,i,r)}finally{t.Events.setGroup(!1)}},t.VariableMap.prototype.renameVariableById=function(e,i){var s=this.getVariableById(e);if(!s)throw Error("Tried to rename a variable that didn't exist. ID: "+e);this.renameVariable(s,i)},t.VariableMap.prototype.renameVariableAndUses_=function(e,i,s){for(t.Events.fire(new(t.Events.get(t.Events.VAR_RENAME))(e,i)),e.name=i,i=0;i<s.length;i++)s[i].updateVarName(e)},t.VariableMap.prototype.renameVariableWithConflict_=function(e,i,s,r){var o=e.type;for(i!=s.name&&this.renameVariableAndUses_(s,i,r),i=0;i<r.length;i++)r[i].renameVarById(e.getId(),s.getId());t.Events.fire(new(t.Events.get(t.Events.VAR_DELETE))(e)),e=this.getVariablesOfType(o).indexOf(e),this.variableMap_[o].splice(e,1)},t.VariableMap.prototype.createVariable=function(e,i,s){var r=this.getVariable(e,i);if(r){if(s&&r.getId()!=s)throw Error('Variable "'+e+'" is already in use and its id is "'+r.getId()+'" which conflicts with the passed in id, "'+s+'".');return r}if(s&&this.getVariableById(s))throw Error('Variable id, "'+s+'", is already in use.');return r=s||t.utils.genUid(),i=i||"",r=new t.VariableModel(this.workspace,e,i,r),e=this.variableMap_[i]||[],e.push(r),delete this.variableMap_[i],this.variableMap_[i]=e,r},t.VariableMap.prototype.deleteVariable=function(e){for(var i=this.variableMap_[e.type],s=0,r;r=i[s];s++)if(r.getId()==e.getId()){i.splice(s,1),t.Events.fire(new(t.Events.get(t.Events.VAR_DELETE))(e));break}},t.VariableMap.prototype.deleteVariableById=function(e){var i=this.getVariableById(e);if(i){var s=i.name,r=this.getVariableUsesById(e);e=0;for(var o;o=r[e];e++)if(o.type=="procedures_defnoreturn"||o.type=="procedures_defreturn"){e=o.getFieldValue("NAME"),s=t.Msg.CANNOT_DELETE_VARIABLE_PROCEDURE.replace("%1",s).replace("%2",e),t.alert(s);return}var h=this;1<r.length?(s=t.Msg.DELETE_VARIABLE_CONFIRMATION.replace("%1",String(r.length)).replace("%2",s),t.confirm(s,function(u){u&&i&&h.deleteVariableInternal(i,r)})):h.deleteVariableInternal(i,r)}else console.warn("Can't delete non-existent variable: "+e)},t.VariableMap.prototype.deleteVariableInternal=function(e,i){var s=t.Events.getGroup();s||t.Events.setGroup(!0);try{for(var r=0;r<i.length;r++)i[r].dispose(!0);this.deleteVariable(e)}finally{s||t.Events.setGroup(!1)}},t.VariableMap.prototype.getVariable=function(e,i){if(i=this.variableMap_[i||""]){for(var s=0,r;r=i[s];s++)if(t.Names.equals(r.name,e))return r}return null},t.VariableMap.prototype.getVariableById=function(e){for(var i=Object.keys(this.variableMap_),s=0;s<i.length;s++)for(var r=i[s],o=0,h;h=this.variableMap_[r][o];o++)if(h.getId()==e)return h;return null},t.VariableMap.prototype.getVariablesOfType=function(e){return(e=this.variableMap_[e||""])?e.slice():[]},t.VariableMap.prototype.getVariableTypes=function(e){var i={};t.utils.object.mixin(i,this.variableMap_),e&&e.getPotentialVariableMap()&&t.utils.object.mixin(i,e.getPotentialVariableMap().variableMap_),e=Object.keys(i),i=!1;for(var s=0;s<e.length;s++)e[s]==""&&(i=!0);return i||e.push(""),e},t.VariableMap.prototype.getAllVariables=function(){var e=[],i;for(i in this.variableMap_)e=e.concat(this.variableMap_[i]);return e},t.VariableMap.prototype.getAllVariableNames=function(){var e=[],i;for(i in this.variableMap_)for(var s=this.variableMap_[i],r=0,o;o=s[r];r++)e.push(o.name);return e},t.VariableMap.prototype.getVariableUsesById=function(e){for(var i=[],s=this.workspace.getAllBlocks(!1),r=0;r<s.length;r++){var o=s[r].getVarModels();if(o)for(var h=0;h<o.length;h++)o[h].getId()==e&&i.push(s[r])}return i},t.Workspace=function(e){this.id=t.utils.genUid(),t.Workspace.WorkspaceDB_[this.id]=this,this.options=e||new t.Options({}),this.RTL=!!this.options.RTL,this.horizontalLayout=!!this.options.horizontalLayout,this.toolboxPosition=this.options.toolboxPosition,this.connectionChecker=new(t.registry.getClassFromOptions(t.registry.Type.CONNECTION_CHECKER,this.options,!0))(this),this.topBlocks_=[],this.topComments_=[],this.commentDB_=Object.create(null),this.listeners_=[],this.undoStack_=[],this.redoStack_=[],this.blockDB_=Object.create(null),this.typedBlocksDB_=Object.create(null),this.variableMap_=new t.VariableMap(this),this.potentialVariableMap_=null},t.Workspace.prototype.rendered=!1,t.Workspace.prototype.isClearing=!1,t.Workspace.prototype.MAX_UNDO=1024,t.Workspace.prototype.connectionDBList=null,t.Workspace.prototype.dispose=function(){this.listeners_.length=0,this.clear(),delete t.Workspace.WorkspaceDB_[this.id]},t.Workspace.SCAN_ANGLE=3,t.Workspace.prototype.sortObjects_=function(e,i){return e=e.getRelativeToSurfaceXY(),i=i.getRelativeToSurfaceXY(),e.y+t.Workspace.prototype.sortObjects_.offset*e.x-(i.y+t.Workspace.prototype.sortObjects_.offset*i.x)},t.Workspace.prototype.addTopBlock=function(e){this.topBlocks_.push(e)},t.Workspace.prototype.removeTopBlock=function(e){if(!t.utils.arrayRemove(this.topBlocks_,e))throw Error("Block not present in workspace's list of top-most blocks.")},t.Workspace.prototype.getTopBlocks=function(e){var i=[].concat(this.topBlocks_);return e&&1<i.length&&(this.sortObjects_.offset=Math.sin(t.utils.math.toRadians(t.Workspace.SCAN_ANGLE)),this.RTL&&(this.sortObjects_.offset*=-1),i.sort(this.sortObjects_)),i},t.Workspace.prototype.addTypedBlock=function(e){this.typedBlocksDB_[e.type]||(this.typedBlocksDB_[e.type]=[]),this.typedBlocksDB_[e.type].push(e)},t.Workspace.prototype.removeTypedBlock=function(e){this.typedBlocksDB_[e.type].splice(this.typedBlocksDB_[e.type].indexOf(e),1),this.typedBlocksDB_[e.type].length||delete this.typedBlocksDB_[e.type]},t.Workspace.prototype.getBlocksByType=function(e,i){return this.typedBlocksDB_[e]?(e=this.typedBlocksDB_[e].slice(0),i&&1<e.length&&(this.sortObjects_.offset=Math.sin(t.utils.math.toRadians(t.Workspace.SCAN_ANGLE)),this.RTL&&(this.sortObjects_.offset*=-1),e.sort(this.sortObjects_)),e):[]},t.Workspace.prototype.addTopComment=function(e){this.topComments_.push(e),this.commentDB_[e.id]&&console.warn('Overriding an existing comment on this workspace, with id "'+e.id+'"'),this.commentDB_[e.id]=e},t.Workspace.prototype.removeTopComment=function(e){if(!t.utils.arrayRemove(this.topComments_,e))throw Error("Comment not present in workspace's list of top-most comments.");delete this.commentDB_[e.id]},t.Workspace.prototype.getTopComments=function(e){var i=[].concat(this.topComments_);return e&&1<i.length&&(this.sortObjects_.offset=Math.sin(t.utils.math.toRadians(t.Workspace.SCAN_ANGLE)),this.RTL&&(this.sortObjects_.offset*=-1),i.sort(this.sortObjects_)),i},t.Workspace.prototype.getAllBlocks=function(e){if(e){e=this.getTopBlocks(!0);for(var i=[],s=0;s<e.length;s++)i.push.apply(i,e[s].getDescendants(!0))}else for(i=this.getTopBlocks(!1),s=0;s<i.length;s++)i.push.apply(i,i[s].getChildren(!1));return i.filter(function(r){return!r.isInsertionMarker()})},t.Workspace.prototype.clear=function(){this.isClearing=!0;try{var e=t.Events.getGroup();for(e||t.Events.setGroup(!0);this.topBlocks_.length;)this.topBlocks_[0].dispose(!1);for(;this.topComments_.length;)this.topComments_[this.topComments_.length-1].dispose(!1);e||t.Events.setGroup(!1),this.variableMap_.clear(),this.potentialVariableMap_&&this.potentialVariableMap_.clear()}finally{this.isClearing=!1}},t.Workspace.prototype.renameVariableById=function(e,i){this.variableMap_.renameVariableById(e,i)},t.Workspace.prototype.createVariable=function(e,i,s){return this.variableMap_.createVariable(e,i,s)},t.Workspace.prototype.getVariableUsesById=function(e){return this.variableMap_.getVariableUsesById(e)},t.Workspace.prototype.deleteVariableById=function(e){this.variableMap_.deleteVariableById(e)},t.Workspace.prototype.getVariable=function(e,i){return this.variableMap_.getVariable(e,i)},t.Workspace.prototype.getVariableById=function(e){return this.variableMap_.getVariableById(e)},t.Workspace.prototype.getVariablesOfType=function(e){return this.variableMap_.getVariablesOfType(e)},t.Workspace.prototype.getVariableTypes=function(){return this.variableMap_.getVariableTypes(this)},t.Workspace.prototype.getAllVariables=function(){return this.variableMap_.getAllVariables()},t.Workspace.prototype.getAllVariableNames=function(){return this.variableMap_.getAllVariableNames()},t.Workspace.prototype.getWidth=function(){return 0},t.Workspace.prototype.newBlock=function(e,i){return new t.Block(this,e,i)},t.Workspace.prototype.remainingCapacity=function(){return isNaN(this.options.maxBlocks)?1/0:this.options.maxBlocks-this.getAllBlocks(!1).length},t.Workspace.prototype.remainingCapacityOfType=function(e){return this.options.maxInstances?(this.options.maxInstances[e]!==void 0?this.options.maxInstances[e]:1/0)-this.getBlocksByType(e,!1).length:1/0},t.Workspace.prototype.isCapacityAvailable=function(e){if(!this.hasBlockLimits())return!0;var i=0,s;for(s in e){if(e[s]>this.remainingCapacityOfType(s))return!1;i+=e[s]}return!(i>this.remainingCapacity())},t.Workspace.prototype.hasBlockLimits=function(){return this.options.maxBlocks!=1/0||!!this.options.maxInstances},t.Workspace.prototype.getUndoStack=function(){return this.undoStack_},t.Workspace.prototype.getRedoStack=function(){return this.redoStack_},t.Workspace.prototype.undo=function(e){var i=e?this.redoStack_:this.undoStack_,s=e?this.undoStack_:this.redoStack_,r=i.pop();if(r){for(var o=[r];i.length&&r.group&&r.group==i[i.length-1].group;)o.push(i.pop());for(i=0;r=o[i];i++)s.push(r);o=t.Events.filter(o,e),t.Events.recordUndo=!1;try{for(i=0;r=o[i];i++)r.run(e)}finally{t.Events.recordUndo=!0}}},t.Workspace.prototype.clearUndo=function(){this.undoStack_.length=0,this.redoStack_.length=0,t.Events.clearPendingUndo()},t.Workspace.prototype.addChangeListener=function(e){return this.listeners_.push(e),e},t.Workspace.prototype.removeChangeListener=function(e){t.utils.arrayRemove(this.listeners_,e)},t.Workspace.prototype.fireChangeListener=function(e){if(e.recordUndo)for(this.undoStack_.push(e),this.redoStack_.length=0;this.undoStack_.length>this.MAX_UNDO&&0<=this.MAX_UNDO;)this.undoStack_.shift();for(var i=0,s;s=this.listeners_[i];i++)s(e)},t.Workspace.prototype.getBlockById=function(e){return this.blockDB_[e]||null},t.Workspace.prototype.setBlockById=function(e,i){this.blockDB_[e]=i},t.Workspace.prototype.removeBlockById=function(e){delete this.blockDB_[e]},t.Workspace.prototype.getCommentById=function(e){return this.commentDB_[e]||null},t.Workspace.prototype.allInputsFilled=function(e){for(var i=this.getTopBlocks(!1),s=0,r;r=i[s];s++)if(!r.allInputsFilled(e))return!1;return!0},t.Workspace.prototype.getPotentialVariableMap=function(){return this.potentialVariableMap_},t.Workspace.prototype.createPotentialVariableMap=function(){this.potentialVariableMap_=new t.VariableMap(this)},t.Workspace.prototype.getVariableMap=function(){return this.variableMap_},t.Workspace.prototype.setVariableMap=function(e){this.variableMap_=e},t.Workspace.WorkspaceDB_=Object.create(null),t.Workspace.getById=function(e){return t.Workspace.WorkspaceDB_[e]||null},t.Workspace.getAll=function(){var e=[],i;for(i in t.Workspace.WorkspaceDB_)e.push(t.Workspace.WorkspaceDB_[i]);return e},t.Bubble=function(e,i,s,r,o,h){this.workspace_=e,this.content_=i,this.shape_=s,this.onMouseDownResizeWrapper_=this.onMouseDownBubbleWrapper_=this.moveCallback_=this.resizeCallback_=null,this.disposed=!1,s=t.Bubble.ARROW_ANGLE,this.workspace_.RTL&&(s=-s),this.arrow_radians_=t.utils.math.toRadians(s),e.getBubbleCanvas().appendChild(this.createDom_(i,!(!o||!h))),this.setAnchorLocation(r),o&&h||(e=this.content_.getBBox(),o=e.width+2*t.Bubble.BORDER_WIDTH,h=e.height+2*t.Bubble.BORDER_WIDTH),this.setBubbleSize(o,h),this.positionBubble_(),this.renderArrow_(),this.rendered_=!0},t.Bubble.BORDER_WIDTH=6,t.Bubble.ARROW_THICKNESS=5,t.Bubble.ARROW_ANGLE=20,t.Bubble.ARROW_BEND=4,t.Bubble.ANCHOR_RADIUS=8,t.Bubble.onMouseUpWrapper_=null,t.Bubble.onMouseMoveWrapper_=null,t.Bubble.unbindDragEvents_=function(){t.Bubble.onMouseUpWrapper_&&(t.browserEvents.unbind(t.Bubble.onMouseUpWrapper_),t.Bubble.onMouseUpWrapper_=null),t.Bubble.onMouseMoveWrapper_&&(t.browserEvents.unbind(t.Bubble.onMouseMoveWrapper_),t.Bubble.onMouseMoveWrapper_=null)},t.Bubble.bubbleMouseUp_=function(e){t.Touch.clearTouchIdentifier(),t.Bubble.unbindDragEvents_()},t.Bubble.prototype.rendered_=!1,t.Bubble.prototype.anchorXY_=null,t.Bubble.prototype.relativeLeft_=0,t.Bubble.prototype.relativeTop_=0,t.Bubble.prototype.width_=0,t.Bubble.prototype.height_=0,t.Bubble.prototype.autoLayout_=!0,t.Bubble.prototype.createDom_=function(e,i){this.bubbleGroup_=t.utils.dom.createSvgElement(t.utils.Svg.G,{},null);var s={filter:"url(#"+this.workspace_.getRenderer().getConstants().embossFilterId+")"};return t.utils.userAgent.JAVA_FX&&(s={}),s=t.utils.dom.createSvgElement(t.utils.Svg.G,s,this.bubbleGroup_),this.bubbleArrow_=t.utils.dom.createSvgElement(t.utils.Svg.PATH,{},s),this.bubbleBack_=t.utils.dom.createSvgElement(t.utils.Svg.RECT,{class:"blocklyDraggable",x:0,y:0,rx:t.Bubble.BORDER_WIDTH,ry:t.Bubble.BORDER_WIDTH},s),i?(this.resizeGroup_=t.utils.dom.createSvgElement(t.utils.Svg.G,{class:this.workspace_.RTL?"blocklyResizeSW":"blocklyResizeSE"},this.bubbleGroup_),i=2*t.Bubble.BORDER_WIDTH,t.utils.dom.createSvgElement(t.utils.Svg.POLYGON,{points:"0,x x,x x,0".replace(/x/g,i.toString())},this.resizeGroup_),t.utils.dom.createSvgElement(t.utils.Svg.LINE,{class:"blocklyResizeLine",x1:i/3,y1:i-1,x2:i-1,y2:i/3},this.resizeGroup_),t.utils.dom.createSvgElement(t.utils.Svg.LINE,{class:"blocklyResizeLine",x1:2*i/3,y1:i-1,x2:i-1,y2:2*i/3},this.resizeGroup_)):this.resizeGroup_=null,this.workspace_.options.readOnly||(this.onMouseDownBubbleWrapper_=t.browserEvents.conditionalBind(this.bubbleBack_,"mousedown",this,this.bubbleMouseDown_),this.resizeGroup_&&(this.onMouseDownResizeWrapper_=t.browserEvents.conditionalBind(this.resizeGroup_,"mousedown",this,this.resizeMouseDown_))),this.bubbleGroup_.appendChild(e),this.bubbleGroup_},t.Bubble.prototype.getSvgRoot=function(){return this.bubbleGroup_},t.Bubble.prototype.setSvgId=function(e){this.bubbleGroup_.dataset&&(this.bubbleGroup_.dataset.blockId=e)},t.Bubble.prototype.bubbleMouseDown_=function(e){var i=this.workspace_.getGesture(e);i&&i.handleBubbleStart(e,this)},t.Bubble.prototype.showContextMenu=function(e){},t.Bubble.prototype.isDeletable=function(){return!1},t.Bubble.prototype.setDeleteStyle=function(e){},t.Bubble.prototype.resizeMouseDown_=function(e){this.promote(),t.Bubble.unbindDragEvents_(),t.utils.isRightButton(e)||(this.workspace_.startDrag(e,new t.utils.Coordinate(this.workspace_.RTL?-this.width_:this.width_,this.height_)),t.Bubble.onMouseUpWrapper_=t.browserEvents.conditionalBind(document,"mouseup",this,t.Bubble.bubbleMouseUp_),t.Bubble.onMouseMoveWrapper_=t.browserEvents.conditionalBind(document,"mousemove",this,this.resizeMouseMove_),t.hideChaff()),e.stopPropagation()},t.Bubble.prototype.resizeMouseMove_=function(e){this.autoLayout_=!1,e=this.workspace_.moveDrag(e),this.setBubbleSize(this.workspace_.RTL?-e.x:e.x,e.y),this.workspace_.RTL&&this.positionBubble_()},t.Bubble.prototype.registerResizeEvent=function(e){this.resizeCallback_=e},t.Bubble.prototype.registerMoveEvent=function(e){this.moveCallback_=e},t.Bubble.prototype.promote=function(){var e=this.bubbleGroup_.parentNode;return e.lastChild!==this.bubbleGroup_?(e.appendChild(this.bubbleGroup_),!0):!1},t.Bubble.prototype.setAnchorLocation=function(e){this.anchorXY_=e,this.rendered_&&this.positionBubble_()},t.Bubble.prototype.layoutBubble_=function(){var e=this.workspace_.getMetricsManager().getViewMetrics(!0),i=this.getOptimalRelativeLeft_(e),s=this.getOptimalRelativeTop_(e),r=this.shape_.getBBox(),o={x:i,y:-this.height_-this.workspace_.getRenderer().getConstants().MIN_BLOCK_HEIGHT},h={x:-this.width_-30,y:s};s={x:r.width,y:s};var u={x:i,y:r.height};i=r.width<r.height?s:u,r=r.width<r.height?u:s,s=this.getOverlap_(o,e),u=this.getOverlap_(h,e);var p=this.getOverlap_(i,e);e=this.getOverlap_(r,e),e=Math.max(s,u,p,e),s==e?(this.relativeLeft_=o.x,this.relativeTop_=o.y):u==e?(this.relativeLeft_=h.x,this.relativeTop_=h.y):p==e?(this.relativeLeft_=i.x,this.relativeTop_=i.y):(this.relativeLeft_=r.x,this.relativeTop_=r.y)},t.Bubble.prototype.getOverlap_=function(e,i){var s=this.workspace_.RTL?this.anchorXY_.x-e.x-this.width_:e.x+this.anchorXY_.x;return e=e.y+this.anchorXY_.y,Math.max(0,Math.min(1,(Math.min(s+this.width_,i.left+i.width)-Math.max(s,i.left))*(Math.min(e+this.height_,i.top+i.height)-Math.max(e,i.top))/(this.width_*this.height_)))},t.Bubble.prototype.getOptimalRelativeLeft_=function(e){var i=-this.width_/4;if(this.width_>e.width)return i;if(this.workspace_.RTL)var s=this.anchorXY_.x-i,r=s-this.width_,o=e.left+e.width,h=e.left+t.Scrollbar.scrollbarThickness/this.workspace_.scale;else r=i+this.anchorXY_.x,s=r+this.width_,h=e.left,o=e.left+e.width-t.Scrollbar.scrollbarThickness/this.workspace_.scale;return this.workspace_.RTL?r<h?i=-(h-this.anchorXY_.x+this.width_):s>o&&(i=-(o-this.anchorXY_.x)):r<h?i=h-this.anchorXY_.x:s>o&&(i=o-this.anchorXY_.x-this.width_),i},t.Bubble.prototype.getOptimalRelativeTop_=function(e){var i=-this.height_/4;if(this.height_>e.height)return i;var s=this.anchorXY_.y+i,r=s+this.height_,o=e.top;e=e.top+e.height-t.Scrollbar.scrollbarThickness/this.workspace_.scale;var h=this.anchorXY_.y;return s<o?i=o-h:r>e&&(i=e-h-this.height_),i},t.Bubble.prototype.positionBubble_=function(){var e=this.anchorXY_.x;e=this.workspace_.RTL?e-(this.relativeLeft_+this.width_):e+this.relativeLeft_,this.moveTo(e,this.relativeTop_+this.anchorXY_.y)},t.Bubble.prototype.moveTo=function(e,i){this.bubbleGroup_.setAttribute("transform","translate("+e+","+i+")")},t.Bubble.prototype.setDragging=function(e){!e&&this.moveCallback_&&this.moveCallback_()},t.Bubble.prototype.getBubbleSize=function(){return new t.utils.Size(this.width_,this.height_)},t.Bubble.prototype.setBubbleSize=function(e,i){var s=2*t.Bubble.BORDER_WIDTH;e=Math.max(e,s+45),i=Math.max(i,s+20),this.width_=e,this.height_=i,this.bubbleBack_.setAttribute("width",e),this.bubbleBack_.setAttribute("height",i),this.resizeGroup_&&(this.workspace_.RTL?this.resizeGroup_.setAttribute("transform","translate("+2*t.Bubble.BORDER_WIDTH+","+(i-s)+") scale(-1 1)"):this.resizeGroup_.setAttribute("transform","translate("+(e-s)+","+(i-s)+")")),this.autoLayout_&&this.layoutBubble_(),this.positionBubble_(),this.renderArrow_(),this.resizeCallback_&&this.resizeCallback_()},t.Bubble.prototype.renderArrow_=function(){var e=[],i=this.width_/2,s=this.height_/2,r=-this.relativeLeft_,o=-this.relativeTop_;if(i==r&&s==o)e.push("M "+i+","+s);else{o-=s,r-=i,this.workspace_.RTL&&(r*=-1);var h=Math.sqrt(o*o+r*r),u=Math.acos(r/h);0>o&&(u=2*Math.PI-u);var p=u+Math.PI/2;p>2*Math.PI&&(p-=2*Math.PI);var d=Math.sin(p),f=Math.cos(p),g=this.getBubbleSize();p=(g.width+g.height)/t.Bubble.ARROW_THICKNESS,p=Math.min(p,g.width,g.height)/4,g=1-t.Bubble.ANCHOR_RADIUS/h,r=i+g*r,o=s+g*o,g=i+p*f;var _=s+p*d;i-=p*f,s-=p*d,d=u+this.arrow_radians_,d>2*Math.PI&&(d-=2*Math.PI),u=Math.sin(d)*h/t.Bubble.ARROW_BEND,h=Math.cos(d)*h/t.Bubble.ARROW_BEND,e.push("M"+g+","+_),e.push("C"+(g+h)+","+(_+u)+" "+r+","+o+" "+r+","+o),e.push("C"+r+","+o+" "+(i+h)+","+(s+u)+" "+i+","+s)}e.push("z"),this.bubbleArrow_.setAttribute("d",e.join(" "))},t.Bubble.prototype.setColour=function(e){this.bubbleBack_.setAttribute("fill",e),this.bubbleArrow_.setAttribute("fill",e)},t.Bubble.prototype.dispose=function(){this.onMouseDownBubbleWrapper_&&t.browserEvents.unbind(this.onMouseDownBubbleWrapper_),this.onMouseDownResizeWrapper_&&t.browserEvents.unbind(this.onMouseDownResizeWrapper_),t.Bubble.unbindDragEvents_(),t.utils.dom.removeNode(this.bubbleGroup_),this.disposed=!0},t.Bubble.prototype.moveDuringDrag=function(e,i){e?e.translateSurface(i.x,i.y):this.moveTo(i.x,i.y),this.relativeLeft_=this.workspace_.RTL?this.anchorXY_.x-i.x-this.width_:i.x-this.anchorXY_.x,this.relativeTop_=i.y-this.anchorXY_.y,this.renderArrow_()},t.Bubble.prototype.getRelativeToSurfaceXY=function(){return new t.utils.Coordinate(this.workspace_.RTL?-this.relativeLeft_+this.anchorXY_.x-this.width_:this.anchorXY_.x+this.relativeLeft_,this.anchorXY_.y+this.relativeTop_)},t.Bubble.prototype.setAutoLayout=function(e){this.autoLayout_=e},t.Bubble.textToDom=function(e){var i=t.utils.dom.createSvgElement(t.utils.Svg.TEXT,{class:"blocklyText blocklyBubbleText blocklyNoPointerEvents",y:t.Bubble.BORDER_WIDTH},null);e=e.split(`
`);for(var s=0;s<e.length;s++){var r=t.utils.dom.createSvgElement(t.utils.Svg.TSPAN,{dy:"1em",x:t.Bubble.BORDER_WIDTH},i),o=document.createTextNode(e[s]);r.appendChild(o)}return i},t.Bubble.createNonEditableBubble=function(e,i,s){if(s=new t.Bubble(i.workspace,e,i.pathObject.svgPath,s,null,null),s.setSvgId(i.id),i.RTL){i=e.getBBox().width;for(var r=0,o;o=e.childNodes[r];r++)o.setAttribute("text-anchor","end"),o.setAttribute("x",i+t.Bubble.BORDER_WIDTH)}return s},t.Events.CommentBase=function(e){this.commentId=(this.isBlank=typeof e>"u")?"":e.id,this.workspaceId=this.isBlank?"":e.workspace.id,this.group=t.Events.getGroup(),this.recordUndo=t.Events.recordUndo},t.utils.object.inherits(t.Events.CommentBase,t.Events.Abstract),t.Events.CommentBase.prototype.toJson=function(){var e=t.Events.CommentBase.superClass_.toJson.call(this);return this.commentId&&(e.commentId=this.commentId),e},t.Events.CommentBase.prototype.fromJson=function(e){t.Events.CommentBase.superClass_.fromJson.call(this,e),this.commentId=e.commentId},t.Events.CommentChange=function(e,i,s){t.Events.CommentChange.superClass_.constructor.call(this,e),e&&(this.oldContents_=typeof i>"u"?"":i,this.newContents_=typeof s>"u"?"":s)},t.utils.object.inherits(t.Events.CommentChange,t.Events.CommentBase),t.Events.CommentChange.prototype.type=t.Events.COMMENT_CHANGE,t.Events.CommentChange.prototype.toJson=function(){var e=t.Events.CommentChange.superClass_.toJson.call(this);return e.oldContents=this.oldContents_,e.newContents=this.newContents_,e},t.Events.CommentChange.prototype.fromJson=function(e){t.Events.CommentChange.superClass_.fromJson.call(this,e),this.oldContents_=e.oldContents,this.newContents_=e.newContents},t.Events.CommentChange.prototype.isNull=function(){return this.oldContents_==this.newContents_},t.Events.CommentChange.prototype.run=function(e){var i=this.getEventWorkspace_().getCommentById(this.commentId);i?i.setContent(e?this.newContents_:this.oldContents_):console.warn("Can't change non-existent comment: "+this.commentId)},t.Events.CommentCreate=function(e){t.Events.CommentCreate.superClass_.constructor.call(this,e),e&&(this.xml=e.toXmlWithXY())},t.utils.object.inherits(t.Events.CommentCreate,t.Events.CommentBase),t.Events.CommentCreate.prototype.type=t.Events.COMMENT_CREATE,t.Events.CommentCreate.prototype.toJson=function(){var e=t.Events.CommentCreate.superClass_.toJson.call(this);return e.xml=t.Xml.domToText(this.xml),e},t.Events.CommentCreate.prototype.fromJson=function(e){t.Events.CommentCreate.superClass_.fromJson.call(this,e),this.xml=t.Xml.textToDom(e.xml)},t.Events.CommentCreate.prototype.run=function(e){t.Events.CommentCreateDeleteHelper(this,e)},t.Events.CommentCreateDeleteHelper=function(e,i){var s=e.getEventWorkspace_();i?(i=t.utils.xml.createElement("xml"),i.appendChild(e.xml),t.Xml.domToWorkspace(i,s)):(s=s.getCommentById(e.commentId))?s.dispose(!1,!1):console.warn("Can't uncreate non-existent comment: "+e.commentId)},t.Events.CommentDelete=function(e){t.Events.CommentDelete.superClass_.constructor.call(this,e),e&&(this.xml=e.toXmlWithXY())},t.utils.object.inherits(t.Events.CommentDelete,t.Events.CommentBase),t.Events.CommentDelete.prototype.type=t.Events.COMMENT_DELETE,t.Events.CommentDelete.prototype.toJson=function(){return t.Events.CommentDelete.superClass_.toJson.call(this)},t.Events.CommentDelete.prototype.fromJson=function(e){t.Events.CommentDelete.superClass_.fromJson.call(this,e)},t.Events.CommentDelete.prototype.run=function(e){t.Events.CommentCreateDeleteHelper(this,!e)},t.Events.CommentMove=function(e){t.Events.CommentMove.superClass_.constructor.call(this,e),e&&(this.comment_=e,this.oldCoordinate_=e.getXY(),this.newCoordinate_=null)},t.utils.object.inherits(t.Events.CommentMove,t.Events.CommentBase),t.Events.CommentMove.prototype.recordNew=function(){if(!this.comment_)throw Error("Tried to record the new position of a comment on the same event twice.");this.newCoordinate_=this.comment_.getXY(),this.comment_=null},t.Events.CommentMove.prototype.type=t.Events.COMMENT_MOVE,t.Events.CommentMove.prototype.setOldCoordinate=function(e){this.oldCoordinate_=e},t.Events.CommentMove.prototype.toJson=function(){var e=t.Events.CommentMove.superClass_.toJson.call(this);return this.oldCoordinate_&&(e.oldCoordinate=Math.round(this.oldCoordinate_.x)+","+Math.round(this.oldCoordinate_.y)),this.newCoordinate_&&(e.newCoordinate=Math.round(this.newCoordinate_.x)+","+Math.round(this.newCoordinate_.y)),e},t.Events.CommentMove.prototype.fromJson=function(e){if(t.Events.CommentMove.superClass_.fromJson.call(this,e),e.oldCoordinate){var i=e.oldCoordinate.split(",");this.oldCoordinate_=new t.utils.Coordinate(Number(i[0]),Number(i[1]))}e.newCoordinate&&(i=e.newCoordinate.split(","),this.newCoordinate_=new t.utils.Coordinate(Number(i[0]),Number(i[1])))},t.Events.CommentMove.prototype.isNull=function(){return t.utils.Coordinate.equals(this.oldCoordinate_,this.newCoordinate_)},t.Events.CommentMove.prototype.run=function(e){var i=this.getEventWorkspace_().getCommentById(this.commentId);if(i){e=e?this.newCoordinate_:this.oldCoordinate_;var s=i.getXY();i.moveBy(e.x-s.x,e.y-s.y)}else console.warn("Can't move non-existent comment: "+this.commentId)},t.registry.register(t.registry.Type.EVENT,t.Events.COMMENT_CREATE,t.Events.CommentCreate),t.registry.register(t.registry.Type.EVENT,t.Events.COMMENT_CHANGE,t.Events.CommentChange),t.registry.register(t.registry.Type.EVENT,t.Events.COMMENT_MOVE,t.Events.CommentMove),t.registry.register(t.registry.Type.EVENT,t.Events.COMMENT_DELETE,t.Events.CommentDelete),t.BubbleDragger=function(e,i){this.draggingBubble_=e,this.workspace_=i,this.deleteArea_=null,this.wouldDeleteBubble_=!1,this.startXY_=this.draggingBubble_.getRelativeToSurfaceXY(),this.dragSurface_=t.utils.is3dSupported()&&i.getBlockDragSurface()?i.getBlockDragSurface():null},t.BubbleDragger.prototype.dispose=function(){this.dragSurface_=this.workspace_=this.draggingBubble_=null},t.BubbleDragger.prototype.startBubbleDrag=function(){t.Events.getGroup()||t.Events.setGroup(!0),this.workspace_.setResizesEnabled(!1),this.draggingBubble_.setAutoLayout(!1),this.dragSurface_&&this.moveToDragSurface_(),this.draggingBubble_.setDragging&&this.draggingBubble_.setDragging(!0);var e=this.workspace_.getToolbox();if(e&&typeof e.addStyle=="function"){var i=this.draggingBubble_.isDeletable()?"blocklyToolboxDelete":"blocklyToolboxGrab";e.addStyle(i)}},t.BubbleDragger.prototype.dragBubble=function(e,i){i=this.pixelsToWorkspaceUnits_(i),i=t.utils.Coordinate.sum(this.startXY_,i),this.draggingBubble_.moveDuringDrag(this.dragSurface_,i),this.draggingBubble_.isDeletable()&&(this.deleteArea_=this.workspace_.isDeleteArea(e),this.updateCursorDuringBubbleDrag_())},t.BubbleDragger.prototype.maybeDeleteBubble_=function(){var e=this.workspace_.trashcan;return this.wouldDeleteBubble_?(e&&setTimeout(e.closeLid.bind(e),100),this.fireMoveEvent_(),this.draggingBubble_.dispose(!1,!0)):e&&e.closeLid(),this.wouldDeleteBubble_},t.BubbleDragger.prototype.updateCursorDuringBubbleDrag_=function(){this.wouldDeleteBubble_=this.deleteArea_!=t.DELETE_AREA_NONE;var e=this.workspace_.trashcan;this.wouldDeleteBubble_?(this.draggingBubble_.setDeleteStyle(!0),this.deleteArea_==t.DELETE_AREA_TRASH&&e&&e.setLidOpen(!0)):(this.draggingBubble_.setDeleteStyle(!1),e&&e.setLidOpen(!1))},t.BubbleDragger.prototype.endBubbleDrag=function(e,i){this.dragBubble(e,i),e=this.pixelsToWorkspaceUnits_(i),e=t.utils.Coordinate.sum(this.startXY_,e),this.draggingBubble_.moveTo(e.x,e.y),this.maybeDeleteBubble_()||(this.dragSurface_&&this.dragSurface_.clearAndHide(this.workspace_.getBubbleCanvas()),this.draggingBubble_.setDragging&&this.draggingBubble_.setDragging(!1),this.fireMoveEvent_()),this.workspace_.setResizesEnabled(!0),(e=this.workspace_.getToolbox())&&typeof e.removeStyle=="function"&&(i=this.draggingBubble_.isDeletable()?"blocklyToolboxDelete":"blocklyToolboxGrab",e.removeStyle(i)),t.Events.setGroup(!1)},t.BubbleDragger.prototype.fireMoveEvent_=function(){if(this.draggingBubble_.isComment){var e=new(t.Events.get(t.Events.COMMENT_MOVE))(this.draggingBubble_);e.setOldCoordinate(this.startXY_),e.recordNew(),t.Events.fire(e)}},t.BubbleDragger.prototype.pixelsToWorkspaceUnits_=function(e){return e=new t.utils.Coordinate(e.x/this.workspace_.scale,e.y/this.workspace_.scale),this.workspace_.isMutator&&e.scale(1/this.workspace_.options.parentWorkspace.scale),e},t.BubbleDragger.prototype.moveToDragSurface_=function(){this.draggingBubble_.moveTo(0,0),this.dragSurface_.translateSurface(this.startXY_.x,this.startXY_.y),this.dragSurface_.setBlocksAndShow(this.draggingBubble_.getSvgRoot())},t.Events.Click=function(e,i,s){t.Events.Click.superClass_.constructor.call(this,e?e.workspace.id:i),this.blockId=e?e.id:null,this.targetType=s},t.utils.object.inherits(t.Events.Click,t.Events.UiBase),t.Events.Click.prototype.type=t.Events.CLICK,t.Events.Click.prototype.toJson=function(){var e=t.Events.Click.superClass_.toJson.call(this);return e.targetType=this.targetType,this.blockId&&(e.blockId=this.blockId),e},t.Events.Click.prototype.fromJson=function(e){t.Events.Click.superClass_.fromJson.call(this,e),this.targetType=e.targetType,this.blockId=e.blockId},t.registry.register(t.registry.Type.EVENT,t.Events.CLICK,t.Events.Click),t.WorkspaceDragger=function(e){this.workspace_=e,this.horizontalScrollEnabled_=this.workspace_.isMovableHorizontally(),this.verticalScrollEnabled_=this.workspace_.isMovableVertically(),this.startScrollXY_=new t.utils.Coordinate(e.scrollX,e.scrollY)},t.WorkspaceDragger.prototype.dispose=function(){this.workspace_=null},t.WorkspaceDragger.prototype.startDrag=function(){t.selected&&t.selected.unselect(),this.workspace_.setupDragSurface()},t.WorkspaceDragger.prototype.endDrag=function(e){this.drag(e),this.workspace_.resetDragSurface()},t.WorkspaceDragger.prototype.drag=function(e){if(e=t.utils.Coordinate.sum(this.startScrollXY_,e),this.horizontalScrollEnabled_&&this.verticalScrollEnabled_)this.workspace_.scroll(e.x,e.y);else if(this.horizontalScrollEnabled_)this.workspace_.scroll(e.x,this.workspace_.scrollY);else if(this.verticalScrollEnabled_)this.workspace_.scroll(this.workspace_.scrollX,e.y);else throw new TypeError("Invalid state.")},t.Gesture=function(e,i){this.mouseDownXY_=null,this.currentDragDeltaXY_=new t.utils.Coordinate(0,0),this.startWorkspace_=this.targetBlock_=this.startBlock_=this.startField_=this.startBubble_=null,this.creatorWorkspace_=i,this.isDraggingBubble_=this.isDraggingBlock_=this.isDraggingWorkspace_=this.hasExceededDragRadius_=!1,this.mostRecentEvent_=e,this.flyout_=this.workspaceDragger_=this.blockDragger_=this.bubbleDragger_=this.onUpWrapper_=this.onMoveWrapper_=null,this.isEnding_=this.hasStarted_=this.calledUpdateIsDragging_=!1,this.healStack_=!t.DRAG_STACK},t.Gesture.prototype.dispose=function(){t.Touch.clearTouchIdentifier(),t.Tooltip.unblock(),this.creatorWorkspace_.clearGesture(),this.onMoveWrapper_&&t.browserEvents.unbind(this.onMoveWrapper_),this.onUpWrapper_&&t.browserEvents.unbind(this.onUpWrapper_),this.blockDragger_&&this.blockDragger_.dispose(),this.workspaceDragger_&&this.workspaceDragger_.dispose(),this.bubbleDragger_&&this.bubbleDragger_.dispose()},t.Gesture.prototype.updateFromEvent_=function(e){var i=new t.utils.Coordinate(e.clientX,e.clientY);this.updateDragDelta_(i)&&(this.updateIsDragging_(),t.longStop_()),this.mostRecentEvent_=e},t.Gesture.prototype.updateDragDelta_=function(e){return this.currentDragDeltaXY_=t.utils.Coordinate.difference(e,this.mouseDownXY_),this.hasExceededDragRadius_?!1:this.hasExceededDragRadius_=t.utils.Coordinate.magnitude(this.currentDragDeltaXY_)>(this.flyout_?t.FLYOUT_DRAG_RADIUS:t.DRAG_RADIUS)},t.Gesture.prototype.updateIsDraggingFromFlyout_=function(){return this.targetBlock_&&this.flyout_.isBlockCreatable_(this.targetBlock_)&&(!this.flyout_.isScrollable()||this.flyout_.isDragTowardWorkspace(this.currentDragDeltaXY_))?(this.startWorkspace_=this.flyout_.targetWorkspace,this.startWorkspace_.updateScreenCalculationsIfScrolled(),t.Events.getGroup()||t.Events.setGroup(!0),this.startBlock_=null,this.targetBlock_=this.flyout_.createBlock(this.targetBlock_),this.targetBlock_.select(),!0):!1},t.Gesture.prototype.updateIsDraggingBubble_=function(){return this.startBubble_?(this.isDraggingBubble_=!0,this.startDraggingBubble_(),!0):!1},t.Gesture.prototype.updateIsDraggingBlock_=function(){return this.targetBlock_?(this.flyout_?this.isDraggingBlock_=this.updateIsDraggingFromFlyout_():this.targetBlock_.isMovable()&&(this.isDraggingBlock_=!0),this.isDraggingBlock_?(this.startDraggingBlock_(),!0):!1):!1},t.Gesture.prototype.updateIsDraggingWorkspace_=function(){(this.flyout_?this.flyout_.isScrollable():this.startWorkspace_&&this.startWorkspace_.isDraggable())&&(this.workspaceDragger_=new t.WorkspaceDragger(this.startWorkspace_),this.isDraggingWorkspace_=!0,this.workspaceDragger_.startDrag())},t.Gesture.prototype.updateIsDragging_=function(){if(this.calledUpdateIsDragging_)throw Error("updateIsDragging_ should only be called once per gesture.");this.calledUpdateIsDragging_=!0,this.updateIsDraggingBubble_()||this.updateIsDraggingBlock_()||this.updateIsDraggingWorkspace_()},t.Gesture.prototype.startDraggingBlock_=function(){this.blockDragger_=new t.BlockDragger(this.targetBlock_,this.startWorkspace_),this.blockDragger_.startBlockDrag(this.currentDragDeltaXY_,this.healStack_),this.blockDragger_.dragBlock(this.mostRecentEvent_,this.currentDragDeltaXY_)},t.Gesture.prototype.startDraggingBubble_=function(){this.bubbleDragger_=new t.BubbleDragger(this.startBubble_,this.startWorkspace_),this.bubbleDragger_.startBubbleDrag(),this.bubbleDragger_.dragBubble(this.mostRecentEvent_,this.currentDragDeltaXY_)},t.Gesture.prototype.doStart=function(e){t.utils.isTargetInput(e)?this.cancel():(this.hasStarted_=!0,t.blockAnimations.disconnectUiStop(),this.startWorkspace_.updateScreenCalculationsIfScrolled(),this.startWorkspace_.isMutator&&this.startWorkspace_.resize(),t.hideChaff(!!this.flyout_),this.startWorkspace_.markFocused(),this.mostRecentEvent_=e,t.Tooltip.block(),this.targetBlock_&&this.targetBlock_.select(),t.utils.isRightButton(e)?this.handleRightClick(e):(e.type.toLowerCase()!="touchstart"&&e.type.toLowerCase()!="pointerdown"||e.pointerType=="mouse"||t.longStart(e,this),this.mouseDownXY_=new t.utils.Coordinate(e.clientX,e.clientY),this.healStack_=e.altKey||e.ctrlKey||e.metaKey,this.bindMouseEvents(e)))},t.Gesture.prototype.bindMouseEvents=function(e){this.onMoveWrapper_=t.browserEvents.conditionalBind(document,"mousemove",null,this.handleMove.bind(this)),this.onUpWrapper_=t.browserEvents.conditionalBind(document,"mouseup",null,this.handleUp.bind(this)),e.preventDefault(),e.stopPropagation()},t.Gesture.prototype.handleMove=function(e){this.updateFromEvent_(e),this.isDraggingWorkspace_?this.workspaceDragger_.drag(this.currentDragDeltaXY_):this.isDraggingBlock_?this.blockDragger_.dragBlock(this.mostRecentEvent_,this.currentDragDeltaXY_):this.isDraggingBubble_&&this.bubbleDragger_.dragBubble(this.mostRecentEvent_,this.currentDragDeltaXY_),e.preventDefault(),e.stopPropagation()},t.Gesture.prototype.handleUp=function(e){this.updateFromEvent_(e),t.longStop_(),this.isEnding_?console.log("Trying to end a gesture recursively."):(this.isEnding_=!0,this.isDraggingBubble_?this.bubbleDragger_.endBubbleDrag(e,this.currentDragDeltaXY_):this.isDraggingBlock_?this.blockDragger_.endBlockDrag(e,this.currentDragDeltaXY_):this.isDraggingWorkspace_?this.workspaceDragger_.endDrag(this.currentDragDeltaXY_):this.isBubbleClick_()?this.doBubbleClick_():this.isFieldClick_()?this.doFieldClick_():this.isBlockClick_()?this.doBlockClick_():this.isWorkspaceClick_()&&this.doWorkspaceClick_(e),e.preventDefault(),e.stopPropagation(),this.dispose())},t.Gesture.prototype.cancel=function(){this.isEnding_||(t.longStop_(),this.isDraggingBubble_?this.bubbleDragger_.endBubbleDrag(this.mostRecentEvent_,this.currentDragDeltaXY_):this.isDraggingBlock_?this.blockDragger_.endBlockDrag(this.mostRecentEvent_,this.currentDragDeltaXY_):this.isDraggingWorkspace_&&this.workspaceDragger_.endDrag(this.currentDragDeltaXY_),this.dispose())},t.Gesture.prototype.handleRightClick=function(e){this.targetBlock_?(this.bringBlockToFront_(),t.hideChaff(!!this.flyout_),this.targetBlock_.showContextMenu(e)):this.startBubble_?this.startBubble_.showContextMenu(e):this.startWorkspace_&&!this.flyout_&&(t.hideChaff(),this.startWorkspace_.showContextMenu(e)),e.preventDefault(),e.stopPropagation(),this.dispose()},t.Gesture.prototype.handleWsStart=function(e,i){if(this.hasStarted_)throw Error("Tried to call gesture.handleWsStart, but the gesture had already been started.");this.setStartWorkspace_(i),this.mostRecentEvent_=e,this.doStart(e)},t.Gesture.prototype.fireWorkspaceClick_=function(e){t.Events.fire(new(t.Events.get(t.Events.CLICK))(null,e.id,"workspace"))},t.Gesture.prototype.handleFlyoutStart=function(e,i){if(this.hasStarted_)throw Error("Tried to call gesture.handleFlyoutStart, but the gesture had already been started.");this.setStartFlyout_(i),this.handleWsStart(e,i.getWorkspace())},t.Gesture.prototype.handleBlockStart=function(e,i){if(this.hasStarted_)throw Error("Tried to call gesture.handleBlockStart, but the gesture had already been started.");this.setStartBlock(i),this.mostRecentEvent_=e},t.Gesture.prototype.handleBubbleStart=function(e,i){if(this.hasStarted_)throw Error("Tried to call gesture.handleBubbleStart, but the gesture had already been started.");this.setStartBubble(i),this.mostRecentEvent_=e},t.Gesture.prototype.doBubbleClick_=function(){this.startBubble_.setFocus&&this.startBubble_.setFocus(),this.startBubble_.select&&this.startBubble_.select()},t.Gesture.prototype.doFieldClick_=function(){this.startField_.showEditor(this.mostRecentEvent_),this.bringBlockToFront_()},t.Gesture.prototype.doBlockClick_=function(){if(this.flyout_&&this.flyout_.autoClose)this.targetBlock_.isEnabled()&&(t.Events.getGroup()||t.Events.setGroup(!0),this.flyout_.createBlock(this.targetBlock_).scheduleSnapAndBump());else{var e=new(t.Events.get(t.Events.CLICK))(this.startBlock_,this.startWorkspace_.id,"block");t.Events.fire(e)}this.bringBlockToFront_(),t.Events.setGroup(!1)},t.Gesture.prototype.doWorkspaceClick_=function(e){e=this.creatorWorkspace_,t.selected&&t.selected.unselect(),this.fireWorkspaceClick_(this.startWorkspace_||e)},t.Gesture.prototype.bringBlockToFront_=function(){this.targetBlock_&&!this.flyout_&&this.targetBlock_.bringToFront()},t.Gesture.prototype.setStartField=function(e){if(this.hasStarted_)throw Error("Tried to call gesture.setStartField, but the gesture had already been started.");this.startField_||(this.startField_=e)},t.Gesture.prototype.setStartBubble=function(e){this.startBubble_||(this.startBubble_=e)},t.Gesture.prototype.setStartBlock=function(e){this.startBlock_||this.startBubble_||(this.startBlock_=e,e.isInFlyout&&e!=e.getRootBlock()?this.setTargetBlock_(e.getRootBlock()):this.setTargetBlock_(e))},t.Gesture.prototype.setTargetBlock_=function(e){e.isShadow()?this.setTargetBlock_(e.getParent()):this.targetBlock_=e},t.Gesture.prototype.setStartWorkspace_=function(e){this.startWorkspace_||(this.startWorkspace_=e)},t.Gesture.prototype.setStartFlyout_=function(e){this.flyout_||(this.flyout_=e)},t.Gesture.prototype.isBubbleClick_=function(){return!!this.startBubble_&&!this.hasExceededDragRadius_},t.Gesture.prototype.isBlockClick_=function(){return!!this.startBlock_&&!this.hasExceededDragRadius_&&!this.isFieldClick_()},t.Gesture.prototype.isFieldClick_=function(){return(this.startField_?this.startField_.isClickable():!1)&&!this.hasExceededDragRadius_&&(!this.flyout_||!this.flyout_.autoClose)},t.Gesture.prototype.isWorkspaceClick_=function(){return!this.startBlock_&&!this.startBubble_&&!this.startField_&&!this.hasExceededDragRadius_},t.Gesture.prototype.isDragging=function(){return this.isDraggingWorkspace_||this.isDraggingBlock_||this.isDraggingBubble_},t.Gesture.prototype.hasStarted=function(){return this.hasStarted_},t.Gesture.prototype.getInsertionMarkers=function(){return this.blockDragger_?this.blockDragger_.getInsertionMarkers():[]},t.Gesture.inProgress=function(){for(var e=t.Workspace.getAll(),i=0,s;s=e[i];i++)if(s.currentGesture_)return!0;return!1},t.Field=function(e,i,s){this.value_=this.DEFAULT_VALUE,this.tooltip_=this.validator_=null,this.size_=new t.utils.Size(0,0),this.constants_=this.mouseDownWrapper_=this.textContent_=this.textElement_=this.borderRect_=this.fieldGroup_=this.markerSvg_=this.cursorSvg_=null,s&&this.configure_(s),this.setValue(e),i&&this.setValidator(i)},t.Field.prototype.DEFAULT_VALUE=null,t.Field.prototype.name=void 0,t.Field.prototype.disposed=!1,t.Field.prototype.maxDisplayLength=50,t.Field.prototype.sourceBlock_=null,t.Field.prototype.isDirty_=!0,t.Field.prototype.visible_=!0,t.Field.prototype.clickTarget_=null,t.Field.NBSP="",t.Field.prototype.EDITABLE=!0,t.Field.prototype.SERIALIZABLE=!1,t.Field.prototype.configure_=function(e){var i=e.tooltip;typeof i=="string"&&(i=t.utils.replaceMessageReferences(e.tooltip)),i&&this.setTooltip(i)},t.Field.prototype.setSourceBlock=function(e){if(this.sourceBlock_)throw Error("Field already bound to a block.");this.sourceBlock_=e},t.Field.prototype.getConstants=function(){return!this.constants_&&this.sourceBlock_&&this.sourceBlock_.workspace&&this.sourceBlock_.workspace.rendered&&(this.constants_=this.sourceBlock_.workspace.getRenderer().getConstants()),this.constants_},t.Field.prototype.getSourceBlock=function(){return this.sourceBlock_},t.Field.prototype.init=function(){this.fieldGroup_||(this.fieldGroup_=t.utils.dom.createSvgElement(t.utils.Svg.G,{},null),this.isVisible()||(this.fieldGroup_.style.display="none"),this.sourceBlock_.getSvgRoot().appendChild(this.fieldGroup_),this.initView(),this.updateEditable(),this.setTooltip(this.tooltip_),this.bindEvents_(),this.initModel())},t.Field.prototype.initView=function(){this.createBorderRect_(),this.createTextElement_()},t.Field.prototype.initModel=function(){},t.Field.prototype.createBorderRect_=function(){this.borderRect_=t.utils.dom.createSvgElement(t.utils.Svg.RECT,{rx:this.getConstants().FIELD_BORDER_RECT_RADIUS,ry:this.getConstants().FIELD_BORDER_RECT_RADIUS,x:0,y:0,height:this.size_.height,width:this.size_.width,class:"blocklyFieldRect"},this.fieldGroup_)},t.Field.prototype.createTextElement_=function(){this.textElement_=t.utils.dom.createSvgElement(t.utils.Svg.TEXT,{class:"blocklyText"},this.fieldGroup_),this.getConstants().FIELD_TEXT_BASELINE_CENTER&&this.textElement_.setAttribute("dominant-baseline","central"),this.textContent_=document.createTextNode(""),this.textElement_.appendChild(this.textContent_)},t.Field.prototype.bindEvents_=function(){t.Tooltip.bindMouseEvents(this.getClickTarget_()),this.mouseDownWrapper_=t.browserEvents.conditionalBind(this.getClickTarget_(),"mousedown",this,this.onMouseDown_)},t.Field.prototype.fromXml=function(e){this.setValue(e.textContent)},t.Field.prototype.toXml=function(e){return e.textContent=this.getValue(),e},t.Field.prototype.dispose=function(){t.DropDownDiv.hideIfOwner(this),t.WidgetDiv.hideIfOwner(this),t.Tooltip.unbindMouseEvents(this.getClickTarget_()),this.mouseDownWrapper_&&t.browserEvents.unbind(this.mouseDownWrapper_),t.utils.dom.removeNode(this.fieldGroup_),this.disposed=!0},t.Field.prototype.updateEditable=function(){var e=this.fieldGroup_;this.EDITABLE&&e&&(this.sourceBlock_.isEditable()?(t.utils.dom.addClass(e,"blocklyEditableText"),t.utils.dom.removeClass(e,"blocklyNonEditableText"),e.style.cursor=this.CURSOR):(t.utils.dom.addClass(e,"blocklyNonEditableText"),t.utils.dom.removeClass(e,"blocklyEditableText"),e.style.cursor=""))},t.Field.prototype.isClickable=function(){return!!this.sourceBlock_&&this.sourceBlock_.isEditable()&&!!this.showEditor_&&typeof this.showEditor_=="function"},t.Field.prototype.isCurrentlyEditable=function(){return this.EDITABLE&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()},t.Field.prototype.isSerializable=function(){var e=!1;return this.name&&(this.SERIALIZABLE?e=!0:this.EDITABLE&&(console.warn("Detected an editable field that was not serializable. Please define SERIALIZABLE property as true on all editable custom fields. Proceeding with serialization."),e=!0)),e},t.Field.prototype.isVisible=function(){return this.visible_},t.Field.prototype.setVisible=function(e){if(this.visible_!=e){this.visible_=e;var i=this.getSvgRoot();i&&(i.style.display=e?"block":"none")}},t.Field.prototype.setValidator=function(e){this.validator_=e},t.Field.prototype.getValidator=function(){return this.validator_},t.Field.prototype.getSvgRoot=function(){return this.fieldGroup_},t.Field.prototype.applyColour=function(){},t.Field.prototype.render_=function(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_()),this.updateSize_()},t.Field.prototype.showEditor=function(e){this.isClickable()&&this.showEditor_(e)},t.Field.prototype.updateSize_=function(e){var i=this.getConstants();e=e??(this.borderRect_?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0);var s=2*e,r=i.FIELD_TEXT_HEIGHT,o=0;this.textElement_&&(o=t.utils.dom.getFastTextWidth(this.textElement_,i.FIELD_TEXT_FONTSIZE,i.FIELD_TEXT_FONTWEIGHT,i.FIELD_TEXT_FONTFAMILY),s+=o),this.borderRect_&&(r=Math.max(r,i.FIELD_BORDER_RECT_HEIGHT)),this.size_.height=r,this.size_.width=s,this.positionTextElement_(e,o),this.positionBorderRect_()},t.Field.prototype.positionTextElement_=function(e,i){if(this.textElement_){var s=this.getConstants(),r=this.size_.height/2;this.textElement_.setAttribute("x",this.sourceBlock_.RTL?this.size_.width-i-e:e),this.textElement_.setAttribute("y",s.FIELD_TEXT_BASELINE_CENTER?r:r-s.FIELD_TEXT_HEIGHT/2+s.FIELD_TEXT_BASELINE)}},t.Field.prototype.positionBorderRect_=function(){this.borderRect_&&(this.borderRect_.setAttribute("width",this.size_.width),this.borderRect_.setAttribute("height",this.size_.height),this.borderRect_.setAttribute("rx",this.getConstants().FIELD_BORDER_RECT_RADIUS),this.borderRect_.setAttribute("ry",this.getConstants().FIELD_BORDER_RECT_RADIUS))},t.Field.prototype.getSize=function(){return this.isVisible()?(this.isDirty_?(this.render_(),this.isDirty_=!1):this.visible_&&this.size_.width==0&&(console.warn("Deprecated use of setting size_.width to 0 to rerender a field. Set field.isDirty_ to true instead."),this.render_()),this.size_):new t.utils.Size(0,0)},t.Field.prototype.getScaledBBox=function(){if(this.borderRect_)e=this.borderRect_.getBoundingClientRect(),s=t.utils.style.getPageOffset(this.borderRect_),r=e.width,e=e.height;else{var e=this.sourceBlock_.getHeightWidth(),i=this.sourceBlock_.workspace.scale,s=this.getAbsoluteXY_(),r=e.width*i;e=e.height*i,t.utils.userAgent.GECKO?(s.x+=1.5*i,s.y+=1.5*i):t.utils.userAgent.EDGE||t.utils.userAgent.IE||(s.x-=.5*i,s.y-=.5*i),r+=1*i,e+=1*i}return new t.utils.Rect(s.y,s.y+e,s.x,s.x+r)},t.Field.prototype.getDisplayText_=function(){var e=this.getText();return e?(e.length>this.maxDisplayLength&&(e=e.substring(0,this.maxDisplayLength-2)+""),e=e.replace(/\s/g,t.Field.NBSP),this.sourceBlock_&&this.sourceBlock_.RTL&&(e+=""),e):t.Field.NBSP},t.Field.prototype.getText=function(){if(this.getText_){var e=this.getText_.call(this);if(e!==null)return String(e)}return String(this.getValue())},t.Field.prototype.markDirty=function(){this.isDirty_=!0,this.constants_=null},t.Field.prototype.forceRerender=function(){this.isDirty_=!0,this.sourceBlock_&&this.sourceBlock_.rendered&&(this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours(),this.updateMarkers_())},t.Field.prototype.setValue=function(e){if(e!==null){var i=this.doClassValidation_(e);if(e=this.processValidation_(e,i),!(e instanceof Error)){if((i=this.getValidator())&&(i=i.call(this,e),e=this.processValidation_(e,i),e instanceof Error))return;if(i=this.sourceBlock_,!i||!i.disposed){var s=this.getValue();s===e?this.doValueUpdate_(e):(i&&t.Events.isEnabled()&&t.Events.fire(new(t.Events.get(t.Events.BLOCK_CHANGE))(i,"field",this.name||null,s,e)),this.doValueUpdate_(e),this.isDirty_&&this.forceRerender())}}}},t.Field.prototype.processValidation_=function(e,i){return i===null?(this.doValueInvalid_(e),this.isDirty_&&this.forceRerender(),Error()):(i!==void 0&&(e=i),e)},t.Field.prototype.getValue=function(){return this.value_},t.Field.prototype.doClassValidation_=function(e){return e??null},t.Field.prototype.doValueUpdate_=function(e){this.value_=e,this.isDirty_=!0},t.Field.prototype.doValueInvalid_=function(e){},t.Field.prototype.onMouseDown_=function(e){this.sourceBlock_&&this.sourceBlock_.workspace&&(e=this.sourceBlock_.workspace.getGesture(e))&&e.setStartField(this)},t.Field.prototype.setTooltip=function(e){e||e===""||(e=this.sourceBlock_);var i=this.getClickTarget_();i?i.tooltip=e:this.tooltip_=e},t.Field.prototype.getTooltip=function(){var e=this.getClickTarget_();return e?t.Tooltip.getTooltipOfObject(e):t.Tooltip.getTooltipOfObject({tooltip:this.tooltip_})},t.Field.prototype.getClickTarget_=function(){return this.clickTarget_||this.getSvgRoot()},t.Field.prototype.getAbsoluteXY_=function(){return t.utils.style.getPageOffset(this.getClickTarget_())},t.Field.prototype.referencesVariables=function(){return!1},t.Field.prototype.getParentInput=function(){for(var e=null,i=this.sourceBlock_,s=i.inputList,r=0;r<i.inputList.length;r++)for(var o=s[r],h=o.fieldRow,u=0;u<h.length;u++)if(h[u]===this){e=o;break}return e},t.Field.prototype.getFlipRtl=function(){return!1},t.Field.prototype.isTabNavigable=function(){return!1},t.Field.prototype.onShortcut=function(e){return!1},t.Field.prototype.setCursorSvg=function(e){e?(this.fieldGroup_.appendChild(e),this.cursorSvg_=e):this.cursorSvg_=null},t.Field.prototype.setMarkerSvg=function(e){e?(this.fieldGroup_.appendChild(e),this.markerSvg_=e):this.markerSvg_=null},t.Field.prototype.updateMarkers_=function(){var e=this.sourceBlock_.workspace;e.keyboardAccessibilityMode&&this.cursorSvg_&&e.getCursor().draw(),e.keyboardAccessibilityMode&&this.markerSvg_&&e.getMarker(t.MarkerManager.LOCAL_MARKER).draw()},t.FieldLabel=function(e,i,s){this.class_=null,t.FieldLabel.superClass_.constructor.call(this,e,null,s),s||(this.class_=i||null)},t.utils.object.inherits(t.FieldLabel,t.Field),t.FieldLabel.prototype.DEFAULT_VALUE="",t.FieldLabel.fromJson=function(e){var i=t.utils.replaceMessageReferences(e.text);return new t.FieldLabel(i,void 0,e)},t.FieldLabel.prototype.EDITABLE=!1,t.FieldLabel.prototype.configure_=function(e){t.FieldLabel.superClass_.configure_.call(this,e),this.class_=e.class},t.FieldLabel.prototype.initView=function(){this.createTextElement_(),this.class_&&t.utils.dom.addClass(this.textElement_,this.class_)},t.FieldLabel.prototype.doClassValidation_=function(e){return e==null?null:String(e)},t.FieldLabel.prototype.setClass=function(e){this.textElement_&&(this.class_&&t.utils.dom.removeClass(this.textElement_,this.class_),e&&t.utils.dom.addClass(this.textElement_,e)),this.class_=e},t.fieldRegistry.register("field_label",t.FieldLabel),t.Input=function(e,i,s,r){if(e!=t.inputTypes.DUMMY&&!i)throw Error("Value inputs and statement inputs must have non-empty name.");this.type=e,this.name=i,this.sourceBlock_=s,this.connection=r,this.fieldRow=[]},t.Input.prototype.align=t.constants.ALIGN.LEFT,t.Input.prototype.visible_=!0,t.Input.prototype.getSourceBlock=function(){return this.sourceBlock_},t.Input.prototype.appendField=function(e,i){return this.insertFieldAt(this.fieldRow.length,e,i),this},t.Input.prototype.insertFieldAt=function(e,i,s){if(0>e||e>this.fieldRow.length)throw Error("index "+e+" out of bounds.");return(i||i==""&&s)&&(typeof i=="string"&&(i=t.fieldRegistry.fromJson({type:"field_label",text:i})),i.setSourceBlock(this.sourceBlock_),this.sourceBlock_.rendered&&(i.init(),i.applyColour()),i.name=s,i.setVisible(this.isVisible()),i.prefixField&&(e=this.insertFieldAt(e,i.prefixField)),this.fieldRow.splice(e,0,i),++e,i.suffixField&&(e=this.insertFieldAt(e,i.suffixField)),this.sourceBlock_.rendered&&(this.sourceBlock_=this.sourceBlock_,this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours())),e},t.Input.prototype.removeField=function(e,i){for(var s=0,r;r=this.fieldRow[s];s++)if(r.name===e)return r.dispose(),this.fieldRow.splice(s,1),this.sourceBlock_.rendered&&(this.sourceBlock_=this.sourceBlock_,this.sourceBlock_.render(),this.sourceBlock_.bumpNeighbours()),!0;if(i)return!1;throw Error('Field "'+e+'" not found.')},t.Input.prototype.isVisible=function(){return this.visible_},t.Input.prototype.setVisible=function(e){var i=[];if(this.visible_==e)return i;this.visible_=e;for(var s=0,r;r=this.fieldRow[s];s++)r.setVisible(e);return this.connection&&(this.connection=this.connection,e?i=this.connection.startTrackingAll():this.connection.stopTrackingAll(),s=this.connection.targetBlock())&&(s.getSvgRoot().style.display=e?"block":"none"),i},t.Input.prototype.markDirty=function(){for(var e=0,i;i=this.fieldRow[e];e++)i.markDirty()},t.Input.prototype.setCheck=function(e){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.setCheck(e),this},t.Input.prototype.setAlign=function(e){return this.align=e,this.sourceBlock_.rendered&&(this.sourceBlock_=this.sourceBlock_,this.sourceBlock_.render()),this},t.Input.prototype.setShadowDom=function(e){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.setShadowDom(e),this},t.Input.prototype.getShadowDom=function(){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.getShadowDom()},t.Input.prototype.init=function(){if(this.sourceBlock_.workspace.rendered)for(var e=0;e<this.fieldRow.length;e++)this.fieldRow[e].init()},t.Input.prototype.dispose=function(){for(var e=0,i;i=this.fieldRow[e];e++)i.dispose();this.connection&&this.connection.dispose(),this.sourceBlock_=null},t.Block=function(e,i,s){if(t.Generator&&typeof t.Generator.prototype[i]<"u")throw Error('Block prototypeName "'+i+'" conflicts with Blockly.Generator members.');if(this.id=s&&!e.getBlockById(s)?s:t.utils.genUid(),e.setBlockById(this.id,this),this.previousConnection=this.nextConnection=this.outputConnection=null,this.inputList=[],this.inputsInline=void 0,this.disabled=!1,this.tooltip="",this.contextMenu=!0,this.parentBlock_=null,this.childBlocks_=[],this.editable_=this.movable_=this.deletable_=!0,this.collapsed_=this.isShadow_=!1,this.comment=this.outputShape_=null,this.commentModel={text:null,pinned:!1,size:new t.utils.Size(160,80)},this.xy_=new t.utils.Coordinate(0,0),this.workspace=e,this.isInFlyout=e.isFlyout,this.isInMutator=e.isMutator,this.RTL=e.RTL,this.isInsertionMarker_=!1,this.hat=void 0,this.rendered=null,this.statementInputCount=0,i){if(this.type=i,s=t.Blocks[i],!s||typeof s!="object")throw TypeError("Unknown block type: "+i);t.utils.object.mixin(this,s)}e.addTopBlock(this),e.addTypedBlock(this),(e=t.Events.getGroup())||t.Events.setGroup(!0),i=t.Events.recordUndo;try{typeof this.init=="function"&&(t.Events.recordUndo=!1,this.init(),t.Events.recordUndo=i),t.Events.isEnabled()&&t.Events.fire(new(t.Events.get(t.Events.BLOCK_CREATE))(this))}finally{e||t.Events.setGroup(!1),t.Events.recordUndo=i}this.inputsInlineDefault=this.inputsInline,typeof this.onchange=="function"&&this.setOnChange(this.onchange)},t.Block.COLLAPSED_INPUT_NAME=t.constants.COLLAPSED_INPUT_NAME,t.Block.COLLAPSED_FIELD_NAME=t.constants.COLLAPSED_FIELD_NAME,t.Block.prototype.data=null,t.Block.prototype.disposed=!1,t.Block.prototype.hue_=null,t.Block.prototype.colour_="#000000",t.Block.prototype.styleName_=null,t.Block.prototype.dispose=function(e){if(this.workspace){this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),this.unplug(e),t.Events.isEnabled()&&t.Events.fire(new(t.Events.get(t.Events.BLOCK_DELETE))(this)),t.Events.disable();try{this.workspace&&(this.workspace.removeTopBlock(this),this.workspace.removeTypedBlock(this),this.workspace.removeBlockById(this.id),this.workspace=null),t.selected==this&&(t.selected=null);for(var i=this.childBlocks_.length-1;0<=i;i--)this.childBlocks_[i].dispose(!1);i=0;for(var s;s=this.inputList[i];i++)s.dispose();this.inputList.length=0;var r=this.getConnections_(!0);i=0;for(var o;o=r[i];i++)o.dispose()}finally{t.Events.enable(),this.disposed=!0}}},t.Block.prototype.initModel=function(){for(var e=0,i;i=this.inputList[e];e++)for(var s=0,r;r=i.fieldRow[s];s++)r.initModel&&r.initModel()},t.Block.prototype.unplug=function(e){this.outputConnection?this.unplugFromRow_(e):this.previousConnection&&this.unplugFromStack_(e)},t.Block.prototype.unplugFromRow_=function(e){var i=null;this.outputConnection.isConnected()&&(i=this.outputConnection.targetConnection,this.outputConnection.disconnect()),i&&e&&(e=this.getOnlyValueConnection_())&&e.isConnected()&&!e.targetBlock().isShadow()&&(e=e.targetConnection,e.disconnect(),this.workspace.connectionChecker.canConnect(e,i,!1)?i.connect(e):e.onFailedConnect(i))},t.Block.prototype.getOnlyValueConnection_=function(){for(var e=null,i=0;i<this.inputList.length;i++){var s=this.inputList[i].connection;if(s&&s.type==t.connectionTypes.INPUT_VALUE&&s.targetConnection){if(e)return null;e=s}}return e},t.Block.prototype.unplugFromStack_=function(e){var i=null;this.previousConnection.isConnected()&&(i=this.previousConnection.targetConnection,this.previousConnection.disconnect());var s=this.getNextBlock();e&&s&&!s.isShadow()&&(e=this.nextConnection.targetConnection,e.disconnect(),i&&this.workspace.connectionChecker.canConnect(i,e,!1)&&i.connect(e))},t.Block.prototype.getConnections_=function(e){e=[],this.outputConnection&&e.push(this.outputConnection),this.previousConnection&&e.push(this.previousConnection),this.nextConnection&&e.push(this.nextConnection);for(var i=0,s;s=this.inputList[i];i++)s.connection&&e.push(s.connection);return e},t.Block.prototype.lastConnectionInStack=function(){for(var e=this.nextConnection;e;){var i=e.targetBlock();if(!i)return e;e=i.nextConnection}return null},t.Block.prototype.bumpNeighbours=function(){},t.Block.prototype.getParent=function(){return this.parentBlock_},t.Block.prototype.getInputWithBlock=function(e){for(var i=0,s;s=this.inputList[i];i++)if(s.connection&&s.connection.targetBlock()==e)return s;return null},t.Block.prototype.getSurroundParent=function(){var e=this;do{var i=e;if(e=e.getParent(),!e)return null}while(e.getNextBlock()==i);return e},t.Block.prototype.getNextBlock=function(){return this.nextConnection&&this.nextConnection.targetBlock()},t.Block.prototype.getPreviousBlock=function(){return this.previousConnection&&this.previousConnection.targetBlock()},t.Block.prototype.getFirstStatementConnection=function(){for(var e=0,i;i=this.inputList[e];e++)if(i.connection&&i.connection.type==t.connectionTypes.NEXT_STATEMENT)return i.connection;return null},t.Block.prototype.getRootBlock=function(){var e=this;do{var i=e;e=i.parentBlock_}while(e);return i},t.Block.prototype.getTopStackBlock=function(){var e=this;do var i=e.getPreviousBlock();while(i&&i.getNextBlock()==e&&(e=i));return e},t.Block.prototype.getChildren=function(e){if(!e)return this.childBlocks_;e=[];for(var i=0,s;s=this.inputList[i];i++)s.connection&&(s=s.connection.targetBlock())&&e.push(s);return(i=this.getNextBlock())&&e.push(i),e},t.Block.prototype.setParent=function(e){if(e!=this.parentBlock_){if(this.parentBlock_){if(t.utils.arrayRemove(this.parentBlock_.childBlocks_,this),this.previousConnection&&this.previousConnection.isConnected())throw Error("Still connected to previous block.");if(this.outputConnection&&this.outputConnection.isConnected())throw Error("Still connected to parent block.");this.parentBlock_=null}else this.workspace.removeTopBlock(this);(this.parentBlock_=e)?e.childBlocks_.push(this):this.workspace.addTopBlock(this)}},t.Block.prototype.getDescendants=function(e){for(var i=[this],s=this.getChildren(e),r,o=0;r=s[o];o++)i.push.apply(i,r.getDescendants(e));return i},t.Block.prototype.isDeletable=function(){return this.deletable_&&!this.isShadow_&&!(this.workspace&&this.workspace.options.readOnly)},t.Block.prototype.setDeletable=function(e){this.deletable_=e},t.Block.prototype.isMovable=function(){return this.movable_&&!this.isShadow_&&!(this.workspace&&this.workspace.options.readOnly)},t.Block.prototype.setMovable=function(e){this.movable_=e},t.Block.prototype.isDuplicatable=function(){return this.workspace.hasBlockLimits()?this.workspace.isCapacityAvailable(t.utils.getBlockTypeCounts(this,!0)):!0},t.Block.prototype.isShadow=function(){return this.isShadow_},t.Block.prototype.setShadow=function(e){this.isShadow_=e},t.Block.prototype.isInsertionMarker=function(){return this.isInsertionMarker_},t.Block.prototype.setInsertionMarker=function(e){this.isInsertionMarker_=e},t.Block.prototype.isEditable=function(){return this.editable_&&!(this.workspace&&this.workspace.options.readOnly)},t.Block.prototype.setEditable=function(e){this.editable_=e,e=0;for(var i;i=this.inputList[e];e++)for(var s=0,r;r=i.fieldRow[s];s++)r.updateEditable()},t.Block.prototype.isDisposed=function(){return this.disposed},t.Block.prototype.getMatchingConnection=function(e,i){var s=this.getConnections_(!0);if(e=e.getConnections_(!0),s.length!=e.length)throw Error("Connection lists did not match in length.");for(var r=0;r<e.length;r++)if(e[r]==i)return s[r];return null},t.Block.prototype.setHelpUrl=function(e){this.helpUrl=e},t.Block.prototype.setTooltip=function(e){this.tooltip=e},t.Block.prototype.getTooltip=function(){return t.Tooltip.getTooltipOfObject(this)},t.Block.prototype.getColour=function(){return this.colour_},t.Block.prototype.getStyleName=function(){return this.styleName_},t.Block.prototype.getHue=function(){return this.hue_},t.Block.prototype.setColour=function(e){e=t.utils.parseBlockColour(e),this.hue_=e.hue,this.colour_=e.hex},t.Block.prototype.setStyle=function(e){this.styleName_=e},t.Block.prototype.setOnChange=function(e){if(e&&typeof e!="function")throw Error("onchange must be a function.");this.onchangeWrapper_&&this.workspace.removeChangeListener(this.onchangeWrapper_),(this.onchange=e)&&(this.onchangeWrapper_=e.bind(this),this.workspace.addChangeListener(this.onchangeWrapper_))},t.Block.prototype.getField=function(e){for(var i=0,s;s=this.inputList[i];i++)for(var r=0,o;o=s.fieldRow[r];r++)if(o.name==e)return o;return null},t.Block.prototype.getVars=function(){for(var e=[],i=0,s;s=this.inputList[i];i++)for(var r=0,o;o=s.fieldRow[r];r++)o.referencesVariables()&&e.push(o.getValue());return e},t.Block.prototype.getVarModels=function(){for(var e=[],i=0,s;s=this.inputList[i];i++)for(var r=0,o;o=s.fieldRow[r];r++)o.referencesVariables()&&(o=this.workspace.getVariableById(o.getValue()))&&e.push(o);return e},t.Block.prototype.updateVarName=function(e){for(var i=0,s;s=this.inputList[i];i++)for(var r=0,o;o=s.fieldRow[r];r++)o.referencesVariables()&&e.getId()==o.getValue()&&o.refreshVariableName()},t.Block.prototype.renameVarById=function(e,i){for(var s=0,r;r=this.inputList[s];s++)for(var o=0,h;h=r.fieldRow[o];o++)h.referencesVariables()&&e==h.getValue()&&h.setValue(i)},t.Block.prototype.getFieldValue=function(e){return(e=this.getField(e))?e.getValue():null},t.Block.prototype.setFieldValue=function(e,i){var s=this.getField(i);if(!s)throw Error('Field "'+i+'" not found.');s.setValue(e)},t.Block.prototype.setPreviousStatement=function(e,i){if(e){if(i===void 0&&(i=null),!this.previousConnection){if(this.outputConnection)throw Error("Remove output connection prior to adding previous connection.");this.previousConnection=this.makeConnection_(t.connectionTypes.PREVIOUS_STATEMENT)}this.previousConnection.setCheck(i)}else if(this.previousConnection){if(this.previousConnection.isConnected())throw Error("Must disconnect previous statement before removing connection.");this.previousConnection.dispose(),this.previousConnection=null}},t.Block.prototype.setNextStatement=function(e,i){if(e)i===void 0&&(i=null),this.nextConnection||(this.nextConnection=this.makeConnection_(t.connectionTypes.NEXT_STATEMENT)),this.nextConnection.setCheck(i);else if(this.nextConnection){if(this.nextConnection.isConnected())throw Error("Must disconnect next statement before removing connection.");this.nextConnection.dispose(),this.nextConnection=null}},t.Block.prototype.setOutput=function(e,i){if(e){if(i===void 0&&(i=null),!this.outputConnection){if(this.previousConnection)throw Error("Remove previous connection prior to adding output connection.");this.outputConnection=this.makeConnection_(t.connectionTypes.OUTPUT_VALUE)}this.outputConnection.setCheck(i)}else if(this.outputConnection){if(this.outputConnection.isConnected())throw Error("Must disconnect output value before removing connection.");this.outputConnection.dispose(),this.outputConnection=null}},t.Block.prototype.setInputsInline=function(e){this.inputsInline!=e&&(t.Events.fire(new(t.Events.get(t.Events.BLOCK_CHANGE))(this,"inline",null,this.inputsInline,e)),this.inputsInline=e)},t.Block.prototype.getInputsInline=function(){if(this.inputsInline!=null)return this.inputsInline;for(var e=1;e<this.inputList.length;e++)if(this.inputList[e-1].type==t.inputTypes.DUMMY&&this.inputList[e].type==t.inputTypes.DUMMY)return!1;for(e=1;e<this.inputList.length;e++)if(this.inputList[e-1].type==t.inputTypes.VALUE&&this.inputList[e].type==t.inputTypes.DUMMY)return!0;return!1},t.Block.prototype.setOutputShape=function(e){this.outputShape_=e},t.Block.prototype.getOutputShape=function(){return this.outputShape_},t.Block.prototype.isEnabled=function(){return!this.disabled},t.Block.prototype.setEnabled=function(e){this.isEnabled()!=e&&(t.Events.fire(new(t.Events.get(t.Events.BLOCK_CHANGE))(this,"disabled",null,this.disabled,!e)),this.disabled=!e)},t.Block.prototype.getInheritedDisabled=function(){for(var e=this.getSurroundParent();e;){if(e.disabled)return!0;e=e.getSurroundParent()}return!1},t.Block.prototype.isCollapsed=function(){return this.collapsed_},t.Block.prototype.setCollapsed=function(e){this.collapsed_!=e&&(t.Events.fire(new(t.Events.get(t.Events.BLOCK_CHANGE))(this,"collapsed",null,this.collapsed_,e)),this.collapsed_=e)},t.Block.prototype.toString=function(e,i){function s(f){var g=f.getCheck();return!g&&f.targetConnection&&(g=f.targetConnection.getCheck()),!!g&&(g.indexOf("Boolean")!=-1||g.indexOf("Number")!=-1)}function r(){u&&u.getType()==p.getType()&&u.getLocation()==p.getLocation()&&(u=null)}var o=[];i=i||"?";var h=t.ASTNode.NAVIGATE_ALL_FIELDS;t.ASTNode.NAVIGATE_ALL_FIELDS=!0;for(var u=t.ASTNode.createBlockNode(this),p=u;u;){switch(u.getType()){case t.ASTNode.types.INPUT:var d=u.getLocation();u.in()?s(d)&&o.push("("):o.push(i);break;case t.ASTNode.types.FIELD:d=u.getLocation(),d.name!=t.constants.COLLAPSED_FIELD_NAME&&o.push(d.getText())}if(d=u,u=d.in()||d.next(),!u){for(u=d.out(),r();u&&!u.next();)u=u.out(),r(),u&&u.getType()==t.ASTNode.types.INPUT&&s(u.getLocation())&&o.push(")");u&&(u=u.next())}}for(t.ASTNode.NAVIGATE_ALL_FIELDS=h,i=2,h=o.length;i<h;i++)o[i-2]=="("&&o[i]==")"&&(o[i-2]=o[i-1],o.splice(i-1,2),h-=2);return o=o.join(" ").replace(/(\() | (\))/gmi,"$1$2").trim()||"???",e&&o.length>e&&(o=o.substring(0,e-3)+"..."),o},t.Block.prototype.appendValueInput=function(e){return this.appendInput_(t.inputTypes.VALUE,e)},t.Block.prototype.appendStatementInput=function(e){return this.appendInput_(t.inputTypes.STATEMENT,e)},t.Block.prototype.appendDummyInput=function(e){return this.appendInput_(t.inputTypes.DUMMY,e||"")},t.Block.prototype.jsonInit=function(e){var i=e.type?'Block "'+e.type+'": ':"";if(e.output&&e.previousStatement)throw Error(i+"Must not have both an output and a previousStatement.");if(e.style&&e.style.hat&&(this.hat=e.style.hat,e.style=null),e.style&&e.colour)throw Error(i+"Must not have both a colour and a style.");e.style?this.jsonInitStyle_(e,i):this.jsonInitColour_(e,i);for(var s=0;e["message"+s]!==void 0;)this.interpolate_(e["message"+s],e["args"+s]||[],e["lastDummyAlign"+s],i),s++;if(e.inputsInline!==void 0&&this.setInputsInline(e.inputsInline),e.output!==void 0&&this.setOutput(!0,e.output),e.outputShape!==void 0&&this.setOutputShape(e.outputShape),e.previousStatement!==void 0&&this.setPreviousStatement(!0,e.previousStatement),e.nextStatement!==void 0&&this.setNextStatement(!0,e.nextStatement),e.tooltip!==void 0&&(s=e.tooltip,s=t.utils.replaceMessageReferences(s),this.setTooltip(s)),e.enableContextMenu!==void 0&&(s=e.enableContextMenu,this.contextMenu=!!s),e.helpUrl!==void 0&&(s=e.helpUrl,s=t.utils.replaceMessageReferences(s),this.setHelpUrl(s)),typeof e.extensions=="string"&&(console.warn(i+"JSON attribute 'extensions' should be an array of strings. Found raw string in JSON for '"+e.type+"' block."),e.extensions=[e.extensions]),e.mutator!==void 0&&t.Extensions.apply(e.mutator,this,!0),Array.isArray(e.extensions))for(e=e.extensions,i=0;i<e.length;++i)t.Extensions.apply(e[i],this,!1)},t.Block.prototype.jsonInitColour_=function(e,i){if("colour"in e)if(e.colour===void 0)console.warn(i+"Undefined colour value.");else{e=e.colour;try{this.setColour(e)}catch{console.warn(i+"Illegal colour value: ",e)}}},t.Block.prototype.jsonInitStyle_=function(e,i){e=e.style;try{this.setStyle(e)}catch{console.warn(i+"Style does not exist: ",e)}},t.Block.prototype.mixin=function(e,i){if(i!==void 0&&typeof i!="boolean")throw Error("opt_disableCheck must be a boolean if provided");if(!i){i=[];for(var s in e)this[s]!==void 0&&i.push(s);if(i.length)throw Error("Mixin will overwrite block members: "+JSON.stringify(i))}t.utils.object.mixin(this,e)},t.Block.prototype.interpolate_=function(e,i,s,r){e=t.utils.tokenizeInterpolation(e),this.validateTokens_(e,i.length),i=this.interpolateArguments_(e,i,s),s=[],e=0;for(var o;o=i[e];e++)if(this.isInputKeyword_(o.type)){if(o=this.inputFromJson_(o,r)){for(var h=0,u;u=s[h];h++)o.appendField(u[0],u[1]);s.length=0}}else(h=this.fieldFromJson_(o))&&s.push([h,o.name])},t.Block.prototype.validateTokens_=function(e,i){for(var s=[],r=0,o=0;o<e.length;o++){var h=e[o];if(typeof h=="number"){if(1>h||h>i)throw Error('Block "'+this.type+'": Message index %'+h+" out of range.");if(s[h])throw Error('Block "'+this.type+'": Message index %'+h+" duplicated.");s[h]=!0,r++}}if(r!=i)throw Error('Block "'+this.type+'": Message does not reference all '+i+" arg(s).")},t.Block.prototype.interpolateArguments_=function(e,i,s){for(var r=[],o=0;o<e.length;o++){var h=e[o];typeof h=="number"&&(h=i[h-1]),!(typeof h=="string"&&(h=this.stringToFieldJson_(h),!h))&&r.push(h)}return(e=r.length)&&!this.isInputKeyword_(r[e-1].type)&&(e={type:"input_dummy"},s&&(e.align=s),r.push(e)),r},t.Block.prototype.fieldFromJson_=function(e){var i=t.fieldRegistry.fromJson(e);return!i&&e.alt?typeof e.alt=="string"?(e=this.stringToFieldJson_(e.alt))?this.fieldFromJson_(e):null:this.fieldFromJson_(e.alt):i},t.Block.prototype.inputFromJson_=function(e,i){var s={LEFT:t.constants.ALIGN.LEFT,RIGHT:t.constants.ALIGN.RIGHT,CENTRE:t.constants.ALIGN.CENTRE,CENTER:t.constants.ALIGN.CENTRE},r=null;switch(e.type){case"input_value":r=this.appendValueInput(e.name);break;case"input_statement":r=this.appendStatementInput(e.name);break;case"input_dummy":r=this.appendDummyInput(e.name)}return r?(e.check&&r.setCheck(e.check),e.align&&(s=s[e.align.toUpperCase()],s===void 0?console.warn(i+"Illegal align value: ",e.align):r.setAlign(s)),r):null},t.Block.prototype.isInputKeyword_=function(e){return e=="input_value"||e=="input_statement"||e=="input_dummy"},t.Block.prototype.stringToFieldJson_=function(e){return(e=e.trim())?{type:"field_label",text:e}:null},t.Block.prototype.appendInput_=function(e,i){var s=null;return(e==t.inputTypes.VALUE||e==t.inputTypes.STATEMENT)&&(s=this.makeConnection_(e)),e==t.inputTypes.STATEMENT&&this.statementInputCount++,e=new t.Input(e,i,this,s),this.inputList.push(e),e},t.Block.prototype.moveInputBefore=function(e,i){if(e!=i){for(var s=-1,r=i?-1:this.inputList.length,o=0,h;h=this.inputList[o];o++)if(h.name==e){if(s=o,r!=-1)break}else if(i&&h.name==i&&(r=o,s!=-1))break;if(s==-1)throw Error('Named input "'+e+'" not found.');if(r==-1)throw Error('Reference input "'+i+'" not found.');this.moveNumberedInputBefore(s,r)}},t.Block.prototype.moveNumberedInputBefore=function(e,i){if(e==i)throw Error("Can't move input to itself.");if(e>=this.inputList.length)throw RangeError("Input index "+e+" out of bounds.");if(i>this.inputList.length)throw RangeError("Reference input "+i+" out of bounds.");var s=this.inputList[e];this.inputList.splice(e,1),e<i&&i--,this.inputList.splice(i,0,s)},t.Block.prototype.removeInput=function(e,i){for(var s=0,r;r=this.inputList[s];s++)if(r.name==e)return r.type==t.inputTypes.STATEMENT&&this.statementInputCount--,r.dispose(),this.inputList.splice(s,1),!0;if(i)return!1;throw Error("Input not found: "+e)},t.Block.prototype.getInput=function(e){for(var i=0,s;s=this.inputList[i];i++)if(s.name==e)return s;return null},t.Block.prototype.getInputTargetBlock=function(e){return(e=this.getInput(e))&&e.connection&&e.connection.targetBlock()},t.Block.prototype.getCommentText=function(){return this.commentModel.text},t.Block.prototype.setCommentText=function(e){this.commentModel.text!=e&&(t.Events.fire(new(t.Events.get(t.Events.BLOCK_CHANGE))(this,"comment",null,this.commentModel.text,e)),this.comment=this.commentModel.text=e)},t.Block.prototype.setWarningText=function(e,i){},t.Block.prototype.setMutator=function(e){},t.Block.prototype.getRelativeToSurfaceXY=function(){return this.xy_},t.Block.prototype.moveBy=function(e,i){if(this.parentBlock_)throw Error("Block has parent.");var s=new(t.Events.get(t.Events.BLOCK_MOVE))(this);this.xy_.translate(e,i),s.recordNew(),t.Events.fire(s)},t.Block.prototype.makeConnection_=function(e){return new t.Connection(this,e)},t.Block.prototype.allInputsFilled=function(e){if(e===void 0&&(e=!0),!e&&this.isShadow())return!1;for(var i=0,s;s=this.inputList[i];i++)if(s.connection&&(s=s.connection.targetBlock(),!s||!s.allInputsFilled(e)))return!1;return(i=this.getNextBlock())?i.allInputsFilled(e):!0},t.Block.prototype.toDevString=function(){var e=this.type?'"'+this.type+'" block':"Block";return this.id&&(e+=' (id="'+this.id+'")'),e},t.blockRendering.IPathObject=function(e,i){},t.utils.KeyCodes={WIN_KEY_FF_LINUX:0,MAC_ENTER:3,BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PLUS_SIGN:43,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,FF_SEMICOLON:59,FF_EQUALS:61,FF_DASH:173,FF_HASH:163,QUESTION_MARK:63,AT_SIGN:64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,WIN_KEY_RIGHT:92,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLL_LOCK:145,FIRST_MEDIA_KEY:166,LAST_MEDIA_KEY:183,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,PERIOD:190,SLASH:191,APOSTROPHE:192,TILDE:192,SINGLE_QUOTE:222,OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,WIN_KEY:224,MAC_FF_META:224,MAC_WK_CMD_LEFT:91,MAC_WK_CMD_RIGHT:93,WIN_IME:229,VK_NONAME:252,PHANTOM:255},t.Menu=function(){this.menuItems_=[],this.roleName_=this.element_=this.onKeyDownHandler_=this.mouseLeaveHandler_=this.mouseEnterHandler_=this.clickHandler_=this.mouseOverHandler_=this.highlightedItem_=this.openingCoords=null},t.Menu.prototype.addChild=function(e){this.menuItems_.push(e)},t.Menu.prototype.render=function(e){var i=document.createElement("div");i.className="blocklyMenu goog-menu blocklyNonSelectable",i.tabIndex=0,this.roleName_&&t.utils.aria.setRole(i,this.roleName_),this.element_=i;for(var s=0,r;r=this.menuItems_[s];s++)i.appendChild(r.createDom());this.mouseOverHandler_=t.browserEvents.conditionalBind(i,"mouseover",this,this.handleMouseOver_,!0),this.clickHandler_=t.browserEvents.conditionalBind(i,"click",this,this.handleClick_,!0),this.mouseEnterHandler_=t.browserEvents.conditionalBind(i,"mouseenter",this,this.handleMouseEnter_,!0),this.mouseLeaveHandler_=t.browserEvents.conditionalBind(i,"mouseleave",this,this.handleMouseLeave_,!0),this.onKeyDownHandler_=t.browserEvents.conditionalBind(i,"keydown",this,this.handleKeyEvent_),e.appendChild(i)},t.Menu.prototype.getElement=function(){return this.element_},t.Menu.prototype.focus=function(){var e=this.getElement();e&&(e.focus({preventScroll:!0}),t.utils.dom.addClass(e,"blocklyFocused"))},t.Menu.prototype.blur_=function(){var e=this.getElement();e&&(e.blur(),t.utils.dom.removeClass(e,"blocklyFocused"))},t.Menu.prototype.setRole=function(e){this.roleName_=e},t.Menu.prototype.dispose=function(){this.mouseOverHandler_&&(t.browserEvents.unbind(this.mouseOverHandler_),this.mouseOverHandler_=null),this.clickHandler_&&(t.browserEvents.unbind(this.clickHandler_),this.clickHandler_=null),this.mouseEnterHandler_&&(t.browserEvents.unbind(this.mouseEnterHandler_),this.mouseEnterHandler_=null),this.mouseLeaveHandler_&&(t.browserEvents.unbind(this.mouseLeaveHandler_),this.mouseLeaveHandler_=null),this.onKeyDownHandler_&&(t.browserEvents.unbind(this.onKeyDownHandler_),this.onKeyDownHandler_=null);for(var e=0,i;i=this.menuItems_[e];e++)i.dispose();this.element_=null},t.Menu.prototype.getMenuItem_=function(e){for(var i=this.getElement();e&&e!=i;){if(t.utils.dom.hasClass(e,"blocklyMenuItem")){for(var s=0,r;r=this.menuItems_[s];s++)if(r.getElement()==e)return r}e=e.parentElement}return null},t.Menu.prototype.setHighlighted=function(e){var i=this.highlightedItem_;i&&(i.setHighlighted(!1),this.highlightedItem_=null),e&&(e.setHighlighted(!0),this.highlightedItem_=e,i=this.getElement(),t.utils.style.scrollIntoContainerView(e.getElement(),i),t.utils.aria.setState(i,t.utils.aria.State.ACTIVEDESCENDANT,e.getId()))},t.Menu.prototype.highlightNext=function(){var e=this.menuItems_.indexOf(this.highlightedItem_);this.highlightHelper_(e,1)},t.Menu.prototype.highlightPrevious=function(){var e=this.menuItems_.indexOf(this.highlightedItem_);this.highlightHelper_(0>e?this.menuItems_.length:e,-1)},t.Menu.prototype.highlightFirst_=function(){this.highlightHelper_(-1,1)},t.Menu.prototype.highlightLast_=function(){this.highlightHelper_(this.menuItems_.length,-1)},t.Menu.prototype.highlightHelper_=function(e,i){e+=i;for(var s;s=this.menuItems_[e];){if(s.isEnabled()){this.setHighlighted(s);break}e+=i}},t.Menu.prototype.handleMouseOver_=function(e){(e=this.getMenuItem_(e.target))&&(e.isEnabled()?this.highlightedItem_!=e&&this.setHighlighted(e):this.setHighlighted(null))},t.Menu.prototype.handleClick_=function(e){var i=this.openingCoords;if(this.openingCoords=null,i&&typeof e.clientX=="number"){var s=new t.utils.Coordinate(e.clientX,e.clientY);if(1>t.utils.Coordinate.distance(i,s))return}(e=this.getMenuItem_(e.target))&&e.performAction()},t.Menu.prototype.handleMouseEnter_=function(e){this.focus()},t.Menu.prototype.handleMouseLeave_=function(e){this.getElement()&&(this.blur_(),this.setHighlighted(null))},t.Menu.prototype.handleKeyEvent_=function(e){if(this.menuItems_.length&&!(e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)){var i=this.highlightedItem_;switch(e.keyCode){case t.utils.KeyCodes.ENTER:case t.utils.KeyCodes.SPACE:i&&i.performAction();break;case t.utils.KeyCodes.UP:this.highlightPrevious();break;case t.utils.KeyCodes.DOWN:this.highlightNext();break;case t.utils.KeyCodes.PAGE_UP:case t.utils.KeyCodes.HOME:this.highlightFirst_();break;case t.utils.KeyCodes.PAGE_DOWN:case t.utils.KeyCodes.END:this.highlightLast_();break;default:return}e.preventDefault(),e.stopPropagation()}},t.Menu.prototype.getSize=function(){var e=this.getElement(),i=t.utils.style.getSize(e);return i.height=e.scrollHeight,i},t.MenuItem=function(e,i){this.content_=e,this.value_=i,this.enabled_=!0,this.element_=null,this.rightToLeft_=!1,this.roleName_=null,this.highlight_=this.checked_=this.checkable_=!1,this.actionHandler_=null},t.MenuItem.prototype.createDom=function(){var e=document.createElement("div");e.id=t.utils.IdGenerator.getNextUniqueId(),this.element_=e,e.className="blocklyMenuItem goog-menuitem "+(this.enabled_?"":"blocklyMenuItemDisabled goog-menuitem-disabled ")+(this.checked_?"blocklyMenuItemSelected goog-option-selected ":"")+(this.highlight_?"blocklyMenuItemHighlight goog-menuitem-highlight ":"")+(this.rightToLeft_?"blocklyMenuItemRtl goog-menuitem-rtl ":"");var i=document.createElement("div");if(i.className="blocklyMenuItemContent goog-menuitem-content",this.checkable_){var s=document.createElement("div");s.className="blocklyMenuItemCheckbox goog-menuitem-checkbox",i.appendChild(s)}return s=this.content_,typeof this.content_=="string"&&(s=document.createTextNode(this.content_)),i.appendChild(s),e.appendChild(i),this.roleName_&&t.utils.aria.setRole(e,this.roleName_),t.utils.aria.setState(e,t.utils.aria.State.SELECTED,this.checkable_&&this.checked_||!1),t.utils.aria.setState(e,t.utils.aria.State.DISABLED,!this.enabled_),e},t.MenuItem.prototype.dispose=function(){this.element_=null},t.MenuItem.prototype.getElement=function(){return this.element_},t.MenuItem.prototype.getId=function(){return this.element_.id},t.MenuItem.prototype.getValue=function(){return this.value_},t.MenuItem.prototype.setRightToLeft=function(e){this.rightToLeft_=e},t.MenuItem.prototype.setRole=function(e){this.roleName_=e},t.MenuItem.prototype.setCheckable=function(e){this.checkable_=e},t.MenuItem.prototype.setChecked=function(e){this.checked_=e},t.MenuItem.prototype.setHighlighted=function(e){this.highlight_=e;var i=this.getElement();i&&this.isEnabled()&&(e?(t.utils.dom.addClass(i,"blocklyMenuItemHighlight"),t.utils.dom.addClass(i,"goog-menuitem-highlight")):(t.utils.dom.removeClass(i,"blocklyMenuItemHighlight"),t.utils.dom.removeClass(i,"goog-menuitem-highlight")))},t.MenuItem.prototype.isEnabled=function(){return this.enabled_},t.MenuItem.prototype.setEnabled=function(e){this.enabled_=e},t.MenuItem.prototype.performAction=function(){this.isEnabled()&&this.actionHandler_&&this.actionHandler_(this)},t.MenuItem.prototype.onAction=function(e,i){this.actionHandler_=e.bind(i)},t.WidgetDiv={},t.WidgetDiv.owner_=null,t.WidgetDiv.dispose_=null,t.WidgetDiv.rendererClassName_="",t.WidgetDiv.themeClassName_="",t.WidgetDiv.createDom=function(){t.WidgetDiv.DIV||(t.WidgetDiv.DIV=document.createElement("div"),t.WidgetDiv.DIV.className="blocklyWidgetDiv",(t.parentContainer||document.body).appendChild(t.WidgetDiv.DIV))},t.WidgetDiv.show=function(e,i,s){t.WidgetDiv.hide(),t.WidgetDiv.owner_=e,t.WidgetDiv.dispose_=s,e=t.WidgetDiv.DIV,e.style.direction=i?"rtl":"ltr",e.style.display="block",i=t.getMainWorkspace(),t.WidgetDiv.rendererClassName_=i.getRenderer().getClassName(),t.WidgetDiv.themeClassName_=i.getTheme().getClassName(),t.utils.dom.addClass(e,t.WidgetDiv.rendererClassName_),t.utils.dom.addClass(e,t.WidgetDiv.themeClassName_)},t.WidgetDiv.hide=function(){if(t.WidgetDiv.isVisible()){t.WidgetDiv.owner_=null;var e=t.WidgetDiv.DIV;e.style.display="none",e.style.left="",e.style.top="",t.WidgetDiv.dispose_&&t.WidgetDiv.dispose_(),t.WidgetDiv.dispose_=null,e.textContent="",t.WidgetDiv.rendererClassName_&&(t.utils.dom.removeClass(e,t.WidgetDiv.rendererClassName_),t.WidgetDiv.rendererClassName_=""),t.WidgetDiv.themeClassName_&&(t.utils.dom.removeClass(e,t.WidgetDiv.themeClassName_),t.WidgetDiv.themeClassName_=""),t.getMainWorkspace().markFocused()}},t.WidgetDiv.isVisible=function(){return!!t.WidgetDiv.owner_},t.WidgetDiv.hideIfOwner=function(e){t.WidgetDiv.owner_==e&&t.WidgetDiv.hide()},t.WidgetDiv.positionInternal_=function(e,i,s){t.WidgetDiv.DIV.style.left=e+"px",t.WidgetDiv.DIV.style.top=i+"px",t.WidgetDiv.DIV.style.height=s+"px"},t.WidgetDiv.positionWithAnchor=function(e,i,s,r){var o=t.WidgetDiv.calculateY_(e,i,s);e=t.WidgetDiv.calculateX_(e,i,s,r),0>o?t.WidgetDiv.positionInternal_(e,0,s.height+o):t.WidgetDiv.positionInternal_(e,o,s.height)},t.WidgetDiv.calculateX_=function(e,i,s,r){return r?(i=Math.max(i.right-s.width,e.left),Math.min(i,e.right-s.width)):(i=Math.min(i.left,e.right-s.width),Math.max(i,e.left))},t.WidgetDiv.calculateY_=function(e,i,s){return i.bottom+s.height>=e.bottom?i.top-s.height:i.bottom},t.ContextMenu={},t.ContextMenu.currentBlock=null,t.ContextMenu.menu_=null,t.ContextMenu.show=function(e,i,s){if(t.WidgetDiv.show(t.ContextMenu,s,t.ContextMenu.dispose),i.length){var r=t.ContextMenu.populate_(i,s);t.ContextMenu.menu_=r,t.ContextMenu.position_(r,e,s),setTimeout(function(){r.focus()},1),t.ContextMenu.currentBlock=null}else t.ContextMenu.hide()},t.ContextMenu.populate_=function(e,i){var s=new t.Menu;s.setRole(t.utils.aria.Role.MENU);for(var r=0,o;o=e[r];r++){var h=new t.MenuItem(o.text);h.setRightToLeft(i),h.setRole(t.utils.aria.Role.MENUITEM),s.addChild(h),h.setEnabled(o.enabled),o.enabled&&h.onAction(function(u){t.ContextMenu.hide(),this.callback(this.scope)},o)}return s},t.ContextMenu.position_=function(e,i,s){var r=t.utils.getViewportBBox();i=new t.utils.Rect(i.clientY+r.top,i.clientY+r.top,i.clientX+r.left,i.clientX+r.left),t.ContextMenu.createWidget_(e);var o=e.getSize();s&&(i.left+=o.width,i.right+=o.width,r.left+=o.width,r.right+=o.width),t.WidgetDiv.positionWithAnchor(r,i,o,s),e.focus()},t.ContextMenu.createWidget_=function(e){e.render(t.WidgetDiv.DIV);var i=e.getElement();t.utils.dom.addClass(i,"blocklyContextMenu"),t.browserEvents.conditionalBind(i,"contextmenu",null,t.utils.noEvent),e.focus()},t.ContextMenu.hide=function(){t.WidgetDiv.hideIfOwner(t.ContextMenu),t.ContextMenu.currentBlock=null},t.ContextMenu.dispose=function(){t.ContextMenu.menu_&&(t.ContextMenu.menu_.dispose(),t.ContextMenu.menu_=null)},t.ContextMenu.callbackFactory=function(e,i){return function(){t.Events.disable();try{var s=t.Xml.domToBlock(i,e.workspace),r=e.getRelativeToSurfaceXY();r.x=e.RTL?r.x-t.SNAP_RADIUS:r.x+t.SNAP_RADIUS,r.y+=2*t.SNAP_RADIUS,s.moveBy(r.x,r.y)}finally{t.Events.enable()}t.Events.isEnabled()&&!s.isShadow()&&t.Events.fire(new(t.Events.get(t.Events.BLOCK_CREATE))(s)),s.select()}},t.ContextMenu.commentDeleteOption=function(e){return{text:t.Msg.REMOVE_COMMENT,enabled:!0,callback:function(){t.Events.setGroup(!0),e.dispose(!0,!0),t.Events.setGroup(!1)}}},t.ContextMenu.commentDuplicateOption=function(e){return{text:t.Msg.DUPLICATE_COMMENT,enabled:!0,callback:function(){t.duplicate(e)}}},t.ContextMenu.workspaceCommentOption=function(e,i){if(!t.WorkspaceCommentSvg)throw Error("Missing require for Blockly.WorkspaceCommentSvg");var s={enabled:!t.utils.userAgent.IE};return s.text=t.Msg.ADD_COMMENT,s.callback=function(){var r=new t.WorkspaceCommentSvg(e,t.Msg.WORKSPACE_COMMENT_DEFAULT_TEXT,t.WorkspaceCommentSvg.DEFAULT_SIZE,t.WorkspaceCommentSvg.DEFAULT_SIZE),o=e.getInjectionDiv().getBoundingClientRect();o=new t.utils.Coordinate(i.clientX-o.left,i.clientY-o.top);var h=e.getOriginOffsetInPixels();o=t.utils.Coordinate.difference(o,h),o.scale(1/e.scale),r.moveBy(o.x,o.y),e.rendered&&(r.initSvg(),r.render(),r.select())},s},t.ContextMenuRegistry=function(){t.ContextMenuRegistry.registry=this,this.registry_={}},t.ContextMenuRegistry.ScopeType={BLOCK:"block",WORKSPACE:"workspace"},t.ContextMenuRegistry.registry=null,t.ContextMenuRegistry.prototype.register=function(e){if(this.registry_[e.id])throw Error('Menu item with id "'+e.id+'" is already registered.');this.registry_[e.id]=e},t.ContextMenuRegistry.prototype.unregister=function(e){if(this.registry_[e])delete this.registry_[e];else throw Error('Menu item with id "'+e+'" not found.')},t.ContextMenuRegistry.prototype.getItem=function(e){return this.registry_[e]?this.registry_[e]:null},t.ContextMenuRegistry.prototype.getContextMenuOptions=function(e,i){var s=[],r=this.registry_;return Object.keys(r).forEach(function(o){if(o=r[o],e==o.scopeType){var h=o.preconditionFn(i);h!="hidden"&&(o={text:typeof o.displayText=="function"?o.displayText(i):o.displayText,enabled:h=="enabled",callback:o.callback,scope:i,weight:o.weight},s.push(o))}}),s.sort(function(o,h){return o.weight-h.weight}),s},new t.ContextMenuRegistry,t.Events.Selected=function(e,i,s){t.Events.Selected.superClass_.constructor.call(this,s),this.oldElementId=e,this.newElementId=i},t.utils.object.inherits(t.Events.Selected,t.Events.UiBase),t.Events.Selected.prototype.type=t.Events.SELECTED,t.Events.Selected.prototype.toJson=function(){var e=t.Events.Selected.superClass_.toJson.call(this);return e.oldElementId=this.oldElementId,e.newElementId=this.newElementId,e},t.Events.Selected.prototype.fromJson=function(e){t.Events.Selected.superClass_.fromJson.call(this,e),this.oldElementId=e.oldElementId,this.newElementId=e.newElementId},t.registry.register(t.registry.Type.EVENT,t.Events.SELECTED,t.Events.Selected),t.RenderedConnection=function(e,i){t.RenderedConnection.superClass_.constructor.call(this,e,i),this.db_=e.workspace.connectionDBList[i],this.dbOpposite_=e.workspace.connectionDBList[t.OPPOSITE_TYPE[i]],this.offsetInBlock_=new t.utils.Coordinate(0,0),this.trackedState_=t.RenderedConnection.TrackedState.WILL_TRACK,this.targetConnection=null},t.utils.object.inherits(t.RenderedConnection,t.Connection),t.RenderedConnection.TrackedState={WILL_TRACK:-1,UNTRACKED:0,TRACKED:1},t.RenderedConnection.prototype.dispose=function(){t.RenderedConnection.superClass_.dispose.call(this),this.trackedState_==t.RenderedConnection.TrackedState.TRACKED&&this.db_.removeConnection(this,this.y)},t.RenderedConnection.prototype.getSourceBlock=function(){return t.RenderedConnection.superClass_.getSourceBlock.call(this)},t.RenderedConnection.prototype.targetBlock=function(){return t.RenderedConnection.superClass_.targetBlock.call(this)},t.RenderedConnection.prototype.distanceFrom=function(e){var i=this.x-e.x;return e=this.y-e.y,Math.sqrt(i*i+e*e)},t.RenderedConnection.prototype.bumpAwayFrom=function(e){if(!this.sourceBlock_.workspace.isDragging()){var i=this.sourceBlock_.getRootBlock();if(!i.isInFlyout){var s=!1;if(!i.isMovable()){if(i=e.getSourceBlock().getRootBlock(),!i.isMovable())return;e=this,s=!0}var r=t.selected==i;r||i.addSelect();var o=e.x+t.SNAP_RADIUS+Math.floor(Math.random()*t.BUMP_RANDOMNESS)-this.x,h=e.y+t.SNAP_RADIUS+Math.floor(Math.random()*t.BUMP_RANDOMNESS)-this.y;s&&(h=-h),i.RTL&&(o=e.x-t.SNAP_RADIUS-Math.floor(Math.random()*t.BUMP_RANDOMNESS)-this.x),i.moveBy(o,h),r||i.removeSelect()}}},t.RenderedConnection.prototype.moveTo=function(e,i){this.trackedState_==t.RenderedConnection.TrackedState.WILL_TRACK?(this.db_.addConnection(this,i),this.trackedState_=t.RenderedConnection.TrackedState.TRACKED):this.trackedState_==t.RenderedConnection.TrackedState.TRACKED&&(this.db_.removeConnection(this,this.y),this.db_.addConnection(this,i)),this.x=e,this.y=i},t.RenderedConnection.prototype.moveBy=function(e,i){this.moveTo(this.x+e,this.y+i)},t.RenderedConnection.prototype.moveToOffset=function(e){this.moveTo(e.x+this.offsetInBlock_.x,e.y+this.offsetInBlock_.y)},t.RenderedConnection.prototype.setOffsetInBlock=function(e,i){this.offsetInBlock_.x=e,this.offsetInBlock_.y=i},t.RenderedConnection.prototype.getOffsetInBlock=function(){return this.offsetInBlock_},t.RenderedConnection.prototype.tighten=function(){var e=this.targetConnection.x-this.x,i=this.targetConnection.y-this.y;if(e!=0||i!=0){var s=this.targetBlock(),r=s.getSvgRoot();if(!r)throw Error("block is not rendered.");r=t.utils.getRelativeXY(r),s.getSvgRoot().setAttribute("transform","translate("+(r.x-e)+","+(r.y-i)+")"),s.moveConnections(-e,-i)}},t.RenderedConnection.prototype.closest=function(e,i){return this.dbOpposite_.searchForClosest(this,e,i)},t.RenderedConnection.prototype.highlight=function(){var e=this.sourceBlock_.workspace.getRenderer().getConstants(),i=e.shapeFor(this);this.type==t.connectionTypes.INPUT_VALUE||this.type==t.connectionTypes.OUTPUT_VALUE?(e=e.TAB_OFFSET_FROM_TOP,i=t.utils.svgPaths.moveBy(0,-e)+t.utils.svgPaths.lineOnAxis("v",e)+i.pathDown+t.utils.svgPaths.lineOnAxis("v",e)):(e=e.NOTCH_OFFSET_LEFT-e.CORNER_RADIUS,i=t.utils.svgPaths.moveBy(-e,0)+t.utils.svgPaths.lineOnAxis("h",e)+i.pathLeft+t.utils.svgPaths.lineOnAxis("h",e)),e=this.sourceBlock_.getRelativeToSurfaceXY(),t.Connection.highlightedPath_=t.utils.dom.createSvgElement(t.utils.Svg.PATH,{class:"blocklyHighlightedConnectionPath",d:i,transform:"translate("+(this.x-e.x)+","+(this.y-e.y)+")"+(this.sourceBlock_.RTL?" scale(-1 1)":"")},this.sourceBlock_.getSvgRoot())},t.RenderedConnection.prototype.unhighlight=function(){t.utils.dom.removeNode(t.Connection.highlightedPath_),delete t.Connection.highlightedPath_},t.RenderedConnection.prototype.setTracking=function(e){e&&this.trackedState_==t.RenderedConnection.TrackedState.TRACKED||!e&&this.trackedState_==t.RenderedConnection.TrackedState.UNTRACKED||this.sourceBlock_.isInFlyout||(e?(this.db_.addConnection(this,this.y),this.trackedState_=t.RenderedConnection.TrackedState.TRACKED):(this.trackedState_==t.RenderedConnection.TrackedState.TRACKED&&this.db_.removeConnection(this,this.y),this.trackedState_=t.RenderedConnection.TrackedState.UNTRACKED))},t.RenderedConnection.prototype.stopTrackingAll=function(){if(this.setTracking(!1),this.targetConnection)for(var e=this.targetBlock().getDescendants(!1),i=0;i<e.length;i++){for(var s=e[i],r=s.getConnections_(!0),o=0;o<r.length;o++)r[o].setTracking(!1);for(s=s.getIcons(),o=0;o<s.length;o++)s[o].setVisible(!1)}},t.RenderedConnection.prototype.startTrackingAll=function(){this.setTracking(!0);var e=[];if(this.type!=t.connectionTypes.INPUT_VALUE&&this.type!=t.connectionTypes.NEXT_STATEMENT)return e;var i=this.targetBlock();if(i){if(i.isCollapsed()){var s=[];i.outputConnection&&s.push(i.outputConnection),i.nextConnection&&s.push(i.nextConnection),i.previousConnection&&s.push(i.previousConnection)}else s=i.getConnections_(!0);for(var r=0;r<s.length;r++)e.push.apply(e,s[r].startTrackingAll());e.length||(e[0]=i)}return e},t.RenderedConnection.prototype.isConnectionAllowed=function(e,i){return t.utils.deprecation.warn("RenderedConnection.prototype.isConnectionAllowed","July 2020","July 2021","Blockly.Workspace.prototype.getConnectionChecker().canConnect"),this.distanceFrom(e)>i?!1:t.RenderedConnection.superClass_.isConnectionAllowed.call(this,e)},t.RenderedConnection.prototype.onFailedConnect=function(e){this.bumpAwayFrom(e)},t.RenderedConnection.prototype.disconnectInternal_=function(e,i){t.RenderedConnection.superClass_.disconnectInternal_.call(this,e,i),e.rendered&&e.render(),i.rendered&&(i.updateDisabled(),i.render(),i.getSvgRoot().style.display="block")},t.RenderedConnection.prototype.respawnShadow_=function(){t.RenderedConnection.superClass_.respawnShadow_.call(this);var e=this.targetBlock();e&&(e.initSvg(),e.render(!1),e=this.getSourceBlock(),e.rendered&&e.render())},t.RenderedConnection.prototype.neighbours=function(e){return this.dbOpposite_.getNeighbours(this,e)},t.RenderedConnection.prototype.connect_=function(e){t.RenderedConnection.superClass_.connect_.call(this,e);var i=this.getSourceBlock();e=e.getSourceBlock();var s=i.rendered,r=e.rendered;s&&i.updateDisabled(),r&&e.updateDisabled(),s&&r&&(this.type==t.connectionTypes.NEXT_STATEMENT||this.type==t.connectionTypes.PREVIOUS_STATEMENT?e.render():i.render()),(i=i.getInputWithBlock(e))&&(i=i.isVisible(),e.getSvgRoot().style.display=i?"block":"none")},t.RenderedConnection.prototype.onCheckChanged_=function(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||((this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug(),this.sourceBlock_.bumpNeighbours())},t.Marker=function(){this.drawer_=this.curNode_=this.colour=null,this.type="marker"},t.Marker.prototype.setDrawer=function(e){this.drawer_=e},t.Marker.prototype.getDrawer=function(){return this.drawer_},t.Marker.prototype.getCurNode=function(){return this.curNode_},t.Marker.prototype.setCurNode=function(e){var i=this.curNode_;this.curNode_=e,this.drawer_&&this.drawer_.draw(i,this.curNode_)},t.Marker.prototype.draw=function(){this.drawer_&&this.drawer_.draw(this.curNode_,this.curNode_)},t.Marker.prototype.hide=function(){this.drawer_&&this.drawer_.hide()},t.Marker.prototype.dispose=function(){this.getDrawer()&&this.getDrawer().dispose()},t.Cursor=function(){t.Cursor.superClass_.constructor.call(this),this.type="cursor"},t.utils.object.inherits(t.Cursor,t.Marker),t.Cursor.prototype.next=function(){var e=this.getCurNode();if(!e)return null;for(e=e.next();e&&e.next()&&(e.getType()==t.ASTNode.types.NEXT||e.getType()==t.ASTNode.types.BLOCK);)e=e.next();return e&&this.setCurNode(e),e},t.Cursor.prototype.in=function(){var e=this.getCurNode();return e?((e.getType()==t.ASTNode.types.PREVIOUS||e.getType()==t.ASTNode.types.OUTPUT)&&(e=e.next()),(e=e.in())&&this.setCurNode(e),e):null},t.Cursor.prototype.prev=function(){var e=this.getCurNode();if(!e)return null;for(e=e.prev();e&&e.prev()&&(e.getType()==t.ASTNode.types.NEXT||e.getType()==t.ASTNode.types.BLOCK);)e=e.prev();return e&&this.setCurNode(e),e},t.Cursor.prototype.out=function(){var e=this.getCurNode();return e?((e=e.out())&&e.getType()==t.ASTNode.types.BLOCK&&(e=e.prev()||e),e&&this.setCurNode(e),e):null},t.registry.register(t.registry.Type.CURSOR,t.registry.DEFAULT,t.Cursor),t.BasicCursor=function(){t.BasicCursor.superClass_.constructor.call(this)},t.utils.object.inherits(t.BasicCursor,t.Cursor),t.BasicCursor.registrationName="basicCursor",t.BasicCursor.prototype.next=function(){var e=this.getCurNode();return e?((e=this.getNextNode_(e,this.validNode_))&&this.setCurNode(e),e):null},t.BasicCursor.prototype.in=function(){return this.next()},t.BasicCursor.prototype.prev=function(){var e=this.getCurNode();return e?((e=this.getPreviousNode_(e,this.validNode_))&&this.setCurNode(e),e):null},t.BasicCursor.prototype.out=function(){return this.prev()},t.BasicCursor.prototype.getNextNode_=function(e,i){if(!e)return null;var s=e.in()||e.next();return i(s)?s:s?this.getNextNode_(s,i):(e=this.findSiblingOrParent_(e.out()),i(e)?e:e?this.getNextNode_(e,i):null)},t.BasicCursor.prototype.getPreviousNode_=function(e,i){if(!e)return null;var s=e.prev();return s=s?this.getRightMostChild_(s):e.out(),i(s)?s:s?this.getPreviousNode_(s,i):null},t.BasicCursor.prototype.validNode_=function(e){var i=!1;return e=e&&e.getType(),(e==t.ASTNode.types.OUTPUT||e==t.ASTNode.types.INPUT||e==t.ASTNode.types.FIELD||e==t.ASTNode.types.NEXT||e==t.ASTNode.types.PREVIOUS||e==t.ASTNode.types.WORKSPACE)&&(i=!0),i},t.BasicCursor.prototype.findSiblingOrParent_=function(e){if(!e)return null;var i=e.next();return i||this.findSiblingOrParent_(e.out())},t.BasicCursor.prototype.getRightMostChild_=function(e){if(!e.in())return e;for(e=e.in();e.next();)e=e.next();return this.getRightMostChild_(e)},t.registry.register(t.registry.Type.CURSOR,t.BasicCursor.registrationName,t.BasicCursor),t.TabNavigateCursor=function(){t.TabNavigateCursor.superClass_.constructor.call(this)},t.utils.object.inherits(t.TabNavigateCursor,t.BasicCursor),t.TabNavigateCursor.prototype.validNode_=function(e){var i=!1,s=e&&e.getType();return e&&(e=e.getLocation(),s==t.ASTNode.types.FIELD&&e&&e.isTabNavigable()&&e.isClickable()&&(i=!0)),i},t.BlockSvg=function(e,i,s){this.svgGroup_=t.utils.dom.createSvgElement(t.utils.Svg.G,{},null),this.svgGroup_.translate_="",this.style=e.getRenderer().getConstants().getBlockStyle(null),this.pathObject=e.getRenderer().makePathObject(this.svgGroup_,this.style),this.renderIsInProgress_=this.rendered=!1,this.workspace=e,this.previousConnection=this.nextConnection=this.outputConnection=null,this.useDragSurface_=t.utils.is3dSupported()&&!!e.getBlockDragSurface();var r=this.pathObject.svgPath;r.tooltip=this,t.Tooltip.bindMouseEvents(r),t.BlockSvg.superClass_.constructor.call(this,e,i,s),this.svgGroup_.dataset?this.svgGroup_.dataset.id=this.id:t.utils.userAgent.IE&&this.svgGroup_.setAttribute("data-id",this.id)},t.utils.object.inherits(t.BlockSvg,t.Block),t.BlockSvg.prototype.height=0,t.BlockSvg.prototype.width=0,t.BlockSvg.prototype.warningTextDb_=null,t.BlockSvg.INLINE=-1,t.BlockSvg.COLLAPSED_WARNING_ID="TEMP_COLLAPSED_WARNING_",t.BlockSvg.prototype.initSvg=function(){if(!this.workspace.rendered)throw TypeError("Workspace is headless.");for(var e=0,i;i=this.inputList[e];e++)i.init();for(i=this.getIcons(),e=0;e<i.length;e++)i[e].createIcon();this.applyColour(),this.pathObject.updateMovable(this.isMovable()),e=this.getSvgRoot(),this.workspace.options.readOnly||this.eventsInit_||!e||t.browserEvents.conditionalBind(e,"mousedown",this,this.onMouseDown_),this.eventsInit_=!0,e.parentNode||this.workspace.getCanvas().appendChild(e)},t.BlockSvg.prototype.getColourSecondary=function(){return this.style.colourSecondary},t.BlockSvg.prototype.getColourTertiary=function(){return this.style.colourTertiary},t.BlockSvg.prototype.getColourShadow=function(){return t.utils.deprecation.warn("BlockSvg.prototype.getColourShadow","January 2020","January 2021","style.colourSecondary"),this.getColourSecondary()},t.BlockSvg.prototype.getColourBorder=function(){return t.utils.deprecation.warn("BlockSvg.prototype.getColourBorder","January 2020","January 2021","style.colourTertiary"),{colourBorder:this.getColourTertiary(),colourLight:null,colourDark:null}},t.BlockSvg.prototype.select=function(){if(this.isShadow()&&this.getParent())this.getParent().select();else if(t.selected!=this){var e=null;if(t.selected){e=t.selected.id,t.Events.disable();try{t.selected.unselect()}finally{t.Events.enable()}}e=new(t.Events.get(t.Events.SELECTED))(e,this.id,this.workspace.id),t.Events.fire(e),t.selected=this,this.addSelect()}},t.BlockSvg.prototype.unselect=function(){if(t.selected==this){var e=new(t.Events.get(t.Events.SELECTED))(this.id,null,this.workspace.id);e.workspaceId=this.workspace.id,t.Events.fire(e),t.selected=null,this.removeSelect()}},t.BlockSvg.prototype.mutator=null,t.BlockSvg.prototype.comment=null,t.BlockSvg.prototype.commentIcon_=null,t.BlockSvg.prototype.warning=null,t.BlockSvg.prototype.getIcons=function(){var e=[];return this.mutator&&e.push(this.mutator),this.commentIcon_&&e.push(this.commentIcon_),this.warning&&e.push(this.warning),e},t.BlockSvg.prototype.setParent=function(e){var i=this.parentBlock_;if(e!=i){t.utils.dom.startTextWidthCache(),t.BlockSvg.superClass_.setParent.call(this,e),t.utils.dom.stopTextWidthCache();var s=this.getSvgRoot();if(!this.workspace.isClearing&&s){var r=this.getRelativeToSurfaceXY();e?(e.getSvgRoot().appendChild(s),e=this.getRelativeToSurfaceXY(),this.moveConnections(e.x-r.x,e.y-r.y)):i&&(this.workspace.getCanvas().appendChild(s),this.translate(r.x,r.y)),this.applyColour()}}},t.BlockSvg.prototype.getRelativeToSurfaceXY=function(){var e=0,i=0,s=this.useDragSurface_?this.workspace.getBlockDragSurface().getGroup():null,r=this.getSvgRoot();if(r)do{var o=t.utils.getRelativeXY(r);e+=o.x,i+=o.y,this.useDragSurface_&&this.workspace.getBlockDragSurface().getCurrentBlock()==r&&(o=this.workspace.getBlockDragSurface().getSurfaceTranslation(),e+=o.x,i+=o.y),r=r.parentNode}while(r&&r!=this.workspace.getCanvas()&&r!=s);return new t.utils.Coordinate(e,i)},t.BlockSvg.prototype.moveBy=function(e,i){if(this.parentBlock_)throw Error("Block has parent.");var s=t.Events.isEnabled();if(s)var r=new(t.Events.get(t.Events.BLOCK_MOVE))(this);var o=this.getRelativeToSurfaceXY();this.translate(o.x+e,o.y+i),this.moveConnections(e,i),s&&(r.recordNew(),t.Events.fire(r)),this.workspace.resizeContents()},t.BlockSvg.prototype.translate=function(e,i){this.getSvgRoot().setAttribute("transform","translate("+e+","+i+")")},t.BlockSvg.prototype.moveToDragSurface=function(){if(this.useDragSurface_){var e=this.getRelativeToSurfaceXY();this.clearTransformAttributes_(),this.workspace.getBlockDragSurface().translateSurface(e.x,e.y),(e=this.getSvgRoot())&&this.workspace.getBlockDragSurface().setBlocksAndShow(e)}},t.BlockSvg.prototype.moveTo=function(e){var i=this.getRelativeToSurfaceXY();this.moveBy(e.x-i.x,e.y-i.y)},t.BlockSvg.prototype.moveOffDragSurface=function(e){this.useDragSurface_&&(this.translate(e.x,e.y),this.workspace.getBlockDragSurface().clearAndHide(this.workspace.getCanvas()))},t.BlockSvg.prototype.moveDuringDrag=function(e){this.useDragSurface_?this.workspace.getBlockDragSurface().translateSurface(e.x,e.y):(this.svgGroup_.translate_="translate("+e.x+","+e.y+")",this.svgGroup_.setAttribute("transform",this.svgGroup_.translate_+this.svgGroup_.skew_))},t.BlockSvg.prototype.clearTransformAttributes_=function(){this.getSvgRoot().removeAttribute("transform")},t.BlockSvg.prototype.snapToGrid=function(){if(this.workspace&&!this.workspace.isDragging()&&!this.getParent()&&!this.isInFlyout){var e=this.workspace.getGrid();if(e&&e.shouldSnap()){var i=e.getSpacing(),s=i/2,r=this.getRelativeToSurfaceXY();e=Math.round((r.x-s)/i)*i+s-r.x,i=Math.round((r.y-s)/i)*i+s-r.y,e=Math.round(e),i=Math.round(i),e==0&&i==0||this.moveBy(e,i)}}},t.BlockSvg.prototype.getBoundingRectangle=function(){var e=this.getRelativeToSurfaceXY(),i=this.getHeightWidth();if(this.RTL)var s=e.x-i.width,r=e.x;else s=e.x,r=e.x+i.width;return new t.utils.Rect(e.y,e.y+i.height,s,r)},t.BlockSvg.prototype.markDirty=function(){this.pathObject.constants=this.workspace.getRenderer().getConstants();for(var e=0,i;i=this.inputList[e];e++)i.markDirty()},t.BlockSvg.prototype.setCollapsed=function(e){this.collapsed_!=e&&(t.BlockSvg.superClass_.setCollapsed.call(this,e),e?this.rendered&&this.render():this.updateCollapsed_())},t.BlockSvg.prototype.updateCollapsed_=function(){for(var e=this.isCollapsed(),i=t.constants.COLLAPSED_INPUT_NAME,s=t.constants.COLLAPSED_FIELD_NAME,r=0,o;o=this.inputList[r];r++)o.name!=i&&o.setVisible(!e);if(e){for(o=this.getIcons(),r=0;e=o[r];r++)e.setVisible(!1);r=this.toString(t.COLLAPSE_CHARS),(o=this.getField(s))?o.setValue(r):(o=this.getInput(i)||this.appendDummyInput(i),o.appendField(new t.FieldLabel(r),s))}else this.updateDisabled(),this.removeInput(i)},t.BlockSvg.prototype.tab=function(e,i){var s=new t.TabNavigateCursor;s.setCurNode(t.ASTNode.createFieldNode(e)),e=s.getCurNode(),i?s.next():s.prev(),(i=s.getCurNode())&&i!==e&&(i.getLocation().showEditor(),this.workspace.keyboardAccessibilityMode&&this.workspace.getCursor().setCurNode(i))},t.BlockSvg.prototype.onMouseDown_=function(e){var i=this.workspace&&this.workspace.getGesture(e);i&&i.handleBlockStart(e,this)},t.BlockSvg.prototype.showHelp=function(){var e=typeof this.helpUrl=="function"?this.helpUrl():this.helpUrl;e&&window.open(e)},t.BlockSvg.prototype.generateContextMenu=function(){if(this.workspace.options.readOnly||!this.contextMenu)return null;var e=t.ContextMenuRegistry.registry.getContextMenuOptions(t.ContextMenuRegistry.ScopeType.BLOCK,{block:this});return this.customContextMenu&&this.customContextMenu(e),e},t.BlockSvg.prototype.showContextMenu=function(e){var i=this.generateContextMenu();i&&i.length&&(t.ContextMenu.show(e,i,this.RTL),t.ContextMenu.currentBlock=this)},t.BlockSvg.prototype.moveConnections=function(e,i){if(this.rendered){for(var s=this.getConnections_(!1),r=0;r<s.length;r++)s[r].moveBy(e,i);for(s=this.getIcons(),r=0;r<s.length;r++)s[r].computeIconLocation();for(r=0;r<this.childBlocks_.length;r++)this.childBlocks_[r].moveConnections(e,i)}},t.BlockSvg.prototype.setDragging=function(e){if(e){var i=this.getSvgRoot();i.translate_="",i.skew_="",t.draggingConnections=t.draggingConnections.concat(this.getConnections_(!0)),t.utils.dom.addClass(this.svgGroup_,"blocklyDragging")}else t.draggingConnections=[],t.utils.dom.removeClass(this.svgGroup_,"blocklyDragging");for(i=0;i<this.childBlocks_.length;i++)this.childBlocks_[i].setDragging(e)},t.BlockSvg.prototype.setMovable=function(e){t.BlockSvg.superClass_.setMovable.call(this,e),this.pathObject.updateMovable(e)},t.BlockSvg.prototype.setEditable=function(e){t.BlockSvg.superClass_.setEditable.call(this,e),e=this.getIcons();for(var i=0;i<e.length;i++)e[i].updateEditable()},t.BlockSvg.prototype.setShadow=function(e){t.BlockSvg.superClass_.setShadow.call(this,e),this.applyColour()},t.BlockSvg.prototype.setInsertionMarker=function(e){this.isInsertionMarker_!=e&&(this.isInsertionMarker_=e)&&(this.setColour(this.workspace.getRenderer().getConstants().INSERTION_MARKER_COLOUR),this.pathObject.updateInsertionMarker(!0))},t.BlockSvg.prototype.getSvgRoot=function(){return this.svgGroup_},t.BlockSvg.prototype.dispose=function(e,i){if(this.workspace){t.Tooltip.dispose(),t.Tooltip.unbindMouseEvents(this.pathObject.svgPath),t.utils.dom.startTextWidthCache();var s=this.workspace;if(t.selected==this&&(this.unselect(),this.workspace.cancelCurrentGesture()),t.ContextMenu.currentBlock==this&&t.ContextMenu.hide(),i&&this.rendered&&(this.unplug(e),t.blockAnimations.disposeUiEffect(this)),this.rendered=!1,this.warningTextDb_){for(var r in this.warningTextDb_)clearTimeout(this.warningTextDb_[r]);this.warningTextDb_=null}for(i=this.getIcons(),r=0;r<i.length;r++)i[r].dispose();t.BlockSvg.superClass_.dispose.call(this,!!e),t.utils.dom.removeNode(this.svgGroup_),s.resizeContents(),this.svgGroup_=null,t.utils.dom.stopTextWidthCache()}},t.BlockSvg.prototype.toCopyData=function(){if(this.isInsertionMarker_)return null;var e=t.Xml.blockToDom(this,!0);t.Xml.deleteNext(e);var i=this.getRelativeToSurfaceXY();return e.setAttribute("x",this.RTL?-i.x:i.x),e.setAttribute("y",i.y),{xml:e,source:this.workspace,typeCounts:t.utils.getBlockTypeCounts(this,!0)}},t.BlockSvg.prototype.applyColour=function(){this.pathObject.applyColour(this);for(var e=this.getIcons(),i=0;i<e.length;i++)e[i].applyColour();for(e=0;i=this.inputList[e];e++)for(var s=0,r;r=i.fieldRow[s];s++)r.applyColour()},t.BlockSvg.prototype.updateDisabled=function(){var e=this.getChildren(!1);if(this.applyColour(),!this.isCollapsed())for(var i=0,s;s=e[i];i++)s.rendered&&s.updateDisabled()},t.BlockSvg.prototype.getCommentIcon=function(){return this.commentIcon_},t.BlockSvg.prototype.setCommentText=function(e){if(!t.Comment)throw Error("Missing require for Blockly.Comment");this.commentModel.text!=e&&(t.BlockSvg.superClass_.setCommentText.call(this,e),e=e!=null,!!this.commentIcon_==e?this.commentIcon_.updateText():(e?this.comment=this.commentIcon_=new t.Comment(this):(this.commentIcon_.dispose(),this.comment=this.commentIcon_=null),this.rendered&&(this.render(),this.bumpNeighbours())))},t.BlockSvg.prototype.setWarningText=function(e,i){if(!t.Warning)throw Error("Missing require for Blockly.Warning");this.warningTextDb_||(this.warningTextDb_=Object.create(null));var s=i||"";if(s)this.warningTextDb_[s]&&(clearTimeout(this.warningTextDb_[s]),delete this.warningTextDb_[s]);else for(var r in this.warningTextDb_)clearTimeout(this.warningTextDb_[r]),delete this.warningTextDb_[r];if(this.workspace.isDragging()){var o=this;this.warningTextDb_[s]=setTimeout(function(){o.workspace&&(delete o.warningTextDb_[s],o.setWarningText(e,s))},100)}else{if(this.isInFlyout&&(e=null),i=!1,typeof e=="string"){r=this.getSurroundParent();for(var h=null;r;)r.isCollapsed()&&(h=r),r=r.getSurroundParent();h&&h.setWarningText(t.Msg.COLLAPSED_WARNINGS_WARNING,t.BlockSvg.COLLAPSED_WARNING_ID),this.warning||(this.warning=new t.Warning(this),i=!0),this.warning.setText(e,s)}else this.warning&&!s?(this.warning.dispose(),i=!0):this.warning&&(i=this.warning.getText(),this.warning.setText("",s),(r=this.warning.getText())||this.warning.dispose(),i=i!=r);i&&this.rendered&&(this.render(),this.bumpNeighbours())}},t.BlockSvg.prototype.setMutator=function(e){this.mutator&&this.mutator!==e&&this.mutator.dispose(),e&&(e.setBlock(this),this.mutator=e,e.createIcon()),this.rendered&&(this.render(),this.bumpNeighbours())},t.BlockSvg.prototype.setEnabled=function(e){this.isEnabled()!=e&&(t.BlockSvg.superClass_.setEnabled.call(this,e),this.rendered&&!this.getInheritedDisabled()&&this.updateDisabled())},t.BlockSvg.prototype.setHighlighted=function(e){this.rendered&&this.pathObject.updateHighlighted(e)},t.BlockSvg.prototype.addSelect=function(){this.pathObject.updateSelected(!0)},t.BlockSvg.prototype.removeSelect=function(){this.pathObject.updateSelected(!1)},t.BlockSvg.prototype.setDeleteStyle=function(e){this.pathObject.updateDraggingDelete(e)},t.BlockSvg.prototype.getColour=function(){return this.style.colourPrimary},t.BlockSvg.prototype.setColour=function(e){t.BlockSvg.superClass_.setColour.call(this,e),e=this.workspace.getRenderer().getConstants().getBlockStyleForColour(this.colour_),this.pathObject.setStyle(e.style),this.style=e.style,this.styleName_=e.name,this.applyColour()},t.BlockSvg.prototype.setStyle=function(e){var i=this.workspace.getRenderer().getConstants().getBlockStyle(e);if(this.styleName_=e,i)this.hat=i.hat,this.pathObject.setStyle(i),this.colour_=i.colourPrimary,this.style=i,this.applyColour();else throw Error("Invalid style name: "+e)},t.BlockSvg.prototype.bringToFront=function(){var e=this;do{var i=e.getSvgRoot(),s=i.parentNode,r=s.childNodes;r[r.length-1]!==i&&s.appendChild(i),e=e.getParent()}while(e)},t.BlockSvg.prototype.setPreviousStatement=function(e,i){t.BlockSvg.superClass_.setPreviousStatement.call(this,e,i),this.rendered&&(this.render(),this.bumpNeighbours())},t.BlockSvg.prototype.setNextStatement=function(e,i){t.BlockSvg.superClass_.setNextStatement.call(this,e,i),this.rendered&&(this.render(),this.bumpNeighbours())},t.BlockSvg.prototype.setOutput=function(e,i){t.BlockSvg.superClass_.setOutput.call(this,e,i),this.rendered&&(this.render(),this.bumpNeighbours())},t.BlockSvg.prototype.setInputsInline=function(e){t.BlockSvg.superClass_.setInputsInline.call(this,e),this.rendered&&(this.render(),this.bumpNeighbours())},t.BlockSvg.prototype.removeInput=function(e,i){return e=t.BlockSvg.superClass_.removeInput.call(this,e,i),this.rendered&&(this.render(),this.bumpNeighbours()),e},t.BlockSvg.prototype.moveNumberedInputBefore=function(e,i){t.BlockSvg.superClass_.moveNumberedInputBefore.call(this,e,i),this.rendered&&(this.render(),this.bumpNeighbours())},t.BlockSvg.prototype.appendInput_=function(e,i){return e=t.BlockSvg.superClass_.appendInput_.call(this,e,i),this.rendered&&(this.render(),this.bumpNeighbours()),e},t.BlockSvg.prototype.setConnectionTracking=function(e){if(this.previousConnection&&this.previousConnection.setTracking(e),this.outputConnection&&this.outputConnection.setTracking(e),this.nextConnection){this.nextConnection.setTracking(e);var i=this.nextConnection.targetBlock();i&&i.setConnectionTracking(e)}if(!this.collapsed_)for(i=0;i<this.inputList.length;i++){var s=this.inputList[i].connection;s&&(s.setTracking(e),(s=s.targetBlock())&&s.setConnectionTracking(e))}},t.BlockSvg.prototype.getConnections_=function(e){var i=[];if((e||this.rendered)&&(this.outputConnection&&i.push(this.outputConnection),this.previousConnection&&i.push(this.previousConnection),this.nextConnection&&i.push(this.nextConnection),e||!this.collapsed_)){e=0;for(var s;s=this.inputList[e];e++)s.connection&&i.push(s.connection)}return i},t.BlockSvg.prototype.lastConnectionInStack=function(){return t.BlockSvg.superClass_.lastConnectionInStack.call(this)},t.BlockSvg.prototype.getMatchingConnection=function(e,i){return t.BlockSvg.superClass_.getMatchingConnection.call(this,e,i)},t.BlockSvg.prototype.makeConnection_=function(e){return new t.RenderedConnection(this,e)},t.BlockSvg.prototype.bumpNeighbours=function(){if(this.workspace&&!this.workspace.isDragging()){var e=this.getRootBlock();if(!e.isInFlyout)for(var i=this.getConnections_(!1),s=0,r;r=i[s];s++){r.isConnected()&&r.isSuperior()&&r.targetBlock().bumpNeighbours();for(var o=r.neighbours(t.SNAP_RADIUS),h=0,u;u=o[h];h++)r.isConnected()&&u.isConnected()||u.getSourceBlock().getRootBlock()!=e&&(r.isSuperior()?u.bumpAwayFrom(r):r.bumpAwayFrom(u))}}},t.BlockSvg.prototype.scheduleSnapAndBump=function(){var e=this,i=t.Events.getGroup();setTimeout(function(){t.Events.setGroup(i),e.snapToGrid(),t.Events.setGroup(!1)},t.BUMP_DELAY/2),setTimeout(function(){t.Events.setGroup(i),e.bumpNeighbours(),t.Events.setGroup(!1)},t.BUMP_DELAY)},t.BlockSvg.prototype.positionNearConnection=function(e,i){e.type!=t.connectionTypes.NEXT_STATEMENT&&e.type!=t.connectionTypes.INPUT_VALUE||this.moveBy(i.x-e.x,i.y-e.y)},t.BlockSvg.prototype.getParent=function(){return t.BlockSvg.superClass_.getParent.call(this)},t.BlockSvg.prototype.getRootBlock=function(){return t.BlockSvg.superClass_.getRootBlock.call(this)},t.BlockSvg.prototype.render=function(e){if(!this.renderIsInProgress_){this.renderIsInProgress_=!0;try{if(this.rendered=!0,t.utils.dom.startTextWidthCache(),this.isCollapsed()&&this.updateCollapsed_(),this.workspace.getRenderer().render(this),this.updateConnectionLocations_(),e!==!1){var i=this.getParent();i?i.render(!0):this.workspace.resizeContents()}t.utils.dom.stopTextWidthCache(),this.updateMarkers_()}finally{this.renderIsInProgress_=!1}}},t.BlockSvg.prototype.updateMarkers_=function(){this.workspace.keyboardAccessibilityMode&&this.pathObject.cursorSvg&&this.workspace.getCursor().draw(),this.workspace.keyboardAccessibilityMode&&this.pathObject.markerSvg&&this.workspace.getMarker(t.MarkerManager.LOCAL_MARKER).draw()},t.BlockSvg.prototype.updateConnectionLocations_=function(){var e=this.getRelativeToSurfaceXY();this.previousConnection&&this.previousConnection.moveToOffset(e),this.outputConnection&&this.outputConnection.moveToOffset(e);for(var i=0;i<this.inputList.length;i++){var s=this.inputList[i].connection;s&&(s.moveToOffset(e),s.isConnected()&&s.tighten())}this.nextConnection&&(this.nextConnection.moveToOffset(e),this.nextConnection.isConnected()&&this.nextConnection.tighten())},t.BlockSvg.prototype.setCursorSvg=function(e){this.pathObject.setCursorSvg(e)},t.BlockSvg.prototype.setMarkerSvg=function(e){this.pathObject.setMarkerSvg(e)},t.BlockSvg.prototype.getHeightWidth=function(){var e=this.height,i=this.width,s=this.getNextBlock();if(s){s=s.getHeightWidth();var r=this.workspace.getRenderer().getConstants().NOTCH_HEIGHT;e+=s.height-r,i=Math.max(i,s.width)}return{height:e,width:i}},t.BlockSvg.prototype.fadeForReplacement=function(e){this.pathObject.updateReplacementFade(e)},t.BlockSvg.prototype.highlightShapeForInput=function(e,i){this.pathObject.updateShapeForInputHighlight(e,i)},t.ConnectionDB=function(e){this.connections_=[],this.connectionChecker_=e},t.ConnectionDB.prototype.addConnection=function(e,i){i=this.calculateIndexForYPos_(i),this.connections_.splice(i,0,e)},t.ConnectionDB.prototype.findIndexOfConnection_=function(e,i){if(!this.connections_.length)return-1;var s=this.calculateIndexForYPos_(i);if(s>=this.connections_.length)return-1;i=e.y;for(var r=s;0<=r&&this.connections_[r].y==i;){if(this.connections_[r]==e)return r;r--}for(;s<this.connections_.length&&this.connections_[s].y==i;){if(this.connections_[s]==e)return s;s++}return-1},t.ConnectionDB.prototype.calculateIndexForYPos_=function(e){if(!this.connections_.length)return 0;for(var i=0,s=this.connections_.length;i<s;){var r=Math.floor((i+s)/2);if(this.connections_[r].y<e)i=r+1;else if(this.connections_[r].y>e)s=r;else{i=r;break}}return i},t.ConnectionDB.prototype.removeConnection=function(e,i){if(e=this.findIndexOfConnection_(e,i),e==-1)throw Error("Unable to find connection in connectionDB.");this.connections_.splice(e,1)},t.ConnectionDB.prototype.getNeighbours=function(e,i){function s(f){var g=o-r[f].x,_=h-r[f].y;return Math.sqrt(g*g+_*_)<=i&&d.push(r[f]),_<i}var r=this.connections_,o=e.x,h=e.y;e=0;for(var u=r.length-2,p=u;e<p;)r[p].y<h?e=p:u=p,p=Math.floor((e+u)/2);var d=[];if(u=e=p,r.length){for(;0<=e&&s(e);)e--;do u++;while(u<r.length&&s(u))}return d},t.ConnectionDB.prototype.isInYRange_=function(e,i,s){return Math.abs(this.connections_[e].y-i)<=s},t.ConnectionDB.prototype.searchForClosest=function(e,i,s){if(!this.connections_.length)return{connection:null,radius:i};var r=e.y,o=e.x;e.x=o+s.x,e.y=r+s.y;var h=this.calculateIndexForYPos_(e.y);s=null;for(var u=i,p,d=h-1;0<=d&&this.isInYRange_(d,e.y,i);)p=this.connections_[d],this.connectionChecker_.canConnect(e,p,!0,u)&&(s=p,u=p.distanceFrom(e)),d--;for(;h<this.connections_.length&&this.isInYRange_(h,e.y,i);)p=this.connections_[h],this.connectionChecker_.canConnect(e,p,!0,u)&&(s=p,u=p.distanceFrom(e)),h++;return e.x=o,e.y=r,{connection:s,radius:u}},t.ConnectionDB.init=function(e){var i=[];return i[t.connectionTypes.INPUT_VALUE]=new t.ConnectionDB(e),i[t.connectionTypes.OUTPUT_VALUE]=new t.ConnectionDB(e),i[t.connectionTypes.NEXT_STATEMENT]=new t.ConnectionDB(e),i[t.connectionTypes.PREVIOUS_STATEMENT]=new t.ConnectionDB(e),i},t.Events.ThemeChange=function(e,i){t.Events.ThemeChange.superClass_.constructor.call(this,i),this.themeName=e},t.utils.object.inherits(t.Events.ThemeChange,t.Events.UiBase),t.Events.ThemeChange.prototype.type=t.Events.THEME_CHANGE,t.Events.ThemeChange.prototype.toJson=function(){var e=t.Events.ThemeChange.superClass_.toJson.call(this);return e.themeName=this.themeName,e},t.Events.ThemeChange.prototype.fromJson=function(e){t.Events.ThemeChange.superClass_.fromJson.call(this,e),this.themeName=e.themeName},t.registry.register(t.registry.Type.EVENT,t.Events.THEME_CHANGE,t.Events.ThemeChange),t.Events.ViewportChange=function(e,i,s,r,o){t.Events.ViewportChange.superClass_.constructor.call(this,r),this.viewTop=e,this.viewLeft=i,this.scale=s,this.oldScale=o},t.utils.object.inherits(t.Events.ViewportChange,t.Events.UiBase),t.Events.ViewportChange.prototype.type=t.Events.VIEWPORT_CHANGE,t.Events.ViewportChange.prototype.toJson=function(){var e=t.Events.ViewportChange.superClass_.toJson.call(this);return e.viewTop=this.viewTop,e.viewLeft=this.viewLeft,e.scale=this.scale,e.oldScale=this.oldScale,e},t.Events.ViewportChange.prototype.fromJson=function(e){t.Events.ViewportChange.superClass_.fromJson.call(this,e),this.viewTop=e.viewTop,this.viewLeft=e.viewLeft,this.scale=e.scale,this.oldScale=e.oldScale},t.registry.register(t.registry.Type.EVENT,t.Events.VIEWPORT_CHANGE,t.Events.ViewportChange),t.MarkerManager=function(e){this.cursorSvg_=this.cursor_=null,this.markers_={},this.workspace_=e},t.MarkerManager.LOCAL_MARKER="local_marker_1",t.MarkerManager.prototype.registerMarker=function(e,i){this.markers_[e]&&this.unregisterMarker(e),i.setDrawer(this.workspace_.getRenderer().makeMarkerDrawer(this.workspace_,i)),this.setMarkerSvg(i.getDrawer().createDom()),this.markers_[e]=i},t.MarkerManager.prototype.unregisterMarker=function(e){var i=this.markers_[e];if(i)i.dispose(),delete this.markers_[e];else throw Error("Marker with id "+e+" does not exist. Can only unregistermarkers that exist.")},t.MarkerManager.prototype.getCursor=function(){return this.cursor_},t.MarkerManager.prototype.getMarker=function(e){return this.markers_[e]},t.MarkerManager.prototype.setCursor=function(e){this.cursor_&&this.cursor_.getDrawer()&&this.cursor_.getDrawer().dispose(),(this.cursor_=e)&&(e=this.workspace_.getRenderer().makeMarkerDrawer(this.workspace_,this.cursor_),this.cursor_.setDrawer(e),this.setCursorSvg(this.cursor_.getDrawer().createDom()))},t.MarkerManager.prototype.setCursorSvg=function(e){e?(this.workspace_.getBlockCanvas().appendChild(e),this.cursorSvg_=e):this.cursorSvg_=null},t.MarkerManager.prototype.setMarkerSvg=function(e){e?this.workspace_.getBlockCanvas()&&(this.cursorSvg_?this.workspace_.getBlockCanvas().insertBefore(e,this.cursorSvg_):this.workspace_.getBlockCanvas().appendChild(e)):this.markerSvg_=null},t.MarkerManager.prototype.updateMarkers=function(){this.workspace_.keyboardAccessibilityMode&&this.cursorSvg_&&this.workspace_.getCursor().draw()},t.MarkerManager.prototype.dispose=function(){for(var e=Object.keys(this.markers_),i=0,s;s=e[i];i++)this.unregisterMarker(s);this.markers_=null,this.cursor_&&(this.cursor_.dispose(),this.cursor_=null)},t.IMetricsManager=function(){},t.MetricsManager=function(e){this.workspace_=e},t.MetricsManager.prototype.getDimensionsPx_=function(e){var i=0,s=0;return e&&(i=e.getWidth(),s=e.getHeight()),new t.utils.Size(i,s)},t.MetricsManager.prototype.getFlyoutMetrics=function(e){return e=this.getDimensionsPx_(this.workspace_.getFlyout(e)),{width:e.width,height:e.height,position:this.workspace_.toolboxPosition}},t.MetricsManager.prototype.getToolboxMetrics=function(){var e=this.getDimensionsPx_(this.workspace_.getToolbox());return{width:e.width,height:e.height,position:this.workspace_.toolboxPosition}},t.MetricsManager.prototype.getSvgMetrics=function(){return this.workspace_.getCachedParentSvgSize()},t.MetricsManager.prototype.getAbsoluteMetrics=function(){var e=0,i=this.getToolboxMetrics(),s=this.getFlyoutMetrics(!0),r=!!this.workspace_.getToolbox(),o=!!this.workspace_.getFlyout(!0),h=r?i.position:s.position,u=h==t.utils.toolbox.Position.LEFT;return h=h==t.utils.toolbox.Position.TOP,r&&u?e=i.width:o&&u&&(e=s.width),u=0,r&&h?u=i.height:o&&h&&(u=s.height),{top:u,left:e}},t.MetricsManager.prototype.getViewMetrics=function(e){e=e?this.workspace_.scale:1;var i=this.getSvgMetrics(),s=this.getToolboxMetrics(),r=this.getFlyoutMetrics(!0),o=this.workspace_.getToolbox()?s.position:r.position;return this.workspace_.getToolbox()?o==t.utils.toolbox.Position.TOP||o==t.utils.toolbox.Position.BOTTOM?i.height-=s.height:(o==t.utils.toolbox.Position.LEFT||o==t.utils.toolbox.Position.RIGHT)&&(i.width-=s.width):this.workspace_.getFlyout(!0)&&(o==t.utils.toolbox.Position.TOP||o==t.utils.toolbox.Position.BOTTOM?i.height-=r.height:(o==t.utils.toolbox.Position.LEFT||o==t.utils.toolbox.Position.RIGHT)&&(i.width-=r.width)),{height:i.height/e,width:i.width/e,top:-this.workspace_.scrollY/e,left:-this.workspace_.scrollX/e}},t.MetricsManager.prototype.getContentMetrics=function(e){e=e?1:this.workspace_.scale;var i=this.workspace_.getBlocksBoundingBox();return{height:(i.bottom-i.top)*e,width:(i.right-i.left)*e,top:i.top*e,left:i.left*e}},t.MetricsManager.prototype.hasFixedEdges=function(){return!this.workspace_.isMovableHorizontally()||!this.workspace_.isMovableVertically()},t.MetricsManager.prototype.getComputedFixedEdges_=function(e){if(!this.hasFixedEdges())return{};var i=this.workspace_.isMovableHorizontally(),s=this.workspace_.isMovableVertically();e=e||this.getViewMetrics(!1);var r={};return s||(r.top=e.top,r.bottom=e.top+e.height),i||(r.left=e.left,r.right=e.left+e.width),r},t.MetricsManager.prototype.getPaddedContent_=function(e,i){var s=i.top+i.height,r=i.left+i.width,o=e.width;e=e.height;var h=o/2,u=e/2;return{top:Math.min(i.top-u,s-e),bottom:Math.max(s+u,i.top+e),left:Math.min(i.left-h,r-o),right:Math.max(r+h,i.left+o)}},t.MetricsManager.prototype.getScrollMetrics=function(e,i,s){e=e?this.workspace_.scale:1,i=i||this.getViewMetrics(!1);var r=s||this.getContentMetrics();s=this.getComputedFixedEdges_(i),i=this.getPaddedContent_(i,r),r=s.top!==void 0?s.top:i.top;var o=s.left!==void 0?s.left:i.left;return{top:r/e,left:o/e,width:((s.right!==void 0?s.right:i.right)-o)/e,height:((s.bottom!==void 0?s.bottom:i.bottom)-r)/e}},t.MetricsManager.prototype.getUiMetrics=function(){return{viewMetrics:this.getViewMetrics(),absoluteMetrics:this.getAbsoluteMetrics(),toolboxMetrics:this.getToolboxMetrics()}},t.MetricsManager.prototype.getMetrics=function(){var e=this.getToolboxMetrics(),i=this.getFlyoutMetrics(!0),s=this.getSvgMetrics(),r=this.getAbsoluteMetrics(),o=this.getViewMetrics(),h=this.getContentMetrics(),u=this.getScrollMetrics(!1,o,h);return{contentHeight:h.height,contentWidth:h.width,contentTop:h.top,contentLeft:h.left,scrollHeight:u.height,scrollWidth:u.width,scrollTop:u.top,scrollLeft:u.left,viewHeight:o.height,viewWidth:o.width,viewTop:o.top,viewLeft:o.left,absoluteTop:r.top,absoluteLeft:r.left,svgHeight:s.height,svgWidth:s.width,toolboxWidth:e.width,toolboxHeight:e.height,toolboxPosition:e.position,flyoutWidth:i.width,flyoutHeight:i.height}},t.registry.register(t.registry.Type.METRICS_MANAGER,t.registry.DEFAULT,t.MetricsManager),t.FlyoutMetricsManager=function(e,i){this.flyout_=i,t.FlyoutMetricsManager.superClass_.constructor.call(this,e)},t.utils.object.inherits(t.FlyoutMetricsManager,t.MetricsManager),t.FlyoutMetricsManager.prototype.getBoundingBox_=function(){try{var e=this.workspace_.getCanvas().getBBox()}catch{e={height:0,y:0,width:0,x:0}}return e},t.FlyoutMetricsManager.prototype.getContentMetrics=function(e){var i=this.getBoundingBox_();return e=e?1:this.workspace_.scale,{height:i.height*e,width:i.width*e,top:i.y*e,left:i.x*e}},t.FlyoutMetricsManager.prototype.getScrollMetrics=function(e,i,s){return i=s||this.getContentMetrics(),s=this.flyout_.MARGIN*this.workspace_.scale,e=e?this.workspace_.scale:1,{height:(i.height+2*s)/e,width:(i.width+i.left+s)/e,top:0,left:0}},t.FlyoutMetricsManager.prototype.getViewMetrics=function(e){var i=this.getSvgMetrics();if(e=e?this.workspace_.scale:1,this.flyout_.horizontalLayout){var s=i.width-2*this.flyout_.SCROLLBAR_PADDING;i=i.height-this.flyout_.SCROLLBAR_PADDING}else s=i.width-this.flyout_.SCROLLBAR_PADDING,i=i.height-2*this.flyout_.SCROLLBAR_PADDING;return{height:i/e,width:s/e,top:-this.workspace_.scrollY/e,left:-this.workspace_.scrollX/e}},t.FlyoutMetricsManager.prototype.getAbsoluteMetrics=function(){var e=this.flyout_.SCROLLBAR_PADDING;return this.flyout_.horizontalLayout?{top:0,left:e}:{top:e,left:0}},t.PluginManager=function(){this.pluginData_={},this.typeToPluginIds_={}},t.PluginManager.prototype.addPlugin=function(e){this.pluginData_[e.id]=e;for(var i=0,s;s=e.types[i];i++)s=String(s).toLowerCase(),this.typeToPluginIds_[s]===void 0?this.typeToPluginIds_[s]=[e.id]:this.typeToPluginIds_[s].push(e.id)},t.PluginManager.prototype.getPlugin=function(e){return this.pluginData_[e]&&this.pluginData_[e].plugin},t.PluginManager.prototype.getPlugins=function(e,i){if(e=String(e).toLowerCase(),e=this.typeToPluginIds_[e],!e)return[];var s=[];if(i){var r=[],o=this.pluginData_;e.forEach(function(h){r.push(o[h])}),r.sort(function(h,u){return h.weight-u.weight}),r.forEach(function(h){s.push(h.plugin)})}else o=this.pluginData_,e.forEach(function(h){s.push(o[h].plugin)});return s},t.PluginManager.Type=function(e){this.name_=e},t.PluginManager.Type.prototype.toString=function(){return this.name_},t.PluginManager.Type.POSITIONABLE=new t.PluginManager.Type("positionable"),t.ThemeManager=function(e,i){this.workspace_=e,this.theme_=i,this.subscribedWorkspaces_=[],this.componentDB_=Object.create(null)},t.ThemeManager.prototype.getTheme=function(){return this.theme_},t.ThemeManager.prototype.setTheme=function(e){var i=this.theme_;for(this.theme_=e,(e=this.workspace_.getInjectionDiv())&&(i&&t.utils.dom.removeClass(e,i.getClassName()),t.utils.dom.addClass(e,this.theme_.getClassName())),i=0;e=this.subscribedWorkspaces_[i];i++)e.refreshTheme();i=0,e=Object.keys(this.componentDB_);for(var s;s=e[i];i++)for(var r=0,o;o=this.componentDB_[s][r];r++){var h=o.element;o=o.propertyName;var u=this.theme_&&this.theme_.getComponentStyle(s);h.style[o]=u||""}t.hideChaff()},t.ThemeManager.prototype.subscribeWorkspace=function(e){this.subscribedWorkspaces_.push(e)},t.ThemeManager.prototype.unsubscribeWorkspace=function(e){if(e=this.subscribedWorkspaces_.indexOf(e),0>e)throw Error("Cannot unsubscribe a workspace that hasn't been subscribed.");this.subscribedWorkspaces_.splice(e,1)},t.ThemeManager.prototype.subscribe=function(e,i,s){this.componentDB_[i]||(this.componentDB_[i]=[]),this.componentDB_[i].push({element:e,propertyName:s}),i=this.theme_&&this.theme_.getComponentStyle(i),e.style[s]=i||""},t.ThemeManager.prototype.unsubscribe=function(e){if(e)for(var i=Object.keys(this.componentDB_),s=0,r;r=i[s];s++){for(var o=this.componentDB_[r],h=o.length-1;0<=h;h--)o[h].element===e&&o.splice(h,1);this.componentDB_[r].length||delete this.componentDB_[r]}},t.ThemeManager.prototype.dispose=function(){this.componentDB_=this.subscribedWorkspaces_=this.theme_=this.owner_=null},t.TouchGesture=function(e,i){t.TouchGesture.superClass_.constructor.call(this,e,i),this.isMultiTouch_=!1,this.cachedPoints_=Object.create(null),this.startDistance_=this.previousScale_=0,this.isPinchZoomEnabled_=this.onStartWrapper_=null},t.utils.object.inherits(t.TouchGesture,t.Gesture),t.TouchGesture.ZOOM_IN_MULTIPLIER=5,t.TouchGesture.ZOOM_OUT_MULTIPLIER=6,t.TouchGesture.prototype.doStart=function(e){this.isPinchZoomEnabled_=this.startWorkspace_.options.zoomOptions&&this.startWorkspace_.options.zoomOptions.pinch,t.TouchGesture.superClass_.doStart.call(this,e),!this.isEnding_&&t.Touch.isTouchEvent(e)&&this.handleTouchStart(e)},t.TouchGesture.prototype.bindMouseEvents=function(e){this.onStartWrapper_=t.browserEvents.conditionalBind(document,"mousedown",null,this.handleStart.bind(this),!0),this.onMoveWrapper_=t.browserEvents.conditionalBind(document,"mousemove",null,this.handleMove.bind(this),!0),this.onUpWrapper_=t.browserEvents.conditionalBind(document,"mouseup",null,this.handleUp.bind(this),!0),e.preventDefault(),e.stopPropagation()},t.TouchGesture.prototype.handleStart=function(e){!this.isDragging()&&t.Touch.isTouchEvent(e)&&(this.handleTouchStart(e),this.isMultiTouch()&&t.longStop_())},t.TouchGesture.prototype.handleMove=function(e){this.isDragging()?t.Touch.shouldHandleEvent(e)&&t.TouchGesture.superClass_.handleMove.call(this,e):this.isMultiTouch()?(t.Touch.isTouchEvent(e)&&this.handleTouchMove(e),t.longStop_()):t.TouchGesture.superClass_.handleMove.call(this,e)},t.TouchGesture.prototype.handleUp=function(e){t.Touch.isTouchEvent(e)&&!this.isDragging()&&this.handleTouchEnd(e),!this.isMultiTouch()||this.isDragging()?t.Touch.shouldHandleEvent(e)&&t.TouchGesture.superClass_.handleUp.call(this,e):(e.preventDefault(),e.stopPropagation(),this.dispose())},t.TouchGesture.prototype.isMultiTouch=function(){return this.isMultiTouch_},t.TouchGesture.prototype.dispose=function(){t.TouchGesture.superClass_.dispose.call(this),this.onStartWrapper_&&t.browserEvents.unbind(this.onStartWrapper_)},t.TouchGesture.prototype.handleTouchStart=function(e){var i=t.Touch.getTouchIdentifierFromEvent(e);this.cachedPoints_[i]=this.getTouchPoint(e),i=Object.keys(this.cachedPoints_),i.length==2&&(this.startDistance_=t.utils.Coordinate.distance(this.cachedPoints_[i[0]],this.cachedPoints_[i[1]]),this.isMultiTouch_=!0,e.preventDefault())},t.TouchGesture.prototype.handleTouchMove=function(e){var i=t.Touch.getTouchIdentifierFromEvent(e);this.cachedPoints_[i]=this.getTouchPoint(e),i=Object.keys(this.cachedPoints_),this.isPinchZoomEnabled_&&i.length===2?this.handlePinch_(e):t.TouchGesture.superClass_.handleMove.call(this,e)},t.TouchGesture.prototype.handlePinch_=function(e){var i=Object.keys(this.cachedPoints_);if(i=t.utils.Coordinate.distance(this.cachedPoints_[i[0]],this.cachedPoints_[i[1]])/this.startDistance_,0<this.previousScale_&&1/0>this.previousScale_){var s=i-this.previousScale_;s=0<s?s*t.TouchGesture.ZOOM_IN_MULTIPLIER:s*t.TouchGesture.ZOOM_OUT_MULTIPLIER;var r=this.startWorkspace_,o=t.utils.mouseToSvg(e,r.getParentSvg(),r.getInverseScreenCTM());r.zoom(o.x,o.y,s)}this.previousScale_=i,e.preventDefault()},t.TouchGesture.prototype.handleTouchEnd=function(e){e=t.Touch.getTouchIdentifierFromEvent(e),this.cachedPoints_[e]&&delete this.cachedPoints_[e],2>Object.keys(this.cachedPoints_).length&&(this.cachedPoints_=Object.create(null),this.previousScale_=0)},t.TouchGesture.prototype.getTouchPoint=function(e){return this.startWorkspace_?new t.utils.Coordinate(e.pageX?e.pageX:e.changedTouches[0].pageX,e.pageY?e.pageY:e.changedTouches[0].pageY):null},t.WorkspaceAudio=function(e){this.parentWorkspace_=e,this.SOUNDS_=Object.create(null)},t.WorkspaceAudio.prototype.lastSound_=null,t.WorkspaceAudio.prototype.dispose=function(){this.SOUNDS_=this.parentWorkspace_=null},t.WorkspaceAudio.prototype.load=function(e,i){if(e.length){try{var s=new t.utils.global.Audio}catch{return}for(var r,o=0;o<e.length;o++){var h=e[o],u=h.match(/\.(\w+)$/);if(u&&s.canPlayType("audio/"+u[1])){r=new t.utils.global.Audio(h);break}}r&&r.play&&(this.SOUNDS_[i]=r)}},t.WorkspaceAudio.prototype.preload=function(){for(var e in this.SOUNDS_){var i=this.SOUNDS_[e];i.volume=.01;var s=i.play();if(s!==void 0?s.then(i.pause).catch(function(){}):i.pause(),t.utils.userAgent.IPAD||t.utils.userAgent.IPHONE)break}},t.WorkspaceAudio.prototype.play=function(e,i){var s=this.SOUNDS_[e];s?(e=new Date,this.lastSound_!=null&&e-this.lastSound_<t.SOUND_LIMIT||(this.lastSound_=e,s=t.utils.userAgent.IPAD||t.utils.userAgent.ANDROID?s:s.cloneNode(),s.volume=i===void 0?1:i,s.play())):this.parentWorkspace_&&this.parentWorkspace_.getAudioManager().play(e,i)},t.WorkspaceSvg=function(e,i,s){t.WorkspaceSvg.superClass_.constructor.call(this,e),this.metricsManager_=new(t.registry.getClassFromOptions(t.registry.Type.METRICS_MANAGER,e,!0))(this),this.getMetrics=e.getMetrics||this.metricsManager_.getMetrics.bind(this.metricsManager_),this.setMetrics=e.setMetrics||t.WorkspaceSvg.setTopLevelWorkspaceMetrics_,this.pluginManager_=new t.PluginManager,this.connectionDBList=t.ConnectionDB.init(this.connectionChecker),i&&(this.blockDragSurface_=i),s&&(this.workspaceDragSurface_=s),this.useWorkspaceDragSurface_=!!this.workspaceDragSurface_&&t.utils.is3dSupported(),this.highlightedBlocks_=[],this.audioManager_=new t.WorkspaceAudio(e.parentWorkspace),this.grid_=this.options.gridPattern?new t.Grid(this.options.gridPattern,e.gridOptions):null,this.markerManager_=new t.MarkerManager(this),this.toolboxCategoryCallbacks_={},this.flyoutButtonCallbacks_={},t.Variables&&t.Variables.flyoutCategory&&this.registerToolboxCategoryCallback(t.VARIABLE_CATEGORY_NAME,t.Variables.flyoutCategory),t.VariablesDynamic&&t.VariablesDynamic.flyoutCategory&&this.registerToolboxCategoryCallback(t.VARIABLE_DYNAMIC_CATEGORY_NAME,t.VariablesDynamic.flyoutCategory),t.Procedures&&t.Procedures.flyoutCategory&&(this.registerToolboxCategoryCallback(t.PROCEDURE_CATEGORY_NAME,t.Procedures.flyoutCategory),this.addChangeListener(t.Procedures.mutatorOpenListener)),this.themeManager_=this.options.parentWorkspace?this.options.parentWorkspace.getThemeManager():new t.ThemeManager(this,this.options.theme||t.Themes.Classic),this.themeManager_.subscribeWorkspace(this),this.renderer_=t.blockRendering.init(this.options.renderer||"geras",this.getTheme(),this.options.rendererOverrides),this.cachedParentSvg_=null,this.keyboardAccessibilityMode=!1,this.topBoundedElements_=[],this.cachedParentSvgSize_=new t.utils.Size(0,0)},t.utils.object.inherits(t.WorkspaceSvg,t.Workspace),t.WorkspaceSvg.prototype.resizeHandlerWrapper_=null,t.WorkspaceSvg.prototype.rendered=!0,t.WorkspaceSvg.prototype.isVisible_=!0,t.WorkspaceSvg.prototype.isFlyout=!1,t.WorkspaceSvg.prototype.isMutator=!1,t.WorkspaceSvg.prototype.resizesEnabled_=!0,t.WorkspaceSvg.prototype.scrollX=0,t.WorkspaceSvg.prototype.scrollY=0,t.WorkspaceSvg.prototype.startScrollX=0,t.WorkspaceSvg.prototype.startScrollY=0,t.WorkspaceSvg.prototype.dragDeltaXY_=null,t.WorkspaceSvg.prototype.scale=1,t.WorkspaceSvg.prototype.oldScale_=1,t.WorkspaceSvg.prototype.oldTop_=0,t.WorkspaceSvg.prototype.oldLeft_=0,t.WorkspaceSvg.prototype.trashcan=null,t.WorkspaceSvg.prototype.scrollbar=null,t.WorkspaceSvg.prototype.flyout_=null,t.WorkspaceSvg.prototype.toolbox_=null,t.WorkspaceSvg.prototype.currentGesture_=null,t.WorkspaceSvg.prototype.blockDragSurface_=null,t.WorkspaceSvg.prototype.workspaceDragSurface_=null,t.WorkspaceSvg.prototype.useWorkspaceDragSurface_=!1,t.WorkspaceSvg.prototype.isDragSurfaceActive_=!1,t.WorkspaceSvg.prototype.injectionDiv_=null,t.WorkspaceSvg.prototype.lastRecordedPageScroll_=null,t.WorkspaceSvg.prototype.targetWorkspace=null,t.WorkspaceSvg.prototype.inverseScreenCTM_=null,t.WorkspaceSvg.prototype.inverseScreenCTMDirty_=!0,t.WorkspaceSvg.prototype.getMarkerManager=function(){return this.markerManager_},t.WorkspaceSvg.prototype.getMetricsManager=function(){return this.metricsManager_},t.WorkspaceSvg.prototype.setMetricsManager=function(e){this.metricsManager_=e,this.getMetrics=this.metricsManager_.getMetrics.bind(this.metricsManager_)},t.WorkspaceSvg.prototype.getPluginManager=function(){return this.pluginManager_},t.WorkspaceSvg.prototype.setCursorSvg=function(e){this.markerManager_.setCursorSvg(e)},t.WorkspaceSvg.prototype.setMarkerSvg=function(e){this.markerManager_.setMarkerSvg(e)},t.WorkspaceSvg.prototype.getMarker=function(e){return this.markerManager_?this.markerManager_.getMarker(e):null},t.WorkspaceSvg.prototype.getCursor=function(){return this.markerManager_?this.markerManager_.getCursor():null},t.WorkspaceSvg.prototype.getRenderer=function(){return this.renderer_},t.WorkspaceSvg.prototype.getThemeManager=function(){return this.themeManager_},t.WorkspaceSvg.prototype.getTheme=function(){return this.themeManager_.getTheme()},t.WorkspaceSvg.prototype.setTheme=function(e){e||(e=t.Themes.Classic),this.themeManager_.setTheme(e)},t.WorkspaceSvg.prototype.refreshTheme=function(){this.svgGroup_&&this.renderer_.refreshDom(this.svgGroup_,this.getTheme()),this.updateBlockStyles_(this.getAllBlocks(!1).filter(function(i){return i.getStyleName()!==void 0})),this.refreshToolboxSelection(),this.toolbox_&&this.toolbox_.refreshTheme(),this.isVisible()&&this.setVisible(!0);var e=new(t.Events.get(t.Events.THEME_CHANGE))(this.getTheme().name,this.id);t.Events.fire(e)},t.WorkspaceSvg.prototype.updateBlockStyles_=function(e){for(var i=0,s;s=e[i];i++){var r=s.getStyleName();r&&(s.setStyle(r),s.mutator&&s.mutator.updateBlockStyle())}},t.WorkspaceSvg.prototype.getInverseScreenCTM=function(){if(this.inverseScreenCTMDirty_){var e=this.getParentSvg().getScreenCTM();e&&(this.inverseScreenCTM_=e.inverse(),this.inverseScreenCTMDirty_=!1)}return this.inverseScreenCTM_},t.WorkspaceSvg.prototype.updateInverseScreenCTM=function(){this.inverseScreenCTMDirty_=!0},t.WorkspaceSvg.prototype.isVisible=function(){return this.isVisible_},t.WorkspaceSvg.prototype.getSvgXY=function(e){var i=0,s=0,r=1;(t.utils.dom.containsNode(this.getCanvas(),e)||t.utils.dom.containsNode(this.getBubbleCanvas(),e))&&(r=this.scale);do{var o=t.utils.getRelativeXY(e);(e==this.getCanvas()||e==this.getBubbleCanvas())&&(r=1),i+=o.x*r,s+=o.y*r,e=e.parentNode}while(e&&e!=this.getParentSvg());return new t.utils.Coordinate(i,s)},t.WorkspaceSvg.prototype.getCachedParentSvgSize=function(){var e=this.cachedParentSvgSize_;return new t.utils.Size(e.width,e.height)},t.WorkspaceSvg.prototype.getOriginOffsetInPixels=function(){return t.utils.getInjectionDivXY_(this.getCanvas())},t.WorkspaceSvg.prototype.getInjectionDiv=function(){if(!this.injectionDiv_)for(var e=this.svgGroup_;e;){if((" "+(e.getAttribute("class")||"")+" ").indexOf(" injectionDiv ")!=-1){this.injectionDiv_=e;break}e=e.parentNode}return this.injectionDiv_},t.WorkspaceSvg.prototype.getBlockCanvas=function(){return this.svgBlockCanvas_},t.WorkspaceSvg.prototype.setResizeHandlerWrapper=function(e){this.resizeHandlerWrapper_=e},t.WorkspaceSvg.prototype.createDom=function(e){return this.svgGroup_=t.utils.dom.createSvgElement(t.utils.Svg.G,{class:"blocklyWorkspace"},null),e&&(this.svgBackground_=t.utils.dom.createSvgElement(t.utils.Svg.RECT,{height:"100%",width:"100%",class:e},this.svgGroup_),e=="blocklyMainBackground"&&this.grid_?this.svgBackground_.style.fill="url(#"+this.grid_.getPatternId()+")":this.themeManager_.subscribe(this.svgBackground_,"workspaceBackgroundColour","fill")),this.svgBlockCanvas_=t.utils.dom.createSvgElement(t.utils.Svg.G,{class:"blocklyBlockCanvas"},this.svgGroup_),this.svgBubbleCanvas_=t.utils.dom.createSvgElement(t.utils.Svg.G,{class:"blocklyBubbleCanvas"},this.svgGroup_),this.isFlyout||(t.browserEvents.conditionalBind(this.svgGroup_,"mousedown",this,this.onMouseDown_,!1,!0),t.browserEvents.conditionalBind(this.svgGroup_,"wheel",this,this.onMouseWheel_)),this.options.hasCategories&&(this.toolbox_=new(t.registry.getClassFromOptions(t.registry.Type.TOOLBOX,this.options,!0))(this)),this.grid_&&this.grid_.update(this.scale),this.recordDeleteAreas(),(e=t.registry.getClassFromOptions(t.registry.Type.CURSOR,this.options))&&this.markerManager_.setCursor(new e),this.renderer_.createDom(this.svgGroup_,this.getTheme()),this.svgGroup_},t.WorkspaceSvg.prototype.dispose=function(){if(this.rendered=!1,this.currentGesture_&&this.currentGesture_.cancel(),this.svgGroup_&&(t.utils.dom.removeNode(this.svgGroup_),this.svgGroup_=null),this.svgBubbleCanvas_=this.svgBlockCanvas_=null,this.toolbox_&&(this.toolbox_.dispose(),this.toolbox_=null),this.flyout_&&(this.flyout_.dispose(),this.flyout_=null),this.trashcan&&(this.trashcan.dispose(),this.trashcan=null),this.scrollbar&&(this.scrollbar.dispose(),this.scrollbar=null),this.zoomControls_&&(this.zoomControls_.dispose(),this.zoomControls_=null),this.audioManager_&&(this.audioManager_.dispose(),this.audioManager_=null),this.grid_&&(this.grid_.dispose(),this.grid_=null),this.renderer_.dispose(),this.markerManager_&&(this.markerManager_.dispose(),this.markerManager_=null),t.WorkspaceSvg.superClass_.dispose.call(this),this.themeManager_&&(this.themeManager_.unsubscribeWorkspace(this),this.themeManager_.unsubscribe(this.svgBackground_),this.options.parentWorkspace||(this.themeManager_.dispose(),this.themeManager_=null)),this.flyoutButtonCallbacks_=this.toolboxCategoryCallbacks_=this.connectionDBList=null,!this.options.parentWorkspace){var e=this.getParentSvg();e&&e.parentNode&&t.utils.dom.removeNode(e.parentNode)}this.resizeHandlerWrapper_&&(t.browserEvents.unbind(this.resizeHandlerWrapper_),this.resizeHandlerWrapper_=null)},t.WorkspaceSvg.prototype.newBlock=function(e,i){return new t.BlockSvg(this,e,i)},t.WorkspaceSvg.prototype.addTrashcan=function(){if(!t.Trashcan)throw Error("Missing require for Blockly.Trashcan");this.trashcan=new t.Trashcan(this);var e=this.trashcan.createDom();this.svgGroup_.insertBefore(e,this.svgBlockCanvas_),this.pluginManager_.addPlugin({id:"trashcan",plugin:this.trashcan,weight:1,types:[t.PluginManager.Type.POSITIONABLE]})},t.WorkspaceSvg.prototype.addZoomControls=function(){if(!t.ZoomControls)throw Error("Missing require for Blockly.ZoomControls");this.zoomControls_=new t.ZoomControls(this);var e=this.zoomControls_.createDom();this.svgGroup_.appendChild(e),this.pluginManager_.addPlugin({id:"zoomControls",plugin:this.zoomControls_,weight:2,types:[t.PluginManager.Type.POSITIONABLE]})},t.WorkspaceSvg.prototype.addFlyout=function(e){var i=new t.Options({parentWorkspace:this,rtl:this.RTL,oneBasedIndex:this.options.oneBasedIndex,horizontalLayout:this.horizontalLayout,renderer:this.options.renderer,rendererOverrides:this.options.rendererOverrides,move:{scrollbars:!0}});return i.toolboxPosition=this.options.toolboxPosition,this.flyout_=this.horizontalLayout?new(t.registry.getClassFromOptions(t.registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,this.options,!0))(i):new(t.registry.getClassFromOptions(t.registry.Type.FLYOUTS_VERTICAL_TOOLBOX,this.options,!0))(i),this.flyout_.autoClose=!1,this.flyout_.getWorkspace().setVisible(!0),this.flyout_.createDom(e)},t.WorkspaceSvg.prototype.getFlyout=function(e){return this.flyout_||e?this.flyout_:this.toolbox_?this.toolbox_.getFlyout():null},t.WorkspaceSvg.prototype.getToolbox=function(){return this.toolbox_},t.WorkspaceSvg.prototype.updateScreenCalculations_=function(){this.updateInverseScreenCTM(),this.recordDeleteAreas()},t.WorkspaceSvg.prototype.resizeContents=function(){this.resizesEnabled_&&this.rendered&&(this.scrollbar&&this.scrollbar.resize(),this.updateInverseScreenCTM())},t.WorkspaceSvg.prototype.resize=function(){this.toolbox_&&this.toolbox_.position(),this.flyout_&&this.flyout_.position();for(var e=this.pluginManager_.getPlugins(t.PluginManager.Type.POSITIONABLE,!0),i=this.getMetricsManager().getUiMetrics(),s=[],r=0,o;o=e[r];r++)o.position(i,s),s.push(o.getBoundingRectangle());this.scrollbar&&this.scrollbar.resize(),this.updateScreenCalculations_()},t.WorkspaceSvg.prototype.updateScreenCalculationsIfScrolled=function(){var e=t.utils.getDocumentScroll();t.utils.Coordinate.equals(this.lastRecordedPageScroll_,e)||(this.lastRecordedPageScroll_=e,this.updateScreenCalculations_())},t.WorkspaceSvg.prototype.getCanvas=function(){return this.svgBlockCanvas_},t.WorkspaceSvg.prototype.setCachedParentSvgSize=function(e,i){var s=this.getParentSvg();e&&(this.cachedParentSvgSize_.width=e,s.cachedWidth_=e),i&&(this.cachedParentSvgSize_.height=i,s.cachedHeight_=i)},t.WorkspaceSvg.prototype.getBubbleCanvas=function(){return this.svgBubbleCanvas_},t.WorkspaceSvg.prototype.getParentSvg=function(){if(!this.cachedParentSvg_)for(var e=this.svgGroup_;e;){if(e.tagName=="svg"){this.cachedParentSvg_=e;break}e=e.parentNode}return this.cachedParentSvg_},t.WorkspaceSvg.prototype.maybeFireViewportChangeEvent=function(){if(t.Events.isEnabled()){var e=this.scale,i=-this.scrollY,s=-this.scrollX;if(!(e==this.oldScale_&&1>Math.abs(i-this.oldTop_)&&1>Math.abs(s-this.oldLeft_))){var r=new(t.Events.get(t.Events.VIEWPORT_CHANGE))(i,s,e,this.id,this.oldScale_);this.oldScale_=e,this.oldTop_=i,this.oldLeft_=s,t.Events.fire(r)}}},t.WorkspaceSvg.prototype.translate=function(e,i){if(this.useWorkspaceDragSurface_&&this.isDragSurfaceActive_)this.workspaceDragSurface_.translateSurface(e,i);else{var s="translate("+e+","+i+") scale("+this.scale+")";this.svgBlockCanvas_.setAttribute("transform",s),this.svgBubbleCanvas_.setAttribute("transform",s)}this.blockDragSurface_&&this.blockDragSurface_.translateAndScaleGroup(e,i,this.scale),this.grid_&&this.grid_.moveTo(e,i),this.maybeFireViewportChangeEvent()},t.WorkspaceSvg.prototype.resetDragSurface=function(){if(this.useWorkspaceDragSurface_){this.isDragSurfaceActive_=!1;var e=this.workspaceDragSurface_.getSurfaceTranslation();this.workspaceDragSurface_.clearAndHide(this.svgGroup_),e="translate("+e.x+","+e.y+") scale("+this.scale+")",this.svgBlockCanvas_.setAttribute("transform",e),this.svgBubbleCanvas_.setAttribute("transform",e)}},t.WorkspaceSvg.prototype.setupDragSurface=function(){if(this.useWorkspaceDragSurface_&&!this.isDragSurfaceActive_){this.isDragSurfaceActive_=!0;var e=this.svgBlockCanvas_.previousSibling,i=parseInt(this.getParentSvg().getAttribute("width"),10),s=parseInt(this.getParentSvg().getAttribute("height"),10),r=t.utils.getRelativeXY(this.getCanvas());this.workspaceDragSurface_.setContentsAndShow(this.getCanvas(),this.getBubbleCanvas(),e,i,s,this.scale),this.workspaceDragSurface_.translateSurface(r.x,r.y)}},t.WorkspaceSvg.prototype.getBlockDragSurface=function(){return this.blockDragSurface_},t.WorkspaceSvg.prototype.getWidth=function(){var e=this.getMetrics();return e?e.viewWidth/this.scale:0},t.WorkspaceSvg.prototype.setVisible=function(e){if(this.isVisible_=e,this.svgGroup_)if(this.scrollbar&&this.scrollbar.setContainerVisible(e),this.getFlyout()&&this.getFlyout().setContainerVisible(e),this.getParentSvg().style.display=e?"block":"none",this.toolbox_&&this.toolbox_.setVisible(e),e){e=this.getAllBlocks(!1);for(var i=e.length-1;0<=i;i--)e[i].markDirty();this.render(),this.toolbox_&&this.toolbox_.position()}else t.hideChaff(!0)},t.WorkspaceSvg.prototype.render=function(){for(var e=this.getAllBlocks(!1),i=e.length-1;0<=i;i--)e[i].render(!1);if(this.currentGesture_)for(e=this.currentGesture_.getInsertionMarkers(),i=0;i<e.length;i++)e[i].render(!1);this.markerManager_.updateMarkers()},t.WorkspaceSvg.prototype.highlightBlock=function(e,i){if(i===void 0){for(var s=0,r;r=this.highlightedBlocks_[s];s++)r.setHighlighted(!1);this.highlightedBlocks_.length=0}(r=e?this.getBlockById(e):null)&&((e=i===void 0||i)?this.highlightedBlocks_.indexOf(r)==-1&&this.highlightedBlocks_.push(r):t.utils.arrayRemove(this.highlightedBlocks_,r),r.setHighlighted(e))},t.WorkspaceSvg.prototype.paste=function(e){!this.rendered||!e.tagName||e.getElementsByTagName("block").length>=this.remainingCapacity()||(this.currentGesture_&&this.currentGesture_.cancel(),e.tagName.toLowerCase()=="comment"?this.pasteWorkspaceComment_(e):this.pasteBlock_(e))},t.WorkspaceSvg.prototype.pasteBlock_=function(e){t.Events.disable();try{var i=t.Xml.domToBlock(e,this),s=parseInt(e.getAttribute("x"),10),r=parseInt(e.getAttribute("y"),10);if(!isNaN(s)&&!isNaN(r)){this.RTL&&(s=-s);do{e=!1;for(var o=this.getAllBlocks(!1),h=0,u;u=o[h];h++){var p=u.getRelativeToSurfaceXY();if(1>=Math.abs(s-p.x)&&1>=Math.abs(r-p.y)){e=!0;break}}if(!e){var d=i.getConnections_(!1);h=0;for(var f;f=d[h];h++)if(f.closest(t.SNAP_RADIUS,new t.utils.Coordinate(s,r)).connection){e=!0;break}}e&&(s=this.RTL?s-t.SNAP_RADIUS:s+t.SNAP_RADIUS,r+=2*t.SNAP_RADIUS)}while(e);i.moveBy(s,r)}}finally{t.Events.enable()}t.Events.isEnabled()&&!i.isShadow()&&t.Events.fire(new(t.Events.get(t.Events.BLOCK_CREATE))(i)),i.select()},t.WorkspaceSvg.prototype.pasteWorkspaceComment_=function(e){t.Events.disable();try{var i=t.WorkspaceCommentSvg.fromXml(e,this),s=parseInt(e.getAttribute("x"),10),r=parseInt(e.getAttribute("y"),10);isNaN(s)||isNaN(r)||(this.RTL&&(s=-s),i.moveBy(s+50,r+50))}finally{t.Events.enable()}t.Events.isEnabled()&&t.WorkspaceComment.fireCreateEvent(i),i.select()},t.WorkspaceSvg.prototype.refreshToolboxSelection=function(){var e=this.isFlyout?this.targetWorkspace:this;e&&!e.currentGesture_&&e.toolbox_&&e.toolbox_.getFlyout()&&e.toolbox_.refreshSelection()},t.WorkspaceSvg.prototype.renameVariableById=function(e,i){t.WorkspaceSvg.superClass_.renameVariableById.call(this,e,i),this.refreshToolboxSelection()},t.WorkspaceSvg.prototype.deleteVariableById=function(e){t.WorkspaceSvg.superClass_.deleteVariableById.call(this,e),this.refreshToolboxSelection()},t.WorkspaceSvg.prototype.createVariable=function(e,i,s){return e=t.WorkspaceSvg.superClass_.createVariable.call(this,e,i,s),this.refreshToolboxSelection(),e},t.WorkspaceSvg.prototype.recordDeleteAreas=function(){this.deleteAreaTrash_=this.trashcan&&this.svgGroup_.parentNode?this.trashcan.getClientRect():null,this.deleteAreaToolbox_=this.flyout_?this.flyout_.getClientRect():this.toolbox_&&typeof this.toolbox_.getClientRect=="function"?this.toolbox_.getClientRect():null},t.WorkspaceSvg.prototype.isDeleteArea=function(e){return this.deleteAreaTrash_&&this.deleteAreaTrash_.contains(e.clientX,e.clientY)?t.DELETE_AREA_TRASH:this.deleteAreaToolbox_&&this.deleteAreaToolbox_.contains(e.clientX,e.clientY)?t.DELETE_AREA_TOOLBOX:t.DELETE_AREA_NONE},t.WorkspaceSvg.prototype.onMouseDown_=function(e){var i=this.getGesture(e);i&&i.handleWsStart(e,this)},t.WorkspaceSvg.prototype.startDrag=function(e,i){e=t.utils.mouseToSvg(e,this.getParentSvg(),this.getInverseScreenCTM()),e.x/=this.scale,e.y/=this.scale,this.dragDeltaXY_=t.utils.Coordinate.difference(i,e)},t.WorkspaceSvg.prototype.moveDrag=function(e){return e=t.utils.mouseToSvg(e,this.getParentSvg(),this.getInverseScreenCTM()),e.x/=this.scale,e.y/=this.scale,t.utils.Coordinate.sum(this.dragDeltaXY_,e)},t.WorkspaceSvg.prototype.isDragging=function(){return this.currentGesture_!=null&&this.currentGesture_.isDragging()},t.WorkspaceSvg.prototype.isDraggable=function(){return this.options.moveOptions&&this.options.moveOptions.drag},t.WorkspaceSvg.prototype.isMovable=function(){return this.options.moveOptions&&!!this.options.moveOptions.scrollbars||this.options.moveOptions&&this.options.moveOptions.wheel||this.options.moveOptions&&this.options.moveOptions.drag||this.options.zoomOptions&&this.options.zoomOptions.wheel||this.options.zoomOptions&&this.options.zoomOptions.pinch},t.WorkspaceSvg.prototype.isMovableHorizontally=function(){var e=!!this.scrollbar;return this.isMovable()&&(!e||e&&this.scrollbar.canScrollHorizontally())},t.WorkspaceSvg.prototype.isMovableVertically=function(){var e=!!this.scrollbar;return this.isMovable()&&(!e||e&&this.scrollbar.canScrollVertically())},t.WorkspaceSvg.prototype.onMouseWheel_=function(e){if(t.Gesture.inProgress())e.preventDefault(),e.stopPropagation();else{var i=this.options.zoomOptions&&this.options.zoomOptions.wheel,s=this.options.moveOptions&&this.options.moveOptions.wheel;if(i||s){var r=t.utils.getScrollDeltaPixels(e);!i||!e.ctrlKey&&s?(i=this.scrollX-r.x,s=this.scrollY-r.y,e.shiftKey&&!r.x&&(i=this.scrollX-r.y,s=this.scrollY),this.scroll(i,s)):(r=-r.y/50,i=t.utils.mouseToSvg(e,this.getParentSvg(),this.getInverseScreenCTM()),this.zoom(i.x,i.y,r)),e.preventDefault()}}},t.WorkspaceSvg.prototype.getBlocksBoundingBox=function(){var e=this.getTopBoundedElements();if(!e.length)return new t.utils.Rect(0,0,0,0);for(var i=e[0].getBoundingRectangle(),s=1;s<e.length;s++){var r=e[s];r.isInsertionMarker&&r.isInsertionMarker()||(r=r.getBoundingRectangle(),r.top<i.top&&(i.top=r.top),r.bottom>i.bottom&&(i.bottom=r.bottom),r.left<i.left&&(i.left=r.left),r.right>i.right&&(i.right=r.right))}return i},t.WorkspaceSvg.prototype.cleanUp=function(){this.setResizesEnabled(!1),t.Events.setGroup(!0);for(var e=this.getTopBlocks(!0),i=0,s=0,r;r=e[s];s++)if(r.isMovable()){var o=r.getRelativeToSurfaceXY();r.moveBy(-o.x,i-o.y),r.snapToGrid(),i=r.getRelativeToSurfaceXY().y+r.getHeightWidth().height+this.renderer_.getConstants().MIN_BLOCK_HEIGHT}t.Events.setGroup(!1),this.setResizesEnabled(!0)},t.WorkspaceSvg.prototype.showContextMenu=function(e){if(!this.options.readOnly&&!this.isFlyout){var i=t.ContextMenuRegistry.registry.getContextMenuOptions(t.ContextMenuRegistry.ScopeType.WORKSPACE,{workspace:this});this.configureContextMenu&&this.configureContextMenu(i,e),t.ContextMenu.show(e,i,this.RTL)}},t.WorkspaceSvg.prototype.updateToolbox=function(e){if(e=t.utils.toolbox.convertToolboxDefToJson(e)){if(!this.options.languageTree)throw Error("Existing toolbox is null.  Can't create new toolbox.");if(t.utils.toolbox.hasCategories(e)){if(!this.toolbox_)throw Error("Existing toolbox has no categories.  Can't change mode.");this.options.languageTree=e,this.toolbox_.render(e)}else{if(!this.flyout_)throw Error("Existing toolbox has categories.  Can't change mode.");this.options.languageTree=e,this.flyout_.show(e)}}else if(this.options.languageTree)throw Error("Can't nullify an existing toolbox.")},t.WorkspaceSvg.prototype.markFocused=function(){this.options.parentWorkspace?this.options.parentWorkspace.markFocused():(t.mainWorkspace=this,this.setBrowserFocus())},t.WorkspaceSvg.prototype.setBrowserFocus=function(){document.activeElement&&document.activeElement.blur&&document.activeElement.blur();try{this.getParentSvg().focus({preventScroll:!0})}catch{try{this.getParentSvg().parentNode.setActive()}catch{this.getParentSvg().parentNode.focus({preventScroll:!0})}}},t.WorkspaceSvg.prototype.zoom=function(e,i,s){s=Math.pow(this.options.zoomOptions.scaleSpeed,s);var r=this.scale*s;if(this.scale!=r){r>this.options.zoomOptions.maxScale?s=this.options.zoomOptions.maxScale/this.scale:r<this.options.zoomOptions.minScale&&(s=this.options.zoomOptions.minScale/this.scale);var o=this.getCanvas().getCTM(),h=this.getParentSvg().createSVGPoint();h.x=e,h.y=i,h=h.matrixTransform(o.inverse()),e=h.x,i=h.y,o=o.translate(e*(1-s),i*(1-s)).scale(s),this.scrollX=o.e,this.scrollY=o.f,this.setScale(r)}},t.WorkspaceSvg.prototype.zoomCenter=function(e){var i=this.getMetrics();if(this.flyout_){var s=i.svgWidth?i.svgWidth/2:0;i=i.svgHeight?i.svgHeight/2:0}else s=i.viewWidth/2+i.absoluteLeft,i=i.viewHeight/2+i.absoluteTop;this.zoom(s,i,e)},t.WorkspaceSvg.prototype.zoomToFit=function(){if(this.isMovable()){var e=this.getMetrics(),i=e.viewWidth;e=e.viewHeight;var s=this.getBlocksBoundingBox(),r=s.right-s.left;if(s=s.bottom-s.top,r){this.flyout_&&(this.horizontalLayout?(e+=this.flyout_.getHeight(),s+=this.flyout_.getHeight()/this.scale):(i+=this.flyout_.getWidth(),r+=this.flyout_.getWidth()/this.scale)),i/=r,e/=s,t.Events.disable();try{this.setScale(Math.min(i,e)),this.scrollCenter()}finally{t.Events.enable()}this.maybeFireViewportChangeEvent()}}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")},t.WorkspaceSvg.prototype.beginCanvasTransition=function(){t.utils.dom.addClass(this.svgBlockCanvas_,"blocklyCanvasTransitioning"),t.utils.dom.addClass(this.svgBubbleCanvas_,"blocklyCanvasTransitioning")},t.WorkspaceSvg.prototype.endCanvasTransition=function(){t.utils.dom.removeClass(this.svgBlockCanvas_,"blocklyCanvasTransitioning"),t.utils.dom.removeClass(this.svgBubbleCanvas_,"blocklyCanvasTransitioning")},t.WorkspaceSvg.prototype.scrollCenter=function(){if(this.isMovable()){var e=this.getMetrics(),i=(e.scrollWidth-e.viewWidth)/2,s=(e.scrollHeight-e.viewHeight)/2;i=-i-e.scrollLeft,s=-s-e.scrollTop,this.scroll(i,s)}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")},t.WorkspaceSvg.prototype.centerOnBlock=function(e){if(this.isMovable()){if(e=e?this.getBlockById(e):null){var i=e.getRelativeToSurfaceXY(),s=e.getHeightWidth(),r=this.scale;e=(i.x+(this.RTL?-1:1)*s.width/2)*r,i=(i.y+s.height/2)*r,s=this.getMetrics(),this.scroll(-(e-s.viewWidth/2),-(i-s.viewHeight/2))}}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")},t.WorkspaceSvg.prototype.setScale=function(e){this.options.zoomOptions.maxScale&&e>this.options.zoomOptions.maxScale?e=this.options.zoomOptions.maxScale:this.options.zoomOptions.minScale&&e<this.options.zoomOptions.minScale&&(e=this.options.zoomOptions.minScale),this.scale=e,t.hideChaff(!1),this.flyout_&&(this.flyout_.reflow(),this.recordDeleteAreas()),this.grid_&&this.grid_.update(this.scale),e=this.getMetrics(),this.scrollX-=e.absoluteLeft,this.scrollY-=e.absoluteTop,e.viewLeft+=e.absoluteLeft,e.viewTop+=e.absoluteTop,this.scroll(this.scrollX,this.scrollY),this.scrollbar&&(this.flyout_?this.scrollbar.resizeView(e):this.scrollbar.resizeContent(e))},t.WorkspaceSvg.prototype.getScale=function(){return this.options.parentWorkspace?this.options.parentWorkspace.getScale():this.scale},t.WorkspaceSvg.prototype.scroll=function(e,i){t.hideChaff(!0);var s=this.getMetrics();e=Math.min(e,-s.scrollLeft),i=Math.min(i,-s.scrollTop);var r=s.scrollTop+Math.max(0,s.scrollHeight-s.viewHeight);e=Math.max(e,-(s.scrollLeft+Math.max(0,s.scrollWidth-s.viewWidth))),i=Math.max(i,-r),this.scrollX=e,this.scrollY=i,this.scrollbar&&this.scrollbar.set(-(e+s.scrollLeft),-(i+s.scrollTop),!1),e+=s.absoluteLeft,i+=s.absoluteTop,this.translate(e,i)},t.WorkspaceSvg.setTopLevelWorkspaceMetrics_=function(e){var i=this.getMetrics();typeof e.x=="number"&&(this.scrollX=-(i.scrollLeft+(i.scrollWidth-i.viewWidth)*e.x)),typeof e.y=="number"&&(this.scrollY=-(i.scrollTop+(i.scrollHeight-i.viewHeight)*e.y)),this.translate(this.scrollX+i.absoluteLeft,this.scrollY+i.absoluteTop)},t.WorkspaceSvg.prototype.getBlockById=function(e){return t.WorkspaceSvg.superClass_.getBlockById.call(this,e)},t.WorkspaceSvg.prototype.getTopBlocks=function(e){return t.WorkspaceSvg.superClass_.getTopBlocks.call(this,e)},t.WorkspaceSvg.prototype.addTopBlock=function(e){this.addTopBoundedElement(e),t.WorkspaceSvg.superClass_.addTopBlock.call(this,e)},t.WorkspaceSvg.prototype.removeTopBlock=function(e){this.removeTopBoundedElement(e),t.WorkspaceSvg.superClass_.removeTopBlock.call(this,e)},t.WorkspaceSvg.prototype.addTopComment=function(e){this.addTopBoundedElement(e),t.WorkspaceSvg.superClass_.addTopComment.call(this,e)},t.WorkspaceSvg.prototype.removeTopComment=function(e){this.removeTopBoundedElement(e),t.WorkspaceSvg.superClass_.removeTopComment.call(this,e)},t.WorkspaceSvg.prototype.addTopBoundedElement=function(e){this.topBoundedElements_.push(e)},t.WorkspaceSvg.prototype.removeTopBoundedElement=function(e){t.utils.arrayRemove(this.topBoundedElements_,e)},t.WorkspaceSvg.prototype.getTopBoundedElements=function(){return[].concat(this.topBoundedElements_)},t.WorkspaceSvg.prototype.setResizesEnabled=function(e){var i=!this.resizesEnabled_&&e;this.resizesEnabled_=e,i&&this.resizeContents()},t.WorkspaceSvg.prototype.clear=function(){this.setResizesEnabled(!1),t.WorkspaceSvg.superClass_.clear.call(this),this.topBoundedElements_=[],this.setResizesEnabled(!0)},t.WorkspaceSvg.prototype.registerButtonCallback=function(e,i){if(typeof i!="function")throw TypeError("Button callbacks must be functions.");this.flyoutButtonCallbacks_[e]=i},t.WorkspaceSvg.prototype.getButtonCallback=function(e){return(e=this.flyoutButtonCallbacks_[e])?e:null},t.WorkspaceSvg.prototype.removeButtonCallback=function(e){this.flyoutButtonCallbacks_[e]=null},t.WorkspaceSvg.prototype.registerToolboxCategoryCallback=function(e,i){if(typeof i!="function")throw TypeError("Toolbox category callbacks must be functions.");this.toolboxCategoryCallbacks_[e]=i},t.WorkspaceSvg.prototype.getToolboxCategoryCallback=function(e){return this.toolboxCategoryCallbacks_[e]||null},t.WorkspaceSvg.prototype.removeToolboxCategoryCallback=function(e){this.toolboxCategoryCallbacks_[e]=null},t.WorkspaceSvg.prototype.getGesture=function(e){var i=e.type=="mousedown"||e.type=="touchstart"||e.type=="pointerdown",s=this.currentGesture_;return s?i&&s.hasStarted()?(console.warn("Tried to start the same gesture twice."),s.cancel(),null):s:i?this.currentGesture_=new t.TouchGesture(e,this):null},t.WorkspaceSvg.prototype.clearGesture=function(){this.currentGesture_=null},t.WorkspaceSvg.prototype.cancelCurrentGesture=function(){this.currentGesture_&&this.currentGesture_.cancel()},t.WorkspaceSvg.prototype.getAudioManager=function(){return this.audioManager_},t.WorkspaceSvg.prototype.getGrid=function(){return this.grid_},t.inject=function(e,i){if(t.checkBlockColourConstants(),typeof e=="string"&&(e=document.getElementById(e)||document.querySelector(e)),!e||!t.utils.dom.containsNode(document,e))throw Error("Error: container is not in current document.");i=new t.Options(i||{});var s=document.createElement("div");s.className="injectionDiv",s.tabIndex=0,t.utils.aria.setState(s,t.utils.aria.State.LABEL,t.Msg.WORKSPACE_ARIA_LABEL),e.appendChild(s),e=t.createDom_(s,i);var r=new t.BlockDragSurfaceSvg(s),o=new t.WorkspaceDragSurfaceSvg(s),h=t.createMainWorkspace_(e,i,r,o);return t.init_(h),t.mainWorkspace=h,t.svgResize(h),s.addEventListener("focusin",function(){t.mainWorkspace=h}),h},t.createDom_=function(e,i){e.setAttribute("dir","LTR"),t.Css.inject(i.hasCss,i.pathToMedia),e=t.utils.dom.createSvgElement(t.utils.Svg.SVG,{xmlns:t.utils.dom.SVG_NS,"xmlns:html":t.utils.dom.HTML_NS,"xmlns:xlink":t.utils.dom.XLINK_NS,version:"1.1",class:"blocklySvg",tabindex:"0"},e);var s=t.utils.dom.createSvgElement(t.utils.Svg.DEFS,{},e),r=String(Math.random()).substring(2);return i.gridPattern=t.Grid.createDom(r,i.gridOptions,s),e},t.createMainWorkspace_=function(e,i,s,r){return i.parentWorkspace=null,i=new t.WorkspaceSvg(i,s,r),s=i.options,i.scale=s.zoomOptions.startScale,e.appendChild(i.createDom("blocklyMainBackground")),t.utils.dom.addClass(i.getInjectionDiv(),i.getRenderer().getClassName()),t.utils.dom.addClass(i.getInjectionDiv(),i.getTheme().getClassName()),!s.hasCategories&&s.languageTree&&(r=i.addFlyout(t.utils.Svg.SVG),t.utils.dom.insertAfter(r,e)),s.hasTrashcan&&i.addTrashcan(),s.zoomOptions&&s.zoomOptions.controls&&i.addZoomControls(),i.getThemeManager().subscribe(e,"workspaceBackgroundColour","background-color"),i.translate(0,0),i.addChangeListener(t.bumpIntoBoundsHandler_(i)),t.svgResize(i),t.WidgetDiv.createDom(),t.DropDownDiv.createDom(),t.Tooltip.createDom(),i},t.extractObjectFromEvent_=function(e,i){var s=null;switch(i.type){case t.Events.BLOCK_CREATE:case t.Events.BLOCK_MOVE:(s=e.getBlockById(i.blockId))&&(s=s.getRootBlock());break;case t.Events.COMMENT_CREATE:case t.Events.COMMENT_MOVE:s=e.getCommentById(i.commentId)}return s},t.bumpTopObjectsIntoBounds_=function(e){var i=e.getMetricsManager();if(i.hasFixedEdges()&&!e.isDragging()){i=i.getScrollMetrics(!0);for(var s=e.getTopBoundedElements(),r=0,o;o=s[r];r++)t.bumpObjectIntoBounds_(e,i,o)}},t.bumpIntoBoundsHandler_=function(e){return function(i){var s=e.getMetricsManager();if(s.hasFixedEdges&&!e.isDragging())if(t.Events.BUMP_EVENTS.indexOf(i.type)!==-1){s=s.getScrollMetrics(!0);var r=t.extractObjectFromEvent_(e,i);if(r){var o=t.Events.getGroup();t.Events.setGroup(i.group),t.bumpObjectIntoBounds_(e,s,r)&&!i.group&&console.warn("Moved object in bounds but there was no event group. This may break undo."),o!==null&&t.Events.setGroup(o)}}else i.type===t.Events.VIEWPORT_CHANGE&&i.scale>i.oldScale&&t.bumpTopObjectsIntoBounds_(e)}},t.bumpObjectIntoBounds_=function(e,i,s){var r=s.getBoundingRectangle(),o=r.right-r.left,h=t.utils.math.clamp(i.top,r.top,i.top+i.height-(r.bottom-r.top))-r.top,u=i.left;return i=i.left+i.width-o,e.RTL?u=Math.min(i,u):i=Math.max(u,i),(e=t.utils.math.clamp(u,r.left,i)-r.left)||h?(s.moveBy(e,h),!0):!1},t.init_=function(e){var i=e.options,s=e.getParentSvg();if(t.browserEvents.conditionalBind(s.parentNode,"contextmenu",null,function(o){t.utils.isTargetInput(o)||o.preventDefault()}),s=t.browserEvents.conditionalBind(window,"resize",null,function(){t.hideChaff(!0),t.svgResize(e),t.bumpTopObjectsIntoBounds_(e)}),e.setResizeHandlerWrapper(s),t.inject.bindDocumentEvents_(),i.languageTree){s=e.getToolbox();var r=e.getFlyout(!0);s?s.init():r&&(r.init(e),r.show(i.languageTree),typeof r.scrollToStart=="function"&&r.scrollToStart())}s=t.Scrollbar.scrollbarThickness,i.hasTrashcan&&(s=e.trashcan.init(s)),i.zoomOptions&&i.zoomOptions.controls&&e.zoomControls_.init(s),i.moveOptions&&i.moveOptions.scrollbars?(e.scrollbar=new t.ScrollbarPair(e,i.moveOptions.scrollbars===!0||!!i.moveOptions.scrollbars.horizontal,i.moveOptions.scrollbars===!0||!!i.moveOptions.scrollbars.vertical,"blocklyMainWorkspaceScrollbar"),e.scrollbar.resize()):e.setMetrics({x:.5,y:.5}),i.hasSounds&&t.inject.loadSounds_(i.pathToMedia,e)},t.inject.bindDocumentEvents_=function(){t.documentEventsBound_||(t.browserEvents.conditionalBind(document,"scroll",null,function(){for(var e=t.Workspace.getAll(),i=0,s;s=e[i];i++)s.updateInverseScreenCTM&&s.updateInverseScreenCTM()}),t.browserEvents.conditionalBind(document,"keydown",null,t.onKeyDown),t.browserEvents.bind(document,"touchend",null,t.longStop_),t.browserEvents.bind(document,"touchcancel",null,t.longStop_),t.utils.userAgent.IPAD&&t.browserEvents.conditionalBind(window,"orientationchange",document,function(){t.svgResize(t.getMainWorkspace())})),t.documentEventsBound_=!0},t.inject.loadSounds_=function(e,i){var s=i.getAudioManager();s.load([e+"click.mp3",e+"click.wav",e+"click.ogg"],"click"),s.load([e+"disconnect.wav",e+"disconnect.mp3",e+"disconnect.ogg"],"disconnect"),s.load([e+"delete.mp3",e+"delete.ogg",e+"delete.wav"],"delete");var r=[];e=function(){for(;r.length;)t.browserEvents.unbind(r.pop());s.preload()},r.push(t.browserEvents.conditionalBind(document,"mousemove",null,e,!0)),r.push(t.browserEvents.conditionalBind(document,"touchstart",null,e,!0))},t.Names=function(e,i){if(this.variablePrefix_=i||"",this.reservedDict_=Object.create(null),e)for(e=e.split(","),i=0;i<e.length;i++)this.reservedDict_[e[i]]=!0;this.reset()},t.Names.DEVELOPER_VARIABLE_TYPE="DEVELOPER_VARIABLE",t.Names.prototype.reset=function(){this.db_=Object.create(null),this.dbReverse_=Object.create(null),this.variableMap_=null},t.Names.prototype.setVariableMap=function(e){this.variableMap_=e},t.Names.prototype.getNameForUserVariable_=function(e){return this.variableMap_?(e=this.variableMap_.getVariableById(e))?e.name:null:(console.log(`Deprecated call to Blockly.Names.prototype.getName without defining a variable map. To fix, add the following code in your generator's init() function:
Blockly.YourGeneratorName.variableDB_.setVariableMap(workspace.getVariableMap());`),null)},t.Names.prototype.getName=function(e,i){if(i==t.VARIABLE_CATEGORY_NAME){var s=this.getNameForUserVariable_(e);s&&(e=s)}s=e.toLowerCase()+"_"+i;var r=i==t.VARIABLE_CATEGORY_NAME||i==t.Names.DEVELOPER_VARIABLE_TYPE?this.variablePrefix_:"";return s in this.db_?r+this.db_[s]:(e=this.getDistinctName(e,i),this.db_[s]=e.substr(r.length),e)},t.Names.prototype.getDistinctName=function(e,i){e=this.safeName_(e);for(var s="";this.dbReverse_[e+s]||e+s in this.reservedDict_;)s=s?s+1:2;return e+=s,this.dbReverse_[e]=!0,(i==t.VARIABLE_CATEGORY_NAME||i==t.Names.DEVELOPER_VARIABLE_TYPE?this.variablePrefix_:"")+e},t.Names.prototype.safeName_=function(e){return e?(e=encodeURI(e.replace(/ /g,"_")).replace(/[^\w]/g,"_"),"0123456789".indexOf(e[0])!=-1&&(e="my_"+e)):e=t.Msg.UNNAMED_KEY||"unnamed",e},t.Names.equals=function(e,i){return e.toLowerCase()==i.toLowerCase()},t.Procedures={},t.Procedures.NAME_TYPE=t.PROCEDURE_CATEGORY_NAME,t.Procedures.DEFAULT_ARG="x",t.Procedures.allProcedures=function(e){var i=e.getBlocksByType("procedures_defnoreturn",!1).map(function(s){return s.getProcedureDef()});return e=e.getBlocksByType("procedures_defreturn",!1).map(function(s){return s.getProcedureDef()}),i.sort(t.Procedures.procTupleComparator_),e.sort(t.Procedures.procTupleComparator_),[i,e]},t.Procedures.procTupleComparator_=function(e,i){return e[0].toLowerCase().localeCompare(i[0].toLowerCase())},t.Procedures.findLegalName=function(e,i){if(i.isInFlyout)return e;for(e=e||t.Msg.UNNAMED_KEY||"unnamed";!t.Procedures.isLegalName_(e,i.workspace,i);){var s=e.match(/^(.*?)(\d+)$/);e=s?s[1]+(parseInt(s[2],10)+1):e+"2"}return e},t.Procedures.isLegalName_=function(e,i,s){return!t.Procedures.isNameUsed(e,i,s)},t.Procedures.isNameUsed=function(e,i,s){i=i.getAllBlocks(!1);for(var r=0;r<i.length;r++)if(i[r]!=s&&i[r].getProcedureDef){var o=i[r].getProcedureDef();if(t.Names.equals(o[0],e))return!0}return!1},t.Procedures.rename=function(e){e=e.trim();var i=t.Procedures.findLegalName(e,this.getSourceBlock()),s=this.getValue();if(s!=e&&s!=i){e=this.getSourceBlock().workspace.getAllBlocks(!1);for(var r=0;r<e.length;r++)e[r].renameProcedure&&e[r].renameProcedure(s,i)}return i},t.Procedures.flyoutCategory=function(e){function i(h,u){for(var p=0;p<h.length;p++){var d=h[p][0],f=h[p][1],g=t.utils.xml.createElement("block");g.setAttribute("type",u),g.setAttribute("gap",16);var _=t.utils.xml.createElement("mutation");for(_.setAttribute("name",d),g.appendChild(_),d=0;d<f.length;d++){var v=t.utils.xml.createElement("arg");v.setAttribute("name",f[d]),_.appendChild(v)}s.push(g)}}var s=[];if(t.Blocks.procedures_defnoreturn){var r=t.utils.xml.createElement("block");r.setAttribute("type","procedures_defnoreturn"),r.setAttribute("gap",16);var o=t.utils.xml.createElement("field");o.setAttribute("name","NAME"),o.appendChild(t.utils.xml.createTextNode(t.Msg.PROCEDURES_DEFNORETURN_PROCEDURE)),r.appendChild(o),s.push(r)}return t.Blocks.procedures_defreturn&&(r=t.utils.xml.createElement("block"),r.setAttribute("type","procedures_defreturn"),r.setAttribute("gap",16),o=t.utils.xml.createElement("field"),o.setAttribute("name","NAME"),o.appendChild(t.utils.xml.createTextNode(t.Msg.PROCEDURES_DEFRETURN_PROCEDURE)),r.appendChild(o),s.push(r)),t.Blocks.procedures_ifreturn&&(r=t.utils.xml.createElement("block"),r.setAttribute("type","procedures_ifreturn"),r.setAttribute("gap",16),s.push(r)),s.length&&s[s.length-1].setAttribute("gap",24),e=t.Procedures.allProcedures(e),i(e[0],"procedures_callnoreturn"),i(e[1],"procedures_callreturn"),s},t.Procedures.updateMutatorFlyout_=function(e){for(var i=[],s=e.getBlocksByType("procedures_mutatorarg",!1),r=0,o;o=s[r];r++)i.push(o.getFieldValue("NAME"));s=t.utils.xml.createElement("xml"),r=t.utils.xml.createElement("block"),r.setAttribute("type","procedures_mutatorarg"),o=t.utils.xml.createElement("field"),o.setAttribute("name","NAME"),i=t.Variables.generateUniqueNameFromOptions(t.Procedures.DEFAULT_ARG,i),i=t.utils.xml.createTextNode(i),o.appendChild(i),r.appendChild(o),s.appendChild(r),e.updateToolbox(s)},t.Procedures.mutatorOpenListener=function(e){if(e.type==t.Events.BUBBLE_OPEN&&e.bubbleType==="mutator"&&e.isOpen){e=t.Workspace.getById(e.workspaceId).getBlockById(e.blockId);var i=e.type;(i=="procedures_defnoreturn"||i=="procedures_defreturn")&&(e=e.mutator.getWorkspace(),t.Procedures.updateMutatorFlyout_(e),e.addChangeListener(t.Procedures.mutatorChangeListener_))}},t.Procedures.mutatorChangeListener_=function(e){(e.type==t.Events.BLOCK_CREATE||e.type==t.Events.BLOCK_DELETE||e.type==t.Events.BLOCK_CHANGE)&&(e=t.Workspace.getById(e.workspaceId),t.Procedures.updateMutatorFlyout_(e))},t.Procedures.getCallers=function(e,i){var s=[];i=i.getAllBlocks(!1);for(var r=0;r<i.length;r++)if(i[r].getProcedureCall){var o=i[r].getProcedureCall();o&&t.Names.equals(o,e)&&s.push(i[r])}return s},t.Procedures.mutateCallers=function(e){var i=t.Events.recordUndo,s=e.getProcedureDef()[0],r=e.mutationToDom(!0);e=t.Procedures.getCallers(s,e.workspace),s=0;for(var o;o=e[s];s++){var h=o.mutationToDom();h=h&&t.Xml.domToText(h),o.domToMutation(r);var u=o.mutationToDom();u=u&&t.Xml.domToText(u),h!=u&&(t.Events.recordUndo=!1,t.Events.fire(new(t.Events.get(t.Events.BLOCK_CHANGE))(o,"mutation",null,h,u)),t.Events.recordUndo=i)}},t.Procedures.getDefinition=function(e,i){i=i.getTopBlocks(!1);for(var s=0;s<i.length;s++)if(i[s].getProcedureDef){var r=i[s].getProcedureDef();if(r&&t.Names.equals(r[0],e))return i[s]}return null},t.ShortcutRegistry=function(){t.ShortcutRegistry.registry=this,this.registry_=Object.create(null),this.keyMap_=Object.create(null)},t.ShortcutRegistry.modifierKeys={Shift:t.utils.KeyCodes.SHIFT,Control:t.utils.KeyCodes.CTRL,Alt:t.utils.KeyCodes.ALT,Meta:t.utils.KeyCodes.META},t.ShortcutRegistry.prototype.register=function(e,i){if(this.registry_[e.name]&&!i)throw Error('Shortcut with name "'+e.name+'" already exists.');this.registry_[e.name]=e},t.ShortcutRegistry.prototype.unregister=function(e){return this.registry_[e]?(this.removeAllKeyMappings(e),delete this.registry_[e],!0):(console.warn('Keyboard shortcut with name "'+e+'" not found.'),!1)},t.ShortcutRegistry.prototype.addKeyMapping=function(e,i,s){e=String(e);var r=this.keyMap_[e];if(r&&!s)throw Error('Shortcut with name "'+i+'" collides with shortcuts '+r.toString());r&&s?r.unshift(i):this.keyMap_[e]=[i]},t.ShortcutRegistry.prototype.removeKeyMapping=function(e,i,s){var r=this.keyMap_[e];if(!r&&!s)return console.warn('No keyboard shortcut with name "'+i+'" registered with key code "'+e+'"'),!1;var o=r.indexOf(i);return-1<o?(r.splice(o,1),r.length==0&&delete this.keyMap_[e],!0):(s||console.warn('No keyboard shortcut with name "'+i+'" registered with key code "'+e+'"'),!1)},t.ShortcutRegistry.prototype.removeAllKeyMappings=function(e){for(var i in this.keyMap_)this.removeKeyMapping(i,e,!0)},t.ShortcutRegistry.prototype.setKeyMap=function(e){this.keyMap_=e},t.ShortcutRegistry.prototype.getKeyMap=function(){return t.utils.object.deepMerge(Object.create(null),this.keyMap_)},t.ShortcutRegistry.prototype.getRegistry=function(){return t.utils.object.deepMerge(Object.create(null),this.registry_)},t.ShortcutRegistry.prototype.onKeyDown=function(e,i){var s=this.serializeKeyEvent_(i);if(s=this.getShortcutNamesByKeyCode(s),!s)return!1;for(var r=0,o;o=s[r];r++)if(o=this.registry_[o],(!o.preconditionFn||o.preconditionFn(e))&&o.callback&&o.callback(e,i,o))return!0;return!1},t.ShortcutRegistry.prototype.getShortcutNamesByKeyCode=function(e){return this.keyMap_[e]||[]},t.ShortcutRegistry.prototype.getKeyCodesByShortcutName=function(e){var i=[],s;for(s in this.keyMap_)-1<this.keyMap_[s].indexOf(e)&&i.push(s);return i},t.ShortcutRegistry.prototype.serializeKeyEvent_=function(e){var i="",s;for(s in t.ShortcutRegistry.modifierKeys)e.getModifierState(s)&&(i!=""&&(i+="+"),i+=s);return i!=""&&e.keyCode?i=i+"+"+e.keyCode:e.keyCode&&(i=e.keyCode.toString()),i},t.ShortcutRegistry.prototype.checkModifiers_=function(e){for(var i=t.utils.object.values(t.ShortcutRegistry.modifierKeys),s=0,r;r=e[s];s++)if(0>i.indexOf(r))throw Error(r+" is not a valid modifier key.")},t.ShortcutRegistry.prototype.createSerializedKey=function(e,i){var s="";if(i){this.checkModifiers_(i);for(var r in t.ShortcutRegistry.modifierKeys)-1<i.indexOf(t.ShortcutRegistry.modifierKeys[r])&&(s!=""&&(s+="+"),s+=r)}return s!=""&&e?s=s+"+"+e:e&&(s=e.toString()),s},new t.ShortcutRegistry,t.VariableModel=function(e,i,s,r){this.workspace=e,this.name=i,this.type=s||"",this.id_=r||t.utils.genUid(),t.Events.fire(new(t.Events.get(t.Events.VAR_CREATE))(this))},t.VariableModel.prototype.getId=function(){return this.id_},t.VariableModel.compareByName=function(e,i){return e=e.name.toLowerCase(),i=i.name.toLowerCase(),e<i?-1:e==i?0:1},t.Variables={},t.Variables.NAME_TYPE=t.VARIABLE_CATEGORY_NAME,t.Variables.allUsedVarModels=function(e){var i=e.getAllBlocks(!1);e=Object.create(null);for(var s=0;s<i.length;s++){var r=i[s].getVarModels();if(r)for(var o=0;o<r.length;o++){var h=r[o],u=h.getId();u&&(e[u]=h)}}i=[];for(u in e)i.push(e[u]);return i},t.Variables.ALL_DEVELOPER_VARS_WARNINGS_BY_BLOCK_TYPE_={},t.Variables.allDeveloperVariables=function(e){e=e.getAllBlocks(!1);for(var i=Object.create(null),s=0,r;r=e[s];s++){var o=r.getDeveloperVariables;if(!o&&r.getDeveloperVars&&(o=r.getDeveloperVars,t.Variables.ALL_DEVELOPER_VARS_WARNINGS_BY_BLOCK_TYPE_[r.type]||(console.warn("Function getDeveloperVars() deprecated. Use getDeveloperVariables() (block type '"+r.type+"')"),t.Variables.ALL_DEVELOPER_VARS_WARNINGS_BY_BLOCK_TYPE_[r.type]=!0)),o)for(r=o(),o=0;o<r.length;o++)i[r[o]]=!0}return Object.keys(i)},t.Variables.flyoutCategory=function(e){var i=[],s=document.createElement("button");return s.setAttribute("text","%{BKY_NEW_VARIABLE}"),s.setAttribute("callbackKey","CREATE_VARIABLE"),e.registerButtonCallback("CREATE_VARIABLE",function(r){t.Variables.createVariableButtonHandler(r.getTargetWorkspace())}),i.push(s),e=t.Variables.flyoutCategoryBlocks(e),i=i.concat(e)},t.Variables.flyoutCategoryBlocks=function(e){e=e.getVariablesOfType("");var i=[];if(0<e.length){var s=e[e.length-1];if(t.Blocks.variables_set){var r=t.utils.xml.createElement("block");r.setAttribute("type","variables_set"),r.setAttribute("gap",t.Blocks.math_change?8:24),r.appendChild(t.Variables.generateVariableFieldDom(s)),i.push(r)}if(t.Blocks.math_change&&(r=t.utils.xml.createElement("block"),r.setAttribute("type","math_change"),r.setAttribute("gap",t.Blocks.variables_get?20:8),r.appendChild(t.Variables.generateVariableFieldDom(s)),s=t.Xml.textToDom('<value name="DELTA"><shadow type="math_number"><field name="NUM">1</field></shadow></value>'),r.appendChild(s),i.push(r)),t.Blocks.variables_get){e.sort(t.VariableModel.compareByName),s=0;for(var o;o=e[s];s++)r=t.utils.xml.createElement("block"),r.setAttribute("type","variables_get"),r.setAttribute("gap",8),r.appendChild(t.Variables.generateVariableFieldDom(o)),i.push(r)}}return i},t.Variables.VAR_LETTER_OPTIONS="ijkmnopqrstuvwxyzabcdefgh",t.Variables.generateUniqueName=function(e){return t.Variables.generateUniqueNameFromOptions(t.Variables.VAR_LETTER_OPTIONS.charAt(0),e.getAllVariableNames())},t.Variables.generateUniqueNameFromOptions=function(e,i){if(!i.length)return e;for(var s=t.Variables.VAR_LETTER_OPTIONS,r="",o=s.indexOf(e);;){for(var h=!1,u=0;u<i.length;u++)if(i[u].toLowerCase()==e){h=!0;break}if(!h)return e;o++,o==s.length&&(o=0,r=Number(r)+1),e=s.charAt(o)+r}},t.Variables.createVariableButtonHandler=function(e,i,s){var r=s||"",o=function(h){t.Variables.promptName(t.Msg.NEW_VARIABLE_TITLE,h,function(u){if(u){var p=t.Variables.nameUsedWithAnyType(u,e);if(p){if(p.type==r)var d=t.Msg.VARIABLE_ALREADY_EXISTS.replace("%1",p.name);else d=t.Msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE,d=d.replace("%1",p.name).replace("%2",p.type);t.alert(d,function(){o(u)})}else e.createVariable(u,r),i&&i(u)}else i&&i(null)})};o("")},t.Variables.createVariable=t.Variables.createVariableButtonHandler,t.Variables.renameVariable=function(e,i,s){var r=function(o){var h=t.Msg.RENAME_VARIABLE_TITLE.replace("%1",i.name);t.Variables.promptName(h,o,function(u){if(u){var p=t.Variables.nameUsedWithOtherType_(u,i.type,e);p?(p=t.Msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE.replace("%1",p.name).replace("%2",p.type),t.alert(p,function(){r(u)})):(e.renameVariableById(i.getId(),u),s&&s(u))}else s&&s(null)})};r("")},t.Variables.promptName=function(e,i,s){t.prompt(e,i,function(r){r&&(r=r.replace(/[\s\xa0]+/g," ").trim(),r==t.Msg.RENAME_VARIABLE||r==t.Msg.NEW_VARIABLE)&&(r=null),s(r)})},t.Variables.nameUsedWithOtherType_=function(e,i,s){s=s.getVariableMap().getAllVariables(),e=e.toLowerCase();for(var r=0,o;o=s[r];r++)if(o.name.toLowerCase()==e&&o.type!=i)return o;return null},t.Variables.nameUsedWithAnyType=function(e,i){i=i.getVariableMap().getAllVariables(),e=e.toLowerCase();for(var s=0,r;r=i[s];s++)if(r.name.toLowerCase()==e)return r;return null},t.Variables.generateVariableFieldDom=function(e){var i=t.utils.xml.createElement("field");return i.setAttribute("name","VAR"),i.setAttribute("id",e.getId()),i.setAttribute("variabletype",e.type),e=t.utils.xml.createTextNode(e.name),i.appendChild(e),i},t.Variables.getOrCreateVariablePackage=function(e,i,s,r){var o=t.Variables.getVariable(e,i,s,r);return o||(o=t.Variables.createVariable_(e,i,s,r)),o},t.Variables.getVariable=function(e,i,s,r){var o=e.getPotentialVariableMap(),h=null;if(i&&(h=e.getVariableById(i),!h&&o&&(h=o.getVariableById(i)),h))return h;if(s){if(r==null)throw Error("Tried to look up a variable by name without a type");h=e.getVariable(s,r),!h&&o&&(h=o.getVariable(s,r))}return h},t.Variables.createVariable_=function(e,i,s,r){var o=e.getPotentialVariableMap();return s||(s=t.Variables.generateUniqueName(e.isFlyout?e.targetWorkspace:e)),o?o.createVariable(s,r,i):e.createVariable(s,r,i)},t.Variables.getAddedVariables=function(e,i){e=e.getAllVariables();var s=[];if(i.length!=e.length)for(var r=0;r<e.length;r++){var o=e[r];i.indexOf(o)==-1&&s.push(o)}return s},t.VERSION="5.20210325.1",t.mainWorkspace=null,t.selected=null,t.draggingConnections=[],t.clipboardXml_=null,t.clipboardSource_=null,t.clipboardTypeCounts_=null,t.cache3dSupported_=null,t.parentContainer=null,t.svgSize=function(e){return t.utils.deprecation.warn("Blockly.svgSize","March 2021","March 2022","workspace.getCachedParentSvgSize"),new t.utils.Size(e.cachedWidth_,e.cachedHeight_)},t.resizeSvgContents=function(e){e.resizeContents()},t.svgResize=function(e){for(;e.options.parentWorkspace;)e=e.options.parentWorkspace;var i=e.getParentSvg(),s=e.getCachedParentSvgSize(),r=i.parentNode;if(r){var o=r.offsetWidth;r=r.offsetHeight,s.width!=o&&(i.setAttribute("width",o+"px"),e.setCachedParentSvgSize(o,null)),s.height!=r&&(i.setAttribute("height",r+"px"),e.setCachedParentSvgSize(null,r)),e.resize()}},t.onKeyDown=function(e){var i=t.mainWorkspace;i&&!(t.utils.isTargetInput(e)||i.rendered&&!i.isVisible())&&t.ShortcutRegistry.registry.onKeyDown(i,e)},t.deleteBlock=function(e){e.workspace.isFlyout||(t.Events.setGroup(!0),t.hideChaff(),e.dispose(!0,!0),t.Events.setGroup(!1))},t.copy=function(e){(e=e.toCopyData())&&(t.clipboardXml_=e.xml,t.clipboardSource_=e.source,t.clipboardTypeCounts_=e.typeCounts)},t.paste=function(){if(!t.clipboardXml_)return!1;var e=t.clipboardSource_;return e.isFlyout&&(e=e.targetWorkspace),t.clipboardTypeCounts_&&e.isCapacityAvailable(t.clipboardTypeCounts_)?(t.Events.setGroup(!0),e.paste(t.clipboardXml_),t.Events.setGroup(!1),!0):!1},t.duplicate=function(e){var i=t.clipboardXml_,s=t.clipboardSource_;t.copy(e),e.workspace.paste(t.clipboardXml_),t.clipboardXml_=i,t.clipboardSource_=s},t.onContextMenu_=function(e){t.utils.isTargetInput(e)||e.preventDefault()},t.hideChaff=function(e){t.Tooltip.hide(),t.WidgetDiv.hide(),t.DropDownDiv.hideWithoutAnimation(),e||(e=t.getMainWorkspace(),e.trashcan&&e.trashcan.flyout&&e.trashcan.closeFlyout(),(e=e.getToolbox())&&e.getFlyout()&&e.getFlyout().autoClose&&e.clearSelection())},t.getMainWorkspace=function(){return t.mainWorkspace},t.alert=function(e,i){alert(e),i&&i()},t.confirm=function(e,i){i(confirm(e))},t.prompt=function(e,i,s){s(prompt(e,i))},t.jsonInitFactory_=function(e){return function(){this.jsonInit(e)}},t.defineBlocksWithJsonArray=function(e){for(var i=0;i<e.length;i++){var s=e[i];if(s){var r=s.type;r==null||r===""?console.warn("Block definition #"+i+" in JSON array is missing a type attribute. Skipping."):(t.Blocks[r]&&console.warn("Block definition #"+i+' in JSON array overwrites prior definition of "'+r+'".'),t.Blocks[r]={init:t.jsonInitFactory_(s)})}else console.warn("Block definition #"+i+" in JSON array is "+s+". Skipping.")}},t.isNumber=function(e){return/^\s*-?\d+(\.\d+)?\s*$/.test(e)},t.hueToHex=function(e){return t.utils.colour.hsvToHex(e,t.HSV_SATURATION,255*t.HSV_VALUE)},t.checkBlockColourConstants=function(){t.checkBlockColourConstant_("LOGIC_HUE",["Blocks","logic","HUE"],void 0),t.checkBlockColourConstant_("LOGIC_HUE",["Constants","Logic","HUE"],210),t.checkBlockColourConstant_("LOOPS_HUE",["Blocks","loops","HUE"],void 0),t.checkBlockColourConstant_("LOOPS_HUE",["Constants","Loops","HUE"],120),t.checkBlockColourConstant_("MATH_HUE",["Blocks","math","HUE"],void 0),t.checkBlockColourConstant_("MATH_HUE",["Constants","Math","HUE"],230),t.checkBlockColourConstant_("TEXTS_HUE",["Blocks","texts","HUE"],void 0),t.checkBlockColourConstant_("TEXTS_HUE",["Constants","Text","HUE"],160),t.checkBlockColourConstant_("LISTS_HUE",["Blocks","lists","HUE"],void 0),t.checkBlockColourConstant_("LISTS_HUE",["Constants","Lists","HUE"],260),t.checkBlockColourConstant_("COLOUR_HUE",["Blocks","colour","HUE"],void 0),t.checkBlockColourConstant_("COLOUR_HUE",["Constants","Colour","HUE"],20),t.checkBlockColourConstant_("VARIABLES_HUE",["Blocks","variables","HUE"],void 0),t.checkBlockColourConstant_("VARIABLES_HUE",["Constants","Variables","HUE"],330),t.checkBlockColourConstant_("VARIABLES_DYNAMIC_HUE",["Constants","VariablesDynamic","HUE"],310),t.checkBlockColourConstant_("PROCEDURES_HUE",["Blocks","procedures","HUE"],void 0)},t.checkBlockColourConstant_=function(e,i,s){for(var r="Blockly",o=t,h=0;h<i.length;++h)r+="."+i[h],o&&(o=o[i[h]]);o&&o!==s&&(e=(s===void 0?'%1 has been removed. Use Blockly.Msg["%2"].':'%1 is deprecated and unused. Override Blockly.Msg["%2"].').replace("%1",r).replace("%2",e),console.warn(e))},t.setParentContainer=function(e){t.parentContainer=e},t.bindEvent_=t.browserEvents.bind,t.unbindEvent_=t.browserEvents.unbind,t.bindEventWithChecks_=t.browserEvents.conditionalBind,t.ALIGN_LEFT=t.constants.ALIGN.LEFT,t.ALIGN_CENTRE=t.constants.ALIGN.CENTRE,t.ALIGN_RIGHT=t.constants.ALIGN.RIGHT,t.INPUT_VALUE=t.connectionTypes.INPUT_VALUE,t.OUTPUT_VALUE=t.connectionTypes.OUTPUT_VALUE,t.NEXT_STATEMENT=t.connectionTypes.NEXT_STATEMENT,t.PREVIOUS_STATEMENT=t.connectionTypes.PREVIOUS_STATEMENT,t.DUMMY_INPUT=t.inputTypes.DUMMY,t.TOOLBOX_AT_TOP=t.utils.toolbox.Position.TOP,t.TOOLBOX_AT_BOTTOM=t.utils.toolbox.Position.BOTTOM,t.TOOLBOX_AT_LEFT=t.utils.toolbox.Position.LEFT,t.TOOLBOX_AT_RIGHT=t.utils.toolbox.Position.RIGHT,t.Events.BubbleOpen=function(e,i,s){t.Events.BubbleOpen.superClass_.constructor.call(this,e?e.workspace.id:void 0),this.blockId=e?e.id:null,this.isOpen=i,this.bubbleType=s},t.utils.object.inherits(t.Events.BubbleOpen,t.Events.UiBase),t.Events.BubbleOpen.prototype.type=t.Events.BUBBLE_OPEN,t.Events.BubbleOpen.prototype.toJson=function(){var e=t.Events.BubbleOpen.superClass_.toJson.call(this);return e.isOpen=this.isOpen,e.bubbleType=this.bubbleType,e.blockId=this.blockId,e},t.Events.BubbleOpen.prototype.fromJson=function(e){t.Events.BubbleOpen.superClass_.fromJson.call(this,e),this.isOpen=e.isOpen,this.bubbleType=e.bubbleType,this.blockId=e.blockId},t.registry.register(t.registry.Type.EVENT,t.Events.BUBBLE_OPEN,t.Events.BubbleOpen),t.Icon=function(e){this.block_=e,this.iconGroup_=null},t.Icon.prototype.collapseHidden=!0,t.Icon.prototype.SIZE=17,t.Icon.prototype.bubble_=null,t.Icon.prototype.iconXY_=null,t.Icon.prototype.createIcon=function(){this.iconGroup_||(this.iconGroup_=t.utils.dom.createSvgElement(t.utils.Svg.G,{class:"blocklyIconGroup"},null),this.block_.isInFlyout&&t.utils.dom.addClass(this.iconGroup_,"blocklyIconGroupReadonly"),this.drawIcon_(this.iconGroup_),this.block_.getSvgRoot().appendChild(this.iconGroup_),t.browserEvents.conditionalBind(this.iconGroup_,"mouseup",this,this.iconClick_),this.updateEditable())},t.Icon.prototype.dispose=function(){t.utils.dom.removeNode(this.iconGroup_),this.iconGroup_=null,this.setVisible(!1),this.block_=null},t.Icon.prototype.updateEditable=function(){},t.Icon.prototype.isVisible=function(){return!!this.bubble_},t.Icon.prototype.iconClick_=function(e){this.block_.workspace.isDragging()||this.block_.isInFlyout||t.utils.isRightButton(e)||this.setVisible(!this.isVisible())},t.Icon.prototype.applyColour=function(){this.isVisible()&&this.bubble_.setColour(this.block_.style.colourPrimary)},t.Icon.prototype.setIconLocation=function(e){this.iconXY_=e,this.isVisible()&&this.bubble_.setAnchorLocation(e)},t.Icon.prototype.computeIconLocation=function(){var e=this.block_.getRelativeToSurfaceXY(),i=t.utils.getRelativeXY(this.iconGroup_);e=new t.utils.Coordinate(e.x+i.x+this.SIZE/2,e.y+i.y+this.SIZE/2),t.utils.Coordinate.equals(this.getIconLocation(),e)||this.setIconLocation(e)},t.Icon.prototype.getIconLocation=function(){return this.iconXY_},t.Icon.prototype.getCorrectedSize=function(){return new t.utils.Size(t.Icon.prototype.SIZE,t.Icon.prototype.SIZE-2)},t.Warning=function(e){t.Warning.superClass_.constructor.call(this,e),this.createIcon(),this.text_={}},t.utils.object.inherits(t.Warning,t.Icon),t.Warning.prototype.collapseHidden=!1,t.Warning.prototype.drawIcon_=function(e){t.utils.dom.createSvgElement(t.utils.Svg.PATH,{class:"blocklyIconShape",d:"M2,15Q-1,15 0.5,12L6.5,1.7Q8,-1 9.5,1.7L15.5,12Q17,15 14,15z"},e),t.utils.dom.createSvgElement(t.utils.Svg.PATH,{class:"blocklyIconSymbol",d:"m7,4.8v3.16l0.27,2.27h1.46l0.27,-2.27v-3.16z"},e),t.utils.dom.createSvgElement(t.utils.Svg.RECT,{class:"blocklyIconSymbol",x:"7",y:"11",height:"2",width:"2"},e)},t.Warning.prototype.setVisible=function(e){e!=this.isVisible()&&(t.Events.fire(new(t.Events.get(t.Events.BUBBLE_OPEN))(this.block_,e,"warning")),e?this.createBubble_():this.disposeBubble_())},t.Warning.prototype.createBubble_=function(){this.paragraphElement_=t.Bubble.textToDom(this.getText()),this.bubble_=t.Bubble.createNonEditableBubble(this.paragraphElement_,this.block_,this.iconXY_),this.applyColour()},t.Warning.prototype.disposeBubble_=function(){this.bubble_.dispose(),this.paragraphElement_=this.bubble_=null},t.Warning.prototype.setText=function(e,i){this.text_[i]!=e&&(e?this.text_[i]=e:delete this.text_[i],this.isVisible()&&(this.setVisible(!1),this.setVisible(!0)))},t.Warning.prototype.getText=function(){var e=[],i;for(i in this.text_)e.push(this.text_[i]);return e.join(`
`)},t.Warning.prototype.dispose=function(){this.block_.warning=null,t.Icon.prototype.dispose.call(this)},t.Comment=function(e){t.Comment.superClass_.constructor.call(this,e),this.model_=e.commentModel,this.model_.text=this.model_.text||"",this.cachedText_="",this.onInputWrapper_=this.onChangeWrapper_=this.onWheelWrapper_=this.onMouseUpWrapper_=null,this.createIcon()},t.utils.object.inherits(t.Comment,t.Icon),t.Comment.prototype.drawIcon_=function(e){t.utils.dom.createSvgElement(t.utils.Svg.CIRCLE,{class:"blocklyIconShape",r:"8",cx:"8",cy:"8"},e),t.utils.dom.createSvgElement(t.utils.Svg.PATH,{class:"blocklyIconSymbol",d:"m6.8,10h2c0.003,-0.617 0.271,-0.962 0.633,-1.266 2.875,-2.4050.607,-5.534 -3.765,-3.874v1.7c3.12,-1.657 3.698,0.118 2.336,1.25-1.201,0.998 -1.201,1.528 -1.204,2.19z"},e),t.utils.dom.createSvgElement(t.utils.Svg.RECT,{class:"blocklyIconSymbol",x:"6.8",y:"10.78",height:"2",width:"2"},e)},t.Comment.prototype.createEditor_=function(){this.foreignObject_=t.utils.dom.createSvgElement(t.utils.Svg.FOREIGNOBJECT,{x:t.Bubble.BORDER_WIDTH,y:t.Bubble.BORDER_WIDTH},null);var e=document.createElementNS(t.utils.dom.HTML_NS,"body");e.setAttribute("xmlns",t.utils.dom.HTML_NS),e.className="blocklyMinimalBody";var i=this.textarea_=document.createElementNS(t.utils.dom.HTML_NS,"textarea");return i.className="blocklyCommentTextarea",i.setAttribute("dir",this.block_.RTL?"RTL":"LTR"),i.value=this.model_.text,this.resizeTextarea_(),e.appendChild(i),this.foreignObject_.appendChild(e),this.onMouseUpWrapper_=t.browserEvents.conditionalBind(i,"mouseup",this,this.startEdit_,!0,!0),this.onWheelWrapper_=t.browserEvents.conditionalBind(i,"wheel",this,function(s){s.stopPropagation()}),this.onChangeWrapper_=t.browserEvents.conditionalBind(i,"change",this,function(s){this.cachedText_!=this.model_.text&&t.Events.fire(new(t.Events.get(t.Events.BLOCK_CHANGE))(this.block_,"comment",null,this.cachedText_,this.model_.text))}),this.onInputWrapper_=t.browserEvents.conditionalBind(i,"input",this,function(s){this.model_.text=i.value}),setTimeout(i.focus.bind(i),0),this.foreignObject_},t.Comment.prototype.updateEditable=function(){t.Comment.superClass_.updateEditable.call(this),this.isVisible()&&(this.disposeBubble_(),this.createBubble_())},t.Comment.prototype.onBubbleResize_=function(){this.isVisible()&&(this.model_.size=this.bubble_.getBubbleSize(),this.resizeTextarea_())},t.Comment.prototype.resizeTextarea_=function(){var e=this.model_.size,i=2*t.Bubble.BORDER_WIDTH,s=e.width-i;e=e.height-i,this.foreignObject_.setAttribute("width",s),this.foreignObject_.setAttribute("height",e),this.textarea_.style.width=s-4+"px",this.textarea_.style.height=e-4+"px"},t.Comment.prototype.setVisible=function(e){e!=this.isVisible()&&(t.Events.fire(new(t.Events.get(t.Events.BUBBLE_OPEN))(this.block_,e,"comment")),(this.model_.pinned=e)?this.createBubble_():this.disposeBubble_())},t.Comment.prototype.createBubble_=function(){!this.block_.isEditable()||t.utils.userAgent.IE?this.createNonEditableBubble_():this.createEditableBubble_()},t.Comment.prototype.createEditableBubble_=function(){this.bubble_=new t.Bubble(this.block_.workspace,this.createEditor_(),this.block_.pathObject.svgPath,this.iconXY_,this.model_.size.width,this.model_.size.height),this.bubble_.setSvgId(this.block_.id),this.bubble_.registerResizeEvent(this.onBubbleResize_.bind(this)),this.applyColour()},t.Comment.prototype.createNonEditableBubble_=function(){this.paragraphElement_=t.Bubble.textToDom(this.block_.getCommentText()),this.bubble_=t.Bubble.createNonEditableBubble(this.paragraphElement_,this.block_,this.iconXY_),this.applyColour()},t.Comment.prototype.disposeBubble_=function(){this.onMouseUpWrapper_&&(t.browserEvents.unbind(this.onMouseUpWrapper_),this.onMouseUpWrapper_=null),this.onWheelWrapper_&&(t.browserEvents.unbind(this.onWheelWrapper_),this.onWheelWrapper_=null),this.onChangeWrapper_&&(t.browserEvents.unbind(this.onChangeWrapper_),this.onChangeWrapper_=null),this.onInputWrapper_&&(t.browserEvents.unbind(this.onInputWrapper_),this.onInputWrapper_=null),this.bubble_.dispose(),this.paragraphElement_=this.foreignObject_=this.textarea_=this.bubble_=null},t.Comment.prototype.startEdit_=function(e){this.bubble_.promote()&&this.textarea_.focus(),this.cachedText_=this.model_.text},t.Comment.prototype.getBubbleSize=function(){return this.model_.size},t.Comment.prototype.setBubbleSize=function(e,i){this.bubble_?this.bubble_.setBubbleSize(e,i):(this.model_.size.width=e,this.model_.size.height=i)},t.Comment.prototype.updateText=function(){this.textarea_?this.textarea_.value=this.model_.text:this.paragraphElement_&&(this.paragraphElement_.firstChild.textContent=this.model_.text)},t.Comment.prototype.dispose=function(){this.block_.comment=null,t.Icon.prototype.dispose.call(this)},t.Css.register(".blocklyCommentTextarea {,background-color: #fef49c;,border: 0;,outline: 0;,margin: 0;,padding: 3px;,resize: none;,display: block;,text-overflow: hidden;,}".split(",")),t.Flyout=function(e){e.setMetrics=this.setMetrics_.bind(this),this.workspace_=new t.WorkspaceSvg(e),this.workspace_.setMetricsManager(new t.FlyoutMetricsManager(this.workspace_,this)),this.workspace_.isFlyout=!0,this.workspace_.setVisible(this.isVisible_),this.RTL=!!e.RTL,this.horizontalLayout=!1,this.toolboxPosition_=e.toolboxPosition,this.eventWrappers_=[],this.mats_=[],this.buttons_=[],this.listeners_=[],this.permanentlyDisabled_=[],this.tabWidth_=this.workspace_.getRenderer().getConstants().TAB_WIDTH,this.targetWorkspace=null},t.Flyout.prototype.autoClose=!0,t.Flyout.prototype.isVisible_=!1,t.Flyout.prototype.containerVisible_=!0,t.Flyout.prototype.CORNER_RADIUS=8,t.Flyout.prototype.MARGIN=t.Flyout.prototype.CORNER_RADIUS,t.Flyout.prototype.GAP_X=3*t.Flyout.prototype.MARGIN,t.Flyout.prototype.GAP_Y=3*t.Flyout.prototype.MARGIN,t.Flyout.prototype.SCROLLBAR_PADDING=2,t.Flyout.prototype.width_=0,t.Flyout.prototype.height_=0,t.Flyout.prototype.dragAngleRange_=70,t.Flyout.prototype.createDom=function(e){return this.svgGroup_=t.utils.dom.createSvgElement(e,{class:"blocklyFlyout",style:"display: none"},null),this.svgBackground_=t.utils.dom.createSvgElement(t.utils.Svg.PATH,{class:"blocklyFlyoutBackground"},this.svgGroup_),this.svgGroup_.appendChild(this.workspace_.createDom()),this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutBackgroundColour","fill"),this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutOpacity","fill-opacity"),this.svgGroup_},t.Flyout.prototype.init=function(e){this.targetWorkspace=e,this.workspace_.targetWorkspace=e,this.workspace_.scrollbar=new t.ScrollbarPair(this.workspace_,this.horizontalLayout,!this.horizontalLayout,"blocklyFlyoutScrollbar"),this.hide(),Array.prototype.push.apply(this.eventWrappers_,t.browserEvents.conditionalBind(this.svgGroup_,"wheel",this,this.wheel_)),this.autoClose||(this.filterWrapper_=this.filterForCapacity_.bind(this),this.targetWorkspace.addChangeListener(this.filterWrapper_)),Array.prototype.push.apply(this.eventWrappers_,t.browserEvents.conditionalBind(this.svgBackground_,"mousedown",this,this.onMouseDown_)),this.workspace_.getGesture=this.targetWorkspace.getGesture.bind(this.targetWorkspace),this.workspace_.setVariableMap(this.targetWorkspace.getVariableMap()),this.workspace_.createPotentialVariableMap()},t.Flyout.prototype.dispose=function(){this.hide(),t.browserEvents.unbind(this.eventWrappers_),this.filterWrapper_&&(this.targetWorkspace.removeChangeListener(this.filterWrapper_),this.filterWrapper_=null),this.workspace_&&(this.workspace_.getThemeManager().unsubscribe(this.svgBackground_),this.workspace_.targetWorkspace=null,this.workspace_.dispose(),this.workspace_=null),this.svgGroup_&&(t.utils.dom.removeNode(this.svgGroup_),this.svgGroup_=null),this.targetWorkspace=this.svgBackground_=null},t.Flyout.prototype.getWidth=function(){return this.width_},t.Flyout.prototype.getHeight=function(){return this.height_},t.Flyout.prototype.getFlyoutScale=function(){return this.targetWorkspace.scale},t.Flyout.prototype.getWorkspace=function(){return this.workspace_},t.Flyout.prototype.isVisible=function(){return this.isVisible_},t.Flyout.prototype.setVisible=function(e){var i=e!=this.isVisible();this.isVisible_=e,i&&this.updateDisplay_()},t.Flyout.prototype.setContainerVisible=function(e){var i=e!=this.containerVisible_;this.containerVisible_=e,i&&this.updateDisplay_()},t.Flyout.prototype.updateDisplay_=function(){var e=this.containerVisible_?this.isVisible():!1;this.svgGroup_.style.display=e?"block":"none",this.workspace_.scrollbar.setContainerVisible(e)},t.Flyout.prototype.positionAt_=function(e,i,s,r){this.svgGroup_.setAttribute("width",e),this.svgGroup_.setAttribute("height",i),this.workspace_.setCachedParentSvgSize(e,i),this.svgGroup_.tagName=="svg"?t.utils.dom.setCssTransform(this.svgGroup_,"translate("+s+"px,"+r+"px)"):this.svgGroup_.setAttribute("transform","translate("+s+","+r+")"),(e=this.workspace_.scrollbar)&&(e.setOrigin(s,r),e.resize(),e.hScroll&&e.hScroll.setPosition(e.hScroll.position.x,e.hScroll.position.y),e.vScroll&&e.vScroll.setPosition(e.vScroll.position.x,e.vScroll.position.y))},t.Flyout.prototype.hide=function(){if(this.isVisible()){this.setVisible(!1);for(var e=0,i;i=this.listeners_[e];e++)t.browserEvents.unbind(i);this.listeners_.length=0,this.reflowWrapper_&&(this.workspace_.removeChangeListener(this.reflowWrapper_),this.reflowWrapper_=null)}},t.Flyout.prototype.show=function(e){this.workspace_.setResizesEnabled(!1),this.hide(),this.clearOldBlocks_(),typeof e=="string"&&(e=this.getDynamicCategoryContents_(e)),this.setVisible(!0),e=t.utils.toolbox.convertFlyoutDefToJsonArray(e),e=this.createFlyoutInfo_(e),this.layout_(e.contents,e.gaps),this.listeners_.push(t.browserEvents.conditionalBind(this.svgBackground_,"mouseover",this,function(){for(var i=this.workspace_.getTopBlocks(!1),s=0,r;r=i[s];s++)r.removeSelect()})),this.horizontalLayout?this.height_=0:this.width_=0,this.workspace_.setResizesEnabled(!0),this.reflow(),this.filterForCapacity_(),this.position(),this.reflowWrapper_=this.reflow.bind(this),this.workspace_.addChangeListener(this.reflowWrapper_)},t.Flyout.prototype.createFlyoutInfo_=function(e){var i=[],s=[];this.permanentlyDisabled_.length=0;for(var r=this.horizontalLayout?this.GAP_X:this.GAP_Y,o=0,h;h=e[o];o++)switch(h.custom&&(h=this.getDynamicCategoryContents_(h.custom),h=t.utils.toolbox.convertFlyoutDefToJsonArray(h),e.splice.apply(e,[o,1].concat(h)),h=e[o]),h.kind.toUpperCase()){case"BLOCK":var u=h,p=this.getBlockXml_(u);h=this.createBlock_(p),u=parseInt(u.gap||p.getAttribute("gap"),10),s.push(isNaN(u)?r:u),i.push({type:"block",block:h});break;case"SEP":this.addSeparatorGap_(h,s,r);break;case"LABEL":h=this.createButton_(h,!0),i.push({type:"button",button:h}),s.push(r);break;case"BUTTON":h=this.createButton_(h,!1),i.push({type:"button",button:h}),s.push(r)}return{contents:i,gaps:s}},t.Flyout.prototype.getDynamicCategoryContents_=function(e){if(e=this.workspace_.targetWorkspace.getToolboxCategoryCallback(e),typeof e!="function")throw TypeError("Couldn't find a callback function when opening a toolbox category.");if(e=e(this.workspace_.targetWorkspace),!Array.isArray(e))throw new TypeError("Result of toolbox category callback must be an array.");return e},t.Flyout.prototype.createButton_=function(e,i){if(!t.FlyoutButton)throw Error("Missing require for Blockly.FlyoutButton");return new t.FlyoutButton(this.workspace_,this.targetWorkspace,e,i)},t.Flyout.prototype.createBlock_=function(e){return e=t.Xml.domToBlock(e,this.workspace_),e.isEnabled()||this.permanentlyDisabled_.push(e),e},t.Flyout.prototype.getBlockXml_=function(e){var i=null,s=e.blockxml;if(s&&typeof s!="string"?i=s:s&&typeof s=="string"?(i=t.Xml.textToDom(s),e.blockxml=i):e.type&&(i=t.utils.xml.createElement("xml"),i.setAttribute("type",e.type),i.setAttribute("disabled",e.disabled),e.blockxml=i),!i)throw Error("Error: Invalid block definition. Block definition must have blockxml or type.");return i},t.Flyout.prototype.addSeparatorGap_=function(e,i,s){e=parseInt(e.gap,10),!isNaN(e)&&0<i.length?i[i.length-1]=e:i.push(s)},t.Flyout.prototype.clearOldBlocks_=function(){for(var e=this.workspace_.getTopBlocks(!1),i=0,s;s=e[i];i++)s.workspace==this.workspace_&&s.dispose(!1,!1);for(i=0;i<this.mats_.length;i++)(e=this.mats_[i])&&(t.Tooltip.unbindMouseEvents(e),t.utils.dom.removeNode(e));for(i=this.mats_.length=0;e=this.buttons_[i];i++)e.dispose();this.buttons_.length=0,this.workspace_.getPotentialVariableMap().clear()},t.Flyout.prototype.addBlockListeners_=function(e,i,s){this.listeners_.push(t.browserEvents.conditionalBind(e,"mousedown",null,this.blockMouseDown_(i))),this.listeners_.push(t.browserEvents.conditionalBind(s,"mousedown",null,this.blockMouseDown_(i))),this.listeners_.push(t.browserEvents.bind(e,"mouseenter",i,i.addSelect)),this.listeners_.push(t.browserEvents.bind(e,"mouseleave",i,i.removeSelect)),this.listeners_.push(t.browserEvents.bind(s,"mouseenter",i,i.addSelect)),this.listeners_.push(t.browserEvents.bind(s,"mouseleave",i,i.removeSelect))},t.Flyout.prototype.blockMouseDown_=function(e){var i=this;return function(s){var r=i.targetWorkspace.getGesture(s);r&&(r.setStartBlock(e),r.handleFlyoutStart(s,i))}},t.Flyout.prototype.onMouseDown_=function(e){var i=this.targetWorkspace.getGesture(e);i&&i.handleFlyoutStart(e,this)},t.Flyout.prototype.isBlockCreatable_=function(e){return e.isEnabled()},t.Flyout.prototype.createBlock=function(e){var i=null;t.Events.disable();var s=this.targetWorkspace.getAllVariables();this.targetWorkspace.setResizesEnabled(!1);try{i=this.placeNewBlock_(e)}finally{t.Events.enable()}if(t.hideChaff(),e=t.Variables.getAddedVariables(this.targetWorkspace,s),t.Events.isEnabled()){for(t.Events.setGroup(!0),s=0;s<e.length;s++){var r=e[s];t.Events.fire(new(t.Events.get(t.Events.VAR_CREATE))(r))}t.Events.fire(new(t.Events.get(t.Events.BLOCK_CREATE))(i))}return this.autoClose?this.hide():this.filterForCapacity_(),i},t.Flyout.prototype.initFlyoutButton_=function(e,i,s){var r=e.createDom();e.moveTo(i,s),e.show(),this.listeners_.push(t.browserEvents.conditionalBind(r,"mousedown",this,this.onMouseDown_)),this.buttons_.push(e)},t.Flyout.prototype.createRect_=function(e,i,s,r,o){return i=t.utils.dom.createSvgElement(t.utils.Svg.RECT,{"fill-opacity":0,x:i,y:s,height:r.height,width:r.width},null),i.tooltip=e,t.Tooltip.bindMouseEvents(i),this.workspace_.getCanvas().insertBefore(i,e.getSvgRoot()),e.flyoutRect_=i,this.mats_[o]=i},t.Flyout.prototype.moveRectToBlock_=function(e,i){var s=i.getHeightWidth();e.setAttribute("width",s.width),e.setAttribute("height",s.height),i=i.getRelativeToSurfaceXY(),e.setAttribute("y",i.y),e.setAttribute("x",this.RTL?i.x-s.width:i.x)},t.Flyout.prototype.filterForCapacity_=function(){for(var e=this.workspace_.getTopBlocks(!1),i=0,s;s=e[i];i++)if(this.permanentlyDisabled_.indexOf(s)==-1)for(var r=this.targetWorkspace.isCapacityAvailable(t.utils.getBlockTypeCounts(s));s;)s.setEnabled(r),s=s.getNextBlock()},t.Flyout.prototype.reflow=function(){this.reflowWrapper_&&this.workspace_.removeChangeListener(this.reflowWrapper_),this.reflowInternal_(),this.reflowWrapper_&&this.workspace_.addChangeListener(this.reflowWrapper_)},t.Flyout.prototype.isScrollable=function(){return this.workspace_.scrollbar?this.workspace_.scrollbar.isVisible():!1},t.Flyout.prototype.placeNewBlock_=function(e){var i=this.targetWorkspace;if(!e.getSvgRoot())throw Error("oldBlock is not rendered.");var s=t.Xml.blockToDom(e,!0);if(i.setResizesEnabled(!1),s=t.Xml.domToBlock(s,i),!s.getSvgRoot())throw Error("block is not rendered.");var r=i.getOriginOffsetInPixels(),o=this.workspace_.getOriginOffsetInPixels();return e=e.getRelativeToSurfaceXY(),e.scale(this.workspace_.scale),e=t.utils.Coordinate.sum(o,e),r=t.utils.Coordinate.difference(e,r),r.scale(1/i.scale),s.moveBy(r.x,r.y),s},t.HorizontalFlyout=function(e){t.HorizontalFlyout.superClass_.constructor.call(this,e),this.horizontalLayout=!0},t.utils.object.inherits(t.HorizontalFlyout,t.Flyout),t.HorizontalFlyout.prototype.setMetrics_=function(e){if(this.isVisible()){var i=this.workspace_.getMetricsManager(),s=i.getScrollMetrics(),r=i.getViewMetrics();i=i.getAbsoluteMetrics(),typeof e.x=="number"&&(this.workspace_.scrollX=-(s.left+(s.width-r.width)*e.x)),this.workspace_.translate(this.workspace_.scrollX+i.left,this.workspace_.scrollY+i.top)}},t.HorizontalFlyout.prototype.getX=function(){return 0},t.HorizontalFlyout.prototype.getY=function(){if(!this.isVisible())return 0;var e=this.targetWorkspace.getMetricsManager(),i=e.getAbsoluteMetrics(),s=e.getViewMetrics();e=e.getToolboxMetrics();var r=this.toolboxPosition_==t.utils.toolbox.Position.TOP;return this.targetWorkspace.toolboxPosition==this.toolboxPosition_?this.targetWorkspace.getToolbox()?r?e.height:s.height-this.height_:r?0:s.height:r?0:s.height+i.top-this.height_},t.HorizontalFlyout.prototype.position=function(){if(this.isVisible()&&this.targetWorkspace.isVisible()){var e=this.targetWorkspace.getMetricsManager().getViewMetrics();this.width_=e.width,this.setBackgroundPath_(e.width-2*this.CORNER_RADIUS,this.height_-this.CORNER_RADIUS),e=this.getX();var i=this.getY();this.positionAt_(this.width_,this.height_,e,i)}},t.HorizontalFlyout.prototype.setBackgroundPath_=function(e,i){var s=this.toolboxPosition_==t.utils.toolbox.Position.TOP,r=["M 0,"+(s?0:this.CORNER_RADIUS)];s?(r.push("h",e+2*this.CORNER_RADIUS),r.push("v",i),r.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,this.CORNER_RADIUS),r.push("h",-e),r.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,-this.CORNER_RADIUS)):(r.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,-this.CORNER_RADIUS),r.push("h",e),r.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,this.CORNER_RADIUS),r.push("v",i),r.push("h",-e-2*this.CORNER_RADIUS)),r.push("z"),this.svgBackground_.setAttribute("d",r.join(" "))},t.HorizontalFlyout.prototype.scrollToStart=function(){this.workspace_.scrollbar.setX(this.RTL?1/0:0)},t.HorizontalFlyout.prototype.wheel_=function(e){var i=t.utils.getScrollDeltaPixels(e);if(i=i.x||i.y){var s=this.workspace_.getMetricsManager(),r=s.getScrollMetrics();i=s.getViewMetrics().left-r.left+i,this.workspace_.scrollbar.setX(i),t.WidgetDiv.hide(),t.DropDownDiv.hideWithoutAnimation()}e.preventDefault(),e.stopPropagation()},t.HorizontalFlyout.prototype.layout_=function(e,i){this.workspace_.scale=this.targetWorkspace.scale;var s=this.MARGIN,r=s+this.tabWidth_;this.RTL&&(e=e.reverse());for(var o=0,h;h=e[o];o++)if(h.type=="block"){h=h.block;for(var u=h.getDescendants(!1),p=0,d;d=u[p];p++)d.isInFlyout=!0;h.render(),u=h.getSvgRoot(),p=h.getHeightWidth(),d=h.outputConnection?this.tabWidth_:0,d=this.RTL?r+p.width:r-d,h.moveBy(d,s),d=this.createRect_(h,d,s,p,o),r+=p.width+i[o],this.addBlockListeners_(u,h,d)}else h.type=="button"&&(this.initFlyoutButton_(h.button,r,s),r+=h.button.width+i[o])},t.HorizontalFlyout.prototype.isDragTowardWorkspace=function(e){e=Math.atan2(e.y,e.x)/Math.PI*180;var i=this.dragAngleRange_;return e<90+i&&e>90-i||e>-90-i&&e<-90+i},t.HorizontalFlyout.prototype.getClientRect=function(){if(!this.svgGroup_)return null;var e=this.svgGroup_.getBoundingClientRect(),i=e.top;return this.toolboxPosition_==t.utils.toolbox.Position.TOP?new t.utils.Rect(-1e9,i+e.height,-1e9,1e9):new t.utils.Rect(i,1e9,-1e9,1e9)},t.HorizontalFlyout.prototype.reflowInternal_=function(){this.workspace_.scale=this.getFlyoutScale();for(var e=0,i=this.workspace_.getTopBlocks(!1),s=0,r;r=i[s];s++)e=Math.max(e,r.getHeightWidth().height);if(e+=1.5*this.MARGIN,e*=this.workspace_.scale,e+=t.Scrollbar.scrollbarThickness,this.height_!=e){for(s=0;r=i[s];s++)r.flyoutRect_&&this.moveRectToBlock_(r.flyoutRect_,r);this.targetWorkspace.toolboxPosition!=this.toolboxPosition_||this.toolboxPosition_!=t.utils.toolbox.Position.TOP||this.targetWorkspace.getToolbox()||this.targetWorkspace.translate(this.targetWorkspace.scrollX,this.targetWorkspace.scrollY+e),this.height_=e,this.position()}},t.registry.register(t.registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,t.registry.DEFAULT,t.HorizontalFlyout),t.VerticalFlyout=function(e){t.VerticalFlyout.superClass_.constructor.call(this,e)},t.utils.object.inherits(t.VerticalFlyout,t.Flyout),t.VerticalFlyout.registryName="verticalFlyout",t.VerticalFlyout.prototype.setMetrics_=function(e){if(this.isVisible()){var i=this.workspace_.getMetricsManager(),s=i.getScrollMetrics(),r=i.getViewMetrics();i=i.getAbsoluteMetrics(),typeof e.y=="number"&&(this.workspace_.scrollY=-(s.top+(s.height-r.height)*e.y)),this.workspace_.translate(this.workspace_.scrollX+i.left,this.workspace_.scrollY+i.top)}},t.VerticalFlyout.prototype.getX=function(){if(!this.isVisible())return 0;var e=this.targetWorkspace.getMetricsManager(),i=e.getAbsoluteMetrics(),s=e.getViewMetrics();return e=e.getToolboxMetrics(),this.targetWorkspace.toolboxPosition==this.toolboxPosition_?this.targetWorkspace.getToolbox()?this.toolboxPosition_==t.utils.toolbox.Position.LEFT?e.width:s.width-this.width_:this.toolboxPosition_==t.utils.toolbox.Position.LEFT?0:s.width:this.toolboxPosition_==t.utils.toolbox.Position.LEFT?0:s.width+i.left-this.width_},t.VerticalFlyout.prototype.getY=function(){return 0},t.VerticalFlyout.prototype.position=function(){if(this.isVisible()&&this.targetWorkspace.isVisible()){var e=this.targetWorkspace.getMetricsManager().getViewMetrics();this.height_=e.height,this.setBackgroundPath_(this.width_-this.CORNER_RADIUS,e.height-2*this.CORNER_RADIUS),e=this.getX();var i=this.getY();this.positionAt_(this.width_,this.height_,e,i)}},t.VerticalFlyout.prototype.setBackgroundPath_=function(e,i){var s=this.toolboxPosition_==t.utils.toolbox.Position.RIGHT,r=e+this.CORNER_RADIUS;r=["M "+(s?r:0)+",0"],r.push("h",s?-e:e),r.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,s?0:1,s?-this.CORNER_RADIUS:this.CORNER_RADIUS,this.CORNER_RADIUS),r.push("v",Math.max(0,i)),r.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,s?0:1,s?this.CORNER_RADIUS:-this.CORNER_RADIUS,this.CORNER_RADIUS),r.push("h",s?e:-e),r.push("z"),this.svgBackground_.setAttribute("d",r.join(" "))},t.VerticalFlyout.prototype.scrollToStart=function(){this.workspace_.scrollbar.setY(0)},t.VerticalFlyout.prototype.wheel_=function(e){var i=t.utils.getScrollDeltaPixels(e);if(i.y){var s=this.workspace_.getMetricsManager(),r=s.getScrollMetrics();i=s.getViewMetrics().top-r.top+i.y,this.workspace_.scrollbar.setY(i),t.WidgetDiv.hide(),t.DropDownDiv.hideWithoutAnimation()}e.preventDefault(),e.stopPropagation()},t.VerticalFlyout.prototype.layout_=function(e,i){this.workspace_.scale=this.targetWorkspace.scale;for(var s=this.MARGIN,r=this.RTL?s:s+this.tabWidth_,o=0,h;h=e[o];o++)if(h.type=="block"){h=h.block;for(var u=h.getDescendants(!1),p=0,d;d=u[p];p++)d.isInFlyout=!0;h.render(),u=h.getSvgRoot(),p=h.getHeightWidth(),d=h.outputConnection?r-this.tabWidth_:r,h.moveBy(d,s),d=this.createRect_(h,this.RTL?d-p.width:d,s,p,o),this.addBlockListeners_(u,h,d),s+=p.height+i[o]}else h.type=="button"&&(this.initFlyoutButton_(h.button,r,s),s+=h.button.height+i[o])},t.VerticalFlyout.prototype.isDragTowardWorkspace=function(e){e=Math.atan2(e.y,e.x)/Math.PI*180;var i=this.dragAngleRange_;return e<i&&e>-i||e<-180+i||e>180-i},t.VerticalFlyout.prototype.getClientRect=function(){if(!this.svgGroup_)return null;var e=this.svgGroup_.getBoundingClientRect(),i=e.left;return this.toolboxPosition_==t.utils.toolbox.Position.LEFT?new t.utils.Rect(-1e9,1e9,-1e9,i+e.width):new t.utils.Rect(-1e9,1e9,i,1e9)},t.VerticalFlyout.prototype.reflowInternal_=function(){this.workspace_.scale=this.getFlyoutScale();for(var e=0,i=this.workspace_.getTopBlocks(!1),s=0,r;r=i[s];s++){var o=r.getHeightWidth().width;r.outputConnection&&(o-=this.tabWidth_),e=Math.max(e,o)}for(s=0;r=this.buttons_[s];s++)e=Math.max(e,r.width);if(e+=1.5*this.MARGIN+this.tabWidth_,e*=this.workspace_.scale,e+=t.Scrollbar.scrollbarThickness,this.width_!=e){for(s=0;r=i[s];s++){if(this.RTL){o=r.getRelativeToSurfaceXY().x;var h=e/this.workspace_.scale-this.MARGIN;r.outputConnection||(h-=this.tabWidth_),r.moveBy(h-o,0)}r.flyoutRect_&&this.moveRectToBlock_(r.flyoutRect_,r)}if(this.RTL)for(s=0;r=this.buttons_[s];s++)i=r.getPosition().y,r.moveTo(e/this.workspace_.scale-r.width-this.MARGIN-this.tabWidth_,i);this.targetWorkspace.toolboxPosition!=this.toolboxPosition_||this.toolboxPosition_!=t.utils.toolbox.Position.LEFT||this.targetWorkspace.getToolbox()||this.targetWorkspace.translate(this.targetWorkspace.scrollX+e,this.targetWorkspace.scrollY),this.width_=e,this.position()}},t.registry.register(t.registry.Type.FLYOUTS_VERTICAL_TOOLBOX,t.registry.DEFAULT,t.VerticalFlyout),t.FlyoutButton=function(e,i,s,r){this.workspace_=e,this.targetWorkspace_=i,this.text_=s.text,this.position_=new t.utils.Coordinate(0,0),this.isLabel_=r,this.callbackKey_=s.callbackKey||s.callbackkey,this.cssClass_=s["web-class"]||null,this.onMouseUpWrapper_=null,this.info=s},t.FlyoutButton.MARGIN_X=5,t.FlyoutButton.MARGIN_Y=2,t.FlyoutButton.prototype.width=0,t.FlyoutButton.prototype.height=0,t.FlyoutButton.prototype.createDom=function(){var e=this.isLabel_?"blocklyFlyoutLabel":"blocklyFlyoutButton";if(this.cssClass_&&(e+=" "+this.cssClass_),this.svgGroup_=t.utils.dom.createSvgElement(t.utils.Svg.G,{class:e},this.workspace_.getCanvas()),!this.isLabel_)var i=t.utils.dom.createSvgElement(t.utils.Svg.RECT,{class:"blocklyFlyoutButtonShadow",rx:4,ry:4,x:1,y:1},this.svgGroup_);e=t.utils.dom.createSvgElement(t.utils.Svg.RECT,{class:this.isLabel_?"blocklyFlyoutLabelBackground":"blocklyFlyoutButtonBackground",rx:4,ry:4},this.svgGroup_);var s=t.utils.dom.createSvgElement(t.utils.Svg.TEXT,{class:this.isLabel_?"blocklyFlyoutLabelText":"blocklyText",x:0,y:0,"text-anchor":"middle"},this.svgGroup_),r=t.utils.replaceMessageReferences(this.text_);this.workspace_.RTL&&(r+=""),s.textContent=r,this.isLabel_&&(this.svgText_=s,this.workspace_.getThemeManager().subscribe(this.svgText_,"flyoutForegroundColour","fill"));var o=t.utils.style.getComputedStyle(s,"fontSize"),h=t.utils.style.getComputedStyle(s,"fontWeight"),u=t.utils.style.getComputedStyle(s,"fontFamily");return this.width=t.utils.dom.getFastTextWidthWithSizeString(s,o,h,u),r=t.utils.dom.measureFontMetrics(r,o,h,u),this.height=r.height,this.isLabel_||(this.width+=2*t.FlyoutButton.MARGIN_X,this.height+=2*t.FlyoutButton.MARGIN_Y,i.setAttribute("width",this.width),i.setAttribute("height",this.height)),e.setAttribute("width",this.width),e.setAttribute("height",this.height),s.setAttribute("x",this.width/2),s.setAttribute("y",this.height/2-r.height/2+r.baseline),this.updateTransform_(),this.onMouseUpWrapper_=t.browserEvents.conditionalBind(this.svgGroup_,"mouseup",this,this.onMouseUp_),this.svgGroup_},t.FlyoutButton.prototype.show=function(){this.updateTransform_(),this.svgGroup_.setAttribute("display","block")},t.FlyoutButton.prototype.updateTransform_=function(){this.svgGroup_.setAttribute("transform","translate("+this.position_.x+","+this.position_.y+")")},t.FlyoutButton.prototype.moveTo=function(e,i){this.position_.x=e,this.position_.y=i,this.updateTransform_()},t.FlyoutButton.prototype.isLabel=function(){return this.isLabel_},t.FlyoutButton.prototype.getPosition=function(){return this.position_},t.FlyoutButton.prototype.getButtonText=function(){return this.text_},t.FlyoutButton.prototype.getTargetWorkspace=function(){return this.targetWorkspace_},t.FlyoutButton.prototype.dispose=function(){this.onMouseUpWrapper_&&t.browserEvents.unbind(this.onMouseUpWrapper_),this.svgGroup_&&t.utils.dom.removeNode(this.svgGroup_),this.svgText_&&this.workspace_.getThemeManager().unsubscribe(this.svgText_)},t.FlyoutButton.prototype.onMouseUp_=function(e){(e=this.targetWorkspace_.getGesture(e))&&e.cancel(),this.isLabel_&&this.callbackKey_?console.warn("Labels should not have callbacks. Label text: "+this.text_):this.isLabel_||this.callbackKey_&&this.targetWorkspace_.getButtonCallback(this.callbackKey_)?this.isLabel_||this.targetWorkspace_.getButtonCallback(this.callbackKey_)(this):console.warn("Buttons should have callbacks. Button text: "+this.text_)},t.Css.register(".blocklyFlyoutButton {,fill: #888;,cursor: default;,},.blocklyFlyoutButtonShadow {,fill: #666;,},.blocklyFlyoutButton:hover {,fill: #aaa;,},.blocklyFlyoutLabel {,cursor: default;,},.blocklyFlyoutLabelBackground {,opacity: 0;,}".split(",")),t.Generator=function(e){this.name_=e,this.FUNCTION_NAME_PLACEHOLDER_REGEXP_=new RegExp(this.FUNCTION_NAME_PLACEHOLDER_,"g")},t.Generator.NAME_TYPE="generated_function",t.Generator.prototype.INFINITE_LOOP_TRAP=null,t.Generator.prototype.STATEMENT_PREFIX=null,t.Generator.prototype.STATEMENT_SUFFIX=null,t.Generator.prototype.INDENT="  ",t.Generator.prototype.COMMENT_WRAP=60,t.Generator.prototype.ORDER_OVERRIDES=[],t.Generator.prototype.isInitialized=null,t.Generator.prototype.workspaceToCode=function(e){e||(console.warn("No workspace specified in workspaceToCode call.  Guessing."),e=t.getMainWorkspace());var i=[];this.init(e),e=e.getTopBlocks(!0);for(var s=0,r;r=e[s];s++){var o=this.blockToCode(r);Array.isArray(o)&&(o=o[0]),o&&(r.outputConnection&&(o=this.scrubNakedValue(o),this.STATEMENT_PREFIX&&!r.suppressPrefixSuffix&&(o=this.injectId(this.STATEMENT_PREFIX,r)+o),this.STATEMENT_SUFFIX&&!r.suppressPrefixSuffix&&(o+=this.injectId(this.STATEMENT_SUFFIX,r))),i.push(o))}return i=i.join(`
`),i=this.finish(i),i=i.replace(/^\s+\n/,""),i=i.replace(/\n\s+$/,`
`),i=i.replace(/[ \t]+\n/g,`
`)},t.Generator.prototype.prefixLines=function(e,i){return i+e.replace(/(?!\n$)\n/g,`
`+i)},t.Generator.prototype.allNestedComments=function(e){var i=[];e=e.getDescendants(!0);for(var s=0;s<e.length;s++){var r=e[s].getCommentText();r&&i.push(r)}return i.length&&i.push(""),i.join(`
`)},t.Generator.prototype.blockToCode=function(e,i){if(this.isInitialized===!1&&console.warn("Generator init was not called before blockToCode was called."),!e)return"";if(!e.isEnabled())return i?"":this.blockToCode(e.getNextBlock());if(e.isInsertionMarker())return i?"":this.blockToCode(e.getChildren(!1)[0]);var s=this[e.type];if(typeof s!="function")throw Error('Language "'+this.name_+'" does not know how to generate  code for block type "'+e.type+'".');if(s=s.call(e,e),Array.isArray(s)){if(!e.outputConnection)throw TypeError("Expecting string from statement block: "+e.type);return[this.scrub_(e,s[0],i),s[1]]}if(typeof s=="string")return this.STATEMENT_PREFIX&&!e.suppressPrefixSuffix&&(s=this.injectId(this.STATEMENT_PREFIX,e)+s),this.STATEMENT_SUFFIX&&!e.suppressPrefixSuffix&&(s+=this.injectId(this.STATEMENT_SUFFIX,e)),this.scrub_(e,s,i);if(s===null)return"";throw SyntaxError("Invalid code generated: "+s)},t.Generator.prototype.valueToCode=function(e,i,s){if(isNaN(s))throw TypeError("Expecting valid order from block: "+e.type);var r=e.getInputTargetBlock(i);if(!r||(i=this.blockToCode(r),i===""))return"";if(!Array.isArray(i))throw TypeError("Expecting tuple from value block: "+r.type);if(e=i[0],i=i[1],isNaN(i))throw TypeError("Expecting valid order from value block: "+r.type);if(!e)return"";r=!1;var o=Math.floor(s),h=Math.floor(i);if(o<=h&&(o!=h||o!=0&&o!=99)){for(r=!0,o=0;o<this.ORDER_OVERRIDES.length;o++)if(this.ORDER_OVERRIDES[o][0]==s&&this.ORDER_OVERRIDES[o][1]==i){r=!1;break}}return r&&(e="("+e+")"),e},t.Generator.prototype.statementToCode=function(e,i){if(e=e.getInputTargetBlock(i),i=this.blockToCode(e),typeof i!="string")throw TypeError("Expecting code from statement block: "+(e&&e.type));return i&&(i=this.prefixLines(i,this.INDENT)),i},t.Generator.prototype.addLoopTrap=function(e,i){return this.INFINITE_LOOP_TRAP&&(e=this.prefixLines(this.injectId(this.INFINITE_LOOP_TRAP,i),this.INDENT)+e),this.STATEMENT_SUFFIX&&!i.suppressPrefixSuffix&&(e=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,i),this.INDENT)+e),this.STATEMENT_PREFIX&&!i.suppressPrefixSuffix&&(e+=this.prefixLines(this.injectId(this.STATEMENT_PREFIX,i),this.INDENT)),e},t.Generator.prototype.injectId=function(e,i){return i=i.id.replace(/\$/g,"$$$$"),e.replace(/%1/g,"'"+i+"'")},t.Generator.prototype.RESERVED_WORDS_="",t.Generator.prototype.addReservedWords=function(e){this.RESERVED_WORDS_+=e+","},t.Generator.prototype.FUNCTION_NAME_PLACEHOLDER_="{leCUI8hutHZI4480Dc}",t.Generator.prototype.provideFunction_=function(e,i){if(!this.definitions_[e]){var s=this.variableDB_.getDistinctName(e,t.PROCEDURE_CATEGORY_NAME);this.functionNames_[e]=s,i=i.join(`
`).replace(this.FUNCTION_NAME_PLACEHOLDER_REGEXP_,s);for(var r;r!=i;)r=i,i=i.replace(/^(( {2})*) {2}/gm,"$1\0");i=i.replace(/\0/g,this.INDENT),this.definitions_[e]=i}return this.functionNames_[e]},t.Generator.prototype.init=function(e){},t.Generator.prototype.scrub_=function(e,i,s){return i},t.Generator.prototype.finish=function(e){return e},t.Generator.prototype.scrubNakedValue=function(e){return e},t.ToolboxItem=function(e,i,s){this.id_=e.toolboxitemid||t.utils.IdGenerator.getNextUniqueId(),this.level_=(this.parent_=s||null)?this.parent_.getLevel()+1:0,this.toolboxItemDef_=e,this.parentToolbox_=i,this.workspace_=this.parentToolbox_.getWorkspace()},t.ToolboxItem.prototype.init=function(){},t.ToolboxItem.prototype.getDiv=function(){return null},t.ToolboxItem.prototype.getId=function(){return this.id_},t.ToolboxItem.prototype.getParent=function(){return null},t.ToolboxItem.prototype.getLevel=function(){return this.level_},t.ToolboxItem.prototype.isSelectable=function(){return!1},t.ToolboxItem.prototype.isCollapsible=function(){return!1},t.ToolboxItem.prototype.dispose=function(){},t.ToolboxCategory=function(e,i,s){t.ToolboxCategory.superClass_.constructor.call(this,e,i,s),this.name_=t.utils.replaceMessageReferences(e.name),this.colour_=this.getColour_(e),this.labelDom_=this.iconDom_=this.rowContents_=this.rowDiv_=this.htmlDiv_=null,this.cssConfig_=this.makeDefaultCssConfig_(),t.utils.object.mixin(this.cssConfig_,e.cssconfig||e.cssConfig),this.isDisabled_=this.isHidden_=!1,this.flyoutItems_=[],this.parseContents_(e)},t.utils.object.inherits(t.ToolboxCategory,t.ToolboxItem),t.ToolboxCategory.registrationName="category",t.ToolboxCategory.nestedPadding=19,t.ToolboxCategory.borderWidth=8,t.ToolboxCategory.defaultBackgroundColour="#57e",t.ToolboxCategory.prototype.makeDefaultCssConfig_=function(){return{container:"blocklyToolboxCategory",row:"blocklyTreeRow",rowcontentcontainer:"blocklyTreeRowContentContainer",icon:"blocklyTreeIcon",label:"blocklyTreeLabel",contents:"blocklyToolboxContents",selected:"blocklyTreeSelected",openicon:"blocklyTreeIconOpen",closedicon:"blocklyTreeIconClosed"}},t.ToolboxCategory.prototype.parseContents_=function(e){var i=e.contents;if(e.custom)this.flyoutItems_=e.custom;else if(i){e=0;for(var s;s=i[e];e++)this.flyoutItems_.push(s)}},t.ToolboxCategory.prototype.init=function(){this.createDom_(),this.toolboxItemDef_.hidden=="true"&&this.hide()},t.ToolboxCategory.prototype.createDom_=function(){return this.htmlDiv_=this.createContainer_(),t.utils.aria.setRole(this.htmlDiv_,t.utils.aria.Role.TREEITEM),t.utils.aria.setState(this.htmlDiv_,t.utils.aria.State.SELECTED,!1),t.utils.aria.setState(this.htmlDiv_,t.utils.aria.State.LEVEL,this.level_),this.rowDiv_=this.createRowContainer_(),this.rowDiv_.style.pointerEvents="auto",this.htmlDiv_.appendChild(this.rowDiv_),this.rowContents_=this.createRowContentsContainer_(),this.rowContents_.style.pointerEvents="none",this.rowDiv_.appendChild(this.rowContents_),this.iconDom_=this.createIconDom_(),t.utils.aria.setRole(this.iconDom_,t.utils.aria.Role.PRESENTATION),this.rowContents_.appendChild(this.iconDom_),this.labelDom_=this.createLabelDom_(this.name_),this.rowContents_.appendChild(this.labelDom_),t.utils.aria.setState(this.htmlDiv_,t.utils.aria.State.LABELLEDBY,this.labelDom_.getAttribute("id")),this.addColourBorder_(this.colour_),this.htmlDiv_},t.ToolboxCategory.prototype.createContainer_=function(){var e=document.createElement("div");return t.utils.dom.addClass(e,this.cssConfig_.container),e},t.ToolboxCategory.prototype.createRowContainer_=function(){var e=document.createElement("div");t.utils.dom.addClass(e,this.cssConfig_.row);var i=t.ToolboxCategory.nestedPadding*this.getLevel();return i=i.toString()+"px",this.workspace_.RTL?e.style.paddingRight=i:e.style.paddingLeft=i,e},t.ToolboxCategory.prototype.createRowContentsContainer_=function(){var e=document.createElement("div");return t.utils.dom.addClass(e,this.cssConfig_.rowcontentcontainer),e},t.ToolboxCategory.prototype.createIconDom_=function(){var e=document.createElement("span");return this.parentToolbox_.isHorizontal()||t.utils.dom.addClass(e,this.cssConfig_.icon),e.style.display="inline-block",e},t.ToolboxCategory.prototype.createLabelDom_=function(e){var i=document.createElement("span");return i.setAttribute("id",this.getId()+".label"),i.textContent=e,t.utils.dom.addClass(i,this.cssConfig_.label),i},t.ToolboxCategory.prototype.refreshTheme=function(){this.colour_=this.getColour_(this.toolboxItemDef_),this.addColourBorder_(this.colour_)},t.ToolboxCategory.prototype.addColourBorder_=function(e){e&&(e=t.ToolboxCategory.borderWidth+"px solid "+(e||"#ddd"),this.workspace_.RTL?this.rowDiv_.style.borderRight=e:this.rowDiv_.style.borderLeft=e)},t.ToolboxCategory.prototype.getColour_=function(e){var i=e.categorystyle||e.categoryStyle;if((e=e.colour)&&i)console.warn('Toolbox category "'+this.name_+'" must not have both a style and a colour');else return i?this.getColourfromStyle_(i):this.parseColour_(e);return""},t.ToolboxCategory.prototype.getColourfromStyle_=function(e){var i=this.workspace_.getTheme();if(e&&i){if((i=i.categoryStyles[e])&&i.colour)return this.parseColour_(i.colour);console.warn('Style "'+e+'" must exist and contain a colour value')}return""},t.ToolboxCategory.prototype.getClickTarget=function(){return this.rowDiv_},t.ToolboxCategory.prototype.parseColour_=function(e){if(e=t.utils.replaceMessageReferences(e),e==null||e==="")return"";var i=Number(e);return isNaN(i)?(i=t.utils.colour.parse(e))?i:(console.warn('Toolbox category "'+this.name_+'" has unrecognized colour attribute: '+e),""):t.hueToHex(i)},t.ToolboxCategory.prototype.openIcon_=function(e){e&&(t.utils.dom.removeClasses(e,this.cssConfig_.closedicon),t.utils.dom.addClass(e,this.cssConfig_.openicon))},t.ToolboxCategory.prototype.closeIcon_=function(e){e&&(t.utils.dom.removeClasses(e,this.cssConfig_.openicon),t.utils.dom.addClass(e,this.cssConfig_.closedicon))},t.ToolboxCategory.prototype.setVisible_=function(e){this.htmlDiv_.style.display=e?"block":"none",this.isHidden_=!e,this.parentToolbox_.getSelectedItem()==this&&this.parentToolbox_.clearSelection()},t.ToolboxCategory.prototype.hide=function(){this.setVisible_(!1)},t.ToolboxCategory.prototype.show=function(){this.setVisible_(!0)},t.ToolboxCategory.prototype.isVisible=function(){return!this.isHidden_&&this.allAncestorsExpanded_()},t.ToolboxCategory.prototype.allAncestorsExpanded_=function(){for(var e=this;e.getParent();)if(e=e.getParent(),!e.isExpanded())return!1;return!0},t.ToolboxCategory.prototype.isSelectable=function(){return this.isVisible()&&!this.isDisabled_},t.ToolboxCategory.prototype.onClick=function(e){},t.ToolboxCategory.prototype.setSelected=function(e){if(e){var i=this.parseColour_(t.ToolboxCategory.defaultBackgroundColour);this.rowDiv_.style.backgroundColor=this.colour_||i,t.utils.dom.addClass(this.rowDiv_,this.cssConfig_.selected)}else this.rowDiv_.style.backgroundColor="",t.utils.dom.removeClass(this.rowDiv_,this.cssConfig_.selected);t.utils.aria.setState(this.htmlDiv_,t.utils.aria.State.SELECTED,e)},t.ToolboxCategory.prototype.setDisabled=function(e){this.isDisabled_=e,this.getDiv().setAttribute("disabled",e),e?this.getDiv().setAttribute("disabled","true"):this.getDiv().removeAttribute("disabled")},t.ToolboxCategory.prototype.getName=function(){return this.name_},t.ToolboxCategory.prototype.getParent=function(){return this.parent_},t.ToolboxCategory.prototype.getDiv=function(){return this.htmlDiv_},t.ToolboxCategory.prototype.getContents=function(){return this.flyoutItems_},t.ToolboxCategory.prototype.updateFlyoutContents=function(e){this.flyoutItems_=[],typeof e=="string"?this.toolboxItemDef_.custom=e:(delete this.toolboxItemDef_.custom,this.toolboxItemDef_.contents=t.utils.toolbox.convertFlyoutDefToJsonArray(e)),this.parseContents_(this.toolboxItemDef_)},t.ToolboxCategory.prototype.dispose=function(){t.utils.dom.removeNode(this.htmlDiv_)},t.Css.register([".blocklyTreeRow:not(.blocklyTreeSelected):hover {","background-color: rgba(255, 255, 255, 0.2);","}",'.blocklyToolboxDiv[layout="h"] .blocklyToolboxCategory {',"margin: 1px 5px 1px 0;","}",'.blocklyToolboxDiv[dir="RTL"][layout="h"] .blocklyToolboxCategory {',"margin: 1px 0 1px 5px;","}",".blocklyTreeRow {","height: 22px;","line-height: 22px;","margin-bottom: 3px;","padding-right: 8px;","white-space: nowrap;","}",'.blocklyToolboxDiv[dir="RTL"] .blocklyTreeRow {',"margin-left: 8px;","padding-right: 0px","}",".blocklyTreeIcon {","background-image: url(<<<PATH>>>/sprites.png);","height: 16px;","vertical-align: middle;","visibility: hidden;","width: 16px;","}",".blocklyTreeIconClosed {","background-position: -32px -1px;","}",'.blocklyToolboxDiv[dir="RTL"] .blocklyTreeIconClosed {',"background-position: 0 -1px;","}",".blocklyTreeSelected>.blocklyTreeIconClosed {","background-position: -32px -17px;","}",'.blocklyToolboxDiv[dir="RTL"] .blocklyTreeSelected>.blocklyTreeIconClosed {',"background-position: 0 -17px;","}",".blocklyTreeIconOpen {","background-position: -16px -1px;","}",".blocklyTreeSelected>.blocklyTreeIconOpen {","background-position: -16px -17px;","}",".blocklyTreeLabel {","cursor: default;","font: 16px sans-serif;","padding: 0 3px;","vertical-align: middle;","}",".blocklyToolboxDelete .blocklyTreeLabel {",'cursor: url("<<<PATH>>>/handdelete.cur"), auto;',"}",".blocklyTreeSelected .blocklyTreeLabel {","color: #fff;","}"]),t.registry.register(t.registry.Type.TOOLBOX_ITEM,t.ToolboxCategory.registrationName,t.ToolboxCategory),t.ToolboxSeparator=function(e,i){t.ToolboxSeparator.superClass_.constructor.call(this,e,i),this.cssConfig_={container:"blocklyTreeSeparator"},t.utils.object.mixin(this.cssConfig_,e.cssconfig||e.cssConfig)},t.utils.object.inherits(t.ToolboxSeparator,t.ToolboxItem),t.ToolboxSeparator.registrationName="sep",t.ToolboxSeparator.prototype.init=function(){this.createDom_()},t.ToolboxSeparator.prototype.createDom_=function(){var e=document.createElement("div");return t.utils.dom.addClass(e,this.cssConfig_.container),this.htmlDiv_=e},t.ToolboxSeparator.prototype.getDiv=function(){return this.htmlDiv_},t.ToolboxSeparator.prototype.dispose=function(){t.utils.dom.removeNode(this.htmlDiv_)},t.Css.register('.blocklyTreeSeparator {,border-bottom: solid #e5e5e5 1px;,height: 0;,margin: 5px 0;,},.blocklyToolboxDiv[layout="h"] .blocklyTreeSeparator {,border-right: solid #e5e5e5 1px;,border-bottom: none;,height: auto;,margin: 0 5px 0 5px;,padding: 5px 0;,width: 0;,}'.split(",")),t.registry.register(t.registry.Type.TOOLBOX_ITEM,t.ToolboxSeparator.registrationName,t.ToolboxSeparator),t.CollapsibleToolboxCategory=function(e,i,s){this.subcategoriesDiv_=null,this.expanded_=!1,this.toolboxItems_=[],t.CollapsibleToolboxCategory.superClass_.constructor.call(this,e,i,s)},t.utils.object.inherits(t.CollapsibleToolboxCategory,t.ToolboxCategory),t.CollapsibleToolboxCategory.registrationName="collapsibleCategory",t.CollapsibleToolboxCategory.prototype.makeDefaultCssConfig_=function(){var e=t.CollapsibleToolboxCategory.superClass_.makeDefaultCssConfig_.call(this);return e.contents="blocklyToolboxContents",e},t.CollapsibleToolboxCategory.prototype.parseContents_=function(e){var i=e.contents,s=!0;if(e.custom)this.flyoutItems_=e.custom;else if(i){e=0;for(var r;r=i[e];e++)!t.registry.hasItem(t.registry.Type.TOOLBOX_ITEM,r.kind)||r.kind.toLowerCase()==t.ToolboxSeparator.registrationName&&s?(this.flyoutItems_.push(r),s=!0):(this.createToolboxItem_(r),s=!1)}},t.CollapsibleToolboxCategory.prototype.createToolboxItem_=function(e){var i=e.kind;i.toUpperCase()=="CATEGORY"&&t.utils.toolbox.isCategoryCollapsible(e)&&(i=t.CollapsibleToolboxCategory.registrationName),e=new(t.registry.getClass(t.registry.Type.TOOLBOX_ITEM,i))(e,this.parentToolbox_,this),this.toolboxItems_.push(e)},t.CollapsibleToolboxCategory.prototype.init=function(){t.CollapsibleToolboxCategory.superClass_.init.call(this),this.setExpanded(this.toolboxItemDef_.expanded=="true"||this.toolboxItemDef_.expanded)},t.CollapsibleToolboxCategory.prototype.createDom_=function(){t.CollapsibleToolboxCategory.superClass_.createDom_.call(this);var e=this.getChildToolboxItems();return this.subcategoriesDiv_=this.createSubCategoriesDom_(e),t.utils.aria.setRole(this.subcategoriesDiv_,t.utils.aria.Role.GROUP),this.htmlDiv_.appendChild(this.subcategoriesDiv_),this.htmlDiv_},t.CollapsibleToolboxCategory.prototype.createIconDom_=function(){var e=document.createElement("span");return this.parentToolbox_.isHorizontal()||(t.utils.dom.addClass(e,this.cssConfig_.icon),e.style.visibility="visible"),e.style.display="inline-block",e},t.CollapsibleToolboxCategory.prototype.createSubCategoriesDom_=function(e){var i=document.createElement("div");t.utils.dom.addClass(i,this.cssConfig_.contents);for(var s=0;s<e.length;s++){var r=e[s];r.init();var o=r.getDiv();i.appendChild(o),r.getClickTarget&&r.getClickTarget().setAttribute("id",r.getId())}return i},t.CollapsibleToolboxCategory.prototype.setExpanded=function(e){this.expanded_!=e&&((this.expanded_=e)?(this.subcategoriesDiv_.style.display="block",this.openIcon_(this.iconDom_)):(this.subcategoriesDiv_.style.display="none",this.closeIcon_(this.iconDom_)),t.utils.aria.setState(this.htmlDiv_,t.utils.aria.State.EXPANDED,e),this.parentToolbox_.handleToolboxItemResize())},t.CollapsibleToolboxCategory.prototype.setVisible_=function(e){this.htmlDiv_.style.display=e?"block":"none";for(var i=0,s;s=this.getChildToolboxItems()[i];i++)s.setVisible_(e);this.isHidden_=!e,this.parentToolbox_.getSelectedItem()==this&&this.parentToolbox_.clearSelection()},t.CollapsibleToolboxCategory.prototype.isExpanded=function(){return this.expanded_},t.CollapsibleToolboxCategory.prototype.isCollapsible=function(){return!0},t.CollapsibleToolboxCategory.prototype.onClick=function(e){this.toggleExpanded()},t.CollapsibleToolboxCategory.prototype.toggleExpanded=function(){this.setExpanded(!this.expanded_)},t.CollapsibleToolboxCategory.prototype.getDiv=function(){return this.htmlDiv_},t.CollapsibleToolboxCategory.prototype.getChildToolboxItems=function(){return this.toolboxItems_},t.registry.register(t.registry.Type.TOOLBOX_ITEM,t.CollapsibleToolboxCategory.registrationName,t.CollapsibleToolboxCategory),t.Events.ToolboxItemSelect=function(e,i,s){t.Events.ToolboxItemSelect.superClass_.constructor.call(this,s),this.oldItem=e,this.newItem=i},t.utils.object.inherits(t.Events.ToolboxItemSelect,t.Events.UiBase),t.Events.ToolboxItemSelect.prototype.type=t.Events.TOOLBOX_ITEM_SELECT,t.Events.ToolboxItemSelect.prototype.toJson=function(){var e=t.Events.ToolboxItemSelect.superClass_.toJson.call(this);return e.oldItem=this.oldItem,e.newItem=this.newItem,e},t.Events.ToolboxItemSelect.prototype.fromJson=function(e){t.Events.ToolboxItemSelect.superClass_.fromJson.call(this,e),this.oldItem=e.oldItem,this.newItem=e.newItem},t.registry.register(t.registry.Type.EVENT,t.Events.TOOLBOX_ITEM_SELECT,t.Events.ToolboxItemSelect),t.Toolbox=function(e){this.workspace_=e,this.toolboxDef_=e.options.languageTree||{contents:[]},this.horizontalLayout_=e.options.horizontalLayout,this.contentsDiv_=this.HtmlDiv=null,this.contents_=[],this.height_=this.width_=0,this.RTL=e.options.RTL,this.flyout_=null,this.contentMap_={},this.toolboxPosition=e.options.toolboxPosition,this.previouslySelectedItem_=this.selectedItem_=null,this.boundEvents_=[]},t.Toolbox.prototype.onShortcut=function(e){return!1},t.Toolbox.prototype.init=function(){var e=this.workspace_,i=e.getParentSvg();this.flyout_=this.createFlyout_(),this.HtmlDiv=this.createDom_(this.workspace_),t.utils.dom.insertAfter(this.flyout_.createDom("svg"),i),this.flyout_.init(e),this.render(this.toolboxDef_),e=e.getThemeManager(),e.subscribe(this.HtmlDiv,"toolboxBackgroundColour","background-color"),e.subscribe(this.HtmlDiv,"toolboxForegroundColour","color")},t.Toolbox.prototype.createDom_=function(e){e=e.getParentSvg();var i=this.createContainer_();return this.contentsDiv_=this.createContentsContainer_(),this.contentsDiv_.tabIndex=0,t.utils.aria.setRole(this.contentsDiv_,t.utils.aria.Role.TREE),i.appendChild(this.contentsDiv_),e.parentNode.insertBefore(i,e),this.attachEvents_(i,this.contentsDiv_),i},t.Toolbox.prototype.createContainer_=function(){var e=document.createElement("div");return e.setAttribute("layout",this.isHorizontal()?"h":"v"),t.utils.dom.addClass(e,"blocklyToolboxDiv"),t.utils.dom.addClass(e,"blocklyNonSelectable"),e.setAttribute("dir",this.RTL?"RTL":"LTR"),e},t.Toolbox.prototype.createContentsContainer_=function(){var e=document.createElement("div");return t.utils.dom.addClass(e,"blocklyToolboxContents"),this.isHorizontal()&&(e.style.flexDirection="row"),e},t.Toolbox.prototype.attachEvents_=function(e,i){e=t.browserEvents.conditionalBind(e,"click",this,this.onClick_,!1,!0),this.boundEvents_.push(e),i=t.browserEvents.conditionalBind(i,"keydown",this,this.onKeyDown_,!1,!0),this.boundEvents_.push(i)},t.Toolbox.prototype.onClick_=function(e){if(t.utils.isRightButton(e)||e.target==this.HtmlDiv)t.hideChaff(!1);else{var i=e.target.getAttribute("id");i&&(i=this.getToolboxItemById(i),i.isSelectable()&&(this.setSelectedItem(i),i.onClick(e))),t.hideChaff(!0)}t.Touch.clearTouchIdentifier()},t.Toolbox.prototype.onKeyDown_=function(e){var i=!1;switch(e.keyCode){case t.utils.KeyCodes.DOWN:i=this.selectNext_();break;case t.utils.KeyCodes.UP:i=this.selectPrevious_();break;case t.utils.KeyCodes.LEFT:i=this.selectParent_();break;case t.utils.KeyCodes.RIGHT:i=this.selectChild_();break;case t.utils.KeyCodes.ENTER:case t.utils.KeyCodes.SPACE:this.selectedItem_&&this.selectedItem_.isCollapsible()&&(this.selectedItem_.toggleExpanded(),i=!0);break;default:i=!1}!i&&this.selectedItem_&&this.selectedItem_.onKeyDown&&(i=this.selectedItem_.onKeyDown(e)),i&&e.preventDefault()},t.Toolbox.prototype.createFlyout_=function(){var e=this.workspace_,i=new t.Options({parentWorkspace:e,rtl:e.RTL,oneBasedIndex:e.options.oneBasedIndex,horizontalLayout:e.horizontalLayout,renderer:e.options.renderer,rendererOverrides:e.options.rendererOverrides,move:{scrollbars:!0}});return i.toolboxPosition=e.options.toolboxPosition,new(e.horizontalLayout?t.registry.getClassFromOptions(t.registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,e.options,!0):t.registry.getClassFromOptions(t.registry.Type.FLYOUTS_VERTICAL_TOOLBOX,e.options,!0))(i)},t.Toolbox.prototype.render=function(e){this.toolboxDef_=e;for(var i=0;i<this.contents_.length;i++){var s=this.contents_[i];s&&s.dispose()}this.contents_=[],this.contentMap_={},this.renderContents_(e.contents),this.position()},t.Toolbox.prototype.renderContents_=function(e){for(var i=document.createDocumentFragment(),s=0,r;r=e[s];s++)this.createToolboxItem_(r,i);this.contentsDiv_.appendChild(i)},t.Toolbox.prototype.createToolboxItem_=function(e,i){var s=e.kind;s.toUpperCase()=="CATEGORY"&&t.utils.toolbox.isCategoryCollapsible(e)&&(s=t.CollapsibleToolboxCategory.registrationName),(s=t.registry.getClass(t.registry.Type.TOOLBOX_ITEM,s.toLowerCase()))&&(e=new s(e,this),this.addToolboxItem_(e),e.init(),(s=e.getDiv())&&i.appendChild(s),e.getClickTarget&&e.getClickTarget().setAttribute("id",e.getId()))},t.Toolbox.prototype.addToolboxItem_=function(e){if(this.contents_.push(e),this.contentMap_[e.getId()]=e,e.isCollapsible())for(var i=0,s;s=e.getChildToolboxItems()[i];i++)this.addToolboxItem_(s)},t.Toolbox.prototype.getToolboxItems=function(){return this.contents_},t.Toolbox.prototype.addStyle=function(e){t.utils.dom.addClass(this.HtmlDiv,e)},t.Toolbox.prototype.removeStyle=function(e){t.utils.dom.removeClass(this.HtmlDiv,e)},t.Toolbox.prototype.getClientRect=function(){if(!this.HtmlDiv)return null;var e=this.HtmlDiv.getBoundingClientRect(),i=e.top,s=i+e.height,r=e.left;return e=r+e.width,this.toolboxPosition==t.utils.toolbox.Position.TOP?new t.utils.Rect(-1e7,s,-1e7,1e7):this.toolboxPosition==t.utils.toolbox.Position.BOTTOM?new t.utils.Rect(i,1e7,-1e7,1e7):this.toolboxPosition==t.utils.toolbox.Position.LEFT?new t.utils.Rect(-1e7,1e7,-1e7,e):new t.utils.Rect(-1e7,1e7,r,1e7)},t.Toolbox.prototype.getToolboxItemById=function(e){return this.contentMap_[e]},t.Toolbox.prototype.getWidth=function(){return this.width_},t.Toolbox.prototype.getHeight=function(){return this.height_},t.Toolbox.prototype.getFlyout=function(){return this.flyout_},t.Toolbox.prototype.getWorkspace=function(){return this.workspace_},t.Toolbox.prototype.getSelectedItem=function(){return this.selectedItem_},t.Toolbox.prototype.getPreviouslySelectedItem=function(){return this.previouslySelectedItem_},t.Toolbox.prototype.isHorizontal=function(){return this.horizontalLayout_},t.Toolbox.prototype.position=function(){var e=this.workspace_.getMetrics(),i=this.HtmlDiv;i&&(this.horizontalLayout_?(i.style.left="0",i.style.height="auto",i.style.width="100%",this.height_=i.offsetHeight,this.width_=e.viewWidth,this.toolboxPosition==t.utils.toolbox.Position.TOP?i.style.top="0":i.style.bottom="0"):(this.toolboxPosition==t.utils.toolbox.Position.RIGHT?i.style.right="0":i.style.left="0",i.style.height="100%",this.width_=i.offsetWidth,this.height_=e.viewHeight),this.flyout_.position())},t.Toolbox.prototype.handleToolboxItemResize=function(){var e=this.workspace_,i=this.HtmlDiv.getBoundingClientRect();e.translate(this.toolboxPosition==t.utils.toolbox.Position.LEFT?e.scrollX+i.width:e.scrollX,this.toolboxPosition==t.utils.toolbox.Position.TOP?e.scrollY+i.height:e.scrollY),t.svgResize(e)},t.Toolbox.prototype.clearSelection=function(){this.setSelectedItem(null)},t.Toolbox.prototype.refreshTheme=function(){for(var e=0;e<this.contents_.length;e++){var i=this.contents_[e];i.refreshTheme&&i.refreshTheme()}},t.Toolbox.prototype.refreshSelection=function(){this.selectedItem_&&this.selectedItem_.isSelectable()&&this.selectedItem_.getContents().length&&this.flyout_.show(this.selectedItem_.getContents())},t.Toolbox.prototype.setVisible=function(e){this.HtmlDiv.style.display=e?"block":"none"},t.Toolbox.prototype.setSelectedItem=function(e){var i=this.selectedItem_;!e&&!i||e&&!e.isSelectable()||(this.shouldDeselectItem_(i,e)&&i!=null&&this.deselectItem_(i),this.shouldSelectItem_(i,e)&&e!=null&&this.selectItem_(i,e),this.updateFlyout_(i,e),this.fireSelectEvent_(i,e))},t.Toolbox.prototype.shouldDeselectItem_=function(e,i){return e!=null&&(!e.isCollapsible()||e!=i)},t.Toolbox.prototype.shouldSelectItem_=function(e,i){return i!=null&&i!=e},t.Toolbox.prototype.deselectItem_=function(e){this.selectedItem_=null,this.previouslySelectedItem_=e,e.setSelected(!1),t.utils.aria.setState(this.contentsDiv_,t.utils.aria.State.ACTIVEDESCENDANT,"")},t.Toolbox.prototype.selectItem_=function(e,i){this.selectedItem_=i,this.previouslySelectedItem_=e,i.setSelected(!0),t.utils.aria.setState(this.contentsDiv_,t.utils.aria.State.ACTIVEDESCENDANT,i.getId())},t.Toolbox.prototype.selectItemByPosition=function(e){-1<e&&e<this.contents_.length&&(e=this.contents_[e],e.isSelectable()&&this.setSelectedItem(e))},t.Toolbox.prototype.updateFlyout_=function(e,i){(e!=i||i.isCollapsible())&&i&&i.getContents().length?(this.flyout_.show(i.getContents()),this.flyout_.scrollToStart()):this.flyout_.hide()},t.Toolbox.prototype.fireSelectEvent_=function(e,i){var s=e&&e.getName(),r=i&&i.getName();e==i&&(r=null),e=new(t.Events.get(t.Events.TOOLBOX_ITEM_SELECT))(s,r,this.workspace_.id),t.Events.fire(e)},t.Toolbox.prototype.selectParent_=function(){return this.selectedItem_?this.selectedItem_.isCollapsible()&&this.selectedItem_.isExpanded()?(this.selectedItem_.setExpanded(!1),!0):this.selectedItem_.getParent()&&this.selectedItem_.getParent().isSelectable()?(this.setSelectedItem(this.selectedItem_.getParent()),!0):!1:!1},t.Toolbox.prototype.selectChild_=function(){if(!this.selectedItem_||!this.selectedItem_.isCollapsible())return!1;var e=this.selectedItem_;return e.isExpanded()?this.selectNext_():e.setExpanded(!0),!0},t.Toolbox.prototype.selectNext_=function(){if(!this.selectedItem_)return!1;var e=this.contents_.indexOf(this.selectedItem_)+1;if(-1<e&&e<this.contents_.length){for(var i=this.contents_[e];i&&!i.isSelectable();)i=this.contents_[++e];if(i&&i.isSelectable())return this.setSelectedItem(i),!0}return!1},t.Toolbox.prototype.selectPrevious_=function(){if(!this.selectedItem_)return!1;var e=this.contents_.indexOf(this.selectedItem_)-1;if(-1<e&&e<this.contents_.length){for(var i=this.contents_[e];i&&!i.isSelectable();)i=this.contents_[--e];if(i&&i.isSelectable())return this.setSelectedItem(i),!0}return!1},t.Toolbox.prototype.dispose=function(){this.flyout_.dispose();for(var e=0;e<this.contents_.length;e++)this.contents_[e].dispose();for(e=0;e<this.boundEvents_.length;e++)t.browserEvents.unbind(this.boundEvents_[e]);this.boundEvents_=[],this.contents_=[],this.workspace_.getThemeManager().unsubscribe(this.HtmlDiv),t.utils.dom.removeNode(this.HtmlDiv)},t.Css.register([".blocklyToolboxDelete {",'cursor: url("<<<PATH>>>/handdelete.cur"), auto;',"}",".blocklyToolboxGrab {",'cursor: url("<<<PATH>>>/handclosed.cur"), auto;',"cursor: grabbing;","cursor: -webkit-grabbing;","}",".blocklyToolboxDiv {","background-color: #ddd;","overflow-x: visible;","overflow-y: auto;","padding: 4px 0 4px 0;","position: absolute;","z-index: 70;","-webkit-tap-highlight-color: transparent;","}",".blocklyToolboxContents {","display: flex;","flex-wrap: wrap;","flex-direction: column;","}",".blocklyToolboxContents:focus {","outline: none;","}"]),t.registry.register(t.registry.Type.TOOLBOX,t.registry.DEFAULT,t.Toolbox),t.Events.TrashcanOpen=function(e,i){t.Events.TrashcanOpen.superClass_.constructor.call(this,i),this.isOpen=e},t.utils.object.inherits(t.Events.TrashcanOpen,t.Events.UiBase),t.Events.TrashcanOpen.prototype.type=t.Events.TRASHCAN_OPEN,t.Events.TrashcanOpen.prototype.toJson=function(){var e=t.Events.TrashcanOpen.superClass_.toJson.call(this);return e.isOpen=this.isOpen,e},t.Events.TrashcanOpen.prototype.fromJson=function(e){t.Events.TrashcanOpen.superClass_.fromJson.call(this,e),this.isOpen=e.isOpen},t.registry.register(t.registry.Type.EVENT,t.Events.TRASHCAN_OPEN,t.Events.TrashcanOpen),t.IPlugin=function(){},t.IPositionable=function(){},t.Trashcan=function(e){this.workspace_=e,this.contents_=[],this.flyout=null,0>=this.workspace_.options.maxTrashcanContents||(e=new t.Options({scrollbars:!0,parentWorkspace:this.workspace_,rtl:this.workspace_.RTL,oneBasedIndex:this.workspace_.options.oneBasedIndex,renderer:this.workspace_.options.renderer,rendererOverrides:this.workspace_.options.rendererOverrides,move:{scrollbars:!0}}),this.workspace_.horizontalLayout?(e.toolboxPosition=this.workspace_.toolboxPosition==t.utils.toolbox.Position.TOP?t.utils.toolbox.Position.BOTTOM:t.utils.toolbox.Position.TOP,this.flyout=new(t.registry.getClassFromOptions(t.registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,this.workspace_.options,!0))(e)):(e.toolboxPosition=this.workspace_.toolboxPosition==t.utils.toolbox.Position.RIGHT?t.utils.toolbox.Position.LEFT:t.utils.toolbox.Position.RIGHT,this.flyout=new(t.registry.getClassFromOptions(t.registry.Type.FLYOUTS_VERTICAL_TOOLBOX,this.workspace_.options,!0))(e)),this.workspace_.addChangeListener(this.onDelete_.bind(this)))},t.Trashcan.prototype.WIDTH_=47,t.Trashcan.prototype.BODY_HEIGHT_=44,t.Trashcan.prototype.LID_HEIGHT_=16,t.Trashcan.prototype.MARGIN_BOTTOM_=20,t.Trashcan.prototype.MARGIN_SIDE_=20,t.Trashcan.prototype.MARGIN_HOTSPOT_=10,t.Trashcan.prototype.SPRITE_LEFT_=0,t.Trashcan.prototype.SPRITE_TOP_=32,t.Trashcan.prototype.HAS_BLOCKS_LID_ANGLE_=.1,t.Trashcan.ANIMATION_LENGTH_=80,t.Trashcan.ANIMATION_FRAMES_=4,t.Trashcan.OPACITY_MIN_=.4,t.Trashcan.OPACITY_MAX_=.8,t.Trashcan.MAX_LID_ANGLE_=45,t.Trashcan.prototype.isLidOpen=!1,t.Trashcan.prototype.minOpenness_=0,t.Trashcan.prototype.svgGroup_=null,t.Trashcan.prototype.svgLid_=null,t.Trashcan.prototype.lidTask_=0,t.Trashcan.prototype.lidOpen_=0,t.Trashcan.prototype.left_=0,t.Trashcan.prototype.top_=0,t.Trashcan.prototype.createDom=function(){this.svgGroup_=t.utils.dom.createSvgElement(t.utils.Svg.G,{class:"blocklyTrash"},null);var e=String(Math.random()).substring(2),i=t.utils.dom.createSvgElement(t.utils.Svg.CLIPPATH,{id:"blocklyTrashBodyClipPath"+e},this.svgGroup_);t.utils.dom.createSvgElement(t.utils.Svg.RECT,{width:this.WIDTH_,height:this.BODY_HEIGHT_,y:this.LID_HEIGHT_},i);var s=t.utils.dom.createSvgElement(t.utils.Svg.IMAGE,{width:t.SPRITE.width,x:-this.SPRITE_LEFT_,height:t.SPRITE.height,y:-this.SPRITE_TOP_,"clip-path":"url(#blocklyTrashBodyClipPath"+e+")"},this.svgGroup_);return s.setAttributeNS(t.utils.dom.XLINK_NS,"xlink:href",this.workspace_.options.pathToMedia+t.SPRITE.url),i=t.utils.dom.createSvgElement(t.utils.Svg.CLIPPATH,{id:"blocklyTrashLidClipPath"+e},this.svgGroup_),t.utils.dom.createSvgElement(t.utils.Svg.RECT,{width:this.WIDTH_,height:this.LID_HEIGHT_},i),this.svgLid_=t.utils.dom.createSvgElement(t.utils.Svg.IMAGE,{width:t.SPRITE.width,x:-this.SPRITE_LEFT_,height:t.SPRITE.height,y:-this.SPRITE_TOP_,"clip-path":"url(#blocklyTrashLidClipPath"+e+")"},this.svgGroup_),this.svgLid_.setAttributeNS(t.utils.dom.XLINK_NS,"xlink:href",this.workspace_.options.pathToMedia+t.SPRITE.url),t.browserEvents.bind(this.svgGroup_,"mousedown",this,this.blockMouseDownWhenOpenable_),t.browserEvents.bind(this.svgGroup_,"mouseup",this,this.click),t.browserEvents.bind(s,"mouseover",this,this.mouseOver_),t.browserEvents.bind(s,"mouseout",this,this.mouseOut_),this.animateLid_(),this.svgGroup_},t.Trashcan.prototype.init=function(e){return 0<this.workspace_.options.maxTrashcanContents&&(t.utils.dom.insertAfter(this.flyout.createDom(t.utils.Svg.SVG),this.workspace_.getParentSvg()),this.flyout.init(this.workspace_)),this.verticalSpacing_=this.MARGIN_BOTTOM_+e,this.setLidOpen(!1),this.verticalSpacing_+this.BODY_HEIGHT_+this.LID_HEIGHT_},t.Trashcan.prototype.dispose=function(){this.svgGroup_&&(t.utils.dom.removeNode(this.svgGroup_),this.svgGroup_=null),this.workspace_=this.svgLid_=null,clearTimeout(this.lidTask_)},t.Trashcan.prototype.hasContents_=function(){return!!this.contents_.length},t.Trashcan.prototype.contentsIsOpen=function(){return this.flyout.isVisible()},t.Trashcan.prototype.openFlyout=function(){if(!this.contentsIsOpen()){for(var e=[],i=0,s;s=this.contents_[i];i++)e[i]=t.Xml.textToDom(s);this.flyout.show(e),this.fireUiEvent_(!0)}},t.Trashcan.prototype.closeFlyout=function(){this.contentsIsOpen()&&(this.flyout.hide(),this.fireUiEvent_(!1))},t.Trashcan.prototype.emptyContents=function(){this.hasContents_()&&(this.contents_.length=0,this.setMinOpenness_(0),this.closeFlyout())},t.Trashcan.prototype.position=function(e,i){if(this.verticalSpacing_){this.left_=e.toolboxMetrics.position==t.utils.toolbox.Position.LEFT||this.workspace_.horizontalLayout&&!this.workspace_.RTL?e.viewMetrics.width+e.absoluteMetrics.left-this.WIDTH_-this.MARGIN_SIDE_-t.Scrollbar.scrollbarThickness:this.MARGIN_SIDE_+t.Scrollbar.scrollbarThickness;var s=this.BODY_HEIGHT_+this.LID_HEIGHT_,r=this.top_=e.absoluteMetrics.top+this.verticalSpacing_,o=e.absoluteMetrics.top+e.viewMetrics.height-s-this.verticalSpacing_;this.top_=(e=e.toolboxMetrics.position!==t.utils.toolbox.Position.BOTTOM)?o:r;for(var h=this.getBoundingRectangle(),u=0,p;p=i[u];u++)h.intersects(p)&&(this.top_=e?p.top-s-this.MARGIN_BOTTOM_:p.bottom+this.MARGIN_BOTTOM_,h=this.getBoundingRectangle(),u=-1);this.top_=t.utils.math.clamp(r,this.top_,o),this.svgGroup_.setAttribute("transform","translate("+this.left_+","+this.top_+")")}},t.Trashcan.prototype.getBoundingRectangle=function(){return new t.utils.Rect(this.top_,this.top_+this.BODY_HEIGHT_+this.LID_HEIGHT_,this.left_,this.left_+this.WIDTH_)},t.Trashcan.prototype.getClientRect=function(){if(!this.svgGroup_)return null;var e=this.svgGroup_.getBoundingClientRect(),i=e.top+this.SPRITE_TOP_-this.MARGIN_HOTSPOT_;return e=e.left+this.SPRITE_LEFT_-this.MARGIN_HOTSPOT_,new t.utils.Rect(i,i+this.LID_HEIGHT_+this.BODY_HEIGHT_+2*this.MARGIN_HOTSPOT_,e,e+this.WIDTH_+2*this.MARGIN_HOTSPOT_)},t.Trashcan.prototype.setLidOpen=function(e){this.isLidOpen!=e&&(clearTimeout(this.lidTask_),this.isLidOpen=e,this.animateLid_())},t.Trashcan.prototype.animateLid_=function(){var e=t.Trashcan.ANIMATION_FRAMES_,i=1/(e+1);this.lidOpen_+=this.isLidOpen?i:-i,this.lidOpen_=Math.min(Math.max(this.lidOpen_,this.minOpenness_),1),this.setLidAngle_(this.lidOpen_*t.Trashcan.MAX_LID_ANGLE_),i=t.Trashcan.OPACITY_MIN_,this.svgGroup_.style.opacity=i+this.lidOpen_*(t.Trashcan.OPACITY_MAX_-i),this.lidOpen_>this.minOpenness_&&1>this.lidOpen_&&(this.lidTask_=setTimeout(this.animateLid_.bind(this),t.Trashcan.ANIMATION_LENGTH_/e))},t.Trashcan.prototype.setLidAngle_=function(e){var i=this.workspace_.toolboxPosition==t.utils.toolbox.Position.RIGHT||this.workspace_.horizontalLayout&&this.workspace_.RTL;this.svgLid_.setAttribute("transform","rotate("+(i?-e:e)+","+(i?4:this.WIDTH_-4)+","+(this.LID_HEIGHT_-2)+")")},t.Trashcan.prototype.setMinOpenness_=function(e){this.minOpenness_=e,this.isLidOpen||this.setLidAngle_(e*t.Trashcan.MAX_LID_ANGLE_)},t.Trashcan.prototype.closeLid=function(){this.setLidOpen(!1)},t.Trashcan.prototype.click=function(){this.hasContents_()&&this.openFlyout()},t.Trashcan.prototype.fireUiEvent_=function(e){e=new(t.Events.get(t.Events.TRASHCAN_OPEN))(e,this.workspace_.id),t.Events.fire(e)},t.Trashcan.prototype.blockMouseDownWhenOpenable_=function(e){!this.contentsIsOpen()&&this.hasContents_()&&e.stopPropagation()},t.Trashcan.prototype.mouseOver_=function(){this.hasContents_()&&this.setLidOpen(!0)},t.Trashcan.prototype.mouseOut_=function(){this.setLidOpen(!1)},t.Trashcan.prototype.onDelete_=function(e){if(!(0>=this.workspace_.options.maxTrashcanContents)&&e.type==t.Events.BLOCK_DELETE&&e.oldXml.tagName&&e.oldXml.tagName.toLowerCase()!="shadow"&&(e=this.cleanBlockXML_(e.oldXml),this.contents_.indexOf(e)==-1)){for(this.contents_.unshift(e);this.contents_.length>this.workspace_.options.maxTrashcanContents;)this.contents_.pop();this.setMinOpenness_(this.HAS_BLOCKS_LID_ANGLE_)}},t.Trashcan.prototype.cleanBlockXML_=function(e){for(var i=e=e.cloneNode(!0);i;){i.removeAttribute&&(i.removeAttribute("x"),i.removeAttribute("y"),i.removeAttribute("id"),i.removeAttribute("disabled"),i.nodeName=="comment"&&(i.removeAttribute("h"),i.removeAttribute("w"),i.removeAttribute("pinned")));var s=i.firstChild||i.nextSibling;if(!s)for(s=i.parentNode;s;){if(s.nextSibling){s=s.nextSibling;break}s=s.parentNode}i=s}return t.Xml.domToText(e)},t.VariablesDynamic={},t.VariablesDynamic.onCreateVariableButtonClick_String=function(e){t.Variables.createVariableButtonHandler(e.getTargetWorkspace(),void 0,"String")},t.VariablesDynamic.onCreateVariableButtonClick_Number=function(e){t.Variables.createVariableButtonHandler(e.getTargetWorkspace(),void 0,"Number")},t.VariablesDynamic.onCreateVariableButtonClick_Colour=function(e){t.Variables.createVariableButtonHandler(e.getTargetWorkspace(),void 0,"Colour")},t.VariablesDynamic.flyoutCategory=function(e){var i=[],s=document.createElement("button");return s.setAttribute("text",t.Msg.NEW_STRING_VARIABLE),s.setAttribute("callbackKey","CREATE_VARIABLE_STRING"),i.push(s),s=document.createElement("button"),s.setAttribute("text",t.Msg.NEW_NUMBER_VARIABLE),s.setAttribute("callbackKey","CREATE_VARIABLE_NUMBER"),i.push(s),s=document.createElement("button"),s.setAttribute("text",t.Msg.NEW_COLOUR_VARIABLE),s.setAttribute("callbackKey","CREATE_VARIABLE_COLOUR"),i.push(s),e.registerButtonCallback("CREATE_VARIABLE_STRING",t.VariablesDynamic.onCreateVariableButtonClick_String),e.registerButtonCallback("CREATE_VARIABLE_NUMBER",t.VariablesDynamic.onCreateVariableButtonClick_Number),e.registerButtonCallback("CREATE_VARIABLE_COLOUR",t.VariablesDynamic.onCreateVariableButtonClick_Colour),e=t.VariablesDynamic.flyoutCategoryBlocks(e),i=i.concat(e)},t.VariablesDynamic.flyoutCategoryBlocks=function(e){e=e.getAllVariables();var i=[];if(0<e.length){if(t.Blocks.variables_set_dynamic){var s=e[e.length-1],r=t.utils.xml.createElement("block");r.setAttribute("type","variables_set_dynamic"),r.setAttribute("gap",24),r.appendChild(t.Variables.generateVariableFieldDom(s)),i.push(r)}if(t.Blocks.variables_get_dynamic){e.sort(t.VariableModel.compareByName),s=0;for(var o;o=e[s];s++)r=t.utils.xml.createElement("block"),r.setAttribute("type","variables_get_dynamic"),r.setAttribute("gap",8),r.appendChild(t.Variables.generateVariableFieldDom(o)),i.push(r)}}return i},t.ZoomControls=function(e){this.workspace_=e,this.zoomResetGroup_=this.zoomOutGroup_=this.zoomInGroup_=this.verticalSpacing_=this.onZoomOutWrapper_=this.onZoomInWrapper_=this.onZoomResetWrapper_=null},t.ZoomControls.prototype.WIDTH_=32,t.ZoomControls.prototype.HEIGHT_=110,t.ZoomControls.prototype.MARGIN_BOTTOM_=20,t.ZoomControls.prototype.MARGIN_SIDE_=20,t.ZoomControls.prototype.svgGroup_=null,t.ZoomControls.prototype.left_=0,t.ZoomControls.prototype.top_=0,t.ZoomControls.prototype.createDom=function(){this.svgGroup_=t.utils.dom.createSvgElement(t.utils.Svg.G,{},null);var e=String(Math.random()).substring(2);return this.createZoomOutSvg_(e),this.createZoomInSvg_(e),this.workspace_.isMovable()&&this.createZoomResetSvg_(e),this.svgGroup_},t.ZoomControls.prototype.init=function(e){return this.verticalSpacing_=this.MARGIN_BOTTOM_+e,this.verticalSpacing_+this.HEIGHT_},t.ZoomControls.prototype.dispose=function(){this.svgGroup_&&t.utils.dom.removeNode(this.svgGroup_),this.onZoomResetWrapper_&&t.browserEvents.unbind(this.onZoomResetWrapper_),this.onZoomInWrapper_&&t.browserEvents.unbind(this.onZoomInWrapper_),this.onZoomOutWrapper_&&t.browserEvents.unbind(this.onZoomOutWrapper_)},t.ZoomControls.prototype.getBoundingRectangle=function(){return new t.utils.Rect(this.top_,this.top_+this.HEIGHT_,this.left_,this.left_+this.WIDTH_)},t.ZoomControls.prototype.position=function(e,i){if(this.verticalSpacing_){this.left_=e.toolboxMetrics.position==t.utils.toolbox.Position.LEFT||this.workspace_.horizontalLayout&&!this.workspace_.RTL?e.viewMetrics.width+e.absoluteMetrics.left-this.WIDTH_-this.MARGIN_SIDE_-t.Scrollbar.scrollbarThickness:this.MARGIN_SIDE_+t.Scrollbar.scrollbarThickness;var s=this.top_=e.absoluteMetrics.top+this.verticalSpacing_,r=e.absoluteMetrics.top+e.viewMetrics.height-this.HEIGHT_-this.verticalSpacing_;this.top_=(e=e.toolboxMetrics.position!==t.utils.toolbox.Position.BOTTOM)?r:s,e?(this.zoomInGroup_.setAttribute("transform","translate(0, 43)"),this.zoomOutGroup_.setAttribute("transform","translate(0, 77)")):(this.zoomInGroup_.setAttribute("transform","translate(0, 34)"),this.zoomResetGroup_&&this.zoomResetGroup_.setAttribute("transform","translate(0, 77)"));for(var o=this.getBoundingRectangle(),h=0,u;u=i[h];h++)o.intersects(u)&&(this.top_=e?u.top-this.HEIGHT_-this.MARGIN_BOTTOM_:u.bottom+this.MARGIN_BOTTOM_,o=this.getBoundingRectangle(),h=-1);this.top_=t.utils.math.clamp(s,this.top_,r),this.svgGroup_.setAttribute("transform","translate("+this.left_+","+this.top_+")")}},t.ZoomControls.prototype.createZoomOutSvg_=function(e){this.zoomOutGroup_=t.utils.dom.createSvgElement(t.utils.Svg.G,{class:"blocklyZoom"},this.svgGroup_);var i=t.utils.dom.createSvgElement(t.utils.Svg.CLIPPATH,{id:"blocklyZoomoutClipPath"+e},this.zoomOutGroup_);t.utils.dom.createSvgElement(t.utils.Svg.RECT,{width:32,height:32},i),t.utils.dom.createSvgElement(t.utils.Svg.IMAGE,{width:t.SPRITE.width,height:t.SPRITE.height,x:-64,y:-92,"clip-path":"url(#blocklyZoomoutClipPath"+e+")"},this.zoomOutGroup_).setAttributeNS(t.utils.dom.XLINK_NS,"xlink:href",this.workspace_.options.pathToMedia+t.SPRITE.url),this.onZoomOutWrapper_=t.browserEvents.conditionalBind(this.zoomOutGroup_,"mousedown",null,this.zoom_.bind(this,-1))},t.ZoomControls.prototype.createZoomInSvg_=function(e){this.zoomInGroup_=t.utils.dom.createSvgElement(t.utils.Svg.G,{class:"blocklyZoom"},this.svgGroup_);var i=t.utils.dom.createSvgElement(t.utils.Svg.CLIPPATH,{id:"blocklyZoominClipPath"+e},this.zoomInGroup_);t.utils.dom.createSvgElement(t.utils.Svg.RECT,{width:32,height:32},i),t.utils.dom.createSvgElement(t.utils.Svg.IMAGE,{width:t.SPRITE.width,height:t.SPRITE.height,x:-32,y:-92,"clip-path":"url(#blocklyZoominClipPath"+e+")"},this.zoomInGroup_).setAttributeNS(t.utils.dom.XLINK_NS,"xlink:href",this.workspace_.options.pathToMedia+t.SPRITE.url),this.onZoomInWrapper_=t.browserEvents.conditionalBind(this.zoomInGroup_,"mousedown",null,this.zoom_.bind(this,1))},t.ZoomControls.prototype.zoom_=function(e,i){this.workspace_.markFocused(),this.workspace_.zoomCenter(e),this.fireZoomEvent_(),t.Touch.clearTouchIdentifier(),i.stopPropagation(),i.preventDefault()},t.ZoomControls.prototype.createZoomResetSvg_=function(e){this.zoomResetGroup_=t.utils.dom.createSvgElement(t.utils.Svg.G,{class:"blocklyZoom"},this.svgGroup_);var i=t.utils.dom.createSvgElement(t.utils.Svg.CLIPPATH,{id:"blocklyZoomresetClipPath"+e},this.zoomResetGroup_);t.utils.dom.createSvgElement(t.utils.Svg.RECT,{width:32,height:32},i),t.utils.dom.createSvgElement(t.utils.Svg.IMAGE,{width:t.SPRITE.width,height:t.SPRITE.height,y:-92,"clip-path":"url(#blocklyZoomresetClipPath"+e+")"},this.zoomResetGroup_).setAttributeNS(t.utils.dom.XLINK_NS,"xlink:href",this.workspace_.options.pathToMedia+t.SPRITE.url),this.onZoomResetWrapper_=t.browserEvents.conditionalBind(this.zoomResetGroup_,"mousedown",null,this.resetZoom_.bind(this))},t.ZoomControls.prototype.resetZoom_=function(e){this.workspace_.markFocused();var i=Math.log(this.workspace_.options.zoomOptions.startScale/this.workspace_.scale)/Math.log(this.workspace_.options.zoomOptions.scaleSpeed);this.workspace_.beginCanvasTransition(),this.workspace_.zoomCenter(i),this.workspace_.scrollCenter(),setTimeout(this.workspace_.endCanvasTransition.bind(this.workspace_),500),this.fireZoomEvent_(),t.Touch.clearTouchIdentifier(),e.stopPropagation(),e.preventDefault()},t.ZoomControls.prototype.fireZoomEvent_=function(){var e=new(t.Events.get(t.Events.CLICK))(null,this.workspace_.id,"zoom_controls");t.Events.fire(e)},t.Css.register([".blocklyZoom>image, .blocklyZoom>svg>image {","opacity: .4;","}",".blocklyZoom>image:hover, .blocklyZoom>svg>image:hover {","opacity: .6;","}",".blocklyZoom>image:active, .blocklyZoom>svg>image:active {","opacity: .8;","}"]),t.ShortcutItems={},t.ShortcutItems.names={ESCAPE:"escape",DELETE:"delete",COPY:"copy",CUT:"cut",PASTE:"paste",UNDO:"undo",REDO:"redo"},t.ShortcutItems.registerEscape=function(){var e={name:t.ShortcutItems.names.ESCAPE,preconditionFn:function(i){return!i.options.readOnly},callback:function(){return t.hideChaff(),!0}};t.ShortcutRegistry.registry.register(e),t.ShortcutRegistry.registry.addKeyMapping(t.utils.KeyCodes.ESC,e.name)},t.ShortcutItems.registerDelete=function(){var e={name:t.ShortcutItems.names.DELETE,preconditionFn:function(i){return!i.options.readOnly&&t.selected&&t.selected.isDeletable()},callback:function(i,s){return s.preventDefault(),t.Gesture.inProgress()?!1:(t.deleteBlock(t.selected),!0)}};t.ShortcutRegistry.registry.register(e),t.ShortcutRegistry.registry.addKeyMapping(t.utils.KeyCodes.DELETE,e.name),t.ShortcutRegistry.registry.addKeyMapping(t.utils.KeyCodes.BACKSPACE,e.name)},t.ShortcutItems.registerCopy=function(){var e={name:t.ShortcutItems.names.COPY,preconditionFn:function(s){return!s.options.readOnly&&!t.Gesture.inProgress()&&t.selected&&t.selected.isDeletable()&&t.selected.isMovable()},callback:function(){return t.hideChaff(),t.copy(t.selected),!0}};t.ShortcutRegistry.registry.register(e);var i=t.ShortcutRegistry.registry.createSerializedKey(t.utils.KeyCodes.C,[t.utils.KeyCodes.CTRL]);t.ShortcutRegistry.registry.addKeyMapping(i,e.name),i=t.ShortcutRegistry.registry.createSerializedKey(t.utils.KeyCodes.C,[t.utils.KeyCodes.ALT]),t.ShortcutRegistry.registry.addKeyMapping(i,e.name),i=t.ShortcutRegistry.registry.createSerializedKey(t.utils.KeyCodes.C,[t.utils.KeyCodes.META]),t.ShortcutRegistry.registry.addKeyMapping(i,e.name)},t.ShortcutItems.registerCut=function(){var e={name:t.ShortcutItems.names.CUT,preconditionFn:function(s){return!s.options.readOnly&&!t.Gesture.inProgress()&&t.selected&&t.selected.isDeletable()&&t.selected.isMovable()&&!t.selected.workspace.isFlyout},callback:function(){return t.copy(t.selected),t.deleteBlock(t.selected),!0}};t.ShortcutRegistry.registry.register(e);var i=t.ShortcutRegistry.registry.createSerializedKey(t.utils.KeyCodes.X,[t.utils.KeyCodes.CTRL]);t.ShortcutRegistry.registry.addKeyMapping(i,e.name),i=t.ShortcutRegistry.registry.createSerializedKey(t.utils.KeyCodes.X,[t.utils.KeyCodes.ALT]),t.ShortcutRegistry.registry.addKeyMapping(i,e.name),i=t.ShortcutRegistry.registry.createSerializedKey(t.utils.KeyCodes.X,[t.utils.KeyCodes.META]),t.ShortcutRegistry.registry.addKeyMapping(i,e.name)},t.ShortcutItems.registerPaste=function(){var e={name:t.ShortcutItems.names.PASTE,preconditionFn:function(s){return!s.options.readOnly&&!t.Gesture.inProgress()},callback:function(){return t.paste()}};t.ShortcutRegistry.registry.register(e);var i=t.ShortcutRegistry.registry.createSerializedKey(t.utils.KeyCodes.V,[t.utils.KeyCodes.CTRL]);t.ShortcutRegistry.registry.addKeyMapping(i,e.name),i=t.ShortcutRegistry.registry.createSerializedKey(t.utils.KeyCodes.V,[t.utils.KeyCodes.ALT]),t.ShortcutRegistry.registry.addKeyMapping(i,e.name),i=t.ShortcutRegistry.registry.createSerializedKey(t.utils.KeyCodes.V,[t.utils.KeyCodes.META]),t.ShortcutRegistry.registry.addKeyMapping(i,e.name)},t.ShortcutItems.registerUndo=function(){var e={name:t.ShortcutItems.names.UNDO,preconditionFn:function(s){return!s.options.readOnly&&!t.Gesture.inProgress()},callback:function(s){return t.hideChaff(),s.undo(!1),!0}};t.ShortcutRegistry.registry.register(e);var i=t.ShortcutRegistry.registry.createSerializedKey(t.utils.KeyCodes.Z,[t.utils.KeyCodes.CTRL]);t.ShortcutRegistry.registry.addKeyMapping(i,e.name),i=t.ShortcutRegistry.registry.createSerializedKey(t.utils.KeyCodes.Z,[t.utils.KeyCodes.ALT]),t.ShortcutRegistry.registry.addKeyMapping(i,e.name),i=t.ShortcutRegistry.registry.createSerializedKey(t.utils.KeyCodes.Z,[t.utils.KeyCodes.META]),t.ShortcutRegistry.registry.addKeyMapping(i,e.name)},t.ShortcutItems.registerRedo=function(){var e={name:t.ShortcutItems.names.REDO,preconditionFn:function(s){return!t.Gesture.inProgress()&&!s.options.readOnly},callback:function(s){return t.hideChaff(),s.undo(!0),!0}};t.ShortcutRegistry.registry.register(e);var i=t.ShortcutRegistry.registry.createSerializedKey(t.utils.KeyCodes.Z,[t.utils.KeyCodes.SHIFT,t.utils.KeyCodes.CTRL]);t.ShortcutRegistry.registry.addKeyMapping(i,e.name),i=t.ShortcutRegistry.registry.createSerializedKey(t.utils.KeyCodes.Z,[t.utils.KeyCodes.SHIFT,t.utils.KeyCodes.ALT]),t.ShortcutRegistry.registry.addKeyMapping(i,e.name),i=t.ShortcutRegistry.registry.createSerializedKey(t.utils.KeyCodes.Z,[t.utils.KeyCodes.SHIFT,t.utils.KeyCodes.META]),t.ShortcutRegistry.registry.addKeyMapping(i,e.name),i=t.ShortcutRegistry.registry.createSerializedKey(t.utils.KeyCodes.Y,[t.utils.KeyCodes.CTRL]),t.ShortcutRegistry.registry.addKeyMapping(i,e.name)},t.ShortcutItems.registerDefaultShortcuts=function(){t.ShortcutItems.registerEscape(),t.ShortcutItems.registerDelete(),t.ShortcutItems.registerCopy(),t.ShortcutItems.registerCut(),t.ShortcutItems.registerPaste(),t.ShortcutItems.registerUndo(),t.ShortcutItems.registerRedo()},t.ShortcutItems.registerDefaultShortcuts(),t.ContextMenuItems={},t.ContextMenuItems.registerUndo=function(){t.ContextMenuRegistry.registry.register({displayText:function(){return t.Msg.UNDO},preconditionFn:function(e){return 0<e.workspace.getUndoStack().length?"enabled":"disabled"},callback:function(e){e.workspace.undo(!1)},scopeType:t.ContextMenuRegistry.ScopeType.WORKSPACE,id:"undoWorkspace",weight:1})},t.ContextMenuItems.registerRedo=function(){t.ContextMenuRegistry.registry.register({displayText:function(){return t.Msg.REDO},preconditionFn:function(e){return 0<e.workspace.getRedoStack().length?"enabled":"disabled"},callback:function(e){e.workspace.undo(!0)},scopeType:t.ContextMenuRegistry.ScopeType.WORKSPACE,id:"redoWorkspace",weight:2})},t.ContextMenuItems.registerCleanup=function(){t.ContextMenuRegistry.registry.register({displayText:function(){return t.Msg.CLEAN_UP},preconditionFn:function(e){return e.workspace.isMovable()?1<e.workspace.getTopBlocks(!1).length?"enabled":"disabled":"hidden"},callback:function(e){e.workspace.cleanUp()},scopeType:t.ContextMenuRegistry.ScopeType.WORKSPACE,id:"cleanWorkspace",weight:3})},t.ContextMenuItems.toggleOption_=function(e,i){for(var s=0,r=0;r<i.length;r++)for(var o=i[r];o;)setTimeout(o.setCollapsed.bind(o,e),s),o=o.getNextBlock(),s+=10},t.ContextMenuItems.registerCollapse=function(){t.ContextMenuRegistry.registry.register({displayText:function(){return t.Msg.COLLAPSE_ALL},preconditionFn:function(e){if(e.workspace.options.collapse){e=e.workspace.getTopBlocks(!1);for(var i=0;i<e.length;i++)for(var s=e[i];s;){if(!s.isCollapsed())return"enabled";s=s.getNextBlock()}return"disabled"}return"hidden"},callback:function(e){t.ContextMenuItems.toggleOption_(!0,e.workspace.getTopBlocks(!0))},scopeType:t.ContextMenuRegistry.ScopeType.WORKSPACE,id:"collapseWorkspace",weight:4})},t.ContextMenuItems.registerExpand=function(){t.ContextMenuRegistry.registry.register({displayText:function(){return t.Msg.EXPAND_ALL},preconditionFn:function(e){if(e.workspace.options.collapse){e=e.workspace.getTopBlocks(!1);for(var i=0;i<e.length;i++)for(var s=e[i];s;){if(s.isCollapsed())return"enabled";s=s.getNextBlock()}return"disabled"}return"hidden"},callback:function(e){t.ContextMenuItems.toggleOption_(!1,e.workspace.getTopBlocks(!0))},scopeType:t.ContextMenuRegistry.ScopeType.WORKSPACE,id:"expandWorkspace",weight:5})},t.ContextMenuItems.addDeletableBlocks_=function(e,i){if(e.isDeletable())Array.prototype.push.apply(i,e.getDescendants(!1));else{e=e.getChildren(!1);for(var s=0;s<e.length;s++)t.ContextMenuItems.addDeletableBlocks_(e[s],i)}},t.ContextMenuItems.getDeletableBlocks_=function(e){var i=[];e=e.getTopBlocks(!0);for(var s=0;s<e.length;s++)t.ContextMenuItems.addDeletableBlocks_(e[s],i);return i},t.ContextMenuItems.deleteNext_=function(e,i){t.Events.setGroup(i);var s=e.shift();s&&(s.workspace?(s.dispose(!1,!0),setTimeout(t.ContextMenuItems.deleteNext_,10,e,i)):t.ContextMenuItems.deleteNext_(e,i)),t.Events.setGroup(!1)},t.ContextMenuItems.registerDeleteAll=function(){t.ContextMenuRegistry.registry.register({displayText:function(e){if(e.workspace)return e=t.ContextMenuItems.getDeletableBlocks_(e.workspace).length,e==1?t.Msg.DELETE_BLOCK:t.Msg.DELETE_X_BLOCKS.replace("%1",String(e))},preconditionFn:function(e){if(e.workspace)return 0<t.ContextMenuItems.getDeletableBlocks_(e.workspace).length?"enabled":"disabled"},callback:function(e){if(e.workspace){e.workspace.cancelCurrentGesture();var i=t.ContextMenuItems.getDeletableBlocks_(e.workspace),s=t.utils.genUid();2>i.length?t.ContextMenuItems.deleteNext_(i,s):t.confirm(t.Msg.DELETE_ALL_BLOCKS.replace("%1",i.length),function(r){r&&t.ContextMenuItems.deleteNext_(i,s)})}},scopeType:t.ContextMenuRegistry.ScopeType.WORKSPACE,id:"workspaceDelete",weight:6})},t.ContextMenuItems.registerWorkspaceOptions_=function(){t.ContextMenuItems.registerUndo(),t.ContextMenuItems.registerRedo(),t.ContextMenuItems.registerCleanup(),t.ContextMenuItems.registerCollapse(),t.ContextMenuItems.registerExpand(),t.ContextMenuItems.registerDeleteAll()},t.ContextMenuItems.registerDuplicate=function(){t.ContextMenuRegistry.registry.register({displayText:function(){return t.Msg.DUPLICATE_BLOCK},preconditionFn:function(e){return e=e.block,!e.isInFlyout&&e.isDeletable()&&e.isMovable()?e.isDuplicatable()?"enabled":"disabled":"hidden"},callback:function(e){e.block&&t.duplicate(e.block)},scopeType:t.ContextMenuRegistry.ScopeType.BLOCK,id:"blockDuplicate",weight:1})},t.ContextMenuItems.registerComment=function(){t.ContextMenuRegistry.registry.register({displayText:function(e){return e.block.getCommentIcon()?t.Msg.REMOVE_COMMENT:t.Msg.ADD_COMMENT},preconditionFn:function(e){return e=e.block,t.utils.userAgent.IE||e.isInFlyout||!e.workspace.options.comments||e.isCollapsed()||!e.isEditable()?"hidden":"enabled"},callback:function(e){e=e.block,e.getCommentIcon()?e.setCommentText(null):e.setCommentText("")},scopeType:t.ContextMenuRegistry.ScopeType.BLOCK,id:"blockComment",weight:2})},t.ContextMenuItems.registerInline=function(){t.ContextMenuRegistry.registry.register({displayText:function(e){return e.block.getInputsInline()?t.Msg.EXTERNAL_INPUTS:t.Msg.INLINE_INPUTS},preconditionFn:function(e){if(e=e.block,!e.isInFlyout&&e.isMovable()&&!e.isCollapsed()){for(var i=1;i<e.inputList.length;i++)if(e.inputList[i-1].type!=t.inputTypes.STATEMENT&&e.inputList[i].type!=t.inputTypes.STATEMENT)return"enabled"}return"hidden"},callback:function(e){e.block.setInputsInline(!e.block.getInputsInline())},scopeType:t.ContextMenuRegistry.ScopeType.BLOCK,id:"blockInline",weight:3})},t.ContextMenuItems.registerCollapseExpandBlock=function(){t.ContextMenuRegistry.registry.register({displayText:function(e){return e.block.isCollapsed()?t.Msg.EXPAND_BLOCK:t.Msg.COLLAPSE_BLOCK},preconditionFn:function(e){return e=e.block,!e.isInFlyout&&e.isMovable()?"enabled":"hidden"},callback:function(e){e.block.setCollapsed(!e.block.isCollapsed())},scopeType:t.ContextMenuRegistry.ScopeType.BLOCK,id:"blockCollapseExpand",weight:4})},t.ContextMenuItems.registerDisable=function(){t.ContextMenuRegistry.registry.register({displayText:function(e){return e.block.isEnabled()?t.Msg.DISABLE_BLOCK:t.Msg.ENABLE_BLOCK},preconditionFn:function(e){return e=e.block,!e.isInFlyout&&e.workspace.options.disable&&e.isEditable()?e.getInheritedDisabled()?"disabled":"enabled":"hidden"},callback:function(e){e=e.block;var i=t.Events.getGroup();i||t.Events.setGroup(!0),e.setEnabled(!e.isEnabled()),i||t.Events.setGroup(!1)},scopeType:t.ContextMenuRegistry.ScopeType.BLOCK,id:"blockDisable",weight:5})},t.ContextMenuItems.registerDelete=function(){t.ContextMenuRegistry.registry.register({displayText:function(e){var i=e.block;return e=i.getDescendants(!1).length,(i=i.getNextBlock())&&(e-=i.getDescendants(!1).length),e==1?t.Msg.DELETE_BLOCK:t.Msg.DELETE_X_BLOCKS.replace("%1",String(e))},preconditionFn:function(e){return!e.block.isInFlyout&&e.block.isDeletable()?"enabled":"hidden"},callback:function(e){t.Events.setGroup(!0),e.block.dispose(!0,!0),t.Events.setGroup(!1)},scopeType:t.ContextMenuRegistry.ScopeType.BLOCK,id:"blockDelete",weight:6})},t.ContextMenuItems.registerHelp=function(){t.ContextMenuRegistry.registry.register({displayText:function(){return t.Msg.HELP},preconditionFn:function(e){return e=e.block,(typeof e.helpUrl=="function"?e.helpUrl():e.helpUrl)?"enabled":"hidden"},callback:function(e){e.block.showHelp()},scopeType:t.ContextMenuRegistry.ScopeType.BLOCK,id:"blockHelp",weight:7})},t.ContextMenuItems.registerBlockOptions_=function(){t.ContextMenuItems.registerDuplicate(),t.ContextMenuItems.registerComment(),t.ContextMenuItems.registerInline(),t.ContextMenuItems.registerCollapseExpandBlock(),t.ContextMenuItems.registerDisable(),t.ContextMenuItems.registerDelete(),t.ContextMenuItems.registerHelp()},t.ContextMenuItems.registerDefaultOptions=function(){t.ContextMenuItems.registerWorkspaceOptions_(),t.ContextMenuItems.registerBlockOptions_()},t.ContextMenuItems.registerDefaultOptions(),t.Mutator=function(e){t.Mutator.superClass_.constructor.call(this,null),this.quarkNames_=e},t.utils.object.inherits(t.Mutator,t.Icon),t.Mutator.prototype.workspaceWidth_=0,t.Mutator.prototype.workspaceHeight_=0,t.Mutator.prototype.setBlock=function(e){this.block_=e},t.Mutator.prototype.getWorkspace=function(){return this.workspace_},t.Mutator.prototype.drawIcon_=function(e){t.utils.dom.createSvgElement(t.utils.Svg.RECT,{class:"blocklyIconShape",rx:"4",ry:"4",height:"16",width:"16"},e),t.utils.dom.createSvgElement(t.utils.Svg.PATH,{class:"blocklyIconSymbol",d:"m4.203,7.296 0,1.368 -0.92,0.677 -0.11,0.41 0.9,1.559 0.41,0.11 1.043,-0.457 1.187,0.683 0.127,1.134 0.3,0.3 1.8,0 0.3,-0.299 0.127,-1.138 1.185,-0.682 1.046,0.458 0.409,-0.11 0.9,-1.559 -0.11,-0.41 -0.92,-0.677 0,-1.366 0.92,-0.677 0.11,-0.41 -0.9,-1.559 -0.409,-0.109 -1.046,0.458 -1.185,-0.682 -0.127,-1.138 -0.3,-0.299 -1.8,0 -0.3,0.3 -0.126,1.135 -1.187,0.682 -1.043,-0.457 -0.41,0.11 -0.899,1.559 0.108,0.409z"},e),t.utils.dom.createSvgElement(t.utils.Svg.CIRCLE,{class:"blocklyIconShape",r:"2.7",cx:"8",cy:"8"},e)},t.Mutator.prototype.iconClick_=function(e){this.block_.isEditable()&&t.Icon.prototype.iconClick_.call(this,e)},t.Mutator.prototype.createEditor_=function(){if(this.svgDialog_=t.utils.dom.createSvgElement(t.utils.Svg.SVG,{x:t.Bubble.BORDER_WIDTH,y:t.Bubble.BORDER_WIDTH},null),this.quarkNames_.length)for(var e=t.utils.xml.createElement("xml"),i=0,s;s=this.quarkNames_[i];i++){var r=t.utils.xml.createElement("block");r.setAttribute("type",s),e.appendChild(r)}else e=null;return i=new t.Options({disable:!1,parentWorkspace:this.block_.workspace,media:this.block_.workspace.options.pathToMedia,rtl:this.block_.RTL,horizontalLayout:!1,renderer:this.block_.workspace.options.renderer,rendererOverrides:this.block_.workspace.options.rendererOverrides}),i.toolboxPosition=this.block_.RTL?t.utils.toolbox.Position.RIGHT:t.utils.toolbox.Position.LEFT,(s=!!e)&&(i.languageTree=t.utils.toolbox.convertToolboxDefToJson(e)),this.workspace_=new t.WorkspaceSvg(i),this.workspace_.isMutator=!0,this.workspace_.addChangeListener(t.Events.disableOrphans),e=s?this.workspace_.addFlyout(t.utils.Svg.G):null,i=this.workspace_.createDom("blocklyMutatorBackground"),e&&i.insertBefore(e,this.workspace_.svgBlockCanvas_),this.svgDialog_.appendChild(i),this.svgDialog_},t.Mutator.prototype.updateEditable=function(){t.Mutator.superClass_.updateEditable.call(this),this.block_.isInFlyout||(this.block_.isEditable()?this.iconGroup_&&t.utils.dom.removeClass(this.iconGroup_,"blocklyIconGroupReadonly"):(this.setVisible(!1),this.iconGroup_&&t.utils.dom.addClass(this.iconGroup_,"blocklyIconGroupReadonly")))},t.Mutator.prototype.resizeBubble_=function(){var e=2*t.Bubble.BORDER_WIDTH,i=this.workspace_.getCanvas().getBBox(),s=i.width+i.x,r=i.height+3*e,o=this.workspace_.getFlyout();if(o){var h=o.getWorkspace().getMetricsManager().getScrollMetrics();r=Math.max(r,h.height+20),s+=o.getWidth()}this.block_.RTL&&(s=-i.x),s+=3*e,(Math.abs(this.workspaceWidth_-s)>e||Math.abs(this.workspaceHeight_-r)>e)&&(this.workspaceWidth_=s,this.workspaceHeight_=r,this.bubble_.setBubbleSize(s+e,r+e),this.svgDialog_.setAttribute("width",this.workspaceWidth_),this.svgDialog_.setAttribute("height",this.workspaceHeight_),this.workspace_.setCachedParentSvgSize(this.workspaceWidth_,this.workspaceHeight_)),this.block_.RTL&&(e="translate("+this.workspaceWidth_+",0)",this.workspace_.getCanvas().setAttribute("transform",e)),this.workspace_.resize()},t.Mutator.prototype.onBubbleMove_=function(){this.workspace_&&this.workspace_.recordDeleteAreas()},t.Mutator.prototype.setVisible=function(e){if(e!=this.isVisible())if(t.Events.fire(new(t.Events.get(t.Events.BUBBLE_OPEN))(this.block_,e,"mutator")),e){this.bubble_=new t.Bubble(this.block_.workspace,this.createEditor_(),this.block_.pathObject.svgPath,this.iconXY_,null,null),this.bubble_.setSvgId(this.block_.id),this.bubble_.registerMoveEvent(this.onBubbleMove_.bind(this));var i=this.workspace_.options.languageTree;e=this.workspace_.getFlyout(),i&&(e.init(this.workspace_),e.show(i)),this.rootBlock_=this.block_.decompose(this.workspace_),i=this.rootBlock_.getDescendants(!1);for(var s=0,r;r=i[s];s++)r.render();if(this.rootBlock_.setMovable(!1),this.rootBlock_.setDeletable(!1),e?(i=2*e.CORNER_RADIUS,e=this.rootBlock_.RTL?e.getWidth()+i:i):e=i=16,this.block_.RTL&&(e=-e),this.rootBlock_.moveBy(e,i),this.block_.saveConnections){var o=this,h=this.block_;h.saveConnections(this.rootBlock_),this.sourceListener_=function(){h.saveConnections(o.rootBlock_)},this.block_.workspace.addChangeListener(this.sourceListener_)}this.resizeBubble_(),this.workspace_.addChangeListener(this.workspaceChanged_.bind(this)),this.applyColour()}else this.svgDialog_=null,this.workspace_.dispose(),this.rootBlock_=this.workspace_=null,this.bubble_.dispose(),this.bubble_=null,this.workspaceHeight_=this.workspaceWidth_=0,this.sourceListener_&&(this.block_.workspace.removeChangeListener(this.sourceListener_),this.sourceListener_=null)},t.Mutator.prototype.workspaceChanged_=function(e){if(!(e.isUiEvent||e.type==t.Events.CHANGE&&e.element=="disabled")){if(!this.workspace_.isDragging()){e=this.workspace_.getTopBlocks(!1);for(var i=0,s;s=e[i];i++){var r=s.getRelativeToSurfaceXY();if(20>r.y&&s.moveBy(0,20-r.y),s.RTL){var o=-20,h=this.workspace_.getFlyout();h&&(o-=h.getWidth()),r.x>o&&s.moveBy(o-r.x,0)}else 20>r.x&&s.moveBy(20-r.x,0)}}if(this.rootBlock_.workspace==this.workspace_){if(t.Events.setGroup(!0),s=this.block_,e=(e=s.mutationToDom())&&t.Xml.domToText(e),i=s.rendered,s.rendered=!1,s.compose(this.rootBlock_),s.rendered=i,s.initSvg(),s.rendered&&s.render(),i=(i=s.mutationToDom())&&t.Xml.domToText(i),e!=i){t.Events.fire(new(t.Events.get(t.Events.BLOCK_CHANGE))(s,"mutation",null,e,i));var u=t.Events.getGroup();setTimeout(function(){t.Events.setGroup(u),s.bumpNeighbours(),t.Events.setGroup(!1)},t.BUMP_DELAY)}this.workspace_.isDragging()||this.resizeBubble_(),t.Events.setGroup(!1)}}},t.Mutator.prototype.dispose=function(){this.block_.mutator=null,t.Icon.prototype.dispose.call(this)},t.Mutator.prototype.updateBlockStyle=function(){var e=this.workspace_;if(e&&e.getAllBlocks(!1)){for(var i=e.getAllBlocks(!1),s=0;s<i.length;s++){var r=i[s];r.setStyle(r.getStyleName())}if(s=e.getFlyout())for(e=s.workspace_.getAllBlocks(!1),s=0;s<e.length;s++)r=e[s],r.setStyle(r.getStyleName())}},t.Mutator.reconnect=function(e,i,s){if(!e||!e.getSourceBlock().workspace)return!1;s=i.getInput(s).connection;var r=e.targetBlock();return r&&r!=i||s.targetConnection==e?!1:(s.isConnected()&&s.disconnect(),s.connect(e),!0)},t.Mutator.findParentWs=function(e){var i=null;if(e&&e.options){var s=e.options.parentWorkspace;e.isFlyout?s&&s.options&&(i=s.options.parentWorkspace):s&&(i=s)}return i},t.FieldTextInput=function(e,i,s){this.spellcheck_=!0,t.FieldTextInput.superClass_.constructor.call(this,e,i,s),this.onKeyInputWrapper_=this.onKeyDownWrapper_=this.htmlInput_=null,this.fullBlockClickTarget_=!1,this.workspace_=null},t.utils.object.inherits(t.FieldTextInput,t.Field),t.FieldTextInput.prototype.DEFAULT_VALUE="",t.FieldTextInput.fromJson=function(e){var i=t.utils.replaceMessageReferences(e.text);return new t.FieldTextInput(i,void 0,e)},t.FieldTextInput.prototype.SERIALIZABLE=!0,t.FieldTextInput.BORDERRADIUS=4,t.FieldTextInput.prototype.CURSOR="text",t.FieldTextInput.prototype.configure_=function(e){t.FieldTextInput.superClass_.configure_.call(this,e),typeof e.spellcheck=="boolean"&&(this.spellcheck_=e.spellcheck)},t.FieldTextInput.prototype.initView=function(){if(this.getConstants().FULL_BLOCK_FIELDS){for(var e=0,i=0,s=0,r;r=this.sourceBlock_.inputList[s];s++){for(var o=0;r.fieldRow[o];o++)e++;r.connection&&i++}this.fullBlockClickTarget_=1>=e&&this.sourceBlock_.outputConnection&&!i}else this.fullBlockClickTarget_=!1;this.fullBlockClickTarget_?this.clickTarget_=this.sourceBlock_.getSvgRoot():this.createBorderRect_(),this.createTextElement_()},t.FieldTextInput.prototype.doClassValidation_=function(e){return e==null?null:String(e)},t.FieldTextInput.prototype.doValueInvalid_=function(e){this.isBeingEdited_&&(this.isTextValid_=!1,e=this.value_,this.value_=this.htmlInput_.untypedDefaultValue_,this.sourceBlock_&&t.Events.isEnabled()&&t.Events.fire(new(t.Events.get(t.Events.BLOCK_CHANGE))(this.sourceBlock_,"field",this.name||null,e,this.value_)))},t.FieldTextInput.prototype.doValueUpdate_=function(e){this.isTextValid_=!0,this.value_=e,this.isBeingEdited_||(this.isDirty_=!0)},t.FieldTextInput.prototype.applyColour=function(){this.sourceBlock_&&this.getConstants().FULL_BLOCK_FIELDS&&(this.borderRect_?this.borderRect_.setAttribute("stroke",this.sourceBlock_.style.colourTertiary):this.sourceBlock_.pathObject.svgPath.setAttribute("fill",this.getConstants().FIELD_BORDER_RECT_COLOUR))},t.FieldTextInput.prototype.render_=function(){if(t.FieldTextInput.superClass_.render_.call(this),this.isBeingEdited_){this.resizeEditor_();var e=this.htmlInput_;this.isTextValid_?(t.utils.dom.removeClass(e,"blocklyInvalidInput"),t.utils.aria.setState(e,t.utils.aria.State.INVALID,!1)):(t.utils.dom.addClass(e,"blocklyInvalidInput"),t.utils.aria.setState(e,t.utils.aria.State.INVALID,!0))}},t.FieldTextInput.prototype.setSpellcheck=function(e){e!=this.spellcheck_&&(this.spellcheck_=e,this.htmlInput_&&this.htmlInput_.setAttribute("spellcheck",this.spellcheck_))},t.FieldTextInput.prototype.showEditor_=function(e,i){this.workspace_=this.sourceBlock_.workspace,e=i||!1,!e&&(t.utils.userAgent.MOBILE||t.utils.userAgent.ANDROID||t.utils.userAgent.IPAD)?this.showPromptEditor_():this.showInlineEditor_(e)},t.FieldTextInput.prototype.showPromptEditor_=function(){t.prompt(t.Msg.CHANGE_VALUE_TITLE,this.getText(),(function(e){this.setValue(this.getValueFromEditorText_(e))}).bind(this))},t.FieldTextInput.prototype.showInlineEditor_=function(e){t.WidgetDiv.show(this,this.sourceBlock_.RTL,this.widgetDispose_.bind(this)),this.htmlInput_=this.widgetCreate_(),this.isBeingEdited_=!0,e||(this.htmlInput_.focus({preventScroll:!0}),this.htmlInput_.select())},t.FieldTextInput.prototype.widgetCreate_=function(){var e=t.WidgetDiv.DIV;t.utils.dom.addClass(this.getClickTarget_(),"editing");var i=document.createElement("input");i.className="blocklyHtmlInput",i.setAttribute("spellcheck",this.spellcheck_);var s=this.workspace_.getScale(),r=this.getConstants().FIELD_TEXT_FONTSIZE*s+"pt";if(e.style.fontSize=r,i.style.fontSize=r,r=t.FieldTextInput.BORDERRADIUS*s+"px",this.fullBlockClickTarget_){r=this.getScaledBBox(),r=(r.bottom-r.top)/2+"px";var o=this.sourceBlock_.getParent()?this.sourceBlock_.getParent().style.colourTertiary:this.sourceBlock_.style.colourTertiary;i.style.border=1*s+"px solid "+o,e.style.borderRadius=r,e.style.transition="box-shadow 0.25s ease 0s",this.getConstants().FIELD_TEXTINPUT_BOX_SHADOW&&(e.style.boxShadow="rgba(255, 255, 255, 0.3) 0px 0px 0px "+4*s+"px")}return i.style.borderRadius=r,e.appendChild(i),i.value=i.defaultValue=this.getEditorText_(this.value_),i.untypedDefaultValue_=this.value_,i.oldValue_=null,this.resizeEditor_(),this.bindInputEvents_(i),i},t.FieldTextInput.prototype.widgetDispose_=function(){this.isBeingEdited_=!1,this.isTextValid_=!0,this.forceRerender(),this.onFinishEditing_&&this.onFinishEditing_(this.value_),this.unbindInputEvents_();var e=t.WidgetDiv.DIV.style;e.width="auto",e.height="auto",e.fontSize="",e.transition="",e.boxShadow="",this.htmlInput_=null,t.utils.dom.removeClass(this.getClickTarget_(),"editing")},t.FieldTextInput.prototype.bindInputEvents_=function(e){this.onKeyDownWrapper_=t.browserEvents.conditionalBind(e,"keydown",this,this.onHtmlInputKeyDown_),this.onKeyInputWrapper_=t.browserEvents.conditionalBind(e,"input",this,this.onHtmlInputChange_)},t.FieldTextInput.prototype.unbindInputEvents_=function(){this.onKeyDownWrapper_&&(t.browserEvents.unbind(this.onKeyDownWrapper_),this.onKeyDownWrapper_=null),this.onKeyInputWrapper_&&(t.browserEvents.unbind(this.onKeyInputWrapper_),this.onKeyInputWrapper_=null)},t.FieldTextInput.prototype.onHtmlInputKeyDown_=function(e){e.keyCode==t.utils.KeyCodes.ENTER?(t.WidgetDiv.hide(),t.DropDownDiv.hideWithoutAnimation()):e.keyCode==t.utils.KeyCodes.ESC?(this.htmlInput_.value=this.htmlInput_.defaultValue,t.WidgetDiv.hide(),t.DropDownDiv.hideWithoutAnimation()):e.keyCode==t.utils.KeyCodes.TAB&&(t.WidgetDiv.hide(),t.DropDownDiv.hideWithoutAnimation(),this.sourceBlock_.tab(this,!e.shiftKey),e.preventDefault())},t.FieldTextInput.prototype.onHtmlInputChange_=function(e){e=this.htmlInput_.value,e!==this.htmlInput_.oldValue_&&(this.htmlInput_.oldValue_=e,t.Events.setGroup(!0),e=this.getValueFromEditorText_(e),this.setValue(e),this.forceRerender(),this.resizeEditor_(),t.Events.setGroup(!1))},t.FieldTextInput.prototype.setEditorValue_=function(e){this.isDirty_=!0,this.isBeingEdited_&&(this.htmlInput_.value=this.getEditorText_(e)),this.setValue(e)},t.FieldTextInput.prototype.resizeEditor_=function(){var e=t.WidgetDiv.DIV,i=this.getScaledBBox();e.style.width=i.right-i.left+"px",e.style.height=i.bottom-i.top+"px",i=new t.utils.Coordinate(this.sourceBlock_.RTL?i.right-e.offsetWidth:i.left,i.top),e.style.left=i.x+"px",e.style.top=i.y+"px"},t.FieldTextInput.prototype.isTabNavigable=function(){return!0},t.FieldTextInput.prototype.getText_=function(){return this.isBeingEdited_&&this.htmlInput_?this.htmlInput_.value:null},t.FieldTextInput.prototype.getEditorText_=function(e){return String(e)},t.FieldTextInput.prototype.getValueFromEditorText_=function(e){return e},t.fieldRegistry.register("field_input",t.FieldTextInput),t.FieldAngle=function(e,i,s){this.clockwise_=t.FieldAngle.CLOCKWISE,this.offset_=t.FieldAngle.OFFSET,this.wrap_=t.FieldAngle.WRAP,this.round_=t.FieldAngle.ROUND,t.FieldAngle.superClass_.constructor.call(this,e,i,s),this.moveSurfaceWrapper_=this.clickSurfaceWrapper_=this.clickWrapper_=this.line_=this.gauge_=null},t.utils.object.inherits(t.FieldAngle,t.FieldTextInput),t.FieldAngle.prototype.DEFAULT_VALUE=0,t.FieldAngle.fromJson=function(e){return new t.FieldAngle(e.angle,void 0,e)},t.FieldAngle.prototype.SERIALIZABLE=!0,t.FieldAngle.ROUND=15,t.FieldAngle.HALF=50,t.FieldAngle.CLOCKWISE=!1,t.FieldAngle.OFFSET=0,t.FieldAngle.WRAP=360,t.FieldAngle.RADIUS=t.FieldAngle.HALF-1,t.FieldAngle.prototype.configure_=function(e){switch(t.FieldAngle.superClass_.configure_.call(this,e),e.mode){case"compass":this.clockwise_=!0,this.offset_=90;break;case"protractor":this.clockwise_=!1,this.offset_=0}var i=e.clockwise;typeof i=="boolean"&&(this.clockwise_=i),i=e.offset,i!=null&&(i=Number(i),isNaN(i)||(this.offset_=i)),i=e.wrap,i!=null&&(i=Number(i),isNaN(i)||(this.wrap_=i)),e=e.round,e!=null&&(e=Number(e),isNaN(e)||(this.round_=e))},t.FieldAngle.prototype.initView=function(){t.FieldAngle.superClass_.initView.call(this),this.symbol_=t.utils.dom.createSvgElement(t.utils.Svg.TSPAN,{},null),this.symbol_.appendChild(document.createTextNode("")),this.textElement_.appendChild(this.symbol_)},t.FieldAngle.prototype.render_=function(){t.FieldAngle.superClass_.render_.call(this),this.updateGraph_()},t.FieldAngle.prototype.showEditor_=function(e){t.FieldAngle.superClass_.showEditor_.call(this,e,t.utils.userAgent.MOBILE||t.utils.userAgent.ANDROID||t.utils.userAgent.IPAD),e=this.dropdownCreate_(),t.DropDownDiv.getContentDiv().appendChild(e),t.DropDownDiv.setColour(this.sourceBlock_.style.colourPrimary,this.sourceBlock_.style.colourTertiary),t.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this)),this.updateGraph_()},t.FieldAngle.prototype.dropdownCreate_=function(){var e=t.utils.dom.createSvgElement(t.utils.Svg.SVG,{xmlns:t.utils.dom.SVG_NS,"xmlns:html":t.utils.dom.HTML_NS,"xmlns:xlink":t.utils.dom.XLINK_NS,version:"1.1",height:2*t.FieldAngle.HALF+"px",width:2*t.FieldAngle.HALF+"px",style:"touch-action: none"},null),i=t.utils.dom.createSvgElement(t.utils.Svg.CIRCLE,{cx:t.FieldAngle.HALF,cy:t.FieldAngle.HALF,r:t.FieldAngle.RADIUS,class:"blocklyAngleCircle"},e);this.gauge_=t.utils.dom.createSvgElement(t.utils.Svg.PATH,{class:"blocklyAngleGauge"},e),this.line_=t.utils.dom.createSvgElement(t.utils.Svg.LINE,{x1:t.FieldAngle.HALF,y1:t.FieldAngle.HALF,class:"blocklyAngleLine"},e);for(var s=0;360>s;s+=15)t.utils.dom.createSvgElement(t.utils.Svg.LINE,{x1:t.FieldAngle.HALF+t.FieldAngle.RADIUS,y1:t.FieldAngle.HALF,x2:t.FieldAngle.HALF+t.FieldAngle.RADIUS-(s%45==0?10:5),y2:t.FieldAngle.HALF,class:"blocklyAngleMarks",transform:"rotate("+s+","+t.FieldAngle.HALF+","+t.FieldAngle.HALF+")"},e);return this.clickWrapper_=t.browserEvents.conditionalBind(e,"click",this,this.hide_),this.clickSurfaceWrapper_=t.browserEvents.conditionalBind(i,"click",this,this.onMouseMove_,!0,!0),this.moveSurfaceWrapper_=t.browserEvents.conditionalBind(i,"mousemove",this,this.onMouseMove_,!0,!0),e},t.FieldAngle.prototype.dropdownDispose_=function(){this.clickWrapper_&&(t.browserEvents.unbind(this.clickWrapper_),this.clickWrapper_=null),this.clickSurfaceWrapper_&&(t.browserEvents.unbind(this.clickSurfaceWrapper_),this.clickSurfaceWrapper_=null),this.moveSurfaceWrapper_&&(t.browserEvents.unbind(this.moveSurfaceWrapper_),this.moveSurfaceWrapper_=null),this.line_=this.gauge_=null},t.FieldAngle.prototype.hide_=function(){t.DropDownDiv.hideIfOwner(this),t.WidgetDiv.hide()},t.FieldAngle.prototype.onMouseMove_=function(e){var i=this.gauge_.ownerSVGElement.getBoundingClientRect(),s=e.clientX-i.left-t.FieldAngle.HALF;e=e.clientY-i.top-t.FieldAngle.HALF,i=Math.atan(-e/s),isNaN(i)||(i=t.utils.math.toDegrees(i),0>s?i+=180:0<e&&(i+=360),i=this.clockwise_?this.offset_+360-i:360-(this.offset_-i),this.displayMouseOrKeyboardValue_(i))},t.FieldAngle.prototype.displayMouseOrKeyboardValue_=function(e){this.round_&&(e=Math.round(e/this.round_)*this.round_),e=this.wrapValue_(e),e!=this.value_&&this.setEditorValue_(e)},t.FieldAngle.prototype.updateGraph_=function(){if(this.gauge_){var e=Number(this.getText())+this.offset_,i=t.utils.math.toRadians(e%360);e=["M ",t.FieldAngle.HALF,",",t.FieldAngle.HALF];var s=t.FieldAngle.HALF,r=t.FieldAngle.HALF;if(!isNaN(i)){var o=Number(this.clockwise_),h=t.utils.math.toRadians(this.offset_),u=Math.cos(h)*t.FieldAngle.RADIUS,p=Math.sin(h)*-t.FieldAngle.RADIUS;o&&(i=2*h-i),s+=Math.cos(i)*t.FieldAngle.RADIUS,r-=Math.sin(i)*t.FieldAngle.RADIUS,i=Math.abs(Math.floor((i-h)/Math.PI)%2),o&&(i=1-i),e.push(" l ",u,",",p," A ",t.FieldAngle.RADIUS,",",t.FieldAngle.RADIUS," 0 ",i," ",o," ",s,",",r," z")}this.gauge_.setAttribute("d",e.join("")),this.line_.setAttribute("x2",s),this.line_.setAttribute("y2",r)}},t.FieldAngle.prototype.onHtmlInputKeyDown_=function(e){t.FieldAngle.superClass_.onHtmlInputKeyDown_.call(this,e);var i;if(e.keyCode===t.utils.KeyCodes.LEFT?i=this.sourceBlock_.RTL?1:-1:e.keyCode===t.utils.KeyCodes.RIGHT?i=this.sourceBlock_.RTL?-1:1:e.keyCode===t.utils.KeyCodes.DOWN?i=-1:e.keyCode===t.utils.KeyCodes.UP&&(i=1),i){var s=this.getValue();this.displayMouseOrKeyboardValue_(s+i*this.round_),e.preventDefault(),e.stopPropagation()}},t.FieldAngle.prototype.doClassValidation_=function(e){return e=Number(e),isNaN(e)||!isFinite(e)?null:this.wrapValue_(e)},t.FieldAngle.prototype.wrapValue_=function(e){return e%=360,0>e&&(e+=360),e>this.wrap_&&(e-=360),e},t.Css.register(".blocklyAngleCircle {,stroke: #444;,stroke-width: 1;,fill: #ddd;,fill-opacity: .8;,},.blocklyAngleMarks {,stroke: #444;,stroke-width: 1;,},.blocklyAngleGauge {,fill: #f88;,fill-opacity: .8;,pointer-events: none;,},.blocklyAngleLine {,stroke: #f00;,stroke-width: 2;,stroke-linecap: round;,pointer-events: none;,}".split(",")),t.fieldRegistry.register("field_angle",t.FieldAngle),t.FieldCheckbox=function(e,i,s){this.checkChar_=null,t.FieldCheckbox.superClass_.constructor.call(this,e,i,s)},t.utils.object.inherits(t.FieldCheckbox,t.Field),t.FieldCheckbox.prototype.DEFAULT_VALUE=!1,t.FieldCheckbox.fromJson=function(e){return new t.FieldCheckbox(e.checked,void 0,e)},t.FieldCheckbox.CHECK_CHAR="",t.FieldCheckbox.prototype.SERIALIZABLE=!0,t.FieldCheckbox.prototype.CURSOR="default",t.FieldCheckbox.prototype.configure_=function(e){t.FieldCheckbox.superClass_.configure_.call(this,e),e.checkCharacter&&(this.checkChar_=e.checkCharacter)},t.FieldCheckbox.prototype.initView=function(){t.FieldCheckbox.superClass_.initView.call(this),t.utils.dom.addClass(this.textElement_,"blocklyCheckbox"),this.textElement_.style.display=this.value_?"block":"none"},t.FieldCheckbox.prototype.render_=function(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_()),this.updateSize_(this.getConstants().FIELD_CHECKBOX_X_OFFSET)},t.FieldCheckbox.prototype.getDisplayText_=function(){return this.checkChar_||t.FieldCheckbox.CHECK_CHAR},t.FieldCheckbox.prototype.setCheckCharacter=function(e){this.checkChar_=e,this.forceRerender()},t.FieldCheckbox.prototype.showEditor_=function(){this.setValue(!this.value_)},t.FieldCheckbox.prototype.doClassValidation_=function(e){return e===!0||e==="TRUE"?"TRUE":e===!1||e==="FALSE"?"FALSE":null},t.FieldCheckbox.prototype.doValueUpdate_=function(e){this.value_=this.convertValueToBool_(e),this.textElement_&&(this.textElement_.style.display=this.value_?"block":"none")},t.FieldCheckbox.prototype.getValue=function(){return this.value_?"TRUE":"FALSE"},t.FieldCheckbox.prototype.getValueBoolean=function(){return this.value_},t.FieldCheckbox.prototype.getText=function(){return String(this.convertValueToBool_(this.value_))},t.FieldCheckbox.prototype.convertValueToBool_=function(e){return typeof e=="string"?e=="TRUE":!!e},t.fieldRegistry.register("field_checkbox",t.FieldCheckbox),t.FieldColour=function(e,i,s){t.FieldColour.superClass_.constructor.call(this,e,i,s),this.onKeyDownWrapper_=this.onMouseLeaveWrapper_=this.onMouseEnterWrapper_=this.onMouseMoveWrapper_=this.onClickWrapper_=this.highlightedIndex_=this.picker_=null},t.utils.object.inherits(t.FieldColour,t.Field),t.FieldColour.fromJson=function(e){return new t.FieldColour(e.colour,void 0,e)},t.FieldColour.prototype.SERIALIZABLE=!0,t.FieldColour.prototype.CURSOR="default",t.FieldColour.prototype.isDirty_=!1,t.FieldColour.prototype.colours_=null,t.FieldColour.prototype.titles_=null,t.FieldColour.prototype.columns_=0,t.FieldColour.prototype.configure_=function(e){t.FieldColour.superClass_.configure_.call(this,e),e.colourOptions&&(this.colours_=e.colourOptions,this.titles_=e.colourTitles),e.columns&&(this.columns_=e.columns)},t.FieldColour.prototype.initView=function(){this.size_=new t.utils.Size(this.getConstants().FIELD_COLOUR_DEFAULT_WIDTH,this.getConstants().FIELD_COLOUR_DEFAULT_HEIGHT),this.getConstants().FIELD_COLOUR_FULL_BLOCK?this.clickTarget_=this.sourceBlock_.getSvgRoot():(this.createBorderRect_(),this.borderRect_.style.fillOpacity="1")},t.FieldColour.prototype.applyColour=function(){this.getConstants().FIELD_COLOUR_FULL_BLOCK?(this.sourceBlock_.pathObject.svgPath.setAttribute("fill",this.getValue()),this.sourceBlock_.pathObject.svgPath.setAttribute("stroke","#fff")):this.borderRect_&&(this.borderRect_.style.fill=this.getValue())},t.FieldColour.prototype.doClassValidation_=function(e){return typeof e!="string"?null:t.utils.colour.parse(e)},t.FieldColour.prototype.doValueUpdate_=function(e){this.value_=e,this.borderRect_?this.borderRect_.style.fill=e:this.sourceBlock_&&this.sourceBlock_.rendered&&(this.sourceBlock_.pathObject.svgPath.setAttribute("fill",e),this.sourceBlock_.pathObject.svgPath.setAttribute("stroke","#fff"))},t.FieldColour.prototype.getText=function(){var e=this.value_;return/^#(.)\1(.)\2(.)\3$/.test(e)&&(e="#"+e[1]+e[3]+e[5]),e},t.FieldColour.COLOURS="#ffffff #cccccc #c0c0c0 #999999 #666666 #333333 #000000 #ffcccc #ff6666 #ff0000 #cc0000 #990000 #660000 #330000 #ffcc99 #ff9966 #ff9900 #ff6600 #cc6600 #993300 #663300 #ffff99 #ffff66 #ffcc66 #ffcc33 #cc9933 #996633 #663333 #ffffcc #ffff33 #ffff00 #ffcc00 #999900 #666600 #333300 #99ff99 #66ff99 #33ff33 #33cc00 #009900 #006600 #003300 #99ffff #33ffff #66cccc #00cccc #339999 #336666 #003333 #ccffff #66ffff #33ccff #3366ff #3333ff #000099 #000066 #ccccff #9999ff #6666cc #6633ff #6600cc #333399 #330099 #ffccff #ff99ff #cc66cc #cc33cc #993399 #663366 #330033".split(" "),t.FieldColour.prototype.DEFAULT_VALUE=t.FieldColour.COLOURS[0],t.FieldColour.TITLES=[],t.FieldColour.COLUMNS=7,t.FieldColour.prototype.setColours=function(e,i){return this.colours_=e,i&&(this.titles_=i),this},t.FieldColour.prototype.setColumns=function(e){return this.columns_=e,this},t.FieldColour.prototype.showEditor_=function(){this.picker_=this.dropdownCreate_(),t.DropDownDiv.getContentDiv().appendChild(this.picker_),t.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this)),this.picker_.focus({preventScroll:!0})},t.FieldColour.prototype.onClick_=function(e){e=(e=e.target)&&e.label,e!==null&&(this.setValue(e),t.DropDownDiv.hideIfOwner(this))},t.FieldColour.prototype.onKeyDown_=function(e){var i=!1;e.keyCode===t.utils.KeyCodes.UP?(this.moveHighlightBy_(0,-1),i=!0):e.keyCode===t.utils.KeyCodes.DOWN?(this.moveHighlightBy_(0,1),i=!0):e.keyCode===t.utils.KeyCodes.LEFT?(this.moveHighlightBy_(-1,0),i=!0):e.keyCode===t.utils.KeyCodes.RIGHT?(this.moveHighlightBy_(1,0),i=!0):e.keyCode===t.utils.KeyCodes.ENTER&&((i=this.getHighlighted_())&&(i=i&&i.label,i!==null&&this.setValue(i)),t.DropDownDiv.hideWithoutAnimation(),i=!0),i&&e.stopPropagation()},t.FieldColour.prototype.moveHighlightBy_=function(e,i){var s=this.colours_||t.FieldColour.COLOURS,r=this.columns_||t.FieldColour.COLUMNS,o=this.highlightedIndex_%r,h=Math.floor(this.highlightedIndex_/r);o+=e,h+=i,0>e?0>o&&0<h?(o=r-1,h--):0>o&&(o=0):0<e?o>r-1&&h<Math.floor(s.length/r)-1?(o=0,h++):o>r-1&&o--:0>i?0>h&&(h=0):0<i&&h>Math.floor(s.length/r)-1&&(h=Math.floor(s.length/r)-1),this.setHighlightedCell_(this.picker_.childNodes[h].childNodes[o],h*r+o)},t.FieldColour.prototype.onMouseMove_=function(e){var i=(e=e.target)&&Number(e.getAttribute("data-index"));i!==null&&i!==this.highlightedIndex_&&this.setHighlightedCell_(e,i)},t.FieldColour.prototype.onMouseEnter_=function(){this.picker_.focus({preventScroll:!0})},t.FieldColour.prototype.onMouseLeave_=function(){this.picker_.blur();var e=this.getHighlighted_();e&&t.utils.dom.removeClass(e,"blocklyColourHighlighted")},t.FieldColour.prototype.getHighlighted_=function(){var e=this.columns_||t.FieldColour.COLUMNS,i=this.picker_.childNodes[Math.floor(this.highlightedIndex_/e)];return i?i.childNodes[this.highlightedIndex_%e]:null},t.FieldColour.prototype.setHighlightedCell_=function(e,i){var s=this.getHighlighted_();s&&t.utils.dom.removeClass(s,"blocklyColourHighlighted"),t.utils.dom.addClass(e,"blocklyColourHighlighted"),this.highlightedIndex_=i,t.utils.aria.setState(this.picker_,t.utils.aria.State.ACTIVEDESCENDANT,e.getAttribute("id"))},t.FieldColour.prototype.dropdownCreate_=function(){var e=this.columns_||t.FieldColour.COLUMNS,i=this.colours_||t.FieldColour.COLOURS,s=this.titles_||t.FieldColour.TITLES,r=this.getValue(),o=document.createElement("table");o.className="blocklyColourTable",o.tabIndex=0,o.dir="ltr",t.utils.aria.setRole(o,t.utils.aria.Role.GRID),t.utils.aria.setState(o,t.utils.aria.State.EXPANDED,!0),t.utils.aria.setState(o,t.utils.aria.State.ROWCOUNT,Math.floor(i.length/e)),t.utils.aria.setState(o,t.utils.aria.State.COLCOUNT,e);for(var h,u=0;u<i.length;u++){u%e==0&&(h=document.createElement("tr"),t.utils.aria.setRole(h,t.utils.aria.Role.ROW),o.appendChild(h));var p=document.createElement("td");h.appendChild(p),p.label=i[u],p.title=s[u]||i[u],p.id=t.utils.IdGenerator.getNextUniqueId(),p.setAttribute("data-index",u),t.utils.aria.setRole(p,t.utils.aria.Role.GRIDCELL),t.utils.aria.setState(p,t.utils.aria.State.LABEL,i[u]),t.utils.aria.setState(p,t.utils.aria.State.SELECTED,i[u]==r),p.style.backgroundColor=i[u],i[u]==r&&(p.className="blocklyColourSelected",this.highlightedIndex_=u)}return this.onClickWrapper_=t.browserEvents.conditionalBind(o,"click",this,this.onClick_,!0),this.onMouseMoveWrapper_=t.browserEvents.conditionalBind(o,"mousemove",this,this.onMouseMove_,!0),this.onMouseEnterWrapper_=t.browserEvents.conditionalBind(o,"mouseenter",this,this.onMouseEnter_,!0),this.onMouseLeaveWrapper_=t.browserEvents.conditionalBind(o,"mouseleave",this,this.onMouseLeave_,!0),this.onKeyDownWrapper_=t.browserEvents.conditionalBind(o,"keydown",this,this.onKeyDown_),o},t.FieldColour.prototype.dropdownDispose_=function(){this.onClickWrapper_&&(t.browserEvents.unbind(this.onClickWrapper_),this.onClickWrapper_=null),this.onMouseMoveWrapper_&&(t.browserEvents.unbind(this.onMouseMoveWrapper_),this.onMouseMoveWrapper_=null),this.onMouseEnterWrapper_&&(t.browserEvents.unbind(this.onMouseEnterWrapper_),this.onMouseEnterWrapper_=null),this.onMouseLeaveWrapper_&&(t.browserEvents.unbind(this.onMouseLeaveWrapper_),this.onMouseLeaveWrapper_=null),this.onKeyDownWrapper_&&(t.browserEvents.unbind(this.onKeyDownWrapper_),this.onKeyDownWrapper_=null),this.highlightedIndex_=this.picker_=null},t.Css.register([".blocklyColourTable {","border-collapse: collapse;","display: block;","outline: none;","padding: 1px;","}",".blocklyColourTable>tr>td {","border: .5px solid #888;","box-sizing: border-box;","cursor: pointer;","display: inline-block;","height: 20px;","padding: 0;","width: 20px;","}",".blocklyColourTable>tr>td.blocklyColourHighlighted {","border-color: #eee;","box-shadow: 2px 2px 7px 2px rgba(0,0,0,.3);","position: relative;","}",".blocklyColourSelected, .blocklyColourSelected:hover {","border-color: #eee !important;","outline: 1px solid #333;","position: relative;","}"]),t.fieldRegistry.register("field_colour",t.FieldColour),t.FieldDropdown=function(e,i,s){typeof e!="function"&&t.FieldDropdown.validateOptions_(e),this.menuGenerator_=e,this.suffixField=this.prefixField=this.generatedOptions_=null,this.trimOptions_(),this.selectedOption_=this.getOptions(!1)[0],t.FieldDropdown.superClass_.constructor.call(this,this.selectedOption_[1],i,s),this.svgArrow_=this.arrow_=this.imageElement_=this.menu_=this.selectedMenuItem_=null},t.utils.object.inherits(t.FieldDropdown,t.Field),t.FieldDropdown.fromJson=function(e){return new t.FieldDropdown(e.options,void 0,e)},t.FieldDropdown.prototype.fromXml=function(e){this.isOptionListDynamic()&&this.getOptions(!1),this.setValue(e.textContent)},t.FieldDropdown.prototype.SERIALIZABLE=!0,t.FieldDropdown.CHECKMARK_OVERHANG=25,t.FieldDropdown.MAX_MENU_HEIGHT_VH=.45,t.FieldDropdown.IMAGE_Y_OFFSET=5,t.FieldDropdown.IMAGE_Y_PADDING=2*t.FieldDropdown.IMAGE_Y_OFFSET,t.FieldDropdown.ARROW_CHAR=t.utils.userAgent.ANDROID?"":"",t.FieldDropdown.prototype.CURSOR="default",t.FieldDropdown.prototype.initView=function(){this.shouldAddBorderRect_()?this.createBorderRect_():this.clickTarget_=this.sourceBlock_.getSvgRoot(),this.createTextElement_(),this.imageElement_=t.utils.dom.createSvgElement(t.utils.Svg.IMAGE,{},this.fieldGroup_),this.getConstants().FIELD_DROPDOWN_SVG_ARROW?this.createSVGArrow_():this.createTextArrow_(),this.borderRect_&&t.utils.dom.addClass(this.borderRect_,"blocklyDropdownRect")},t.FieldDropdown.prototype.shouldAddBorderRect_=function(){return!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW&&!this.sourceBlock_.isShadow()},t.FieldDropdown.prototype.createTextArrow_=function(){this.arrow_=t.utils.dom.createSvgElement(t.utils.Svg.TSPAN,{},this.textElement_),this.arrow_.appendChild(document.createTextNode(this.sourceBlock_.RTL?t.FieldDropdown.ARROW_CHAR+" ":" "+t.FieldDropdown.ARROW_CHAR)),this.sourceBlock_.RTL?this.textElement_.insertBefore(this.arrow_,this.textContent_):this.textElement_.appendChild(this.arrow_)},t.FieldDropdown.prototype.createSVGArrow_=function(){this.svgArrow_=t.utils.dom.createSvgElement(t.utils.Svg.IMAGE,{height:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px",width:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px"},this.fieldGroup_),this.svgArrow_.setAttributeNS(t.utils.dom.XLINK_NS,"xlink:href",this.getConstants().FIELD_DROPDOWN_SVG_ARROW_DATAURI)},t.FieldDropdown.prototype.showEditor_=function(e){if(this.menu_=this.dropdownCreate_(),this.menu_.openingCoords=e&&typeof e.clientX=="number"?new t.utils.Coordinate(e.clientX,e.clientY):null,this.menu_.render(t.DropDownDiv.getContentDiv()),e=this.menu_.getElement(),t.utils.dom.addClass(e,"blocklyDropdownMenu"),this.getConstants().FIELD_DROPDOWN_COLOURED_DIV){e=this.sourceBlock_.isShadow()?this.sourceBlock_.getParent().getColour():this.sourceBlock_.getColour();var i=this.sourceBlock_.isShadow()?this.sourceBlock_.getParent().style.colourTertiary:this.sourceBlock_.style.colourTertiary;t.DropDownDiv.setColour(e,i)}t.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this)),this.menu_.focus(),this.selectedMenuItem_&&this.menu_.setHighlighted(this.selectedMenuItem_),this.applyColour()},t.FieldDropdown.prototype.dropdownCreate_=function(){var e=new t.Menu;e.setRole(t.utils.aria.Role.LISTBOX);var i=this.getOptions(!1);this.selectedMenuItem_=null;for(var s=0;s<i.length;s++){var r=i[s][0],o=i[s][1];if(typeof r=="object"){var h=new Image(r.width,r.height);h.src=r.src,h.alt=r.alt||"",r=h}r=new t.MenuItem(r,o),r.setRole(t.utils.aria.Role.OPTION),r.setRightToLeft(this.sourceBlock_.RTL),r.setCheckable(!0),e.addChild(r),r.setChecked(o==this.value_),o==this.value_&&(this.selectedMenuItem_=r),r.onAction(this.handleMenuActionEvent_,this)}return e},t.FieldDropdown.prototype.dropdownDispose_=function(){this.menu_&&this.menu_.dispose(),this.selectedMenuItem_=this.menu_=null,this.applyColour()},t.FieldDropdown.prototype.handleMenuActionEvent_=function(e){t.DropDownDiv.hideIfOwner(this,!0),this.onItemSelected_(this.menu_,e)},t.FieldDropdown.prototype.onItemSelected_=function(e,i){this.setValue(i.getValue())},t.FieldDropdown.prototype.trimOptions_=function(){var e=this.menuGenerator_;if(Array.isArray(e)){for(var i=!1,s=0;s<e.length;s++){var r=e[s][0];typeof r=="string"?e[s][0]=t.utils.replaceMessageReferences(r):(r.alt!=null&&(e[s][0].alt=t.utils.replaceMessageReferences(r.alt)),i=!0)}if(!(i||2>e.length)){for(i=[],s=0;s<e.length;s++)i.push(e[s][0]);s=t.utils.string.shortestStringLength(i),r=t.utils.string.commonWordPrefix(i,s);var o=t.utils.string.commonWordSuffix(i,s);!r&&!o||s<=r+o||(r&&(this.prefixField=i[0].substring(0,r-1)),o&&(this.suffixField=i[0].substr(1-o)),this.menuGenerator_=t.FieldDropdown.applyTrim_(e,r,o))}}},t.FieldDropdown.applyTrim_=function(e,i,s){for(var r=[],o=0;o<e.length;o++){var h=e[o][0],u=e[o][1];h=h.substring(i,h.length-s),r[o]=[h,u]}return r},t.FieldDropdown.prototype.isOptionListDynamic=function(){return typeof this.menuGenerator_=="function"},t.FieldDropdown.prototype.getOptions=function(e){return this.isOptionListDynamic()?(this.generatedOptions_&&e||(this.generatedOptions_=this.menuGenerator_.call(this),t.FieldDropdown.validateOptions_(this.generatedOptions_)),this.generatedOptions_):this.menuGenerator_},t.FieldDropdown.prototype.doClassValidation_=function(e){for(var i=!1,s=this.getOptions(!0),r=0,o;o=s[r];r++)if(o[1]==e){i=!0;break}return i?e:(this.sourceBlock_&&console.warn("Cannot set the dropdown's value to an unavailable option. Block type: "+this.sourceBlock_.type+", Field name: "+this.name+", Value: "+e),null)},t.FieldDropdown.prototype.doValueUpdate_=function(e){t.FieldDropdown.superClass_.doValueUpdate_.call(this,e),e=this.getOptions(!0);for(var i=0,s;s=e[i];i++)s[1]==this.value_&&(this.selectedOption_=s)},t.FieldDropdown.prototype.applyColour=function(){this.borderRect_&&(this.borderRect_.setAttribute("stroke",this.sourceBlock_.style.colourTertiary),this.menu_?this.borderRect_.setAttribute("fill",this.sourceBlock_.style.colourTertiary):this.borderRect_.setAttribute("fill","transparent")),this.sourceBlock_&&this.arrow_&&(this.sourceBlock_.isShadow()?this.arrow_.style.fill=this.sourceBlock_.style.colourSecondary:this.arrow_.style.fill=this.sourceBlock_.style.colourPrimary)},t.FieldDropdown.prototype.render_=function(){this.textContent_.nodeValue="",this.imageElement_.style.display="none";var e=this.selectedOption_&&this.selectedOption_[0];e&&typeof e=="object"?this.renderSelectedImage_(e):this.renderSelectedText_(),this.positionBorderRect_()},t.FieldDropdown.prototype.renderSelectedImage_=function(e){this.imageElement_.style.display="",this.imageElement_.setAttributeNS(t.utils.dom.XLINK_NS,"xlink:href",e.src),this.imageElement_.setAttribute("height",e.height),this.imageElement_.setAttribute("width",e.width);var i=Number(e.height);e=Number(e.width);var s=!!this.borderRect_,r=Math.max(s?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,i+t.FieldDropdown.IMAGE_Y_PADDING);s=s?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0;var o=this.svgArrow_?this.positionSVGArrow_(e+s,r/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2):t.utils.dom.getFastTextWidth(this.arrow_,this.getConstants().FIELD_TEXT_FONTSIZE,this.getConstants().FIELD_TEXT_FONTWEIGHT,this.getConstants().FIELD_TEXT_FONTFAMILY);this.size_.width=e+o+2*s,this.size_.height=r;var h=0;this.sourceBlock_.RTL?this.imageElement_.setAttribute("x",s+o):(h=e+o,this.textElement_.setAttribute("text-anchor","end"),this.imageElement_.setAttribute("x",s)),this.imageElement_.setAttribute("y",r/2-i/2),this.positionTextElement_(h+s,e+o)},t.FieldDropdown.prototype.renderSelectedText_=function(){this.textContent_.nodeValue=this.getDisplayText_(),t.utils.dom.addClass(this.textElement_,"blocklyDropdownText"),this.textElement_.setAttribute("text-anchor","start");var e=!!this.borderRect_,i=Math.max(e?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,this.getConstants().FIELD_TEXT_HEIGHT),s=t.utils.dom.getFastTextWidth(this.textElement_,this.getConstants().FIELD_TEXT_FONTSIZE,this.getConstants().FIELD_TEXT_FONTWEIGHT,this.getConstants().FIELD_TEXT_FONTFAMILY);e=e?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0;var r=0;this.svgArrow_&&(r=this.positionSVGArrow_(s+e,i/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2)),this.size_.width=s+r+2*e,this.size_.height=i,this.positionTextElement_(e,s)},t.FieldDropdown.prototype.positionSVGArrow_=function(e,i){if(!this.svgArrow_)return 0;var s=this.borderRect_?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0,r=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_PADDING,o=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE;return this.svgArrow_.setAttribute("transform","translate("+(this.sourceBlock_.RTL?s:e+r)+","+i+")"),o+r},t.FieldDropdown.prototype.getText_=function(){if(!this.selectedOption_)return null;var e=this.selectedOption_[0];return typeof e=="object"?e.alt:e},t.FieldDropdown.validateOptions_=function(e){if(!Array.isArray(e))throw TypeError("FieldDropdown options must be an array.");if(!e.length)throw TypeError("FieldDropdown options must not be an empty array.");for(var i=!1,s=0;s<e.length;++s){var r=e[s];Array.isArray(r)?typeof r[1]!="string"?(i=!0,console.error("Invalid option["+s+"]: Each FieldDropdown option id must be a string. Found "+r[1]+" in: ",r)):r[0]&&typeof r[0]!="string"&&typeof r[0].src!="string"&&(i=!0,console.error("Invalid option["+s+"]: Each FieldDropdown option must have a string label or image description. Found"+r[0]+" in: ",r)):(i=!0,console.error("Invalid option["+s+"]: Each FieldDropdown option must be an array. Found: ",r))}if(i)throw TypeError("Found invalid FieldDropdown options.")},t.fieldRegistry.register("field_dropdown",t.FieldDropdown),t.FieldLabelSerializable=function(e,i,s){t.FieldLabelSerializable.superClass_.constructor.call(this,e,i,s)},t.utils.object.inherits(t.FieldLabelSerializable,t.FieldLabel),t.FieldLabelSerializable.fromJson=function(e){var i=t.utils.replaceMessageReferences(e.text);return new t.FieldLabelSerializable(i,void 0,e)},t.FieldLabelSerializable.prototype.EDITABLE=!1,t.FieldLabelSerializable.prototype.SERIALIZABLE=!0,t.fieldRegistry.register("field_label_serializable",t.FieldLabelSerializable),t.FieldImage=function(e,i,s,r,o,h,u){if(!e)throw Error("Src value of an image field is required");if(e=t.utils.replaceMessageReferences(e),s=Number(t.utils.replaceMessageReferences(s)),i=Number(t.utils.replaceMessageReferences(i)),isNaN(s)||isNaN(i))throw Error("Height and width values of an image field must cast to numbers.");if(0>=s||0>=i)throw Error("Height and width values of an image field must be greater than 0.");this.flipRtl_=!1,this.altText_="",t.FieldImage.superClass_.constructor.call(this,e,null,u),u||(this.flipRtl_=!!h,this.altText_=t.utils.replaceMessageReferences(r)||""),this.size_=new t.utils.Size(i,s+t.FieldImage.Y_PADDING),this.imageHeight_=s,this.clickHandler_=null,typeof o=="function"&&(this.clickHandler_=o),this.imageElement_=null},t.utils.object.inherits(t.FieldImage,t.Field),t.FieldImage.prototype.DEFAULT_VALUE="",t.FieldImage.fromJson=function(e){return new t.FieldImage(e.src,e.width,e.height,void 0,void 0,void 0,e)},t.FieldImage.Y_PADDING=1,t.FieldImage.prototype.EDITABLE=!1,t.FieldImage.prototype.isDirty_=!1,t.FieldImage.prototype.configure_=function(e){t.FieldImage.superClass_.configure_.call(this,e),this.flipRtl_=!!e.flipRtl,this.altText_=t.utils.replaceMessageReferences(e.alt)||""},t.FieldImage.prototype.initView=function(){this.imageElement_=t.utils.dom.createSvgElement(t.utils.Svg.IMAGE,{height:this.imageHeight_+"px",width:this.size_.width+"px",alt:this.altText_},this.fieldGroup_),this.imageElement_.setAttributeNS(t.utils.dom.XLINK_NS,"xlink:href",this.value_),this.clickHandler_&&(this.imageElement_.style.cursor="pointer")},t.FieldImage.prototype.updateSize_=function(){},t.FieldImage.prototype.doClassValidation_=function(e){return typeof e!="string"?null:e},t.FieldImage.prototype.doValueUpdate_=function(e){this.value_=e,this.imageElement_&&this.imageElement_.setAttributeNS(t.utils.dom.XLINK_NS,"xlink:href",String(this.value_))},t.FieldImage.prototype.getFlipRtl=function(){return this.flipRtl_},t.FieldImage.prototype.setAlt=function(e){e!=this.altText_&&(this.altText_=e||"",this.imageElement_&&this.imageElement_.setAttribute("alt",this.altText_))},t.FieldImage.prototype.showEditor_=function(){this.clickHandler_&&this.clickHandler_(this)},t.FieldImage.prototype.setOnClickHandler=function(e){this.clickHandler_=e},t.FieldImage.prototype.getText_=function(){return this.altText_},t.fieldRegistry.register("field_image",t.FieldImage),t.FieldMultilineInput=function(e,i,s){t.FieldMultilineInput.superClass_.constructor.call(this,e,i,s),this.textGroup_=null,this.maxLines_=1/0,this.isOverflowedY_=!1},t.utils.object.inherits(t.FieldMultilineInput,t.FieldTextInput),t.FieldMultilineInput.prototype.configure_=function(e){t.FieldMultilineInput.superClass_.configure_.call(this,e),e.maxLines&&this.setMaxLines(e.maxLines)},t.FieldMultilineInput.fromJson=function(e){var i=t.utils.replaceMessageReferences(e.text);return new t.FieldMultilineInput(i,void 0,e)},t.FieldMultilineInput.prototype.toXml=function(e){return e.textContent=this.getValue().replace(/\n/g,"&#10;"),e},t.FieldMultilineInput.prototype.fromXml=function(e){this.setValue(e.textContent.replace(/&#10;/g,`
`))},t.FieldMultilineInput.prototype.initView=function(){this.createBorderRect_(),this.textGroup_=t.utils.dom.createSvgElement(t.utils.Svg.G,{class:"blocklyEditableText"},this.fieldGroup_)},t.FieldMultilineInput.prototype.getDisplayText_=function(){var e=this.getText();if(!e)return t.Field.NBSP;var i=e.split(`
`);e="";for(var s=this.isOverflowedY_?this.maxLines_:i.length,r=0;r<s;r++){var o=i[r];o.length>this.maxDisplayLength?o=o.substring(0,this.maxDisplayLength-4)+"...":this.isOverflowedY_&&r===s-1&&(o=o.substring(0,o.length-3)+"..."),o=o.replace(/\s/g,t.Field.NBSP),e+=o,r!==s-1&&(e+=`
`)}return this.sourceBlock_.RTL&&(e+=""),e},t.FieldMultilineInput.prototype.doValueUpdate_=function(e){t.FieldMultilineInput.superClass_.doValueUpdate_.call(this,e),this.isOverflowedY_=this.value_.split(`
`).length>this.maxLines_},t.FieldMultilineInput.prototype.render_=function(){for(var e;e=this.textGroup_.firstChild;)this.textGroup_.removeChild(e);e=this.getDisplayText_().split(`
`);for(var i=0,s=0;s<e.length;s++){var r=this.getConstants().FIELD_TEXT_HEIGHT+this.getConstants().FIELD_BORDER_RECT_Y_PADDING;t.utils.dom.createSvgElement(t.utils.Svg.TEXT,{class:"blocklyText blocklyMultilineText",x:this.getConstants().FIELD_BORDER_RECT_X_PADDING,y:i+this.getConstants().FIELD_BORDER_RECT_Y_PADDING,dy:this.getConstants().FIELD_TEXT_BASELINE},this.textGroup_).appendChild(document.createTextNode(e[s])),i+=r}this.isBeingEdited_&&(e=this.htmlInput_,this.isOverflowedY_?t.utils.dom.addClass(e,"blocklyHtmlTextAreaInputOverflowedY"):t.utils.dom.removeClass(e,"blocklyHtmlTextAreaInputOverflowedY")),this.updateSize_(),this.isBeingEdited_&&(this.sourceBlock_.RTL?setTimeout(this.resizeEditor_.bind(this),0):this.resizeEditor_(),e=this.htmlInput_,this.isTextValid_?(t.utils.dom.removeClass(e,"blocklyInvalidInput"),t.utils.aria.setState(e,t.utils.aria.State.INVALID,!1)):(t.utils.dom.addClass(e,"blocklyInvalidInput"),t.utils.aria.setState(e,t.utils.aria.State.INVALID,!0)))},t.FieldMultilineInput.prototype.updateSize_=function(){for(var e=this.textGroup_.childNodes,i=0,s=0,r=0;r<e.length;r++){var o=t.utils.dom.getTextWidth(e[r]);o>i&&(i=o),s+=this.getConstants().FIELD_TEXT_HEIGHT+(0<r?this.getConstants().FIELD_BORDER_RECT_Y_PADDING:0)}if(this.isBeingEdited_){e=this.value_.split(`
`),o=t.utils.dom.createSvgElement(t.utils.Svg.TEXT,{class:"blocklyText blocklyMultilineText"});var h=this.getConstants().FIELD_TEXT_FONTSIZE,u=this.getConstants().FIELD_TEXT_FONTWEIGHT,p=this.getConstants().FIELD_TEXT_FONTFAMILY;for(r=0;r<e.length;r++){e[r].length>this.maxDisplayLength&&(e[r]=e[r].substring(0,this.maxDisplayLength)),o.textContent=e[r];var d=t.utils.dom.getFastTextWidth(o,h,u,p);d>i&&(i=d)}i+=this.htmlInput_.offsetWidth-this.htmlInput_.clientWidth}this.borderRect_&&(s+=2*this.getConstants().FIELD_BORDER_RECT_Y_PADDING,i+=2*this.getConstants().FIELD_BORDER_RECT_X_PADDING,this.borderRect_.setAttribute("width",i),this.borderRect_.setAttribute("height",s)),this.size_.width=i,this.size_.height=s,this.positionBorderRect_()},t.FieldMultilineInput.prototype.showEditor_=function(e,i){t.FieldMultilineInput.superClass_.showEditor_.call(this,e,i),this.forceRerender()},t.FieldMultilineInput.prototype.widgetCreate_=function(){var e=t.WidgetDiv.DIV,i=this.workspace_.getScale(),s=document.createElement("textarea");s.className="blocklyHtmlInput blocklyHtmlTextAreaInput",s.setAttribute("spellcheck",this.spellcheck_);var r=this.getConstants().FIELD_TEXT_FONTSIZE*i+"pt";e.style.fontSize=r,s.style.fontSize=r,s.style.borderRadius=t.FieldTextInput.BORDERRADIUS*i+"px",r=this.getConstants().FIELD_BORDER_RECT_X_PADDING*i;var o=this.getConstants().FIELD_BORDER_RECT_Y_PADDING*i/2;return s.style.padding=o+"px "+r+"px "+o+"px "+r+"px",r=this.getConstants().FIELD_TEXT_HEIGHT+this.getConstants().FIELD_BORDER_RECT_Y_PADDING,s.style.lineHeight=r*i+"px",e.appendChild(s),s.value=s.defaultValue=this.getEditorText_(this.value_),s.untypedDefaultValue_=this.value_,s.oldValue_=null,t.utils.userAgent.GECKO?setTimeout(this.resizeEditor_.bind(this),0):this.resizeEditor_(),this.bindInputEvents_(s),s},t.FieldMultilineInput.prototype.setMaxLines=function(e){typeof e=="number"&&0<e&&e!==this.maxLines_&&(this.maxLines_=e,this.forceRerender())},t.FieldMultilineInput.prototype.getMaxLines=function(){return this.maxLines_},t.FieldMultilineInput.prototype.onHtmlInputKeyDown_=function(e){e.keyCode!==t.utils.KeyCodes.ENTER&&t.FieldMultilineInput.superClass_.onHtmlInputKeyDown_.call(this,e)},t.Css.register(".blocklyHtmlTextAreaInput {,font-family: monospace;,resize: none;,overflow: hidden;,height: 100%;,text-align: left;,},.blocklyHtmlTextAreaInputOverflowedY {,overflow-y: scroll;,}".split(",")),t.fieldRegistry.register("field_multilinetext",t.FieldMultilineInput),t.FieldNumber=function(e,i,s,r,o,h){this.min_=-1/0,this.max_=1/0,this.precision_=0,this.decimalPlaces_=null,t.FieldNumber.superClass_.constructor.call(this,e,o,h),h||this.setConstraints(i,s,r)},t.utils.object.inherits(t.FieldNumber,t.FieldTextInput),t.FieldNumber.prototype.DEFAULT_VALUE=0,t.FieldNumber.fromJson=function(e){return new t.FieldNumber(e.value,void 0,void 0,void 0,void 0,e)},t.FieldNumber.prototype.SERIALIZABLE=!0,t.FieldNumber.prototype.configure_=function(e){t.FieldNumber.superClass_.configure_.call(this,e),this.setMinInternal_(e.min),this.setMaxInternal_(e.max),this.setPrecisionInternal_(e.precision)},t.FieldNumber.prototype.setConstraints=function(e,i,s){this.setMinInternal_(e),this.setMaxInternal_(i),this.setPrecisionInternal_(s),this.setValue(this.getValue())},t.FieldNumber.prototype.setMin=function(e){this.setMinInternal_(e),this.setValue(this.getValue())},t.FieldNumber.prototype.setMinInternal_=function(e){e==null?this.min_=-1/0:(e=Number(e),isNaN(e)||(this.min_=e))},t.FieldNumber.prototype.getMin=function(){return this.min_},t.FieldNumber.prototype.setMax=function(e){this.setMaxInternal_(e),this.setValue(this.getValue())},t.FieldNumber.prototype.setMaxInternal_=function(e){e==null?this.max_=1/0:(e=Number(e),isNaN(e)||(this.max_=e))},t.FieldNumber.prototype.getMax=function(){return this.max_},t.FieldNumber.prototype.setPrecision=function(e){this.setPrecisionInternal_(e),this.setValue(this.getValue())},t.FieldNumber.prototype.setPrecisionInternal_=function(e){e==null?this.precision_=0:(e=Number(e),isNaN(e)||(this.precision_=e));var i=this.precision_.toLocaleString("en-US",{maximumFractionDigits:20}),s=i.indexOf(".");this.decimalPlaces_=s==-1?e?0:null:i.length-s-1},t.FieldNumber.prototype.getPrecision=function(){return this.precision_},t.FieldNumber.prototype.doClassValidation_=function(e){return e===null||(e=String(e),e=e.replace(/O/ig,"0"),e=e.replace(/,/g,""),e=e.replace(/infinity/i,"Infinity"),e=Number(e||0),isNaN(e))?null:(e=Math.min(Math.max(e,this.min_),this.max_),this.precision_&&isFinite(e)&&(e=Math.round(e/this.precision_)*this.precision_),this.decimalPlaces_!=null&&(e=Number(e.toFixed(this.decimalPlaces_))),e)},t.FieldNumber.prototype.widgetCreate_=function(){var e=t.FieldNumber.superClass_.widgetCreate_.call(this);return-1/0<this.min_&&t.utils.aria.setState(e,t.utils.aria.State.VALUEMIN,this.min_),1/0>this.max_&&t.utils.aria.setState(e,t.utils.aria.State.VALUEMAX,this.max_),e},t.fieldRegistry.register("field_number",t.FieldNumber),t.FieldVariable=function(e,i,s,r,o){this.menuGenerator_=t.FieldVariable.dropdownCreate,this.defaultVariableName=typeof e=="string"?e:"",this.size_=new t.utils.Size(0,0),o&&this.configure_(o),i&&this.setValidator(i),o||this.setTypes_(s,r)},t.utils.object.inherits(t.FieldVariable,t.FieldDropdown),t.FieldVariable.fromJson=function(e){var i=t.utils.replaceMessageReferences(e.variable);return new t.FieldVariable(i,void 0,void 0,void 0,e)},t.FieldVariable.prototype.SERIALIZABLE=!0,t.FieldVariable.prototype.configure_=function(e){t.FieldVariable.superClass_.configure_.call(this,e),this.setTypes_(e.variableTypes,e.defaultType)},t.FieldVariable.prototype.initModel=function(){if(!this.variable_){var e=t.Variables.getOrCreateVariablePackage(this.sourceBlock_.workspace,null,this.defaultVariableName,this.defaultType_);this.doValueUpdate_(e.getId())}},t.FieldVariable.prototype.shouldAddBorderRect_=function(){return t.FieldVariable.superClass_.shouldAddBorderRect_.call(this)&&(!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||this.sourceBlock_.type!="variables_get")},t.FieldVariable.prototype.fromXml=function(e){var i=e.getAttribute("id"),s=e.textContent,r=e.getAttribute("variabletype")||e.getAttribute("variableType")||"";if(i=t.Variables.getOrCreateVariablePackage(this.sourceBlock_.workspace,i,s,r),r!=null&&r!==i.type)throw Error("Serialized variable type with id '"+i.getId()+"' had type "+i.type+", and does not match variable field that references it: "+t.Xml.domToText(e)+".");this.setValue(i.getId())},t.FieldVariable.prototype.toXml=function(e){return this.initModel(),e.id=this.variable_.getId(),e.textContent=this.variable_.name,this.variable_.type&&e.setAttribute("variabletype",this.variable_.type),e},t.FieldVariable.prototype.setSourceBlock=function(e){if(e.isShadow())throw Error("Variable fields are not allowed to exist on shadow blocks.");t.FieldVariable.superClass_.setSourceBlock.call(this,e)},t.FieldVariable.prototype.getValue=function(){return this.variable_?this.variable_.getId():null},t.FieldVariable.prototype.getText=function(){return this.variable_?this.variable_.name:""},t.FieldVariable.prototype.getVariable=function(){return this.variable_},t.FieldVariable.prototype.getValidator=function(){return this.variable_?this.validator_:null},t.FieldVariable.prototype.doClassValidation_=function(e){if(e===null)return null;var i=t.Variables.getVariable(this.sourceBlock_.workspace,e);return i?(i=i.type,this.typeIsAllowed_(i)?e:(console.warn("Variable type doesn't match this field!  Type was "+i),null)):(console.warn("Variable id doesn't point to a real variable! ID was "+e),null)},t.FieldVariable.prototype.doValueUpdate_=function(e){this.variable_=t.Variables.getVariable(this.sourceBlock_.workspace,e),t.FieldVariable.superClass_.doValueUpdate_.call(this,e)},t.FieldVariable.prototype.typeIsAllowed_=function(e){var i=this.getVariableTypes_();if(!i)return!0;for(var s=0;s<i.length;s++)if(e==i[s])return!0;return!1},t.FieldVariable.prototype.getVariableTypes_=function(){var e=this.variableTypes;if(e===null&&this.sourceBlock_&&this.sourceBlock_.workspace)return this.sourceBlock_.workspace.getVariableTypes();if(e=e||[""],e.length==0)throw e=this.getText(),Error("'variableTypes' of field variable "+e+" was an empty list");return e},t.FieldVariable.prototype.setTypes_=function(e,i){if(i=i||"",e==null||e==null)e=null;else if(Array.isArray(e)){for(var s=!1,r=0;r<e.length;r++)e[r]==i&&(s=!0);if(!s)throw Error("Invalid default type '"+i+"' in the definition of a FieldVariable")}else throw Error("'variableTypes' was not an array in the definition of a FieldVariable");this.defaultType_=i,this.variableTypes=e},t.FieldVariable.prototype.refreshVariableName=function(){this.forceRerender()},t.FieldVariable.dropdownCreate=function(){if(!this.variable_)throw Error("Tried to call dropdownCreate on a variable field with no variable selected.");var e=this.getText(),i=[];if(this.sourceBlock_&&this.sourceBlock_.workspace)for(var s=this.getVariableTypes_(),r=0;r<s.length;r++){var o=this.sourceBlock_.workspace.getVariablesOfType(s[r]);i=i.concat(o)}for(i.sort(t.VariableModel.compareByName),s=[],r=0;r<i.length;r++)s[r]=[i[r].name,i[r].getId()];return s.push([t.Msg.RENAME_VARIABLE,t.RENAME_VARIABLE_ID]),t.Msg.DELETE_VARIABLE&&s.push([t.Msg.DELETE_VARIABLE.replace("%1",e),t.DELETE_VARIABLE_ID]),s},t.FieldVariable.prototype.onItemSelected_=function(e,i){if(e=i.getValue(),this.sourceBlock_&&this.sourceBlock_.workspace){if(e==t.RENAME_VARIABLE_ID){t.Variables.renameVariable(this.sourceBlock_.workspace,this.variable_);return}if(e==t.DELETE_VARIABLE_ID){this.sourceBlock_.workspace.deleteVariableById(this.variable_.getId());return}}this.setValue(e)},t.FieldVariable.prototype.referencesVariables=function(){return!0},t.fieldRegistry.register("field_variable",t.FieldVariable),t.utils.svgPaths={},t.utils.svgPaths.point=function(e,i){return" "+e+","+i+" "},t.utils.svgPaths.curve=function(e,i){return" "+e+i.join("")},t.utils.svgPaths.moveTo=function(e,i){return" M "+e+","+i+" "},t.utils.svgPaths.moveBy=function(e,i){return" m "+e+","+i+" "},t.utils.svgPaths.lineTo=function(e,i){return" l "+e+","+i+" "},t.utils.svgPaths.line=function(e){return" l"+e.join("")},t.utils.svgPaths.lineOnAxis=function(e,i){return" "+e+" "+i+" "},t.utils.svgPaths.arc=function(e,i,s,r){return e+" "+s+" "+s+" "+i+r},t.blockRendering.ConstantProvider=function(){this.NO_PADDING=0,this.SMALL_PADDING=3,this.MEDIUM_PADDING=5,this.MEDIUM_LARGE_PADDING=8,this.LARGE_PADDING=10,this.TALL_INPUT_FIELD_OFFSET_Y=this.MEDIUM_PADDING,this.TAB_HEIGHT=15,this.TAB_OFFSET_FROM_TOP=5,this.TAB_VERTICAL_OVERLAP=2.5,this.TAB_WIDTH=8,this.NOTCH_WIDTH=15,this.NOTCH_HEIGHT=4,this.MIN_BLOCK_WIDTH=12,this.EMPTY_BLOCK_SPACER_HEIGHT=16,this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=this.DUMMY_INPUT_MIN_HEIGHT=this.TAB_HEIGHT,this.CORNER_RADIUS=8,this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT=15,this.STATEMENT_BOTTOM_SPACER=0,this.STATEMENT_INPUT_PADDING_LEFT=20,this.BETWEEN_STATEMENT_PADDING_Y=4,this.TOP_ROW_MIN_HEIGHT=this.MEDIUM_PADDING,this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.BOTTOM_ROW_MIN_HEIGHT=this.MEDIUM_PADDING,this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.ADD_START_HATS=!1,this.START_HAT_HEIGHT=15,this.START_HAT_WIDTH=100,this.SPACER_DEFAULT_HEIGHT=15,this.MIN_BLOCK_HEIGHT=24,this.EMPTY_INLINE_INPUT_PADDING=14.5,this.EMPTY_INLINE_INPUT_HEIGHT=this.TAB_HEIGHT+11,this.EXTERNAL_VALUE_INPUT_PADDING=2,this.EMPTY_STATEMENT_INPUT_HEIGHT=this.MIN_BLOCK_HEIGHT,this.START_POINT=t.utils.svgPaths.moveBy(0,0),this.JAGGED_TEETH_HEIGHT=12,this.JAGGED_TEETH_WIDTH=6,this.FIELD_TEXT_FONTSIZE=11,this.FIELD_TEXT_FONTWEIGHT="normal",this.FIELD_TEXT_FONTFAMILY="sans-serif",this.FIELD_TEXT_BASELINE=this.FIELD_TEXT_HEIGHT=-1,this.FIELD_BORDER_RECT_RADIUS=4,this.FIELD_BORDER_RECT_HEIGHT=16,this.FIELD_BORDER_RECT_X_PADDING=5,this.FIELD_BORDER_RECT_Y_PADDING=3,this.FIELD_BORDER_RECT_COLOUR="#fff",this.FIELD_TEXT_BASELINE_CENTER=!t.utils.userAgent.IE&&!t.utils.userAgent.EDGE,this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT,this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!1,this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING,this.FIELD_DROPDOWN_SVG_ARROW_SIZE=12,this.FIELD_DROPDOWN_SVG_ARROW_DATAURI="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaGVpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLWFycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuNDEsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTDAuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNzFDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMCwxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNzlhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYzAuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMzdBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=",this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=!1,this.FIELD_COLOUR_DEFAULT_WIDTH=26,this.FIELD_COLOUR_DEFAULT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT,this.FIELD_CHECKBOX_X_OFFSET=this.FIELD_BORDER_RECT_X_PADDING-3,this.randomIdentifier=String(Math.random()).substring(2),this.embossFilterId="",this.embossFilter_=null,this.disabledPatternId="",this.disabledPattern_=null,this.debugFilterId="",this.cssNode_=this.debugFilter_=null,this.CURSOR_COLOUR="#cc0a0a",this.MARKER_COLOUR="#4286f4",this.CURSOR_WS_WIDTH=100,this.WS_CURSOR_HEIGHT=5,this.CURSOR_STACK_PADDING=10,this.CURSOR_BLOCK_PADDING=2,this.CURSOR_STROKE_WIDTH=4,this.FULL_BLOCK_FIELDS=!1,this.INSERTION_MARKER_COLOUR="#000000",this.INSERTION_MARKER_OPACITY=.2,this.SHAPES={PUZZLE:1,NOTCH:2}},t.blockRendering.ConstantProvider.prototype.init=function(){this.JAGGED_TEETH=this.makeJaggedTeeth(),this.NOTCH=this.makeNotch(),this.START_HAT=this.makeStartHat(),this.PUZZLE_TAB=this.makePuzzleTab(),this.INSIDE_CORNERS=this.makeInsideCorners(),this.OUTSIDE_CORNERS=this.makeOutsideCorners()},t.blockRendering.ConstantProvider.prototype.setTheme=function(e){this.blockStyles={};var i=e.blockStyles,s;for(s in i)this.blockStyles[s]=this.validatedBlockStyle_(i[s]);this.setDynamicProperties_(e)},t.blockRendering.ConstantProvider.prototype.setDynamicProperties_=function(e){this.setFontConstants_(e),this.setComponentConstants_(e),this.ADD_START_HATS=e.startHats!=null?e.startHats:this.ADD_START_HATS},t.blockRendering.ConstantProvider.prototype.setFontConstants_=function(e){this.FIELD_TEXT_FONTFAMILY=e.fontStyle&&e.fontStyle.family!=null?e.fontStyle.family:this.FIELD_TEXT_FONTFAMILY,this.FIELD_TEXT_FONTWEIGHT=e.fontStyle&&e.fontStyle.weight!=null?e.fontStyle.weight:this.FIELD_TEXT_FONTWEIGHT,this.FIELD_TEXT_FONTSIZE=e.fontStyle&&e.fontStyle.size!=null?e.fontStyle.size:this.FIELD_TEXT_FONTSIZE,e=t.utils.dom.measureFontMetrics("Hg",this.FIELD_TEXT_FONTSIZE+"pt",this.FIELD_TEXT_FONTWEIGHT,this.FIELD_TEXT_FONTFAMILY),this.FIELD_TEXT_HEIGHT=e.height,this.FIELD_TEXT_BASELINE=e.baseline},t.blockRendering.ConstantProvider.prototype.setComponentConstants_=function(e){this.CURSOR_COLOUR=e.getComponentStyle("cursorColour")||this.CURSOR_COLOUR,this.MARKER_COLOUR=e.getComponentStyle("markerColour")||this.MARKER_COLOUR,this.INSERTION_MARKER_COLOUR=e.getComponentStyle("insertionMarkerColour")||this.INSERTION_MARKER_COLOUR,this.INSERTION_MARKER_OPACITY=Number(e.getComponentStyle("insertionMarkerOpacity"))||this.INSERTION_MARKER_OPACITY},t.blockRendering.ConstantProvider.prototype.getBlockStyleForColour=function(e){var i="auto_"+e;return this.blockStyles[i]||(this.blockStyles[i]=this.createBlockStyle_(e)),{style:this.blockStyles[i],name:i}},t.blockRendering.ConstantProvider.prototype.getBlockStyle=function(e){return this.blockStyles[e||""]||(e&&e.indexOf("auto_")==0?this.getBlockStyleForColour(e.substring(5)).style:this.createBlockStyle_("#000000"))},t.blockRendering.ConstantProvider.prototype.createBlockStyle_=function(e){return this.validatedBlockStyle_({colourPrimary:e})},t.blockRendering.ConstantProvider.prototype.validatedBlockStyle_=function(e){var i={};return e&&t.utils.object.mixin(i,e),e=t.utils.parseBlockColour(i.colourPrimary||"#000"),i.colourPrimary=e.hex,i.colourSecondary=i.colourSecondary?t.utils.parseBlockColour(i.colourSecondary).hex:this.generateSecondaryColour_(i.colourPrimary),i.colourTertiary=i.colourTertiary?t.utils.parseBlockColour(i.colourTertiary).hex:this.generateTertiaryColour_(i.colourPrimary),i.hat=i.hat||"",i},t.blockRendering.ConstantProvider.prototype.generateSecondaryColour_=function(e){return t.utils.colour.blend("#fff",e,.6)||e},t.blockRendering.ConstantProvider.prototype.generateTertiaryColour_=function(e){return t.utils.colour.blend("#fff",e,.3)||e},t.blockRendering.ConstantProvider.prototype.dispose=function(){this.embossFilter_&&t.utils.dom.removeNode(this.embossFilter_),this.disabledPattern_&&t.utils.dom.removeNode(this.disabledPattern_),this.debugFilter_&&t.utils.dom.removeNode(this.debugFilter_),this.cssNode_=null},t.blockRendering.ConstantProvider.prototype.makeJaggedTeeth=function(){var e=this.JAGGED_TEETH_HEIGHT,i=this.JAGGED_TEETH_WIDTH,s=t.utils.svgPaths.line([t.utils.svgPaths.point(i,e/4),t.utils.svgPaths.point(2*-i,e/2),t.utils.svgPaths.point(i,e/4)]);return{height:e,width:i,path:s}},t.blockRendering.ConstantProvider.prototype.makeStartHat=function(){var e=this.START_HAT_HEIGHT,i=this.START_HAT_WIDTH,s=t.utils.svgPaths.curve("c",[t.utils.svgPaths.point(30,-e),t.utils.svgPaths.point(70,-e),t.utils.svgPaths.point(i,0)]);return{height:e,width:i,path:s}},t.blockRendering.ConstantProvider.prototype.makePuzzleTab=function(){function e(h){h=h?-1:1;var u=-h,p=s/2,d=p+2.5,f=p+.5,g=t.utils.svgPaths.point(-i,h*p);return p=t.utils.svgPaths.point(i,h*p),t.utils.svgPaths.curve("c",[t.utils.svgPaths.point(0,h*d),t.utils.svgPaths.point(-i,u*f),g])+t.utils.svgPaths.curve("s",[t.utils.svgPaths.point(i,2.5*u),p])}var i=this.TAB_WIDTH,s=this.TAB_HEIGHT,r=e(!0),o=e(!1);return{type:this.SHAPES.PUZZLE,width:i,height:s,pathDown:o,pathUp:r}},t.blockRendering.ConstantProvider.prototype.makeNotch=function(){function e(u){return t.utils.svgPaths.line([t.utils.svgPaths.point(u*r,s),t.utils.svgPaths.point(3*u,0),t.utils.svgPaths.point(u*r,-s)])}var i=this.NOTCH_WIDTH,s=this.NOTCH_HEIGHT,r=(i-3)/2,o=e(1),h=e(-1);return{type:this.SHAPES.NOTCH,width:i,height:s,pathLeft:o,pathRight:h}},t.blockRendering.ConstantProvider.prototype.makeInsideCorners=function(){var e=this.CORNER_RADIUS,i=t.utils.svgPaths.arc("a","0 0,0",e,t.utils.svgPaths.point(-e,e)),s=t.utils.svgPaths.arc("a","0 0,0",e,t.utils.svgPaths.point(e,e));return{width:e,height:e,pathTop:i,pathBottom:s}},t.blockRendering.ConstantProvider.prototype.makeOutsideCorners=function(){var e=this.CORNER_RADIUS,i=t.utils.svgPaths.moveBy(0,e)+t.utils.svgPaths.arc("a","0 0,1",e,t.utils.svgPaths.point(e,-e)),s=t.utils.svgPaths.arc("a","0 0,1",e,t.utils.svgPaths.point(e,e)),r=t.utils.svgPaths.arc("a","0 0,1",e,t.utils.svgPaths.point(-e,-e)),o=t.utils.svgPaths.arc("a","0 0,1",e,t.utils.svgPaths.point(-e,e));return{topLeft:i,topRight:s,bottomRight:o,bottomLeft:r,rightHeight:e}},t.blockRendering.ConstantProvider.prototype.shapeFor=function(e){switch(e.type){case t.connectionTypes.INPUT_VALUE:case t.connectionTypes.OUTPUT_VALUE:return this.PUZZLE_TAB;case t.connectionTypes.PREVIOUS_STATEMENT:case t.connectionTypes.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown connection type")}},t.blockRendering.ConstantProvider.prototype.createDom=function(e,i,s){this.injectCSS_(i,s),e=t.utils.dom.createSvgElement(t.utils.Svg.DEFS,{},e),i=t.utils.dom.createSvgElement(t.utils.Svg.FILTER,{id:"blocklyEmbossFilter"+this.randomIdentifier},e),t.utils.dom.createSvgElement(t.utils.Svg.FEGAUSSIANBLUR,{in:"SourceAlpha",stdDeviation:1,result:"blur"},i),s=t.utils.dom.createSvgElement(t.utils.Svg.FESPECULARLIGHTING,{in:"blur",surfaceScale:1,specularConstant:.5,specularExponent:10,"lighting-color":"white",result:"specOut"},i),t.utils.dom.createSvgElement(t.utils.Svg.FEPOINTLIGHT,{x:-5e3,y:-1e4,z:2e4},s),t.utils.dom.createSvgElement(t.utils.Svg.FECOMPOSITE,{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"},i),t.utils.dom.createSvgElement(t.utils.Svg.FECOMPOSITE,{in:"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:0,k2:1,k3:1,k4:0},i),this.embossFilterId=i.id,this.embossFilter_=i,i=t.utils.dom.createSvgElement(t.utils.Svg.PATTERN,{id:"blocklyDisabledPattern"+this.randomIdentifier,patternUnits:"userSpaceOnUse",width:10,height:10},e),t.utils.dom.createSvgElement(t.utils.Svg.RECT,{width:10,height:10,fill:"#aaa"},i),t.utils.dom.createSvgElement(t.utils.Svg.PATH,{d:"M 0 0 L 10 10 M 10 0 L 0 10",stroke:"#cc0"},i),this.disabledPatternId=i.id,this.disabledPattern_=i,t.blockRendering.Debug&&(e=t.utils.dom.createSvgElement(t.utils.Svg.FILTER,{id:"blocklyDebugFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e),i=t.utils.dom.createSvgElement(t.utils.Svg.FECOMPONENTTRANSFER,{result:"outBlur"},e),t.utils.dom.createSvgElement(t.utils.Svg.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},i),t.utils.dom.createSvgElement(t.utils.Svg.FEFLOOD,{"flood-color":"#ff0000","flood-opacity":.5,result:"outColor"},e),t.utils.dom.createSvgElement(t.utils.Svg.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},e),this.debugFilterId=e.id,this.debugFilter_=e)},t.blockRendering.ConstantProvider.prototype.injectCSS_=function(e,i){i=this.getCSS_(i),e="blockly-renderer-style-"+e,this.cssNode_=document.getElementById(e);var s=i.join(`
`);this.cssNode_?this.cssNode_.firstChild.textContent=s:(i=document.createElement("style"),i.id=e,e=document.createTextNode(s),i.appendChild(e),document.head.insertBefore(i,document.head.firstChild),this.cssNode_=i)},t.blockRendering.ConstantProvider.prototype.getCSS_=function(e){return[e+" .blocklyText, ",e+" .blocklyFlyoutLabelText {","font: "+this.FIELD_TEXT_FONTWEIGHT+" "+this.FIELD_TEXT_FONTSIZE+"pt "+this.FIELD_TEXT_FONTFAMILY+";","}",e+" .blocklyText {","fill: #fff;","}",e+" .blocklyNonEditableText>rect,",e+" .blocklyEditableText>rect {","fill: "+this.FIELD_BORDER_RECT_COLOUR+";","fill-opacity: .6;","stroke: none;","}",e+" .blocklyNonEditableText>text,",e+" .blocklyEditableText>text {","fill: #000;","}",e+" .blocklyFlyoutLabelText {","fill: #000;","}",e+" .blocklyText.blocklyBubbleText {","fill: #000;","}",e+" .blocklyEditableText:not(.editing):hover>rect {","stroke: #fff;","stroke-width: 2;","}",e+" .blocklyHtmlInput {","font-family: "+this.FIELD_TEXT_FONTFAMILY+";","font-weight: "+this.FIELD_TEXT_FONTWEIGHT+";","}",e+" .blocklySelected>.blocklyPath {","stroke: #fc3;","stroke-width: 3px;","}",e+" .blocklyHighlightedConnectionPath {","stroke: #fc3;","}",e+" .blocklyReplaceable .blocklyPath {","fill-opacity: .5;","}",e+" .blocklyReplaceable .blocklyPathLight,",e+" .blocklyReplaceable .blocklyPathDark {","display: none;","}",e+" .blocklyInsertionMarker>.blocklyPath {","fill-opacity: "+this.INSERTION_MARKER_OPACITY+";","stroke: none;","}"]},t.blockRendering.Types={NONE:0,FIELD:1,HAT:2,ICON:4,SPACER:8,BETWEEN_ROW_SPACER:16,IN_ROW_SPACER:32,EXTERNAL_VALUE_INPUT:64,INPUT:128,INLINE_INPUT:256,STATEMENT_INPUT:512,CONNECTION:1024,PREVIOUS_CONNECTION:2048,NEXT_CONNECTION:4096,OUTPUT_CONNECTION:8192,CORNER:16384,LEFT_SQUARE_CORNER:32768,LEFT_ROUND_CORNER:65536,RIGHT_SQUARE_CORNER:131072,RIGHT_ROUND_CORNER:262144,JAGGED_EDGE:524288,ROW:1048576,TOP_ROW:2097152,BOTTOM_ROW:4194304,INPUT_ROW:8388608},t.blockRendering.Types.LEFT_CORNER=t.blockRendering.Types.LEFT_SQUARE_CORNER|t.blockRendering.Types.LEFT_ROUND_CORNER,t.blockRendering.Types.RIGHT_CORNER=t.blockRendering.Types.RIGHT_SQUARE_CORNER|t.blockRendering.Types.RIGHT_ROUND_CORNER,t.blockRendering.Types.nextTypeValue_=16777216,t.blockRendering.Types.getType=function(e){return Object.prototype.hasOwnProperty.call(t.blockRendering.Types,e)||(t.blockRendering.Types[e]=t.blockRendering.Types.nextTypeValue_,t.blockRendering.Types.nextTypeValue_<<=1),t.blockRendering.Types[e]},t.blockRendering.Types.isField=function(e){return e.type&t.blockRendering.Types.FIELD},t.blockRendering.Types.isHat=function(e){return e.type&t.blockRendering.Types.HAT},t.blockRendering.Types.isIcon=function(e){return e.type&t.blockRendering.Types.ICON},t.blockRendering.Types.isSpacer=function(e){return e.type&t.blockRendering.Types.SPACER},t.blockRendering.Types.isInRowSpacer=function(e){return e.type&t.blockRendering.Types.IN_ROW_SPACER},t.blockRendering.Types.isInput=function(e){return e.type&t.blockRendering.Types.INPUT},t.blockRendering.Types.isExternalInput=function(e){return e.type&t.blockRendering.Types.EXTERNAL_VALUE_INPUT},t.blockRendering.Types.isInlineInput=function(e){return e.type&t.blockRendering.Types.INLINE_INPUT},t.blockRendering.Types.isStatementInput=function(e){return e.type&t.blockRendering.Types.STATEMENT_INPUT},t.blockRendering.Types.isPreviousConnection=function(e){return e.type&t.blockRendering.Types.PREVIOUS_CONNECTION},t.blockRendering.Types.isNextConnection=function(e){return e.type&t.blockRendering.Types.NEXT_CONNECTION},t.blockRendering.Types.isPreviousOrNextConnection=function(e){return e.type&(t.blockRendering.Types.PREVIOUS_CONNECTION|t.blockRendering.Types.NEXT_CONNECTION)},t.blockRendering.Types.isLeftRoundedCorner=function(e){return e.type&t.blockRendering.Types.LEFT_ROUND_CORNER},t.blockRendering.Types.isRightRoundedCorner=function(e){return e.type&t.blockRendering.Types.RIGHT_ROUND_CORNER},t.blockRendering.Types.isLeftSquareCorner=function(e){return e.type&t.blockRendering.Types.LEFT_SQUARE_CORNER},t.blockRendering.Types.isRightSquareCorner=function(e){return e.type&t.blockRendering.Types.RIGHT_SQUARE_CORNER},t.blockRendering.Types.isCorner=function(e){return e.type&t.blockRendering.Types.CORNER},t.blockRendering.Types.isJaggedEdge=function(e){return e.type&t.blockRendering.Types.JAGGED_EDGE},t.blockRendering.Types.isRow=function(e){return e.type&t.blockRendering.Types.ROW},t.blockRendering.Types.isBetweenRowSpacer=function(e){return e.type&t.blockRendering.Types.BETWEEN_ROW_SPACER},t.blockRendering.Types.isTopRow=function(e){return e.type&t.blockRendering.Types.TOP_ROW},t.blockRendering.Types.isBottomRow=function(e){return e.type&t.blockRendering.Types.BOTTOM_ROW},t.blockRendering.Types.isTopOrBottomRow=function(e){return e.type&(t.blockRendering.Types.TOP_ROW|t.blockRendering.Types.BOTTOM_ROW)},t.blockRendering.Types.isInputRow=function(e){return e.type&t.blockRendering.Types.INPUT_ROW},t.blockRendering.Measurable=function(e){this.height=this.width=0,this.type=t.blockRendering.Types.NONE,this.centerline=this.xPos=0,this.constants_=e,this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT},t.blockRendering.Connection=function(e,i){t.blockRendering.Connection.superClass_.constructor.call(this,e),this.connectionModel=i,this.shape=this.constants_.shapeFor(i),this.isDynamicShape=!!this.shape.isDynamic,this.type|=t.blockRendering.Types.CONNECTION},t.utils.object.inherits(t.blockRendering.Connection,t.blockRendering.Measurable),t.blockRendering.OutputConnection=function(e,i){t.blockRendering.OutputConnection.superClass_.constructor.call(this,e,i),this.type|=t.blockRendering.Types.OUTPUT_CONNECTION,this.height=this.isDynamicShape?0:this.shape.height,this.startX=this.width=this.isDynamicShape?0:this.shape.width,this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP,this.connectionOffsetX=0},t.utils.object.inherits(t.blockRendering.OutputConnection,t.blockRendering.Connection),t.blockRendering.PreviousConnection=function(e,i){t.blockRendering.PreviousConnection.superClass_.constructor.call(this,e,i),this.type|=t.blockRendering.Types.PREVIOUS_CONNECTION,this.height=this.shape.height,this.width=this.shape.width},t.utils.object.inherits(t.blockRendering.PreviousConnection,t.blockRendering.Connection),t.blockRendering.NextConnection=function(e,i){t.blockRendering.NextConnection.superClass_.constructor.call(this,e,i),this.type|=t.blockRendering.Types.NEXT_CONNECTION,this.height=this.shape.height,this.width=this.shape.width},t.utils.object.inherits(t.blockRendering.NextConnection,t.blockRendering.Connection),t.blockRendering.InputConnection=function(e,i){t.blockRendering.InputConnection.superClass_.constructor.call(this,e,i.connection),this.type|=t.blockRendering.Types.INPUT,this.input=i,this.align=i.align,(this.connectedBlock=i.connection&&i.connection.targetBlock()?i.connection.targetBlock():null)?(e=this.connectedBlock.getHeightWidth(),this.connectedBlockWidth=e.width,this.connectedBlockHeight=e.height):this.connectedBlockHeight=this.connectedBlockWidth=0,this.connectionOffsetY=this.connectionOffsetX=0},t.utils.object.inherits(t.blockRendering.InputConnection,t.blockRendering.Connection),t.blockRendering.InlineInput=function(e,i){t.blockRendering.InlineInput.superClass_.constructor.call(this,e,i),this.type|=t.blockRendering.Types.INLINE_INPUT,this.connectedBlock?(this.width=this.connectedBlockWidth,this.height=this.connectedBlockHeight):(this.height=this.constants_.EMPTY_INLINE_INPUT_HEIGHT,this.width=this.constants_.EMPTY_INLINE_INPUT_PADDING),this.connectionHeight=this.isDynamicShape?this.shape.height(this.height):this.shape.height,this.connectionWidth=this.isDynamicShape?this.shape.width(this.height):this.shape.width,this.connectedBlock||(this.width+=this.connectionWidth*(this.isDynamicShape?2:1)),this.connectionOffsetY=this.isDynamicShape?this.shape.connectionOffsetY(this.connectionHeight):this.constants_.TAB_OFFSET_FROM_TOP,this.connectionOffsetX=this.isDynamicShape?this.shape.connectionOffsetX(this.connectionWidth):0},t.utils.object.inherits(t.blockRendering.InlineInput,t.blockRendering.InputConnection),t.blockRendering.StatementInput=function(e,i){t.blockRendering.StatementInput.superClass_.constructor.call(this,e,i),this.type|=t.blockRendering.Types.STATEMENT_INPUT,this.height=this.connectedBlock?this.connectedBlockHeight+this.constants_.STATEMENT_BOTTOM_SPACER:this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT,this.width=this.constants_.STATEMENT_INPUT_NOTCH_OFFSET+this.shape.width},t.utils.object.inherits(t.blockRendering.StatementInput,t.blockRendering.InputConnection),t.blockRendering.ExternalValueInput=function(e,i){t.blockRendering.ExternalValueInput.superClass_.constructor.call(this,e,i),this.type|=t.blockRendering.Types.EXTERNAL_VALUE_INPUT,this.height=this.connectedBlock?this.connectedBlockHeight-this.constants_.TAB_OFFSET_FROM_TOP-this.constants_.MEDIUM_PADDING:this.shape.height,this.width=this.shape.width+this.constants_.EXTERNAL_VALUE_INPUT_PADDING,this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP,this.connectionHeight=this.shape.height,this.connectionWidth=this.shape.width},t.utils.object.inherits(t.blockRendering.ExternalValueInput,t.blockRendering.InputConnection),t.blockRendering.Icon=function(e,i){t.blockRendering.Icon.superClass_.constructor.call(this,e),this.icon=i,this.isVisible=i.isVisible(),this.type|=t.blockRendering.Types.ICON,e=i.getCorrectedSize(),this.height=e.height,this.width=e.width},t.utils.object.inherits(t.blockRendering.Icon,t.blockRendering.Measurable),t.blockRendering.JaggedEdge=function(e){t.blockRendering.JaggedEdge.superClass_.constructor.call(this,e),this.type|=t.blockRendering.Types.JAGGED_EDGE,this.height=this.constants_.JAGGED_TEETH.height,this.width=this.constants_.JAGGED_TEETH.width},t.utils.object.inherits(t.blockRendering.JaggedEdge,t.blockRendering.Measurable),t.blockRendering.Field=function(e,i,s){t.blockRendering.Field.superClass_.constructor.call(this,e),this.field=i,this.isEditable=i.EDITABLE,this.flipRtl=i.getFlipRtl(),this.type|=t.blockRendering.Types.FIELD,e=this.field.getSize(),this.height=e.height,this.width=e.width,this.parentInput=s},t.utils.object.inherits(t.blockRendering.Field,t.blockRendering.Measurable),t.blockRendering.Hat=function(e){t.blockRendering.Hat.superClass_.constructor.call(this,e),this.type|=t.blockRendering.Types.HAT,this.height=this.constants_.START_HAT.height,this.width=this.constants_.START_HAT.width,this.ascenderHeight=this.height},t.utils.object.inherits(t.blockRendering.Hat,t.blockRendering.Measurable),t.blockRendering.SquareCorner=function(e,i){t.blockRendering.SquareCorner.superClass_.constructor.call(this,e),this.type=(i&&i!="left"?t.blockRendering.Types.RIGHT_SQUARE_CORNER:t.blockRendering.Types.LEFT_SQUARE_CORNER)|t.blockRendering.Types.CORNER,this.width=this.height=this.constants_.NO_PADDING},t.utils.object.inherits(t.blockRendering.SquareCorner,t.blockRendering.Measurable),t.blockRendering.RoundCorner=function(e,i){t.blockRendering.RoundCorner.superClass_.constructor.call(this,e),this.type=(i&&i!="left"?t.blockRendering.Types.RIGHT_ROUND_CORNER:t.blockRendering.Types.LEFT_ROUND_CORNER)|t.blockRendering.Types.CORNER,this.width=this.constants_.CORNER_RADIUS,this.height=this.constants_.CORNER_RADIUS/2},t.utils.object.inherits(t.blockRendering.RoundCorner,t.blockRendering.Measurable),t.blockRendering.InRowSpacer=function(e,i){t.blockRendering.InRowSpacer.superClass_.constructor.call(this,e),this.type=this.type|t.blockRendering.Types.SPACER|t.blockRendering.Types.IN_ROW_SPACER,this.width=i,this.height=this.constants_.SPACER_DEFAULT_HEIGHT},t.utils.object.inherits(t.blockRendering.InRowSpacer,t.blockRendering.Measurable),t.blockRendering.Row=function(e){this.type=t.blockRendering.Types.ROW,this.elements=[],this.xPos=this.yPos=this.widthWithConnectedBlocks=this.minWidth=this.minHeight=this.width=this.height=0,this.hasJaggedEdge=this.hasDummyInput=this.hasInlineInput=this.hasStatement=this.hasExternalInput=!1,this.constants_=e,this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT,this.align=null},t.blockRendering.Row.prototype.measure=function(){throw Error("Unexpected attempt to measure a base Row.")},t.blockRendering.Row.prototype.getLastInput=function(){for(var e=this.elements.length-1,i;i=this.elements[e];e--)if(t.blockRendering.Types.isInput(i))return i;return null},t.blockRendering.Row.prototype.startsWithElemSpacer=function(){return!0},t.blockRendering.Row.prototype.endsWithElemSpacer=function(){return!0},t.blockRendering.Row.prototype.getFirstSpacer=function(){for(var e=0,i;i=this.elements[e];e++)if(t.blockRendering.Types.isSpacer(i))return i;return null},t.blockRendering.Row.prototype.getLastSpacer=function(){for(var e=this.elements.length-1,i;i=this.elements[e];e--)if(t.blockRendering.Types.isSpacer(i))return i;return null},t.blockRendering.TopRow=function(e){t.blockRendering.TopRow.superClass_.constructor.call(this,e),this.type|=t.blockRendering.Types.TOP_ROW,this.ascenderHeight=this.capline=0,this.hasPreviousConnection=!1,this.connection=null},t.utils.object.inherits(t.blockRendering.TopRow,t.blockRendering.Row),t.blockRendering.TopRow.prototype.hasLeftSquareCorner=function(e){var i=(e.hat?e.hat==="cap":this.constants_.ADD_START_HATS)&&!e.outputConnection&&!e.previousConnection,s=e.getPreviousBlock();return!!e.outputConnection||i||(s?s.getNextBlock()==e:!1)},t.blockRendering.TopRow.prototype.hasRightSquareCorner=function(e){return!0},t.blockRendering.TopRow.prototype.measure=function(){for(var e=0,i=0,s=0,r=0,o;o=this.elements[r];r++)i+=o.width,t.blockRendering.Types.isSpacer(o)||(t.blockRendering.Types.isHat(o)?s=Math.max(s,o.ascenderHeight):e=Math.max(e,o.height));this.width=Math.max(this.minWidth,i),this.height=Math.max(this.minHeight,e)+s,this.capline=this.ascenderHeight=s,this.widthWithConnectedBlocks=this.width},t.blockRendering.TopRow.prototype.startsWithElemSpacer=function(){return!1},t.blockRendering.TopRow.prototype.endsWithElemSpacer=function(){return!1},t.blockRendering.BottomRow=function(e){t.blockRendering.BottomRow.superClass_.constructor.call(this,e),this.type|=t.blockRendering.Types.BOTTOM_ROW,this.hasNextConnection=!1,this.connection=null,this.baseline=this.descenderHeight=0},t.utils.object.inherits(t.blockRendering.BottomRow,t.blockRendering.Row),t.blockRendering.BottomRow.prototype.hasLeftSquareCorner=function(e){return!!e.outputConnection||!!e.getNextBlock()},t.blockRendering.BottomRow.prototype.hasRightSquareCorner=function(e){return!0},t.blockRendering.BottomRow.prototype.measure=function(){for(var e=0,i=0,s=0,r=0,o;o=this.elements[r];r++)i+=o.width,t.blockRendering.Types.isSpacer(o)||(t.blockRendering.Types.isNextConnection(o)?s=Math.max(s,o.height):e=Math.max(e,o.height));this.width=Math.max(this.minWidth,i),this.height=Math.max(this.minHeight,e)+s,this.descenderHeight=s,this.widthWithConnectedBlocks=this.width},t.blockRendering.BottomRow.prototype.startsWithElemSpacer=function(){return!1},t.blockRendering.BottomRow.prototype.endsWithElemSpacer=function(){return!1},t.blockRendering.SpacerRow=function(e,i,s){t.blockRendering.SpacerRow.superClass_.constructor.call(this,e),this.type=this.type|t.blockRendering.Types.SPACER|t.blockRendering.Types.BETWEEN_ROW_SPACER,this.width=s,this.height=i,this.followsStatement=!1,this.widthWithConnectedBlocks=0,this.elements=[new t.blockRendering.InRowSpacer(this.constants_,s)]},t.utils.object.inherits(t.blockRendering.SpacerRow,t.blockRendering.Row),t.blockRendering.SpacerRow.prototype.measure=function(){},t.blockRendering.InputRow=function(e){t.blockRendering.InputRow.superClass_.constructor.call(this,e),this.type|=t.blockRendering.Types.INPUT_ROW,this.connectedBlockWidths=0},t.utils.object.inherits(t.blockRendering.InputRow,t.blockRendering.Row),t.blockRendering.InputRow.prototype.measure=function(){this.width=this.minWidth,this.height=this.minHeight;for(var e=0,i=0,s;s=this.elements[i];i++)this.width+=s.width,t.blockRendering.Types.isInput(s)&&(t.blockRendering.Types.isStatementInput(s)?e+=s.connectedBlockWidth:t.blockRendering.Types.isExternalInput(s)&&s.connectedBlockWidth!=0&&(e+=s.connectedBlockWidth-s.connectionWidth)),t.blockRendering.Types.isSpacer(s)||(this.height=Math.max(this.height,s.height));this.connectedBlockWidths=e,this.widthWithConnectedBlocks=this.width+e},t.blockRendering.InputRow.prototype.endsWithElemSpacer=function(){return!this.hasExternalInput&&!this.hasStatement},t.blockRendering.RenderInfo=function(e,i){this.block_=i,this.renderer_=e,this.constants_=this.renderer_.getConstants(),this.outputConnection=i.outputConnection?new t.blockRendering.OutputConnection(this.constants_,i.outputConnection):null,this.isInline=i.getInputsInline()&&!i.isCollapsed(),this.isCollapsed=i.isCollapsed(),this.isInsertionMarker=i.isInsertionMarker(),this.RTL=i.RTL,this.statementEdge=this.width=this.widthWithChildren=this.height=0,this.rows=[],this.inputRows=[],this.hiddenIcons=[],this.topRow=new t.blockRendering.TopRow(this.constants_),this.bottomRow=new t.blockRendering.BottomRow(this.constants_),this.startY=this.startX=0},t.blockRendering.RenderInfo.prototype.getRenderer=function(){return this.renderer_},t.blockRendering.RenderInfo.prototype.measure=function(){this.createRows_(),this.addElemSpacing_(),this.addRowSpacing_(),this.computeBounds_(),this.alignRowElements_(),this.finalize_()},t.blockRendering.RenderInfo.prototype.createRows_=function(){this.populateTopRow_(),this.rows.push(this.topRow);var e=new t.blockRendering.InputRow(this.constants_);this.inputRows.push(e);var i=this.block_.getIcons();if(i.length)for(var s=0,r;r=i[s];s++){var o=new t.blockRendering.Icon(this.constants_,r);this.isCollapsed&&r.collapseHidden?this.hiddenIcons.push(o):e.elements.push(o)}for(r=null,s=0;i=this.block_.inputList[s];s++)if(i.isVisible()){for(this.shouldStartNewRow_(i,r)&&(this.rows.push(e),e=new t.blockRendering.InputRow(this.constants_),this.inputRows.push(e)),r=0;o=i.fieldRow[r];r++)e.elements.push(new t.blockRendering.Field(this.constants_,o,i));this.addInput_(i,e),r=i}this.isCollapsed&&(e.hasJaggedEdge=!0,e.elements.push(new t.blockRendering.JaggedEdge(this.constants_))),(e.elements.length||e.hasDummyInput)&&this.rows.push(e),this.populateBottomRow_(),this.rows.push(this.bottomRow)},t.blockRendering.RenderInfo.prototype.populateTopRow_=function(){var e=!!this.block_.previousConnection,i=(this.block_.hat?this.block_.hat==="cap":this.constants_.ADD_START_HATS)&&!this.outputConnection&&!e;this.topRow.hasLeftSquareCorner(this.block_)?this.topRow.elements.push(new t.blockRendering.SquareCorner(this.constants_)):this.topRow.elements.push(new t.blockRendering.RoundCorner(this.constants_)),i?(e=new t.blockRendering.Hat(this.constants_),this.topRow.elements.push(e),this.topRow.capline=e.ascenderHeight):e&&(this.topRow.hasPreviousConnection=!0,this.topRow.connection=new t.blockRendering.PreviousConnection(this.constants_,this.block_.previousConnection),this.topRow.elements.push(this.topRow.connection)),this.block_.inputList.length&&this.block_.inputList[0].type==t.inputTypes.STATEMENT&&!this.block_.isCollapsed()?this.topRow.minHeight=this.constants_.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT:this.topRow.minHeight=this.constants_.TOP_ROW_MIN_HEIGHT,this.topRow.hasRightSquareCorner(this.block_)?this.topRow.elements.push(new t.blockRendering.SquareCorner(this.constants_,"right")):this.topRow.elements.push(new t.blockRendering.RoundCorner(this.constants_,"right"))},t.blockRendering.RenderInfo.prototype.populateBottomRow_=function(){this.bottomRow.hasNextConnection=!!this.block_.nextConnection,this.bottomRow.minHeight=this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1].type==t.inputTypes.STATEMENT?this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT:this.constants_.BOTTOM_ROW_MIN_HEIGHT,this.bottomRow.hasLeftSquareCorner(this.block_)?this.bottomRow.elements.push(new t.blockRendering.SquareCorner(this.constants_)):this.bottomRow.elements.push(new t.blockRendering.RoundCorner(this.constants_)),this.bottomRow.hasNextConnection&&(this.bottomRow.connection=new t.blockRendering.NextConnection(this.constants_,this.block_.nextConnection),this.bottomRow.elements.push(this.bottomRow.connection)),this.bottomRow.hasRightSquareCorner(this.block_)?this.bottomRow.elements.push(new t.blockRendering.SquareCorner(this.constants_,"right")):this.bottomRow.elements.push(new t.blockRendering.RoundCorner(this.constants_,"right"))},t.blockRendering.RenderInfo.prototype.addInput_=function(e,i){this.isInline&&e.type==t.inputTypes.VALUE?(i.elements.push(new t.blockRendering.InlineInput(this.constants_,e)),i.hasInlineInput=!0):e.type==t.inputTypes.STATEMENT?(i.elements.push(new t.blockRendering.StatementInput(this.constants_,e)),i.hasStatement=!0):e.type==t.inputTypes.VALUE?(i.elements.push(new t.blockRendering.ExternalValueInput(this.constants_,e)),i.hasExternalInput=!0):e.type==t.inputTypes.DUMMY&&(i.minHeight=Math.max(i.minHeight,e.getSourceBlock()&&e.getSourceBlock().isShadow()?this.constants_.DUMMY_INPUT_SHADOW_MIN_HEIGHT:this.constants_.DUMMY_INPUT_MIN_HEIGHT),i.hasDummyInput=!0),i.align==null&&(i.align=e.align)},t.blockRendering.RenderInfo.prototype.shouldStartNewRow_=function(e,i){return i?e.type==t.inputTypes.STATEMENT||i.type==t.inputTypes.STATEMENT?!0:e.type==t.inputTypes.VALUE||e.type==t.inputTypes.DUMMY?!this.isInline:!1:!1},t.blockRendering.RenderInfo.prototype.addElemSpacing_=function(){for(var e=0,i;i=this.rows[e];e++){var s=i.elements;if(i.elements=[],i.startsWithElemSpacer()&&i.elements.push(new t.blockRendering.InRowSpacer(this.constants_,this.getInRowSpacing_(null,s[0]))),s.length){for(var r=0;r<s.length-1;r++){i.elements.push(s[r]);var o=this.getInRowSpacing_(s[r],s[r+1]);i.elements.push(new t.blockRendering.InRowSpacer(this.constants_,o))}i.elements.push(s[s.length-1]),i.endsWithElemSpacer()&&i.elements.push(new t.blockRendering.InRowSpacer(this.constants_,this.getInRowSpacing_(s[s.length-1],null)))}}},t.blockRendering.RenderInfo.prototype.getInRowSpacing_=function(e,i){if(!e&&i&&t.blockRendering.Types.isStatementInput(i))return this.constants_.STATEMENT_INPUT_PADDING_LEFT;if(e&&t.blockRendering.Types.isInput(e)&&!i){if(t.blockRendering.Types.isExternalInput(e))return this.constants_.NO_PADDING;if(t.blockRendering.Types.isInlineInput(e))return this.constants_.LARGE_PADDING;if(t.blockRendering.Types.isStatementInput(e))return this.constants_.NO_PADDING}return e&&t.blockRendering.Types.isLeftSquareCorner(e)&&i&&(t.blockRendering.Types.isPreviousConnection(i)||t.blockRendering.Types.isNextConnection(i))?i.notchOffset:e&&t.blockRendering.Types.isLeftRoundedCorner(e)&&i&&(t.blockRendering.Types.isPreviousConnection(i)||t.blockRendering.Types.isNextConnection(i))?i.notchOffset-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING},t.blockRendering.RenderInfo.prototype.computeBounds_=function(){for(var e=0,i=0,s=0,r=0,o;o=this.rows[r];r++){if(o.measure(),i=Math.max(i,o.width),o.hasStatement){var h=o.getLastInput();e=Math.max(e,o.width-h.width)}s=Math.max(s,o.widthWithConnectedBlocks)}for(this.statementEdge=e,this.width=i,r=0;o=this.rows[r];r++)o.hasStatement&&(o.statementEdge=this.statementEdge);this.widthWithChildren=Math.max(i,s),this.outputConnection&&(this.startX=this.outputConnection.width,this.width+=this.outputConnection.width,this.widthWithChildren+=this.outputConnection.width)},t.blockRendering.RenderInfo.prototype.alignRowElements_=function(){for(var e=0,i;i=this.rows[e];e++)if(i.hasStatement)this.alignStatementRow_(i);else{var s=i.width;s=this.getDesiredRowWidth_(i)-s,0<s&&this.addAlignmentPadding_(i,s),t.blockRendering.Types.isTopOrBottomRow(i)&&(i.widthWithConnectedBlocks=i.width)}},t.blockRendering.RenderInfo.prototype.getDesiredRowWidth_=function(e){return this.width-this.startX},t.blockRendering.RenderInfo.prototype.addAlignmentPadding_=function(e,i){var s=e.getFirstSpacer(),r=e.getLastSpacer();(e.hasExternalInput||e.hasStatement)&&(e.widthWithConnectedBlocks+=i),e.align==t.constants.ALIGN.LEFT?r.width+=i:e.align==t.constants.ALIGN.CENTRE?(s.width+=i/2,r.width+=i/2):e.align==t.constants.ALIGN.RIGHT?s.width+=i:r.width+=i,e.width+=i},t.blockRendering.RenderInfo.prototype.alignStatementRow_=function(e){var i=e.getLastInput(),s=e.width-i.width,r=this.statementEdge;s=r-s,0<s&&this.addAlignmentPadding_(e,s),s=e.width,r=this.getDesiredRowWidth_(e),i.width+=r-s,i.height=Math.max(i.height,e.height),e.width+=r-s,e.widthWithConnectedBlocks=Math.max(e.width,this.statementEdge+e.connectedBlockWidths)},t.blockRendering.RenderInfo.prototype.addRowSpacing_=function(){var e=this.rows;this.rows=[];for(var i=0;i<e.length;i++)this.rows.push(e[i]),i!=e.length-1&&this.rows.push(this.makeSpacerRow_(e[i],e[i+1]))},t.blockRendering.RenderInfo.prototype.makeSpacerRow_=function(e,i){var s=this.getSpacerRowHeight_(e,i),r=this.getSpacerRowWidth_(e,i);return s=new t.blockRendering.SpacerRow(this.constants_,s,r),e.hasStatement&&(s.followsStatement=!0),i.hasStatement&&(s.precedesStatement=!0),s},t.blockRendering.RenderInfo.prototype.getSpacerRowWidth_=function(e,i){return this.width-this.startX},t.blockRendering.RenderInfo.prototype.getSpacerRowHeight_=function(e,i){return this.constants_.MEDIUM_PADDING},t.blockRendering.RenderInfo.prototype.getElemCenterline_=function(e,i){return t.blockRendering.Types.isSpacer(i)?e.yPos+i.height/2:t.blockRendering.Types.isBottomRow(e)?(e=e.yPos+e.height-e.descenderHeight,t.blockRendering.Types.isNextConnection(i)?e+i.height/2:e-i.height/2):t.blockRendering.Types.isTopRow(e)?t.blockRendering.Types.isHat(i)?e.capline-i.height/2:e.capline+i.height/2:e.yPos+e.height/2},t.blockRendering.RenderInfo.prototype.recordElemPositions_=function(e){for(var i=e.xPos,s=0,r;r=e.elements[s];s++)t.blockRendering.Types.isSpacer(r)&&(r.height=e.height),r.xPos=i,r.centerline=this.getElemCenterline_(e,r),i+=r.width},t.blockRendering.RenderInfo.prototype.finalize_=function(){for(var e=0,i=0,s=0,r;r=this.rows[s];s++)r.yPos=i,r.xPos=this.startX,i+=r.height,e=Math.max(e,r.widthWithConnectedBlocks),this.recordElemPositions_(r);this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(e=Math.max(e,this.block_.nextConnection.targetBlock().getHeightWidth().width)),this.widthWithChildren=e+this.startX,this.height=i,this.startY=this.topRow.capline,this.bottomRow.baseline=i-this.bottomRow.descenderHeight},t.blockRendering.Debug=function(e){this.debugElements_=[],this.svgRoot_=null,this.constants_=e},t.blockRendering.Debug.config={rowSpacers:!0,elemSpacers:!0,rows:!0,elems:!0,connections:!0,blockBounds:!0,connectedBlockBounds:!0,render:!0},t.blockRendering.Debug.prototype.clearElems=function(){for(var e=0,i;i=this.debugElements_[e];e++)t.utils.dom.removeNode(i);this.debugElements_=[]},t.blockRendering.Debug.prototype.drawSpacerRow=function(e,i,s){if(t.blockRendering.Debug.config.rowSpacers){var r=Math.abs(e.height),o=0>e.height;o&&(i-=r),this.debugElements_.push(t.utils.dom.createSvgElement(t.utils.Svg.RECT,{class:"rowSpacerRect blockRenderDebug",x:s?-(e.xPos+e.width):e.xPos,y:i,width:e.width,height:r,stroke:o?"black":"blue",fill:"blue","fill-opacity":"0.5","stroke-width":"1px"},this.svgRoot_))}},t.blockRendering.Debug.prototype.drawSpacerElem=function(e,i,s){if(t.blockRendering.Debug.config.elemSpacers){i=Math.abs(e.width);var r=0>e.width,o=r?e.xPos-i:e.xPos;s&&(o=-(o+i)),this.debugElements_.push(t.utils.dom.createSvgElement(t.utils.Svg.RECT,{class:"elemSpacerRect blockRenderDebug",x:o,y:e.centerline-e.height/2,width:i,height:e.height,stroke:"pink",fill:r?"black":"pink","fill-opacity":"0.5","stroke-width":"1px"},this.svgRoot_))}},t.blockRendering.Debug.prototype.drawRenderedElem=function(e,i){if(t.blockRendering.Debug.config.elems){var s=e.xPos;i&&(s=-(s+e.width)),i=e.centerline-e.height/2,this.debugElements_.push(t.utils.dom.createSvgElement(t.utils.Svg.RECT,{class:"rowRenderingRect blockRenderDebug",x:s,y:i,width:e.width,height:e.height,stroke:"black",fill:"none","stroke-width":"1px"},this.svgRoot_)),t.blockRendering.Types.isField(e)&&e.field instanceof t.FieldLabel&&this.debugElements_.push(t.utils.dom.createSvgElement(t.utils.Svg.RECT,{class:"rowRenderingRect blockRenderDebug",x:s,y:i+this.constants_.FIELD_TEXT_BASELINE,width:e.width,height:"0.1px",stroke:"red",fill:"none","stroke-width":"0.5px"},this.svgRoot_))}t.blockRendering.Types.isInput(e)&&t.blockRendering.Debug.config.connections&&this.drawConnection(e.connectionModel)},t.blockRendering.Debug.prototype.drawConnection=function(e){if(t.blockRendering.Debug.config.connections){if(e.type==t.connectionTypes.INPUT_VALUE)var i=4,s="magenta",r="none";else e.type==t.connectionTypes.OUTPUT_VALUE?(i=2,r=s="magenta"):e.type==t.connectionTypes.NEXT_STATEMENT?(i=4,s="goldenrod",r="none"):e.type==t.connectionTypes.PREVIOUS_STATEMENT&&(i=2,r=s="goldenrod");this.debugElements_.push(t.utils.dom.createSvgElement(t.utils.Svg.CIRCLE,{class:"blockRenderDebug",cx:e.offsetInBlock_.x,cy:e.offsetInBlock_.y,r:i,fill:r,stroke:s},this.svgRoot_))}},t.blockRendering.Debug.prototype.drawRenderedRow=function(e,i,s){t.blockRendering.Debug.config.rows&&(this.debugElements_.push(t.utils.dom.createSvgElement(t.utils.Svg.RECT,{class:"elemRenderingRect blockRenderDebug",x:s?-(e.xPos+e.width):e.xPos,y:e.yPos,width:e.width,height:e.height,stroke:"red",fill:"none","stroke-width":"1px"},this.svgRoot_)),t.blockRendering.Types.isTopOrBottomRow(e)||t.blockRendering.Debug.config.connectedBlockBounds&&this.debugElements_.push(t.utils.dom.createSvgElement(t.utils.Svg.RECT,{class:"connectedBlockWidth blockRenderDebug",x:s?-(e.xPos+e.widthWithConnectedBlocks):e.xPos,y:e.yPos,width:e.widthWithConnectedBlocks,height:e.height,stroke:this.randomColour_,fill:"none","stroke-width":"1px","stroke-dasharray":"3,3"},this.svgRoot_)))},t.blockRendering.Debug.prototype.drawRowWithElements=function(e,i,s){for(var r=0,o=e.elements.length;r<o;r++){var h=e.elements[r];h?t.blockRendering.Types.isSpacer(h)?this.drawSpacerElem(h,e.height,s):this.drawRenderedElem(h,s):console.warn("A row has an undefined or null element.",e,h)}this.drawRenderedRow(e,i,s)},t.blockRendering.Debug.prototype.drawBoundingBox=function(e){if(t.blockRendering.Debug.config.blockBounds){var i=e.RTL?-e.width:0;this.debugElements_.push(t.utils.dom.createSvgElement(t.utils.Svg.RECT,{class:"blockBoundingBox blockRenderDebug",x:i,y:0,width:e.width,height:e.height,stroke:"black",fill:"none","stroke-width":"1px","stroke-dasharray":"5,5"},this.svgRoot_)),t.blockRendering.Debug.config.connectedBlockBounds&&(i=e.RTL?-e.widthWithChildren:0,this.debugElements_.push(t.utils.dom.createSvgElement(t.utils.Svg.RECT,{class:"blockRenderDebug",x:i,y:0,width:e.widthWithChildren,height:e.height,stroke:"#DF57BC",fill:"none","stroke-width":"1px","stroke-dasharray":"3,3"},this.svgRoot_)))}},t.blockRendering.Debug.prototype.drawDebug=function(e,i){this.clearElems(),this.svgRoot_=e.getSvgRoot(),this.randomColour_="#"+Math.floor(16777215*Math.random()).toString(16);for(var s=0,r=0,o;o=i.rows[r];r++)t.blockRendering.Types.isBetweenRowSpacer(o)?this.drawSpacerRow(o,s,i.RTL):this.drawRowWithElements(o,s,i.RTL),s+=o.height;e.previousConnection&&this.drawConnection(e.previousConnection),e.nextConnection&&this.drawConnection(e.nextConnection),e.outputConnection&&this.drawConnection(e.outputConnection),i.rightSide&&this.drawRenderedElem(i.rightSide,i.RTL),this.drawBoundingBox(i),this.drawRender(e.pathObject.svgPath)},t.blockRendering.Debug.prototype.drawRender=function(e){t.blockRendering.Debug.config.render&&(e.setAttribute("filter","url(#"+this.constants_.debugFilterId+")"),setTimeout(function(){e.setAttribute("filter","")},100))},t.blockRendering.Drawer=function(e,i){this.block_=e,this.info_=i,this.topLeft_=e.getRelativeToSurfaceXY(),this.inlinePath_=this.outlinePath_="",this.constants_=i.getRenderer().getConstants()},t.blockRendering.Drawer.prototype.draw=function(){this.hideHiddenIcons_(),this.drawOutline_(),this.drawInternals_(),this.block_.pathObject.setPath(this.outlinePath_+`
`+this.inlinePath_),this.info_.RTL&&this.block_.pathObject.flipRTL(),t.blockRendering.useDebugger&&this.block_.renderingDebugger.drawDebug(this.block_,this.info_),this.recordSizeOnBlock_()},t.blockRendering.Drawer.prototype.recordSizeOnBlock_=function(){this.block_.height=this.info_.height,this.block_.width=this.info_.widthWithChildren},t.blockRendering.Drawer.prototype.hideHiddenIcons_=function(){for(var e=0,i;i=this.info_.hiddenIcons[e];e++)i.icon.iconGroup_.setAttribute("display","none")},t.blockRendering.Drawer.prototype.drawOutline_=function(){this.drawTop_();for(var e=1;e<this.info_.rows.length-1;e++){var i=this.info_.rows[e];i.hasJaggedEdge?this.drawJaggedEdge_(i):i.hasStatement?this.drawStatementInput_(i):i.hasExternalInput?this.drawValueInput_(i):this.drawRightSideRow_(i)}this.drawBottom_(),this.drawLeft_()},t.blockRendering.Drawer.prototype.drawTop_=function(){var e=this.info_.topRow,i=e.elements;this.positionPreviousConnection_(),this.outlinePath_+=t.utils.svgPaths.moveBy(e.xPos,this.info_.startY);for(var s=0,r;r=i[s];s++)t.blockRendering.Types.isLeftRoundedCorner(r)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topLeft:t.blockRendering.Types.isRightRoundedCorner(r)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topRight:t.blockRendering.Types.isPreviousConnection(r)?this.outlinePath_+=r.shape.pathLeft:t.blockRendering.Types.isHat(r)?this.outlinePath_+=this.constants_.START_HAT.path:t.blockRendering.Types.isSpacer(r)&&(this.outlinePath_+=t.utils.svgPaths.lineOnAxis("h",r.width));this.outlinePath_+=t.utils.svgPaths.lineOnAxis("v",e.height)},t.blockRendering.Drawer.prototype.drawJaggedEdge_=function(e){this.outlinePath_+=this.constants_.JAGGED_TEETH.path+t.utils.svgPaths.lineOnAxis("v",e.height-this.constants_.JAGGED_TEETH.height)},t.blockRendering.Drawer.prototype.drawValueInput_=function(e){var i=e.getLastInput();this.positionExternalValueConnection_(e);var s=typeof i.shape.pathDown=="function"?i.shape.pathDown(i.height):i.shape.pathDown;this.outlinePath_+=t.utils.svgPaths.lineOnAxis("H",i.xPos+i.width)+s+t.utils.svgPaths.lineOnAxis("v",e.height-i.connectionHeight)},t.blockRendering.Drawer.prototype.drawStatementInput_=function(e){var i=e.getLastInput(),s=i.xPos+i.notchOffset+i.shape.width;i=i.shape.pathRight+t.utils.svgPaths.lineOnAxis("h",-(i.notchOffset-this.constants_.INSIDE_CORNERS.width))+this.constants_.INSIDE_CORNERS.pathTop;var r=e.height-2*this.constants_.INSIDE_CORNERS.height;this.outlinePath_+=t.utils.svgPaths.lineOnAxis("H",s)+i+t.utils.svgPaths.lineOnAxis("v",r)+this.constants_.INSIDE_CORNERS.pathBottom+t.utils.svgPaths.lineOnAxis("H",e.xPos+e.width),this.positionStatementInputConnection_(e)},t.blockRendering.Drawer.prototype.drawRightSideRow_=function(e){this.outlinePath_+=t.utils.svgPaths.lineOnAxis("V",e.yPos+e.height)},t.blockRendering.Drawer.prototype.drawBottom_=function(){var e=this.info_.bottomRow,i=e.elements;this.positionNextConnection_();for(var s=0,r="",o=i.length-1,h;h=i[o];o--)t.blockRendering.Types.isNextConnection(h)?r+=h.shape.pathRight:t.blockRendering.Types.isLeftSquareCorner(h)?r+=t.utils.svgPaths.lineOnAxis("H",e.xPos):t.blockRendering.Types.isLeftRoundedCorner(h)?r+=this.constants_.OUTSIDE_CORNERS.bottomLeft:t.blockRendering.Types.isRightRoundedCorner(h)?(r+=this.constants_.OUTSIDE_CORNERS.bottomRight,s=this.constants_.OUTSIDE_CORNERS.rightHeight):t.blockRendering.Types.isSpacer(h)&&(r+=t.utils.svgPaths.lineOnAxis("h",-1*h.width));this.outlinePath_+=t.utils.svgPaths.lineOnAxis("V",e.baseline-s),this.outlinePath_+=r},t.blockRendering.Drawer.prototype.drawLeft_=function(){var e=this.info_.outputConnection;if(this.positionOutputConnection_(),e){var i=e.connectionOffsetY+e.height;e=typeof e.shape.pathUp=="function"?e.shape.pathUp(e.height):e.shape.pathUp,this.outlinePath_+=t.utils.svgPaths.lineOnAxis("V",i)+e}this.outlinePath_+="z"},t.blockRendering.Drawer.prototype.drawInternals_=function(){for(var e=0,i;i=this.info_.rows[e];e++)for(var s=0,r;r=i.elements[s];s++)t.blockRendering.Types.isInlineInput(r)?this.drawInlineInput_(r):(t.blockRendering.Types.isIcon(r)||t.blockRendering.Types.isField(r))&&this.layoutField_(r)},t.blockRendering.Drawer.prototype.layoutField_=function(e){if(t.blockRendering.Types.isField(e))var i=e.field.getSvgRoot();else t.blockRendering.Types.isIcon(e)&&(i=e.icon.iconGroup_);var s=e.centerline-e.height/2,r=e.xPos,o="";this.info_.RTL&&(r=-(r+e.width),e.flipRtl&&(r+=e.width,o="scale(-1 1)")),t.blockRendering.Types.isIcon(e)?(i.setAttribute("display","block"),i.setAttribute("transform","translate("+r+","+s+")"),e.icon.computeIconLocation()):i.setAttribute("transform","translate("+r+","+s+")"+o),this.info_.isInsertionMarker&&i.setAttribute("display","none")},t.blockRendering.Drawer.prototype.drawInlineInput_=function(e){var i=e.width,s=e.height,r=e.connectionOffsetY,o=e.connectionHeight+r;this.inlinePath_+=t.utils.svgPaths.moveTo(e.xPos+e.connectionWidth,e.centerline-s/2)+t.utils.svgPaths.lineOnAxis("v",r)+e.shape.pathDown+t.utils.svgPaths.lineOnAxis("v",s-o)+t.utils.svgPaths.lineOnAxis("h",i-e.connectionWidth)+t.utils.svgPaths.lineOnAxis("v",-s)+"z",this.positionInlineInputConnection_(e)},t.blockRendering.Drawer.prototype.positionInlineInputConnection_=function(e){var i=e.centerline-e.height/2;if(e.connectionModel){var s=e.xPos+e.connectionWidth+e.connectionOffsetX;this.info_.RTL&&(s*=-1),e.connectionModel.setOffsetInBlock(s,i+e.connectionOffsetY)}},t.blockRendering.Drawer.prototype.positionStatementInputConnection_=function(e){var i=e.getLastInput();if(i.connectionModel){var s=e.xPos+e.statementEdge+i.notchOffset;this.info_.RTL&&(s*=-1),i.connectionModel.setOffsetInBlock(s,e.yPos)}},t.blockRendering.Drawer.prototype.positionExternalValueConnection_=function(e){var i=e.getLastInput();if(i.connectionModel){var s=e.xPos+e.width;this.info_.RTL&&(s*=-1),i.connectionModel.setOffsetInBlock(s,e.yPos)}},t.blockRendering.Drawer.prototype.positionPreviousConnection_=function(){var e=this.info_.topRow;if(e.connection){var i=e.xPos+e.notchOffset;e.connection.connectionModel.setOffsetInBlock(this.info_.RTL?-i:i,0)}},t.blockRendering.Drawer.prototype.positionNextConnection_=function(){var e=this.info_.bottomRow;if(e.connection){var i=e.connection,s=i.xPos;i.connectionModel.setOffsetInBlock(this.info_.RTL?-s:s,e.baseline)}},t.blockRendering.Drawer.prototype.positionOutputConnection_=function(){if(this.info_.outputConnection){var e=this.info_.startX+this.info_.outputConnection.connectionOffsetX;this.block_.outputConnection.setOffsetInBlock(this.info_.RTL?-e:e,this.info_.outputConnection.connectionOffsetY)}},t.Events.MarkerMove=function(e,i,s,r){var o=e?e.workspace.id:void 0;r&&r.getType()==t.ASTNode.types.WORKSPACE&&(o=r.getLocation().id),t.Events.MarkerMove.superClass_.constructor.call(this,o),this.blockId=e?e.id:null,this.oldNode=s,this.newNode=r,this.isCursor=i},t.utils.object.inherits(t.Events.MarkerMove,t.Events.UiBase),t.Events.MarkerMove.prototype.type=t.Events.MARKER_MOVE,t.Events.MarkerMove.prototype.toJson=function(){var e=t.Events.MarkerMove.superClass_.toJson.call(this);return e.isCursor=this.isCursor,e.blockId=this.blockId,e.oldNode=this.oldNode,e.newNode=this.newNode,e},t.Events.MarkerMove.prototype.fromJson=function(e){t.Events.MarkerMove.superClass_.fromJson.call(this,e),this.isCursor=e.isCursor,this.blockId=e.blockId,this.oldNode=e.oldNode,this.newNode=e.newNode},t.registry.register(t.registry.Type.EVENT,t.Events.MARKER_MOVE,t.Events.MarkerMove),t.blockRendering.MarkerSvg=function(e,i,s){this.workspace_=e,this.marker_=s,this.parent_=null,this.constants_=i,this.currentMarkerSvg=null,e=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR,this.colour_=s.colour||e},t.blockRendering.MarkerSvg.CURSOR_CLASS="blocklyCursor",t.blockRendering.MarkerSvg.MARKER_CLASS="blocklyMarker",t.blockRendering.MarkerSvg.HEIGHT_MULTIPLIER=.75,t.blockRendering.MarkerSvg.prototype.getSvgRoot=function(){return this.svgGroup_},t.blockRendering.MarkerSvg.prototype.getMarker=function(){return this.marker_},t.blockRendering.MarkerSvg.prototype.isCursor=function(){return this.marker_.type=="cursor"},t.blockRendering.MarkerSvg.prototype.createDom=function(){var e=this.isCursor()?t.blockRendering.MarkerSvg.CURSOR_CLASS:t.blockRendering.MarkerSvg.MARKER_CLASS;return this.svgGroup_=t.utils.dom.createSvgElement(t.utils.Svg.G,{class:e},null),this.createDomInternal_(),this.svgGroup_},t.blockRendering.MarkerSvg.prototype.setParent_=function(e){this.isCursor()?(this.parent_&&this.parent_.setCursorSvg(null),e.setCursorSvg(this.getSvgRoot())):(this.parent_&&this.parent_.setMarkerSvg(null),e.setMarkerSvg(this.getSvgRoot())),this.parent_=e},t.blockRendering.MarkerSvg.prototype.draw=function(e,i){if(i){this.constants_=this.workspace_.getRenderer().getConstants();var s=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR;this.colour_=this.marker_.colour||s,this.applyColour_(i),this.showAtLocation_(i),this.fireMarkerEvent_(e,i),e=this.currentMarkerSvg.childNodes[0],e!==void 0&&e.beginElement&&e.beginElement()}else this.hide()},t.blockRendering.MarkerSvg.prototype.showAtLocation_=function(e){var i=e.getLocation().type;e.getType()==t.ASTNode.types.BLOCK?this.showWithBlock_(e):e.getType()==t.ASTNode.types.OUTPUT?this.showWithOutput_(e):i==t.connectionTypes.INPUT_VALUE?this.showWithInput_(e):i==t.connectionTypes.NEXT_STATEMENT?this.showWithNext_(e):e.getType()==t.ASTNode.types.PREVIOUS?this.showWithPrevious_(e):e.getType()==t.ASTNode.types.FIELD?this.showWithField_(e):e.getType()==t.ASTNode.types.WORKSPACE?this.showWithCoordinates_(e):e.getType()==t.ASTNode.types.STACK&&this.showWithStack_(e)},t.blockRendering.MarkerSvg.prototype.showWithBlockPrevOutput_=function(e){e=e.getSourceBlock();var i=e.width,s=e.height,r=s*t.blockRendering.MarkerSvg.HEIGHT_MULTIPLIER,o=this.constants_.CURSOR_BLOCK_PADDING;if(e.previousConnection){var h=this.constants_.shapeFor(e.previousConnection);this.positionPrevious_(i,o,r,h)}else e.outputConnection?(h=this.constants_.shapeFor(e.outputConnection),this.positionOutput_(i,s,h)):this.positionBlock_(i,o,r);this.setParent_(e),this.showCurrent_()},t.blockRendering.MarkerSvg.prototype.showWithBlock_=function(e){this.showWithBlockPrevOutput_(e)},t.blockRendering.MarkerSvg.prototype.showWithPrevious_=function(e){this.showWithBlockPrevOutput_(e)},t.blockRendering.MarkerSvg.prototype.showWithOutput_=function(e){this.showWithBlockPrevOutput_(e)},t.blockRendering.MarkerSvg.prototype.showWithCoordinates_=function(e){var i=e.getWsCoordinate();e=i.x,i=i.y,this.workspace_.RTL&&(e-=this.constants_.CURSOR_WS_WIDTH),this.positionLine_(e,i,this.constants_.CURSOR_WS_WIDTH),this.setParent_(this.workspace_),this.showCurrent_()},t.blockRendering.MarkerSvg.prototype.showWithField_=function(e){e=e.getLocation();var i=e.getSize().width,s=e.getSize().height;this.positionRect_(0,0,i,s),this.setParent_(e),this.showCurrent_()},t.blockRendering.MarkerSvg.prototype.showWithInput_=function(e){e=e.getLocation();var i=e.getSourceBlock();this.positionInput_(e),this.setParent_(i),this.showCurrent_()},t.blockRendering.MarkerSvg.prototype.showWithNext_=function(e){var i=e.getLocation();e=i.getSourceBlock();var s=0;i=i.getOffsetInBlock().y;var r=e.getHeightWidth().width;this.workspace_.RTL&&(s=-r),this.positionLine_(s,i,r),this.setParent_(e),this.showCurrent_()},t.blockRendering.MarkerSvg.prototype.showWithStack_=function(e){e=e.getLocation();var i=e.getHeightWidth(),s=i.width+this.constants_.CURSOR_STACK_PADDING;i=i.height+this.constants_.CURSOR_STACK_PADDING;var r=-this.constants_.CURSOR_STACK_PADDING/2,o=-this.constants_.CURSOR_STACK_PADDING/2,h=r;this.workspace_.RTL&&(h=-(s+r)),this.positionRect_(h,o,s,i),this.setParent_(e),this.showCurrent_()},t.blockRendering.MarkerSvg.prototype.showCurrent_=function(){this.hide(),this.currentMarkerSvg.style.display=""},t.blockRendering.MarkerSvg.prototype.positionBlock_=function(e,i,s){e=t.utils.svgPaths.moveBy(-i,s)+t.utils.svgPaths.lineOnAxis("V",-i)+t.utils.svgPaths.lineOnAxis("H",e+2*i)+t.utils.svgPaths.lineOnAxis("V",s),this.markerBlock_.setAttribute("d",e),this.workspace_.RTL&&this.flipRtl_(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_},t.blockRendering.MarkerSvg.prototype.positionInput_=function(e){var i=e.getOffsetInBlock().x,s=e.getOffsetInBlock().y;e=t.utils.svgPaths.moveTo(0,0)+this.constants_.shapeFor(e).pathDown,this.markerInput_.setAttribute("d",e),this.markerInput_.setAttribute("transform","translate("+i+","+s+")"+(this.workspace_.RTL?" scale(-1 1)":"")),this.currentMarkerSvg=this.markerInput_},t.blockRendering.MarkerSvg.prototype.positionLine_=function(e,i,s){this.markerSvgLine_.setAttribute("x",e),this.markerSvgLine_.setAttribute("y",i),this.markerSvgLine_.setAttribute("width",s),this.currentMarkerSvg=this.markerSvgLine_},t.blockRendering.MarkerSvg.prototype.positionOutput_=function(e,i,s){e=t.utils.svgPaths.moveBy(e,0)+t.utils.svgPaths.lineOnAxis("h",-(e-s.width))+t.utils.svgPaths.lineOnAxis("v",this.constants_.TAB_OFFSET_FROM_TOP)+s.pathDown+t.utils.svgPaths.lineOnAxis("V",i)+t.utils.svgPaths.lineOnAxis("H",e),this.markerBlock_.setAttribute("d",e),this.workspace_.RTL&&this.flipRtl_(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_},t.blockRendering.MarkerSvg.prototype.positionPrevious_=function(e,i,s,r){e=t.utils.svgPaths.moveBy(-i,s)+t.utils.svgPaths.lineOnAxis("V",-i)+t.utils.svgPaths.lineOnAxis("H",this.constants_.NOTCH_OFFSET_LEFT)+r.pathLeft+t.utils.svgPaths.lineOnAxis("H",e+2*i)+t.utils.svgPaths.lineOnAxis("V",s),this.markerBlock_.setAttribute("d",e),this.workspace_.RTL&&this.flipRtl_(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_},t.blockRendering.MarkerSvg.prototype.positionRect_=function(e,i,s,r){this.markerSvgRect_.setAttribute("x",e),this.markerSvgRect_.setAttribute("y",i),this.markerSvgRect_.setAttribute("width",s),this.markerSvgRect_.setAttribute("height",r),this.currentMarkerSvg=this.markerSvgRect_},t.blockRendering.MarkerSvg.prototype.flipRtl_=function(e){e.setAttribute("transform","scale(-1 1)")},t.blockRendering.MarkerSvg.prototype.hide=function(){this.markerSvgLine_.style.display="none",this.markerSvgRect_.style.display="none",this.markerInput_.style.display="none",this.markerBlock_.style.display="none"},t.blockRendering.MarkerSvg.prototype.fireMarkerEvent_=function(e,i){var s=i.getSourceBlock();e=new(t.Events.get(t.Events.MARKER_MOVE))(s,this.isCursor(),e,i),t.Events.fire(e)},t.blockRendering.MarkerSvg.prototype.getBlinkProperties_=function(){return{attributeType:"XML",attributeName:"fill",dur:"1s",values:this.colour_+";transparent;transparent;",repeatCount:"indefinite"}},t.blockRendering.MarkerSvg.prototype.createDomInternal_=function(){if(this.markerSvg_=t.utils.dom.createSvgElement(t.utils.Svg.G,{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT},this.svgGroup_),this.markerSvgLine_=t.utils.dom.createSvgElement(t.utils.Svg.RECT,{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT,style:"display: none"},this.markerSvg_),this.markerSvgRect_=t.utils.dom.createSvgElement(t.utils.Svg.RECT,{class:"blocklyVerticalMarker",rx:10,ry:10,style:"display: none"},this.markerSvg_),this.markerInput_=t.utils.dom.createSvgElement(t.utils.Svg.PATH,{transform:"",style:"display: none"},this.markerSvg_),this.markerBlock_=t.utils.dom.createSvgElement(t.utils.Svg.PATH,{transform:"",style:"display: none",fill:"none","stroke-width":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_),this.isCursor()){var e=this.getBlinkProperties_();t.utils.dom.createSvgElement(t.utils.Svg.ANIMATE,e,this.markerSvgLine_),t.utils.dom.createSvgElement(t.utils.Svg.ANIMATE,e,this.markerInput_),e.attributeName="stroke",t.utils.dom.createSvgElement(t.utils.Svg.ANIMATE,e,this.markerBlock_)}return this.markerSvg_},t.blockRendering.MarkerSvg.prototype.applyColour_=function(e){this.markerSvgLine_.setAttribute("fill",this.colour_),this.markerSvgRect_.setAttribute("stroke",this.colour_),this.markerInput_.setAttribute("fill",this.colour_),this.markerBlock_.setAttribute("stroke",this.colour_),this.isCursor()&&(e=this.colour_+";transparent;transparent;",this.markerSvgLine_.firstChild.setAttribute("values",e),this.markerInput_.firstChild.setAttribute("values",e),this.markerBlock_.firstChild.setAttribute("values",e))},t.blockRendering.MarkerSvg.prototype.dispose=function(){this.svgGroup_&&t.utils.dom.removeNode(this.svgGroup_)},t.blockRendering.PathObject=function(e,i,s){this.constants=s,this.svgRoot=e,this.svgPath=t.utils.dom.createSvgElement(t.utils.Svg.PATH,{class:"blocklyPath"},this.svgRoot),this.style=i,this.markerSvg=this.cursorSvg=null},t.blockRendering.PathObject.prototype.setPath=function(e){this.svgPath.setAttribute("d",e)},t.blockRendering.PathObject.prototype.flipRTL=function(){this.svgPath.setAttribute("transform","scale(-1 1)")},t.blockRendering.PathObject.prototype.setCursorSvg=function(e){e?(this.svgRoot.appendChild(e),this.cursorSvg=e):this.cursorSvg=null},t.blockRendering.PathObject.prototype.setMarkerSvg=function(e){e?(this.cursorSvg?this.svgRoot.insertBefore(e,this.cursorSvg):this.svgRoot.appendChild(e),this.markerSvg=e):this.markerSvg=null},t.blockRendering.PathObject.prototype.applyColour=function(e){this.svgPath.setAttribute("stroke",this.style.colourTertiary),this.svgPath.setAttribute("fill",this.style.colourPrimary),this.updateShadow_(e.isShadow()),this.updateDisabled_(!e.isEnabled()||e.getInheritedDisabled())},t.blockRendering.PathObject.prototype.setStyle=function(e){this.style=e},t.blockRendering.PathObject.prototype.setClass_=function(e,i){i?t.utils.dom.addClass(this.svgRoot,e):t.utils.dom.removeClass(this.svgRoot,e)},t.blockRendering.PathObject.prototype.updateHighlighted=function(e){e?this.svgPath.setAttribute("filter","url(#"+this.constants.embossFilterId+")"):this.svgPath.setAttribute("filter","none")},t.blockRendering.PathObject.prototype.updateShadow_=function(e){e&&(this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary))},t.blockRendering.PathObject.prototype.updateDisabled_=function(e){this.setClass_("blocklyDisabled",e),e&&this.svgPath.setAttribute("fill","url(#"+this.constants.disabledPatternId+")")},t.blockRendering.PathObject.prototype.updateSelected=function(e){this.setClass_("blocklySelected",e)},t.blockRendering.PathObject.prototype.updateDraggingDelete=function(e){this.setClass_("blocklyDraggingDelete",e)},t.blockRendering.PathObject.prototype.updateInsertionMarker=function(e){this.setClass_("blocklyInsertionMarker",e)},t.blockRendering.PathObject.prototype.updateMovable=function(e){this.setClass_("blocklyDraggable",e)},t.blockRendering.PathObject.prototype.updateReplacementFade=function(e){this.setClass_("blocklyReplaceable",e)},t.blockRendering.PathObject.prototype.updateShapeForInputHighlight=function(e,i){},t.IRegistrable=function(){},t.blockRendering.Renderer=function(e){this.name=e,this.overrides=this.constants_=null},t.blockRendering.Renderer.prototype.getClassName=function(){return this.name+"-renderer"},t.blockRendering.Renderer.prototype.init=function(e,i){this.constants_=this.makeConstants_(),i&&(this.overrides=i,t.utils.object.mixin(this.constants_,i)),this.constants_.setTheme(e),this.constants_.init()},t.blockRendering.Renderer.prototype.createDom=function(e,i){this.constants_.createDom(e,this.name+"-"+i.name,"."+this.getClassName()+"."+i.getClassName())},t.blockRendering.Renderer.prototype.refreshDom=function(e,i){var s=this.getConstants();s.dispose(),this.constants_=this.makeConstants_(),this.overrides&&t.utils.object.mixin(this.constants_,this.overrides),this.constants_.randomIdentifier=s.randomIdentifier,this.constants_.setTheme(i),this.constants_.init(),this.createDom(e,i)},t.blockRendering.Renderer.prototype.dispose=function(){this.constants_&&this.constants_.dispose()},t.blockRendering.Renderer.prototype.makeConstants_=function(){return new t.blockRendering.ConstantProvider},t.blockRendering.Renderer.prototype.makeRenderInfo_=function(e){return new t.blockRendering.RenderInfo(this,e)},t.blockRendering.Renderer.prototype.makeDrawer_=function(e,i){return new t.blockRendering.Drawer(e,i)},t.blockRendering.Renderer.prototype.makeDebugger_=function(){if(!t.blockRendering.Debug)throw Error("Missing require for Blockly.blockRendering.Debug");return new t.blockRendering.Debug(this.getConstants())},t.blockRendering.Renderer.prototype.makeMarkerDrawer=function(e,i){return new t.blockRendering.MarkerSvg(e,this.getConstants(),i)},t.blockRendering.Renderer.prototype.makePathObject=function(e,i){return new t.blockRendering.PathObject(e,i,this.constants_)},t.blockRendering.Renderer.prototype.getConstants=function(){return this.constants_},t.blockRendering.Renderer.prototype.shouldHighlightConnection=function(e){return!0},t.blockRendering.Renderer.prototype.orphanCanConnectAtEnd=function(e,i,s){return s==t.connectionTypes.OUTPUT_VALUE?(s=i.outputConnection,e=t.Connection.lastConnectionInRow(e,i)):(s=i.previousConnection,e=e.lastConnectionInStack()),e?s.getConnectionChecker().canConnect(e,s,!1):!1},t.blockRendering.Renderer.prototype.getConnectionPreviewMethod=function(e,i,s){return i.type==t.connectionTypes.OUTPUT_VALUE||i.type==t.connectionTypes.PREVIOUS_STATEMENT?!e.isConnected()||this.orphanCanConnectAtEnd(s,e.targetBlock(),i.type)?t.InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER:t.InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE:t.InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER},t.blockRendering.Renderer.prototype.render=function(e){t.blockRendering.useDebugger&&!e.renderingDebugger&&(e.renderingDebugger=this.makeDebugger_());var i=this.makeRenderInfo_(e);i.measure(),this.makeDrawer_(e,i).draw()},t.geras={},t.geras.ConstantProvider=function(){t.geras.ConstantProvider.superClass_.constructor.call(this),this.FIELD_TEXT_BASELINE_CENTER=!1,this.DARK_PATH_OFFSET=1,this.MAX_BOTTOM_WIDTH=30,this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT/2},t.utils.object.inherits(t.geras.ConstantProvider,t.blockRendering.ConstantProvider),t.geras.ConstantProvider.prototype.getCSS_=function(e){return t.geras.ConstantProvider.superClass_.getCSS_.call(this,e).concat([e+" .blocklyInsertionMarker>.blocklyPathLight,",e+" .blocklyInsertionMarker>.blocklyPathDark {","fill-opacity: "+this.INSERTION_MARKER_OPACITY+";","stroke: none;","}"])},t.geras.Highlighter=function(e){this.info_=e,this.inlineSteps_=this.steps_="",this.RTL_=this.info_.RTL,e=e.getRenderer(),this.constants_=e.getConstants(),this.highlightConstants_=e.getHighlightConstants(),this.highlightOffset_=this.highlightConstants_.OFFSET,this.outsideCornerPaths_=this.highlightConstants_.OUTSIDE_CORNER,this.insideCornerPaths_=this.highlightConstants_.INSIDE_CORNER,this.puzzleTabPaths_=this.highlightConstants_.PUZZLE_TAB,this.notchPaths_=this.highlightConstants_.NOTCH,this.startPaths_=this.highlightConstants_.START_HAT,this.jaggedTeethPaths_=this.highlightConstants_.JAGGED_TEETH},t.geras.Highlighter.prototype.getPath=function(){return this.steps_+`
`+this.inlineSteps_},t.geras.Highlighter.prototype.drawTopCorner=function(e){this.steps_+=t.utils.svgPaths.moveBy(e.xPos,this.info_.startY);for(var i=0,s;s=e.elements[i];i++)t.blockRendering.Types.isLeftSquareCorner(s)?this.steps_+=this.highlightConstants_.START_POINT:t.blockRendering.Types.isLeftRoundedCorner(s)?this.steps_+=this.outsideCornerPaths_.topLeft(this.RTL_):t.blockRendering.Types.isPreviousConnection(s)?this.steps_+=this.notchPaths_.pathLeft:t.blockRendering.Types.isHat(s)?this.steps_+=this.startPaths_.path(this.RTL_):t.blockRendering.Types.isSpacer(s)&&s.width!=0&&(this.steps_+=t.utils.svgPaths.lineOnAxis("H",s.xPos+s.width-this.highlightOffset_));this.steps_+=t.utils.svgPaths.lineOnAxis("H",e.xPos+e.width-this.highlightOffset_)},t.geras.Highlighter.prototype.drawJaggedEdge_=function(e){this.info_.RTL&&(this.steps_+=this.jaggedTeethPaths_.pathLeft+t.utils.svgPaths.lineOnAxis("v",e.height-this.jaggedTeethPaths_.height-this.highlightOffset_))},t.geras.Highlighter.prototype.drawValueInput=function(e){var i=e.getLastInput();if(this.RTL_){var s=e.height-i.connectionHeight;this.steps_+=t.utils.svgPaths.moveTo(i.xPos+i.width-this.highlightOffset_,e.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)+t.utils.svgPaths.lineOnAxis("v",s)}else this.steps_+=t.utils.svgPaths.moveTo(i.xPos+i.width,e.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)},t.geras.Highlighter.prototype.drawStatementInput=function(e){var i=e.getLastInput();if(this.RTL_){var s=e.height-2*this.insideCornerPaths_.height;this.steps_+=t.utils.svgPaths.moveTo(i.xPos,e.yPos)+this.insideCornerPaths_.pathTop(this.RTL_)+t.utils.svgPaths.lineOnAxis("v",s)+this.insideCornerPaths_.pathBottom(this.RTL_)+t.utils.svgPaths.lineTo(e.width-i.xPos-this.insideCornerPaths_.width,0)}else this.steps_+=t.utils.svgPaths.moveTo(i.xPos,e.yPos+e.height)+this.insideCornerPaths_.pathBottom(this.RTL_)+t.utils.svgPaths.lineTo(e.width-i.xPos-this.insideCornerPaths_.width,0)},t.geras.Highlighter.prototype.drawRightSideRow=function(e){var i=e.xPos+e.width-this.highlightOffset_;e.followsStatement&&(this.steps_+=t.utils.svgPaths.lineOnAxis("H",i)),this.RTL_&&(this.steps_+=t.utils.svgPaths.lineOnAxis("H",i),e.height>this.highlightOffset_&&(this.steps_+=t.utils.svgPaths.lineOnAxis("V",e.yPos+e.height-this.highlightOffset_)))},t.geras.Highlighter.prototype.drawBottomRow=function(e){if(this.RTL_)this.steps_+=t.utils.svgPaths.lineOnAxis("V",e.baseline-this.highlightOffset_);else{var i=this.info_.bottomRow.elements[0];t.blockRendering.Types.isLeftSquareCorner(i)?this.steps_+=t.utils.svgPaths.moveTo(e.xPos+this.highlightOffset_,e.baseline-this.highlightOffset_):t.blockRendering.Types.isLeftRoundedCorner(i)&&(this.steps_+=t.utils.svgPaths.moveTo(e.xPos,e.baseline),this.steps_+=this.outsideCornerPaths_.bottomLeft())}},t.geras.Highlighter.prototype.drawLeft=function(){var e=this.info_.outputConnection;e&&(e=e.connectionOffsetY+e.height,this.RTL_?this.steps_+=t.utils.svgPaths.moveTo(this.info_.startX,e):(this.steps_+=t.utils.svgPaths.moveTo(this.info_.startX+this.highlightOffset_,this.info_.bottomRow.baseline-this.highlightOffset_),this.steps_+=t.utils.svgPaths.lineOnAxis("V",e)),this.steps_+=this.puzzleTabPaths_.pathUp(this.RTL_)),this.RTL_||(e=this.info_.topRow,t.blockRendering.Types.isLeftRoundedCorner(e.elements[0])?this.steps_+=t.utils.svgPaths.lineOnAxis("V",this.outsideCornerPaths_.height):this.steps_+=t.utils.svgPaths.lineOnAxis("V",e.capline+this.highlightOffset_))},t.geras.Highlighter.prototype.drawInlineInput=function(e){var i=this.highlightOffset_,s=e.xPos+e.connectionWidth,r=e.centerline-e.height/2,o=e.width-e.connectionWidth,h=r+i;this.RTL_?(r=e.connectionOffsetY-i,e=e.height-(e.connectionOffsetY+e.connectionHeight)+i,this.inlineSteps_+=t.utils.svgPaths.moveTo(s-i,h)+t.utils.svgPaths.lineOnAxis("v",r)+this.puzzleTabPaths_.pathDown(this.RTL_)+t.utils.svgPaths.lineOnAxis("v",e)+t.utils.svgPaths.lineOnAxis("h",o)):this.inlineSteps_+=t.utils.svgPaths.moveTo(e.xPos+e.width+i,h)+t.utils.svgPaths.lineOnAxis("v",e.height)+t.utils.svgPaths.lineOnAxis("h",-o)+t.utils.svgPaths.moveTo(s,r+e.connectionOffsetY)+this.puzzleTabPaths_.pathDown(this.RTL_)},t.geras.InlineInput=function(e,i){t.geras.InlineInput.superClass_.constructor.call(this,e,i),this.connectedBlock&&(this.width+=this.constants_.DARK_PATH_OFFSET,this.height+=this.constants_.DARK_PATH_OFFSET)},t.utils.object.inherits(t.geras.InlineInput,t.blockRendering.InlineInput),t.geras.StatementInput=function(e,i){t.geras.StatementInput.superClass_.constructor.call(this,e,i),this.connectedBlock&&(this.height+=this.constants_.DARK_PATH_OFFSET)},t.utils.object.inherits(t.geras.StatementInput,t.blockRendering.StatementInput),t.geras.RenderInfo=function(e,i){t.geras.RenderInfo.superClass_.constructor.call(this,e,i)},t.utils.object.inherits(t.geras.RenderInfo,t.blockRendering.RenderInfo),t.geras.RenderInfo.prototype.getRenderer=function(){return this.renderer_},t.geras.RenderInfo.prototype.populateBottomRow_=function(){t.geras.RenderInfo.superClass_.populateBottomRow_.call(this),this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1].type==t.inputTypes.STATEMENT||(this.bottomRow.minHeight=this.constants_.MEDIUM_PADDING-this.constants_.DARK_PATH_OFFSET)},t.geras.RenderInfo.prototype.addInput_=function(e,i){this.isInline&&e.type==t.inputTypes.VALUE?(i.elements.push(new t.geras.InlineInput(this.constants_,e)),i.hasInlineInput=!0):e.type==t.inputTypes.STATEMENT?(i.elements.push(new t.geras.StatementInput(this.constants_,e)),i.hasStatement=!0):e.type==t.inputTypes.VALUE?(i.elements.push(new t.blockRendering.ExternalValueInput(this.constants_,e)),i.hasExternalInput=!0):e.type==t.inputTypes.DUMMY&&(i.minHeight=Math.max(i.minHeight,this.constants_.DUMMY_INPUT_MIN_HEIGHT),i.hasDummyInput=!0),this.isInline||i.align!=null||(i.align=e.align)},t.geras.RenderInfo.prototype.addElemSpacing_=function(){for(var e=!1,i=0,s;s=this.rows[i];i++)s.hasExternalInput&&(e=!0);for(i=0;s=this.rows[i];i++){var r=s.elements;if(s.elements=[],s.startsWithElemSpacer()&&s.elements.push(new t.blockRendering.InRowSpacer(this.constants_,this.getInRowSpacing_(null,r[0]))),r.length){for(var o=0;o<r.length-1;o++){s.elements.push(r[o]);var h=this.getInRowSpacing_(r[o],r[o+1]);s.elements.push(new t.blockRendering.InRowSpacer(this.constants_,h))}s.elements.push(r[r.length-1]),s.endsWithElemSpacer()&&(h=this.getInRowSpacing_(r[r.length-1],null),e&&s.hasDummyInput&&(h+=this.constants_.TAB_WIDTH),s.elements.push(new t.blockRendering.InRowSpacer(this.constants_,h)))}}},t.geras.RenderInfo.prototype.getInRowSpacing_=function(e,i){if(!e)return i&&t.blockRendering.Types.isField(i)&&i.isEditable?this.constants_.MEDIUM_PADDING:i&&t.blockRendering.Types.isInlineInput(i)?this.constants_.MEDIUM_LARGE_PADDING:i&&t.blockRendering.Types.isStatementInput(i)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!t.blockRendering.Types.isInput(e)&&(!i||t.blockRendering.Types.isStatementInput(i)))return t.blockRendering.Types.isField(e)&&e.isEditable?this.constants_.MEDIUM_PADDING:t.blockRendering.Types.isIcon(e)?2*this.constants_.LARGE_PADDING+1:t.blockRendering.Types.isHat(e)?this.constants_.NO_PADDING:t.blockRendering.Types.isPreviousOrNextConnection(e)?this.constants_.LARGE_PADDING:t.blockRendering.Types.isLeftRoundedCorner(e)?this.constants_.MIN_BLOCK_WIDTH:t.blockRendering.Types.isJaggedEdge(e)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(t.blockRendering.Types.isInput(e)&&!i){if(t.blockRendering.Types.isExternalInput(e))return this.constants_.NO_PADDING;if(t.blockRendering.Types.isInlineInput(e))return this.constants_.LARGE_PADDING;if(t.blockRendering.Types.isStatementInput(e))return this.constants_.NO_PADDING}if(!t.blockRendering.Types.isInput(e)&&i&&t.blockRendering.Types.isInput(i)){if(t.blockRendering.Types.isField(e)&&e.isEditable){if(t.blockRendering.Types.isInlineInput(i)||t.blockRendering.Types.isExternalInput(i))return this.constants_.SMALL_PADDING}else{if(t.blockRendering.Types.isInlineInput(i)||t.blockRendering.Types.isExternalInput(i))return this.constants_.MEDIUM_LARGE_PADDING;if(t.blockRendering.Types.isStatementInput(i))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(t.blockRendering.Types.isIcon(e)&&i&&!t.blockRendering.Types.isInput(i))return this.constants_.LARGE_PADDING;if(t.blockRendering.Types.isInlineInput(e)&&i&&t.blockRendering.Types.isField(i))return i.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(t.blockRendering.Types.isLeftSquareCorner(e)&&i){if(t.blockRendering.Types.isHat(i))return this.constants_.NO_PADDING;if(t.blockRendering.Types.isPreviousConnection(i))return i.notchOffset;if(t.blockRendering.Types.isNextConnection(i))return e=(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2,i.notchOffset+e}if(t.blockRendering.Types.isLeftRoundedCorner(e)&&i){if(t.blockRendering.Types.isPreviousConnection(i))return i.notchOffset-this.constants_.CORNER_RADIUS;if(t.blockRendering.Types.isNextConnection(i))return e=(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2,i.notchOffset-this.constants_.CORNER_RADIUS+e}return t.blockRendering.Types.isField(e)&&i&&t.blockRendering.Types.isField(i)&&e.isEditable==i.isEditable||i&&t.blockRendering.Types.isJaggedEdge(i)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING},t.geras.RenderInfo.prototype.getSpacerRowHeight_=function(e,i){return t.blockRendering.Types.isTopRow(e)&&t.blockRendering.Types.isBottomRow(i)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:t.blockRendering.Types.isTopRow(e)||t.blockRendering.Types.isBottomRow(i)?this.constants_.NO_PADDING:e.hasExternalInput&&i.hasExternalInput?this.constants_.LARGE_PADDING:!e.hasStatement&&i.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:e.hasStatement&&i.hasStatement||!e.hasStatement&&i.hasDummyInput||e.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING},t.geras.RenderInfo.prototype.getElemCenterline_=function(e,i){if(t.blockRendering.Types.isSpacer(i))return e.yPos+i.height/2;if(t.blockRendering.Types.isBottomRow(e))return e=e.yPos+e.height-e.descenderHeight,t.blockRendering.Types.isNextConnection(i)?e+i.height/2:e-i.height/2;if(t.blockRendering.Types.isTopRow(e))return t.blockRendering.Types.isHat(i)?e.capline-i.height/2:e.capline+i.height/2;var s=e.yPos;return t.blockRendering.Types.isField(i)||t.blockRendering.Types.isIcon(i)?(s+=i.height/2,(e.hasInlineInput||e.hasStatement)&&i.height+this.constants_.TALL_INPUT_FIELD_OFFSET_Y<=e.height&&(s+=this.constants_.TALL_INPUT_FIELD_OFFSET_Y)):s=t.blockRendering.Types.isInlineInput(i)?s+i.height/2:s+e.height/2,s},t.geras.RenderInfo.prototype.alignRowElements_=function(){if(this.isInline){for(var e=0,i=null,s=this.rows.length-1,r;r=this.rows[s];s--)r.nextRightEdge=e,t.blockRendering.Types.isInputRow(r)&&(r.hasStatement&&this.alignStatementRow_(r),i&&i.hasStatement&&r.width<i.width?r.nextRightEdge=i.width:e=r.width,i=r);for(s=e=0;r=this.rows[s];s++)r.hasStatement?e=this.getDesiredRowWidth_(r):t.blockRendering.Types.isSpacer(r)?r.width=Math.max(e,r.nextRightEdge):(e=Math.max(e,r.nextRightEdge)-r.width,0<e&&this.addAlignmentPadding_(r,e),e=r.width)}else t.geras.RenderInfo.superClass_.alignRowElements_.call(this)},t.geras.RenderInfo.prototype.getDesiredRowWidth_=function(e){return this.isInline&&e.hasStatement?this.statementEdge+this.constants_.MAX_BOTTOM_WIDTH+this.startX:t.geras.RenderInfo.superClass_.getDesiredRowWidth_.call(this,e)},t.geras.RenderInfo.prototype.finalize_=function(){for(var e=0,i=0,s=0,r;r=this.rows[s];s++){r.yPos=i,r.xPos=this.startX,i+=r.height,e=Math.max(e,r.widthWithConnectedBlocks);var o=i-this.topRow.ascenderHeight;r==this.bottomRow&&o<this.constants_.MIN_BLOCK_HEIGHT&&(o=this.constants_.MIN_BLOCK_HEIGHT-o,this.bottomRow.height+=o,i+=o),this.recordElemPositions_(r)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(e=Math.max(e,this.block_.nextConnection.targetBlock().getHeightWidth().width-this.constants_.DARK_PATH_OFFSET)),this.bottomRow.baseline=i-this.bottomRow.descenderHeight,this.widthWithChildren=e+this.startX+this.constants_.DARK_PATH_OFFSET,this.width+=this.constants_.DARK_PATH_OFFSET,this.height=i+this.constants_.DARK_PATH_OFFSET,this.startY=this.topRow.capline},t.geras.Drawer=function(e,i){t.geras.Drawer.superClass_.constructor.call(this,e,i),this.highlighter_=new t.geras.Highlighter(i)},t.utils.object.inherits(t.geras.Drawer,t.blockRendering.Drawer),t.geras.Drawer.prototype.draw=function(){this.hideHiddenIcons_(),this.drawOutline_(),this.drawInternals_();var e=this.block_.pathObject;e.setPath(this.outlinePath_+`
`+this.inlinePath_),e.setHighlightPath(this.highlighter_.getPath()),this.info_.RTL&&e.flipRTL(),t.blockRendering.useDebugger&&this.block_.renderingDebugger.drawDebug(this.block_,this.info_),this.recordSizeOnBlock_()},t.geras.Drawer.prototype.drawTop_=function(){this.highlighter_.drawTopCorner(this.info_.topRow),this.highlighter_.drawRightSideRow(this.info_.topRow),t.geras.Drawer.superClass_.drawTop_.call(this)},t.geras.Drawer.prototype.drawJaggedEdge_=function(e){this.highlighter_.drawJaggedEdge_(e),t.geras.Drawer.superClass_.drawJaggedEdge_.call(this,e)},t.geras.Drawer.prototype.drawValueInput_=function(e){this.highlighter_.drawValueInput(e),t.geras.Drawer.superClass_.drawValueInput_.call(this,e)},t.geras.Drawer.prototype.drawStatementInput_=function(e){this.highlighter_.drawStatementInput(e),t.geras.Drawer.superClass_.drawStatementInput_.call(this,e)},t.geras.Drawer.prototype.drawRightSideRow_=function(e){this.highlighter_.drawRightSideRow(e),this.outlinePath_+=t.utils.svgPaths.lineOnAxis("H",e.xPos+e.width)+t.utils.svgPaths.lineOnAxis("V",e.yPos+e.height)},t.geras.Drawer.prototype.drawBottom_=function(){this.highlighter_.drawBottomRow(this.info_.bottomRow),t.geras.Drawer.superClass_.drawBottom_.call(this)},t.geras.Drawer.prototype.drawLeft_=function(){this.highlighter_.drawLeft(),t.geras.Drawer.superClass_.drawLeft_.call(this)},t.geras.Drawer.prototype.drawInlineInput_=function(e){this.highlighter_.drawInlineInput(e),t.geras.Drawer.superClass_.drawInlineInput_.call(this,e)},t.geras.Drawer.prototype.positionInlineInputConnection_=function(e){var i=e.centerline-e.height/2;if(e.connectionModel){var s=e.xPos+e.connectionWidth+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(s*=-1),e.connectionModel.setOffsetInBlock(s,i+e.connectionOffsetY+this.constants_.DARK_PATH_OFFSET)}},t.geras.Drawer.prototype.positionStatementInputConnection_=function(e){var i=e.getLastInput();if(i.connectionModel){var s=e.xPos+e.statementEdge+i.notchOffset;s=this.info_.RTL?-1*s:s+this.constants_.DARK_PATH_OFFSET,i.connectionModel.setOffsetInBlock(s,e.yPos+this.constants_.DARK_PATH_OFFSET)}},t.geras.Drawer.prototype.positionExternalValueConnection_=function(e){var i=e.getLastInput();if(i.connectionModel){var s=e.xPos+e.width+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(s*=-1),i.connectionModel.setOffsetInBlock(s,e.yPos)}},t.geras.Drawer.prototype.positionNextConnection_=function(){var e=this.info_.bottomRow;if(e.connection){var i=e.connection,s=i.xPos;i.connectionModel.setOffsetInBlock((this.info_.RTL?-s:s)+this.constants_.DARK_PATH_OFFSET/2,e.baseline+this.constants_.DARK_PATH_OFFSET)}},t.geras.HighlightConstantProvider=function(e){this.constantProvider=e,this.OFFSET=.5,this.START_POINT=t.utils.svgPaths.moveBy(this.OFFSET,this.OFFSET)},t.geras.HighlightConstantProvider.prototype.init=function(){this.INSIDE_CORNER=this.makeInsideCorner(),this.OUTSIDE_CORNER=this.makeOutsideCorner(),this.PUZZLE_TAB=this.makePuzzleTab(),this.NOTCH=this.makeNotch(),this.JAGGED_TEETH=this.makeJaggedTeeth(),this.START_HAT=this.makeStartHat()},t.geras.HighlightConstantProvider.prototype.makeInsideCorner=function(){var e=this.constantProvider.CORNER_RADIUS,i=this.OFFSET,s=(1-Math.SQRT1_2)*(e+i)-i,r=t.utils.svgPaths.moveBy(s,s)+t.utils.svgPaths.arc("a","0 0,0",e,t.utils.svgPaths.point(-s-i,e-s)),o=t.utils.svgPaths.arc("a","0 0,0",e+i,t.utils.svgPaths.point(e+i,e+i)),h=t.utils.svgPaths.moveBy(s,-s)+t.utils.svgPaths.arc("a","0 0,0",e+i,t.utils.svgPaths.point(e-s,s+i));return{width:e+i,height:e,pathTop:function(u){return u?r:""},pathBottom:function(u){return u?o:h}}},t.geras.HighlightConstantProvider.prototype.makeOutsideCorner=function(){var e=this.constantProvider.CORNER_RADIUS,i=this.OFFSET,s=(1-Math.SQRT1_2)*(e-i)+i,r=t.utils.svgPaths.moveBy(s,s)+t.utils.svgPaths.arc("a","0 0,1",e-i,t.utils.svgPaths.point(e-s,-s+i)),o=t.utils.svgPaths.moveBy(i,e)+t.utils.svgPaths.arc("a","0 0,1",e-i,t.utils.svgPaths.point(e,-e+i)),h=-s,u=t.utils.svgPaths.moveBy(s,h)+t.utils.svgPaths.arc("a","0 0,1",e-i,t.utils.svgPaths.point(-s+i,-h-e));return{height:e,topLeft:function(p){return p?r:o},bottomLeft:function(){return u}}},t.geras.HighlightConstantProvider.prototype.makePuzzleTab=function(){var e=this.constantProvider.TAB_WIDTH,i=this.constantProvider.TAB_HEIGHT,s=t.utils.svgPaths.moveBy(-2,-i+3.4)+t.utils.svgPaths.lineTo(-.45*e,-2.1),r=t.utils.svgPaths.lineOnAxis("v",2.5)+t.utils.svgPaths.moveBy(.97*-e,2.5)+t.utils.svgPaths.curve("q",[t.utils.svgPaths.point(.05*-e,10),t.utils.svgPaths.point(.3*e,9.5)])+t.utils.svgPaths.moveBy(.67*e,-1.9)+t.utils.svgPaths.lineOnAxis("v",2.5),o=t.utils.svgPaths.lineOnAxis("v",-1.5)+t.utils.svgPaths.moveBy(-.92*e,-.5)+t.utils.svgPaths.curve("q",[t.utils.svgPaths.point(-.19*e,-5.5),t.utils.svgPaths.point(0,-11)])+t.utils.svgPaths.moveBy(.92*e,1),h=t.utils.svgPaths.moveBy(-5,i-.7)+t.utils.svgPaths.lineTo(.46*e,-2.1);return{width:e,height:i,pathUp:function(u){return u?s:o},pathDown:function(u){return u?r:h}}},t.geras.HighlightConstantProvider.prototype.makeNotch=function(){return{pathLeft:t.utils.svgPaths.lineOnAxis("h",this.OFFSET)+this.constantProvider.NOTCH.pathLeft}},t.geras.HighlightConstantProvider.prototype.makeJaggedTeeth=function(){return{pathLeft:t.utils.svgPaths.lineTo(5.1,2.6)+t.utils.svgPaths.moveBy(-10.2,6.8)+t.utils.svgPaths.lineTo(5.1,2.6),height:12,width:10.2}},t.geras.HighlightConstantProvider.prototype.makeStartHat=function(){var e=this.constantProvider.START_HAT.height,i=t.utils.svgPaths.moveBy(25,-8.7)+t.utils.svgPaths.curve("c",[t.utils.svgPaths.point(29.7,-6.2),t.utils.svgPaths.point(57.2,-.5),t.utils.svgPaths.point(75,8.7)]),s=t.utils.svgPaths.curve("c",[t.utils.svgPaths.point(17.8,-9.2),t.utils.svgPaths.point(45.3,-14.9),t.utils.svgPaths.point(75,-8.7)])+t.utils.svgPaths.moveTo(100.5,e+.5);return{path:function(r){return r?i:s}}},t.geras.PathObject=function(e,i,s){this.constants=s,this.svgRoot=e,this.svgPathDark=t.utils.dom.createSvgElement(t.utils.Svg.PATH,{class:"blocklyPathDark",transform:"translate(1,1)"},this.svgRoot),this.svgPath=t.utils.dom.createSvgElement(t.utils.Svg.PATH,{class:"blocklyPath"},this.svgRoot),this.svgPathLight=t.utils.dom.createSvgElement(t.utils.Svg.PATH,{class:"blocklyPathLight"},this.svgRoot),this.colourDark="#000000",this.style=i},t.utils.object.inherits(t.geras.PathObject,t.blockRendering.PathObject),t.geras.PathObject.prototype.setPath=function(e){this.svgPath.setAttribute("d",e),this.svgPathDark.setAttribute("d",e)},t.geras.PathObject.prototype.setHighlightPath=function(e){this.svgPathLight.setAttribute("d",e)},t.geras.PathObject.prototype.flipRTL=function(){this.svgPath.setAttribute("transform","scale(-1 1)"),this.svgPathLight.setAttribute("transform","scale(-1 1)"),this.svgPathDark.setAttribute("transform","translate(1,1) scale(-1 1)")},t.geras.PathObject.prototype.applyColour=function(e){this.svgPathLight.style.display="",this.svgPathDark.style.display="",this.svgPathLight.setAttribute("stroke",this.style.colourTertiary),this.svgPathDark.setAttribute("fill",this.colourDark),t.geras.PathObject.superClass_.applyColour.call(this,e),this.svgPath.setAttribute("stroke","none")},t.geras.PathObject.prototype.setStyle=function(e){this.style=e,this.colourDark=t.utils.colour.blend("#000",this.style.colourPrimary,.2)||this.colourDark},t.geras.PathObject.prototype.updateHighlighted=function(e){e?(this.svgPath.setAttribute("filter","url(#"+this.constants.embossFilterId+")"),this.svgPathLight.style.display="none"):(this.svgPath.setAttribute("filter","none"),this.svgPathLight.style.display="inline")},t.geras.PathObject.prototype.updateShadow_=function(e){e&&(this.svgPathLight.style.display="none",this.svgPathDark.setAttribute("fill",this.style.colourSecondary),this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary))},t.geras.PathObject.prototype.updateDisabled_=function(e){t.geras.PathObject.superClass_.updateDisabled_.call(this,e),e&&this.svgPath.setAttribute("stroke","none")},t.geras.Renderer=function(e){t.geras.Renderer.superClass_.constructor.call(this,e),this.highlightConstants_=null},t.utils.object.inherits(t.geras.Renderer,t.blockRendering.Renderer),t.geras.Renderer.prototype.init=function(e,i){t.geras.Renderer.superClass_.init.call(this,e,i),this.highlightConstants_=this.makeHighlightConstants_(),this.highlightConstants_.init()},t.geras.Renderer.prototype.refreshDom=function(e,i){t.geras.Renderer.superClass_.refreshDom.call(this,e,i),this.getHighlightConstants().init()},t.geras.Renderer.prototype.makeConstants_=function(){return new t.geras.ConstantProvider},t.geras.Renderer.prototype.makeRenderInfo_=function(e){return new t.geras.RenderInfo(this,e)},t.geras.Renderer.prototype.makeDrawer_=function(e,i){return new t.geras.Drawer(e,i)},t.geras.Renderer.prototype.makePathObject=function(e,i){return new t.geras.PathObject(e,i,this.getConstants())},t.geras.Renderer.prototype.makeHighlightConstants_=function(){return new t.geras.HighlightConstantProvider(this.getConstants())},t.geras.Renderer.prototype.getHighlightConstants=function(){return this.highlightConstants_},t.blockRendering.register("geras",t.geras.Renderer),t.thrasos={},t.thrasos.RenderInfo=function(e,i){t.thrasos.RenderInfo.superClass_.constructor.call(this,e,i)},t.utils.object.inherits(t.thrasos.RenderInfo,t.blockRendering.RenderInfo),t.thrasos.RenderInfo.prototype.getRenderer=function(){return this.renderer_},t.thrasos.RenderInfo.prototype.addElemSpacing_=function(){for(var e=!1,i=0,s;s=this.rows[i];i++)s.hasExternalInput&&(e=!0);for(i=0;s=this.rows[i];i++){var r=s.elements;s.elements=[],s.startsWithElemSpacer()&&s.elements.push(new t.blockRendering.InRowSpacer(this.constants_,this.getInRowSpacing_(null,r[0])));for(var o=0;o<r.length-1;o++){s.elements.push(r[o]);var h=this.getInRowSpacing_(r[o],r[o+1]);s.elements.push(new t.blockRendering.InRowSpacer(this.constants_,h))}s.elements.push(r[r.length-1]),s.endsWithElemSpacer()&&(h=this.getInRowSpacing_(r[r.length-1],null),e&&s.hasDummyInput&&(h+=this.constants_.TAB_WIDTH),s.elements.push(new t.blockRendering.InRowSpacer(this.constants_,h)))}},t.thrasos.RenderInfo.prototype.getInRowSpacing_=function(e,i){if(!e)return i&&t.blockRendering.Types.isField(i)&&i.isEditable?this.constants_.MEDIUM_PADDING:i&&t.blockRendering.Types.isInlineInput(i)?this.constants_.MEDIUM_LARGE_PADDING:i&&t.blockRendering.Types.isStatementInput(i)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!t.blockRendering.Types.isInput(e)&&!i)return t.blockRendering.Types.isField(e)&&e.isEditable?this.constants_.MEDIUM_PADDING:t.blockRendering.Types.isIcon(e)?2*this.constants_.LARGE_PADDING+1:t.blockRendering.Types.isHat(e)?this.constants_.NO_PADDING:t.blockRendering.Types.isPreviousOrNextConnection(e)?this.constants_.LARGE_PADDING:t.blockRendering.Types.isLeftRoundedCorner(e)?this.constants_.MIN_BLOCK_WIDTH:t.blockRendering.Types.isJaggedEdge(e)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(t.blockRendering.Types.isInput(e)&&!i){if(t.blockRendering.Types.isExternalInput(e))return this.constants_.NO_PADDING;if(t.blockRendering.Types.isInlineInput(e))return this.constants_.LARGE_PADDING;if(t.blockRendering.Types.isStatementInput(e))return this.constants_.NO_PADDING}if(!t.blockRendering.Types.isInput(e)&&i&&t.blockRendering.Types.isInput(i)){if(t.blockRendering.Types.isField(e)&&e.isEditable){if(t.blockRendering.Types.isInlineInput(i)||t.blockRendering.Types.isExternalInput(i))return this.constants_.SMALL_PADDING}else{if(t.blockRendering.Types.isInlineInput(i)||t.blockRendering.Types.isExternalInput(i))return this.constants_.MEDIUM_LARGE_PADDING;if(t.blockRendering.Types.isStatementInput(i))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(t.blockRendering.Types.isIcon(e)&&i&&!t.blockRendering.Types.isInput(i))return this.constants_.LARGE_PADDING;if(t.blockRendering.Types.isInlineInput(e)&&i&&t.blockRendering.Types.isField(i))return i.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(t.blockRendering.Types.isLeftSquareCorner(e)&&i){if(t.blockRendering.Types.isHat(i))return this.constants_.NO_PADDING;if(t.blockRendering.Types.isPreviousConnection(i)||t.blockRendering.Types.isNextConnection(i))return i.notchOffset}return t.blockRendering.Types.isLeftRoundedCorner(e)&&i?i.notchOffset-this.constants_.CORNER_RADIUS:t.blockRendering.Types.isField(e)&&i&&t.blockRendering.Types.isField(i)&&e.isEditable==i.isEditable||i&&t.blockRendering.Types.isJaggedEdge(i)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING},t.thrasos.RenderInfo.prototype.getSpacerRowHeight_=function(e,i){return t.blockRendering.Types.isTopRow(e)&&t.blockRendering.Types.isBottomRow(i)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:t.blockRendering.Types.isTopRow(e)||t.blockRendering.Types.isBottomRow(i)?this.constants_.NO_PADDING:e.hasExternalInput&&i.hasExternalInput?this.constants_.LARGE_PADDING:!e.hasStatement&&i.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:e.hasStatement&&i.hasStatement||e.hasDummyInput||i.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING},t.thrasos.RenderInfo.prototype.getElemCenterline_=function(e,i){if(t.blockRendering.Types.isSpacer(i))return e.yPos+i.height/2;if(t.blockRendering.Types.isBottomRow(e))return e=e.yPos+e.height-e.descenderHeight,t.blockRendering.Types.isNextConnection(i)?e+i.height/2:e-i.height/2;if(t.blockRendering.Types.isTopRow(e))return t.blockRendering.Types.isHat(i)?e.capline-i.height/2:e.capline+i.height/2;var s=e.yPos;return s=t.blockRendering.Types.isField(i)&&e.hasStatement?s+(this.constants_.TALL_INPUT_FIELD_OFFSET_Y+i.height/2):s+e.height/2},t.thrasos.RenderInfo.prototype.finalize_=function(){for(var e=0,i=0,s=0,r;r=this.rows[s];s++){r.yPos=i,r.xPos=this.startX,i+=r.height,e=Math.max(e,r.widthWithConnectedBlocks);var o=i-this.topRow.ascenderHeight;r==this.bottomRow&&o<this.constants_.MIN_BLOCK_HEIGHT&&(o=this.constants_.MIN_BLOCK_HEIGHT-o,this.bottomRow.height+=o,i+=o),this.recordElemPositions_(r)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(e=Math.max(e,this.block_.nextConnection.targetBlock().getHeightWidth().width)),this.bottomRow.baseline=i-this.bottomRow.descenderHeight,this.widthWithChildren=e+this.startX,this.height=i,this.startY=this.topRow.capline},t.thrasos.Renderer=function(e){t.thrasos.Renderer.superClass_.constructor.call(this,e)},t.utils.object.inherits(t.thrasos.Renderer,t.blockRendering.Renderer),t.thrasos.Renderer.prototype.makeRenderInfo_=function(e){return new t.thrasos.RenderInfo(this,e)},t.blockRendering.register("thrasos",t.thrasos.Renderer),t.zelos={},t.zelos.ConstantProvider=function(){t.zelos.ConstantProvider.superClass_.constructor.call(this),this.SMALL_PADDING=this.GRID_UNIT=4,this.MEDIUM_PADDING=2*this.GRID_UNIT,this.MEDIUM_LARGE_PADDING=3*this.GRID_UNIT,this.LARGE_PADDING=4*this.GRID_UNIT,this.CORNER_RADIUS=1*this.GRID_UNIT,this.NOTCH_WIDTH=9*this.GRID_UNIT,this.NOTCH_HEIGHT=2*this.GRID_UNIT,this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT=3*this.GRID_UNIT,this.MIN_BLOCK_WIDTH=2*this.GRID_UNIT,this.MIN_BLOCK_HEIGHT=12*this.GRID_UNIT,this.EMPTY_STATEMENT_INPUT_HEIGHT=6*this.GRID_UNIT,this.TAB_OFFSET_FROM_TOP=0,this.TOP_ROW_MIN_HEIGHT=this.CORNER_RADIUS,this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.BOTTOM_ROW_MIN_HEIGHT=this.CORNER_RADIUS,this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=6*this.GRID_UNIT,this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT,this.STATEMENT_INPUT_SPACER_MIN_WIDTH=40*this.GRID_UNIT,this.STATEMENT_INPUT_PADDING_LEFT=4*this.GRID_UNIT,this.EMPTY_INLINE_INPUT_PADDING=4*this.GRID_UNIT,this.EMPTY_INLINE_INPUT_HEIGHT=8*this.GRID_UNIT,this.DUMMY_INPUT_MIN_HEIGHT=8*this.GRID_UNIT,this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=6*this.GRID_UNIT,this.CURSOR_WS_WIDTH=20*this.GRID_UNIT,this.CURSOR_COLOUR="#ffa200",this.CURSOR_RADIUS=5,this.JAGGED_TEETH_WIDTH=this.JAGGED_TEETH_HEIGHT=0,this.START_HAT_HEIGHT=22,this.START_HAT_WIDTH=96,this.SHAPES={HEXAGONAL:1,ROUND:2,SQUARE:3,PUZZLE:4,NOTCH:5},this.SHAPE_IN_SHAPE_PADDING={1:{0:5*this.GRID_UNIT,1:2*this.GRID_UNIT,2:5*this.GRID_UNIT,3:5*this.GRID_UNIT},2:{0:3*this.GRID_UNIT,1:3*this.GRID_UNIT,2:1*this.GRID_UNIT,3:2*this.GRID_UNIT},3:{0:2*this.GRID_UNIT,1:2*this.GRID_UNIT,2:2*this.GRID_UNIT,3:2*this.GRID_UNIT}},this.FULL_BLOCK_FIELDS=!0,this.FIELD_TEXT_FONTSIZE=3*this.GRID_UNIT,this.FIELD_TEXT_FONTWEIGHT="bold",this.FIELD_TEXT_FONTFAMILY='"Helvetica Neue", "Segoe UI", Helvetica, sans-serif',this.FIELD_BORDER_RECT_RADIUS=this.CORNER_RADIUS,this.FIELD_BORDER_RECT_X_PADDING=2*this.GRID_UNIT,this.FIELD_BORDER_RECT_Y_PADDING=1.625*this.GRID_UNIT,this.FIELD_BORDER_RECT_HEIGHT=8*this.GRID_UNIT,this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=8*this.GRID_UNIT,this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!0,this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING,this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=!0,this.FIELD_COLOUR_DEFAULT_WIDTH=2*this.GRID_UNIT,this.FIELD_COLOUR_DEFAULT_HEIGHT=4*this.GRID_UNIT,this.FIELD_CHECKBOX_X_OFFSET=1*this.GRID_UNIT,this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH=12*this.GRID_UNIT,this.SELECTED_GLOW_COLOUR="#fff200",this.SELECTED_GLOW_SIZE=.5,this.REPLACEMENT_GLOW_COLOUR="#fff200",this.REPLACEMENT_GLOW_SIZE=2,this.selectedGlowFilterId="",this.selectedGlowFilter_=null,this.replacementGlowFilterId="",this.replacementGlowFilter_=null},t.utils.object.inherits(t.zelos.ConstantProvider,t.blockRendering.ConstantProvider),t.zelos.ConstantProvider.prototype.setFontConstants_=function(e){t.zelos.ConstantProvider.superClass_.setFontConstants_.call(this,e),this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT=this.FIELD_TEXT_HEIGHT+2*this.FIELD_BORDER_RECT_Y_PADDING},t.zelos.ConstantProvider.prototype.init=function(){t.zelos.ConstantProvider.superClass_.init.call(this),this.HEXAGONAL=this.makeHexagonal(),this.ROUNDED=this.makeRounded(),this.SQUARED=this.makeSquared(),this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT+this.INSIDE_CORNERS.rightWidth},t.zelos.ConstantProvider.prototype.setDynamicProperties_=function(e){t.zelos.ConstantProvider.superClass_.setDynamicProperties_.call(this,e),this.SELECTED_GLOW_COLOUR=e.getComponentStyle("selectedGlowColour")||this.SELECTED_GLOW_COLOUR;var i=Number(e.getComponentStyle("selectedGlowSize"));this.SELECTED_GLOW_SIZE=i&&!isNaN(i)?i:this.SELECTED_GLOW_SIZE,this.REPLACEMENT_GLOW_COLOUR=e.getComponentStyle("replacementGlowColour")||this.REPLACEMENT_GLOW_COLOUR,this.REPLACEMENT_GLOW_SIZE=(e=Number(e.getComponentStyle("replacementGlowSize")))&&!isNaN(e)?e:this.REPLACEMENT_GLOW_SIZE},t.zelos.ConstantProvider.prototype.dispose=function(){t.zelos.ConstantProvider.superClass_.dispose.call(this),this.selectedGlowFilter_&&t.utils.dom.removeNode(this.selectedGlowFilter_),this.replacementGlowFilter_&&t.utils.dom.removeNode(this.replacementGlowFilter_)},t.zelos.ConstantProvider.prototype.makeStartHat=function(){var e=this.START_HAT_HEIGHT,i=this.START_HAT_WIDTH,s=t.utils.svgPaths.curve("c",[t.utils.svgPaths.point(25,-e),t.utils.svgPaths.point(71,-e),t.utils.svgPaths.point(i,0)]);return{height:e,width:i,path:s}},t.zelos.ConstantProvider.prototype.makeHexagonal=function(){function e(s,r,o){var h=s/2;return h=h>i?i:h,o=o?-1:1,s=(r?-1:1)*s/2,t.utils.svgPaths.lineTo(-o*h,s)+t.utils.svgPaths.lineTo(o*h,s)}var i=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;return{type:this.SHAPES.HEXAGONAL,isDynamic:!0,width:function(s){return s/=2,s>i?i:s},height:function(s){return s},connectionOffsetY:function(s){return s/2},connectionOffsetX:function(s){return-s},pathDown:function(s){return e(s,!1,!1)},pathUp:function(s){return e(s,!0,!1)},pathRightDown:function(s){return e(s,!1,!0)},pathRightUp:function(s){return e(s,!1,!0)}}},t.zelos.ConstantProvider.prototype.makeRounded=function(){function e(r,o,h){var u=r>s?r-s:0;return r=(r>s?s:r)/2,t.utils.svgPaths.arc("a","0 0,1",r,t.utils.svgPaths.point((o?-1:1)*r,(o?-1:1)*r))+t.utils.svgPaths.lineOnAxis("v",(h?1:-1)*u)+t.utils.svgPaths.arc("a","0 0,1",r,t.utils.svgPaths.point((o?1:-1)*r,(o?-1:1)*r))}var i=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,s=2*i;return{type:this.SHAPES.ROUND,isDynamic:!0,width:function(r){return r/=2,r>i?i:r},height:function(r){return r},connectionOffsetY:function(r){return r/2},connectionOffsetX:function(r){return-r},pathDown:function(r){return e(r,!1,!1)},pathUp:function(r){return e(r,!0,!1)},pathRightDown:function(r){return e(r,!1,!0)},pathRightUp:function(r){return e(r,!1,!0)}}},t.zelos.ConstantProvider.prototype.makeSquared=function(){function e(s,r,o){return s-=2*i,t.utils.svgPaths.arc("a","0 0,1",i,t.utils.svgPaths.point((r?-1:1)*i,(r?-1:1)*i))+t.utils.svgPaths.lineOnAxis("v",(o?1:-1)*s)+t.utils.svgPaths.arc("a","0 0,1",i,t.utils.svgPaths.point((r?1:-1)*i,(r?-1:1)*i))}var i=this.CORNER_RADIUS;return{type:this.SHAPES.SQUARE,isDynamic:!0,width:function(s){return i},height:function(s){return s},connectionOffsetY:function(s){return s/2},connectionOffsetX:function(s){return-s},pathDown:function(s){return e(s,!1,!1)},pathUp:function(s){return e(s,!0,!1)},pathRightDown:function(s){return e(s,!1,!0)},pathRightUp:function(s){return e(s,!1,!0)}}},t.zelos.ConstantProvider.prototype.shapeFor=function(e){var i=e.getCheck();switch(!i&&e.targetConnection&&(i=e.targetConnection.getCheck()),e.type){case t.connectionTypes.INPUT_VALUE:case t.connectionTypes.OUTPUT_VALUE:if(e=e.getSourceBlock().getOutputShape(),e!=null)switch(e){case this.SHAPES.HEXAGONAL:return this.HEXAGONAL;case this.SHAPES.ROUND:return this.ROUNDED;case this.SHAPES.SQUARE:return this.SQUARED}return i&&i.indexOf("Boolean")!=-1?this.HEXAGONAL:i&&i.indexOf("Number")!=-1?this.ROUNDED:(i&&i.indexOf("String"),this.ROUNDED);case t.connectionTypes.PREVIOUS_STATEMENT:case t.connectionTypes.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown type")}},t.zelos.ConstantProvider.prototype.makeNotch=function(){function e(f){return t.utils.svgPaths.curve("c",[t.utils.svgPaths.point(f*o/2,0),t.utils.svgPaths.point(f*o*3/4,u/2),t.utils.svgPaths.point(f*o,u)])+t.utils.svgPaths.line([t.utils.svgPaths.point(f*o,h)])+t.utils.svgPaths.curve("c",[t.utils.svgPaths.point(f*o/4,u/2),t.utils.svgPaths.point(f*o/2,u),t.utils.svgPaths.point(f*o,u)])+t.utils.svgPaths.lineOnAxis("h",f*r)+t.utils.svgPaths.curve("c",[t.utils.svgPaths.point(f*o/2,0),t.utils.svgPaths.point(f*o*3/4,-(u/2)),t.utils.svgPaths.point(f*o,-u)])+t.utils.svgPaths.line([t.utils.svgPaths.point(f*o,-h)])+t.utils.svgPaths.curve("c",[t.utils.svgPaths.point(f*o/4,-(u/2)),t.utils.svgPaths.point(f*o/2,-u),t.utils.svgPaths.point(f*o,-u)])}var i=this.NOTCH_WIDTH,s=this.NOTCH_HEIGHT,r=i/3,o=r/3,h=s/2,u=h/2,p=e(1),d=e(-1);return{type:this.SHAPES.NOTCH,width:i,height:s,pathLeft:p,pathRight:d}},t.zelos.ConstantProvider.prototype.makeInsideCorners=function(){var e=this.CORNER_RADIUS,i=t.utils.svgPaths.arc("a","0 0,0",e,t.utils.svgPaths.point(-e,e)),s=t.utils.svgPaths.arc("a","0 0,1",e,t.utils.svgPaths.point(-e,e)),r=t.utils.svgPaths.arc("a","0 0,0",e,t.utils.svgPaths.point(e,e)),o=t.utils.svgPaths.arc("a","0 0,1",e,t.utils.svgPaths.point(e,e));return{width:e,height:e,pathTop:i,pathBottom:r,rightWidth:e,rightHeight:e,pathTopRight:s,pathBottomRight:o}},t.zelos.ConstantProvider.prototype.generateSecondaryColour_=function(e){return t.utils.colour.blend("#000",e,.15)||e},t.zelos.ConstantProvider.prototype.generateTertiaryColour_=function(e){return t.utils.colour.blend("#000",e,.25)||e},t.zelos.ConstantProvider.prototype.createDom=function(e,i,s){t.zelos.ConstantProvider.superClass_.createDom.call(this,e,i,s),e=t.utils.dom.createSvgElement(t.utils.Svg.DEFS,{},e),i=t.utils.dom.createSvgElement(t.utils.Svg.FILTER,{id:"blocklySelectedGlowFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e),t.utils.dom.createSvgElement(t.utils.Svg.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.SELECTED_GLOW_SIZE},i),s=t.utils.dom.createSvgElement(t.utils.Svg.FECOMPONENTTRANSFER,{result:"outBlur"},i),t.utils.dom.createSvgElement(t.utils.Svg.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},s),t.utils.dom.createSvgElement(t.utils.Svg.FEFLOOD,{"flood-color":this.SELECTED_GLOW_COLOUR,"flood-opacity":1,result:"outColor"},i),t.utils.dom.createSvgElement(t.utils.Svg.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},i),this.selectedGlowFilterId=i.id,this.selectedGlowFilter_=i,e=t.utils.dom.createSvgElement(t.utils.Svg.FILTER,{id:"blocklyReplacementGlowFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e),t.utils.dom.createSvgElement(t.utils.Svg.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.REPLACEMENT_GLOW_SIZE},e),i=t.utils.dom.createSvgElement(t.utils.Svg.FECOMPONENTTRANSFER,{result:"outBlur"},e),t.utils.dom.createSvgElement(t.utils.Svg.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},i),t.utils.dom.createSvgElement(t.utils.Svg.FEFLOOD,{"flood-color":this.REPLACEMENT_GLOW_COLOUR,"flood-opacity":1,result:"outColor"},e),t.utils.dom.createSvgElement(t.utils.Svg.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},e),t.utils.dom.createSvgElement(t.utils.Svg.FECOMPOSITE,{in:"SourceGraphic",in2:"outGlow",operator:"over"},e),this.replacementGlowFilterId=e.id,this.replacementGlowFilter_=e},t.zelos.ConstantProvider.prototype.getCSS_=function(e){return[e+" .blocklyText,",e+" .blocklyFlyoutLabelText {","font: "+this.FIELD_TEXT_FONTWEIGHT+" "+this.FIELD_TEXT_FONTSIZE+"pt "+this.FIELD_TEXT_FONTFAMILY+";","}",e+" .blocklyText {","fill: #fff;","}",e+" .blocklyNonEditableText>rect:not(.blocklyDropdownRect),",e+" .blocklyEditableText>rect:not(.blocklyDropdownRect) {","fill: "+this.FIELD_BORDER_RECT_COLOUR+";","}",e+" .blocklyNonEditableText>text,",e+" .blocklyEditableText>text,",e+" .blocklyNonEditableText>g>text,",e+" .blocklyEditableText>g>text {","fill: #575E75;","}",e+" .blocklyFlyoutLabelText {","fill: #575E75;","}",e+" .blocklyText.blocklyBubbleText {","fill: #575E75;","}",e+" .blocklyDraggable:not(.blocklyDisabled)"," .blocklyEditableText:not(.editing):hover>rect,",e+" .blocklyDraggable:not(.blocklyDisabled)"," .blocklyEditableText:not(.editing):hover>.blocklyPath {","stroke: #fff;","stroke-width: 2;","}",e+" .blocklyHtmlInput {","font-family: "+this.FIELD_TEXT_FONTFAMILY+";","font-weight: "+this.FIELD_TEXT_FONTWEIGHT+";","color: #575E75;","}",e+" .blocklyDropdownText {","fill: #fff !important;","}",e+".blocklyWidgetDiv .goog-menuitem,",e+".blocklyDropDownDiv .goog-menuitem {","font-family: "+this.FIELD_TEXT_FONTFAMILY+";","}",e+".blocklyDropDownDiv .goog-menuitem-content {","color: #fff;","}",e+" .blocklyHighlightedConnectionPath {","stroke: "+this.SELECTED_GLOW_COLOUR+";","}",e+" .blocklyDisabled > .blocklyOutlinePath {","fill: url(#blocklyDisabledPattern"+this.randomIdentifier+")","}",e+" .blocklyInsertionMarker>.blocklyPath {","fill-opacity: "+this.INSERTION_MARKER_OPACITY+";","stroke: none;","}"]},t.zelos.TopRow=function(e){t.zelos.TopRow.superClass_.constructor.call(this,e)},t.utils.object.inherits(t.zelos.TopRow,t.blockRendering.TopRow),t.zelos.TopRow.prototype.endsWithElemSpacer=function(){return!1},t.zelos.TopRow.prototype.hasLeftSquareCorner=function(e){var i=(e.hat?e.hat==="cap":this.constants_.ADD_START_HATS)&&!e.outputConnection&&!e.previousConnection;return!!e.outputConnection||i},t.zelos.TopRow.prototype.hasRightSquareCorner=function(e){return!!e.outputConnection&&!e.statementInputCount&&!e.nextConnection},t.zelos.BottomRow=function(e){t.zelos.BottomRow.superClass_.constructor.call(this,e)},t.utils.object.inherits(t.zelos.BottomRow,t.blockRendering.BottomRow),t.zelos.BottomRow.prototype.endsWithElemSpacer=function(){return!1},t.zelos.BottomRow.prototype.hasLeftSquareCorner=function(e){return!!e.outputConnection},t.zelos.BottomRow.prototype.hasRightSquareCorner=function(e){return!!e.outputConnection&&!e.statementInputCount&&!e.nextConnection},t.zelos.RightConnectionShape=function(e){t.zelos.RightConnectionShape.superClass_.constructor.call(this,e),this.type|=t.blockRendering.Types.getType("RIGHT_CONNECTION"),this.width=this.height=0},t.utils.object.inherits(t.zelos.RightConnectionShape,t.blockRendering.Measurable),t.zelos.RenderInfo=function(e,i){t.zelos.RenderInfo.superClass_.constructor.call(this,e,i),this.topRow=new t.zelos.TopRow(this.constants_),this.bottomRow=new t.zelos.BottomRow(this.constants_),this.isInline=!0,this.isMultiRow=!i.getInputsInline()||i.isCollapsed(),this.hasStatementInput=0<i.statementInputCount,this.rightSide=this.outputConnection?new t.zelos.RightConnectionShape(this.constants_):null},t.utils.object.inherits(t.zelos.RenderInfo,t.blockRendering.RenderInfo),t.zelos.RenderInfo.prototype.getRenderer=function(){return this.renderer_},t.zelos.RenderInfo.prototype.measure=function(){this.createRows_(),this.addElemSpacing_(),this.addRowSpacing_(),this.adjustXPosition_(),this.computeBounds_(),this.alignRowElements_(),this.finalize_()},t.zelos.RenderInfo.prototype.shouldStartNewRow_=function(e,i){return i?e.type==t.inputTypes.STATEMENT||i.type==t.inputTypes.STATEMENT?!0:e.type==t.inputTypes.VALUE||e.type==t.inputTypes.DUMMY?!this.isInline||this.isMultiRow:!1:!1},t.zelos.RenderInfo.prototype.getDesiredRowWidth_=function(e){return e.hasStatement?this.width-this.startX-(this.constants_.INSIDE_CORNERS.rightWidth||0):t.zelos.RenderInfo.superClass_.getDesiredRowWidth_.call(this,e)},t.zelos.RenderInfo.prototype.getInRowSpacing_=function(e,i){return e&&i||!this.outputConnection||!this.outputConnection.isDynamicShape||this.hasStatementInput||this.bottomRow.hasNextConnection?!e&&i&&t.blockRendering.Types.isStatementInput(i)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:e&&t.blockRendering.Types.isLeftRoundedCorner(e)&&i&&(t.blockRendering.Types.isPreviousConnection(i)||t.blockRendering.Types.isNextConnection(i))?i.notchOffset-this.constants_.CORNER_RADIUS:e&&t.blockRendering.Types.isLeftSquareCorner(e)&&i&&t.blockRendering.Types.isHat(i)?this.constants_.NO_PADDING:this.constants_.MEDIUM_PADDING:this.constants_.NO_PADDING},t.zelos.RenderInfo.prototype.getSpacerRowHeight_=function(e,i){if(t.blockRendering.Types.isTopRow(e)&&t.blockRendering.Types.isBottomRow(i))return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;var s=t.blockRendering.Types.isInputRow(e)&&e.hasStatement,r=t.blockRendering.Types.isInputRow(i)&&i.hasStatement;return r||s?(e=Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.INSIDE_CORNERS.rightHeight||0),r&&s?Math.max(e,this.constants_.DUMMY_INPUT_MIN_HEIGHT):e):t.blockRendering.Types.isTopRow(e)?e.hasPreviousConnection||this.outputConnection&&!this.hasStatementInput?this.constants_.NO_PADDING:Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):t.blockRendering.Types.isBottomRow(i)?this.outputConnection?!i.hasNextConnection&&this.hasStatementInput?Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):this.constants_.NO_PADDING:Math.max(this.topRow.minHeight,Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.CORNER_RADIUS))-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING},t.zelos.RenderInfo.prototype.getSpacerRowWidth_=function(e,i){var s=this.width-this.startX;return t.blockRendering.Types.isInputRow(e)&&e.hasStatement||t.blockRendering.Types.isInputRow(i)&&i.hasStatement?Math.max(s,this.constants_.STATEMENT_INPUT_SPACER_MIN_WIDTH):s},t.zelos.RenderInfo.prototype.getElemCenterline_=function(e,i){if(e.hasStatement&&!t.blockRendering.Types.isSpacer(i)&&!t.blockRendering.Types.isStatementInput(i))return e.yPos+this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT/2;if(t.blockRendering.Types.isInlineInput(i)){var s=i.connectedBlock;if(s&&s.outputConnection&&s.nextConnection)return e.yPos+s.height/2}return t.zelos.RenderInfo.superClass_.getElemCenterline_.call(this,e,i)},t.zelos.RenderInfo.prototype.addInput_=function(e,i){e.type==t.inputTypes.DUMMY&&i.hasDummyInput&&i.align==t.constants.ALIGN.LEFT&&e.align==t.constants.ALIGN.RIGHT&&(i.rightAlignedDummyInput=e),t.zelos.RenderInfo.superClass_.addInput_.call(this,e,i)},t.zelos.RenderInfo.prototype.addAlignmentPadding_=function(e,i){if(e.rightAlignedDummyInput){for(var s,r=0,o;(o=e.elements[r])&&(t.blockRendering.Types.isSpacer(o)&&(s=o),!t.blockRendering.Types.isField(o)||o.parentInput!=e.rightAlignedDummyInput);r++);if(s){s.width+=i,e.width+=i;return}}t.zelos.RenderInfo.superClass_.addAlignmentPadding_.call(this,e,i)},t.zelos.RenderInfo.prototype.adjustXPosition_=function(){for(var e=this.constants_.NOTCH_OFFSET_LEFT+this.constants_.NOTCH_WIDTH,i=e,s=2;s<this.rows.length-1;s+=2){var r=this.rows[s-1],o=this.rows[s],h=this.rows[s+1];if(r=s==2?!!this.topRow.hasPreviousConnection:!!r.followsStatement,h=s+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!h.precedesStatement,t.blockRendering.Types.isInputRow(o)&&o.hasStatement)o.measure(),i=o.width-o.getLastInput().width+e;else if(r&&(s==2||h)&&t.blockRendering.Types.isInputRow(o)&&!o.hasStatement){h=o.xPos,r=null;for(var u=0,p;p=o.elements[u];u++)t.blockRendering.Types.isSpacer(p)&&(r=p),!(r&&(t.blockRendering.Types.isField(p)||t.blockRendering.Types.isInput(p))&&h<i)||t.blockRendering.Types.isField(p)&&(p.field instanceof t.FieldLabel||p.field instanceof t.FieldImage)||(r.width+=i-h),h+=p.width}}},t.zelos.RenderInfo.prototype.finalizeOutputConnection_=function(){if(this.outputConnection&&this.outputConnection.isDynamicShape){for(var e=0,i=0,s;s=this.rows[i];i++)s.yPos=e,e+=s.height;this.height=e,i=this.bottomRow.hasNextConnection?this.height-this.bottomRow.descenderHeight:this.height,e=this.outputConnection.shape.height(i),i=this.outputConnection.shape.width(i),this.outputConnection.height=e,this.outputConnection.width=i,this.outputConnection.startX=i,this.outputConnection.connectionOffsetY=this.outputConnection.shape.connectionOffsetY(e),this.outputConnection.connectionOffsetX=this.outputConnection.shape.connectionOffsetX(i),s=0,this.hasStatementInput||this.bottomRow.hasNextConnection||(s=i,this.rightSide.height=e,this.rightSide.width=s,this.rightSide.centerline=e/2,this.rightSide.xPos=this.width+s),this.startX=i,this.width+=i+s,this.widthWithChildren+=i+s}},t.zelos.RenderInfo.prototype.finalizeHorizontalAlignment_=function(){if(this.outputConnection&&!this.hasStatementInput&&!this.bottomRow.hasNextConnection){for(var e=0,i=0,s;s=this.rows[i];i++)if(t.blockRendering.Types.isInputRow(s)){e=s.elements[s.elements.length-2];var r=this.getNegativeSpacing_(s.elements[1]),o=this.getNegativeSpacing_(e);e=r+o;var h=this.constants_.MIN_BLOCK_WIDTH+2*this.outputConnection.width;this.width-e<h&&(e=this.width-h,r=e/2,o=e/2),s.elements.unshift(new t.blockRendering.InRowSpacer(this.constants_,-r)),s.elements.push(new t.blockRendering.InRowSpacer(this.constants_,-o))}if(e)for(this.width-=e,this.widthWithChildren-=e,this.rightSide.xPos-=e,i=0;s=this.rows[i];i++)t.blockRendering.Types.isTopOrBottomRow(s)&&(s.elements[1].width-=e,s.elements[1].widthWithConnectedBlocks-=e),s.width-=e,s.widthWithConnectedBlocks-=e}},t.zelos.RenderInfo.prototype.getNegativeSpacing_=function(e){if(!e)return 0;var i=this.outputConnection.width,s=this.outputConnection.shape.type,r=this.constants_;if(this.isMultiRow&&1<this.inputRows.length)switch(s){case r.SHAPES.ROUND:return s=this.constants_.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,s=this.height/2>s?s:this.height/2,i-s*(1-Math.sin(Math.acos((s-this.constants_.SMALL_PADDING)/s)));default:return 0}if(t.blockRendering.Types.isInlineInput(e)){var o=e.connectedBlock;return e=o?o.pathObject.outputShapeType:e.shape.type,o&&o.outputConnection&&(o.statementInputCount||o.nextConnection)||s==r.SHAPES.HEXAGONAL&&s!=e?0:i-this.constants_.SHAPE_IN_SHAPE_PADDING[s][e]}return t.blockRendering.Types.isField(e)?s==r.SHAPES.ROUND&&e.field instanceof t.FieldTextInput?i-2.75*r.GRID_UNIT:i-this.constants_.SHAPE_IN_SHAPE_PADDING[s][0]:t.blockRendering.Types.isIcon(e)?this.constants_.SMALL_PADDING:0},t.zelos.RenderInfo.prototype.finalizeVerticalAlignment_=function(){if(!this.outputConnection)for(var e=2;e<this.rows.length-1;e+=2){var i=this.rows[e-1],s=this.rows[e],r=this.rows[e+1],o=e==2,h=e+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!r.precedesStatement;if(o?this.topRow.hasPreviousConnection:i.followsStatement){var u=s.elements.length==3&&(s.elements[1].field instanceof t.FieldLabel||s.elements[1].field instanceof t.FieldImage);if(!o&&u)i.height-=this.constants_.SMALL_PADDING,r.height-=this.constants_.SMALL_PADDING,s.height-=this.constants_.MEDIUM_PADDING;else if(!o&&!h)i.height+=this.constants_.SMALL_PADDING;else if(h){for(o=!1,h=0;u=s.elements[h];h++)if(t.blockRendering.Types.isInlineInput(u)&&u.connectedBlock&&!u.connectedBlock.isShadow()&&40<=u.connectedBlock.getHeightWidth().height){o=!0;break}o&&(i.height-=this.constants_.SMALL_PADDING,r.height-=this.constants_.SMALL_PADDING)}}}},t.zelos.RenderInfo.prototype.finalize_=function(){this.finalizeOutputConnection_(),this.finalizeHorizontalAlignment_(),this.finalizeVerticalAlignment_(),t.zelos.RenderInfo.superClass_.finalize_.call(this),this.rightSide&&(this.widthWithChildren+=this.rightSide.width)},t.zelos.Drawer=function(e,i){t.zelos.Drawer.superClass_.constructor.call(this,e,i)},t.utils.object.inherits(t.zelos.Drawer,t.blockRendering.Drawer),t.zelos.Drawer.prototype.draw=function(){var e=this.block_.pathObject;e.beginDrawing(),this.hideHiddenIcons_(),this.drawOutline_(),this.drawInternals_(),e.setPath(this.outlinePath_+`
`+this.inlinePath_),this.info_.RTL&&e.flipRTL(),t.blockRendering.useDebugger&&this.block_.renderingDebugger.drawDebug(this.block_,this.info_),this.recordSizeOnBlock_(),this.info_.outputConnection&&(e.outputShapeType=this.info_.outputConnection.shape.type),e.endDrawing()},t.zelos.Drawer.prototype.drawOutline_=function(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape&&!this.info_.hasStatementInput&&!this.info_.bottomRow.hasNextConnection?(this.drawFlatTop_(),this.drawRightDynamicConnection_(),this.drawFlatBottom_(),this.drawLeftDynamicConnection_()):t.zelos.Drawer.superClass_.drawOutline_.call(this)},t.zelos.Drawer.prototype.drawLeft_=function(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape?this.drawLeftDynamicConnection_():t.zelos.Drawer.superClass_.drawLeft_.call(this)},t.zelos.Drawer.prototype.drawRightSideRow_=function(e){if(!(0>=e.height))if(e.precedesStatement||e.followsStatement){var i=this.constants_.INSIDE_CORNERS.rightHeight;i=e.height-(e.precedesStatement?i:0),this.outlinePath_+=(e.followsStatement?this.constants_.INSIDE_CORNERS.pathBottomRight:"")+(0<i?t.utils.svgPaths.lineOnAxis("V",e.yPos+i):"")+(e.precedesStatement?this.constants_.INSIDE_CORNERS.pathTopRight:"")}else this.outlinePath_+=t.utils.svgPaths.lineOnAxis("V",e.yPos+e.height)},t.zelos.Drawer.prototype.drawRightDynamicConnection_=function(){this.outlinePath_+=this.info_.outputConnection.shape.pathRightDown(this.info_.outputConnection.height)},t.zelos.Drawer.prototype.drawLeftDynamicConnection_=function(){this.positionOutputConnection_(),this.outlinePath_+=this.info_.outputConnection.shape.pathUp(this.info_.outputConnection.height),this.outlinePath_+="z"},t.zelos.Drawer.prototype.drawFlatTop_=function(){var e=this.info_.topRow;this.positionPreviousConnection_(),this.outlinePath_+=t.utils.svgPaths.moveBy(e.xPos,this.info_.startY),this.outlinePath_+=t.utils.svgPaths.lineOnAxis("h",e.width)},t.zelos.Drawer.prototype.drawFlatBottom_=function(){var e=this.info_.bottomRow;this.positionNextConnection_(),this.outlinePath_+=t.utils.svgPaths.lineOnAxis("V",e.baseline),this.outlinePath_+=t.utils.svgPaths.lineOnAxis("h",-e.width)},t.zelos.Drawer.prototype.drawInlineInput_=function(e){this.positionInlineInputConnection_(e);var i=e.input.name;if(!e.connectedBlock&&!this.info_.isInsertionMarker){var s=e.width-2*e.connectionWidth;e=t.utils.svgPaths.moveTo(e.xPos+e.connectionWidth,e.centerline-e.height/2)+t.utils.svgPaths.lineOnAxis("h",s)+e.shape.pathRightDown(e.height)+t.utils.svgPaths.lineOnAxis("h",-s)+e.shape.pathUp(e.height)+"z",this.block_.pathObject.setOutlinePath(i,e)}},t.zelos.Drawer.prototype.drawStatementInput_=function(e){var i=e.getLastInput(),s=i.xPos+i.notchOffset+i.shape.width,r=i.shape.pathRight+t.utils.svgPaths.lineOnAxis("h",-(i.notchOffset-this.constants_.INSIDE_CORNERS.width))+this.constants_.INSIDE_CORNERS.pathTop,o=e.height-2*this.constants_.INSIDE_CORNERS.height;i=this.constants_.INSIDE_CORNERS.pathBottom+t.utils.svgPaths.lineOnAxis("h",i.notchOffset-this.constants_.INSIDE_CORNERS.width)+(i.connectedBottomNextConnection?"":i.shape.pathLeft),this.outlinePath_+=t.utils.svgPaths.lineOnAxis("H",s)+r+t.utils.svgPaths.lineOnAxis("v",o)+i+t.utils.svgPaths.lineOnAxis("H",e.xPos+e.width),this.positionStatementInputConnection_(e)},t.zelos.MarkerSvg=function(e,i,s){t.zelos.MarkerSvg.superClass_.constructor.call(this,e,i,s)},t.utils.object.inherits(t.zelos.MarkerSvg,t.blockRendering.MarkerSvg),t.zelos.MarkerSvg.prototype.showWithInputOutput_=function(e){var i=e.getSourceBlock();e=e.getLocation().getOffsetInBlock(),this.positionCircle_(e.x,e.y),this.setParent_(i),this.showCurrent_()},t.zelos.MarkerSvg.prototype.showWithOutput_=function(e){this.showWithInputOutput_(e)},t.zelos.MarkerSvg.prototype.showWithInput_=function(e){this.showWithInputOutput_(e)},t.zelos.MarkerSvg.prototype.showWithBlock_=function(e){e=e.getLocation();var i=e.getHeightWidth();this.positionRect_(0,0,i.width,i.height),this.setParent_(e),this.showCurrent_()},t.zelos.MarkerSvg.prototype.positionCircle_=function(e,i){this.markerCircle_.setAttribute("cx",e),this.markerCircle_.setAttribute("cy",i),this.currentMarkerSvg=this.markerCircle_},t.zelos.MarkerSvg.prototype.hide=function(){t.zelos.MarkerSvg.superClass_.hide.call(this),this.markerCircle_.style.display="none"},t.zelos.MarkerSvg.prototype.createDomInternal_=function(){if(t.zelos.MarkerSvg.superClass_.createDomInternal_.call(this),this.markerCircle_=t.utils.dom.createSvgElement(t.utils.Svg.CIRCLE,{r:this.constants_.CURSOR_RADIUS,style:"display: none","stroke-width":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_),this.isCursor()){var e=this.getBlinkProperties_();t.utils.dom.createSvgElement(t.utils.Svg.ANIMATE,e,this.markerCircle_)}return this.markerSvg_},t.zelos.MarkerSvg.prototype.applyColour_=function(e){t.zelos.MarkerSvg.superClass_.applyColour_.call(this,e),this.markerCircle_.setAttribute("fill",this.colour_),this.markerCircle_.setAttribute("stroke",this.colour_),this.isCursor()&&this.markerCircle_.firstChild.setAttribute("values",this.colour_+";transparent;transparent;")},t.zelos.PathObject=function(e,i,s){t.zelos.PathObject.superClass_.constructor.call(this,e,i,s),this.constants=s,this.svgPathSelected_=null,this.outlines_={},this.outputShapeType=this.remainingOutlines_=null},t.utils.object.inherits(t.zelos.PathObject,t.blockRendering.PathObject),t.zelos.PathObject.prototype.setPath=function(e){t.zelos.PathObject.superClass_.setPath.call(this,e),this.svgPathSelected_&&this.svgPathSelected_.setAttribute("d",e)},t.zelos.PathObject.prototype.applyColour=function(e){t.zelos.PathObject.superClass_.applyColour.call(this,e),e.isShadow()&&e.getParent()&&this.svgPath.setAttribute("stroke",e.getParent().style.colourTertiary),e=0;for(var i=Object.keys(this.outlines_),s;s=i[e];e++)this.outlines_[s].setAttribute("fill",this.style.colourTertiary)},t.zelos.PathObject.prototype.flipRTL=function(){t.zelos.PathObject.superClass_.flipRTL.call(this);for(var e=0,i=Object.keys(this.outlines_),s;s=i[e];e++)this.outlines_[s].setAttribute("transform","scale(-1 1)")},t.zelos.PathObject.prototype.updateSelected=function(e){this.setClass_("blocklySelected",e),e?this.svgPathSelected_||(this.svgPathSelected_=this.svgPath.cloneNode(!0),this.svgPathSelected_.setAttribute("fill","none"),this.svgPathSelected_.setAttribute("filter","url(#"+this.constants.selectedGlowFilterId+")"),this.svgRoot.appendChild(this.svgPathSelected_)):this.svgPathSelected_&&(this.svgRoot.removeChild(this.svgPathSelected_),this.svgPathSelected_=null)},t.zelos.PathObject.prototype.updateReplacementFade=function(e){this.setClass_("blocklyReplaceable",e),e?this.svgPath.setAttribute("filter","url(#"+this.constants.replacementGlowFilterId+")"):this.svgPath.removeAttribute("filter")},t.zelos.PathObject.prototype.updateShapeForInputHighlight=function(e,i){e=e.getParentInput().name,(e=this.getOutlinePath_(e))&&(i?e.setAttribute("filter","url(#"+this.constants.replacementGlowFilterId+")"):e.removeAttribute("filter"))},t.zelos.PathObject.prototype.beginDrawing=function(){this.remainingOutlines_={};for(var e=0,i=Object.keys(this.outlines_),s;s=i[e];e++)this.remainingOutlines_[s]=1},t.zelos.PathObject.prototype.endDrawing=function(){if(this.remainingOutlines_)for(var e=0,i=Object.keys(this.remainingOutlines_),s;s=i[e];e++)this.removeOutlinePath_(s);this.remainingOutlines_=null},t.zelos.PathObject.prototype.setOutlinePath=function(e,i){e=this.getOutlinePath_(e),e.setAttribute("d",i),e.setAttribute("fill",this.style.colourTertiary)},t.zelos.PathObject.prototype.getOutlinePath_=function(e){return this.outlines_[e]||(this.outlines_[e]=t.utils.dom.createSvgElement(t.utils.Svg.PATH,{class:"blocklyOutlinePath",d:""},this.svgRoot)),this.remainingOutlines_&&delete this.remainingOutlines_[e],this.outlines_[e]},t.zelos.PathObject.prototype.removeOutlinePath_=function(e){this.outlines_[e].parentNode.removeChild(this.outlines_[e]),delete this.outlines_[e]},t.zelos.Renderer=function(e){t.zelos.Renderer.superClass_.constructor.call(this,e)},t.utils.object.inherits(t.zelos.Renderer,t.blockRendering.Renderer),t.zelos.Renderer.prototype.makeConstants_=function(){return new t.zelos.ConstantProvider},t.zelos.Renderer.prototype.makeRenderInfo_=function(e){return new t.zelos.RenderInfo(this,e)},t.zelos.Renderer.prototype.makeDrawer_=function(e,i){return new t.zelos.Drawer(e,i)},t.zelos.Renderer.prototype.makeMarkerDrawer=function(e,i){return new t.zelos.MarkerSvg(e,this.getConstants(),i)},t.zelos.Renderer.prototype.makePathObject=function(e,i){return new t.zelos.PathObject(e,i,this.getConstants())},t.zelos.Renderer.prototype.shouldHighlightConnection=function(e){return e.type!=t.connectionTypes.INPUT_VALUE&&e.type!==t.connectionTypes.OUTPUT_VALUE},t.zelos.Renderer.prototype.getConnectionPreviewMethod=function(e,i,s){return i.type==t.connectionTypes.OUTPUT_VALUE?e.isConnected()?t.InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE:t.InsertionMarkerManager.PREVIEW_TYPE.INPUT_OUTLINE:t.zelos.Renderer.superClass_.getConnectionPreviewMethod(e,i,s)},t.blockRendering.register("zelos",t.zelos.Renderer),t.Themes.Dark=t.Theme.defineTheme("dark",{base:t.Themes.Classic,componentStyles:{workspaceBackgroundColour:"#1e1e1e",toolboxBackgroundColour:"blackBackground",toolboxForegroundColour:"#fff",flyoutBackgroundColour:"#252526",flyoutForegroundColour:"#ccc",flyoutOpacity:1,scrollbarColour:"#797979",insertionMarkerColour:"#fff",insertionMarkerOpacity:.3,scrollbarOpacity:.4,cursorColour:"#d0d0d0",blackBackground:"#333"}}),t.Themes.Deuteranopia={},t.Themes.Deuteranopia.defaultBlockStyles={colour_blocks:{colourPrimary:"#f2a72c",colourSecondary:"#f1c172",colourTertiary:"#da921c"},list_blocks:{colourPrimary:"#7d65ab",colourSecondary:"#a88be0",colourTertiary:"#66518e"},logic_blocks:{colourPrimary:"#9fd2f1",colourSecondary:"#c0e0f4",colourTertiary:"#74bae5"},loop_blocks:{colourPrimary:"#795a07",colourSecondary:"#ac8726",colourTertiary:"#c4a03f"},math_blocks:{colourPrimary:"#e6da39",colourSecondary:"#f3ec8e",colourTertiary:"#f2eeb7"},procedure_blocks:{colourPrimary:"#590721",colourSecondary:"#8c475d",colourTertiary:"#885464"},text_blocks:{colourPrimary:"#058863",colourSecondary:"#5ecfaf",colourTertiary:"#04684c"},variable_blocks:{colourPrimary:"#47025a",colourSecondary:"#820fa1",colourTertiary:"#8e579d"},variable_dynamic_blocks:{colourPrimary:"#47025a",colourSecondary:"#820fa1",colourTertiary:"#8e579d"}},t.Themes.Deuteranopia.categoryStyles={colour_category:{colour:"#f2a72c"},list_category:{colour:"#7d65ab"},logic_category:{colour:"#9fd2f1"},loop_category:{colour:"#795a07"},math_category:{colour:"#e6da39"},procedure_category:{colour:"#590721"},text_category:{colour:"#058863"},variable_category:{colour:"#47025a"},variable_dynamic_category:{colour:"#47025a"}},t.Themes.Deuteranopia=new t.Theme("deuteranopia",t.Themes.Deuteranopia.defaultBlockStyles,t.Themes.Deuteranopia.categoryStyles),t.Themes.HighContrast={},t.Themes.HighContrast.defaultBlockStyles={colour_blocks:{colourPrimary:"#a52714",colourSecondary:"#FB9B8C",colourTertiary:"#FBE1DD"},list_blocks:{colourPrimary:"#4a148c",colourSecondary:"#AD7BE9",colourTertiary:"#CDB6E9"},logic_blocks:{colourPrimary:"#01579b",colourSecondary:"#64C7FF",colourTertiary:"#C5EAFF"},loop_blocks:{colourPrimary:"#33691e",colourSecondary:"#9AFF78",colourTertiary:"#E1FFD7"},math_blocks:{colourPrimary:"#1a237e",colourSecondary:"#8A9EFF",colourTertiary:"#DCE2FF"},procedure_blocks:{colourPrimary:"#006064",colourSecondary:"#77E6EE",colourTertiary:"#CFECEE"},text_blocks:{colourPrimary:"#004d40",colourSecondary:"#5ae27c",colourTertiary:"#D2FFDD"},variable_blocks:{colourPrimary:"#880e4f",colourSecondary:"#FF73BE",colourTertiary:"#FFD4EB"},variable_dynamic_blocks:{colourPrimary:"#880e4f",colourSecondary:"#FF73BE",colourTertiary:"#FFD4EB"},hat_blocks:{colourPrimary:"#880e4f",colourSecondary:"#FF73BE",colourTertiary:"#FFD4EB",hat:"cap"}},t.Themes.HighContrast.categoryStyles={colour_category:{colour:"#a52714"},list_category:{colour:"#4a148c"},logic_category:{colour:"#01579b"},loop_category:{colour:"#33691e"},math_category:{colour:"#1a237e"},procedure_category:{colour:"#006064"},text_category:{colour:"#004d40"},variable_category:{colour:"#880e4f"},variable_dynamic_category:{colour:"#880e4f"}},t.Themes.HighContrast=new t.Theme("highcontrast",t.Themes.HighContrast.defaultBlockStyles,t.Themes.HighContrast.categoryStyles),t.Themes.HighContrast.setComponentStyle("selectedGlowColour","#000000"),t.Themes.HighContrast.setComponentStyle("selectedGlowSize",1),t.Themes.HighContrast.setComponentStyle("replacementGlowColour","#000000"),t.Themes.HighContrast.setFontStyle({family:null,weight:null,size:16}),t.Themes.Tritanopia={},t.Themes.Tritanopia.defaultBlockStyles={colour_blocks:{colourPrimary:"#05427f",colourSecondary:"#2974c0",colourTertiary:"#2d74bb"},list_blocks:{colourPrimary:"#b69ce8",colourSecondary:"#ccbaef",colourTertiary:"#9176c5"},logic_blocks:{colourPrimary:"#9fd2f1",colourSecondary:"#c0e0f4",colourTertiary:"#74bae5"},loop_blocks:{colourPrimary:"#aa1846",colourSecondary:"#d36185",colourTertiary:"#7c1636"},math_blocks:{colourPrimary:"#e6da39",colourSecondary:"#f3ec8e",colourTertiary:"#f2eeb7"},procedure_blocks:{colourPrimary:"#590721",colourSecondary:"#8c475d",colourTertiary:"#885464"},text_blocks:{colourPrimary:"#058863",colourSecondary:"#5ecfaf",colourTertiary:"#04684c"},variable_blocks:{colourPrimary:"#4b2d84",colourSecondary:"#816ea7",colourTertiary:"#83759e"},variable_dynamic_blocks:{colourPrimary:"#4b2d84",colourSecondary:"#816ea7",colourTertiary:"#83759e"}},t.Themes.Tritanopia.categoryStyles={colour_category:{colour:"#05427f"},list_category:{colour:"#b69ce8"},logic_category:{colour:"#9fd2f1"},loop_category:{colour:"#aa1846"},math_category:{colour:"#e6da39"},procedure_category:{colour:"#590721"},text_category:{colour:"#058863"},variable_category:{colour:"#4b2d84"},variable_dynamic_category:{colour:"#4b2d84"}},t.Themes.Tritanopia=new t.Theme("tritanopia",t.Themes.Tritanopia.defaultBlockStyles,t.Themes.Tritanopia.categoryStyles),t.requires={},t})}(blockly_compressed$1)),blockly_compressed$1.exports}var blockly$2=blockly$3.exports,hasRequiredBlockly$1;function requireBlockly$1(){return hasRequiredBlockly$1||(hasRequiredBlockly$1=1,function(l,n){(function(t,e){l.exports=e(requireBlockly_compressed())})(blockly$2,function(t){return t})}(blockly$3)),blockly$3.exports}var coreBrowser=coreBrowser$1.exports,hasRequiredCoreBrowser;function requireCoreBrowser(){return hasRequiredCoreBrowser||(hasRequiredCoreBrowser=1,function(l,n){(function(t,e){l.exports=e(requireBlockly$1())})(coreBrowser,function(t){return t.setLocale=function(e){t.Msg=t.Msg||{},Object.keys(e).forEach(function(i){t.Msg[i]=e[i]})},t})}(coreBrowser$1)),coreBrowser$1.exports}var coreBrowserExports=requireCoreBrowser();class SimObject extends Object3D{constructor(){super(),this.name=void 0,this.type="simObject",this.shape="cube",this.attached=!1,this.hasBody=!1,this.body=void 0,this.checkBox=void 0,this.checkSphere=void 0,this.control=void 0,this._fieldValues=[5,0,0,0,0,0],this.color="#eb4034",this.highlighted=!1,this.bodyShape="box",this.radius=0,this.mass=0,this.size=new Vector3(.5,.5,.5),this.scaleFactor=1,this.grippable=!0,this.grippableAxisIndependent=!0,this.gripAxes=[]}_calcFieldValues(){let n=[],t=[];this.position.toArray(n),this.bodyShape==="sphere"?n[2]=n[2]-this.radius:this.bodyShape==="cylinder"?n[2]=n[2]-this.size.z*.5:n[2]=n[2]-this.size.z*.5,this.rotation.toArray(t);for(let e=0;e<3;e++){let i=this._radToDeg(t[e]);n.push(parseInt(i.toFixed()))}return n}updateFieldValues(){this._fieldValues=this._calcFieldValues()}_radToDeg(n){return n*180/Math.PI}_degToRad(n){return n*Math.PI/180}getFieldValues(){return this._fieldValues}setFieldValues(n){this._fieldValues=n}updateFromFieldValues(){let n=[],t=[];for(let e=0;e<3;e++)n.push(this._fieldValues[e]),t.push(parseFloat(this._degToRad(this._fieldValues[e+3]).toFixed(3)));for(let e=0;e<2;e++)this.position.setComponent(e,n[e]);this.position.setComponent(2,n[2]+this.size.z*.5),this.rotation.fromArray(t)}_objectChange(){if(this.control.visible&&!this.attached){const n=new Box3().setFromObject(this),t=new Plane$1(new Vector3(0,0,1)),e=t.distanceToPoint(this.position);if(t.intersectsBox(n))return this.control.enabled=!1,this.position.z=this.position.z+.001,this._objectChange();if(e<0)return this.position.z=0,this.control.enabled=!1,this._objectChange();this.control.enabled=!0;return}}_floorCollision(){const n=new Box3().setFromObject(this),t=new Plane$1(new Vector3(0,0,1)),e=t.distanceToPoint(this.position);return t.intersectsBox(n)?(this.position.z=this.position.z+.001,this._floorCollision()):e<0?(this.position.z=0,this._floorCollision()):void 0}updatePoseBlock(){const n=["X","Y","Z","ROLL","PITCH","YAW"],t=coreBrowserExports.getMainWorkspace();if(t){const i=t.getBlockById(this.name);if(i){const s=i.getInputTargetBlock("POSE");if(s)for(var e=0;e<this._fieldValues.length;e++){let r=this._fieldValues[e];s.setFieldValue(r,n[e])}}}}render(){requestAF()}addToScene(){const n=getScene();getWorld(),n.add(this),this.initTransformControl(),this.render()}removeFromScene(){const n=getScene(),t=getWorld();this.hasBody&&t.removeBody(this.body),this.isAttached&&n.attach(this),this.control.visible=!0,n.remove(this.control),n.remove(this),t.removeBody(this.body),this.render()}makeVisible(){getScene().add(this.control),this.visible=!0,this.render()}hide(){getScene().remove(this.control),this.setTransformControlEnabled(!1),this.visible=!1,this.render()}highlight(n){const t=this.children.length;if(n){for(let e=0;e<t;e++)if(this.children[e].material.emissive!=null){const i=this.children[e].material.color.getHex();this.children[e].material.emissive.setHex(i)}this.highlighted=n}else if(!n){for(let e=0;e<t;e++)this.children[e].material.emissive!=null&&this.children[e].material.emissive.setHex(0);this.highlighted=n}this.render()}setColor(n){const t=this.children.length,e=this.children;this.color=n;for(let i=0;i<t;i++)e[i].material=new MeshPhongMaterial({color:n})}setScale(n){this.scaleFactor=n,this.scale.set(n,n,n),this.children[0].geometry.computeBoundingBox(),this.children[0].geometry.boundingBox.getCenter(),this.children[0].geometry.center();const t=new Vector3;new Box3().setFromObject(this).getSize(t),this.size.copy(t),this.createBody(.5*n,2,.1),this.setGrippable(),this.setGripAxes(),this._floorCollision(),this.updateFieldValues(),this.updatePoseBlock(),this.render()}changeShape(n){this.shape=n;const t=getWorld();this.removeFromScene();const e=this.children.length,i=this.children;for(let s=0;s<e;s++)this.remove(i[s]);t.removeBody(this.body),addGeometry(this),remControledSimObject(),this.addToScene(),console.log("Changed to shape: ",n)}reset(){this.updateFromFieldValues(),this.attached=!1,this.removeBodyFromWorld(),this.render()}createBody(n,t,e){const i=new Body({mass:n});switch(getWorld(),i.material=new Material({friction:t,restitution:e}),i.allowSleep=!0,this.bodyShape){case"sphere":{const s=new Sphere(this.radius*this.scaleFactor);i.sleepSpeedLimit=1.2,i.sleepTimeLimit=.2,i.addShape(s)}break;case"cylinder":{const s=this.size.x*.5,r=this.size.z*.5,o=this.size.y,h=12,u=new Cylinder(s,r,o,h);i.sleepSpeedLimit=.5,i.sleepTimeLimit=.2,i.addShape(u)}break;case"box":default:{const s=new Box(new Vec3(this.size.x*.5,this.size.y*.5,this.size.z*.5));i.sleepSpeedLimit=.5,i.sleepTimeLimit=.2,i.addShape(s)}}this.hasBody=!0,this.mass=n,this.body=i,this.body.name=this.name,this.body.sleep(),this.updateBody()}updateBody(){this.body.position.copy(this.position),this.body.quaternion.copy(this.quaternion)}updateMesh(){this.position.copy(this.body.position),this.quaternion.copy(this.body.quaternion)}addBodyToWorld(){getWorld().addBody(this.body)}removeBodyFromWorld(){getWorld().removeBody(this.body)}initTransformControl(){const n=getControl(),t=getScene();this.control=new TransformControls(n.camera,n.renderer.domElement),this.control.setSize(canHover()?1.25:2.5),this.control.addEventListener("dragging-changed",e=>this._draggingCanged(e)),this.control.addEventListener("objectChange",()=>this._objectChange()),this.control.attach(this),t.add(this.control),this.control.visible=!1,this.control.enabled=this.control.visible}setTransformControlEnabled(n){this.control.enabled=n,this.control.visible=n}_draggingCanged(n){const t=getControl();t.orbitControls.enabled=!n.value}detachFromGripper(n){getScene().attach(this),this.attached=!1,this.control.enabled=!0,this.addBodyToWorld(),this.updateBody(),this.body.wakeUp(),this.body.updateInertiaWorld(),console.log("> Object dropped!")}attachToGripper(n){this.removeBodyFromWorld();const t=getScene(),e=n.tcp.object;this.attached=!0,this.wasGripped=!0,this.control.enabled=!1,t.remove(this.control),e.attach(this),this.updateBody(),console.log("> Object gripped!")}isGrippable(){return this.grippable}isGrippableAxisIndependent(){return this.grippableAxisIndependent}setGrippable(){const n=[];this.size.toArray(n),Math.max(...n)*this.scaleFactor<=.8?(this.grippable=!0,this.grippableAxisIndependent=!0):Math.min(...n)*this.scaleFactor<=.8?(this.grippable=!0,this.grippableAxisIndependent=!1):(this.grippable=!1,this.grippableAxisIndependent=!1)}setGripAxes(){const n=[],t=[0,0,0];this.gripAxes=[],this.size.toArray(n);const e=Math.min(...n),i=Math.max(...n);let s;for(let o=0;o<n.length;o++)n[o]===i&&(s=o),n[o];t[s]=1;const r=new Vector3().fromArray(t);this.gripAxes.push(r)}checkGripperOrientation(n){let t=!1;const e=n.hand.links[0],i=new Vector3;e.getWorldPosition(i);const s=n.tcp.object,r=new Vector3,o=new Quaternion$1;s.getWorldPosition(r),s.getWorldQuaternion(o);const h=new Vector3(0,0,1);h.applyQuaternion(o),h.normalize();const u=new Vector3(0,1,0),p=n.hand.movable[0];let d=new Quaternion$1;p.getWorldQuaternion(d),u.applyQuaternion(d),u.normalize();let f=new Quaternion$1,g=new Vector3().copy(this.gripAxes[0]);this.getWorldQuaternion(f),g.applyQuaternion(f),g.normalize();let _=this._radToDeg(g.angleTo(h)),v=this._radToDeg(g.angleTo(u));return console.log("Angle gripAxis to zAxisTCP, xi, (green to yellow)",_),console.log("Angle gripAxis to fingerNormal, tau, (green to pink)",v),this.position.distanceTo(r),75<v&&v<115?(0<_&&_<15||170<_&&_<185,t=!0,console.log("can grip")):(t=!1,console.log("can not grip")),t}}const Visible=0,Deleted=1,_v1=new Vector3,_line3=new Line3,_plane=new Plane$1,_closestPoint=new Vector3,_triangle=new Triangle;class ConvexHull{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new VertexList,this.unassigned=new VertexList,this.vertices=[]}setFromPoints(n){Array.isArray(n)!==!0&&console.error("THREE.ConvexHull: Points parameter is not an array."),n.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(let t=0,e=n.length;t<e;t++)this.vertices.push(new VertexNode(n[t]));return this.compute(),this}setFromObject(n){const t=[];return n.updateMatrixWorld(!0),n.traverse(function(e){const i=e.geometry;if(i!==void 0){if(i.isGeometry){console.error("THREE.ConvexHull no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else if(i.isBufferGeometry){const s=i.attributes.position;if(s!==void 0)for(let r=0,o=s.count;r<o;r++){const h=new Vector3;h.fromBufferAttribute(s,r).applyMatrix4(e.matrixWorld),t.push(h)}}}}),this.setFromPoints(t)}containsPoint(n){const t=this.faces;for(let e=0,i=t.length;e<i;e++)if(t[e].distanceToPoint(n)>this.tolerance)return!1;return!0}intersectRay(n,t){const e=this.faces;let i=-1/0,s=1/0;for(let r=0,o=e.length;r<o;r++){const h=e[r],u=h.distanceToPoint(n.origin),p=h.normal.dot(n.direction);if(u>0&&p>=0)return null;const d=p!==0?-u/p:0;if(!(d<=0)&&(p>0?s=Math.min(d,s):i=Math.max(d,i),i>s))return null}return i!==-1/0?n.at(i,t):n.at(s,t),t}intersectsRay(n){return this.intersectRay(n,_v1)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(n,t){return n.face=t,t.outside===null?this.assigned.append(n):this.assigned.insertBefore(t.outside,n),t.outside=n,this}removeVertexFromFace(n,t){return n===t.outside&&(n.next!==null&&n.next.face===t?t.outside=n.next:t.outside=null),this.assigned.remove(n),this}removeAllVerticesFromFace(n){if(n.outside!==null){const t=n.outside;let e=n.outside;for(;e.next!==null&&e.next.face===n;)e=e.next;return this.assigned.removeSubList(t,e),t.prev=e.next=null,n.outside=null,t}}deleteFaceVertices(n,t){const e=this.removeAllVerticesFromFace(n);if(e!==void 0)if(t===void 0)this.unassigned.appendChain(e);else{let i=e;do{const s=i.next;t.distanceToPoint(i.point)>this.tolerance?this.addVertexToFace(i,t):this.unassigned.append(i),i=s}while(i!==null)}return this}resolveUnassignedPoints(n){if(this.unassigned.isEmpty()===!1){let t=this.unassigned.first();do{const e=t.next;let i=this.tolerance,s=null;for(let r=0;r<n.length;r++){const o=n[r];if(o.mark===Visible){const h=o.distanceToPoint(t.point);if(h>i&&(i=h,s=o),i>1e3*this.tolerance)break}}s!==null&&this.addVertexToFace(t,s),t=e}while(t!==null)}return this}computeExtremes(){const n=new Vector3,t=new Vector3,e=[],i=[];for(let s=0;s<3;s++)e[s]=i[s]=this.vertices[0];n.copy(this.vertices[0].point),t.copy(this.vertices[0].point);for(let s=0,r=this.vertices.length;s<r;s++){const o=this.vertices[s],h=o.point;for(let u=0;u<3;u++)h.getComponent(u)<n.getComponent(u)&&(n.setComponent(u,h.getComponent(u)),e[u]=o);for(let u=0;u<3;u++)h.getComponent(u)>t.getComponent(u)&&(t.setComponent(u,h.getComponent(u)),i[u]=o)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(n.x),Math.abs(t.x))+Math.max(Math.abs(n.y),Math.abs(t.y))+Math.max(Math.abs(n.z),Math.abs(t.z))),{min:e,max:i}}computeInitialHull(){const n=this.vertices,t=this.computeExtremes(),e=t.min,i=t.max;let s=0,r=0;for(let f=0;f<3;f++){const g=i[f].point.getComponent(f)-e[f].point.getComponent(f);g>s&&(s=g,r=f)}const o=e[r],h=i[r];let u,p;s=0,_line3.set(o.point,h.point);for(let f=0,g=this.vertices.length;f<g;f++){const _=n[f];if(_!==o&&_!==h){_line3.closestPointToPoint(_.point,!0,_closestPoint);const v=_closestPoint.distanceToSquared(_.point);v>s&&(s=v,u=_)}}s=-1,_plane.setFromCoplanarPoints(o.point,h.point,u.point);for(let f=0,g=this.vertices.length;f<g;f++){const _=n[f];if(_!==o&&_!==h&&_!==u){const v=Math.abs(_plane.distanceToPoint(_.point));v>s&&(s=v,p=_)}}const d=[];if(_plane.distanceToPoint(p.point)<0){d.push(Face.create(o,h,u),Face.create(p,h,o),Face.create(p,u,h),Face.create(p,o,u));for(let f=0;f<3;f++){const g=(f+1)%3;d[f+1].getEdge(2).setTwin(d[0].getEdge(g)),d[f+1].getEdge(1).setTwin(d[g+1].getEdge(0))}}else{d.push(Face.create(o,u,h),Face.create(p,o,h),Face.create(p,h,u),Face.create(p,u,o));for(let f=0;f<3;f++){const g=(f+1)%3;d[f+1].getEdge(2).setTwin(d[0].getEdge((3-f)%3)),d[f+1].getEdge(0).setTwin(d[g+1].getEdge(1))}}for(let f=0;f<4;f++)this.faces.push(d[f]);for(let f=0,g=n.length;f<g;f++){const _=n[f];if(_!==o&&_!==h&&_!==u&&_!==p){s=this.tolerance;let v=null;for(let y=0;y<4;y++){const E=this.faces[y].distanceToPoint(_.point);E>s&&(s=E,v=this.faces[y])}v!==null&&this.addVertexToFace(_,v)}}return this}reindexFaces(){const n=[];for(let t=0;t<this.faces.length;t++){const e=this.faces[t];e.mark===Visible&&n.push(e)}return this.faces=n,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let n,t=0;const e=this.assigned.first().face;let i=e.outside;do{const s=e.distanceToPoint(i.point);s>t&&(t=s,n=i),i=i.next}while(i!==null&&i.face===e);return n}}computeHorizon(n,t,e,i){this.deleteFaceVertices(e),e.mark=Deleted;let s;t===null?s=t=e.getEdge(0):s=t.next;do{const r=s.twin,o=r.face;o.mark===Visible&&(o.distanceToPoint(n)>this.tolerance?this.computeHorizon(n,r,o,i):i.push(s)),s=s.next}while(s!==t);return this}addAdjoiningFace(n,t){const e=Face.create(n,t.tail(),t.head());return this.faces.push(e),e.getEdge(-1).setTwin(t.twin),e.getEdge(0)}addNewFaces(n,t){this.newFaces=[];let e=null,i=null;for(let s=0;s<t.length;s++){const r=t[s],o=this.addAdjoiningFace(n,r);e===null?e=o:o.next.setTwin(i),this.newFaces.push(o.face),i=o}return e.next.setTwin(i),this}addVertexToHull(n){const t=[];return this.unassigned.clear(),this.removeVertexFromFace(n,n.face),this.computeHorizon(n.point,null,n.face,t),this.addNewFaces(n,t),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let n;for(this.computeInitialHull();(n=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(n);return this.reindexFaces(),this.cleanup(),this}}class Face{constructor(){this.normal=new Vector3,this.midpoint=new Vector3,this.area=0,this.constant=0,this.outside=null,this.mark=Visible,this.edge=null}static create(n,t,e){const i=new Face,s=new HalfEdge(n,i),r=new HalfEdge(t,i),o=new HalfEdge(e,i);return s.next=o.prev=r,r.next=s.prev=o,o.next=r.prev=s,i.edge=s,i.compute()}getEdge(n){let t=this.edge;for(;n>0;)t=t.next,n--;for(;n<0;)t=t.prev,n++;return t}compute(){const n=this.edge.tail(),t=this.edge.head(),e=this.edge.next.head();return _triangle.set(n.point,t.point,e.point),_triangle.getNormal(this.normal),_triangle.getMidpoint(this.midpoint),this.area=_triangle.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(n){return this.normal.dot(n)-this.constant}}class HalfEdge{constructor(n,t){this.vertex=n,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const n=this.head(),t=this.tail();return t!==null?t.point.distanceTo(n.point):-1}lengthSquared(){const n=this.head(),t=this.tail();return t!==null?t.point.distanceToSquared(n.point):-1}setTwin(n){return this.twin=n,n.twin=this,this}}class VertexNode{constructor(n){this.point=n,this.prev=null,this.next=null,this.face=null}}class VertexList{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(n,t){return t.prev=n.prev,t.next=n,t.prev===null?this.head=t:t.prev.next=t,n.prev=t,this}insertAfter(n,t){return t.prev=n,t.next=n.next,t.next===null?this.tail=t:t.next.prev=t,n.next=t,this}append(n){return this.head===null?this.head=n:this.tail.next=n,n.prev=this.tail,n.next=null,this.tail=n,this}appendChain(n){for(this.head===null?this.head=n:this.tail.next=n,n.prev=this.tail;n.next!==null;)n=n.next;return this.tail=n,this}remove(n){return n.prev===null?this.head=n.next:n.prev.next=n.next,n.next===null?this.tail=n.prev:n.next.prev=n.prev,this}removeSubList(n,t){return n.prev===null?this.head=t.next:n.prev.next=t.next,t.next===null?this.tail=n.prev:t.next.prev=n.prev,this}isEmpty(){return this.head===null}}class ConvexGeometry extends BufferGeometry{constructor(n){super();const t=[],e=[];ConvexHull===void 0&&console.error("THREE.ConvexBufferGeometry: ConvexBufferGeometry relies on ConvexHull");const s=new ConvexHull().setFromPoints(n).faces;for(let r=0;r<s.length;r++){const o=s[r];let h=o.edge;do{const u=h.head().point;t.push(u.x,u.y,u.z),e.push(o.normal.x,o.normal.y,o.normal.z),h=h.next}while(h!==o.edge)}this.setAttribute("position",new Float32BufferAttribute(t,3)),this.setAttribute("normal",new Float32BufferAttribute(e,3))}}function makeRock(l,n,t){let e=[];for(let r=0;r<l;r++)e.push(new Vector3(Math.random()*n,Math.random()*n,Math.random()*n));let i=new ConvexGeometry(e),s=new MeshPhongMaterial({color:t,roughness:1,flatShading:!0});return new Mesh(i,s)}let simObjects=[],controlledSimObject;function createBoxMesh(l){const n=new BoxGeometry(l.size.x,l.size.y,l.size.z,10,10),t=new MeshPhongMaterial({color:l.color});return new Mesh(n,t)}function createSphereMesh(l){const n=new Mesh;return n.geometry=new SphereGeometry(l.size.z*.5,12,12),n.material=new MeshPhongMaterial({color:l.colour}),n}function addGeometry(l){const n=new Vector3,t=new Box3;switch(l.shape){case"cube":l.size.copy(new Vector3(.4,.4,.4));const e=createBoxMesh(l);l.bodyShape="box",l.add(e),l.createBody(.5,2,.1),l.setGrippable(),l.setGripAxes();break;case"rock":const i=makeRock(50,l.size.z,l.colour);i.geometry.computeBoundingBox(),i.geometry.center(),t.setFromObject(i),t.getSize(n),l.bodyShape="box",l.size.copy(n),l.add(i),l.createBody(3,2,.01),l.setGrippable(),l.setGripAxes();break;case"sphere":const s=createSphereMesh(l);s.geometry.computeBoundingSphere(),s.geometry.computeBoundingBox(),t.setFromObject(s),t.getSize(n),l.size.copy(n),l.radius=s.geometry.boundingSphere.radius,l.bodyShape="sphere",l.add(s),l.createBody(2.1,1,.1),l.setGrippable(),l.setGripAxes();break;case"shaft":loadAssetSTL(l,"/models/simObject_shapes/shaft/shaft.stl","cylinder");break;case"custom":loadUserSTL(l);break;default:console.error("Unknown SimObject shape: ",l.shape);break}}function loadAssetSTL(l,n,t){const e=new STLLoader,i=new Vector3;e.load(n,s=>{const r=new MeshPhongMaterial({color:l.color}),o=new Mesh(s,r);l.scaleFactor=.3,o.scale.copy(new Vector3(.03,.03,.03)),o.geometry.computeBoundingBox(),o.geometry.center(),o.rotation.x=Math.PI/2,new Box3().setFromObject(o).getSize(i),l.size.copy(i),l.add(o),l.bodyShape=t,l.createBody(5,2,.1),l.setGrippable(),l.setGripAxes(),l.render()})}function loadUserSTL(l){const n=document.createElement("input"),t=new FileReader;t.addEventListener("load",e=>{const i=e.target.result;loadSTL(l,i)}),n.setAttribute("type","file"),n.setAttribute("accept",".stl"),n.onchange=e=>{try{const i=e.target.files[0];t.readAsArrayBuffer(i)}catch(i){console.log(i)}},document.body.appendChild(n),n.click(),document.body.removeChild(n)}function loadSTL(l,n){const t=new STLLoader().parse(n),e=new MeshPhongMaterial({color:l.colour}),i=new Mesh,s=new Vector3;i.geometry=t,i.material=e;const r=l.scaleFactor;i.scale.set(r,r,r),i.geometry.computeBoundingBox(),i.geometry.center(),new Box3().setFromObject(i).getSize(s),l.size.copy(s),l.add(i),l.bodyShape="box",l.createBody(5,2,.1),l.setGrippable(),l.setGripAxes(),l.render()}function addSimObject(l,n,t,e,i){let s=new SimObject;s.name=l,simObjects.push(s),s.shape=e,s.color=t,addGeometry(s),n!=null?(s.setFieldValues(n),s.updateFromFieldValues()):(s.setFieldValues(s._fieldValues),s.updateFromFieldValues()),s.addToScene(),i!=1&&s.setScale(i),simObjects.length>1&&(place3Dobjects(s),s.updateFieldValues(),s.updatePoseBlock())}function place3Dobjects(l){const n=simObjects.length;for(let t=0;t<n;t++)if(simObjects[t].name!=l.name){let e=new Box3().setFromObject(l),i=new Box3().setFromObject(simObjects[t]),s=!0;for(;s;)l.position.z=l.position.z+.001,e.setFromObject(l),s=e.intersectsBox(i)}}function remSimObjects(l){const n=l.length;for(let t=0;t<n;t++){const e=getSimObject(l[t]),i=getSimObjectIdx(l[t]);e!=null&&(e.removeFromScene(),simObjects.splice(i,1))}}function setSimObjectHighlight(l){if(controlledSimObject!=null)return;const n=l.intersectObjects(simObjects,!0),t=n.length>0,e=coreBrowserExports.getMainWorkspace();if(t){const i=n[0].object.parent;if(i.highlighted!=t){const s=simObjects.length;for(let r=0;r<s;r++)simObjects[r].highlight(!1);i.highlight(t),e.highlightBlock(i.name)}}else{const i=simObjects.length;for(let s=0;s<i;s++)simObjects[s].highlight(!1),e.highlightBlock(null)}}function setTCSimObjectsOnClick(l){const n=l.intersectObjects(simObjects,!0),t=n.length>0;if(t){const e=n[0].object.parent;if(e===controlledSimObject){switch(e.control.getMode()){case"translate":e.control.setMode("rotate");break;case"rotate":default:e.control.setMode("translate")}return t}controlledSimObject!=null&&removeTransformControl(controlledSimObject),activateTransformControl(e),controlledSimObject=e}else controlledSimObject!=null&&(coreBrowserExports.getMainWorkspace().highlightBlock(null),controlledSimObject.highlight(!1),removeTransformControl(controlledSimObject),controlledSimObject=void 0);return t}function activateTransformControl(l){l.control.setMode("translate"),l.setTransformControlEnabled(!0),getScene().add(l.control)}function removeTransformControl(l){getScene().remove(l.control),l.control.setMode("rotate"),l.setTransformControlEnabled(!1)}function remControledSimObject(){controlledSimObject&&removeTransformControl(controlledSimObject),controlledSimObject=void 0}function getSimObjects(){return simObjects}function getSimObject(l){return simObjects.find(t=>t.name===l)}function getSimObjectIdx(l){return simObjects.findIndex(t=>t.name===l)}function getSimObjectByPos(l){let n=9999,t=-1,e;const i=simObjects.length;for(let r=0;r<i;r++)e=simObjects[r].position.distanceTo(l),e<=n&&(n=e,t=r);if(t<0)return;if(new Box3().setFromObject(simObjects[t]).containsPoint(l))return simObjects[t]}function isAttached(){return!!getAttachedObject()}function getAttachedObject(){const l=simObjects.length;for(let n=0;n<l;n++)if(simObjects[n].attached)return simObjects[n]}function randomColour(){const l="0123456789ABCDEF";let n="#";for(let t=0;t<6;t++)n+=l[Math.floor(Math.random()*16)];return n}const dt=.02;let world,initDone=!1;function initCannon(){world=new World,world.gravity.set(0,0,-9.81),world.broadphase=new NaiveBroadphase,world.solver.tolerance=.001,world.quatNormalizeFast=!0,world.solver.iterations=10,world.allowSleep=!0;const l=new Plane,n=new Body({mass:0});n.addShape(l),n.material=new Material({friction:4,restitution:-2}),n.quaternion.setFromEuler(0,0,-Math.PI/2),n.allowSleep=!0,n.sleepSpeedLimit=1.2,n.sleepTimeLimit=.1,n.name="the_floor",world.addBody(n),initDone=!0}function getWorld(){if(initDone)return world;console.error("Physics not ready!")}function updatePhysics(){const l=getSimObjects();world.step(dt),updateMeshes(l)}function updateMeshes(l){let n=l.length;for(let t=0;t<n;t++)l[t].updateMesh()}function isWorldActive(){return world.hasActiveBodies}const _changeEvent={type:"change"},_startEvent={type:"start"},_endEvent={type:"end"};class OrbitControls extends EventDispatcher{constructor(n,t){super(),t===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=n,this.domElement=t,this.enabled=!0,this.target=new Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:MOUSE.ROTATE,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.PAN},this.touches={ONE:TOUCH.ROTATE,TWO:TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.listenToKeyEvents=function(Y){Y.addEventListener("keydown",vt),this._domElementKeyEvents=Y},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(_changeEvent),e.update(),s=i.NONE},this.update=function(){const Y=new Vector3,At=new Quaternion$1().setFromUnitVectors(n.up,new Vector3(0,1,0)),Mt=At.clone().invert(),q=new Vector3,xt=new Quaternion$1,pt=2*Math.PI;return function(){const Ot=e.object.position;Y.copy(Ot).sub(e.target),Y.applyQuaternion(At),o.setFromVector3(Y),e.autoRotate&&s===i.NONE&&P(O()),e.enableDamping?(o.theta+=h.theta*e.dampingFactor,o.phi+=h.phi*e.dampingFactor):(o.theta+=h.theta,o.phi+=h.phi);let te=e.minAzimuthAngle,ce=e.maxAzimuthAngle;return isFinite(te)&&isFinite(ce)&&(te<-Math.PI?te+=pt:te>Math.PI&&(te-=pt),ce<-Math.PI?ce+=pt:ce>Math.PI&&(ce-=pt),te<=ce?o.theta=Math.max(te,Math.min(ce,o.theta)):o.theta=o.theta>(te+ce)/2?Math.max(te,o.theta):Math.min(ce,o.theta)),o.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,o.phi)),o.makeSafe(),o.radius*=u,o.radius=Math.max(e.minDistance,Math.min(e.maxDistance,o.radius)),e.enableDamping===!0?e.target.addScaledVector(p,e.dampingFactor):e.target.add(p),Y.setFromSpherical(o),Y.applyQuaternion(Mt),Ot.copy(e.target).add(Y),e.object.lookAt(e.target),e.enableDamping===!0?(h.theta*=1-e.dampingFactor,h.phi*=1-e.dampingFactor,p.multiplyScalar(1-e.dampingFactor)):(h.set(0,0,0),p.set(0,0,0)),u=1,d||q.distanceToSquared(e.object.position)>r||8*(1-xt.dot(e.object.quaternion))>r?(e.dispatchEvent(_changeEvent),q.copy(e.object.position),xt.copy(e.object.quaternion),d=!1,!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",Wt),e.domElement.removeEventListener("pointerdown",gt),e.domElement.removeEventListener("wheel",z),e.domElement.removeEventListener("touchstart",St),e.domElement.removeEventListener("touchend",kt),e.domElement.removeEventListener("touchmove",Dt),e.domElement.ownerDocument.removeEventListener("pointermove",mt),e.domElement.ownerDocument.removeEventListener("pointerup",Rt),e._domElementKeyEvents!==null&&e._domElementKeyEvents.removeEventListener("keydown",vt)};const e=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=i.NONE;const r=1e-6,o=new Spherical,h=new Spherical;let u=1;const p=new Vector3;let d=!1;const f=new Vector2,g=new Vector2,_=new Vector2,v=new Vector2,y=new Vector2,E=new Vector2,m=new Vector2,x=new Vector2,C=new Vector2;function O(){return 2*Math.PI/60/60*e.autoRotateSpeed}function S(){return Math.pow(.95,e.zoomSpeed)}function P(Y){h.theta-=Y}function F(Y){h.phi-=Y}const V=function(){const Y=new Vector3;return function(Mt,q){Y.setFromMatrixColumn(q,0),Y.multiplyScalar(-Mt),p.add(Y)}}(),N=function(){const Y=new Vector3;return function(Mt,q){e.screenSpacePanning===!0?Y.setFromMatrixColumn(q,1):(Y.setFromMatrixColumn(q,0),Y.crossVectors(e.object.up,Y)),Y.multiplyScalar(Mt),p.add(Y)}}(),B=function(){const Y=new Vector3;return function(Mt,q){const xt=e.domElement;if(e.object.isPerspectiveCamera){const pt=e.object.position;Y.copy(pt).sub(e.target);let Bt=Y.length();Bt*=Math.tan(e.object.fov/2*Math.PI/180),V(2*Mt*Bt/xt.clientHeight,e.object.matrix),N(2*q*Bt/xt.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?(V(Mt*(e.object.right-e.object.left)/e.object.zoom/xt.clientWidth,e.object.matrix),N(q*(e.object.top-e.object.bottom)/e.object.zoom/xt.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function W(Y){e.object.isPerspectiveCamera?u/=Y:e.object.isOrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom*Y)),e.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function A(Y){e.object.isPerspectiveCamera?u*=Y:e.object.isOrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/Y)),e.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function G(Y){f.set(Y.clientX,Y.clientY)}function D(Y){m.set(Y.clientX,Y.clientY)}function M(Y){v.set(Y.clientX,Y.clientY)}function J(Y){g.set(Y.clientX,Y.clientY),_.subVectors(g,f).multiplyScalar(e.rotateSpeed);const At=e.domElement;P(2*Math.PI*_.x/At.clientHeight),F(2*Math.PI*_.y/At.clientHeight),f.copy(g),e.update()}function et(Y){x.set(Y.clientX,Y.clientY),C.subVectors(x,m),C.y>0?W(S()):C.y<0&&A(S()),m.copy(x),e.update()}function Q(Y){y.set(Y.clientX,Y.clientY),E.subVectors(y,v).multiplyScalar(e.panSpeed),B(E.x,E.y),v.copy(y),e.update()}function ot(Y){Y.deltaY<0?A(S()):Y.deltaY>0&&W(S()),e.update()}function tt(Y){let At=!1;switch(Y.code){case e.keys.UP:B(0,e.keyPanSpeed),At=!0;break;case e.keys.BOTTOM:B(0,-e.keyPanSpeed),At=!0;break;case e.keys.LEFT:B(e.keyPanSpeed,0),At=!0;break;case e.keys.RIGHT:B(-e.keyPanSpeed,0),At=!0;break}At&&(Y.preventDefault(),e.update())}function rt(Y){if(Y.touches.length==1)f.set(Y.touches[0].pageX,Y.touches[0].pageY);else{const At=.5*(Y.touches[0].pageX+Y.touches[1].pageX),Mt=.5*(Y.touches[0].pageY+Y.touches[1].pageY);f.set(At,Mt)}}function ft(Y){if(Y.touches.length==1)v.set(Y.touches[0].pageX,Y.touches[0].pageY);else{const At=.5*(Y.touches[0].pageX+Y.touches[1].pageX),Mt=.5*(Y.touches[0].pageY+Y.touches[1].pageY);v.set(At,Mt)}}function _t(Y){const At=Y.touches[0].pageX-Y.touches[1].pageX,Mt=Y.touches[0].pageY-Y.touches[1].pageY,q=Math.sqrt(At*At+Mt*Mt);m.set(0,q)}function yt(Y){e.enableZoom&&_t(Y),e.enablePan&&ft(Y)}function Z(Y){e.enableZoom&&_t(Y),e.enableRotate&&rt(Y)}function bt(Y){if(Y.touches.length==1)g.set(Y.touches[0].pageX,Y.touches[0].pageY);else{const Mt=.5*(Y.touches[0].pageX+Y.touches[1].pageX),q=.5*(Y.touches[0].pageY+Y.touches[1].pageY);g.set(Mt,q)}_.subVectors(g,f).multiplyScalar(e.rotateSpeed);const At=e.domElement;P(2*Math.PI*_.x/At.clientHeight),F(2*Math.PI*_.y/At.clientHeight),f.copy(g)}function at(Y){if(Y.touches.length==1)y.set(Y.touches[0].pageX,Y.touches[0].pageY);else{const At=.5*(Y.touches[0].pageX+Y.touches[1].pageX),Mt=.5*(Y.touches[0].pageY+Y.touches[1].pageY);y.set(At,Mt)}E.subVectors(y,v).multiplyScalar(e.panSpeed),B(E.x,E.y),v.copy(y)}function nt(Y){const At=Y.touches[0].pageX-Y.touches[1].pageX,Mt=Y.touches[0].pageY-Y.touches[1].pageY,q=Math.sqrt(At*At+Mt*Mt);x.set(0,q),C.set(0,Math.pow(x.y/m.y,e.zoomSpeed)),W(C.y),m.copy(x)}function ht(Y){e.enableZoom&&nt(Y),e.enablePan&&at(Y)}function Ct(Y){e.enableZoom&&nt(Y),e.enableRotate&&bt(Y)}function gt(Y){if(e.enabled!==!1)switch(Y.pointerType){case"mouse":case"pen":Ft(Y);break}}function mt(Y){if(e.enabled!==!1)switch(Y.pointerType){case"mouse":case"pen":Pt(Y);break}}function Rt(Y){switch(Y.pointerType){case"mouse":case"pen":X();break}}function Ft(Y){Y.preventDefault(),e.domElement.focus?e.domElement.focus():window.focus();let At;switch(Y.button){case 0:At=e.mouseButtons.LEFT;break;case 1:At=e.mouseButtons.MIDDLE;break;case 2:At=e.mouseButtons.RIGHT;break;default:At=-1}switch(At){case MOUSE.DOLLY:if(e.enableZoom===!1)return;D(Y),s=i.DOLLY;break;case MOUSE.ROTATE:if(Y.ctrlKey||Y.metaKey||Y.shiftKey){if(e.enablePan===!1)return;M(Y),s=i.PAN}else{if(e.enableRotate===!1)return;G(Y),s=i.ROTATE}break;case MOUSE.PAN:if(Y.ctrlKey||Y.metaKey||Y.shiftKey){if(e.enableRotate===!1)return;G(Y),s=i.ROTATE}else{if(e.enablePan===!1)return;M(Y),s=i.PAN}break;default:s=i.NONE}s!==i.NONE&&(e.domElement.ownerDocument.addEventListener("pointermove",mt),e.domElement.ownerDocument.addEventListener("pointerup",Rt),e.dispatchEvent(_startEvent))}function Pt(Y){if(e.enabled!==!1)switch(Y.preventDefault(),s){case i.ROTATE:if(e.enableRotate===!1)return;J(Y);break;case i.DOLLY:if(e.enableZoom===!1)return;et(Y);break;case i.PAN:if(e.enablePan===!1)return;Q(Y);break}}function X(Y){e.domElement.ownerDocument.removeEventListener("pointermove",mt),e.domElement.ownerDocument.removeEventListener("pointerup",Rt),e.enabled!==!1&&(e.dispatchEvent(_endEvent),s=i.NONE)}function z(Y){e.enabled===!1||e.enableZoom===!1||s!==i.NONE&&s!==i.ROTATE||(Y.preventDefault(),e.dispatchEvent(_startEvent),ot(Y),e.dispatchEvent(_endEvent))}function vt(Y){e.enabled===!1||e.enablePan===!1||tt(Y)}function St(Y){if(e.enabled!==!1){switch(Y.preventDefault(),Y.touches.length){case 1:switch(e.touches.ONE){case TOUCH.ROTATE:if(e.enableRotate===!1)return;rt(Y),s=i.TOUCH_ROTATE;break;case TOUCH.PAN:if(e.enablePan===!1)return;ft(Y),s=i.TOUCH_PAN;break;default:s=i.NONE}break;case 2:switch(e.touches.TWO){case TOUCH.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;yt(Y),s=i.TOUCH_DOLLY_PAN;break;case TOUCH.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Z(Y),s=i.TOUCH_DOLLY_ROTATE;break;default:s=i.NONE}break;default:s=i.NONE}s!==i.NONE&&e.dispatchEvent(_startEvent)}}function Dt(Y){if(e.enabled!==!1)switch(Y.preventDefault(),s){case i.TOUCH_ROTATE:if(e.enableRotate===!1)return;bt(Y),e.update();break;case i.TOUCH_PAN:if(e.enablePan===!1)return;at(Y),e.update();break;case i.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;ht(Y),e.update();break;case i.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Ct(Y),e.update();break;default:s=i.NONE}}function kt(Y){e.enabled!==!1&&(e.dispatchEvent(_endEvent),s=i.NONE)}function Wt(Y){e.enabled!==!1&&Y.preventDefault()}e.domElement.addEventListener("contextmenu",Wt),e.domElement.addEventListener("pointerdown",gt),e.domElement.addEventListener("wheel",z,{passive:!1}),e.domElement.addEventListener("touchstart",St,{passive:!1}),e.domElement.addEventListener("touchend",kt),e.domElement.addEventListener("touchmove",Dt,{passive:!1}),this.update()}}var ResizeSensor$2={exports:{}},ResizeSensor$1=ResizeSensor$2.exports,hasRequiredResizeSensor;function requireResizeSensor(){return hasRequiredResizeSensor||(hasRequiredResizeSensor=1,function(l,n){(function(t,e){l.exports=e()})(typeof window<"u"?window:ResizeSensor$1,function(){if(typeof window>"u")return null;var t=typeof window<"u"&&window.Math==Math?window:typeof self<"u"&&self.Math==Math?self:Function("return this")(),e=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||function(p){return t.setTimeout(p,20)},i=t.cancelAnimationFrame||t.mozCancelAnimationFrame||t.webkitCancelAnimationFrame||function(p){t.clearTimeout(p)};function s(p,d){var f=Object.prototype.toString.call(p),g=f==="[object Array]"||f==="[object NodeList]"||f==="[object HTMLCollection]"||f==="[object Object]"||typeof jQuery<"u"&&p instanceof jQuery||typeof Elements<"u"&&p instanceof Elements,_=0,v=p.length;if(g)for(;_<v;_++)d(p[_]);else d(p)}function r(p){if(!p.getBoundingClientRect)return{width:p.offsetWidth,height:p.offsetHeight};var d=p.getBoundingClientRect();return{width:Math.round(d.width),height:Math.round(d.height)}}function o(p,d){Object.keys(d).forEach(function(f){p.style[f]=d[f]})}var h=function(p,d){var f=0;function g(){var v=[];this.add=function(m){v.push(m)};var y,E;this.call=function(m){for(y=0,E=v.length;y<E;y++)v[y].call(this,m)},this.remove=function(m){var x=[];for(y=0,E=v.length;y<E;y++)v[y]!==m&&x.push(v[y]);v=x},this.length=function(){return v.length}}function _(v,y){if(v){if(v.resizedAttached){v.resizedAttached.add(y);return}v.resizedAttached=new g,v.resizedAttached.add(y),v.resizeSensor=document.createElement("div"),v.resizeSensor.dir="ltr",v.resizeSensor.className="resize-sensor";var E={pointerEvents:"none",position:"absolute",left:"0px",top:"0px",right:"0px",bottom:"0px",overflow:"hidden",zIndex:"-1",visibility:"hidden",maxWidth:"100%"},m={position:"absolute",left:"0px",top:"0px",transition:"0s"};o(v.resizeSensor,E);var x=document.createElement("div");x.className="resize-sensor-expand",o(x,E);var C=document.createElement("div");o(C,m),x.appendChild(C);var O=document.createElement("div");O.className="resize-sensor-shrink",o(O,E);var S=document.createElement("div");o(S,m),o(S,{width:"200%",height:"200%"}),O.appendChild(S),v.resizeSensor.appendChild(x),v.resizeSensor.appendChild(O),v.appendChild(v.resizeSensor);var P=window.getComputedStyle(v),F=P?P.getPropertyValue("position"):null;F!=="absolute"&&F!=="relative"&&F!=="fixed"&&F!=="sticky"&&(v.style.position="relative");var V=!1,N=0,B=r(v),W=0,A=0,G=!0;f=0;var D=function(){var ot=v.offsetWidth,tt=v.offsetHeight;C.style.width=ot+10+"px",C.style.height=tt+10+"px",x.scrollLeft=ot+10,x.scrollTop=tt+10,O.scrollLeft=ot+10,O.scrollTop=tt+10},M=function(){if(G){var ot=v.offsetWidth===0&&v.offsetHeight===0;if(ot){f||(f=e(function(){f=0,M()}));return}else G=!1}D()};v.resizeSensor.resetSensor=M;var J=function(){N=0,V&&(W=B.width,A=B.height,v.resizedAttached&&v.resizedAttached.call(B))},et=function(){B=r(v),V=B.width!==W||B.height!==A,V&&!N&&(N=e(J)),M()},Q=function(ot,tt,rt){ot.attachEvent?ot.attachEvent("on"+tt,rt):ot.addEventListener(tt,rt)};Q(x,"scroll",et),Q(O,"scroll",et),f=e(function(){f=0,M()})}}s(p,function(v){_(v,d)}),this.detach=function(v){f||(i(f),f=0),h.detach(p,v)},this.reset=function(){p.resizeSensor.resetSensor()}};if(h.reset=function(p){s(p,function(d){d.resizeSensor.resetSensor()})},h.detach=function(p,d){s(p,function(f){f&&(f.resizedAttached&&typeof d=="function"&&(f.resizedAttached.remove(d),f.resizedAttached.length())||f.resizeSensor&&(f.contains(f.resizeSensor)&&f.removeChild(f.resizeSensor),delete f.resizeSensor,delete f.resizedAttached))})},typeof MutationObserver<"u"){var u=new MutationObserver(function(p){for(var d in p)if(p.hasOwnProperty(d))for(var f=p[d].addedNodes,g=0;g<f.length;g++)f[g].resizeSensor&&h.reset(f[g])});document.addEventListener("DOMContentLoaded",function(p){u.observe(document.body,{childList:!0,subtree:!0})})}return h})}(ResizeSensor$2)),ResizeSensor$2.exports}var ResizeSensorExports=requireResizeSensor();const ResizeSensor=getDefaultExportFromCjs(ResizeSensorExports);function getUrlBase(l){const n=l.split(/[\\/]/g);return n.pop(),n.length===0?"./":n.join("/")+"/"}function getElementsWithName(l,n,t=[]){l.tagName===n&&t.push(l);for(let e=0,i=l.children.length;e<i;e++){const s=l.children[e];getElementsWithName(s,n,t)}return t}function deepClone(l,n){const t=l.cloneNode(),e=l.childNodes;for(let i=0,s=e.length;i<s;i++){const r=e[i],o=r.tagName;(!n||o!=="xacro:property"&&o!=="xacro:macro")&&t.appendChild(deepClone(r,n))}return t}function removeEndCommentsFromArray(l){for(;l.length>0;){const n=l[l.length-1];if(n.nodeType!==n.ELEMENT_NODE)l.pop();else break}}function isOperator(l){return/^[()/*+\-%|&=[\]]+$/.test(l)}function isString(l){return/^(('[^']*?')|("[^"]*?")|(`[^`]*?`))$/.test(l)}function isNumber(l){return!isNaN(Number(l))&&!isNaN(parseFloat(l))}function tokenize(l){const n=/(('[^']*?')|("[^"]*?")|(`[^`]*?`)|([()/*+\-%|!&=]+?))/g;return l.replace(n,t=>` ${t} `).trim().split(/\s+/g)}function normalizeExpression(l){return l.replace(/[-+]{2,}/,n=>{let t=!0;for(let e=0,i=n.length;e<i;e++)n[e]==="-"&&(t=!t);return t?"+":"-"})}const PARENT_SCOPE=Symbol("parent");function mergePropertySets(...l){const n={};for(let t=0,e=l.length;t<e;t++){const i=l[t];for(const s in i)n[s]=i[s];PARENT_SCOPE in i&&(n[PARENT_SCOPE]=i[PARENT_SCOPE])}return n}function createNewPropertyScope(l){const n=mergePropertySets(l);return n[PARENT_SCOPE]=l,n}var INUMBER="INUMBER",IOP1="IOP1",IOP2="IOP2",IOP3="IOP3",IVAR="IVAR",IVARNAME="IVARNAME",IFUNCALL="IFUNCALL",IFUNDEF="IFUNDEF",IEXPR="IEXPR",IEXPREVAL="IEXPREVAL",IMEMBER="IMEMBER",IENDSTATEMENT="IENDSTATEMENT",IARRAY="IARRAY";function Instruction(l,n){this.type=l,this.value=n??0}Instruction.prototype.toString=function(){switch(this.type){case INUMBER:case IOP1:case IOP2:case IOP3:case IVAR:case IVARNAME:case IENDSTATEMENT:return this.value;case IFUNCALL:return"CALL "+this.value;case IFUNDEF:return"DEF "+this.value;case IARRAY:return"ARRAY "+this.value;case IMEMBER:return"."+this.value;default:return"Invalid Instruction"}};function unaryInstruction(l){return new Instruction(IOP1,l)}function binaryInstruction(l){return new Instruction(IOP2,l)}function ternaryInstruction(l){return new Instruction(IOP3,l)}function simplify(l,n,t,e,i){for(var s=[],r=[],o,h,u,p,d=0;d<l.length;d++){var f=l[d],g=f.type;if(g===INUMBER||g===IVARNAME)Array.isArray(f.value)?s.push.apply(s,simplify(f.value.map(function(_){return new Instruction(INUMBER,_)}).concat(new Instruction(IARRAY,f.value.length)),n,t,e,i)):s.push(f);else if(g===IVAR&&i.hasOwnProperty(f.value))f=new Instruction(INUMBER,i[f.value]),s.push(f);else if(g===IOP2&&s.length>1)h=s.pop(),o=s.pop(),p=t[f.value],f=new Instruction(INUMBER,p(o.value,h.value)),s.push(f);else if(g===IOP3&&s.length>2)u=s.pop(),h=s.pop(),o=s.pop(),f.value==="?"?s.push(o.value?h.value:u.value):(p=e[f.value],f=new Instruction(INUMBER,p(o.value,h.value,u.value)),s.push(f));else if(g===IOP1&&s.length>0)o=s.pop(),p=n[f.value],f=new Instruction(INUMBER,p(o.value)),s.push(f);else if(g===IEXPR){for(;s.length>0;)r.push(s.shift());r.push(new Instruction(IEXPR,simplify(f.value,n,t,e,i)))}else if(g===IMEMBER&&s.length>0)o=s.pop(),s.push(new Instruction(INUMBER,o.value[f.value]));else{for(;s.length>0;)r.push(s.shift());r.push(f)}}for(;s.length>0;)r.push(s.shift());return r}function substitute(l,n,t){for(var e=[],i=0;i<l.length;i++){var s=l[i],r=s.type;if(r===IVAR&&s.value===n)for(var o=0;o<t.tokens.length;o++){var h=t.tokens[o],u;h.type===IOP1?u=unaryInstruction(h.value):h.type===IOP2?u=binaryInstruction(h.value):h.type===IOP3?u=ternaryInstruction(h.value):u=new Instruction(h.type,h.value),e.push(u)}else r===IEXPR?e.push(new Instruction(IEXPR,substitute(s.value,n,t))):e.push(s)}return e}function evaluate(l,n,t){var e=[],i,s,r,o,h,u;if(isExpressionEvaluator(l))return resolveExpression(l,t);for(var p=l.length,d=0;d<p;d++){var f=l[d],g=f.type;if(g===INUMBER||g===IVARNAME)e.push(f.value);else if(g===IOP2)s=e.pop(),i=e.pop(),f.value==="and"?e.push(i?!!evaluate(s,n,t):!1):f.value==="or"?e.push(i?!0:!!evaluate(s,n,t)):f.value==="="?(o=n.binaryOps[f.value],e.push(o(i,evaluate(s,n,t),t))):(o=n.binaryOps[f.value],e.push(o(resolveExpression(i,t),resolveExpression(s,t))));else if(g===IOP3)r=e.pop(),s=e.pop(),i=e.pop(),f.value==="?"?e.push(evaluate(i?s:r,n,t)):(o=n.ternaryOps[f.value],e.push(o(resolveExpression(i,t),resolveExpression(s,t),resolveExpression(r,t))));else if(g===IVAR)if(f.value in n.functions)e.push(n.functions[f.value]);else if(f.value in n.unaryOps&&n.parser.isOperatorEnabled(f.value))e.push(n.unaryOps[f.value]);else{var _=t[f.value];if(_!==void 0)e.push(_);else throw new Error("undefined variable: "+f.value)}else if(g===IOP1)i=e.pop(),o=n.unaryOps[f.value],e.push(o(resolveExpression(i,t)));else if(g===IFUNCALL){for(u=f.value,h=[];u-- >0;)h.unshift(resolveExpression(e.pop(),t));if(o=e.pop(),o.apply&&o.call)e.push(o.apply(void 0,h));else throw new Error(o+" is not a function")}else if(g===IFUNDEF)e.push(function(){for(var v=e.pop(),y=[],E=f.value;E-- >0;)y.unshift(e.pop());var m=e.pop(),x=function(){for(var C=Object.assign({},t),O=0,S=y.length;O<S;O++)C[y[O]]=arguments[O];return evaluate(v,n,C)};return Object.defineProperty(x,"name",{value:m,writable:!1}),t[m]=x,x}());else if(g===IEXPR)e.push(createExpressionEvaluator(f,n));else if(g===IEXPREVAL)e.push(f);else if(g===IMEMBER)i=e.pop(),e.push(i[f.value]);else if(g===IENDSTATEMENT)e.pop();else if(g===IARRAY){for(u=f.value,h=[];u-- >0;)h.unshift(e.pop());e.push(h)}else throw new Error("invalid Expression")}if(e.length>1)throw new Error("invalid Expression (parity)");return e[0]===0?0:resolveExpression(e[0],t)}function createExpressionEvaluator(l,n,t){return isExpressionEvaluator(l)?l:{type:IEXPREVAL,value:function(e){return evaluate(l.value,n,e)}}}function isExpressionEvaluator(l){return l&&l.type===IEXPREVAL}function resolveExpression(l,n){return isExpressionEvaluator(l)?l.value(n):l}function expressionToString(l,n){for(var t=[],e,i,s,r,o,h,u=0;u<l.length;u++){var p=l[u],d=p.type;if(d===INUMBER)typeof p.value=="number"&&p.value<0?t.push("("+p.value+")"):Array.isArray(p.value)?t.push("["+p.value.map(escapeValue).join(", ")+"]"):t.push(escapeValue(p.value));else if(d===IOP2)i=t.pop(),e=t.pop(),r=p.value,n?r==="^"?t.push("Math.pow("+e+", "+i+")"):r==="and"?t.push("(!!"+e+" && !!"+i+")"):r==="or"?t.push("(!!"+e+" || !!"+i+")"):r==="||"?t.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+e+"),("+i+")))"):r==="=="?t.push("("+e+" === "+i+")"):r==="!="?t.push("("+e+" !== "+i+")"):r==="["?t.push(e+"[("+i+") | 0]"):t.push("("+e+" "+r+" "+i+")"):r==="["?t.push(e+"["+i+"]"):t.push("("+e+" "+r+" "+i+")");else if(d===IOP3)if(s=t.pop(),i=t.pop(),e=t.pop(),r=p.value,r==="?")t.push("("+e+" ? "+i+" : "+s+")");else throw new Error("invalid Expression");else if(d===IVAR||d===IVARNAME)t.push(p.value);else if(d===IOP1)e=t.pop(),r=p.value,r==="-"||r==="+"?t.push("("+r+e+")"):n?r==="not"?t.push("(!"+e+")"):r==="!"?t.push("fac("+e+")"):t.push(r+"("+e+")"):r==="!"?t.push("("+e+"!)"):t.push("("+r+" "+e+")");else if(d===IFUNCALL){for(h=p.value,o=[];h-- >0;)o.unshift(t.pop());r=t.pop(),t.push(r+"("+o.join(", ")+")")}else if(d===IFUNDEF){for(i=t.pop(),h=p.value,o=[];h-- >0;)o.unshift(t.pop());e=t.pop(),n?t.push("("+e+" = function("+o.join(", ")+") { return "+i+" })"):t.push("("+e+"("+o.join(", ")+") = "+i+")")}else if(d===IMEMBER)e=t.pop(),t.push(e+"."+p.value);else if(d===IARRAY){for(h=p.value,o=[];h-- >0;)o.unshift(t.pop());t.push("["+o.join(", ")+"]")}else if(d===IEXPR)t.push("("+expressionToString(p.value,n)+")");else if(d!==IENDSTATEMENT)throw new Error("invalid Expression")}return t.length>1&&(n?t=[t.join(",")]:t=[t.join(";")]),String(t[0])}function escapeValue(l){return typeof l=="string"?JSON.stringify(l).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):l}function contains(l,n){for(var t=0;t<l.length;t++)if(l[t]===n)return!0;return!1}function getSymbols(l,n,t){t=t||{};for(var e=!!t.withMembers,i=null,s=0;s<l.length;s++){var r=l[s];r.type===IVAR||r.type===IVARNAME?!e&&!contains(n,r.value)?n.push(r.value):(i!==null&&(contains(n,i)||n.push(i)),i=r.value):r.type===IMEMBER&&e&&i!==null?i+="."+r.value:r.type===IEXPR?getSymbols(r.value,n,t):i!==null&&(contains(n,i)||n.push(i),i=null)}i!==null&&!contains(n,i)&&n.push(i)}function Expression(l,n){this.tokens=l,this.parser=n,this.unaryOps=n.unaryOps,this.binaryOps=n.binaryOps,this.ternaryOps=n.ternaryOps,this.functions=n.functions}Expression.prototype.simplify=function(l){return l=l||{},new Expression(simplify(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,l),this.parser)};Expression.prototype.substitute=function(l,n){return n instanceof Expression||(n=this.parser.parse(String(n))),new Expression(substitute(this.tokens,l,n),this.parser)};Expression.prototype.evaluate=function(l){return l=l||{},evaluate(this.tokens,this,l)};Expression.prototype.toString=function(){return expressionToString(this.tokens,!1)};Expression.prototype.symbols=function(l){l=l||{};var n=[];return getSymbols(this.tokens,n,l),n};Expression.prototype.variables=function(l){l=l||{};var n=[];getSymbols(this.tokens,n,l);var t=this.functions;return n.filter(function(e){return!(e in t)})};Expression.prototype.toJSFunction=function(l,n){var t=this,e=new Function(l,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+expressionToString(this.simplify(n).tokens,!0)+"; }");return function(){return e.apply(t,arguments)}};var TEOF="TEOF",TOP="TOP",TNUMBER="TNUMBER",TSTRING="TSTRING",TPAREN="TPAREN",TBRACKET="TBRACKET",TCOMMA="TCOMMA",TNAME="TNAME",TSEMICOLON="TSEMICOLON";function Token(l,n,t){this.type=l,this.value=n,this.index=t}Token.prototype.toString=function(){return this.type+": "+this.value};function TokenStream(l,n){this.pos=0,this.current=null,this.unaryOps=l.unaryOps,this.binaryOps=l.binaryOps,this.ternaryOps=l.ternaryOps,this.consts=l.consts,this.expression=n,this.savedPosition=0,this.savedCurrent=null,this.options=l.options,this.parser=l}TokenStream.prototype.newToken=function(l,n,t){return new Token(l,n,t??this.pos)};TokenStream.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current};TokenStream.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent};TokenStream.prototype.next=function(){if(this.pos>=this.expression.length)return this.newToken(TEOF,"EOF");if(this.isWhitespace()||this.isComment())return this.next();if(this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName())return this.current;this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')};TokenStream.prototype.isString=function(){var l=!1,n=this.pos,t=this.expression.charAt(n);if(t==="'"||t==='"')for(var e=this.expression.indexOf(t,n+1);e>=0&&this.pos<this.expression.length;){if(this.pos=e+1,this.expression.charAt(e-1)!=="\\"){var i=this.expression.substring(n+1,e);this.current=this.newToken(TSTRING,this.unescape(i),n),l=!0;break}e=this.expression.indexOf(t,e+1)}return l};TokenStream.prototype.isParen=function(){var l=this.expression.charAt(this.pos);return l==="("||l===")"?(this.current=this.newToken(TPAREN,l),this.pos++,!0):!1};TokenStream.prototype.isBracket=function(){var l=this.expression.charAt(this.pos);return(l==="["||l==="]")&&this.isOperatorEnabled("[")?(this.current=this.newToken(TBRACKET,l),this.pos++,!0):!1};TokenStream.prototype.isComma=function(){var l=this.expression.charAt(this.pos);return l===","?(this.current=this.newToken(TCOMMA,","),this.pos++,!0):!1};TokenStream.prototype.isSemicolon=function(){var l=this.expression.charAt(this.pos);return l===";"?(this.current=this.newToken(TSEMICOLON,";"),this.pos++,!0):!1};TokenStream.prototype.isConst=function(){for(var l=this.pos,n=l;n<this.expression.length;n++){var t=this.expression.charAt(n);if(t.toUpperCase()===t.toLowerCase()&&(n===this.pos||t!=="_"&&t!=="."&&(t<"0"||t>"9")))break}if(n>l){var e=this.expression.substring(l,n);if(e in this.consts)return this.current=this.newToken(TNUMBER,this.consts[e]),this.pos+=e.length,!0}return!1};TokenStream.prototype.isNamedOp=function(){for(var l=this.pos,n=l;n<this.expression.length;n++){var t=this.expression.charAt(n);if(t.toUpperCase()===t.toLowerCase()&&(n===this.pos||t!=="_"&&(t<"0"||t>"9")))break}if(n>l){var e=this.expression.substring(l,n);if(this.isOperatorEnabled(e)&&(e in this.binaryOps||e in this.unaryOps||e in this.ternaryOps))return this.current=this.newToken(TOP,e),this.pos+=e.length,!0}return!1};TokenStream.prototype.isName=function(){for(var l=this.pos,n=l,t=!1;n<this.expression.length;n++){var e=this.expression.charAt(n);if(e.toUpperCase()===e.toLowerCase()){if(n===this.pos&&(e==="$"||e==="_")){e==="_"&&(t=!0);continue}else if(n===this.pos||!t||e!=="_"&&(e<"0"||e>"9"))break}else t=!0}if(t){var i=this.expression.substring(l,n);return this.current=this.newToken(TNAME,i),this.pos+=i.length,!0}return!1};TokenStream.prototype.isWhitespace=function(){for(var l=!1,n=this.expression.charAt(this.pos);(n===" "||n==="	"||n===`
`||n==="\r")&&(l=!0,this.pos++,!(this.pos>=this.expression.length));)n=this.expression.charAt(this.pos);return l};var codePointPattern=/^[0-9a-f]{4}$/i;TokenStream.prototype.unescape=function(l){var n=l.indexOf("\\");if(n<0)return l;for(var t=l.substring(0,n);n>=0;){var e=l.charAt(++n);switch(e){case"'":t+="'";break;case'"':t+='"';break;case"\\":t+="\\";break;case"/":t+="/";break;case"b":t+="\b";break;case"f":t+="\f";break;case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;case"u":var i=l.substring(n+1,n+5);codePointPattern.test(i)||this.parseError("Illegal escape sequence: \\u"+i),t+=String.fromCharCode(parseInt(i,16)),n+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+e+'"')}++n;var s=l.indexOf("\\",n);t+=l.substring(n,s<0?l.length:s),n=s}return t};TokenStream.prototype.isComment=function(){var l=this.expression.charAt(this.pos);return l==="/"&&this.expression.charAt(this.pos+1)==="*"?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1};TokenStream.prototype.isRadixInteger=function(){var l=this.pos;if(l>=this.expression.length-2||this.expression.charAt(l)!=="0")return!1;++l;var n,t;if(this.expression.charAt(l)==="x")n=16,t=/^[0-9a-f]$/i,++l;else if(this.expression.charAt(l)==="b")n=2,t=/^[01]$/i,++l;else return!1;for(var e=!1,i=l;l<this.expression.length;){var s=this.expression.charAt(l);if(t.test(s))l++,e=!0;else break}return e&&(this.current=this.newToken(TNUMBER,parseInt(this.expression.substring(i,l),n)),this.pos=l),e};TokenStream.prototype.isNumber=function(){for(var l=!1,n=this.pos,t=n,e=n,i=!1,s=!1,r;n<this.expression.length&&(r=this.expression.charAt(n),r>="0"&&r<="9"||!i&&r===".");)r==="."?i=!0:s=!0,n++,l=s;if(l&&(e=n),r==="e"||r==="E"){n++;for(var o=!0,h=!1;n<this.expression.length;){if(r=this.expression.charAt(n),o&&(r==="+"||r==="-"))o=!1;else if(r>="0"&&r<="9")h=!0,o=!1;else break;n++}h||(n=e)}return l?(this.current=this.newToken(TNUMBER,parseFloat(this.expression.substring(t,n))),this.pos=n):this.pos=e,l};TokenStream.prototype.isOperator=function(){var l=this.pos,n=this.expression.charAt(this.pos);if(n==="+"||n==="-"||n==="*"||n==="/"||n==="%"||n==="^"||n==="?"||n===":"||n===".")this.current=this.newToken(TOP,n);else if(n===""||n==="")this.current=this.newToken(TOP,"*");else if(n===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(TOP,">="),this.pos++):this.current=this.newToken(TOP,">");else if(n==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(TOP,"<="),this.pos++):this.current=this.newToken(TOP,"<");else if(n==="|")if(this.expression.charAt(this.pos+1)==="|")this.current=this.newToken(TOP,"||"),this.pos++;else return!1;else if(n==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(TOP,"=="),this.pos++):this.current=this.newToken(TOP,n);else if(n==="!")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(TOP,"!="),this.pos++):this.current=this.newToken(TOP,n);else return!1;return this.pos++,this.isOperatorEnabled(this.current.value)?!0:(this.pos=l,!1)};TokenStream.prototype.isOperatorEnabled=function(l){return this.parser.isOperatorEnabled(l)};TokenStream.prototype.getCoordinates=function(){var l=0,n,t=-1;do l++,n=this.pos-t,t=this.expression.indexOf(`
`,t+1);while(t>=0&&t<this.pos);return{line:l,column:n}};TokenStream.prototype.parseError=function(l){var n=this.getCoordinates();throw new Error("parse error ["+n.line+":"+n.column+"]: "+l)};function ParserState(l,n,t){this.parser=l,this.tokens=n,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=t.allowMemberAccess!==!1}ParserState.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()};ParserState.prototype.tokenMatches=function(l,n){return typeof n>"u"?!0:Array.isArray(n)?contains(n,l.value):typeof n=="function"?n(l):l.value===n};ParserState.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()};ParserState.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken};ParserState.prototype.accept=function(l,n){return this.nextToken.type===l&&this.tokenMatches(this.nextToken,n)?(this.next(),!0):!1};ParserState.prototype.expect=function(l,n){if(!this.accept(l,n)){var t=this.tokens.getCoordinates();throw new Error("parse error ["+t.line+":"+t.column+"]: Expected "+(n||l))}};ParserState.prototype.parseAtom=function(l){var n=this.tokens.unaryOps;function t(i){return i.value in n}if(this.accept(TNAME)||this.accept(TOP,t))l.push(new Instruction(IVAR,this.current.value));else if(this.accept(TNUMBER))l.push(new Instruction(INUMBER,this.current.value));else if(this.accept(TSTRING))l.push(new Instruction(INUMBER,this.current.value));else if(this.accept(TPAREN,"("))this.parseExpression(l),this.expect(TPAREN,")");else if(this.accept(TBRACKET,"["))if(this.accept(TBRACKET,"]"))l.push(new Instruction(IARRAY,0));else{var e=this.parseArrayList(l);l.push(new Instruction(IARRAY,e))}else throw new Error("unexpected "+this.nextToken)};ParserState.prototype.parseExpression=function(l){var n=[];this.parseUntilEndStatement(l,n)||(this.parseVariableAssignmentExpression(n),!this.parseUntilEndStatement(l,n)&&this.pushExpression(l,n))};ParserState.prototype.pushExpression=function(l,n){for(var t=0,e=n.length;t<e;t++)l.push(n[t])};ParserState.prototype.parseUntilEndStatement=function(l,n){return this.accept(TSEMICOLON)?(this.nextToken&&this.nextToken.type!==TEOF&&!(this.nextToken.type===TPAREN&&this.nextToken.value===")")&&n.push(new Instruction(IENDSTATEMENT)),this.nextToken.type!==TEOF&&this.parseExpression(n),l.push(new Instruction(IEXPR,n)),!0):!1};ParserState.prototype.parseArrayList=function(l){for(var n=0;!this.accept(TBRACKET,"]");)for(this.parseExpression(l),++n;this.accept(TCOMMA);)this.parseExpression(l),++n;return n};ParserState.prototype.parseVariableAssignmentExpression=function(l){for(this.parseConditionalExpression(l);this.accept(TOP,"=");){var n=l.pop(),t=[],e=l.length-1;if(n.type===IFUNCALL){if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var i=0,s=n.value+1;i<s;i++){var r=e-i;l[r].type===IVAR&&(l[r]=new Instruction(IVARNAME,l[r].value))}this.parseVariableAssignmentExpression(t),l.push(new Instruction(IEXPR,t)),l.push(new Instruction(IFUNDEF,n.value));continue}if(n.type!==IVAR&&n.type!==IMEMBER)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(t),l.push(new Instruction(IVARNAME,n.value)),l.push(new Instruction(IEXPR,t)),l.push(binaryInstruction("="))}};ParserState.prototype.parseConditionalExpression=function(l){for(this.parseOrExpression(l);this.accept(TOP,"?");){var n=[],t=[];this.parseConditionalExpression(n),this.expect(TOP,":"),this.parseConditionalExpression(t),l.push(new Instruction(IEXPR,n)),l.push(new Instruction(IEXPR,t)),l.push(ternaryInstruction("?"))}};ParserState.prototype.parseOrExpression=function(l){for(this.parseAndExpression(l);this.accept(TOP,"or");){var n=[];this.parseAndExpression(n),l.push(new Instruction(IEXPR,n)),l.push(binaryInstruction("or"))}};ParserState.prototype.parseAndExpression=function(l){for(this.parseComparison(l);this.accept(TOP,"and");){var n=[];this.parseComparison(n),l.push(new Instruction(IEXPR,n)),l.push(binaryInstruction("and"))}};var COMPARISON_OPERATORS=["==","!=","<","<=",">=",">","in"];ParserState.prototype.parseComparison=function(l){for(this.parseAddSub(l);this.accept(TOP,COMPARISON_OPERATORS);){var n=this.current;this.parseAddSub(l),l.push(binaryInstruction(n.value))}};var ADD_SUB_OPERATORS=["+","-","||"];ParserState.prototype.parseAddSub=function(l){for(this.parseTerm(l);this.accept(TOP,ADD_SUB_OPERATORS);){var n=this.current;this.parseTerm(l),l.push(binaryInstruction(n.value))}};var TERM_OPERATORS=["*","/","%"];ParserState.prototype.parseTerm=function(l){for(this.parseFactor(l);this.accept(TOP,TERM_OPERATORS);){var n=this.current;this.parseFactor(l),l.push(binaryInstruction(n.value))}};ParserState.prototype.parseFactor=function(l){var n=this.tokens.unaryOps;function t(i){return i.value in n}if(this.save(),this.accept(TOP,t)){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===TPAREN&&this.nextToken.value==="("){this.restore(),this.parseExponential(l);return}else if(this.nextToken.type===TSEMICOLON||this.nextToken.type===TCOMMA||this.nextToken.type===TEOF||this.nextToken.type===TPAREN&&this.nextToken.value===")"){this.restore(),this.parseAtom(l);return}}var e=this.current;this.parseFactor(l),l.push(unaryInstruction(e.value))}else this.parseExponential(l)};ParserState.prototype.parseExponential=function(l){for(this.parsePostfixExpression(l);this.accept(TOP,"^");)this.parseFactor(l),l.push(binaryInstruction("^"))};ParserState.prototype.parsePostfixExpression=function(l){for(this.parseFunctionCall(l);this.accept(TOP,"!");)l.push(unaryInstruction("!"))};ParserState.prototype.parseFunctionCall=function(l){var n=this.tokens.unaryOps;function t(s){return s.value in n}if(this.accept(TOP,t)){var e=this.current;this.parseAtom(l),l.push(unaryInstruction(e.value))}else for(this.parseMemberExpression(l);this.accept(TPAREN,"(");)if(this.accept(TPAREN,")"))l.push(new Instruction(IFUNCALL,0));else{var i=this.parseArgumentList(l);l.push(new Instruction(IFUNCALL,i))}};ParserState.prototype.parseArgumentList=function(l){for(var n=0;!this.accept(TPAREN,")");)for(this.parseExpression(l),++n;this.accept(TCOMMA);)this.parseExpression(l),++n;return n};ParserState.prototype.parseMemberExpression=function(l){for(this.parseAtom(l);this.accept(TOP,".")||this.accept(TBRACKET,"[");){var n=this.current;if(n.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(TNAME),l.push(new Instruction(IMEMBER,this.current.value))}else if(n.value==="["){if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(l),this.expect(TBRACKET,"]"),l.push(binaryInstruction("["))}else throw new Error("unexpected symbol: "+n.value)}};function add$1(l,n){return Number(l)+Number(n)}function sub(l,n){return l-n}function mul(l,n){return l*n}function div(l,n){return l/n}function mod(l,n){return l%n}function concat(l,n){return Array.isArray(l)&&Array.isArray(n)?l.concat(n):""+l+n}function equal(l,n){return l===n}function notEqual(l,n){return l!==n}function greaterThan(l,n){return l>n}function lessThan(l,n){return l<n}function greaterThanEqual(l,n){return l>=n}function lessThanEqual(l,n){return l<=n}function andOperator(l,n){return!!(l&&n)}function orOperator(l,n){return!!(l||n)}function inOperator(l,n){return contains(n,l)}function sinh(l){return(Math.exp(l)-Math.exp(-l))/2}function cosh(l){return(Math.exp(l)+Math.exp(-l))/2}function tanh(l){return l===1/0?1:l===-1/0?-1:(Math.exp(l)-Math.exp(-l))/(Math.exp(l)+Math.exp(-l))}function asinh(l){return l===-1/0?l:Math.log(l+Math.sqrt(l*l+1))}function acosh(l){return Math.log(l+Math.sqrt(l*l-1))}function atanh(l){return Math.log((1+l)/(1-l))/2}function log10(l){return Math.log(l)*Math.LOG10E}function neg(l){return-l}function not(l){return!l}function trunc(l){return l<0?Math.ceil(l):Math.floor(l)}function random(l){return Math.random()*(l||1)}function factorial(l){return gamma(l+1)}function isInteger(l){return isFinite(l)&&l===Math.round(l)}var GAMMA_G=4.7421875,GAMMA_P=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function gamma(l){var n,t;if(isInteger(l)){if(l<=0)return isFinite(l)?1/0:NaN;if(l>171)return 1/0;for(var e=l-2,i=l-1;e>1;)i*=e,e--;return i===0&&(i=1),i}if(l<.5)return Math.PI/(Math.sin(Math.PI*l)*gamma(1-l));if(l>=171.35)return 1/0;if(l>85){var s=l*l,r=s*l,o=r*l,h=o*l;return Math.sqrt(2*Math.PI/l)*Math.pow(l/Math.E,l)*(1+1/(12*l)+1/(288*s)-139/(51840*r)-571/(2488320*o)+163879/(209018880*h)+5246819/(75246796800*h*l))}--l,t=GAMMA_P[0];for(var u=1;u<GAMMA_P.length;++u)t+=GAMMA_P[u]/(l+u);return n=l+GAMMA_G+.5,Math.sqrt(2*Math.PI)*Math.pow(n,l+.5)*Math.exp(-n)*t}function stringOrArrayLength(l){return Array.isArray(l)?l.length:String(l).length}function hypot(){for(var l=0,n=0,t=0;t<arguments.length;t++){var e=Math.abs(arguments[t]),i;n<e?(i=n/e,l=l*i*i+1,n=e):e>0?(i=e/n,l+=i*i):l+=e}return n===1/0?1/0:n*Math.sqrt(l)}function condition(l,n,t){return l?n:t}function roundTo(l,n){return typeof n>"u"||+n==0?Math.round(l):(l=+l,n=-+n,isNaN(l)||!(typeof n=="number"&&n%1===0)?NaN:(l=l.toString().split("e"),l=Math.round(+(l[0]+"e"+(l[1]?+l[1]-n:-n))),l=l.toString().split("e"),+(l[0]+"e"+(l[1]?+l[1]+n:n))))}function setVar(l,n,t){return t&&(t[l]=n),n}function arrayIndex(l,n){return l[n|0]}function max(l){return arguments.length===1&&Array.isArray(l)?Math.max.apply(Math,l):Math.max.apply(Math,arguments)}function min(l){return arguments.length===1&&Array.isArray(l)?Math.min.apply(Math,l):Math.min.apply(Math,arguments)}function arrayMap(l,n){if(typeof l!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(n))throw new Error("Second argument to map is not an array");return n.map(function(t,e){return l(t,e)})}function arrayFold(l,n,t){if(typeof l!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(t))throw new Error("Second argument to fold is not an array");return t.reduce(function(e,i,s){return l(e,i,s)},n)}function arrayFilter(l,n){if(typeof l!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(n))throw new Error("Second argument to filter is not an array");return n.filter(function(t,e){return l(t,e)})}function stringOrArrayIndexOf(l,n){if(!(Array.isArray(n)||typeof n=="string"))throw new Error("Second argument to indexOf is not a string or array");return n.indexOf(l)}function arrayJoin(l,n){if(!Array.isArray(n))throw new Error("Second argument to join is not an array");return n.join(l)}function sign(l){return(l>0)-(l<0)||+l}var ONE_THIRD=1/3;function cbrt(l){return l<0?-Math.pow(-l,ONE_THIRD):Math.pow(l,ONE_THIRD)}function expm1(l){return Math.exp(l)-1}function log1p(l){return Math.log(1+l)}function log2(l){return Math.log(l)/Math.LN2}function Parser(l){this.options=l||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||sinh,cosh:Math.cosh||cosh,tanh:Math.tanh||tanh,asinh:Math.asinh||asinh,acosh:Math.acosh||acosh,atanh:Math.atanh||atanh,sqrt:Math.sqrt,cbrt:Math.cbrt||cbrt,log:Math.log,log2:Math.log2||log2,ln:Math.log,lg:Math.log10||log10,log10:Math.log10||log10,expm1:Math.expm1||expm1,log1p:Math.log1p||log1p,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||trunc,"-":neg,"+":Number,exp:Math.exp,not,length:stringOrArrayLength,"!":factorial,sign:Math.sign||sign},this.binaryOps={"+":add$1,"-":sub,"*":mul,"/":div,"%":mod,"^":Math.pow,"||":concat,"==":equal,"!=":notEqual,">":greaterThan,"<":lessThan,">=":greaterThanEqual,"<=":lessThanEqual,and:andOperator,or:orOperator,in:inOperator,"=":setVar,"[":arrayIndex},this.ternaryOps={"?":condition},this.functions={random,fac:factorial,min,max,hypot:Math.hypot||hypot,pyt:Math.hypot||hypot,pow:Math.pow,atan2:Math.atan2,if:condition,gamma,roundTo,map:arrayMap,fold:arrayFold,filter:arrayFilter,indexOf:stringOrArrayIndexOf,join:arrayJoin},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}Parser.prototype.parse=function(l){var n=[],t=new ParserState(this,new TokenStream(this,l),{allowMemberAccess:this.options.allowMemberAccess});return t.parseExpression(n),t.expect(TEOF,"EOF"),new Expression(n,this)};Parser.prototype.evaluate=function(l,n){return this.parse(l).evaluate(n)};var sharedParser=new Parser;Parser.parse=function(l){return sharedParser.parse(l)};Parser.evaluate=function(l,n){return sharedParser.parse(l).evaluate(n)};var optionNameMap={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};function getOptionName(l){return optionNameMap.hasOwnProperty(l)?optionNameMap[l]:l}Parser.prototype.isOperatorEnabled=function(l){var n=getOptionName(l),t=this.options.operators||{};return!(n in t)||!!t[n]};class ExpressionParser extends Parser{constructor(...n){super(...n);const t=this;t.unaryOps={"-":t.unaryOps["-"],"+":t.unaryOps["+"],"!":t.unaryOps.not,not:t.unaryOps.not},t.functions={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,log:Math.log,atan2:Math.atan2,pow:Math.pow,radians:e=>e*(Math.PI/180),degrees:e=>e*(180/Math.PI),__read_property__:(e,...i)=>{let s=e;for(let r=0,o=i.length;r<o;r++)s=s[i[r]];return s}},t.binaryOps={...t.binaryOps,"+":(e,i)=>(isNumber(e)&&(e=Number(e)),isNumber(i)&&(i=Number(i)),e+i),in:(e,i)=>Array.isArray(i)||typeof i=="string"?i.includes(e):e in i,"||":(e,i)=>!!(e||i)},t.consts={...t.consts,pi:Math.PI,tau:2*Math.PI,e:Math.E}}}class XacroParser{constructor(){this.inOrder=!0,this.requirePrefix=!0,this.localProperties=!0,this.rospackCommands={},this.arguments={},this.expressionParser=new ExpressionParser,this.workingPath=""}async getFileContents(n){throw new Error("XacroParser: getFileContents() not implemented.")}async parse(n){function t(N,B,W=!1){function A(M,J){if(typeof M!="string")return M;const Q=M.split(/(\$?\$\([^)]+\))|(\$?\${[^}]+})/g).filter(tt=>!!tt).map(tt=>{if(!/^\$[{(].+/.test(tt)||/^\$\$/.test(tt))return tt;const rt=/^\$\(/.test(tt);let ft=tt.substring(2,tt.length-1);if(ft=A(ft,J),/\[.+\]$/.test(ft)&&(ft=ft.replace(/([^[\s]+)(\[[^[]+\])+/g,(yt,...Z)=>{const bt=yt.split(/[[\]]+/g);return bt.pop(),`__read_property__( ${bt.join(",")} )`})),rt){const Z=A(ft,J).split(/\s+/g),bt=Z.shift();try{return C(bt,...Z)}catch(at){throw new Error(`XacroParser: Cannot run rospack command "${ft}".
`+at.message)}}else{if(G.includes(ft))throw new Error(`XacroParser: Cannot evaluate infinitely recursive expression: ${G.join(" > ")} > ${ft}`);G.push(ft);const yt=/([()/*+!\-%|&=])+/g,Z=tokenize(ft).map(bt=>{if(yt.lastIndex=0,isOperator(bt)||isNumber(bt)||isString(bt))return bt;if(bt in J){const at=A(J[bt],J);return!isNumber(at)&&typeof at!="object"?`"${at.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:at}else return bt}).map(bt=>(yt.lastIndex=0,/^[^0-9.]/.test(bt)&&!yt.test(bt)?` ${bt} `:bt)).join("");if(G.pop(),isString(Z))return Z.substring(1,Z.length-1);if(isNumber(Z))return Z;{const bt=normalizeExpression(Z);return O.evaluate(bt,J)}}}),ot=Q.filter(tt=>(typeof tt=="string"&&(tt=tt.trim()),tt!==""&&tt!==null&&tt!==void 0));return ot.length===1?ot[0]:Q.join("")}const G=[],D=mergePropertySets(x,B);try{let M=A(N,D);return W&&typeof M=="string"&&(M=M.replace(/\${2}([({])/g,(J,et)=>`$${et}`)),M}catch(M){throw new Error(`XacroParser: Failed to process expression "${N}". 
`+M.message)}}async function e(N,B,W,A){const G=N.tagName.replace(/^xacro:/,""),D=W[G];if(!D)throw new Error(`XacroParser: Cannot find macro "${G}"`);const M=B,J=W;B=createNewPropertyScope(B),W=mergePropertySets(W);let et=[];for(const tt of N.children)await r(tt,M,J,et);et=et.filter(tt=>tt.nodeType===tt.ELEMENT_NODE);let Q=0;for(const tt in D.params){const rt=D.params[tt];N.hasAttribute(tt)?B[tt]=t(N.getAttribute(tt),M):rt.type==="BLOCK"?(B[tt]=[et[Q]],Q++):rt.type==="MULTI_BLOCK"?B[tt]=[...et.filter(ft=>ft.tagName===tt)[0].childNodes]:B[tt]=t(D.params[tt].def,M)}const ot=[...D.node.childNodes];for(const tt of ot){const rt=[];await r(tt,B,W,rt),A.push(...rt)}}function i(N){const B={};if(/^\*\*/.test(N)?B.type="MULTI_BLOCK":/^\*/.test(N)?B.type="BLOCK":B.type="PARAM",N=N.replace(/^\*{1,2}/g,""),/:?=/.test(N)){const[W,A]=N.split(/:?=/);if(/^\^/.test(A)||/\|/.test(A))throw new Error(`XacroParser: ROS Jade pass-through notation not supported in macro defaults: ${A}`);B.name=W,A.startsWith("'")&&A.endsWith("'")?B.def=A.substring(1,A.length-1):B.def=A}else B.name=N,B.def=null;return B}function s(N){const B=N.getAttribute("name").replace(/^xacro:/,""),W=N.getAttribute("params"),A={};return W&&W.trim().match(/[^\s']+('[^']*')?/g).map(D=>i(D)).forEach(D=>{A[D.name]=D}),{name:B,node:deepClone(N,!1),params:A}}async function r(N,B,W,A=[]){if(N.nodeType===N.TEXT_NODE){const D=N.cloneNode();D.textContent=t(D.textContent,B,!0),A.push(D);return}else if(N.nodeType!==N.ELEMENT_NODE){A.push(N.cloneNode());return}let G=N.tagName.toLowerCase();if(!_)switch(G){case"arg":case"property":case"macro":case"insert_block":case"if":case"unless":case"include":case"element":case"attribute":G=`xacro:${G}`;break;default:G in W&&(G=`xacro:${G}`);break}switch(G){case"xacro:property":{removeEndCommentsFromArray(A);const D=N.getAttribute("name");let M;if(N.hasAttribute("value"))M=N.getAttribute("value");else if(N.hasAttribute("default"))M=N.getAttribute("default");else{const et=[...N.childNodes];M=[];for(const Q of et)M.push(deepClone(Q,!1))}let J="global";S&&(J=N.getAttribute("scope")||"local"),J!=="local"&&(M=t(M,B)),J==="global"?x[D]=M:J==="parent"?B[PARENT_SCOPE][D]=M:B[D]=M;break}case"xacro:macro":{removeEndCommentsFromArray(A);const D=s(N);W[D.name]=D;break}case"xacro:insert_block":{removeEndCommentsFromArray(A);const D=N.getAttribute("name"),M=B[D];for(const J of M)await r(J,B,W,A);return}case"xacro:if":case"xacro:unless":{removeEndCommentsFromArray(A);const D=t(N.getAttribute("value"),B,!0);let M=null;if(isNaN(parseFloat(D))?D==="true"||D==="false"?M=D==="true":M=D:M=!!parseFloat(D),G==="xacro:unless"&&(M=!M),M){const J=[...N.childNodes];for(const et of J)await r(et,B,W,A)}return}case"xacro:include":{if(removeEndCommentsFromArray(A),N.hasAttribute("ns"))throw new Error("XacroParser: xacro:include name spaces not supported.");const D=t(N.getAttribute("filename"),B,!0),J=/^[/\\]/.test(D)||/^[a-zA-Z]+:[/\\]/.test(D)?D:P+D,et=P;P=getUrlBase(J);const ot=[...(await u(J)).children[0].childNodes];for(const tt of ot)await r(tt,B,W,A);P=et;return}case"xacro:arg":{const D=N.getAttribute("name");m[D]=t(N.getAttribute("default"),B,!0);return}case"xacro:attribute":case"xacro:element":throw new Error(`XacroParser: ${G} tags not supported.`);default:{if(/^xacro:/.test(G)||G in W)return removeEndCommentsFromArray(A),e(N,B,W,A);{const D=N.cloneNode();for(let et=0,Q=D.attributes.length;et<Q;et++){const ot=D.attributes[et],tt=t(ot.value,B,!0);D.setAttribute(ot.name,tt)}const M=[...N.childNodes],J=[];for(let et=0,Q=M.length;et<Q;et++)await r(M[et],B,W,J);J.forEach(et=>D.appendChild(et)),A.push(D)}}}}async function o(N,B,W){const A=getElementsWithName(N,"xacro:property");_||A.push(...getElementsWithName(N,"property"));for(const D of A)await r(D,B,W);const G=getElementsWithName(N,"xacro:macro");_||G.push(...getElementsWithName(N,"macro"));for(const D of G)await r(D,B,W)}async function h(N,B,W){const A=N.cloneNode();for(let G=0,D=N.children.length;G<D;G++){const M=[];await r(N.children[G],B,W,M);const J=M[0];J.removeAttribute("xmlns:xacro"),A.appendChild(J)}return A}async function u(N){try{const B=await d.getFileContents(N);return new DOMParser().parseFromString(B,"text/xml")}catch{throw new Error(`XacroParser: Could not load included file: ${N}`)}}async function p(N,B,W=[]){const A=getElementsWithName(N,"xacro:include");_||A.push(...getElementsWithName(N,"include"));const G=A.map(D=>{if(D.hasAttribute("ns"))throw new Error("XacroParser: xacro:include name spaces not supported.");const M=D.getAttribute("filename"),J=D.getAttribute("ns")||null,Q=/^[/\\]/.test(M)||/^[a-zA-Z]+:[/\\]/.test(M)?M:B+M;return u(Q).then(tt=>{W.push({filename:M,namespace:J,content:tt});const rt=getUrlBase(Q);return p(tt,rt,W)})});return await Promise.all(G),W}const d=this,f=this.inOrder,g=this.workingPath+(this.workingPath&&!/[\\/]$/.test(this.workingPath)?"/":""),_=this.requirePrefix,v=this.rospackCommands,y={},E={},m={},x={True:1,False:0};x[PARENT_SCOPE]=x;const C=(N,...B)=>{let W;if(v instanceof Function&&(W=v(N,...B)),W==null&&v!=null&&typeof v[N]=="function"&&(W=v[N](...B)),W==null&&N==="arg"){const A=B[0];if(A===void 0)throw new Error("XacroParser: $(arg) must specify a variable name");if(W=this.arguments[A],W==null&&(W=m[A]),W==null)throw new Error(`XacroParser: Undefined substitution argument ${A}`)}return W},O=this.expressionParser;let S=this.localProperties,P=g,F=new DOMParser().parseFromString(n,"text/xml");S&&!f&&(console.warn('XacroParser: Implicitly setting "localProperties" option to false because "inOrder" is false.'),S=!1);let V=null;return f?V=Promise.resolve():V=async function(){return await o(F,x,y),F=deepClone(F,!0),p(F,g).then(N=>{N.forEach(B=>{o(B.content,x,y),B.content=deepClone(B.content,!0),E[B.filename]=B.content})})}(),await V,h(F,x,y)}}class XacroLoader extends XacroParser{constructor(){super(),this.fetchOptions={}}load(n,t,e){const i=getUrlBase(n);this.workingPath===""&&(this.workingPath=i),this.getFileContents(n).then(s=>{this.parse(s,t,e)}).catch(s=>{e&&e(s)})}parse(n,t,e){super.parse(n).then(t).catch(i=>{e&&e(i)})}getFileContents(n){return fetch(n,this.fetchOptions).then(t=>{if(t.ok)return t.text();throw new Error(`XacroLoader: Failed to load url '${n}' with error code ${t.status} : ${t.statusText}.`)})}}class TGALoader extends DataTextureLoader{constructor(n){super(n)}parse(n){function t(M){switch(M.image_type){case f:case v:(M.colormap_length>256||M.colormap_size!==24||M.colormap_type!==1)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case g:case _:case y:case E:M.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case d:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',M.image_type)}(M.width<=0||M.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),M.pixel_size!==8&&M.pixel_size!==16&&M.pixel_size!==24&&M.pixel_size!==32&&console.error('THREE.TGALoader: Invalid pixel size "%s".',M.pixel_size)}function e(M,J,et,Q,ot){let tt,rt;const ft=et.pixel_size>>3,_t=et.width*et.height*ft;if(J&&(rt=ot.subarray(Q,Q+=et.colormap_length*(et.colormap_size>>3))),M){tt=new Uint8Array(_t);let yt,Z,bt,at=0;const nt=new Uint8Array(ft);for(;at<_t;)if(yt=ot[Q++],Z=(yt&127)+1,yt&128){for(bt=0;bt<ft;++bt)nt[bt]=ot[Q++];for(bt=0;bt<Z;++bt)tt.set(nt,at+bt*ft);at+=ft*Z}else{for(Z*=ft,bt=0;bt<Z;++bt)tt[at+bt]=ot[Q++];at+=Z}}else tt=ot.subarray(Q,Q+=J?et.width*et.height:_t);return{pixel_data:tt,palettes:rt}}function i(M,J,et,Q,ot,tt,rt,ft,_t){const yt=_t;let Z,bt=0,at,nt;const ht=N.width;for(nt=J;nt!==Q;nt+=et)for(at=ot;at!==rt;at+=tt,bt++)Z=ft[bt],M[(at+ht*nt)*4+3]=255,M[(at+ht*nt)*4+2]=yt[Z*3+0],M[(at+ht*nt)*4+1]=yt[Z*3+1],M[(at+ht*nt)*4+0]=yt[Z*3+2];return M}function s(M,J,et,Q,ot,tt,rt,ft){let _t,yt=0,Z,bt;const at=N.width;for(bt=J;bt!==Q;bt+=et)for(Z=ot;Z!==rt;Z+=tt,yt+=2)_t=ft[yt+0]+(ft[yt+1]<<8),M[(Z+at*bt)*4+0]=(_t&31744)>>7,M[(Z+at*bt)*4+1]=(_t&992)>>2,M[(Z+at*bt)*4+2]=(_t&31)>>3,M[(Z+at*bt)*4+3]=_t&32768?0:255;return M}function r(M,J,et,Q,ot,tt,rt,ft){let _t=0,yt,Z;const bt=N.width;for(Z=J;Z!==Q;Z+=et)for(yt=ot;yt!==rt;yt+=tt,_t+=3)M[(yt+bt*Z)*4+3]=255,M[(yt+bt*Z)*4+2]=ft[_t+0],M[(yt+bt*Z)*4+1]=ft[_t+1],M[(yt+bt*Z)*4+0]=ft[_t+2];return M}function o(M,J,et,Q,ot,tt,rt,ft){let _t=0,yt,Z;const bt=N.width;for(Z=J;Z!==Q;Z+=et)for(yt=ot;yt!==rt;yt+=tt,_t+=4)M[(yt+bt*Z)*4+2]=ft[_t+0],M[(yt+bt*Z)*4+1]=ft[_t+1],M[(yt+bt*Z)*4+0]=ft[_t+2],M[(yt+bt*Z)*4+3]=ft[_t+3];return M}function h(M,J,et,Q,ot,tt,rt,ft){let _t,yt=0,Z,bt;const at=N.width;for(bt=J;bt!==Q;bt+=et)for(Z=ot;Z!==rt;Z+=tt,yt++)_t=ft[yt],M[(Z+at*bt)*4+0]=_t,M[(Z+at*bt)*4+1]=_t,M[(Z+at*bt)*4+2]=_t,M[(Z+at*bt)*4+3]=255;return M}function u(M,J,et,Q,ot,tt,rt,ft){let _t=0,yt,Z;const bt=N.width;for(Z=J;Z!==Q;Z+=et)for(yt=ot;yt!==rt;yt+=tt,_t+=2)M[(yt+bt*Z)*4+0]=ft[_t+0],M[(yt+bt*Z)*4+1]=ft[_t+0],M[(yt+bt*Z)*4+2]=ft[_t+0],M[(yt+bt*Z)*4+3]=ft[_t+1];return M}function p(M,J,et,Q,ot){let tt,rt,ft,_t,yt,Z;switch((N.flags&m)>>x){default:case S:tt=0,ft=1,yt=J,rt=0,_t=1,Z=et;break;case C:tt=0,ft=1,yt=J,rt=et-1,_t=-1,Z=-1;break;case P:tt=J-1,ft=-1,yt=-1,rt=0,_t=1,Z=et;break;case O:tt=J-1,ft=-1,yt=-1,rt=et-1,_t=-1,Z=-1;break}if(A)switch(N.pixel_size){case 8:h(M,rt,_t,Z,tt,ft,yt,Q);break;case 16:u(M,rt,_t,Z,tt,ft,yt,Q);break;default:console.error("THREE.TGALoader: Format not supported.");break}else switch(N.pixel_size){case 8:i(M,rt,_t,Z,tt,ft,yt,Q,ot);break;case 16:s(M,rt,_t,Z,tt,ft,yt,Q);break;case 24:r(M,rt,_t,Z,tt,ft,yt,Q);break;case 32:o(M,rt,_t,Z,tt,ft,yt,Q);break;default:console.error("THREE.TGALoader: Format not supported.");break}return M}const d=0,f=1,g=2,_=3,v=9,y=10,E=11,m=48,x=4,C=0,O=1,S=2,P=3;n.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");let F=0;const V=new Uint8Array(n),N={id_length:V[F++],colormap_type:V[F++],image_type:V[F++],colormap_index:V[F++]|V[F++]<<8,colormap_length:V[F++]|V[F++]<<8,colormap_size:V[F++],origin:[V[F++]|V[F++]<<8,V[F++]|V[F++]<<8],width:V[F++]|V[F++]<<8,height:V[F++]|V[F++]<<8,pixel_size:V[F++],flags:V[F++]};t(N),N.id_length+F>n.length&&console.error("THREE.TGALoader: No data."),F+=N.id_length;let B=!1,W=!1,A=!1;switch(N.image_type){case v:B=!0,W=!0;break;case f:W=!0;break;case y:B=!0;break;case g:break;case E:B=!0,A=!0;break;case _:A=!0;break}const G=new Uint8Array(N.width*N.height*4),D=e(B,W,N,F,V);return p(G,N.width,N.height,D.pixel_data,D.palettes),{data:G,width:N.width,height:N.height,flipY:!0,generateMipmaps:!0,minFilter:LinearMipmapLinearFilter}}}class ColladaLoader extends Loader{constructor(n){super(n)}load(n,t,e,i){const s=this,r=s.path===""?LoaderUtils.extractUrlBase(n):s.path,o=new FileLoader(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(n,function(h){try{t(s.parse(h,r))}catch(u){i?i(u):console.error(u),s.manager.itemError(n)}},e,i)}parse(n,t){function e(I,w){const k=[],U=I.childNodes;for(let L=0,it=U.length;L<it;L++){const Tt=U[L];Tt.nodeName===w&&k.push(Tt)}return k}function i(I){if(I.length===0)return[];const w=I.trim().split(/\s+/),k=new Array(w.length);for(let U=0,L=w.length;U<L;U++)k[U]=w[U];return k}function s(I){if(I.length===0)return[];const w=I.trim().split(/\s+/),k=new Array(w.length);for(let U=0,L=w.length;U<L;U++)k[U]=parseFloat(w[U]);return k}function r(I){if(I.length===0)return[];const w=I.trim().split(/\s+/),k=new Array(w.length);for(let U=0,L=w.length;U<L;U++)k[U]=parseInt(w[U]);return k}function o(I){return I.substring(1)}function h(){return"three_default_"+be++}function u(I){return Object.keys(I).length===0}function p(I){return{unit:d(e(I,"unit")[0]),upAxis:f(e(I,"up_axis")[0])}}function d(I){return I!==void 0&&I.hasAttribute("meter")===!0?parseFloat(I.getAttribute("meter")):1}function f(I){return I!==void 0?I.textContent:"Y_UP"}function g(I,w,k,U){const L=e(I,w)[0];if(L!==void 0){const it=e(L,k);for(let Tt=0;Tt<it.length;Tt++)U(it[Tt])}}function _(I,w){for(const k in I){const U=I[k];U.build=w(I[k])}}function v(I,w){return I.build!==void 0||(I.build=w(I)),I.build}function y(I){const w={sources:{},samplers:{},channels:{}};let k=!1;for(let U=0,L=I.childNodes.length;U<L;U++){const it=I.childNodes[U];if(it.nodeType!==1)continue;let Tt;switch(it.nodeName){case"source":Tt=it.getAttribute("id"),w.sources[Tt]=Fe(it);break;case"sampler":Tt=it.getAttribute("id"),w.samplers[Tt]=E(it);break;case"channel":Tt=it.getAttribute("target"),w.channels[Tt]=m(it);break;case"animation":y(it),k=!0;break;default:console.log(it)}}k===!1&&(Gt.animations[I.getAttribute("id")||MathUtils.generateUUID()]=w)}function E(I){const w={inputs:{}};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"input":const it=o(L.getAttribute("source")),Tt=L.getAttribute("semantic");w.inputs[Tt]=it;break}}return w}function m(I){const w={};let U=I.getAttribute("target").split("/");const L=U.shift();let it=U.shift();const Tt=it.indexOf("(")!==-1,Nt=it.indexOf(".")!==-1;if(Nt)U=it.split("."),it=U.shift(),w.member=U.shift();else if(Tt){const Vt=it.split("(");it=Vt.shift();for(let Ht=0;Ht<Vt.length;Ht++)Vt[Ht]=parseInt(Vt[Ht].replace(/\)/,""));w.indices=Vt}return w.id=L,w.sid=it,w.arraySyntax=Tt,w.memberSyntax=Nt,w.sampler=o(I.getAttribute("source")),w}function x(I){const w=[],k=I.channels,U=I.samplers,L=I.sources;for(const it in k)if(k.hasOwnProperty(it)){const Tt=k[it],Nt=U[Tt.sampler],Vt=Nt.inputs.INPUT,Ht=Nt.inputs.OUTPUT,wt=L[Vt],It=L[Ht],Kt=O(Tt,wt,It);N(Kt,w)}return w}function C(I){return v(Gt.animations[I],x)}function O(I,w,k){const U=Gt.nodes[I.id],L=Ge(U.id),it=U.transforms[I.sid],Tt=U.matrix.clone().transpose();let Nt,Vt,Ht,wt,It,Kt;const Ut={};switch(it){case"matrix":for(Ht=0,wt=w.array.length;Ht<wt;Ht++)if(Nt=w.array[Ht],Vt=Ht*k.stride,Ut[Nt]===void 0&&(Ut[Nt]={}),I.arraySyntax===!0){const re=k.array[Vt],he=I.indices[0]+4*I.indices[1];Ut[Nt][he]=re}else for(It=0,Kt=k.stride;It<Kt;It++)Ut[Nt][It]=k.array[Vt+It];break;case"translate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',it);break;case"rotate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',it);break;case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',it);break}const qt=S(Ut,Tt);return{name:L.uuid,keyframes:qt}}function S(I,w){const k=[];for(const L in I)k.push({time:parseFloat(L),value:I[L]});k.sort(U);for(let L=0;L<16;L++)B(k,L,w.elements[L]);return k;function U(L,it){return L.time-it.time}}const P=new Vector3,F=new Vector3,V=new Quaternion$1;function N(I,w){const k=I.keyframes,U=I.name,L=[],it=[],Tt=[],Nt=[];for(let Vt=0,Ht=k.length;Vt<Ht;Vt++){const wt=k[Vt],It=wt.time,Kt=wt.value;Jt.fromArray(Kt).transpose(),Jt.decompose(P,V,F),L.push(It),it.push(P.x,P.y,P.z),Tt.push(V.x,V.y,V.z,V.w),Nt.push(F.x,F.y,F.z)}return it.length>0&&w.push(new VectorKeyframeTrack(U+".position",L,it)),Tt.length>0&&w.push(new QuaternionKeyframeTrack(U+".quaternion",L,Tt)),Nt.length>0&&w.push(new VectorKeyframeTrack(U+".scale",L,Nt)),w}function B(I,w,k){let U,L=!0,it,Tt;for(it=0,Tt=I.length;it<Tt;it++)U=I[it],U.value[w]===void 0?U.value[w]=null:L=!1;if(L===!0)for(it=0,Tt=I.length;it<Tt;it++)U=I[it],U.value[w]=k;else W(I,w)}function W(I,w){let k,U;for(let L=0,it=I.length;L<it;L++){const Tt=I[L];if(Tt.value[w]===null){if(k=A(I,L,w),U=G(I,L,w),k===null){Tt.value[w]=U.value[w];continue}if(U===null){Tt.value[w]=k.value[w];continue}D(Tt,k,U,w)}}}function A(I,w,k){for(;w>=0;){const U=I[w];if(U.value[k]!==null)return U;w--}return null}function G(I,w,k){for(;w<I.length;){const U=I[w];if(U.value[k]!==null)return U;w++}return null}function D(I,w,k,U){if(k.time-w.time===0){I.value[U]=w.value[U];return}I.value[U]=(I.time-w.time)*(k.value[U]-w.value[U])/(k.time-w.time)+w.value[U]}function M(I){const w={name:I.getAttribute("id")||"default",start:parseFloat(I.getAttribute("start")||0),end:parseFloat(I.getAttribute("end")||0),animations:[]};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"instance_animation":w.animations.push(o(L.getAttribute("url")));break}}Gt.clips[I.getAttribute("id")]=w}function J(I){const w=[],k=I.name,U=I.end-I.start||-1,L=I.animations;for(let it=0,Tt=L.length;it<Tt;it++){const Nt=C(L[it]);for(let Vt=0,Ht=Nt.length;Vt<Ht;Vt++)w.push(Nt[Vt])}return new AnimationClip(k,U,w)}function et(I){return v(Gt.clips[I],J)}function Q(I){const w={};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"skin":w.id=o(L.getAttribute("source")),w.skin=ot(L);break;case"morph":w.id=o(L.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.");break}}Gt.controllers[I.getAttribute("id")]=w}function ot(I){const w={sources:{}};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"bind_shape_matrix":w.bindShapeMatrix=s(L.textContent);break;case"source":const it=L.getAttribute("id");w.sources[it]=Fe(L);break;case"joints":w.joints=tt(L);break;case"vertex_weights":w.vertexWeights=rt(L);break}}return w}function tt(I){const w={inputs:{}};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"input":const it=L.getAttribute("semantic"),Tt=o(L.getAttribute("source"));w.inputs[it]=Tt;break}}return w}function rt(I){const w={inputs:{}};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"input":const it=L.getAttribute("semantic"),Tt=o(L.getAttribute("source")),Nt=parseInt(L.getAttribute("offset"));w.inputs[it]={id:Tt,offset:Nt};break;case"vcount":w.vcount=r(L.textContent);break;case"v":w.v=r(L.textContent);break}}return w}function ft(I){const w={id:I.id},k=Gt.geometries[w.id];return I.skin!==void 0&&(w.skin=_t(I.skin),k.sources.skinIndices=w.skin.indices,k.sources.skinWeights=w.skin.weights),w}function _t(I){const k={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},U=I.sources,L=I.vertexWeights,it=L.vcount,Tt=L.v,Nt=L.inputs.JOINT.offset,Vt=L.inputs.WEIGHT.offset,Ht=I.sources[I.joints.inputs.JOINT],wt=I.sources[I.joints.inputs.INV_BIND_MATRIX],It=U[L.inputs.WEIGHT.id].array;let Kt=0,Ut,qt,zt;for(Ut=0,zt=it.length;Ut<zt;Ut++){const he=it[Ut],pe=[];for(qt=0;qt<he;qt++){const ue=Tt[Kt+Nt],Me=Tt[Kt+Vt],Se=It[Me];pe.push({index:ue,weight:Se}),Kt+=2}for(pe.sort(re),qt=0;qt<4;qt++){const ue=pe[qt];ue!==void 0?(k.indices.array.push(ue.index),k.weights.array.push(ue.weight)):(k.indices.array.push(0),k.weights.array.push(0))}}for(I.bindShapeMatrix?k.bindMatrix=new Matrix4().fromArray(I.bindShapeMatrix).transpose():k.bindMatrix=new Matrix4().identity(),Ut=0,zt=Ht.array.length;Ut<zt;Ut++){const he=Ht.array[Ut],pe=new Matrix4().fromArray(wt.array,Ut*wt.stride).transpose();k.joints.push({name:he,boneInverse:pe})}return k;function re(he,pe){return pe.weight-he.weight}}function yt(I){return v(Gt.controllers[I],ft)}function Z(I){const w={init_from:e(I,"init_from")[0].textContent};Gt.images[I.getAttribute("id")]=w}function bt(I){return I.build!==void 0?I.build:I.init_from}function at(I){const w=Gt.images[I];return w!==void 0?v(w,bt):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",I),null)}function nt(I){const w={};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"profile_COMMON":w.profile=ht(L);break}}Gt.effects[I.getAttribute("id")]=w}function ht(I){const w={surfaces:{},samplers:{}};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"newparam":Ct(L,w);break;case"technique":w.technique=Rt(L);break;case"extra":w.extra=St(L);break}}return w}function Ct(I,w){const k=I.getAttribute("sid");for(let U=0,L=I.childNodes.length;U<L;U++){const it=I.childNodes[U];if(it.nodeType===1)switch(it.nodeName){case"surface":w.surfaces[k]=gt(it);break;case"sampler2D":w.samplers[k]=mt(it);break}}}function gt(I){const w={};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"init_from":w.init_from=L.textContent;break}}return w}function mt(I){const w={};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"source":w.source=L.textContent;break}}return w}function Rt(I){const w={};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"constant":case"lambert":case"blinn":case"phong":w.type=L.nodeName,w.parameters=Ft(L);break}}return w}function Ft(I){const w={};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":w[L.nodeName]=Pt(L);break;case"transparent":w[L.nodeName]={opaque:L.getAttribute("opaque"),data:Pt(L)};break}}return w}function Pt(I){const w={};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"color":w[L.nodeName]=s(L.textContent);break;case"float":w[L.nodeName]=parseFloat(L.textContent);break;case"texture":w[L.nodeName]={id:L.getAttribute("texture"),extra:X(L)};break}}return w}function X(I){const w={technique:{}};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"extra":z(L,w);break}}return w}function z(I,w){for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"technique":vt(L,w);break}}}function vt(I,w){for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":w.technique[L.nodeName]=parseFloat(L.textContent);break;case"wrapU":case"wrapV":L.textContent.toUpperCase()==="TRUE"?w.technique[L.nodeName]=1:L.textContent.toUpperCase()==="FALSE"?w.technique[L.nodeName]=0:w.technique[L.nodeName]=parseInt(L.textContent);break}}}function St(I){const w={};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"technique":w.technique=Dt(L);break}}return w}function Dt(I){const w={};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"double_sided":w[L.nodeName]=parseInt(L.textContent);break}}return w}function kt(I){return I}function Wt(I){return v(Gt.effects[I],kt)}function Y(I){const w={name:I.getAttribute("name")};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"instance_effect":w.url=o(L.getAttribute("url"));break}}Gt.materials[I.getAttribute("id")]=w}function At(I){let w,k=I.slice((I.lastIndexOf(".")-1>>>0)+2);switch(k=k.toLowerCase(),k){case"tga":w=Ye;break;default:w=le}return w}function Mt(I){const w=Wt(I.url),k=w.profile.technique,U=w.profile.extra;let L;switch(k.type){case"phong":case"blinn":L=new MeshPhongMaterial;break;case"lambert":L=new MeshLambertMaterial;break;default:L=new MeshBasicMaterial;break}L.name=I.name||"";function it(Ht){const wt=w.profile.samplers[Ht.id];let It=null;if(wt!==void 0){const Kt=w.profile.surfaces[wt.source];It=at(Kt.init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),It=at(Ht.id);if(It!==null){const Kt=At(It);if(Kt!==void 0){const Ut=Kt.load(It),qt=Ht.extra;if(qt!==void 0&&qt.technique!==void 0&&u(qt.technique)===!1){const zt=qt.technique;Ut.wrapS=zt.wrapU?RepeatWrapping:ClampToEdgeWrapping,Ut.wrapT=zt.wrapV?RepeatWrapping:ClampToEdgeWrapping,Ut.offset.set(zt.offsetU||0,zt.offsetV||0),Ut.repeat.set(zt.repeatU||1,zt.repeatV||1)}else Ut.wrapS=RepeatWrapping,Ut.wrapT=RepeatWrapping;return Ut}else return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",It),null}else return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",Ht.id),null}const Tt=k.parameters;for(const Ht in Tt){const wt=Tt[Ht];switch(Ht){case"diffuse":wt.color&&L.color.fromArray(wt.color),wt.texture&&(L.map=it(wt.texture));break;case"specular":wt.color&&L.specular&&L.specular.fromArray(wt.color),wt.texture&&(L.specularMap=it(wt.texture));break;case"bump":wt.texture&&(L.normalMap=it(wt.texture));break;case"ambient":wt.texture&&(L.lightMap=it(wt.texture));break;case"shininess":wt.float&&L.shininess&&(L.shininess=wt.float);break;case"emission":wt.color&&L.emissive&&L.emissive.fromArray(wt.color),wt.texture&&(L.emissiveMap=it(wt.texture));break}}let Nt=Tt.transparent,Vt=Tt.transparency;if(Vt===void 0&&Nt&&(Vt={float:1}),Nt===void 0&&Vt&&(Nt={opaque:"A_ONE",data:{color:[1,1,1,1]}}),Nt&&Vt)if(Nt.data.texture)L.transparent=!0;else{const Ht=Nt.data.color;switch(Nt.opaque){case"A_ONE":L.opacity=Ht[3]*Vt.float;break;case"RGB_ZERO":L.opacity=1-Ht[0]*Vt.float;break;case"A_ZERO":L.opacity=1-Ht[3]*Vt.float;break;case"RGB_ONE":L.opacity=Ht[0]*Vt.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',Nt.opaque)}L.opacity<1&&(L.transparent=!0)}return U!==void 0&&U.technique!==void 0&&U.technique.double_sided===1&&(L.side=DoubleSide),L}function q(I){return v(Gt.materials[I],Mt)}function xt(I){const w={name:I.getAttribute("name")};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"optics":w.optics=pt(L);break}}Gt.cameras[I.getAttribute("id")]=w}function pt(I){for(let w=0;w<I.childNodes.length;w++){const k=I.childNodes[w];switch(k.nodeName){case"technique_common":return Bt(k)}}return{}}function Bt(I){const w={};for(let k=0;k<I.childNodes.length;k++){const U=I.childNodes[k];switch(U.nodeName){case"perspective":case"orthographic":w.technique=U.nodeName,w.parameters=Ot(U);break}}return w}function Ot(I){const w={};for(let k=0;k<I.childNodes.length;k++){const U=I.childNodes[k];switch(U.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":w[U.nodeName]=parseFloat(U.textContent);break}}return w}function te(I){let w;switch(I.optics.technique){case"perspective":w=new PerspectiveCamera(I.optics.parameters.yfov,I.optics.parameters.aspect_ratio,I.optics.parameters.znear,I.optics.parameters.zfar);break;case"orthographic":let k=I.optics.parameters.ymag,U=I.optics.parameters.xmag;const L=I.optics.parameters.aspect_ratio;U=U===void 0?k*L:U,k=k===void 0?U/L:k,U*=.5,k*=.5,w=new OrthographicCamera(-U,U,k,-k,I.optics.parameters.znear,I.optics.parameters.zfar);break;default:w=new PerspectiveCamera;break}return w.name=I.name||"",w}function ce(I){const w=Gt.cameras[I];return w!==void 0?v(w,te):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",I),null)}function Ee(I){let w={};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"technique_common":w=Ie(L);break}}Gt.lights[I.getAttribute("id")]=w}function Ie(I){const w={};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"directional":case"point":case"spot":case"ambient":w.technique=L.nodeName,w.parameters=fe(L)}}return w}function fe(I){const w={};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"color":const it=s(L.textContent);w.color=new Color().fromArray(it);break;case"falloff_angle":w.falloffAngle=parseFloat(L.textContent);break;case"quadratic_attenuation":const Tt=parseFloat(L.textContent);w.distance=Tt?Math.sqrt(1/Tt):0;break}}return w}function Te(I){let w;switch(I.technique){case"directional":w=new DirectionalLight;break;case"point":w=new PointLight;break;case"spot":w=new SpotLight;break;case"ambient":w=new AmbientLight;break}return I.parameters.color&&w.color.copy(I.parameters.color),I.parameters.distance&&(w.distance=I.parameters.distance),w}function we(I){const w=Gt.lights[I];return w!==void 0?v(w,Te):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",I),null)}function $e(I){const w={name:I.getAttribute("name"),sources:{},vertices:{},primitives:[]},k=e(I,"mesh")[0];if(k!==void 0){for(let U=0;U<k.childNodes.length;U++){const L=k.childNodes[U];if(L.nodeType!==1)continue;const it=L.getAttribute("id");switch(L.nodeName){case"source":w.sources[it]=Fe(L);break;case"vertices":w.vertices=ze(L);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",L.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":w.primitives.push(Ae(L));break;default:console.log(L)}}Gt.geometries[I.getAttribute("id")]=w}}function Fe(I){const w={array:[],stride:3};for(let k=0;k<I.childNodes.length;k++){const U=I.childNodes[k];if(U.nodeType===1)switch(U.nodeName){case"float_array":w.array=s(U.textContent);break;case"Name_array":w.array=i(U.textContent);break;case"technique_common":const L=e(U,"accessor")[0];L!==void 0&&(w.stride=parseInt(L.getAttribute("stride")));break}}return w}function ze(I){const w={};for(let k=0;k<I.childNodes.length;k++){const U=I.childNodes[k];U.nodeType===1&&(w[U.getAttribute("semantic")]=o(U.getAttribute("source")))}return w}function Ae(I){const w={type:I.nodeName,material:I.getAttribute("material"),count:parseInt(I.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let k=0,U=I.childNodes.length;k<U;k++){const L=I.childNodes[k];if(L.nodeType===1)switch(L.nodeName){case"input":const it=o(L.getAttribute("source")),Tt=L.getAttribute("semantic"),Nt=parseInt(L.getAttribute("offset")),Vt=parseInt(L.getAttribute("set")),Ht=Vt>0?Tt+Vt:Tt;w.inputs[Ht]={id:it,offset:Nt},w.stride=Math.max(w.stride,Nt+1),Tt==="TEXCOORD"&&(w.hasUV=!0);break;case"vcount":w.vcount=r(L.textContent);break;case"p":w.p=r(L.textContent);break}}return w}function Ze(I){const w={};for(let k=0;k<I.length;k++){const U=I[k];w[U.type]===void 0&&(w[U.type]=[]),w[U.type].push(U)}return w}function ni(I){let w=0;for(let k=0,U=I.length;k<U;k++)I[k].hasUV===!0&&w++;w>0&&w<I.length&&(I.uvsNeedsFix=!0)}function Be(I){const w={},k=I.sources,U=I.vertices,L=I.primitives;if(L.length===0)return{};const it=Ze(L);for(const Tt in it){const Nt=it[Tt];ni(Nt),w[Tt]=Qe(Nt,k,U)}return w}function Qe(I,w,k){const U={},L={array:[],stride:0},it={array:[],stride:0},Tt={array:[],stride:0},Nt={array:[],stride:0},Vt={array:[],stride:0},Ht={array:[],stride:4},wt={array:[],stride:4},It=new BufferGeometry,Kt=[];let Ut=0;for(let qt=0;qt<I.length;qt++){const zt=I[qt],re=zt.inputs;let he=0;switch(zt.type){case"lines":case"linestrips":he=zt.count*2;break;case"triangles":he=zt.count*3;break;case"polylist":for(let pe=0;pe<zt.count;pe++){const ue=zt.vcount[pe];switch(ue){case 3:he+=3;break;case 4:he+=6;break;default:he+=(ue-2)*3;break}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",zt.type)}It.addGroup(Ut,he,qt),Ut+=he,zt.material&&Kt.push(zt.material);for(const pe in re){const ue=re[pe];switch(pe){case"VERTEX":for(const Me in k){const Se=k[Me];switch(Me){case"POSITION":const He=L.array.length;if(Re(zt,w[Se],ue.offset,L.array),L.stride=w[Se].stride,w.skinWeights&&w.skinIndices&&(Re(zt,w.skinIndices,ue.offset,Ht.array),Re(zt,w.skinWeights,ue.offset,wt.array)),zt.hasUV===!1&&I.uvsNeedsFix===!0){const Je=(L.array.length-He)/L.stride;for(let ii=0;ii<Je;ii++)Tt.array.push(0,0)}break;case"NORMAL":Re(zt,w[Se],ue.offset,it.array),it.stride=w[Se].stride;break;case"COLOR":Re(zt,w[Se],ue.offset,Vt.array),Vt.stride=w[Se].stride;break;case"TEXCOORD":Re(zt,w[Se],ue.offset,Tt.array),Tt.stride=w[Se].stride;break;case"TEXCOORD1":Re(zt,w[Se],ue.offset,Nt.array),Tt.stride=w[Se].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',Me)}}break;case"NORMAL":Re(zt,w[ue.id],ue.offset,it.array),it.stride=w[ue.id].stride;break;case"COLOR":Re(zt,w[ue.id],ue.offset,Vt.array),Vt.stride=w[ue.id].stride;break;case"TEXCOORD":Re(zt,w[ue.id],ue.offset,Tt.array),Tt.stride=w[ue.id].stride;break;case"TEXCOORD1":Re(zt,w[ue.id],ue.offset,Nt.array),Nt.stride=w[ue.id].stride;break}}}return L.array.length>0&&It.setAttribute("position",new Float32BufferAttribute(L.array,L.stride)),it.array.length>0&&It.setAttribute("normal",new Float32BufferAttribute(it.array,it.stride)),Vt.array.length>0&&It.setAttribute("color",new Float32BufferAttribute(Vt.array,Vt.stride)),Tt.array.length>0&&It.setAttribute("uv",new Float32BufferAttribute(Tt.array,Tt.stride)),Nt.array.length>0&&It.setAttribute("uv2",new Float32BufferAttribute(Nt.array,Nt.stride)),Ht.array.length>0&&It.setAttribute("skinIndex",new Float32BufferAttribute(Ht.array,Ht.stride)),wt.array.length>0&&It.setAttribute("skinWeight",new Float32BufferAttribute(wt.array,wt.stride)),U.data=It,U.type=I[0].type,U.materialKeys=Kt,U}function Re(I,w,k,U){const L=I.p,it=I.stride,Tt=I.vcount;function Nt(wt){let It=L[wt+k]*Ht;const Kt=It+Ht;for(;It<Kt;It++)U.push(Vt[It])}const Vt=w.array,Ht=w.stride;if(I.vcount!==void 0){let wt=0;for(let It=0,Kt=Tt.length;It<Kt;It++){const Ut=Tt[It];if(Ut===4){const qt=wt+it*0,zt=wt+it*1,re=wt+it*2,he=wt+it*3;Nt(qt),Nt(zt),Nt(he),Nt(zt),Nt(re),Nt(he)}else if(Ut===3){const qt=wt+it*0,zt=wt+it*1,re=wt+it*2;Nt(qt),Nt(zt),Nt(re)}else if(Ut>4)for(let qt=1,zt=Ut-2;qt<=zt;qt++){const re=wt+it*0,he=wt+it*qt,pe=wt+it*(qt+1);Nt(re),Nt(he),Nt(pe)}wt+=it*Ut}}else for(let wt=0,It=L.length;wt<It;wt+=it)Nt(wt)}function Xe(I){return v(Gt.geometries[I],Be)}function ti(I){const w={name:I.getAttribute("name")||"",joints:{},links:[]};for(let k=0;k<I.childNodes.length;k++){const U=I.childNodes[k];if(U.nodeType===1)switch(U.nodeName){case"technique_common":H(U,w);break}}Gt.kinematicsModels[I.getAttribute("id")]=w}function ei(I){return I.build!==void 0?I.build:I}function Ue(I){return v(Gt.kinematicsModels[I],ei)}function H(I,w){for(let k=0;k<I.childNodes.length;k++){const U=I.childNodes[k];if(U.nodeType===1)switch(U.nodeName){case"joint":w.joints[U.getAttribute("sid")]=ct(U);break;case"link":w.links.push(ut(U));break}}}function ct(I){let w;for(let k=0;k<I.childNodes.length;k++){const U=I.childNodes[k];if(U.nodeType===1)switch(U.nodeName){case"prismatic":case"revolute":w=st(U);break}}return w}function st(I){const w={sid:I.getAttribute("sid"),name:I.getAttribute("name")||"",axis:new Vector3,limits:{min:0,max:0},type:I.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let k=0;k<I.childNodes.length;k++){const U=I.childNodes[k];if(U.nodeType===1)switch(U.nodeName){case"axis":const L=s(U.textContent);w.axis.fromArray(L);break;case"limits":const it=U.getElementsByTagName("max")[0],Tt=U.getElementsByTagName("min")[0];w.limits.max=parseFloat(it.textContent),w.limits.min=parseFloat(Tt.textContent);break}}return w.limits.min>=w.limits.max&&(w.static=!0),w.middlePosition=(w.limits.min+w.limits.max)/2,w}function ut(I){const w={sid:I.getAttribute("sid"),name:I.getAttribute("name")||"",attachments:[],transforms:[]};for(let k=0;k<I.childNodes.length;k++){const U=I.childNodes[k];if(U.nodeType===1)switch(U.nodeName){case"attachment_full":w.attachments.push(Lt(U));break;case"matrix":case"translate":case"rotate":w.transforms.push(oe(U));break}}return w}function Lt(I){const w={joint:I.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let k=0;k<I.childNodes.length;k++){const U=I.childNodes[k];if(U.nodeType===1)switch(U.nodeName){case"link":w.links.push(ut(U));break;case"matrix":case"translate":case"rotate":w.transforms.push(oe(U));break}}return w}function oe(I){const w={type:I.nodeName},k=s(I.textContent);switch(w.type){case"matrix":w.obj=new Matrix4,w.obj.fromArray(k).transpose();break;case"translate":w.obj=new Vector3,w.obj.fromArray(k);break;case"rotate":w.obj=new Vector3,w.obj.fromArray(k),w.angle=MathUtils.degToRad(k[3]);break}return w}function ee(I){const w={name:I.getAttribute("name")||"",rigidBodies:{}};for(let k=0;k<I.childNodes.length;k++){const U=I.childNodes[k];if(U.nodeType===1)switch(U.nodeName){case"rigid_body":w.rigidBodies[U.getAttribute("name")]={},Yt(U,w.rigidBodies[U.getAttribute("name")]);break}}Gt.physicsModels[I.getAttribute("id")]=w}function Yt(I,w){for(let k=0;k<I.childNodes.length;k++){const U=I.childNodes[k];if(U.nodeType===1)switch(U.nodeName){case"technique_common":ne(U,w);break}}}function ne(I,w){for(let k=0;k<I.childNodes.length;k++){const U=I.childNodes[k];if(U.nodeType===1)switch(U.nodeName){case"inertia":w.inertia=s(U.textContent);break;case"mass":w.mass=s(U.textContent)[0];break}}}function jt(I){const w={bindJointAxis:[]};for(let k=0;k<I.childNodes.length;k++){const U=I.childNodes[k];if(U.nodeType===1)switch(U.nodeName){case"bind_joint_axis":w.bindJointAxis.push(se(U));break}}Gt.kinematicsScenes[o(I.getAttribute("url"))]=w}function se(I){const w={target:I.getAttribute("target").split("/").pop()};for(let k=0;k<I.childNodes.length;k++){const U=I.childNodes[k];if(U.nodeType===1)switch(U.nodeName){case"axis":const L=U.getElementsByTagName("param")[0];w.axis=L.textContent;const it=w.axis.split("inst_").pop().split("axis")[0];w.jointIndex=it.substr(0,it.length-1);break}}return w}function Xt(I){return I.build!==void 0?I.build:I}function ae(I){return v(Gt.kinematicsScenes[I],Xt)}function Ce(){const I=Object.keys(Gt.kinematicsModels)[0],w=Object.keys(Gt.kinematicsScenes)[0],k=Object.keys(Gt.visualScenes)[0];if(I===void 0||w===void 0)return;const U=Ue(I),L=ae(w),it=si(k),Tt=L.bindJointAxis,Nt={};for(let wt=0,It=Tt.length;wt<It;wt++){const Kt=Tt[wt],Ut=ve.querySelector('[sid="'+Kt.target+'"]');if(Ut){const qt=Ut.parentElement;Vt(Kt.jointIndex,qt)}}function Vt(wt,It){const Kt=It.getAttribute("name"),Ut=U.joints[wt];it.traverse(function(qt){qt.name===Kt&&(Nt[wt]={object:qt,transforms:_e(It),joint:Ut,position:Ut.zeroPosition})})}const Ht=new Matrix4;oi={joints:U&&U.joints,getJointValue:function(wt){const It=Nt[wt];if(It)return It.position;console.warn("THREE.ColladaLoader: Joint "+wt+" doesn't exist.")},setJointValue:function(wt,It){const Kt=Nt[wt];if(Kt){const Ut=Kt.joint;if(It>Ut.limits.max||It<Ut.limits.min)console.warn("THREE.ColladaLoader: Joint "+wt+" value "+It+" outside of limits (min: "+Ut.limits.min+", max: "+Ut.limits.max+").");else if(Ut.static)console.warn("THREE.ColladaLoader: Joint "+wt+" is static.");else{const qt=Kt.object,zt=Ut.axis,re=Kt.transforms;Jt.identity();for(let he=0;he<re.length;he++){const pe=re[he];if(pe.sid&&pe.sid.indexOf(wt)!==-1)switch(Ut.type){case"revolute":Jt.multiply(Ht.makeRotationAxis(zt,MathUtils.degToRad(It)));break;case"prismatic":Jt.multiply(Ht.makeTranslation(zt.x*It,zt.y*It,zt.z*It));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+Ut.type);break}else switch(pe.type){case"matrix":Jt.multiply(pe.obj);break;case"translate":Jt.multiply(Ht.makeTranslation(pe.obj.x,pe.obj.y,pe.obj.z));break;case"scale":Jt.scale(pe.obj);break;case"rotate":Jt.multiply(Ht.makeRotationAxis(pe.obj,pe.angle));break}}qt.matrix.copy(Jt),qt.matrix.decompose(qt.position,qt.quaternion,qt.scale),Nt[wt].position=It}}else console.log("THREE.ColladaLoader: "+wt+" does not exist.")}}}function _e(I){const w=[],k=ve.querySelector('[id="'+I.id+'"]');for(let U=0;U<k.childNodes.length;U++){const L=k.childNodes[U];if(L.nodeType!==1)continue;let it,Tt;switch(L.nodeName){case"matrix":it=s(L.textContent);const Nt=new Matrix4().fromArray(it).transpose();w.push({sid:L.getAttribute("sid"),type:L.nodeName,obj:Nt});break;case"translate":case"scale":it=s(L.textContent),Tt=new Vector3().fromArray(it),w.push({sid:L.getAttribute("sid"),type:L.nodeName,obj:Tt});break;case"rotate":it=s(L.textContent),Tt=new Vector3().fromArray(it);const Vt=MathUtils.degToRad(it[3]);w.push({sid:L.getAttribute("sid"),type:L.nodeName,obj:Tt,angle:Vt});break}}return w}function Oe(I){const w=I.getElementsByTagName("node");for(let k=0;k<w.length;k++){const U=w[k];U.hasAttribute("id")===!1&&U.setAttribute("id",h())}}const Jt=new Matrix4,xe=new Vector3;function me(I){const w={name:I.getAttribute("name")||"",type:I.getAttribute("type"),id:I.getAttribute("id"),sid:I.getAttribute("sid"),matrix:new Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let k=0;k<I.childNodes.length;k++){const U=I.childNodes[k];if(U.nodeType!==1)continue;let L;switch(U.nodeName){case"node":w.nodes.push(U.getAttribute("id")),me(U);break;case"instance_camera":w.instanceCameras.push(o(U.getAttribute("url")));break;case"instance_controller":w.instanceControllers.push(Le(U));break;case"instance_light":w.instanceLights.push(o(U.getAttribute("url")));break;case"instance_geometry":w.instanceGeometries.push(Le(U));break;case"instance_node":w.instanceNodes.push(o(U.getAttribute("url")));break;case"matrix":L=s(U.textContent),w.matrix.multiply(Jt.fromArray(L).transpose()),w.transforms[U.getAttribute("sid")]=U.nodeName;break;case"translate":L=s(U.textContent),xe.fromArray(L),w.matrix.multiply(Jt.makeTranslation(xe.x,xe.y,xe.z)),w.transforms[U.getAttribute("sid")]=U.nodeName;break;case"rotate":L=s(U.textContent);const it=MathUtils.degToRad(L[3]);w.matrix.multiply(Jt.makeRotationAxis(xe.fromArray(L),it)),w.transforms[U.getAttribute("sid")]=U.nodeName;break;case"scale":L=s(U.textContent),w.matrix.scale(xe.fromArray(L)),w.transforms[U.getAttribute("sid")]=U.nodeName;break;case"extra":break;default:console.log(U)}}return li(w.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",w.id):Gt.nodes[w.id]=w,w}function Le(I){const w={id:o(I.getAttribute("url")),materials:{},skeletons:[]};for(let k=0;k<I.childNodes.length;k++){const U=I.childNodes[k];switch(U.nodeName){case"bind_material":const L=U.getElementsByTagName("instance_material");for(let it=0;it<L.length;it++){const Tt=L[it],Nt=Tt.getAttribute("symbol"),Vt=Tt.getAttribute("target");w.materials[Nt]=o(Vt)}break;case"skeleton":w.skeletons.push(o(U.textContent));break}}return w}function Ve(I,w){const k=[],U=[];let L,it,Tt;for(L=0;L<I.length;L++){const Ht=I[L];let wt;if(li(Ht))wt=Ge(Ht),Pe(wt,w,k);else if(ye(Ht)){const Kt=Gt.visualScenes[Ht].children;for(let Ut=0;Ut<Kt.length;Ut++){const qt=Kt[Ut];if(qt.type==="JOINT"){const zt=Ge(qt.id);Pe(zt,w,k)}}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",Ht)}for(L=0;L<w.length;L++)for(it=0;it<k.length;it++)if(Tt=k[it],Tt.bone.name===w[L].name){U[L]=Tt,Tt.processed=!0;break}for(L=0;L<k.length;L++)Tt=k[L],Tt.processed===!1&&(U.push(Tt),Tt.processed=!0);const Nt=[],Vt=[];for(L=0;L<U.length;L++)Tt=U[L],Nt.push(Tt.bone),Vt.push(Tt.boneInverse);return new Skeleton(Nt,Vt)}function Pe(I,w,k){I.traverse(function(U){if(U.isBone===!0){let L;for(let it=0;it<w.length;it++){const Tt=w[it];if(Tt.name===U.name){L=Tt.boneInverse;break}}L===void 0&&(L=new Matrix4),k.push({bone:U,boneInverse:L,processed:!1})}})}function di(I){const w=[],k=I.matrix,U=I.nodes,L=I.type,it=I.instanceCameras,Tt=I.instanceControllers,Nt=I.instanceLights,Vt=I.instanceGeometries,Ht=I.instanceNodes;for(let It=0,Kt=U.length;It<Kt;It++)w.push(Ge(U[It]));for(let It=0,Kt=it.length;It<Kt;It++){const Ut=ce(it[It]);Ut!==null&&w.push(Ut.clone())}for(let It=0,Kt=Tt.length;It<Kt;It++){const Ut=Tt[It],qt=yt(Ut.id),zt=Xe(qt.id),re=ai(zt,Ut.materials),he=Ut.skeletons,pe=qt.skin.joints,ue=Ve(he,pe);for(let Me=0,Se=re.length;Me<Se;Me++){const He=re[Me];He.isSkinnedMesh&&(He.bind(ue,qt.skin.bindMatrix),He.normalizeSkinWeights()),w.push(He)}}for(let It=0,Kt=Nt.length;It<Kt;It++){const Ut=we(Nt[It]);Ut!==null&&w.push(Ut.clone())}for(let It=0,Kt=Vt.length;It<Kt;It++){const Ut=Vt[It],qt=Xe(Ut.id),zt=ai(qt,Ut.materials);for(let re=0,he=zt.length;re<he;re++)w.push(zt[re])}for(let It=0,Kt=Ht.length;It<Kt;It++)w.push(Ge(Ht[It]).clone());let wt;if(U.length===0&&w.length===1)wt=w[0];else{wt=L==="JOINT"?new Bone:new Group$1;for(let It=0;It<w.length;It++)wt.add(w[It])}return wt.name=L==="JOINT"?I.sid:I.name,wt.matrix.copy(k),wt.matrix.decompose(wt.position,wt.quaternion,wt.scale),wt}const fi=new MeshBasicMaterial({color:16711935});function gi(I,w){const k=[];for(let U=0,L=I.length;U<L;U++){const it=w[I[U]];it===void 0?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",I[U]),k.push(fi)):k.push(q(it))}return k}function ai(I,w){const k=[];for(const U in I){const L=I[U],it=gi(L.materialKeys,w);it.length===0&&(U==="lines"||U==="linestrips"?it.push(new LineBasicMaterial):it.push(new MeshPhongMaterial));const Tt=L.data.attributes.skinIndex!==void 0,Nt=it.length===1?it[0]:it;let Vt;switch(U){case"lines":Vt=new LineSegments(L.data,Nt);break;case"linestrips":Vt=new Line(L.data,Nt);break;case"triangles":case"polylist":Tt?Vt=new SkinnedMesh(L.data,Nt):Vt=new Mesh(L.data,Nt);break}k.push(Vt)}return k}function li(I){return Gt.nodes[I]!==void 0}function Ge(I){return v(Gt.nodes[I],di)}function _i(I){const w={name:I.getAttribute("name"),children:[]};Oe(I);const k=e(I,"node");for(let U=0;U<k.length;U++)w.children.push(me(k[U]));Gt.visualScenes[I.getAttribute("id")]=w}function De(I){const w=new Group$1;w.name=I.name;const k=I.children;for(let U=0;U<k.length;U++){const L=k[U];w.add(Ge(L.id))}return w}function ye(I){return Gt.visualScenes[I]!==void 0}function si(I){return v(Gt.visualScenes[I],De)}function je(I){const w=e(I,"instance_visual_scene")[0];return si(o(w.getAttribute("url")))}function mi(){const I=Gt.clips;if(u(I)===!0){if(u(Gt.animations)===!1){const w=[];for(const k in Gt.animations){const U=C(k);for(let L=0,it=U.length;L<it;L++)w.push(U[L])}Ke.push(new AnimationClip("default",-1,w))}}else for(const w in I)Ke.push(et(w))}function ci(I){let w="";const k=[I];for(;k.length;){const U=k.shift();U.nodeType===Node.TEXT_NODE?w+=U.textContent:(w+=`
`,k.push.apply(k,U.childNodes))}return w.trim()}if(n.length===0)return{scene:new Scene};const hi=new DOMParser().parseFromString(n,"application/xml"),ve=e(hi,"COLLADA")[0],ke=hi.getElementsByTagName("parsererror")[0];if(ke!==void 0){const I=e(ke,"div")[0];let w;return I?w=I.textContent:w=ci(ke),console.error(`THREE.ColladaLoader: Failed to parse collada file.
`,w),null}const ui=ve.getAttribute("version");console.log("THREE.ColladaLoader: File version",ui);const ri=p(e(ve,"asset")[0]),le=new TextureLoader(this.manager);le.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);let Ye;TGALoader&&(Ye=new TGALoader(this.manager),Ye.setPath(this.resourcePath||t));const Ke=[];let oi={},be=0;const Gt={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};g(ve,"library_animations","animation",y),g(ve,"library_animation_clips","animation_clip",M),g(ve,"library_controllers","controller",Q),g(ve,"library_images","image",Z),g(ve,"library_effects","effect",nt),g(ve,"library_materials","material",Y),g(ve,"library_cameras","camera",xt),g(ve,"library_lights","light",Ee),g(ve,"library_geometries","geometry",$e),g(ve,"library_nodes","node",me),g(ve,"library_visual_scenes","visual_scene",_i),g(ve,"library_kinematics_models","kinematics_model",ti),g(ve,"library_physics_models","physics_model",ee),g(ve,"scene","instance_kinematics_scene",jt),_(Gt.animations,x),_(Gt.clips,J),_(Gt.controllers,ft),_(Gt.images,bt),_(Gt.effects,kt),_(Gt.materials,Mt),_(Gt.cameras,te),_(Gt.lights,Te),_(Gt.geometries,Be),_(Gt.visualScenes,De),mi(),Ce();const Qt=je(e(ve,"scene")[0]);return Qt.animations=Ke,ri.upAxis==="Z_UP"&&Qt.quaternion.setFromEuler(new Euler(-Math.PI/2,0,0)),Qt.scale.multiplyScalar(ri.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),Ke},kinematics:oi,library:Gt,scene:Qt}}}class URDFBase extends Object3D{constructor(...n){super(...n),this.urdfNode=null,this.urdfName=""}copy(n,t){return super.copy(n,t),this.urdfNode=n.urdfNode,this.urdfName=n.urdfName,this}}class URDFCollider extends URDFBase{constructor(...n){super(...n),this.isURDFCollider=!0,this.type="URDFCollider"}}class URDFVisual extends URDFBase{constructor(...n){super(...n),this.isURDFVisual=!0,this.type="URDFVisual"}}class URDFLink extends URDFBase{constructor(...n){super(...n),this.isURDFLink=!0,this.type="URDFLink"}}class URDFJoint extends URDFBase{get jointType(){return this._jointType}set jointType(n){if(this.jointType!==n)switch(this._jointType=n,this.matrixWorldNeedsUpdate=!0,n){case"fixed":this.jointValue=[];break;case"continuous":case"revolute":case"prismatic":this.jointValue=new Array(1).fill(0);break;case"planar":this.jointValue=new Array(2).fill(0);break;case"floating":this.jointValue=new Array(6).fill(0);break}}get angle(){return this.jointValue[0]}constructor(...n){super(...n),this.isURDFJoint=!0,this.type="URDFJoint",this.jointValue=null,this.jointType="fixed",this.axis=null,this.limit={lower:0,upper:0},this.ignoreLimits=!1,this.origPosition=null,this.origQuaternion=null,this.mimicJoints=[]}copy(n,t){return super.copy(n,t),this.jointType=n.jointType,this.axis=n.axis?n.axis.clone():null,this.limit.lower=n.limit.lower,this.limit.upper=n.limit.upper,this.ignoreLimits=!1,this.jointValue=[...n.jointValue],this.origPosition=n.origPosition?n.origPosition.clone():null,this.origQuaternion=n.origQuaternion?n.origQuaternion.clone():null,this.mimicJoints=[...n.mimicJoints],this}setJointValue(...n){n=n.map(e=>parseFloat(e)),(!this.origPosition||!this.origQuaternion)&&(this.origPosition=this.position.clone(),this.origQuaternion=this.quaternion.clone());let t=!1;switch(this.mimicJoints.forEach(e=>{t=e.updateFromMimickedJoint(...n)||t}),this.jointType){case"fixed":return t;case"continuous":case"revolute":{let e=n[0];return e==null||e===this.jointValue[0]?t:(!this.ignoreLimits&&this.jointType==="revolute"&&(e=Math.min(this.limit.upper,e),e=Math.max(this.limit.lower,e)),this.quaternion.setFromAxisAngle(this.axis,e).premultiply(this.origQuaternion),this.jointValue[0]!==e?(this.jointValue[0]=e,this.matrixWorldNeedsUpdate=!0,!0):t)}case"prismatic":{let e=n[0];return e==null||e===this.jointValue[0]?t:(this.ignoreLimits||(e=Math.min(this.limit.upper,e),e=Math.max(this.limit.lower,e)),this.position.copy(this.origPosition),this.position.addScaledVector(this.axis,e),this.jointValue[0]!==e?(this.jointValue[0]=e,this.matrixWorldNeedsUpdate=!0,!0):t)}case"floating":case"planar":console.warn(`'${this.jointType}' joint not yet supported`)}return t}}class URDFMimicJoint extends URDFJoint{constructor(...n){super(...n),this.type="URDFMimicJoint",this.mimicJoint=null,this.offset=0,this.multiplier=1}updateFromMimickedJoint(...n){const t=n.map(e=>e*this.multiplier+this.offset);return super.setJointValue(...t)}setJointValue(...n){return console.warn(`URDFMimicJoint: Setting the joint value of mimic joint "${this.urdfName}" will cause it to be out of sync.`),super.setJointValue(...n)}copy(n,t){return super.copy(n,t),this.mimicJoint=n.mimicJoint,this.offset=n.offset,this.multiplier=n.multiplier,this}}class URDFRobot extends URDFLink{constructor(...n){super(...n),this.isURDFRobot=!0,this.urdfNode=null,this.urdfRobotNode=null,this.robotName=null,this.links=null,this.joints=null,this.colliders=null,this.visual=null,this.frames=null}copy(n,t){return super.copy(n,t),this.urdfRobotNode=n.urdfRobotNode,this.robotName=n.robotName,this.links={},this.joints={},this.colliders={},this.visual={},this.traverse(e=>{e.isURDFJoint&&e.urdfName in n.joints&&(this.joints[e.urdfName]=e),e.isURDFLink&&e.urdfName in n.links&&(this.links[e.urdfName]=e),e.isURDFCollider&&e.urdfName in n.colliders&&(this.colliders[e.urdfName]=e),e.isURDFVisual&&e.urdfName in n.visual&&(this.visual[e.urdfName]=e)}),this.frames={...this.colliders,...this.visual,...this.links,...this.joints},this}getFrame(n){return this.frames[n]}setJointValue(n,...t){const e=this.joints[n];return e?e.setJointValue(...t):!1}setJointValues(n){let t=!1;for(const e in n){const i=n[e];Array.isArray(i)?t=this.setJointValue(e,...i)||t:t=this.setJointValue(e,i)||t}return t}}const tempQuaternion=new Quaternion$1,tempEuler=new Euler;function processTuple(l){return l?l.trim().split(/\s+/g).map(n=>parseFloat(n)):[0,0,0]}function applyRotation(l,n,t=!1){t||l.rotation.set(0,0,0),tempEuler.set(n[0],n[1],n[2],"ZYX"),tempQuaternion.setFromEuler(tempEuler),tempQuaternion.multiply(l.quaternion),l.quaternion.copy(tempQuaternion)}class URDFLoader{constructor(n){this.manager=n||DefaultLoadingManager,this.loadMeshCb=this.defaultMeshLoader.bind(this),this.parseVisual=!0,this.parseCollision=!1,this.packages="",this.workingPath="",this.fetchOptions={}}loadAsync(n){return new Promise((t,e)=>{this.load(n,t,null,e)})}load(n,t,e,i){const s=this.manager,r=LoaderUtils.extractUrlBase(n),o=this.manager.resolveURL(n);s.itemStart(o),fetch(o,this.fetchOptions).then(h=>{if(h.ok)return e&&e(null),h.text();throw new Error(`URDFLoader: Failed to load url '${o}' with error code ${h.status} : ${h.statusText}.`)}).then(h=>{this.workingPath===""&&(this.workingPath=r);const u=this.parse(h);t(u),s.itemEnd(o)}).catch(h=>{i?i(h):console.error("URDFLoader: Error loading file.",h),s.itemError(o),s.itemEnd(o)})}parse(n){const t=this.packages,e=this.loadMeshCb,i=this.parseVisual,s=this.parseCollision,r=this.workingPath,o=this.manager,h={},u={},p={};function d(m){if(!/^package:\/\//.test(m))return r?r+m:m;const[x,C]=m.replace(/^package:\/\//,"").split(/\/(.+)/);if(typeof t=="string")return t.endsWith(x)?t+"/"+C:t+"/"+x+"/"+C;if(t instanceof Function)return t(x)+"/"+C;if(typeof t=="object")return x in t?t[x]+"/"+C:(console.error(`URDFLoader : ${x} not found in provided package list.`),null)}function f(m){let x;m instanceof Document?x=[...m.children]:m instanceof Element?x=[m]:x=[...new DOMParser().parseFromString(m,"text/xml").children];const C=x.filter(O=>O.nodeName==="robot").pop();return g(C)}function g(m){const x=[...m.children],C=x.filter(B=>B.nodeName.toLowerCase()==="link"),O=x.filter(B=>B.nodeName.toLowerCase()==="joint"),S=x.filter(B=>B.nodeName.toLowerCase()==="material"),P=new URDFRobot;P.robotName=m.getAttribute("name"),P.urdfRobotNode=m,S.forEach(B=>{const W=B.getAttribute("name");p[W]=y(B)});const F={},V={};C.forEach(B=>{const W=B.getAttribute("name"),A=m.querySelector(`child[link="${W}"]`)===null;h[W]=v(B,F,V,A?P:null)}),O.forEach(B=>{const W=B.getAttribute("name");u[W]=_(B)}),P.joints=u,P.links=h,P.colliders=V,P.visual=F;const N=Object.values(u);return N.forEach(B=>{B instanceof URDFMimicJoint&&u[B.mimicJoint].mimicJoints.push(B)}),N.forEach(B=>{const W=new Set,A=G=>{if(W.has(G))throw new Error("URDFLoader: Detected an infinite loop of mimic joints.");W.add(G),G.mimicJoints.forEach(D=>{A(D)})};A(B)}),P.frames={...V,...F,...h,...u},P}function _(m){const x=[...m.children],C=m.getAttribute("type");let O;const S=x.find(W=>W.nodeName.toLowerCase()==="mimic");S?(O=new URDFMimicJoint,O.mimicJoint=S.getAttribute("joint"),O.multiplier=parseFloat(S.getAttribute("multiplier")||1),O.offset=parseFloat(S.getAttribute("offset")||0)):O=new URDFJoint,O.urdfNode=m,O.name=m.getAttribute("name"),O.urdfName=O.name,O.jointType=C;let P=null,F=null,V=[0,0,0],N=[0,0,0];x.forEach(W=>{const A=W.nodeName.toLowerCase();A==="origin"?(V=processTuple(W.getAttribute("xyz")),N=processTuple(W.getAttribute("rpy"))):A==="child"?F=h[W.getAttribute("link")]:A==="parent"?P=h[W.getAttribute("link")]:A==="limit"&&(O.limit.lower=parseFloat(W.getAttribute("lower")||O.limit.lower),O.limit.upper=parseFloat(W.getAttribute("upper")||O.limit.upper))}),P.add(O),O.add(F),applyRotation(O,N),O.position.set(V[0],V[1],V[2]);const B=x.filter(W=>W.nodeName.toLowerCase()==="axis")[0];if(B){const W=B.getAttribute("xyz").split(/\s+/g).map(A=>parseFloat(A));O.axis=new Vector3(W[0],W[1],W[2]),O.axis.normalize()}return O}function v(m,x,C,O=null){O===null&&(O=new URDFLink);const S=[...m.children];return O.name=m.getAttribute("name"),O.urdfName=O.name,O.urdfNode=m,i&&S.filter(F=>F.nodeName.toLowerCase()==="visual").forEach(F=>{const V=E(F,p);if(O.add(V),F.hasAttribute("name")){const N=F.getAttribute("name");V.name=N,V.urdfName=N,x[N]=V}}),s&&S.filter(F=>F.nodeName.toLowerCase()==="collision").forEach(F=>{const V=E(F);if(O.add(V),F.hasAttribute("name")){const N=F.getAttribute("name");V.name=N,V.urdfName=N,C[N]=V}}),O}function y(m){const x=[...m.children],C=new MeshPhongMaterial;return C.name=m.getAttribute("name")||"",x.forEach(O=>{const S=O.nodeName.toLowerCase();if(S==="color"){const P=O.getAttribute("rgba").split(/\s/g).map(F=>parseFloat(F));C.color.setRGB(P[0],P[1],P[2]),C.opacity=P[3],C.transparent=P[3]<1,C.depthWrite=!C.transparent}else if(S==="texture"){const P=O.getAttribute("filename");if(P){const F=new TextureLoader(o),V=d(P);C.map=F.load(V)}}}),C}function E(m,x={}){const C=m.nodeName.toLowerCase()==="collision",O=[...m.children];let S=null;const P=O.filter(V=>V.nodeName.toLowerCase()==="material")[0];if(P){const V=P.getAttribute("name");V&&V in x?S=x[V]:S=y(P)}else S=new MeshPhongMaterial;const F=C?new URDFCollider:new URDFVisual;return F.urdfNode=m,O.forEach(V=>{const N=V.nodeName.toLowerCase();if(N==="geometry"){const B=V.children[0].nodeName.toLowerCase();if(B==="mesh"){const W=V.children[0].getAttribute("filename"),A=d(W);if(A!==null){const G=V.children[0].getAttribute("scale");if(G){const D=processTuple(G);F.scale.set(D[0],D[1],D[2])}e(A,o,(D,M)=>{M?console.error("URDFLoader: Error loading mesh.",M):D&&(D instanceof Mesh&&(D.material=S),D.position.set(0,0,0),D.quaternion.identity(),F.add(D))})}}else if(B==="box"){const W=new Mesh;W.geometry=new BoxGeometry(1,1,1),W.material=S;const A=processTuple(V.children[0].getAttribute("size"));W.scale.set(A[0],A[1],A[2]),F.add(W)}else if(B==="sphere"){const W=new Mesh;W.geometry=new SphereGeometry(1,30,30),W.material=S;const A=parseFloat(V.children[0].getAttribute("radius"))||0;W.scale.set(A,A,A),F.add(W)}else if(B==="cylinder"){const W=new Mesh;W.geometry=new CylinderGeometry(1,1,1,30),W.material=S;const A=parseFloat(V.children[0].getAttribute("radius"))||0,G=parseFloat(V.children[0].getAttribute("length"))||0;W.scale.set(A,G,A),W.rotation.set(Math.PI/2,0,0),F.add(W)}}else if(N==="origin"){const B=processTuple(V.getAttribute("xyz")),W=processTuple(V.getAttribute("rpy"));F.position.set(B[0],B[1],B[2]),F.rotation.set(0,0,0),applyRotation(F,W)}}),F}return f(n)}defaultMeshLoader(n,t,e){/\.stl$/i.test(n)?new STLLoader(t).load(n,s=>{const r=new Mesh(s,new MeshPhongMaterial);e(r)}):/\.dae$/i.test(n)?new ColladaLoader(t).load(n,s=>e(s.scene)):console.warn(`URDFLoader: Could not load model at ${n}.
No loader available`)}}class CCDIK{constructor(n,t){}solve(n,t,e,{maxIterations:i=1,stopDistance:s=.1,jointLimits:r={},apply:o=!1}={}){let h=[];if(e.length)for(let _ of t.arm.movable)e.includes(_.name)&&h.push(_);else h=t.arm.movable;const u={},p={};let d=new Vector3,f=new Vector3,g=new Vector3;for(const _ of h)u[_.name]=_.angle;n.getWorldPosition(d);for(let _=0;_<i;_++){for(let v=h.length-1;v>=0;v--){const y=h[v];t.tcp.object.getWorldPosition(f);let E=y.worldToLocal(f.clone()).normalize(),m=y.worldToLocal(d.clone()).normalize();E=E.projectOnPlane(y.axis),m=m.projectOnPlane(y.axis),g.crossVectors(E,m).normalize();let x=g.dot(y.axis),C=Math.sign(x)*E.angleTo(m),O=y.angle+C;const S=r[y.name];S&&("lower"in S&&O<S.lower&&(O=Math.max(S.lower,O)),"upper"in S&&O>S.upper&&(O=Math.min(S.upper,O))),y.setJointValue(O),p[y.name]=y.angle}if(t.tcp.object.getWorldPosition(f),d.distanceTo(f)<s)break}if(!o)for(const _ of h)_.setJointValue(u[_.name]);return p}}var Easing={Linear:{None:function(l){return l}},Quadratic:{In:function(l){return l*l},Out:function(l){return l*(2-l)},InOut:function(l){return(l*=2)<1?.5*l*l:-.5*(--l*(l-2)-1)}},Cubic:{In:function(l){return l*l*l},Out:function(l){return--l*l*l+1},InOut:function(l){return(l*=2)<1?.5*l*l*l:.5*((l-=2)*l*l+2)}},Quartic:{In:function(l){return l*l*l*l},Out:function(l){return 1- --l*l*l*l},InOut:function(l){return(l*=2)<1?.5*l*l*l*l:-.5*((l-=2)*l*l*l-2)}},Quintic:{In:function(l){return l*l*l*l*l},Out:function(l){return--l*l*l*l*l+1},InOut:function(l){return(l*=2)<1?.5*l*l*l*l*l:.5*((l-=2)*l*l*l*l+2)}},Sinusoidal:{In:function(l){return 1-Math.cos(l*Math.PI/2)},Out:function(l){return Math.sin(l*Math.PI/2)},InOut:function(l){return .5*(1-Math.cos(Math.PI*l))}},Exponential:{In:function(l){return l===0?0:Math.pow(1024,l-1)},Out:function(l){return l===1?1:1-Math.pow(2,-10*l)},InOut:function(l){return l===0?0:l===1?1:(l*=2)<1?.5*Math.pow(1024,l-1):.5*(-Math.pow(2,-10*(l-1))+2)}},Circular:{In:function(l){return 1-Math.sqrt(1-l*l)},Out:function(l){return Math.sqrt(1- --l*l)},InOut:function(l){return(l*=2)<1?-.5*(Math.sqrt(1-l*l)-1):.5*(Math.sqrt(1-(l-=2)*l)+1)}},Elastic:{In:function(l){return l===0?0:l===1?1:-Math.pow(2,10*(l-1))*Math.sin((l-1.1)*5*Math.PI)},Out:function(l){return l===0?0:l===1?1:Math.pow(2,-10*l)*Math.sin((l-.1)*5*Math.PI)+1},InOut:function(l){return l===0?0:l===1?1:(l*=2,l<1?-.5*Math.pow(2,10*(l-1))*Math.sin((l-1.1)*5*Math.PI):.5*Math.pow(2,-10*(l-1))*Math.sin((l-1.1)*5*Math.PI)+1)}},Back:{In:function(l){var n=1.70158;return l*l*((n+1)*l-n)},Out:function(l){var n=1.70158;return--l*l*((n+1)*l+n)+1},InOut:function(l){var n=2.5949095;return(l*=2)<1?.5*(l*l*((n+1)*l-n)):.5*((l-=2)*l*((n+1)*l+n)+2)}},Bounce:{In:function(l){return 1-Easing.Bounce.Out(1-l)},Out:function(l){return l<1/2.75?7.5625*l*l:l<2/2.75?7.5625*(l-=1.5/2.75)*l+.75:l<2.5/2.75?7.5625*(l-=2.25/2.75)*l+.9375:7.5625*(l-=2.625/2.75)*l+.984375},InOut:function(l){return l<.5?Easing.Bounce.In(l*2)*.5:Easing.Bounce.Out(l*2-1)*.5+.5}}},now;typeof self>"u"&&typeof process<"u"&&process.hrtime?now=function(){var l=process.hrtime();return l[0]*1e3+l[1]/1e6}:typeof self<"u"&&self.performance!==void 0&&self.performance.now!==void 0?now=self.performance.now.bind(self.performance):Date.now!==void 0?now=Date.now:now=function(){return new Date().getTime()};var now$1=now,Group=function(){function l(){this._tweens={},this._tweensAddedDuringUpdate={}}return l.prototype.getAll=function(){var n=this;return Object.keys(this._tweens).map(function(t){return n._tweens[t]})},l.prototype.removeAll=function(){this._tweens={}},l.prototype.add=function(n){this._tweens[n.getId()]=n,this._tweensAddedDuringUpdate[n.getId()]=n},l.prototype.remove=function(n){delete this._tweens[n.getId()],delete this._tweensAddedDuringUpdate[n.getId()]},l.prototype.update=function(n,t){n===void 0&&(n=now$1()),t===void 0&&(t=!1);var e=Object.keys(this._tweens);if(e.length===0)return!1;for(;e.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<e.length;i++){var s=this._tweens[e[i]],r=!t;s&&s.update(n,r)===!1&&!t&&delete this._tweens[e[i]]}e=Object.keys(this._tweensAddedDuringUpdate)}return!0},l}(),Interpolation={Linear:function(l,n){var t=l.length-1,e=t*n,i=Math.floor(e),s=Interpolation.Utils.Linear;return n<0?s(l[0],l[1],e):n>1?s(l[t],l[t-1],t-e):s(l[i],l[i+1>t?t:i+1],e-i)},Bezier:function(l,n){for(var t=0,e=l.length-1,i=Math.pow,s=Interpolation.Utils.Bernstein,r=0;r<=e;r++)t+=i(1-n,e-r)*i(n,r)*l[r]*s(e,r);return t},CatmullRom:function(l,n){var t=l.length-1,e=t*n,i=Math.floor(e),s=Interpolation.Utils.CatmullRom;return l[0]===l[t]?(n<0&&(i=Math.floor(e=t*(1+n))),s(l[(i-1+t)%t],l[i],l[(i+1)%t],l[(i+2)%t],e-i)):n<0?l[0]-(s(l[0],l[0],l[1],l[1],-e)-l[0]):n>1?l[t]-(s(l[t],l[t],l[t-1],l[t-1],e-t)-l[t]):s(l[i?i-1:0],l[i],l[t<i+1?t:i+1],l[t<i+2?t:i+2],e-i)},Utils:{Linear:function(l,n,t){return(n-l)*t+l},Bernstein:function(l,n){var t=Interpolation.Utils.Factorial;return t(l)/t(n)/t(l-n)},Factorial:function(){var l=[1];return function(n){var t=1;if(l[n])return l[n];for(var e=n;e>1;e--)t*=e;return l[n]=t,t}}(),CatmullRom:function(l,n,t,e,i){var s=(t-l)*.5,r=(e-n)*.5,o=i*i,h=i*o;return(2*n-2*t+s+r)*h+(-3*n+3*t-2*s-r)*o+s*i+n}}},Sequence=function(){function l(){}return l.nextId=function(){return l._nextId++},l._nextId=0,l}(),mainGroup=new Group,Tween=function(){function l(n,t){t===void 0&&(t=mainGroup),this._object=n,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=Easing.Linear.None,this._interpolationFunction=Interpolation.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=Sequence.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return l.prototype.getId=function(){return this._id},l.prototype.isPlaying=function(){return this._isPlaying},l.prototype.isPaused=function(){return this._isPaused},l.prototype.to=function(n,t){return this._valuesEnd=Object.create(n),t!==void 0&&(this._duration=t),this},l.prototype.duration=function(n){return this._duration=n,this},l.prototype.start=function(n){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var t in this._valuesStartRepeat)this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t]}return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=n!==void 0?typeof n=="string"?now$1()+parseFloat(n):n:now$1(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},l.prototype._setupProperties=function(n,t,e,i){for(var s in e){var r=n[s],o=Array.isArray(r),h=o?"array":typeof r,u=!o&&Array.isArray(e[s]);if(!(h==="undefined"||h==="function")){if(u){var p=e[s];if(p.length===0)continue;p=p.map(this._handleRelativeValue.bind(this,r)),e[s]=[r].concat(p)}if((h==="object"||o)&&r&&!u){t[s]=o?[]:{};for(var d in r)t[s][d]=r[d];i[s]=o?[]:{},this._setupProperties(r,t[s],e[s],i[s])}else typeof t[s]>"u"&&(t[s]=r),o||(t[s]*=1),u?i[s]=e[s].slice().reverse():i[s]=t[s]||0}}},l.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},l.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},l.prototype.pause=function(n){return n===void 0&&(n=now$1()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=n,this._group&&this._group.remove(this),this)},l.prototype.resume=function(n){return n===void 0&&(n=now$1()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=n-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},l.prototype.stopChainedTweens=function(){for(var n=0,t=this._chainedTweens.length;n<t;n++)this._chainedTweens[n].stop();return this},l.prototype.group=function(n){return this._group=n,this},l.prototype.delay=function(n){return this._delayTime=n,this},l.prototype.repeat=function(n){return this._initialRepeat=n,this._repeat=n,this},l.prototype.repeatDelay=function(n){return this._repeatDelayTime=n,this},l.prototype.yoyo=function(n){return this._yoyo=n,this},l.prototype.easing=function(n){return this._easingFunction=n,this},l.prototype.interpolation=function(n){return this._interpolationFunction=n,this},l.prototype.chain=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return this._chainedTweens=n,this},l.prototype.onStart=function(n){return this._onStartCallback=n,this},l.prototype.onUpdate=function(n){return this._onUpdateCallback=n,this},l.prototype.onRepeat=function(n){return this._onRepeatCallback=n,this},l.prototype.onComplete=function(n){return this._onCompleteCallback=n,this},l.prototype.onStop=function(n){return this._onStopCallback=n,this},l.prototype.update=function(n,t){if(n===void 0&&(n=now$1()),t===void 0&&(t=!0),this._isPaused)return!0;var e,i,s=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(n>s)return!1;t&&this.start(n)}if(this._goToEnd=!1,n<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(n-this._startTime)/this._duration,i=this._duration===0||i>1?1:i;var r=this._easingFunction(i);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,r),this._onUpdateCallback&&this._onUpdateCallback(this._object,i),i===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(e in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[e]=="string"&&(this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(this._valuesEnd[e])),this._yoyo&&this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e];return this._yoyo&&(this._reversed=!this._reversed),this._repeatDelayTime!==void 0?this._startTime=n+this._repeatDelayTime:this._startTime=n+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var o=0,h=this._chainedTweens.length;o<h;o++)this._chainedTweens[o].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},l.prototype._updateProperties=function(n,t,e,i){for(var s in e)if(t[s]!==void 0){var r=t[s]||0,o=e[s],h=Array.isArray(n[s]),u=Array.isArray(o),p=!h&&u;p?n[s]=this._interpolationFunction(o,i):typeof o=="object"&&o?this._updateProperties(n[s],r,o,i):(o=this._handleRelativeValue(r,o),typeof o=="number"&&(n[s]=r+(o-r)*i))}},l.prototype._handleRelativeValue=function(n,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?n+parseFloat(t):parseFloat(t)},l.prototype._swapEndStartRepeatValues=function(n){var t=this._valuesStartRepeat[n],e=this._valuesEnd[n];typeof e=="string"?this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(e):this._valuesStartRepeat[n]=this._valuesEnd[n],this._valuesEnd[n]=t},l}(),VERSION="18.6.4",nextId=Sequence.nextId,TWEEN=mainGroup,getAll=TWEEN.getAll.bind(TWEEN),removeAll=TWEEN.removeAll.bind(TWEEN),add=TWEEN.add.bind(TWEEN),remove=TWEEN.remove.bind(TWEEN),update=TWEEN.update.bind(TWEEN),exports={Easing,Group,Interpolation,now:now$1,Sequence,nextId,Tween,VERSION,getAll,removeAll,add,remove,update};const _slowdown_factor=1.5;function deg2rad(l){return l*Math.PI/180}function clampJointAngle(l,n){let t=l.limit.lower,e=l.limit.upper;return Math.min(e,Math.max(t,n))}function getDuration(l,n,t){let e=0;for(const i in n)e=Math.max(e,Math.abs(l.joints[i].angle-n[i]));return e/t*1e3*_slowdown_factor}class TheSimulation{constructor(n,t,e){this.robot=n,this.ik=t,this.renderCallback=e,this.lockedJointIndices=[],this.running=!1,this.velocities={},this.setDefaultVelocities(),this.runningPhysics=!1,this.physicsDone=!0,this.lastSimObjectProcessed=!1}reset(){this.unlockJoints(),this.setDefaultVelocities(),this.physicsDone=!0,this.lastSimObjectProcessed=!1,this.runningPhysics=!1}resetSimObjects(n=!0){const t=getSimObjects();for(const e of t)e.attached&&e.detachFromGripper(this.robot),e.reset(),n?e.makeVisible():e.hide()}async run(n,...t){const e=this,i={cancel:e.cancel,setParam:e.setParam,lockJoint:e.lockJoint,unlockJoint:e.unlockJoint,wait:e.wait,move:e.move,gripper_close:e.gripper_close,gripper_open:e.gripper_open,joint_absolute:e.joint_absolute,joint_relative:e.joint_relative,startPhysicalBody:e.startPhysicalBody,getPhysicsDone:e.getPhysicsDone};try{await i[n].call(this,...t)}catch(s){throw console.error("Failed to run command '"+n+"("+t+")':"+s),s}}cancel(){console.log("cancel"),this.running=!1;for(const n of exports.getAll())n.stop();exports.removeAll(),this.runningPhysics=!1,this.physicsDone=!0,this.lastSimObjectProcessed=!0}setParam(n,t){console.log("> Setting "+n+" to "+t);try{if(n.startsWith("velocity")){let e=n.split("/")[1];switch(t=parseFloat(t),e){case"move":this.velocities.move=t;break;case"gripper":this.velocities.gripper=t;break;default:throw"invalid parameter '"+n+"="+t+"'"}}else throw"unknown parameter"}catch(e){console.warn("! Failed to set "+n+": "+e)}}setDefaultVelocities(){console.log("> Resetting velocities to defaults"),this.velocities={move:.5,gripper:.5}}lockJoint(n){if(console.log("> Locking joint "+n),this.lockedJointIndices.includes(n)){console.warn("! ... but joint "+n+" is already locked");return}this.lockedJointIndices.push(n)}unlockJoint(n){console.log("> Unlocking joint "+n);let t=this.lockedJointIndices.indexOf(n);if(t<0){console.warn("! ... but joint "+n+" is not locked");return}this.lockedJointIndices.splice(t,1)}unlockJoints(){console.log("> Unlocking all joints"),this.lockedJointIndices=[]}getJointSpacePose(){const n=this.robot,t=[];for(let e=0;e<n.arm.movable.length;e++){const i=n.arm.movable[e];t.push(i.angle)}return t}getTaskSpacePose(){const n=[],t=this.robot.tcp.object.matrixWorld,e=new Vector3;e.setFromMatrixPosition(t);const i=new Euler;return i.setFromRotationMatrix(t),n.push(e.x,e.y,e.z,i.x,i.y,i.z),n}wait(n){return console.log("> Waiting "+n+" ms"),new Promise(t=>{setTimeout(()=>t("success"),n)})}move(n,t){if(!t)throw new Error("move failed: missing pose");if(t.class==="Array"&&t.length===void 0){let h=[];for(const u in t.properties)u.match(/\d+/g)&&(h[u]=t.properties[u]);t=h}const e=this.robot,i={},s={};switch(n){case"TaskspacePose":console.log("> Moving robot to task space pose "+t);const h=new Object3D;h.position.set(t[0],t[1],t[2]),t.length>3?h.setRotationFromEuler(new Euler(t[3],t[4],t[5])):h.setRotationFromQuaternion(e.tcp.object.quaternion);const u=this.ik.solve(h,e,e.ikEnabled,{maxIterations:30,stopDistance:.05,jointLimits:e.interactionJointLimits,apply:!1});for(let p=0;p<t.length;p++){const d=e.arm.movable[p];d.name in u&&(i[d.name]=d.angle,s[d.name]=u[d.name])}break;case"JointspacePose":console.log("> Moving robot to joint space pose "+t);for(let p=0;p<t.length;p++){const d=e.arm.movable[p];i[d.name]=d.angle,s[d.name]=clampJointAngle(d,deg2rad(t[p]))}break;default:console.error("# unknown configuration space '"+n+"'");return}const r=getDuration(e,s,this.velocities.move*e.maxSpeed.move);return this._makeTween(i,s,r)}gripper_close(){console.log("> Closing hand");const n=this.robot,t={},e={},i=n.tcp.object;let s=new Vector3;if(i.getWorldPosition(s),isAttached())throw console.log("... but an object is already held"),new Error("already gripping");const r=getSimObjectByPos(s);if(r!=null&&r.isGrippable())if(!n.useAdvancedGripping||r.isGrippableAxisIndependent()||r.checkGripperOrientation(n)){r.attachToGripper(n);for(const u of n.hand.movable)t[u.name]=u.angle,e[u.name]=u.states.closed}else throw console.log("... but object does not fit inside gripper (realistic gripping is on)"),new Error("ungrippable");else for(const u of n.hand.movable)t[u.name]=u.angle,e[u.name]=u.states.closed;const o=getDuration(n,e,this.velocities.gripper);return this._makeTween(t,e,o)}gripper_open(){console.log("> Opening hand");const n=this.robot,t={},e={};if(isAttached()==!0){const r=getAttachedObject();r.detachFromGripper(n);const o=getSimObjectIdx(r.name);this.runningPhysics||this.startPhysicalBody(o)}for(const r of n.hand.movable)t[r.name]=r.angle,e[r.name]=r.states.opened;const i=getDuration(n,e,this.velocities.gripper);return this._makeTween(t,e,i)}joint_absolute(n,t){if(console.log("> Setting joint "+n+" to "+t+" degrees"),this.lockedJointIndices.includes(n))throw console.log("> ... but joint "+n+" is locked"),new Error("locked");const e=this.robot,i={},s={},r=e.arm.movable[n-1];i[r.name]=r.angle,s[r.name]=clampJointAngle(r,deg2rad(t));const o=getDuration(e,s,this.velocities.move*e.maxSpeed.move);return this._makeTween(i,s,o)}joint_relative(n,t){console.log("> Rotating joint "+n+" by "+t+" degrees");let i=this.robot.arm.movable[n-1].angle*180/Math.PI+t;return this.joint_absolute(n,i)}startPhysicalBody(n){const t=getSimObjects();this.physicsDone=!1,t[n].wasGripped?t[n].wasGripped=!1:t[n].reset(),t[n].visible=!0,t[n].addBodyToWorld(),t[n].updateBody(),t[n].body.wakeUp(),n+1>=t.length&&(this.lastSimObjectProcessed=!0),this.runningPhysics||(this._animatePhysics(),this.runningPhysics=!0)}getPhysicsDone(){return getSimObjects().length>0&&(!this.runningPhysics&&this.lastSimObjectProcessed&&!isWorldActive()?this.physicsDone=!0:this.physicsDone=!1),this.physicsDone}_animatePhysics(){if(updatePhysics(),this.renderCallback(),!isWorldActive()){console.log("Physics rendering halted."),this.runningPhysics=!1;return}window.requestAnimationFrame(()=>this._animatePhysics())}_makeTween(n,t,e){return new Promise((i,s)=>{const r=this.robot;for(const h of this.lockedJointIndices){const u=r.arm.movable[h].name;delete t[u]}let o=new exports.Tween(n).to(t,e).easing(exports.Easing.Quadratic.Out);o.onUpdate(h=>{for(const u in h)r.model.joints[u].setJointValue(h[u])}),o.onComplete(h=>{this.running=!1,i("success")}),o.onStop(h=>{this.running=!1,s("tween obsolete")}),o.start(),this.running||(this.running=!0,window.requestAnimationFrame(()=>this._animate()))})}_animate(n){exports.update(n),this.renderCallback(),this.running&&window.requestAnimationFrame(()=>this._animate())}}const Simulation={instance:null,_awaiting:[],getInstance:function(){return this.instance?Promise.resolve(this.instance):new Promise(n=>this._awaiting.push(n))},init:function(l,n,t){this.instance=new TheSimulation(l,n,t),this._awaiting.forEach(e=>e(this.instance)),this._awaiting=[]}};class MessageBox{constructor(n,t,e=null){this.id=n,this.option=t}show(n,t=null){if(this.id===null||typeof this.id>"u")throw"Please set the 'ID' of the message box container.";if(n===""||typeof n>"u"||n===null)throw"The 'msg' parameter is empty.";console.log(n);let e=this.option,i=document.querySelector(this.id),s=document.createElement("div"),r=document.createElement("div"),o=document.createElement("div"),h=document.createElement("a");if(i===null)throw"The Message Box container is not found.";if(r.classList.add("msgbox-content"),o.classList.add("msgbox-text"),o.innerHTML=n,r.appendChild(o),h.classList.add("msgbox-close"),h.setAttribute("href","#"),h.innerText=e.closeLabel||"CLOSE",s.classList.add("msgbox-box"),e.csscls)for(let p of e.csscls)s.classList.add(p);e.closeOnClick&&s.addEventListener("click",p=>{this.hide(s)}),s.addEventListener("transitionend",()=>{s.classList.contains("msgbox-box-hide")&&(s.parentNode.removeChild(s),clearTimeout(u),t&&t())}),s.appendChild(r),i.appendChild(s),(e.hideCloseButton===!1||typeof e.hideCloseButton>"u")&&(h.addEventListener("click",p=>{p.preventDefault(),!s.classList.contains("msgbox-box-hide")&&this.hide(s)}),s.appendChild(h));let u;return e.closeTime>0&&(s.addEventListener("mouseenter",p=>{clearTimeout(u),u=null}),s.addEventListener("mouseleave",p=>{u||(u=setTimeout(()=>{this.hide(s)},e.closeTime))}),s.dispatchEvent(new Event("mouseleave"))),s}hide(n){try{n.classList.add("msgbox-box-hide"),document.querySelector(this.id).removeChild(n)}catch{}}}function makeMsgBox(l,n,t,e){return new MessageBox("#msgbox-area",{closeTime:n,hideCloseButton:t,closeOnClick:e,csscls:l})}function msgBoxInfo({closeTime:l=4e3,hideCloseButton:n=!0,closeOnClick:t=!0}={}){return makeMsgBox(["info"],l,n,t)}function msgBoxSuccess({closeTime:l=4e3,hideCloseButton:n=!0,closeOnClick:t=!0}={}){return makeMsgBox(["success"],l,n,t)}function msgBoxWarning({closeTime:l=4e3,hideCloseButton:n=!0,closeOnClick:t=!0}={}){return makeMsgBox(["warning"],l,n,t)}function msgBoxError({closeTime:l=6e3,hideCloseButton:n=!0,closeOnClick:t=!0}={}){return makeMsgBox(["error"],l,n,t)}let popInfo=(l,n)=>msgBoxInfo().show(l,n),popSuccess=(l,n)=>msgBoxSuccess().show(l,n),popWarning=(l,n)=>msgBoxWarning().show(l,n),popError=(l,n)=>msgBoxError().show(l,n);var pathBrowserify,hasRequiredPathBrowserify;function requirePathBrowserify(){if(hasRequiredPathBrowserify)return pathBrowserify;hasRequiredPathBrowserify=1;function l(i){if(typeof i!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(i))}function n(i,s){for(var r="",o=0,h=-1,u=0,p,d=0;d<=i.length;++d){if(d<i.length)p=i.charCodeAt(d);else{if(p===47)break;p=47}if(p===47){if(!(h===d-1||u===1))if(h!==d-1&&u===2){if(r.length<2||o!==2||r.charCodeAt(r.length-1)!==46||r.charCodeAt(r.length-2)!==46){if(r.length>2){var f=r.lastIndexOf("/");if(f!==r.length-1){f===-1?(r="",o=0):(r=r.slice(0,f),o=r.length-1-r.lastIndexOf("/")),h=d,u=0;continue}}else if(r.length===2||r.length===1){r="",o=0,h=d,u=0;continue}}s&&(r.length>0?r+="/..":r="..",o=2)}else r.length>0?r+="/"+i.slice(h+1,d):r=i.slice(h+1,d),o=d-h-1;h=d,u=0}else p===46&&u!==-1?++u:u=-1}return r}function t(i,s){var r=s.dir||s.root,o=s.base||(s.name||"")+(s.ext||"");return r?r===s.root?r+o:r+i+o:o}var e={resolve:function(){for(var s="",r=!1,o,h=arguments.length-1;h>=-1&&!r;h--){var u;h>=0?u=arguments[h]:(o===void 0&&(o=process.cwd()),u=o),l(u),u.length!==0&&(s=u+"/"+s,r=u.charCodeAt(0)===47)}return s=n(s,!r),r?s.length>0?"/"+s:"/":s.length>0?s:"."},normalize:function(s){if(l(s),s.length===0)return".";var r=s.charCodeAt(0)===47,o=s.charCodeAt(s.length-1)===47;return s=n(s,!r),s.length===0&&!r&&(s="."),s.length>0&&o&&(s+="/"),r?"/"+s:s},isAbsolute:function(s){return l(s),s.length>0&&s.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var s,r=0;r<arguments.length;++r){var o=arguments[r];l(o),o.length>0&&(s===void 0?s=o:s+="/"+o)}return s===void 0?".":e.normalize(s)},relative:function(s,r){if(l(s),l(r),s===r||(s=e.resolve(s),r=e.resolve(r),s===r))return"";for(var o=1;o<s.length&&s.charCodeAt(o)===47;++o);for(var h=s.length,u=h-o,p=1;p<r.length&&r.charCodeAt(p)===47;++p);for(var d=r.length,f=d-p,g=u<f?u:f,_=-1,v=0;v<=g;++v){if(v===g){if(f>g){if(r.charCodeAt(p+v)===47)return r.slice(p+v+1);if(v===0)return r.slice(p+v)}else u>g&&(s.charCodeAt(o+v)===47?_=v:v===0&&(_=0));break}var y=s.charCodeAt(o+v),E=r.charCodeAt(p+v);if(y!==E)break;y===47&&(_=v)}var m="";for(v=o+_+1;v<=h;++v)(v===h||s.charCodeAt(v)===47)&&(m.length===0?m+="..":m+="/..");return m.length>0?m+r.slice(p+_):(p+=_,r.charCodeAt(p)===47&&++p,r.slice(p))},_makeLong:function(s){return s},dirname:function(s){if(l(s),s.length===0)return".";for(var r=s.charCodeAt(0),o=r===47,h=-1,u=!0,p=s.length-1;p>=1;--p)if(r=s.charCodeAt(p),r===47){if(!u){h=p;break}}else u=!1;return h===-1?o?"/":".":o&&h===1?"//":s.slice(0,h)},basename:function(s,r){if(r!==void 0&&typeof r!="string")throw new TypeError('"ext" argument must be a string');l(s);var o=0,h=-1,u=!0,p;if(r!==void 0&&r.length>0&&r.length<=s.length){if(r.length===s.length&&r===s)return"";var d=r.length-1,f=-1;for(p=s.length-1;p>=0;--p){var g=s.charCodeAt(p);if(g===47){if(!u){o=p+1;break}}else f===-1&&(u=!1,f=p+1),d>=0&&(g===r.charCodeAt(d)?--d===-1&&(h=p):(d=-1,h=f))}return o===h?h=f:h===-1&&(h=s.length),s.slice(o,h)}else{for(p=s.length-1;p>=0;--p)if(s.charCodeAt(p)===47){if(!u){o=p+1;break}}else h===-1&&(u=!1,h=p+1);return h===-1?"":s.slice(o,h)}},extname:function(s){l(s);for(var r=-1,o=0,h=-1,u=!0,p=0,d=s.length-1;d>=0;--d){var f=s.charCodeAt(d);if(f===47){if(!u){o=d+1;break}continue}h===-1&&(u=!1,h=d+1),f===46?r===-1?r=d:p!==1&&(p=1):r!==-1&&(p=-1)}return r===-1||h===-1||p===0||p===1&&r===h-1&&r===o+1?"":s.slice(r,h)},format:function(s){if(s===null||typeof s!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof s);return t("/",s)},parse:function(s){l(s);var r={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return r;var o=s.charCodeAt(0),h=o===47,u;h?(r.root="/",u=1):u=0;for(var p=-1,d=0,f=-1,g=!0,_=s.length-1,v=0;_>=u;--_){if(o=s.charCodeAt(_),o===47){if(!g){d=_+1;break}continue}f===-1&&(g=!1,f=_+1),o===46?p===-1?p=_:v!==1&&(v=1):p!==-1&&(v=-1)}return p===-1||f===-1||v===0||v===1&&p===f-1&&p===d+1?f!==-1&&(d===0&&h?r.base=r.name=s.slice(1,f):r.base=r.name=s.slice(d,f)):(d===0&&h?(r.name=s.slice(1,p),r.base=s.slice(1,f)):(r.name=s.slice(d,p),r.base=s.slice(d,f)),r.ext=s.slice(p,f)),d>0?r.dir=s.slice(0,d-1):h&&(r.dir="/"),r},sep:"/",delimiter:":",win32:null,posix:null};return e.posix=e,pathBrowserify=e,pathBrowserify}var pathBrowserifyExports=requirePathBrowserify();const path=getDefaultExportFromCjs(pathBrowserifyExports);function traverse(l,n,t="children"){if(n(l)||!l[t])return;const i=l[t];for(let s=0;s<i.length;s++)traverse(i[s],n,t)}var define_process_env_default={};const PUBLIC_URL=typeof process<"u"&&define_process_env_default?.PUBLIC_URL||"/rocksi/",MODELS_ROOT=path.join(PUBLIC_URL,"models/"),getPackage=l=>path.join(MODELS_ROOT,l);class Robot{constructor(n,t,e){this.name=n,this._package=t+"/",this._xacro=e,this.useAdvancedGripping=!0,this.model={},this.links=[],this.joints=[],this.packages={get[t](){return getPackage(t)}},this.arm={joints:[],movable:[],links:[]},this.hand={joints:[],movable:[],links:[],invertOpenClose:!1},this.robotRoot="",this.handRoot="",this.rosMacros={},this.modelScale=1,this.partNames={arm:[],hand:[]},this.defaultPose={},this.tcp={parent:"",position:[0,0,0],rotation:[0,0,0],object:new Object3D},this.ikEnabled=[],this.interactionJointLimits={},this.maxSpeed={move:1,gripper:.2},this.generator=null}init(n){this.model=n,this.joints=n.joints,this.links=n.links,this.model.scale.set(this.modelScale,this.modelScale,this.modelScale),this.tcp.object.position.set(...this.tcp.position),this.tcp.object.quaternion.multiply(new Quaternion$1().setFromEuler(new Euler().set(...this.tcp.rotation))),this.getFrame(this.tcp.parent).add(this.tcp.object),this.robotRoot=this.getFrame(this.robotRoot),traverse(this.robotRoot,t=>{if(t.name===this.handRoot)return!0;this.partNames.arm.push(t.name),this.isJoint(t)?(this.arm.joints.push(t),this.isMovable(t)&&this.arm.movable.push(t)):this.isLink(t)&&this.arm.links.push(t)}),this.handRoot=this.getFrame(this.handRoot),traverse(this.handRoot,t=>{this.partNames.hand.push(t.name),this.isJoint(t)?(this.hand.joints.push(t),this.isMovable(t)&&this.hand.movable.push(t)):this.isLink(t)&&this.hand.links.push(t)});for(let t of this.hand.movable)t.states={closed:this.hand.invertOpenClose?t.limit.upper:t.limit.lower,opened:this.hand.invertOpenClose?t.limit.lower:t.limit.upper}}onLoadComplete(){}get root(){return MODELS_ROOT}get package(){return path.join(this.root,this._package)}get xacro(){return path.join(this.package,this._xacro)}setPose(n){if(Array.isArray(n)){if(n.length!==this.arm.movable.length)throw new Error("Array length must be equal to the number of movable joints");for(let t=0;t<n.length;t++)this.arm.movable[t].setJointValue(n[t])}else if(typeof n=="object")for(let t of this.arm.movable){let e=n[t.name];typeof e=="number"&&t.setJointValue(e)}else throw new Error('Invalid pose type "'+typeof n+'"')}isJoint(n){return n.type==="URDFJoint"}isLink(n){return n.type==="URDFLink"}isArm(n){return this.partNames.arm.includes(n.name)}isHand(n){return this.partNames.hand.includes(n.name)}isMovable(n){return this.isJoint(n)&&n._jointType!=="fixed"}isIKEnabled(n){return this.ikEnabled.length>0?this.ikEnabled.includes(n.name):this.isMovable(n)&&this.isArm(n)}isGripperOpen(){return this.getGripperAbduction()>=.5}getGripperAbduction(){if(this.hand.movable.length===0)return 0;let n=0;for(let t of this.hand.movable){let e=t.angle,i=t.limit.upper,s=t.limit.lower,r=(e-s)/(i-s);n+=r}return n/=this.hand.movable.length,n}getJointForLink(n){typeof n=="string"&&(n=this.model.links[n]);let t=n.parent;for(;t;){if(this.isJoint(t))return t;t=t.parent}return null}getLinkForJoint(n){typeof n=="string"&&(n=this.model.joints[n]);for(let t of n.children)if(this.isLink(t))return t;return null}getFrame(n){return this.model.frames[n]}createSkeleton(){let n=new Vector3,t=new Bone,e={origin:this.model,root:t,bones:[],tip:this.tcp.object};for(let i of this.arm.movable){this.getLinkForJoint(i).getWorldPosition(n);let r=new Bone;r.robotJoint=i,t.add(r),t.lookAt(n),t.updateMatrixWorld(),r.position.copy(r.worldToLocal(n)),e.bones.push(r),t=r}return e}}class Franka extends Robot{constructor(){super("Franka","franka_description","robots/panda_arm_hand.urdf.xacro"),this.robotRoot="panda_link0",this.handRoot="panda_hand",this.modelScale=10,this.defaultPose={panda_joint1:.5,panda_joint2:-.3,panda_joint4:-1.8,panda_joint6:1.5,panda_joint7:1},this.tcp.parent="panda_hand",this.tcp.position=[0,0,.103394],this.ikEnabled=["panda_joint1","panda_joint2","panda_joint4"],this.interactionJointLimits={panda_joint4:{upper:-Math.PI/6}}}}const franka=new Franka;var python$1={exports:{}},python_compressed$1={exports:{}},python_compressed=python_compressed$1.exports,hasRequiredPython_compressed;function requirePython_compressed(){return hasRequiredPython_compressed||(hasRequiredPython_compressed=1,function(l,n){(function(t,e){l.exports=e(requireBlockly_compressed())})(python_compressed,function(t){return t.Python=new t.Generator("Python"),t.Python.addReservedWords("False,None,True,and,as,assert,break,class,continue,def,del,elif,else,except,exec,finally,for,from,global,if,import,in,is,lambda,nonlocal,not,or,pass,print,raise,return,try,while,with,yield,NotImplemented,Ellipsis,__debug__,quit,exit,copyright,license,credits,ArithmeticError,AssertionError,AttributeError,BaseException,BlockingIOError,BrokenPipeError,BufferError,BytesWarning,ChildProcessError,ConnectionAbortedError,ConnectionError,ConnectionRefusedError,ConnectionResetError,DeprecationWarning,EOFError,Ellipsis,EnvironmentError,Exception,FileExistsError,FileNotFoundError,FloatingPointError,FutureWarning,GeneratorExit,IOError,ImportError,ImportWarning,IndentationError,IndexError,InterruptedError,IsADirectoryError,KeyError,KeyboardInterrupt,LookupError,MemoryError,ModuleNotFoundError,NameError,NotADirectoryError,NotImplemented,NotImplementedError,OSError,OverflowError,PendingDeprecationWarning,PermissionError,ProcessLookupError,RecursionError,ReferenceError,ResourceWarning,RuntimeError,RuntimeWarning,StandardError,StopAsyncIteration,StopIteration,SyntaxError,SyntaxWarning,SystemError,SystemExit,TabError,TimeoutError,TypeError,UnboundLocalError,UnicodeDecodeError,UnicodeEncodeError,UnicodeError,UnicodeTranslateError,UnicodeWarning,UserWarning,ValueError,Warning,ZeroDivisionError,_,__build_class__,__debug__,__doc__,__import__,__loader__,__name__,__package__,__spec__,abs,all,any,apply,ascii,basestring,bin,bool,buffer,bytearray,bytes,callable,chr,classmethod,cmp,coerce,compile,complex,copyright,credits,delattr,dict,dir,divmod,enumerate,eval,exec,execfile,exit,file,filter,float,format,frozenset,getattr,globals,hasattr,hash,help,hex,id,input,int,intern,isinstance,issubclass,iter,len,license,list,locals,long,map,max,memoryview,min,next,object,oct,open,ord,pow,print,property,quit,range,raw_input,reduce,reload,repr,reversed,round,set,setattr,slice,sorted,staticmethod,str,sum,super,tuple,type,unichr,unicode,vars,xrange,zip"),t.Python.ORDER_ATOMIC=0,t.Python.ORDER_COLLECTION=1,t.Python.ORDER_STRING_CONVERSION=1,t.Python.ORDER_MEMBER=2.1,t.Python.ORDER_FUNCTION_CALL=2.2,t.Python.ORDER_EXPONENTIATION=3,t.Python.ORDER_UNARY_SIGN=4,t.Python.ORDER_BITWISE_NOT=4,t.Python.ORDER_MULTIPLICATIVE=5,t.Python.ORDER_ADDITIVE=6,t.Python.ORDER_BITWISE_SHIFT=7,t.Python.ORDER_BITWISE_AND=8,t.Python.ORDER_BITWISE_XOR=9,t.Python.ORDER_BITWISE_OR=10,t.Python.ORDER_RELATIONAL=11,t.Python.ORDER_LOGICAL_NOT=12,t.Python.ORDER_LOGICAL_AND=13,t.Python.ORDER_LOGICAL_OR=14,t.Python.ORDER_CONDITIONAL=15,t.Python.ORDER_LAMBDA=16,t.Python.ORDER_NONE=99,t.Python.ORDER_OVERRIDES=[[t.Python.ORDER_FUNCTION_CALL,t.Python.ORDER_MEMBER],[t.Python.ORDER_FUNCTION_CALL,t.Python.ORDER_FUNCTION_CALL],[t.Python.ORDER_MEMBER,t.Python.ORDER_MEMBER],[t.Python.ORDER_MEMBER,t.Python.ORDER_FUNCTION_CALL],[t.Python.ORDER_LOGICAL_NOT,t.Python.ORDER_LOGICAL_NOT],[t.Python.ORDER_LOGICAL_AND,t.Python.ORDER_LOGICAL_AND],[t.Python.ORDER_LOGICAL_OR,t.Python.ORDER_LOGICAL_OR]],t.Python.isInitialized=!1,t.Python.init=function(e){t.Python.PASS=this.INDENT+`pass
`,t.Python.definitions_=Object.create(null),t.Python.functionNames_=Object.create(null),t.Python.variableDB_?t.Python.variableDB_.reset():t.Python.variableDB_=new t.Names(t.Python.RESERVED_WORDS_),t.Python.variableDB_.setVariableMap(e.getVariableMap());for(var i=[],s=t.Variables.allDeveloperVariables(e),r=0;r<s.length;r++)i.push(t.Python.variableDB_.getName(s[r],t.Names.DEVELOPER_VARIABLE_TYPE)+" = None");for(e=t.Variables.allUsedVarModels(e),r=0;r<e.length;r++)i.push(t.Python.variableDB_.getName(e[r].getId(),t.VARIABLE_CATEGORY_NAME)+" = None");t.Python.definitions_.variables=i.join(`
`),this.isInitialized=!0},t.Python.finish=function(e){var i=[],s=[],r;for(r in t.Python.definitions_){var o=t.Python.definitions_[r];o.match(/^(from\s+\S+\s+)?import\s+\S+/)?i.push(o):s.push(o)}return delete t.Python.definitions_,delete t.Python.functionNames_,t.Python.variableDB_.reset(),(i.join(`
`)+`

`+s.join(`

`)).replace(/\n\n+/g,`

`).replace(/\n*$/,`


`)+e},t.Python.scrubNakedValue=function(e){return e+`
`},t.Python.quote_=function(e){e=e.replace(/\\/g,"\\\\").replace(/\n/g,`\\
`);var i="'";return e.indexOf("'")!==-1&&(e.indexOf('"')===-1?i='"':e=e.replace(/'/g,"\\'")),i+e+i},t.Python.multiline_quote_=function(e){return e.split(/\n/g).map(t.Python.quote_).join(` + '\\n' + 
`)},t.Python.scrub_=function(e,i,s){var r="";if(!e.outputConnection||!e.outputConnection.targetConnection){var o=e.getCommentText();o&&(o=t.utils.string.wrap(o,t.Python.COMMENT_WRAP-3),r+=t.Python.prefixLines(o+`
`,"# "));for(var h=0;h<e.inputList.length;h++)e.inputList[h].type==t.inputTypes.VALUE&&(o=e.inputList[h].connection.targetBlock())&&(o=t.Python.allNestedComments(o))&&(r+=t.Python.prefixLines(o,"# "))}return e=e.nextConnection&&e.nextConnection.targetBlock(),s=s?"":t.Python.blockToCode(e),r+i+s},t.Python.getAdjustedInt=function(e,i,s,r){s=s||0,e.workspace.options.oneBasedIndex&&s--;var o=e.workspace.options.oneBasedIndex?"1":"0";return e=t.Python.valueToCode(e,i,s?t.Python.ORDER_ADDITIVE:t.Python.ORDER_NONE)||o,t.isNumber(e)?(e=parseInt(e,10)+s,r&&(e=-e)):(e=0<s?"int("+e+" + "+s+")":0>s?"int("+e+" - "+-s+")":"int("+e+")",r&&(e="-"+e)),e},t.Python.colour={},t.Python.colour_picker=function(e){return[t.Python.quote_(e.getFieldValue("COLOUR")),t.Python.ORDER_ATOMIC]},t.Python.colour_random=function(e){return t.Python.definitions_.import_random="import random",["'#%06x' % random.randint(0, 2**24 - 1)",t.Python.ORDER_FUNCTION_CALL]},t.Python.colour_rgb=function(e){var i=t.Python.provideFunction_("colour_rgb",["def "+t.Python.FUNCTION_NAME_PLACEHOLDER_+"(r, g, b):","  r = round(min(100, max(0, r)) * 2.55)","  g = round(min(100, max(0, g)) * 2.55)","  b = round(min(100, max(0, b)) * 2.55)","  return '#%02x%02x%02x' % (r, g, b)"]),s=t.Python.valueToCode(e,"RED",t.Python.ORDER_NONE)||0,r=t.Python.valueToCode(e,"GREEN",t.Python.ORDER_NONE)||0;return e=t.Python.valueToCode(e,"BLUE",t.Python.ORDER_NONE)||0,[i+"("+s+", "+r+", "+e+")",t.Python.ORDER_FUNCTION_CALL]},t.Python.colour_blend=function(e){var i=t.Python.provideFunction_("colour_blend",["def "+t.Python.FUNCTION_NAME_PLACEHOLDER_+"(colour1, colour2, ratio):","  r1, r2 = int(colour1[1:3], 16), int(colour2[1:3], 16)","  g1, g2 = int(colour1[3:5], 16), int(colour2[3:5], 16)","  b1, b2 = int(colour1[5:7], 16), int(colour2[5:7], 16)","  ratio = min(1, max(0, ratio))","  r = round(r1 * (1 - ratio) + r2 * ratio)","  g = round(g1 * (1 - ratio) + g2 * ratio)","  b = round(b1 * (1 - ratio) + b2 * ratio)","  return '#%02x%02x%02x' % (r, g, b)"]),s=t.Python.valueToCode(e,"COLOUR1",t.Python.ORDER_NONE)||"'#000000'",r=t.Python.valueToCode(e,"COLOUR2",t.Python.ORDER_NONE)||"'#000000'";return e=t.Python.valueToCode(e,"RATIO",t.Python.ORDER_NONE)||0,[i+"("+s+", "+r+", "+e+")",t.Python.ORDER_FUNCTION_CALL]},t.Python.lists={},t.Python.lists_create_empty=function(e){return["[]",t.Python.ORDER_ATOMIC]},t.Python.lists_create_with=function(e){for(var i=Array(e.itemCount_),s=0;s<e.itemCount_;s++)i[s]=t.Python.valueToCode(e,"ADD"+s,t.Python.ORDER_NONE)||"None";return["["+i.join(", ")+"]",t.Python.ORDER_ATOMIC]},t.Python.lists_repeat=function(e){var i=t.Python.valueToCode(e,"ITEM",t.Python.ORDER_NONE)||"None";return e=t.Python.valueToCode(e,"NUM",t.Python.ORDER_MULTIPLICATIVE)||"0",["["+i+"] * "+e,t.Python.ORDER_MULTIPLICATIVE]},t.Python.lists_length=function(e){return["len("+(t.Python.valueToCode(e,"VALUE",t.Python.ORDER_NONE)||"[]")+")",t.Python.ORDER_FUNCTION_CALL]},t.Python.lists_isEmpty=function(e){return["not len("+(t.Python.valueToCode(e,"VALUE",t.Python.ORDER_NONE)||"[]")+")",t.Python.ORDER_LOGICAL_NOT]},t.Python.lists_indexOf=function(e){var i=t.Python.valueToCode(e,"FIND",t.Python.ORDER_NONE)||"[]",s=t.Python.valueToCode(e,"VALUE",t.Python.ORDER_NONE)||"''";if(e.workspace.options.oneBasedIndex)var r=" 0",o=" + 1",h="";else r=" -1",o="",h=" - 1";return e.getFieldValue("END")=="FIRST"?(e=t.Python.provideFunction_("first_index",["def "+t.Python.FUNCTION_NAME_PLACEHOLDER_+"(my_list, elem):","  try: index = my_list.index(elem)"+o,"  except: index ="+r,"  return index"]),[e+"("+s+", "+i+")",t.Python.ORDER_FUNCTION_CALL]):(e=t.Python.provideFunction_("last_index",["def "+t.Python.FUNCTION_NAME_PLACEHOLDER_+"(my_list, elem):","  try: index = len(my_list) - my_list[::-1].index(elem)"+h,"  except: index ="+r,"  return index"]),[e+"("+s+", "+i+")",t.Python.ORDER_FUNCTION_CALL])},t.Python.lists_getIndex=function(e){var i=e.getFieldValue("MODE")||"GET",s=e.getFieldValue("WHERE")||"FROM_START",r=t.Python.valueToCode(e,"VALUE",s=="RANDOM"?t.Python.ORDER_NONE:t.Python.ORDER_MEMBER)||"[]";switch(s){case"FIRST":if(i=="GET")return[r+"[0]",t.Python.ORDER_MEMBER];if(i=="GET_REMOVE")return[r+".pop(0)",t.Python.ORDER_FUNCTION_CALL];if(i=="REMOVE")return r+`.pop(0)
`;break;case"LAST":if(i=="GET")return[r+"[-1]",t.Python.ORDER_MEMBER];if(i=="GET_REMOVE")return[r+".pop()",t.Python.ORDER_FUNCTION_CALL];if(i=="REMOVE")return r+`.pop()
`;break;case"FROM_START":if(e=t.Python.getAdjustedInt(e,"AT"),i=="GET")return[r+"["+e+"]",t.Python.ORDER_MEMBER];if(i=="GET_REMOVE")return[r+".pop("+e+")",t.Python.ORDER_FUNCTION_CALL];if(i=="REMOVE")return r+".pop("+e+`)
`;break;case"FROM_END":if(e=t.Python.getAdjustedInt(e,"AT",1,!0),i=="GET")return[r+"["+e+"]",t.Python.ORDER_MEMBER];if(i=="GET_REMOVE")return[r+".pop("+e+")",t.Python.ORDER_FUNCTION_CALL];if(i=="REMOVE")return r+".pop("+e+`)
`;break;case"RANDOM":if(t.Python.definitions_.import_random="import random",i=="GET")return["random.choice("+r+")",t.Python.ORDER_FUNCTION_CALL];if(r=t.Python.provideFunction_("lists_remove_random_item",["def "+t.Python.FUNCTION_NAME_PLACEHOLDER_+"(myList):","  x = int(random.random() * len(myList))","  return myList.pop(x)"])+"("+r+")",i=="GET_REMOVE")return[r,t.Python.ORDER_FUNCTION_CALL];if(i=="REMOVE")return r+`
`}throw Error("Unhandled combination (lists_getIndex).")},t.Python.lists_setIndex=function(e){var i=t.Python.valueToCode(e,"LIST",t.Python.ORDER_MEMBER)||"[]",s=e.getFieldValue("MODE")||"GET",r=e.getFieldValue("WHERE")||"FROM_START",o=t.Python.valueToCode(e,"TO",t.Python.ORDER_NONE)||"None";switch(r){case"FIRST":if(s=="SET")return i+"[0] = "+o+`
`;if(s=="INSERT")return i+".insert(0, "+o+`)
`;break;case"LAST":if(s=="SET")return i+"[-1] = "+o+`
`;if(s=="INSERT")return i+".append("+o+`)
`;break;case"FROM_START":if(e=t.Python.getAdjustedInt(e,"AT"),s=="SET")return i+"["+e+"] = "+o+`
`;if(s=="INSERT")return i+".insert("+e+", "+o+`)
`;break;case"FROM_END":if(e=t.Python.getAdjustedInt(e,"AT",1,!0),s=="SET")return i+"["+e+"] = "+o+`
`;if(s=="INSERT")return i+".insert("+e+", "+o+`)
`;break;case"RANDOM":if(t.Python.definitions_.import_random="import random",i.match(/^\w+$/)?e="":(e=t.Python.variableDB_.getDistinctName("tmp_list",t.VARIABLE_CATEGORY_NAME),r=e+" = "+i+`
`,i=e,e=r),r=t.Python.variableDB_.getDistinctName("tmp_x",t.VARIABLE_CATEGORY_NAME),e+=r+" = int(random.random() * len("+i+`))
`,s=="SET")return e+(i+"["+r+"] = "+o+`
`);if(s=="INSERT")return e+(i+".insert("+r+", "+o+`)
`)}throw Error("Unhandled combination (lists_setIndex).")},t.Python.lists_getSublist=function(e){var i=t.Python.valueToCode(e,"LIST",t.Python.ORDER_MEMBER)||"[]",s=e.getFieldValue("WHERE1"),r=e.getFieldValue("WHERE2");switch(s){case"FROM_START":s=t.Python.getAdjustedInt(e,"AT1"),s=="0"&&(s="");break;case"FROM_END":s=t.Python.getAdjustedInt(e,"AT1",1,!0);break;case"FIRST":s="";break;default:throw Error("Unhandled option (lists_getSublist)")}switch(r){case"FROM_START":e=t.Python.getAdjustedInt(e,"AT2",1);break;case"FROM_END":e=t.Python.getAdjustedInt(e,"AT2",0,!0),t.isNumber(String(e))?e=="0"&&(e=""):(t.Python.definitions_.import_sys="import sys",e+=" or sys.maxsize");break;case"LAST":e="";break;default:throw Error("Unhandled option (lists_getSublist)")}return[i+"["+s+" : "+e+"]",t.Python.ORDER_MEMBER]},t.Python.lists_sort=function(e){var i=t.Python.valueToCode(e,"LIST",t.Python.ORDER_NONE)||"[]",s=e.getFieldValue("TYPE");return e=e.getFieldValue("DIRECTION")==="1"?"False":"True",[t.Python.provideFunction_("lists_sort",["def "+t.Python.FUNCTION_NAME_PLACEHOLDER_+"(my_list, type, reverse):","  def try_float(s):","    try:","      return float(s)","    except:","      return 0","  key_funcs = {",'    "NUMERIC": try_float,','    "TEXT": str,','    "IGNORE_CASE": lambda s: str(s).lower()',"  }","  key_func = key_funcs[type]","  list_cpy = list(my_list)","  return sorted(list_cpy, key=key_func, reverse=reverse)"])+"("+i+', "'+s+'", '+e+")",t.Python.ORDER_FUNCTION_CALL]},t.Python.lists_split=function(e){var i=e.getFieldValue("MODE");if(i=="SPLIT")i=t.Python.valueToCode(e,"INPUT",t.Python.ORDER_MEMBER)||"''",e=t.Python.valueToCode(e,"DELIM",t.Python.ORDER_NONE),e=i+".split("+e+")";else if(i=="JOIN")i=t.Python.valueToCode(e,"INPUT",t.Python.ORDER_NONE)||"[]",e=t.Python.valueToCode(e,"DELIM",t.Python.ORDER_MEMBER)||"''",e=e+".join("+i+")";else throw Error("Unknown mode: "+i);return[e,t.Python.ORDER_FUNCTION_CALL]},t.Python.lists_reverse=function(e){return["list(reversed("+(t.Python.valueToCode(e,"LIST",t.Python.ORDER_NONE)||"[]")+"))",t.Python.ORDER_FUNCTION_CALL]},t.Python.logic={},t.Python.controls_if=function(e){var i=0,s="";t.Python.STATEMENT_PREFIX&&(s+=t.Python.injectId(t.Python.STATEMENT_PREFIX,e));do{var r=t.Python.valueToCode(e,"IF"+i,t.Python.ORDER_NONE)||"False",o=t.Python.statementToCode(e,"DO"+i)||t.Python.PASS;t.Python.STATEMENT_SUFFIX&&(o=t.Python.prefixLines(t.Python.injectId(t.Python.STATEMENT_SUFFIX,e),t.Python.INDENT)+o),s+=(i==0?"if ":"elif ")+r+`:
`+o,++i}while(e.getInput("IF"+i));return(e.getInput("ELSE")||t.Python.STATEMENT_SUFFIX)&&(o=t.Python.statementToCode(e,"ELSE")||t.Python.PASS,t.Python.STATEMENT_SUFFIX&&(o=t.Python.prefixLines(t.Python.injectId(t.Python.STATEMENT_SUFFIX,e),t.Python.INDENT)+o),s+=`else:
`+o),s},t.Python.controls_ifelse=t.Python.controls_if,t.Python.logic_compare=function(e){var i={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[e.getFieldValue("OP")],s=t.Python.ORDER_RELATIONAL,r=t.Python.valueToCode(e,"A",s)||"0";return e=t.Python.valueToCode(e,"B",s)||"0",[r+" "+i+" "+e,s]},t.Python.logic_operation=function(e){var i=e.getFieldValue("OP")=="AND"?"and":"or",s=i=="and"?t.Python.ORDER_LOGICAL_AND:t.Python.ORDER_LOGICAL_OR,r=t.Python.valueToCode(e,"A",s);if(e=t.Python.valueToCode(e,"B",s),r||e){var o=i=="and"?"True":"False";r||(r=o),e||(e=o)}else e=r="False";return[r+" "+i+" "+e,s]},t.Python.logic_negate=function(e){return["not "+(t.Python.valueToCode(e,"BOOL",t.Python.ORDER_LOGICAL_NOT)||"True"),t.Python.ORDER_LOGICAL_NOT]},t.Python.logic_boolean=function(e){return[e.getFieldValue("BOOL")=="TRUE"?"True":"False",t.Python.ORDER_ATOMIC]},t.Python.logic_null=function(e){return["None",t.Python.ORDER_ATOMIC]},t.Python.logic_ternary=function(e){var i=t.Python.valueToCode(e,"IF",t.Python.ORDER_CONDITIONAL)||"False",s=t.Python.valueToCode(e,"THEN",t.Python.ORDER_CONDITIONAL)||"None";return e=t.Python.valueToCode(e,"ELSE",t.Python.ORDER_CONDITIONAL)||"None",[s+" if "+i+" else "+e,t.Python.ORDER_CONDITIONAL]},t.Python.loops={},t.Python.controls_repeat_ext=function(e){var i=e.getField("TIMES")?String(parseInt(e.getFieldValue("TIMES"),10)):t.Python.valueToCode(e,"TIMES",t.Python.ORDER_NONE)||"0";i=t.isNumber(i)?parseInt(i,10):"int("+i+")";var s=t.Python.statementToCode(e,"DO");return s=t.Python.addLoopTrap(s,e)||t.Python.PASS,"for "+t.Python.variableDB_.getDistinctName("count",t.VARIABLE_CATEGORY_NAME)+" in range("+i+`):
`+s},t.Python.controls_repeat=t.Python.controls_repeat_ext,t.Python.controls_whileUntil=function(e){var i=e.getFieldValue("MODE")=="UNTIL",s=t.Python.valueToCode(e,"BOOL",i?t.Python.ORDER_LOGICAL_NOT:t.Python.ORDER_NONE)||"False",r=t.Python.statementToCode(e,"DO");return r=t.Python.addLoopTrap(r,e)||t.Python.PASS,i&&(s="not "+s),"while "+s+`:
`+r},t.Python.controls_for=function(e){var i=t.Python.variableDB_.getName(e.getFieldValue("VAR"),t.VARIABLE_CATEGORY_NAME),s=t.Python.valueToCode(e,"FROM",t.Python.ORDER_NONE)||"0",r=t.Python.valueToCode(e,"TO",t.Python.ORDER_NONE)||"0",o=t.Python.valueToCode(e,"BY",t.Python.ORDER_NONE)||"1",h=t.Python.statementToCode(e,"DO");h=t.Python.addLoopTrap(h,e)||t.Python.PASS;var u="",p=function(){return t.Python.provideFunction_("upRange",["def "+t.Python.FUNCTION_NAME_PLACEHOLDER_+"(start, stop, step):","  while start <= stop:","    yield start","    start += abs(step)"])},d=function(){return t.Python.provideFunction_("downRange",["def "+t.Python.FUNCTION_NAME_PLACEHOLDER_+"(start, stop, step):","  while start >= stop:","    yield start","    start -= abs(step)"])};if(e=function(g,_,v){return"("+g+" <= "+_+") and "+p()+"("+g+", "+_+", "+v+") or "+d()+"("+g+", "+_+", "+v+")"},t.isNumber(s)&&t.isNumber(r)&&t.isNumber(o))s=Number(s),r=Number(r),o=Math.abs(Number(o)),s%1===0&&r%1===0&&o%1===0?(s<=r?(r++,e=s==0&&o==1?r:s+", "+r,o!=1&&(e+=", "+o)):(r--,e=s+", "+r+", -"+o),e="range("+e+")"):(e=s<r?p():d(),e+="("+s+", "+r+", "+o+")");else{var f=function(g,_){return t.isNumber(g)?g=Number(g):g.match(/^\w+$/)?g="float("+g+")":(_=t.Python.variableDB_.getDistinctName(i+_,t.VARIABLE_CATEGORY_NAME),u+=_+" = float("+g+`)
`,g=_),g};s=f(s,"_start"),r=f(r,"_end"),o=f(o,"_inc"),typeof s=="number"&&typeof r=="number"?(e=s<r?p():d(),e+="("+s+", "+r+", "+o+")"):e=e(s,r,o)}return u+="for "+i+" in "+e+`:
`+h},t.Python.controls_forEach=function(e){var i=t.Python.variableDB_.getName(e.getFieldValue("VAR"),t.VARIABLE_CATEGORY_NAME),s=t.Python.valueToCode(e,"LIST",t.Python.ORDER_RELATIONAL)||"[]",r=t.Python.statementToCode(e,"DO");return r=t.Python.addLoopTrap(r,e)||t.Python.PASS,"for "+i+" in "+s+`:
`+r},t.Python.controls_flow_statements=function(e){var i="";if(t.Python.STATEMENT_PREFIX&&(i+=t.Python.injectId(t.Python.STATEMENT_PREFIX,e)),t.Python.STATEMENT_SUFFIX&&(i+=t.Python.injectId(t.Python.STATEMENT_SUFFIX,e)),t.Python.STATEMENT_PREFIX){var s=t.Constants.Loops.CONTROL_FLOW_IN_LOOP_CHECK_MIXIN.getSurroundLoop(e);s&&!s.suppressPrefixSuffix&&(i+=t.Python.injectId(t.Python.STATEMENT_PREFIX,s))}switch(e.getFieldValue("FLOW")){case"BREAK":return i+`break
`;case"CONTINUE":return i+`continue
`}throw Error("Unknown flow statement.")},t.Python.math={},t.Python.addReservedWords("math,random,Number"),t.Python.math_number=function(e){if(e=Number(e.getFieldValue("NUM")),e==1/0){e='float("inf")';var i=t.Python.ORDER_FUNCTION_CALL}else e==-1/0?(e='-float("inf")',i=t.Python.ORDER_UNARY_SIGN):i=0>e?t.Python.ORDER_UNARY_SIGN:t.Python.ORDER_ATOMIC;return[e,i]},t.Python.math_arithmetic=function(e){var i={ADD:[" + ",t.Python.ORDER_ADDITIVE],MINUS:[" - ",t.Python.ORDER_ADDITIVE],MULTIPLY:[" * ",t.Python.ORDER_MULTIPLICATIVE],DIVIDE:[" / ",t.Python.ORDER_MULTIPLICATIVE],POWER:[" ** ",t.Python.ORDER_EXPONENTIATION]}[e.getFieldValue("OP")],s=i[0];i=i[1];var r=t.Python.valueToCode(e,"A",i)||"0";return e=t.Python.valueToCode(e,"B",i)||"0",[r+s+e,i]},t.Python.math_single=function(e){var i=e.getFieldValue("OP");if(i=="NEG"){var s=t.Python.valueToCode(e,"NUM",t.Python.ORDER_UNARY_SIGN)||"0";return["-"+s,t.Python.ORDER_UNARY_SIGN]}switch(t.Python.definitions_.import_math="import math",e=i=="SIN"||i=="COS"||i=="TAN"?t.Python.valueToCode(e,"NUM",t.Python.ORDER_MULTIPLICATIVE)||"0":t.Python.valueToCode(e,"NUM",t.Python.ORDER_NONE)||"0",i){case"ABS":s="math.fabs("+e+")";break;case"ROOT":s="math.sqrt("+e+")";break;case"LN":s="math.log("+e+")";break;case"LOG10":s="math.log10("+e+")";break;case"EXP":s="math.exp("+e+")";break;case"POW10":s="math.pow(10,"+e+")";break;case"ROUND":s="round("+e+")";break;case"ROUNDUP":s="math.ceil("+e+")";break;case"ROUNDDOWN":s="math.floor("+e+")";break;case"SIN":s="math.sin("+e+" / 180.0 * math.pi)";break;case"COS":s="math.cos("+e+" / 180.0 * math.pi)";break;case"TAN":s="math.tan("+e+" / 180.0 * math.pi)"}if(s)return[s,t.Python.ORDER_FUNCTION_CALL];switch(i){case"ASIN":s="math.asin("+e+") / math.pi * 180";break;case"ACOS":s="math.acos("+e+") / math.pi * 180";break;case"ATAN":s="math.atan("+e+") / math.pi * 180";break;default:throw Error("Unknown math operator: "+i)}return[s,t.Python.ORDER_MULTIPLICATIVE]},t.Python.math_constant=function(e){var i={PI:["math.pi",t.Python.ORDER_MEMBER],E:["math.e",t.Python.ORDER_MEMBER],GOLDEN_RATIO:["(1 + math.sqrt(5)) / 2",t.Python.ORDER_MULTIPLICATIVE],SQRT2:["math.sqrt(2)",t.Python.ORDER_MEMBER],SQRT1_2:["math.sqrt(1.0 / 2)",t.Python.ORDER_MEMBER],INFINITY:["float('inf')",t.Python.ORDER_ATOMIC]};return e=e.getFieldValue("CONSTANT"),e!="INFINITY"&&(t.Python.definitions_.import_math="import math"),i[e]},t.Python.math_number_property=function(e){var i=t.Python.valueToCode(e,"NUMBER_TO_CHECK",t.Python.ORDER_MULTIPLICATIVE)||"0",s=e.getFieldValue("PROPERTY");if(s=="PRIME")return t.Python.definitions_.import_math="import math",t.Python.definitions_.from_numbers_import_Number="from numbers import Number",[t.Python.provideFunction_("math_isPrime",["def "+t.Python.FUNCTION_NAME_PLACEHOLDER_+"(n):","  # https://en.wikipedia.org/wiki/Primality_test#Naive_methods","  # If n is not a number but a string, try parsing it.","  if not isinstance(n, Number):","    try:","      n = float(n)","    except:","      return False","  if n == 2 or n == 3:","    return True","  # False if n is negative, is 1, or not whole, or if n is divisible by 2 or 3.","  if n <= 1 or n % 1 != 0 or n % 2 == 0 or n % 3 == 0:","    return False","  # Check all the numbers of form 6k +/- 1, up to sqrt(n).","  for x in range(6, int(math.sqrt(n)) + 2, 6):","    if n % (x - 1) == 0 or n % (x + 1) == 0:","      return False","  return True"])+"("+i+")",t.Python.ORDER_FUNCTION_CALL];switch(s){case"EVEN":var r=i+" % 2 == 0";break;case"ODD":r=i+" % 2 == 1";break;case"WHOLE":r=i+" % 1 == 0";break;case"POSITIVE":r=i+" > 0";break;case"NEGATIVE":r=i+" < 0";break;case"DIVISIBLE_BY":if(e=t.Python.valueToCode(e,"DIVISOR",t.Python.ORDER_MULTIPLICATIVE),!e||e=="0")return["False",t.Python.ORDER_ATOMIC];r=i+" % "+e+" == 0"}return[r,t.Python.ORDER_RELATIONAL]},t.Python.math_change=function(e){t.Python.definitions_.from_numbers_import_Number="from numbers import Number";var i=t.Python.valueToCode(e,"DELTA",t.Python.ORDER_ADDITIVE)||"0";return e=t.Python.variableDB_.getName(e.getFieldValue("VAR"),t.VARIABLE_CATEGORY_NAME),e+" = ("+e+" if isinstance("+e+", Number) else 0) + "+i+`
`},t.Python.math_round=t.Python.math_single,t.Python.math_trig=t.Python.math_single,t.Python.math_on_list=function(e){var i=e.getFieldValue("OP");switch(e=t.Python.valueToCode(e,"LIST",t.Python.ORDER_NONE)||"[]",i){case"SUM":i="sum("+e+")";break;case"MIN":i="min("+e+")";break;case"MAX":i="max("+e+")";break;case"AVERAGE":t.Python.definitions_.from_numbers_import_Number="from numbers import Number",i=t.Python.provideFunction_("math_mean",["def "+t.Python.FUNCTION_NAME_PLACEHOLDER_+"(myList):","  localList = [e for e in myList if isinstance(e, Number)]","  if not localList: return","  return float(sum(localList)) / len(localList)"]),i=i+"("+e+")";break;case"MEDIAN":t.Python.definitions_.from_numbers_import_Number="from numbers import Number",i=t.Python.provideFunction_("math_median",["def "+t.Python.FUNCTION_NAME_PLACEHOLDER_+"(myList):","  localList = sorted([e for e in myList if isinstance(e, Number)])","  if not localList: return","  if len(localList) % 2 == 0:","    return (localList[len(localList) // 2 - 1] + localList[len(localList) // 2]) / 2.0","  else:","    return localList[(len(localList) - 1) // 2]"]),i=i+"("+e+")";break;case"MODE":i=t.Python.provideFunction_("math_modes",["def "+t.Python.FUNCTION_NAME_PLACEHOLDER_+"(some_list):","  modes = []","  # Using a lists of [item, count] to keep count rather than dict",'  # to avoid "unhashable" errors when the counted item is itself a list or dict.',"  counts = []","  maxCount = 1","  for item in some_list:","    found = False","    for count in counts:","      if count[0] == item:","        count[1] += 1","        maxCount = max(maxCount, count[1])","        found = True","    if not found:","      counts.append([item, 1])","  for counted_item, item_count in counts:","    if item_count == maxCount:","      modes.append(counted_item)","  return modes"]),i=i+"("+e+")";break;case"STD_DEV":t.Python.definitions_.import_math="import math",i=t.Python.provideFunction_("math_standard_deviation",["def "+t.Python.FUNCTION_NAME_PLACEHOLDER_+"(numbers):","  n = len(numbers)","  if n == 0: return","  mean = float(sum(numbers)) / n","  variance = sum((x - mean) ** 2 for x in numbers) / n","  return math.sqrt(variance)"]),i=i+"("+e+")";break;case"RANDOM":t.Python.definitions_.import_random="import random",i="random.choice("+e+")";break;default:throw Error("Unknown operator: "+i)}return[i,t.Python.ORDER_FUNCTION_CALL]},t.Python.math_modulo=function(e){var i=t.Python.valueToCode(e,"DIVIDEND",t.Python.ORDER_MULTIPLICATIVE)||"0";return e=t.Python.valueToCode(e,"DIVISOR",t.Python.ORDER_MULTIPLICATIVE)||"0",[i+" % "+e,t.Python.ORDER_MULTIPLICATIVE]},t.Python.math_constrain=function(e){var i=t.Python.valueToCode(e,"VALUE",t.Python.ORDER_NONE)||"0",s=t.Python.valueToCode(e,"LOW",t.Python.ORDER_NONE)||"0";return e=t.Python.valueToCode(e,"HIGH",t.Python.ORDER_NONE)||"float('inf')",["min(max("+i+", "+s+"), "+e+")",t.Python.ORDER_FUNCTION_CALL]},t.Python.math_random_int=function(e){t.Python.definitions_.import_random="import random";var i=t.Python.valueToCode(e,"FROM",t.Python.ORDER_NONE)||"0";return e=t.Python.valueToCode(e,"TO",t.Python.ORDER_NONE)||"0",["random.randint("+i+", "+e+")",t.Python.ORDER_FUNCTION_CALL]},t.Python.math_random_float=function(e){return t.Python.definitions_.import_random="import random",["random.random()",t.Python.ORDER_FUNCTION_CALL]},t.Python.math_atan2=function(e){t.Python.definitions_.import_math="import math";var i=t.Python.valueToCode(e,"X",t.Python.ORDER_NONE)||"0";return["math.atan2("+(t.Python.valueToCode(e,"Y",t.Python.ORDER_NONE)||"0")+", "+i+") / math.pi * 180",t.Python.ORDER_MULTIPLICATIVE]},t.Python.procedures={},t.Python.procedures_defreturn=function(e){for(var i=[],s,r=e.workspace,o=t.Variables.allUsedVarModels(r)||[],h=0;s=o[h];h++)s=s.name,e.getVars().indexOf(s)==-1&&i.push(t.Python.variableDB_.getName(s,t.VARIABLE_CATEGORY_NAME));for(o=t.Variables.allDeveloperVariables(r),h=0;h<o.length;h++)i.push(t.Python.variableDB_.getName(o[h],t.Names.DEVELOPER_VARIABLE_TYPE));i=i.length?t.Python.INDENT+"global "+i.join(", ")+`
`:"",r=t.Python.variableDB_.getName(e.getFieldValue("NAME"),t.PROCEDURE_CATEGORY_NAME),s="",t.Python.STATEMENT_PREFIX&&(s+=t.Python.injectId(t.Python.STATEMENT_PREFIX,e)),t.Python.STATEMENT_SUFFIX&&(s+=t.Python.injectId(t.Python.STATEMENT_SUFFIX,e)),s&&(s=t.Python.prefixLines(s,t.Python.INDENT));var u="";t.Python.INFINITE_LOOP_TRAP&&(u=t.Python.prefixLines(t.Python.injectId(t.Python.INFINITE_LOOP_TRAP,e),t.Python.INDENT));var p=t.Python.statementToCode(e,"STACK"),d=t.Python.valueToCode(e,"RETURN",t.Python.ORDER_NONE)||"",f="";p&&d&&(f=s),d?d=t.Python.INDENT+"return "+d+`
`:p||(p=t.Python.PASS);var g=[];for(o=e.getVars(),h=0;h<o.length;h++)g[h]=t.Python.variableDB_.getName(o[h],t.VARIABLE_CATEGORY_NAME);return i="def "+r+"("+g.join(", ")+`):
`+i+s+u+p+f+d,i=t.Python.scrub_(e,i),t.Python.definitions_["%"+r]=i,null},t.Python.procedures_defnoreturn=t.Python.procedures_defreturn,t.Python.procedures_callreturn=function(e){for(var i=t.Python.variableDB_.getName(e.getFieldValue("NAME"),t.PROCEDURE_CATEGORY_NAME),s=[],r=e.getVars(),o=0;o<r.length;o++)s[o]=t.Python.valueToCode(e,"ARG"+o,t.Python.ORDER_NONE)||"None";return[i+"("+s.join(", ")+")",t.Python.ORDER_FUNCTION_CALL]},t.Python.procedures_callnoreturn=function(e){return t.Python.procedures_callreturn(e)[0]+`
`},t.Python.procedures_ifreturn=function(e){var i="if "+(t.Python.valueToCode(e,"CONDITION",t.Python.ORDER_NONE)||"False")+`:
`;return t.Python.STATEMENT_SUFFIX&&(i+=t.Python.prefixLines(t.Python.injectId(t.Python.STATEMENT_SUFFIX,e),t.Python.INDENT)),e.hasReturnValue_?(e=t.Python.valueToCode(e,"VALUE",t.Python.ORDER_NONE)||"None",i+=t.Python.INDENT+"return "+e+`
`):i+=t.Python.INDENT+`return
`,i},t.Python.texts={},t.Python.text=function(e){return[t.Python.quote_(e.getFieldValue("TEXT")),t.Python.ORDER_ATOMIC]},t.Python.text_multiline=function(e){e=t.Python.multiline_quote_(e.getFieldValue("TEXT"));var i=e.indexOf("+")!=-1?t.Python.ORDER_ADDITIVE:t.Python.ORDER_ATOMIC;return[e,i]},t.Python.text.forceString_=function(e){return t.Python.text.forceString_.strRegExp.test(e)?[e,t.Python.ORDER_ATOMIC]:["str("+e+")",t.Python.ORDER_FUNCTION_CALL]},t.Python.text.forceString_.strRegExp=/^\s*'([^']|\\')*'\s*$/,t.Python.text_join=function(e){switch(e.itemCount_){case 0:return["''",t.Python.ORDER_ATOMIC];case 1:return e=t.Python.valueToCode(e,"ADD0",t.Python.ORDER_NONE)||"''",t.Python.text.forceString_(e);case 2:var i=t.Python.valueToCode(e,"ADD0",t.Python.ORDER_NONE)||"''";return e=t.Python.valueToCode(e,"ADD1",t.Python.ORDER_NONE)||"''",e=t.Python.text.forceString_(i)[0]+" + "+t.Python.text.forceString_(e)[0],[e,t.Python.ORDER_ADDITIVE];default:i=[];for(var s=0;s<e.itemCount_;s++)i[s]=t.Python.valueToCode(e,"ADD"+s,t.Python.ORDER_NONE)||"''";return e=t.Python.variableDB_.getDistinctName("x",t.VARIABLE_CATEGORY_NAME),e="''.join([str("+e+") for "+e+" in ["+i.join(", ")+"]])",[e,t.Python.ORDER_FUNCTION_CALL]}},t.Python.text_append=function(e){var i=t.Python.variableDB_.getName(e.getFieldValue("VAR"),t.VARIABLE_CATEGORY_NAME);return e=t.Python.valueToCode(e,"TEXT",t.Python.ORDER_NONE)||"''",i+" = str("+i+") + "+t.Python.text.forceString_(e)[0]+`
`},t.Python.text_length=function(e){return["len("+(t.Python.valueToCode(e,"VALUE",t.Python.ORDER_NONE)||"''")+")",t.Python.ORDER_FUNCTION_CALL]},t.Python.text_isEmpty=function(e){return["not len("+(t.Python.valueToCode(e,"VALUE",t.Python.ORDER_NONE)||"''")+")",t.Python.ORDER_LOGICAL_NOT]},t.Python.text_indexOf=function(e){var i=e.getFieldValue("END")=="FIRST"?"find":"rfind",s=t.Python.valueToCode(e,"FIND",t.Python.ORDER_NONE)||"''";return i=(t.Python.valueToCode(e,"VALUE",t.Python.ORDER_MEMBER)||"''")+"."+i+"("+s+")",e.workspace.options.oneBasedIndex?[i+" + 1",t.Python.ORDER_ADDITIVE]:[i,t.Python.ORDER_FUNCTION_CALL]},t.Python.text_charAt=function(e){var i=e.getFieldValue("WHERE")||"FROM_START",s=t.Python.valueToCode(e,"VALUE",i=="RANDOM"?t.Python.ORDER_NONE:t.Python.ORDER_MEMBER)||"''";switch(i){case"FIRST":return[s+"[0]",t.Python.ORDER_MEMBER];case"LAST":return[s+"[-1]",t.Python.ORDER_MEMBER];case"FROM_START":return e=t.Python.getAdjustedInt(e,"AT"),[s+"["+e+"]",t.Python.ORDER_MEMBER];case"FROM_END":return e=t.Python.getAdjustedInt(e,"AT",1,!0),[s+"["+e+"]",t.Python.ORDER_MEMBER];case"RANDOM":return t.Python.definitions_.import_random="import random",[t.Python.provideFunction_("text_random_letter",["def "+t.Python.FUNCTION_NAME_PLACEHOLDER_+"(text):","  x = int(random.random() * len(text))","  return text[x];"])+"("+s+")",t.Python.ORDER_FUNCTION_CALL]}throw Error("Unhandled option (text_charAt).")},t.Python.text_getSubstring=function(e){var i=e.getFieldValue("WHERE1"),s=e.getFieldValue("WHERE2"),r=t.Python.valueToCode(e,"STRING",t.Python.ORDER_MEMBER)||"''";switch(i){case"FROM_START":i=t.Python.getAdjustedInt(e,"AT1"),i=="0"&&(i="");break;case"FROM_END":i=t.Python.getAdjustedInt(e,"AT1",1,!0);break;case"FIRST":i="";break;default:throw Error("Unhandled option (text_getSubstring)")}switch(s){case"FROM_START":e=t.Python.getAdjustedInt(e,"AT2",1);break;case"FROM_END":e=t.Python.getAdjustedInt(e,"AT2",0,!0),t.isNumber(String(e))?e=="0"&&(e=""):(t.Python.definitions_.import_sys="import sys",e+=" or sys.maxsize");break;case"LAST":e="";break;default:throw Error("Unhandled option (text_getSubstring)")}return[r+"["+i+" : "+e+"]",t.Python.ORDER_MEMBER]},t.Python.text_changeCase=function(e){var i={UPPERCASE:".upper()",LOWERCASE:".lower()",TITLECASE:".title()"}[e.getFieldValue("CASE")];return[(t.Python.valueToCode(e,"TEXT",t.Python.ORDER_MEMBER)||"''")+i,t.Python.ORDER_FUNCTION_CALL]},t.Python.text_trim=function(e){var i={LEFT:".lstrip()",RIGHT:".rstrip()",BOTH:".strip()"}[e.getFieldValue("MODE")];return[(t.Python.valueToCode(e,"TEXT",t.Python.ORDER_MEMBER)||"''")+i,t.Python.ORDER_FUNCTION_CALL]},t.Python.text_print=function(e){return"print("+(t.Python.valueToCode(e,"TEXT",t.Python.ORDER_NONE)||"''")+`)
`},t.Python.text_prompt_ext=function(e){var i=t.Python.provideFunction_("text_prompt",["def "+t.Python.FUNCTION_NAME_PLACEHOLDER_+"(msg):","  try:","    return raw_input(msg)","  except NameError:","    return input(msg)"]),s=e.getField("TEXT")?t.Python.quote_(e.getFieldValue("TEXT")):t.Python.valueToCode(e,"TEXT",t.Python.ORDER_NONE)||"''";return i=i+"("+s+")",e.getFieldValue("TYPE")=="NUMBER"&&(i="float("+i+")"),[i,t.Python.ORDER_FUNCTION_CALL]},t.Python.text_prompt=t.Python.text_prompt_ext,t.Python.text_count=function(e){var i=t.Python.valueToCode(e,"TEXT",t.Python.ORDER_MEMBER)||"''";return e=t.Python.valueToCode(e,"SUB",t.Python.ORDER_NONE)||"''",[i+".count("+e+")",t.Python.ORDER_FUNCTION_CALL]},t.Python.text_replace=function(e){var i=t.Python.valueToCode(e,"TEXT",t.Python.ORDER_MEMBER)||"''",s=t.Python.valueToCode(e,"FROM",t.Python.ORDER_NONE)||"''";return e=t.Python.valueToCode(e,"TO",t.Python.ORDER_NONE)||"''",[i+".replace("+s+", "+e+")",t.Python.ORDER_MEMBER]},t.Python.text_reverse=function(e){return[(t.Python.valueToCode(e,"TEXT",t.Python.ORDER_MEMBER)||"''")+"[::-1]",t.Python.ORDER_MEMBER]},t.Python.variables={},t.Python.variables_get=function(e){return[t.Python.variableDB_.getName(e.getFieldValue("VAR"),t.VARIABLE_CATEGORY_NAME),t.Python.ORDER_ATOMIC]},t.Python.variables_set=function(e){var i=t.Python.valueToCode(e,"VALUE",t.Python.ORDER_NONE)||"0";return t.Python.variableDB_.getName(e.getFieldValue("VAR"),t.VARIABLE_CATEGORY_NAME)+" = "+i+`
`},t.Python.variablesDynamic={},t.Python.variables_get_dynamic=t.Python.variables_get,t.Python.variables_set_dynamic=t.Python.variables_set,t.Python})}(python_compressed$1)),python_compressed$1.exports}var python=python$1.exports,hasRequiredPython;function requirePython(){return hasRequiredPython||(hasRequiredPython=1,function(l,n){(function(t,e){l.exports=e(requireCoreBrowser(),requirePython_compressed())})(python,function(t,e){return t.Python=e,e})}(python$1)),python$1.exports}requirePython();var blockly$1={exports:{}},browser$1={exports:{}},en$1={exports:{}},en=en$1.exports,hasRequiredEn;function requireEn(){return hasRequiredEn||(hasRequiredEn=1,function(l,n){(function(t,e){l.exports=e(requireCoreBrowser())})(en,function(e){var e={};return e.Msg={},e.Msg.ADD_COMMENT="Add Comment",e.Msg.CANNOT_DELETE_VARIABLE_PROCEDURE="Can't delete the variable '%1' because it's part of the definition of the function '%2'",e.Msg.CHANGE_VALUE_TITLE="Change value:",e.Msg.CLEAN_UP="Clean up Blocks",e.Msg.COLLAPSED_WARNINGS_WARNING="Collapsed blocks contain warnings.",e.Msg.COLLAPSE_ALL="Collapse Blocks",e.Msg.COLLAPSE_BLOCK="Collapse Block",e.Msg.COLOUR_BLEND_COLOUR1="colour 1",e.Msg.COLOUR_BLEND_COLOUR2="colour 2",e.Msg.COLOUR_BLEND_HELPURL="https://meyerweb.com/eric/tools/color-blend/#:::rgbp",e.Msg.COLOUR_BLEND_RATIO="ratio",e.Msg.COLOUR_BLEND_TITLE="blend",e.Msg.COLOUR_BLEND_TOOLTIP="Blends two colours together with a given ratio (0.0 - 1.0).",e.Msg.COLOUR_PICKER_HELPURL="https://en.wikipedia.org/wiki/Color",e.Msg.COLOUR_PICKER_TOOLTIP="Choose a colour from the palette.",e.Msg.COLOUR_RANDOM_HELPURL="http://randomcolour.com",e.Msg.COLOUR_RANDOM_TITLE="random colour",e.Msg.COLOUR_RANDOM_TOOLTIP="Choose a colour at random.",e.Msg.COLOUR_RGB_BLUE="blue",e.Msg.COLOUR_RGB_GREEN="green",e.Msg.COLOUR_RGB_HELPURL="https://www.december.com/html/spec/colorpercompact.html",e.Msg.COLOUR_RGB_RED="red",e.Msg.COLOUR_RGB_TITLE="colour with",e.Msg.COLOUR_RGB_TOOLTIP="Create a colour with the specified amount of red, green, and blue. All values must be between 0 and 100.",e.Msg.CONTROLS_FLOW_STATEMENTS_HELPURL="https://github.com/google/blockly/wiki/Loops#loop-termination-blocks",e.Msg.CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK="break out of loop",e.Msg.CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE="continue with next iteration of loop",e.Msg.CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK="Break out of the containing loop.",e.Msg.CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE="Skip the rest of this loop, and continue with the next iteration.",e.Msg.CONTROLS_FLOW_STATEMENTS_WARNING="Warning: This block may only be used within a loop.",e.Msg.CONTROLS_FOREACH_HELPURL="https://github.com/google/blockly/wiki/Loops#for-each",e.Msg.CONTROLS_FOREACH_TITLE="for each item %1 in list %2",e.Msg.CONTROLS_FOREACH_TOOLTIP="For each item in a list, set the variable '%1' to the item, and then do some statements.",e.Msg.CONTROLS_FOR_HELPURL="https://github.com/google/blockly/wiki/Loops#count-with",e.Msg.CONTROLS_FOR_TITLE="count with %1 from %2 to %3 by %4",e.Msg.CONTROLS_FOR_TOOLTIP="Have the variable '%1' take on the values from the start number to the end number, counting by the specified interval, and do the specified blocks.",e.Msg.CONTROLS_IF_ELSEIF_TOOLTIP="Add a condition to the if block.",e.Msg.CONTROLS_IF_ELSE_TOOLTIP="Add a final, catch-all condition to the if block.",e.Msg.CONTROLS_IF_HELPURL="https://github.com/google/blockly/wiki/IfElse",e.Msg.CONTROLS_IF_IF_TOOLTIP="Add, remove, or reorder sections to reconfigure this if block.",e.Msg.CONTROLS_IF_MSG_ELSE="else",e.Msg.CONTROLS_IF_MSG_ELSEIF="else if",e.Msg.CONTROLS_IF_MSG_IF="if",e.Msg.CONTROLS_IF_TOOLTIP_1="If a value is true, then do some statements.",e.Msg.CONTROLS_IF_TOOLTIP_2="If a value is true, then do the first block of statements. Otherwise, do the second block of statements.",e.Msg.CONTROLS_IF_TOOLTIP_3="If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements.",e.Msg.CONTROLS_IF_TOOLTIP_4="If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements. If none of the values are true, do the last block of statements.",e.Msg.CONTROLS_REPEAT_HELPURL="https://en.wikipedia.org/wiki/For_loop",e.Msg.CONTROLS_REPEAT_INPUT_DO="do",e.Msg.CONTROLS_REPEAT_TITLE="repeat %1 times",e.Msg.CONTROLS_REPEAT_TOOLTIP="Do some statements several times.",e.Msg.CONTROLS_WHILEUNTIL_HELPURL="https://github.com/google/blockly/wiki/Loops#repeat",e.Msg.CONTROLS_WHILEUNTIL_OPERATOR_UNTIL="repeat until",e.Msg.CONTROLS_WHILEUNTIL_OPERATOR_WHILE="repeat while",e.Msg.CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL="While a value is false, then do some statements.",e.Msg.CONTROLS_WHILEUNTIL_TOOLTIP_WHILE="While a value is true, then do some statements.",e.Msg.DELETE_ALL_BLOCKS="Delete all %1 blocks?",e.Msg.DELETE_BLOCK="Delete Block",e.Msg.DELETE_VARIABLE="Delete the '%1' variable",e.Msg.DELETE_VARIABLE_CONFIRMATION="Delete %1 uses of the '%2' variable?",e.Msg.DELETE_X_BLOCKS="Delete %1 Blocks",e.Msg.DISABLE_BLOCK="Disable Block",e.Msg.DUPLICATE_BLOCK="Duplicate",e.Msg.DUPLICATE_COMMENT="Duplicate Comment",e.Msg.ENABLE_BLOCK="Enable Block",e.Msg.EXPAND_ALL="Expand Blocks",e.Msg.EXPAND_BLOCK="Expand Block",e.Msg.EXTERNAL_INPUTS="External Inputs",e.Msg.HELP="Help",e.Msg.INLINE_INPUTS="Inline Inputs",e.Msg.IOS_CANCEL="Cancel",e.Msg.IOS_ERROR="Error",e.Msg.IOS_OK="OK",e.Msg.IOS_PROCEDURES_ADD_INPUT="+ Add Input",e.Msg.IOS_PROCEDURES_ALLOW_STATEMENTS="Allow statements",e.Msg.IOS_PROCEDURES_DUPLICATE_INPUTS_ERROR="This function has duplicate inputs.",e.Msg.IOS_PROCEDURES_INPUTS="INPUTS",e.Msg.IOS_VARIABLES_ADD_BUTTON="Add",e.Msg.IOS_VARIABLES_ADD_VARIABLE="+ Add Variable",e.Msg.IOS_VARIABLES_DELETE_BUTTON="Delete",e.Msg.IOS_VARIABLES_EMPTY_NAME_ERROR="You can't use an empty variable name.",e.Msg.IOS_VARIABLES_RENAME_BUTTON="Rename",e.Msg.IOS_VARIABLES_VARIABLE_NAME="Variable name",e.Msg.LISTS_CREATE_EMPTY_HELPURL="https://github.com/google/blockly/wiki/Lists#create-empty-list",e.Msg.LISTS_CREATE_EMPTY_TITLE="create empty list",e.Msg.LISTS_CREATE_EMPTY_TOOLTIP="Returns a list, of length 0, containing no data records",e.Msg.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD="list",e.Msg.LISTS_CREATE_WITH_CONTAINER_TOOLTIP="Add, remove, or reorder sections to reconfigure this list block.",e.Msg.LISTS_CREATE_WITH_HELPURL="https://github.com/google/blockly/wiki/Lists#create-list-with",e.Msg.LISTS_CREATE_WITH_INPUT_WITH="create list with",e.Msg.LISTS_CREATE_WITH_ITEM_TOOLTIP="Add an item to the list.",e.Msg.LISTS_CREATE_WITH_TOOLTIP="Create a list with any number of items.",e.Msg.LISTS_GET_INDEX_FIRST="first",e.Msg.LISTS_GET_INDEX_FROM_END="# from end",e.Msg.LISTS_GET_INDEX_FROM_START="#",e.Msg.LISTS_GET_INDEX_GET="get",e.Msg.LISTS_GET_INDEX_GET_REMOVE="get and remove",e.Msg.LISTS_GET_INDEX_LAST="last",e.Msg.LISTS_GET_INDEX_RANDOM="random",e.Msg.LISTS_GET_INDEX_REMOVE="remove",e.Msg.LISTS_GET_INDEX_TAIL="",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FIRST="Returns the first item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FROM="Returns the item at the specified position in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_LAST="Returns the last item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_RANDOM="Returns a random item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST="Removes and returns the first item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM="Removes and returns the item at the specified position in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST="Removes and returns the last item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM="Removes and returns a random item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST="Removes the first item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM="Removes the item at the specified position in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST="Removes the last item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM="Removes a random item in a list.",e.Msg.LISTS_GET_SUBLIST_END_FROM_END="to # from end",e.Msg.LISTS_GET_SUBLIST_END_FROM_START="to #",e.Msg.LISTS_GET_SUBLIST_END_LAST="to last",e.Msg.LISTS_GET_SUBLIST_HELPURL="https://github.com/google/blockly/wiki/Lists#getting-a-sublist",e.Msg.LISTS_GET_SUBLIST_START_FIRST="get sub-list from first",e.Msg.LISTS_GET_SUBLIST_START_FROM_END="get sub-list from # from end",e.Msg.LISTS_GET_SUBLIST_START_FROM_START="get sub-list from #",e.Msg.LISTS_GET_SUBLIST_TAIL="",e.Msg.LISTS_GET_SUBLIST_TOOLTIP="Creates a copy of the specified portion of a list.",e.Msg.LISTS_INDEX_FROM_END_TOOLTIP="%1 is the last item.",e.Msg.LISTS_INDEX_FROM_START_TOOLTIP="%1 is the first item.",e.Msg.LISTS_INDEX_OF_FIRST="find first occurrence of item",e.Msg.LISTS_INDEX_OF_HELPURL="https://github.com/google/blockly/wiki/Lists#getting-items-from-a-list",e.Msg.LISTS_INDEX_OF_LAST="find last occurrence of item",e.Msg.LISTS_INDEX_OF_TOOLTIP="Returns the index of the first/last occurrence of the item in the list. Returns %1 if item is not found.",e.Msg.LISTS_INLIST="in list",e.Msg.LISTS_ISEMPTY_HELPURL="https://github.com/google/blockly/wiki/Lists#is-empty",e.Msg.LISTS_ISEMPTY_TITLE="%1 is empty",e.Msg.LISTS_ISEMPTY_TOOLTIP="Returns true if the list is empty.",e.Msg.LISTS_LENGTH_HELPURL="https://github.com/google/blockly/wiki/Lists#length-of",e.Msg.LISTS_LENGTH_TITLE="length of %1",e.Msg.LISTS_LENGTH_TOOLTIP="Returns the length of a list.",e.Msg.LISTS_REPEAT_HELPURL="https://github.com/google/blockly/wiki/Lists#create-list-with",e.Msg.LISTS_REPEAT_TITLE="create list with item %1 repeated %2 times",e.Msg.LISTS_REPEAT_TOOLTIP="Creates a list consisting of the given value repeated the specified number of times.",e.Msg.LISTS_REVERSE_HELPURL="https://github.com/google/blockly/wiki/Lists#reversing-a-list",e.Msg.LISTS_REVERSE_MESSAGE0="reverse %1",e.Msg.LISTS_REVERSE_TOOLTIP="Reverse a copy of a list.",e.Msg.LISTS_SET_INDEX_HELPURL="https://github.com/google/blockly/wiki/Lists#in-list--set",e.Msg.LISTS_SET_INDEX_INPUT_TO="as",e.Msg.LISTS_SET_INDEX_INSERT="insert at",e.Msg.LISTS_SET_INDEX_SET="set",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST="Inserts the item at the start of a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FROM="Inserts the item at the specified position in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_LAST="Append the item to the end of a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM="Inserts the item randomly in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FIRST="Sets the first item in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FROM="Sets the item at the specified position in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_LAST="Sets the last item in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_RANDOM="Sets a random item in a list.",e.Msg.LISTS_SORT_HELPURL="https://github.com/google/blockly/wiki/Lists#sorting-a-list",e.Msg.LISTS_SORT_ORDER_ASCENDING="ascending",e.Msg.LISTS_SORT_ORDER_DESCENDING="descending",e.Msg.LISTS_SORT_TITLE="sort %1 %2 %3",e.Msg.LISTS_SORT_TOOLTIP="Sort a copy of a list.",e.Msg.LISTS_SORT_TYPE_IGNORECASE="alphabetic, ignore case",e.Msg.LISTS_SORT_TYPE_NUMERIC="numeric",e.Msg.LISTS_SORT_TYPE_TEXT="alphabetic",e.Msg.LISTS_SPLIT_HELPURL="https://github.com/google/blockly/wiki/Lists#splitting-strings-and-joining-lists",e.Msg.LISTS_SPLIT_LIST_FROM_TEXT="make list from text",e.Msg.LISTS_SPLIT_TEXT_FROM_LIST="make text from list",e.Msg.LISTS_SPLIT_TOOLTIP_JOIN="Join a list of texts into one text, separated by a delimiter.",e.Msg.LISTS_SPLIT_TOOLTIP_SPLIT="Split text into a list of texts, breaking at each delimiter.",e.Msg.LISTS_SPLIT_WITH_DELIMITER="with delimiter",e.Msg.LOGIC_BOOLEAN_FALSE="false",e.Msg.LOGIC_BOOLEAN_HELPURL="https://github.com/google/blockly/wiki/Logic#values",e.Msg.LOGIC_BOOLEAN_TOOLTIP="Returns either true or false.",e.Msg.LOGIC_BOOLEAN_TRUE="true",e.Msg.LOGIC_COMPARE_HELPURL="https://en.wikipedia.org/wiki/Inequality_(mathematics)",e.Msg.LOGIC_COMPARE_TOOLTIP_EQ="Return true if both inputs equal each other.",e.Msg.LOGIC_COMPARE_TOOLTIP_GT="Return true if the first input is greater than the second input.",e.Msg.LOGIC_COMPARE_TOOLTIP_GTE="Return true if the first input is greater than or equal to the second input.",e.Msg.LOGIC_COMPARE_TOOLTIP_LT="Return true if the first input is smaller than the second input.",e.Msg.LOGIC_COMPARE_TOOLTIP_LTE="Return true if the first input is smaller than or equal to the second input.",e.Msg.LOGIC_COMPARE_TOOLTIP_NEQ="Return true if both inputs are not equal to each other.",e.Msg.LOGIC_NEGATE_HELPURL="https://github.com/google/blockly/wiki/Logic#not",e.Msg.LOGIC_NEGATE_TITLE="not %1",e.Msg.LOGIC_NEGATE_TOOLTIP="Returns true if the input is false. Returns false if the input is true.",e.Msg.LOGIC_NULL="null",e.Msg.LOGIC_NULL_HELPURL="https://en.wikipedia.org/wiki/Nullable_type",e.Msg.LOGIC_NULL_TOOLTIP="Returns null.",e.Msg.LOGIC_OPERATION_AND="and",e.Msg.LOGIC_OPERATION_HELPURL="https://github.com/google/blockly/wiki/Logic#logical-operations",e.Msg.LOGIC_OPERATION_OR="or",e.Msg.LOGIC_OPERATION_TOOLTIP_AND="Return true if both inputs are true.",e.Msg.LOGIC_OPERATION_TOOLTIP_OR="Return true if at least one of the inputs is true.",e.Msg.LOGIC_TERNARY_CONDITION="test",e.Msg.LOGIC_TERNARY_HELPURL="https://en.wikipedia.org/wiki/%3F:",e.Msg.LOGIC_TERNARY_IF_FALSE="if false",e.Msg.LOGIC_TERNARY_IF_TRUE="if true",e.Msg.LOGIC_TERNARY_TOOLTIP="Check the condition in 'test'. If the condition is true, returns the 'if true' value; otherwise returns the 'if false' value.",e.Msg.MATH_ADDITION_SYMBOL="+",e.Msg.MATH_ARITHMETIC_HELPURL="https://en.wikipedia.org/wiki/Arithmetic",e.Msg.MATH_ARITHMETIC_TOOLTIP_ADD="Return the sum of the two numbers.",e.Msg.MATH_ARITHMETIC_TOOLTIP_DIVIDE="Return the quotient of the two numbers.",e.Msg.MATH_ARITHMETIC_TOOLTIP_MINUS="Return the difference of the two numbers.",e.Msg.MATH_ARITHMETIC_TOOLTIP_MULTIPLY="Return the product of the two numbers.",e.Msg.MATH_ARITHMETIC_TOOLTIP_POWER="Return the first number raised to the power of the second number.",e.Msg.MATH_ATAN2_HELPURL="https://en.wikipedia.org/wiki/Atan2",e.Msg.MATH_ATAN2_TITLE="atan2 of X:%1 Y:%2",e.Msg.MATH_ATAN2_TOOLTIP="Return the arctangent of point (X, Y) in degrees from -180 to 180.",e.Msg.MATH_CHANGE_HELPURL="https://en.wikipedia.org/wiki/Programming_idiom#Incrementing_a_counter",e.Msg.MATH_CHANGE_TITLE="change %1 by %2",e.Msg.MATH_CHANGE_TOOLTIP="Add a number to variable '%1'.",e.Msg.MATH_CONSTANT_HELPURL="https://en.wikipedia.org/wiki/Mathematical_constant",e.Msg.MATH_CONSTANT_TOOLTIP="Return one of the common constants:  (3.141), e (2.718),  (1.618), sqrt(2) (1.414), sqrt() (0.707), or  (infinity).",e.Msg.MATH_CONSTRAIN_HELPURL="https://en.wikipedia.org/wiki/Clamping_(graphics)",e.Msg.MATH_CONSTRAIN_TITLE="constrain %1 low %2 high %3",e.Msg.MATH_CONSTRAIN_TOOLTIP="Constrain a number to be between the specified limits (inclusive).",e.Msg.MATH_DIVISION_SYMBOL="",e.Msg.MATH_IS_DIVISIBLE_BY="is divisible by",e.Msg.MATH_IS_EVEN="is even",e.Msg.MATH_IS_NEGATIVE="is negative",e.Msg.MATH_IS_ODD="is odd",e.Msg.MATH_IS_POSITIVE="is positive",e.Msg.MATH_IS_PRIME="is prime",e.Msg.MATH_IS_TOOLTIP="Check if a number is an even, odd, prime, whole, positive, negative, or if it is divisible by certain number. Returns true or false.",e.Msg.MATH_IS_WHOLE="is whole",e.Msg.MATH_MODULO_HELPURL="https://en.wikipedia.org/wiki/Modulo_operation",e.Msg.MATH_MODULO_TITLE="remainder of %1  %2",e.Msg.MATH_MODULO_TOOLTIP="Return the remainder from dividing the two numbers.",e.Msg.MATH_MULTIPLICATION_SYMBOL="",e.Msg.MATH_NUMBER_HELPURL="https://en.wikipedia.org/wiki/Number",e.Msg.MATH_NUMBER_TOOLTIP="A number.",e.Msg.MATH_ONLIST_HELPURL="",e.Msg.MATH_ONLIST_OPERATOR_AVERAGE="average of list",e.Msg.MATH_ONLIST_OPERATOR_MAX="max of list",e.Msg.MATH_ONLIST_OPERATOR_MEDIAN="median of list",e.Msg.MATH_ONLIST_OPERATOR_MIN="min of list",e.Msg.MATH_ONLIST_OPERATOR_MODE="modes of list",e.Msg.MATH_ONLIST_OPERATOR_RANDOM="random item of list",e.Msg.MATH_ONLIST_OPERATOR_STD_DEV="standard deviation of list",e.Msg.MATH_ONLIST_OPERATOR_SUM="sum of list",e.Msg.MATH_ONLIST_TOOLTIP_AVERAGE="Return the average (arithmetic mean) of the numeric values in the list.",e.Msg.MATH_ONLIST_TOOLTIP_MAX="Return the largest number in the list.",e.Msg.MATH_ONLIST_TOOLTIP_MEDIAN="Return the median number in the list.",e.Msg.MATH_ONLIST_TOOLTIP_MIN="Return the smallest number in the list.",e.Msg.MATH_ONLIST_TOOLTIP_MODE="Return a list of the most common item(s) in the list.",e.Msg.MATH_ONLIST_TOOLTIP_RANDOM="Return a random element from the list.",e.Msg.MATH_ONLIST_TOOLTIP_STD_DEV="Return the standard deviation of the list.",e.Msg.MATH_ONLIST_TOOLTIP_SUM="Return the sum of all the numbers in the list.",e.Msg.MATH_POWER_SYMBOL="^",e.Msg.MATH_RANDOM_FLOAT_HELPURL="https://en.wikipedia.org/wiki/Random_number_generation",e.Msg.MATH_RANDOM_FLOAT_TITLE_RANDOM="random fraction",e.Msg.MATH_RANDOM_FLOAT_TOOLTIP="Return a random fraction between 0.0 (inclusive) and 1.0 (exclusive).",e.Msg.MATH_RANDOM_INT_HELPURL="https://en.wikipedia.org/wiki/Random_number_generation",e.Msg.MATH_RANDOM_INT_TITLE="random integer from %1 to %2",e.Msg.MATH_RANDOM_INT_TOOLTIP="Return a random integer between the two specified limits, inclusive.",e.Msg.MATH_ROUND_HELPURL="https://en.wikipedia.org/wiki/Rounding",e.Msg.MATH_ROUND_OPERATOR_ROUND="round",e.Msg.MATH_ROUND_OPERATOR_ROUNDDOWN="round down",e.Msg.MATH_ROUND_OPERATOR_ROUNDUP="round up",e.Msg.MATH_ROUND_TOOLTIP="Round a number up or down.",e.Msg.MATH_SINGLE_HELPURL="https://en.wikipedia.org/wiki/Square_root",e.Msg.MATH_SINGLE_OP_ABSOLUTE="absolute",e.Msg.MATH_SINGLE_OP_ROOT="square root",e.Msg.MATH_SINGLE_TOOLTIP_ABS="Return the absolute value of a number.",e.Msg.MATH_SINGLE_TOOLTIP_EXP="Return e to the power of a number.",e.Msg.MATH_SINGLE_TOOLTIP_LN="Return the natural logarithm of a number.",e.Msg.MATH_SINGLE_TOOLTIP_LOG10="Return the base 10 logarithm of a number.",e.Msg.MATH_SINGLE_TOOLTIP_NEG="Return the negation of a number.",e.Msg.MATH_SINGLE_TOOLTIP_POW10="Return 10 to the power of a number.",e.Msg.MATH_SINGLE_TOOLTIP_ROOT="Return the square root of a number.",e.Msg.MATH_SUBTRACTION_SYMBOL="-",e.Msg.MATH_TRIG_ACOS="acos",e.Msg.MATH_TRIG_ASIN="asin",e.Msg.MATH_TRIG_ATAN="atan",e.Msg.MATH_TRIG_COS="cos",e.Msg.MATH_TRIG_HELPURL="https://en.wikipedia.org/wiki/Trigonometric_functions",e.Msg.MATH_TRIG_SIN="sin",e.Msg.MATH_TRIG_TAN="tan",e.Msg.MATH_TRIG_TOOLTIP_ACOS="Return the arccosine of a number.",e.Msg.MATH_TRIG_TOOLTIP_ASIN="Return the arcsine of a number.",e.Msg.MATH_TRIG_TOOLTIP_ATAN="Return the arctangent of a number.",e.Msg.MATH_TRIG_TOOLTIP_COS="Return the cosine of a degree (not radian).",e.Msg.MATH_TRIG_TOOLTIP_SIN="Return the sine of a degree (not radian).",e.Msg.MATH_TRIG_TOOLTIP_TAN="Return the tangent of a degree (not radian).",e.Msg.NEW_COLOUR_VARIABLE="Create colour variable...",e.Msg.NEW_NUMBER_VARIABLE="Create number variable...",e.Msg.NEW_STRING_VARIABLE="Create string variable...",e.Msg.NEW_VARIABLE="Create variable...",e.Msg.NEW_VARIABLE_TITLE="New variable name:",e.Msg.NEW_VARIABLE_TYPE_TITLE="New variable type:",e.Msg.ORDINAL_NUMBER_SUFFIX="",e.Msg.PROCEDURES_ALLOW_STATEMENTS="allow statements",e.Msg.PROCEDURES_BEFORE_PARAMS="with:",e.Msg.PROCEDURES_CALLNORETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",e.Msg.PROCEDURES_CALLNORETURN_TOOLTIP="Run the user-defined function '%1'.",e.Msg.PROCEDURES_CALLRETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",e.Msg.PROCEDURES_CALLRETURN_TOOLTIP="Run the user-defined function '%1' and use its output.",e.Msg.PROCEDURES_CALL_BEFORE_PARAMS="with:",e.Msg.PROCEDURES_CREATE_DO="Create '%1'",e.Msg.PROCEDURES_DEFNORETURN_COMMENT="Describe this function...",e.Msg.PROCEDURES_DEFNORETURN_DO="",e.Msg.PROCEDURES_DEFNORETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",e.Msg.PROCEDURES_DEFNORETURN_PROCEDURE="do something",e.Msg.PROCEDURES_DEFNORETURN_TITLE="to",e.Msg.PROCEDURES_DEFNORETURN_TOOLTIP="Creates a function with no output.",e.Msg.PROCEDURES_DEFRETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",e.Msg.PROCEDURES_DEFRETURN_RETURN="return",e.Msg.PROCEDURES_DEFRETURN_TOOLTIP="Creates a function with an output.",e.Msg.PROCEDURES_DEF_DUPLICATE_WARNING="Warning: This function has duplicate parameters.",e.Msg.PROCEDURES_HIGHLIGHT_DEF="Highlight function definition",e.Msg.PROCEDURES_IFRETURN_HELPURL="http://c2.com/cgi/wiki?GuardClause",e.Msg.PROCEDURES_IFRETURN_TOOLTIP="If a value is true, then return a second value.",e.Msg.PROCEDURES_IFRETURN_WARNING="Warning: This block may be used only within a function definition.",e.Msg.PROCEDURES_MUTATORARG_TITLE="input name:",e.Msg.PROCEDURES_MUTATORARG_TOOLTIP="Add an input to the function.",e.Msg.PROCEDURES_MUTATORCONTAINER_TITLE="inputs",e.Msg.PROCEDURES_MUTATORCONTAINER_TOOLTIP="Add, remove, or reorder inputs to this function.",e.Msg.REDO="Redo",e.Msg.REMOVE_COMMENT="Remove Comment",e.Msg.RENAME_VARIABLE="Rename variable...",e.Msg.RENAME_VARIABLE_TITLE="Rename all '%1' variables to:",e.Msg.TEXT_APPEND_HELPURL="https://github.com/google/blockly/wiki/Text#text-modification",e.Msg.TEXT_APPEND_TITLE="to %1 append text %2",e.Msg.TEXT_APPEND_TOOLTIP="Append some text to variable '%1'.",e.Msg.TEXT_CHANGECASE_HELPURL="https://github.com/google/blockly/wiki/Text#adjusting-text-case",e.Msg.TEXT_CHANGECASE_OPERATOR_LOWERCASE="to lower case",e.Msg.TEXT_CHANGECASE_OPERATOR_TITLECASE="to Title Case",e.Msg.TEXT_CHANGECASE_OPERATOR_UPPERCASE="to UPPER CASE",e.Msg.TEXT_CHANGECASE_TOOLTIP="Return a copy of the text in a different case.",e.Msg.TEXT_CHARAT_FIRST="get first letter",e.Msg.TEXT_CHARAT_FROM_END="get letter # from end",e.Msg.TEXT_CHARAT_FROM_START="get letter #",e.Msg.TEXT_CHARAT_HELPURL="https://github.com/google/blockly/wiki/Text#extracting-text",e.Msg.TEXT_CHARAT_LAST="get last letter",e.Msg.TEXT_CHARAT_RANDOM="get random letter",e.Msg.TEXT_CHARAT_TAIL="",e.Msg.TEXT_CHARAT_TITLE="in text %1 %2",e.Msg.TEXT_CHARAT_TOOLTIP="Returns the letter at the specified position.",e.Msg.TEXT_COUNT_HELPURL="https://github.com/google/blockly/wiki/Text#counting-substrings",e.Msg.TEXT_COUNT_MESSAGE0="count %1 in %2",e.Msg.TEXT_COUNT_TOOLTIP="Count how many times some text occurs within some other text.",e.Msg.TEXT_CREATE_JOIN_ITEM_TOOLTIP="Add an item to the text.",e.Msg.TEXT_CREATE_JOIN_TITLE_JOIN="join",e.Msg.TEXT_CREATE_JOIN_TOOLTIP="Add, remove, or reorder sections to reconfigure this text block.",e.Msg.TEXT_GET_SUBSTRING_END_FROM_END="to letter # from end",e.Msg.TEXT_GET_SUBSTRING_END_FROM_START="to letter #",e.Msg.TEXT_GET_SUBSTRING_END_LAST="to last letter",e.Msg.TEXT_GET_SUBSTRING_HELPURL="https://github.com/google/blockly/wiki/Text#extracting-a-region-of-text",e.Msg.TEXT_GET_SUBSTRING_INPUT_IN_TEXT="in text",e.Msg.TEXT_GET_SUBSTRING_START_FIRST="get substring from first letter",e.Msg.TEXT_GET_SUBSTRING_START_FROM_END="get substring from letter # from end",e.Msg.TEXT_GET_SUBSTRING_START_FROM_START="get substring from letter #",e.Msg.TEXT_GET_SUBSTRING_TAIL="",e.Msg.TEXT_GET_SUBSTRING_TOOLTIP="Returns a specified portion of the text.",e.Msg.TEXT_INDEXOF_HELPURL="https://github.com/google/blockly/wiki/Text#finding-text",e.Msg.TEXT_INDEXOF_OPERATOR_FIRST="find first occurrence of text",e.Msg.TEXT_INDEXOF_OPERATOR_LAST="find last occurrence of text",e.Msg.TEXT_INDEXOF_TITLE="in text %1 %2 %3",e.Msg.TEXT_INDEXOF_TOOLTIP="Returns the index of the first/last occurrence of the first text in the second text. Returns %1 if text is not found.",e.Msg.TEXT_ISEMPTY_HELPURL="https://github.com/google/blockly/wiki/Text#checking-for-empty-text",e.Msg.TEXT_ISEMPTY_TITLE="%1 is empty",e.Msg.TEXT_ISEMPTY_TOOLTIP="Returns true if the provided text is empty.",e.Msg.TEXT_JOIN_HELPURL="https://github.com/google/blockly/wiki/Text#text-creation",e.Msg.TEXT_JOIN_TITLE_CREATEWITH="create text with",e.Msg.TEXT_JOIN_TOOLTIP="Create a piece of text by joining together any number of items.",e.Msg.TEXT_LENGTH_HELPURL="https://github.com/google/blockly/wiki/Text#text-modification",e.Msg.TEXT_LENGTH_TITLE="length of %1",e.Msg.TEXT_LENGTH_TOOLTIP="Returns the number of letters (including spaces) in the provided text.",e.Msg.TEXT_PRINT_HELPURL="https://github.com/google/blockly/wiki/Text#printing-text",e.Msg.TEXT_PRINT_TITLE="print %1",e.Msg.TEXT_PRINT_TOOLTIP="Print the specified text, number or other value.",e.Msg.TEXT_PROMPT_HELPURL="https://github.com/google/blockly/wiki/Text#getting-input-from-the-user",e.Msg.TEXT_PROMPT_TOOLTIP_NUMBER="Prompt for user for a number.",e.Msg.TEXT_PROMPT_TOOLTIP_TEXT="Prompt for user for some text.",e.Msg.TEXT_PROMPT_TYPE_NUMBER="prompt for number with message",e.Msg.TEXT_PROMPT_TYPE_TEXT="prompt for text with message",e.Msg.TEXT_REPLACE_HELPURL="https://github.com/google/blockly/wiki/Text#replacing-substrings",e.Msg.TEXT_REPLACE_MESSAGE0="replace %1 with %2 in %3",e.Msg.TEXT_REPLACE_TOOLTIP="Replace all occurances of some text within some other text.",e.Msg.TEXT_REVERSE_HELPURL="https://github.com/google/blockly/wiki/Text#reversing-text",e.Msg.TEXT_REVERSE_MESSAGE0="reverse %1",e.Msg.TEXT_REVERSE_TOOLTIP="Reverses the order of the characters in the text.",e.Msg.TEXT_TEXT_HELPURL="https://en.wikipedia.org/wiki/String_(computer_science)",e.Msg.TEXT_TEXT_TOOLTIP="A letter, word, or line of text.",e.Msg.TEXT_TRIM_HELPURL="https://github.com/google/blockly/wiki/Text#trimming-removing-spaces",e.Msg.TEXT_TRIM_OPERATOR_BOTH="trim spaces from both sides of",e.Msg.TEXT_TRIM_OPERATOR_LEFT="trim spaces from left side of",e.Msg.TEXT_TRIM_OPERATOR_RIGHT="trim spaces from right side of",e.Msg.TEXT_TRIM_TOOLTIP="Return a copy of the text with spaces removed from one or both ends.",e.Msg.TODAY="Today",e.Msg.UNDO="Undo",e.Msg.UNNAMED_KEY="unnamed",e.Msg.VARIABLES_DEFAULT_NAME="item",e.Msg.VARIABLES_GET_CREATE_SET="Create 'set %1'",e.Msg.VARIABLES_GET_HELPURL="https://github.com/google/blockly/wiki/Variables#get",e.Msg.VARIABLES_GET_TOOLTIP="Returns the value of this variable.",e.Msg.VARIABLES_SET="set %1 to %2",e.Msg.VARIABLES_SET_CREATE_GET="Create 'get %1'",e.Msg.VARIABLES_SET_HELPURL="https://github.com/google/blockly/wiki/Variables#set",e.Msg.VARIABLES_SET_TOOLTIP="Sets this variable to be equal to the input.",e.Msg.VARIABLE_ALREADY_EXISTS="A variable named '%1' already exists.",e.Msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE="A variable named '%1' already exists for another type: '%2'.",e.Msg.WORKSPACE_ARIA_LABEL="Blockly Workspace",e.Msg.WORKSPACE_COMMENT_DEFAULT_TEXT="Say something...",e.Msg.CONTROLS_FOREACH_INPUT_DO=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.CONTROLS_FOR_INPUT_DO=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.CONTROLS_IF_ELSEIF_TITLE_ELSEIF=e.Msg.CONTROLS_IF_MSG_ELSEIF,e.Msg.CONTROLS_IF_ELSE_TITLE_ELSE=e.Msg.CONTROLS_IF_MSG_ELSE,e.Msg.CONTROLS_IF_IF_TITLE_IF=e.Msg.CONTROLS_IF_MSG_IF,e.Msg.CONTROLS_IF_MSG_THEN=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.CONTROLS_WHILEUNTIL_INPUT_DO=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.LISTS_CREATE_WITH_ITEM_TITLE=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.LISTS_GET_INDEX_HELPURL=e.Msg.LISTS_INDEX_OF_HELPURL,e.Msg.LISTS_GET_INDEX_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.LISTS_GET_SUBLIST_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.LISTS_INDEX_OF_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.LISTS_SET_INDEX_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.MATH_CHANGE_TITLE_ITEM=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.PROCEDURES_DEFRETURN_COMMENT=e.Msg.PROCEDURES_DEFNORETURN_COMMENT,e.Msg.PROCEDURES_DEFRETURN_DO=e.Msg.PROCEDURES_DEFNORETURN_DO,e.Msg.PROCEDURES_DEFRETURN_PROCEDURE=e.Msg.PROCEDURES_DEFNORETURN_PROCEDURE,e.Msg.PROCEDURES_DEFRETURN_TITLE=e.Msg.PROCEDURES_DEFNORETURN_TITLE,e.Msg.TEXT_APPEND_VARIABLE=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.TEXT_CREATE_JOIN_ITEM_TITLE_ITEM=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.MATH_HUE="230",e.Msg.LOOPS_HUE="120",e.Msg.LISTS_HUE="260",e.Msg.LOGIC_HUE="210",e.Msg.VARIABLES_HUE="330",e.Msg.TEXTS_HUE="160",e.Msg.PROCEDURES_HUE="290",e.Msg.COLOUR_HUE="20",e.Msg.VARIABLES_DYNAMIC_HUE="310",e.Msg})}(en$1)),en$1.exports}var blocks$1={exports:{}},blocks_compressed$1={exports:{}},blocks_compressed=blocks_compressed$1.exports,hasRequiredBlocks_compressed;function requireBlocks_compressed(){return hasRequiredBlocks_compressed||(hasRequiredBlocks_compressed=1,function(l,n){(function(t,e){l.exports=e(requireBlockly_compressed())})(blocks_compressed,function(t){return t.Blocks.colour={},t.Constants={},t.Constants.Colour={},t.Constants.Colour.HUE=20,t.defineBlocksWithJsonArray([{type:"colour_picker",message0:"%1",args0:[{type:"field_colour",name:"COLOUR",colour:"#ff0000"}],output:"Colour",helpUrl:"%{BKY_COLOUR_PICKER_HELPURL}",style:"colour_blocks",tooltip:"%{BKY_COLOUR_PICKER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"colour_random",message0:"%{BKY_COLOUR_RANDOM_TITLE}",output:"Colour",helpUrl:"%{BKY_COLOUR_RANDOM_HELPURL}",style:"colour_blocks",tooltip:"%{BKY_COLOUR_RANDOM_TOOLTIP}"},{type:"colour_rgb",message0:"%{BKY_COLOUR_RGB_TITLE} %{BKY_COLOUR_RGB_RED} %1 %{BKY_COLOUR_RGB_GREEN} %2 %{BKY_COLOUR_RGB_BLUE} %3",args0:[{type:"input_value",name:"RED",check:"Number",align:"RIGHT"},{type:"input_value",name:"GREEN",check:"Number",align:"RIGHT"},{type:"input_value",name:"BLUE",check:"Number",align:"RIGHT"}],output:"Colour",helpUrl:"%{BKY_COLOUR_RGB_HELPURL}",style:"colour_blocks",tooltip:"%{BKY_COLOUR_RGB_TOOLTIP}"},{type:"colour_blend",message0:"%{BKY_COLOUR_BLEND_TITLE} %{BKY_COLOUR_BLEND_COLOUR1} %1 %{BKY_COLOUR_BLEND_COLOUR2} %2 %{BKY_COLOUR_BLEND_RATIO} %3",args0:[{type:"input_value",name:"COLOUR1",check:"Colour",align:"RIGHT"},{type:"input_value",name:"COLOUR2",check:"Colour",align:"RIGHT"},{type:"input_value",name:"RATIO",check:"Number",align:"RIGHT"}],output:"Colour",helpUrl:"%{BKY_COLOUR_BLEND_HELPURL}",style:"colour_blocks",tooltip:"%{BKY_COLOUR_BLEND_TOOLTIP}"}]),t.Blocks.lists={},t.Constants.Lists={},t.Constants.Lists.HUE=260,t.defineBlocksWithJsonArray([{type:"lists_create_empty",message0:"%{BKY_LISTS_CREATE_EMPTY_TITLE}",output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_CREATE_EMPTY_TOOLTIP}",helpUrl:"%{BKY_LISTS_CREATE_EMPTY_HELPURL}"},{type:"lists_repeat",message0:"%{BKY_LISTS_REPEAT_TITLE}",args0:[{type:"input_value",name:"ITEM"},{type:"input_value",name:"NUM",check:"Number"}],output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_LISTS_REPEAT_HELPURL}"},{type:"lists_reverse",message0:"%{BKY_LISTS_REVERSE_MESSAGE0}",args0:[{type:"input_value",name:"LIST",check:"Array"}],output:"Array",inputsInline:!0,style:"list_blocks",tooltip:"%{BKY_LISTS_REVERSE_TOOLTIP}",helpUrl:"%{BKY_LISTS_REVERSE_HELPURL}"},{type:"lists_isEmpty",message0:"%{BKY_LISTS_ISEMPTY_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Boolean",style:"list_blocks",tooltip:"%{BKY_LISTS_ISEMPTY_TOOLTIP}",helpUrl:"%{BKY_LISTS_ISEMPTY_HELPURL}"},{type:"lists_length",message0:"%{BKY_LISTS_LENGTH_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Number",style:"list_blocks",tooltip:"%{BKY_LISTS_LENGTH_TOOLTIP}",helpUrl:"%{BKY_LISTS_LENGTH_HELPURL}"}]),t.Blocks.lists_create_with={init:function(){this.setHelpUrl(t.Msg.LISTS_CREATE_WITH_HELPURL),this.setStyle("list_blocks"),this.itemCount_=3,this.updateShape_(),this.setOutput(!0,"Array"),this.setMutator(new t.Mutator(["lists_create_with_item"])),this.setTooltip(t.Msg.LISTS_CREATE_WITH_TOOLTIP)},mutationToDom:function(){var e=t.utils.xml.createElement("mutation");return e.setAttribute("items",this.itemCount_),e},domToMutation:function(e){this.itemCount_=parseInt(e.getAttribute("items"),10),this.updateShape_()},decompose:function(e){var i=e.newBlock("lists_create_with_container");i.initSvg();for(var s=i.getInput("STACK").connection,r=0;r<this.itemCount_;r++){var o=e.newBlock("lists_create_with_item");o.initSvg(),s.connect(o.previousConnection),s=o.nextConnection}return i},compose:function(e){var i=e.getInputTargetBlock("STACK");for(e=[];i&&!i.isInsertionMarker();)e.push(i.valueConnection_),i=i.nextConnection&&i.nextConnection.targetBlock();for(i=0;i<this.itemCount_;i++){var s=this.getInput("ADD"+i).connection.targetConnection;s&&e.indexOf(s)==-1&&s.disconnect()}for(this.itemCount_=e.length,this.updateShape_(),i=0;i<this.itemCount_;i++)t.Mutator.reconnect(e[i],this,"ADD"+i)},saveConnections:function(e){e=e.getInputTargetBlock("STACK");for(var i=0;e;){var s=this.getInput("ADD"+i);e.valueConnection_=s&&s.connection.targetConnection,i++,e=e.nextConnection&&e.nextConnection.targetBlock()}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(t.Msg.LISTS_CREATE_EMPTY_TITLE);for(var e=0;e<this.itemCount_;e++)if(!this.getInput("ADD"+e)){var i=this.appendValueInput("ADD"+e).setAlign(t.ALIGN_RIGHT);e==0&&i.appendField(t.Msg.LISTS_CREATE_WITH_INPUT_WITH)}for(;this.getInput("ADD"+e);)this.removeInput("ADD"+e),e++}},t.Blocks.lists_create_with_container={init:function(){this.setStyle("list_blocks"),this.appendDummyInput().appendField(t.Msg.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD),this.appendStatementInput("STACK"),this.setTooltip(t.Msg.LISTS_CREATE_WITH_CONTAINER_TOOLTIP),this.contextMenu=!1}},t.Blocks.lists_create_with_item={init:function(){this.setStyle("list_blocks"),this.appendDummyInput().appendField(t.Msg.LISTS_CREATE_WITH_ITEM_TITLE),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(t.Msg.LISTS_CREATE_WITH_ITEM_TOOLTIP),this.contextMenu=!1}},t.Blocks.lists_indexOf={init:function(){var e=[[t.Msg.LISTS_INDEX_OF_FIRST,"FIRST"],[t.Msg.LISTS_INDEX_OF_LAST,"LAST"]];this.setHelpUrl(t.Msg.LISTS_INDEX_OF_HELPURL),this.setStyle("list_blocks"),this.setOutput(!0,"Number"),this.appendValueInput("VALUE").setCheck("Array").appendField(t.Msg.LISTS_INDEX_OF_INPUT_IN_LIST),this.appendValueInput("FIND").appendField(new t.FieldDropdown(e),"END"),this.setInputsInline(!0);var i=this;this.setTooltip(function(){return t.Msg.LISTS_INDEX_OF_TOOLTIP.replace("%1",i.workspace.options.oneBasedIndex?"0":"-1")})}},t.Blocks.lists_getIndex={init:function(){var e=[[t.Msg.LISTS_GET_INDEX_GET,"GET"],[t.Msg.LISTS_GET_INDEX_GET_REMOVE,"GET_REMOVE"],[t.Msg.LISTS_GET_INDEX_REMOVE,"REMOVE"]];this.WHERE_OPTIONS=[[t.Msg.LISTS_GET_INDEX_FROM_START,"FROM_START"],[t.Msg.LISTS_GET_INDEX_FROM_END,"FROM_END"],[t.Msg.LISTS_GET_INDEX_FIRST,"FIRST"],[t.Msg.LISTS_GET_INDEX_LAST,"LAST"],[t.Msg.LISTS_GET_INDEX_RANDOM,"RANDOM"]],this.setHelpUrl(t.Msg.LISTS_GET_INDEX_HELPURL),this.setStyle("list_blocks"),e=new t.FieldDropdown(e,function(s){s=s=="REMOVE",this.getSourceBlock().updateStatement_(s)}),this.appendValueInput("VALUE").setCheck("Array").appendField(t.Msg.LISTS_GET_INDEX_INPUT_IN_LIST),this.appendDummyInput().appendField(e,"MODE").appendField("","SPACE"),this.appendDummyInput("AT"),t.Msg.LISTS_GET_INDEX_TAIL&&this.appendDummyInput("TAIL").appendField(t.Msg.LISTS_GET_INDEX_TAIL),this.setInputsInline(!0),this.setOutput(!0),this.updateAt_(!0);var i=this;this.setTooltip(function(){var s=i.getFieldValue("MODE"),r=i.getFieldValue("WHERE"),o="";switch(s+" "+r){case"GET FROM_START":case"GET FROM_END":o=t.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FROM;break;case"GET FIRST":o=t.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FIRST;break;case"GET LAST":o=t.Msg.LISTS_GET_INDEX_TOOLTIP_GET_LAST;break;case"GET RANDOM":o=t.Msg.LISTS_GET_INDEX_TOOLTIP_GET_RANDOM;break;case"GET_REMOVE FROM_START":case"GET_REMOVE FROM_END":o=t.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM;break;case"GET_REMOVE FIRST":o=t.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST;break;case"GET_REMOVE LAST":o=t.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST;break;case"GET_REMOVE RANDOM":o=t.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM;break;case"REMOVE FROM_START":case"REMOVE FROM_END":o=t.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM;break;case"REMOVE FIRST":o=t.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST;break;case"REMOVE LAST":o=t.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST;break;case"REMOVE RANDOM":o=t.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM}return(r=="FROM_START"||r=="FROM_END")&&(o+="  "+(r=="FROM_START"?t.Msg.LISTS_INDEX_FROM_START_TOOLTIP:t.Msg.LISTS_INDEX_FROM_END_TOOLTIP).replace("%1",i.workspace.options.oneBasedIndex?"#1":"#0")),o})},mutationToDom:function(){var e=t.utils.xml.createElement("mutation");e.setAttribute("statement",!this.outputConnection);var i=this.getInput("AT").type==t.INPUT_VALUE;return e.setAttribute("at",i),e},domToMutation:function(e){var i=e.getAttribute("statement")=="true";this.updateStatement_(i),e=e.getAttribute("at")!="false",this.updateAt_(e)},updateStatement_:function(e){e!=!this.outputConnection&&(this.unplug(!0,!0),e?(this.setOutput(!1),this.setPreviousStatement(!0),this.setNextStatement(!0)):(this.setPreviousStatement(!1),this.setNextStatement(!1),this.setOutput(!0)))},updateAt_:function(e){this.removeInput("AT"),this.removeInput("ORDINAL",!0),e?(this.appendValueInput("AT").setCheck("Number"),t.Msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(t.Msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT");var i=new t.FieldDropdown(this.WHERE_OPTIONS,function(s){var r=s=="FROM_START"||s=="FROM_END";if(r!=e){var o=this.getSourceBlock();return o.updateAt_(r),o.setFieldValue(s,"WHERE"),null}});this.getInput("AT").appendField(i,"WHERE"),t.Msg.LISTS_GET_INDEX_TAIL&&this.moveInputBefore("TAIL",null)}},t.Blocks.lists_setIndex={init:function(){var e=[[t.Msg.LISTS_SET_INDEX_SET,"SET"],[t.Msg.LISTS_SET_INDEX_INSERT,"INSERT"]];this.WHERE_OPTIONS=[[t.Msg.LISTS_GET_INDEX_FROM_START,"FROM_START"],[t.Msg.LISTS_GET_INDEX_FROM_END,"FROM_END"],[t.Msg.LISTS_GET_INDEX_FIRST,"FIRST"],[t.Msg.LISTS_GET_INDEX_LAST,"LAST"],[t.Msg.LISTS_GET_INDEX_RANDOM,"RANDOM"]],this.setHelpUrl(t.Msg.LISTS_SET_INDEX_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("LIST").setCheck("Array").appendField(t.Msg.LISTS_SET_INDEX_INPUT_IN_LIST),this.appendDummyInput().appendField(new t.FieldDropdown(e),"MODE").appendField("","SPACE"),this.appendDummyInput("AT"),this.appendValueInput("TO").appendField(t.Msg.LISTS_SET_INDEX_INPUT_TO),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(t.Msg.LISTS_SET_INDEX_TOOLTIP),this.updateAt_(!0);var i=this;this.setTooltip(function(){var s=i.getFieldValue("MODE"),r=i.getFieldValue("WHERE"),o="";switch(s+" "+r){case"SET FROM_START":case"SET FROM_END":o=t.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FROM;break;case"SET FIRST":o=t.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FIRST;break;case"SET LAST":o=t.Msg.LISTS_SET_INDEX_TOOLTIP_SET_LAST;break;case"SET RANDOM":o=t.Msg.LISTS_SET_INDEX_TOOLTIP_SET_RANDOM;break;case"INSERT FROM_START":case"INSERT FROM_END":o=t.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FROM;break;case"INSERT FIRST":o=t.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST;break;case"INSERT LAST":o=t.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_LAST;break;case"INSERT RANDOM":o=t.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM}return(r=="FROM_START"||r=="FROM_END")&&(o+="  "+t.Msg.LISTS_INDEX_FROM_START_TOOLTIP.replace("%1",i.workspace.options.oneBasedIndex?"#1":"#0")),o})},mutationToDom:function(){var e=t.utils.xml.createElement("mutation"),i=this.getInput("AT").type==t.INPUT_VALUE;return e.setAttribute("at",i),e},domToMutation:function(e){e=e.getAttribute("at")!="false",this.updateAt_(e)},updateAt_:function(e){this.removeInput("AT"),this.removeInput("ORDINAL",!0),e?(this.appendValueInput("AT").setCheck("Number"),t.Msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(t.Msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT");var i=new t.FieldDropdown(this.WHERE_OPTIONS,function(s){var r=s=="FROM_START"||s=="FROM_END";if(r!=e){var o=this.getSourceBlock();return o.updateAt_(r),o.setFieldValue(s,"WHERE"),null}});this.moveInputBefore("AT","TO"),this.getInput("ORDINAL")&&this.moveInputBefore("ORDINAL","TO"),this.getInput("AT").appendField(i,"WHERE")}},t.Blocks.lists_getSublist={init:function(){this.WHERE_OPTIONS_1=[[t.Msg.LISTS_GET_SUBLIST_START_FROM_START,"FROM_START"],[t.Msg.LISTS_GET_SUBLIST_START_FROM_END,"FROM_END"],[t.Msg.LISTS_GET_SUBLIST_START_FIRST,"FIRST"]],this.WHERE_OPTIONS_2=[[t.Msg.LISTS_GET_SUBLIST_END_FROM_START,"FROM_START"],[t.Msg.LISTS_GET_SUBLIST_END_FROM_END,"FROM_END"],[t.Msg.LISTS_GET_SUBLIST_END_LAST,"LAST"]],this.setHelpUrl(t.Msg.LISTS_GET_SUBLIST_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("LIST").setCheck("Array").appendField(t.Msg.LISTS_GET_SUBLIST_INPUT_IN_LIST),this.appendDummyInput("AT1"),this.appendDummyInput("AT2"),t.Msg.LISTS_GET_SUBLIST_TAIL&&this.appendDummyInput("TAIL").appendField(t.Msg.LISTS_GET_SUBLIST_TAIL),this.setInputsInline(!0),this.setOutput(!0,"Array"),this.updateAt_(1,!0),this.updateAt_(2,!0),this.setTooltip(t.Msg.LISTS_GET_SUBLIST_TOOLTIP)},mutationToDom:function(){var e=t.utils.xml.createElement("mutation"),i=this.getInput("AT1").type==t.INPUT_VALUE;return e.setAttribute("at1",i),i=this.getInput("AT2").type==t.INPUT_VALUE,e.setAttribute("at2",i),e},domToMutation:function(e){var i=e.getAttribute("at1")=="true";e=e.getAttribute("at2")=="true",this.updateAt_(1,i),this.updateAt_(2,e)},updateAt_:function(e,i){this.removeInput("AT"+e),this.removeInput("ORDINAL"+e,!0),i?(this.appendValueInput("AT"+e).setCheck("Number"),t.Msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL"+e).appendField(t.Msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"+e);var s=new t.FieldDropdown(this["WHERE_OPTIONS_"+e],function(r){var o=r=="FROM_START"||r=="FROM_END";if(o!=i){var h=this.getSourceBlock();return h.updateAt_(e,o),h.setFieldValue(r,"WHERE"+e),null}});this.getInput("AT"+e).appendField(s,"WHERE"+e),e==1&&(this.moveInputBefore("AT1","AT2"),this.getInput("ORDINAL1")&&this.moveInputBefore("ORDINAL1","AT2")),t.Msg.LISTS_GET_SUBLIST_TAIL&&this.moveInputBefore("TAIL",null)}},t.Blocks.lists_sort={init:function(){this.jsonInit({message0:t.Msg.LISTS_SORT_TITLE,args0:[{type:"field_dropdown",name:"TYPE",options:[[t.Msg.LISTS_SORT_TYPE_NUMERIC,"NUMERIC"],[t.Msg.LISTS_SORT_TYPE_TEXT,"TEXT"],[t.Msg.LISTS_SORT_TYPE_IGNORECASE,"IGNORE_CASE"]]},{type:"field_dropdown",name:"DIRECTION",options:[[t.Msg.LISTS_SORT_ORDER_ASCENDING,"1"],[t.Msg.LISTS_SORT_ORDER_DESCENDING,"-1"]]},{type:"input_value",name:"LIST",check:"Array"}],output:"Array",style:"list_blocks",tooltip:t.Msg.LISTS_SORT_TOOLTIP,helpUrl:t.Msg.LISTS_SORT_HELPURL})}},t.Blocks.lists_split={init:function(){var e=this,i=new t.FieldDropdown([[t.Msg.LISTS_SPLIT_LIST_FROM_TEXT,"SPLIT"],[t.Msg.LISTS_SPLIT_TEXT_FROM_LIST,"JOIN"]],function(s){e.updateType_(s)});this.setHelpUrl(t.Msg.LISTS_SPLIT_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("INPUT").setCheck("String").appendField(i,"MODE"),this.appendValueInput("DELIM").setCheck("String").appendField(t.Msg.LISTS_SPLIT_WITH_DELIMITER),this.setInputsInline(!0),this.setOutput(!0,"Array"),this.setTooltip(function(){var s=e.getFieldValue("MODE");if(s=="SPLIT")return t.Msg.LISTS_SPLIT_TOOLTIP_SPLIT;if(s=="JOIN")return t.Msg.LISTS_SPLIT_TOOLTIP_JOIN;throw Error("Unknown mode: "+s)})},updateType_:function(e){if(this.getFieldValue("MODE")!=e){var i=this.getInput("INPUT").connection;i.setShadowDom(null);var s=i.targetBlock();s&&(i.disconnect(),s.isShadow()?s.dispose():this.bumpNeighbours())}e=="SPLIT"?(this.outputConnection.setCheck("Array"),this.getInput("INPUT").setCheck("String")):(this.outputConnection.setCheck("String"),this.getInput("INPUT").setCheck("Array"))},mutationToDom:function(){var e=t.utils.xml.createElement("mutation");return e.setAttribute("mode",this.getFieldValue("MODE")),e},domToMutation:function(e){this.updateType_(e.getAttribute("mode"))}},t.Blocks.logic={},t.Constants.Logic={},t.Constants.Logic.HUE=210,t.defineBlocksWithJsonArray([{type:"logic_boolean",message0:"%1",args0:[{type:"field_dropdown",name:"BOOL",options:[["%{BKY_LOGIC_BOOLEAN_TRUE}","TRUE"],["%{BKY_LOGIC_BOOLEAN_FALSE}","FALSE"]]}],output:"Boolean",style:"logic_blocks",tooltip:"%{BKY_LOGIC_BOOLEAN_TOOLTIP}",helpUrl:"%{BKY_LOGIC_BOOLEAN_HELPURL}"},{type:"controls_if",message0:"%{BKY_CONTROLS_IF_MSG_IF} %1",args0:[{type:"input_value",name:"IF0",check:"Boolean"}],message1:"%{BKY_CONTROLS_IF_MSG_THEN} %1",args1:[{type:"input_statement",name:"DO0"}],previousStatement:null,nextStatement:null,style:"logic_blocks",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",mutator:"controls_if_mutator",extensions:["controls_if_tooltip"]},{type:"controls_ifelse",message0:"%{BKY_CONTROLS_IF_MSG_IF} %1",args0:[{type:"input_value",name:"IF0",check:"Boolean"}],message1:"%{BKY_CONTROLS_IF_MSG_THEN} %1",args1:[{type:"input_statement",name:"DO0"}],message2:"%{BKY_CONTROLS_IF_MSG_ELSE} %1",args2:[{type:"input_statement",name:"ELSE"}],previousStatement:null,nextStatement:null,style:"logic_blocks",tooltip:"%{BKYCONTROLS_IF_TOOLTIP_2}",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",extensions:["controls_if_tooltip"]},{type:"logic_compare",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A"},{type:"field_dropdown",name:"OP",options:[["=","EQ"],["","NEQ"],["<","LT"],["","LTE"],[">","GT"],["","GTE"]]},{type:"input_value",name:"B"}],inputsInline:!0,output:"Boolean",style:"logic_blocks",helpUrl:"%{BKY_LOGIC_COMPARE_HELPURL}",extensions:["logic_compare","logic_op_tooltip"]},{type:"logic_operation",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:"Boolean"},{type:"field_dropdown",name:"OP",options:[["%{BKY_LOGIC_OPERATION_AND}","AND"],["%{BKY_LOGIC_OPERATION_OR}","OR"]]},{type:"input_value",name:"B",check:"Boolean"}],inputsInline:!0,output:"Boolean",style:"logic_blocks",helpUrl:"%{BKY_LOGIC_OPERATION_HELPURL}",extensions:["logic_op_tooltip"]},{type:"logic_negate",message0:"%{BKY_LOGIC_NEGATE_TITLE}",args0:[{type:"input_value",name:"BOOL",check:"Boolean"}],output:"Boolean",style:"logic_blocks",tooltip:"%{BKY_LOGIC_NEGATE_TOOLTIP}",helpUrl:"%{BKY_LOGIC_NEGATE_HELPURL}"},{type:"logic_null",message0:"%{BKY_LOGIC_NULL}",output:null,style:"logic_blocks",tooltip:"%{BKY_LOGIC_NULL_TOOLTIP}",helpUrl:"%{BKY_LOGIC_NULL_HELPURL}"},{type:"logic_ternary",message0:"%{BKY_LOGIC_TERNARY_CONDITION} %1",args0:[{type:"input_value",name:"IF",check:"Boolean"}],message1:"%{BKY_LOGIC_TERNARY_IF_TRUE} %1",args1:[{type:"input_value",name:"THEN"}],message2:"%{BKY_LOGIC_TERNARY_IF_FALSE} %1",args2:[{type:"input_value",name:"ELSE"}],output:null,style:"logic_blocks",tooltip:"%{BKY_LOGIC_TERNARY_TOOLTIP}",helpUrl:"%{BKY_LOGIC_TERNARY_HELPURL}",extensions:["logic_ternary"]}]),t.defineBlocksWithJsonArray([{type:"controls_if_if",message0:"%{BKY_CONTROLS_IF_IF_TITLE_IF}",nextStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_IF_TOOLTIP}"},{type:"controls_if_elseif",message0:"%{BKY_CONTROLS_IF_ELSEIF_TITLE_ELSEIF}",previousStatement:null,nextStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_ELSEIF_TOOLTIP}"},{type:"controls_if_else",message0:"%{BKY_CONTROLS_IF_ELSE_TITLE_ELSE}",previousStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_ELSE_TOOLTIP}"}]),t.Constants.Logic.TOOLTIPS_BY_OP={EQ:"%{BKY_LOGIC_COMPARE_TOOLTIP_EQ}",NEQ:"%{BKY_LOGIC_COMPARE_TOOLTIP_NEQ}",LT:"%{BKY_LOGIC_COMPARE_TOOLTIP_LT}",LTE:"%{BKY_LOGIC_COMPARE_TOOLTIP_LTE}",GT:"%{BKY_LOGIC_COMPARE_TOOLTIP_GT}",GTE:"%{BKY_LOGIC_COMPARE_TOOLTIP_GTE}",AND:"%{BKY_LOGIC_OPERATION_TOOLTIP_AND}",OR:"%{BKY_LOGIC_OPERATION_TOOLTIP_OR}"},t.Extensions.register("logic_op_tooltip",t.Extensions.buildTooltipForDropdown("OP",t.Constants.Logic.TOOLTIPS_BY_OP)),t.Constants.Logic.CONTROLS_IF_MUTATOR_MIXIN={elseifCount_:0,elseCount_:0,suppressPrefixSuffix:!0,mutationToDom:function(){if(!this.elseifCount_&&!this.elseCount_)return null;var e=t.utils.xml.createElement("mutation");return this.elseifCount_&&e.setAttribute("elseif",this.elseifCount_),this.elseCount_&&e.setAttribute("else",1),e},domToMutation:function(e){this.elseifCount_=parseInt(e.getAttribute("elseif"),10)||0,this.elseCount_=parseInt(e.getAttribute("else"),10)||0,this.rebuildShape_()},decompose:function(e){var i=e.newBlock("controls_if_if");i.initSvg();for(var s=i.nextConnection,r=1;r<=this.elseifCount_;r++){var o=e.newBlock("controls_if_elseif");o.initSvg(),s.connect(o.previousConnection),s=o.nextConnection}return this.elseCount_&&(e=e.newBlock("controls_if_else"),e.initSvg(),s.connect(e.previousConnection)),i},compose:function(e){e=e.nextConnection.targetBlock(),this.elseCount_=this.elseifCount_=0;for(var i=[null],s=[null],r=null;e&&!e.isInsertionMarker();){switch(e.type){case"controls_if_elseif":this.elseifCount_++,i.push(e.valueConnection_),s.push(e.statementConnection_);break;case"controls_if_else":this.elseCount_++,r=e.statementConnection_;break;default:throw TypeError("Unknown block type: "+e.type)}e=e.nextConnection&&e.nextConnection.targetBlock()}this.updateShape_(),this.reconnectChildBlocks_(i,s,r)},saveConnections:function(e){e=e.nextConnection.targetBlock();for(var i=1;e;){switch(e.type){case"controls_if_elseif":var s=this.getInput("IF"+i),r=this.getInput("DO"+i);e.valueConnection_=s&&s.connection.targetConnection,e.statementConnection_=r&&r.connection.targetConnection,i++;break;case"controls_if_else":r=this.getInput("ELSE"),e.statementConnection_=r&&r.connection.targetConnection;break;default:throw TypeError("Unknown block type: "+e.type)}e=e.nextConnection&&e.nextConnection.targetBlock()}},rebuildShape_:function(){var e=[null],i=[null],s=null;this.getInput("ELSE")&&(s=this.getInput("ELSE").connection.targetConnection);for(var r=1;this.getInput("IF"+r);){var o=this.getInput("IF"+r),h=this.getInput("DO"+r);e.push(o.connection.targetConnection),i.push(h.connection.targetConnection),r++}this.updateShape_(),this.reconnectChildBlocks_(e,i,s)},updateShape_:function(){this.getInput("ELSE")&&this.removeInput("ELSE");for(var e=1;this.getInput("IF"+e);)this.removeInput("IF"+e),this.removeInput("DO"+e),e++;for(e=1;e<=this.elseifCount_;e++)this.appendValueInput("IF"+e).setCheck("Boolean").appendField(t.Msg.CONTROLS_IF_MSG_ELSEIF),this.appendStatementInput("DO"+e).appendField(t.Msg.CONTROLS_IF_MSG_THEN);this.elseCount_&&this.appendStatementInput("ELSE").appendField(t.Msg.CONTROLS_IF_MSG_ELSE)},reconnectChildBlocks_:function(e,i,s){for(var r=1;r<=this.elseifCount_;r++)t.Mutator.reconnect(e[r],this,"IF"+r),t.Mutator.reconnect(i[r],this,"DO"+r);t.Mutator.reconnect(s,this,"ELSE")}},t.Extensions.registerMutator("controls_if_mutator",t.Constants.Logic.CONTROLS_IF_MUTATOR_MIXIN,null,["controls_if_elseif","controls_if_else"]),t.Constants.Logic.CONTROLS_IF_TOOLTIP_EXTENSION=function(){this.setTooltip((function(){if(this.elseifCount_||this.elseCount_){if(!this.elseifCount_&&this.elseCount_)return t.Msg.CONTROLS_IF_TOOLTIP_2;if(this.elseifCount_&&!this.elseCount_)return t.Msg.CONTROLS_IF_TOOLTIP_3;if(this.elseifCount_&&this.elseCount_)return t.Msg.CONTROLS_IF_TOOLTIP_4}else return t.Msg.CONTROLS_IF_TOOLTIP_1;return""}).bind(this))},t.Extensions.register("controls_if_tooltip",t.Constants.Logic.CONTROLS_IF_TOOLTIP_EXTENSION),t.Constants.Logic.LOGIC_COMPARE_ONCHANGE_MIXIN={onchange:function(e){this.prevBlocks_||(this.prevBlocks_=[null,null]);var i=this.getInputTargetBlock("A"),s=this.getInputTargetBlock("B");i&&s&&!this.workspace.connectionChecker.doTypeChecks(i.outputConnection,s.outputConnection)&&(t.Events.setGroup(e.group),e=this.prevBlocks_[0],e!==i&&(i.unplug(),!e||e.isDisposed()||e.isShadow()||this.getInput("A").connection.connect(e.outputConnection)),i=this.prevBlocks_[1],i!==s&&(s.unplug(),!i||i.isDisposed()||i.isShadow()||this.getInput("B").connection.connect(i.outputConnection)),this.bumpNeighbours(),t.Events.setGroup(!1)),this.prevBlocks_[0]=this.getInputTargetBlock("A"),this.prevBlocks_[1]=this.getInputTargetBlock("B")}},t.Constants.Logic.LOGIC_COMPARE_EXTENSION=function(){this.mixin(t.Constants.Logic.LOGIC_COMPARE_ONCHANGE_MIXIN)},t.Extensions.register("logic_compare",t.Constants.Logic.LOGIC_COMPARE_EXTENSION),t.Constants.Logic.LOGIC_TERNARY_ONCHANGE_MIXIN={prevParentConnection_:null,onchange:function(e){var i=this.getInputTargetBlock("THEN"),s=this.getInputTargetBlock("ELSE"),r=this.outputConnection.targetConnection;if((i||s)&&r)for(var o=0;2>o;o++){var h=o==1?i:s;h&&!h.workspace.connectionChecker.doTypeChecks(h.outputConnection,r)&&(t.Events.setGroup(e.group),r===this.prevParentConnection_?(this.unplug(),r.getSourceBlock().bumpNeighbours()):(h.unplug(),h.bumpNeighbours()),t.Events.setGroup(!1))}this.prevParentConnection_=r}},t.Extensions.registerMixin("logic_ternary",t.Constants.Logic.LOGIC_TERNARY_ONCHANGE_MIXIN),t.Blocks.loops={},t.Constants.Loops={},t.Constants.Loops.HUE=120,t.defineBlocksWithJsonArray([{type:"controls_repeat_ext",message0:"%{BKY_CONTROLS_REPEAT_TITLE}",args0:[{type:"input_value",name:"TIMES",check:"Number"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",tooltip:"%{BKY_CONTROLS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_CONTROLS_REPEAT_HELPURL}"},{type:"controls_repeat",message0:"%{BKY_CONTROLS_REPEAT_TITLE}",args0:[{type:"field_number",name:"TIMES",value:10,min:0,precision:1}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",tooltip:"%{BKY_CONTROLS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_CONTROLS_REPEAT_HELPURL}"},{type:"controls_whileUntil",message0:"%1 %2",args0:[{type:"field_dropdown",name:"MODE",options:[["%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_WHILE}","WHILE"],["%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_UNTIL}","UNTIL"]]},{type:"input_value",name:"BOOL",check:"Boolean"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_WHILEUNTIL_HELPURL}",extensions:["controls_whileUntil_tooltip"]},{type:"controls_for",message0:"%{BKY_CONTROLS_FOR_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:null},{type:"input_value",name:"FROM",check:"Number",align:"RIGHT"},{type:"input_value",name:"TO",check:"Number",align:"RIGHT"},{type:"input_value",name:"BY",check:"Number",align:"RIGHT"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],inputsInline:!0,previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FOR_HELPURL}",extensions:["contextMenu_newGetVariableBlock","controls_for_tooltip"]},{type:"controls_forEach",message0:"%{BKY_CONTROLS_FOREACH_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:null},{type:"input_value",name:"LIST",check:"Array"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FOREACH_HELPURL}",extensions:["contextMenu_newGetVariableBlock","controls_forEach_tooltip"]},{type:"controls_flow_statements",message0:"%1",args0:[{type:"field_dropdown",name:"FLOW",options:[["%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK}","BREAK"],["%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE}","CONTINUE"]]}],previousStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FLOW_STATEMENTS_HELPURL}",extensions:["controls_flow_tooltip","controls_flow_in_loop_check"]}]),t.Constants.Loops.WHILE_UNTIL_TOOLTIPS={WHILE:"%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_WHILE}",UNTIL:"%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL}"},t.Extensions.register("controls_whileUntil_tooltip",t.Extensions.buildTooltipForDropdown("MODE",t.Constants.Loops.WHILE_UNTIL_TOOLTIPS)),t.Constants.Loops.BREAK_CONTINUE_TOOLTIPS={BREAK:"%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK}",CONTINUE:"%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE}"},t.Extensions.register("controls_flow_tooltip",t.Extensions.buildTooltipForDropdown("FLOW",t.Constants.Loops.BREAK_CONTINUE_TOOLTIPS)),t.Constants.Loops.CUSTOM_CONTEXT_MENU_CREATE_VARIABLES_GET_MIXIN={customContextMenu:function(e){if(!this.isInFlyout){var i=this.getField("VAR").getVariable(),s=i.name;if(!this.isCollapsed()&&s!=null){var r={enabled:!0};r.text=t.Msg.VARIABLES_SET_CREATE_GET.replace("%1",s),i=t.Variables.generateVariableFieldDom(i),s=t.utils.xml.createElement("block"),s.setAttribute("type","variables_get"),s.appendChild(i),r.callback=t.ContextMenu.callbackFactory(this,s),e.push(r)}}}},t.Extensions.registerMixin("contextMenu_newGetVariableBlock",t.Constants.Loops.CUSTOM_CONTEXT_MENU_CREATE_VARIABLES_GET_MIXIN),t.Extensions.register("controls_for_tooltip",t.Extensions.buildTooltipWithFieldText("%{BKY_CONTROLS_FOR_TOOLTIP}","VAR")),t.Extensions.register("controls_forEach_tooltip",t.Extensions.buildTooltipWithFieldText("%{BKY_CONTROLS_FOREACH_TOOLTIP}","VAR")),t.Constants.Loops.CONTROL_FLOW_IN_LOOP_CHECK_MIXIN={LOOP_TYPES:["controls_repeat","controls_repeat_ext","controls_forEach","controls_for","controls_whileUntil"],suppressPrefixSuffix:!0,getSurroundLoop:function(e){do{if(t.Constants.Loops.CONTROL_FLOW_IN_LOOP_CHECK_MIXIN.LOOP_TYPES.indexOf(e.type)!=-1)return e;e=e.getSurroundParent()}while(e);return null},onchange:function(e){if(this.workspace.isDragging&&!this.workspace.isDragging()&&e.type==t.Events.BLOCK_MOVE){var i=t.Constants.Loops.CONTROL_FLOW_IN_LOOP_CHECK_MIXIN.getSurroundLoop(this);if(this.setWarningText(i?null:t.Msg.CONTROLS_FLOW_STATEMENTS_WARNING),!this.isInFlyout){var s=t.Events.getGroup();t.Events.setGroup(e.group),this.setEnabled(i),t.Events.setGroup(s)}}}},t.Extensions.registerMixin("controls_flow_in_loop_check",t.Constants.Loops.CONTROL_FLOW_IN_LOOP_CHECK_MIXIN),t.Blocks.math={},t.Constants.Math={},t.Constants.Math.HUE=230,t.defineBlocksWithJsonArray([{type:"math_number",message0:"%1",args0:[{type:"field_number",name:"NUM",value:0}],output:"Number",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",style:"math_blocks",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_arithmetic",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:"Number"},{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ADDITION_SYMBOL}","ADD"],["%{BKY_MATH_SUBTRACTION_SYMBOL}","MINUS"],["%{BKY_MATH_MULTIPLICATION_SYMBOL}","MULTIPLY"],["%{BKY_MATH_DIVISION_SYMBOL}","DIVIDE"],["%{BKY_MATH_POWER_SYMBOL}","POWER"]]},{type:"input_value",name:"B",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ARITHMETIC_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_single",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_SINGLE_OP_ROOT}","ROOT"],["%{BKY_MATH_SINGLE_OP_ABSOLUTE}","ABS"],["-","NEG"],["ln","LN"],["log10","LOG10"],["e^","EXP"],["10^","POW10"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_SINGLE_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_trig",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_TRIG_SIN}","SIN"],["%{BKY_MATH_TRIG_COS}","COS"],["%{BKY_MATH_TRIG_TAN}","TAN"],["%{BKY_MATH_TRIG_ASIN}","ASIN"],["%{BKY_MATH_TRIG_ACOS}","ACOS"],["%{BKY_MATH_TRIG_ATAN}","ATAN"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_TRIG_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_constant",message0:"%1",args0:[{type:"field_dropdown",name:"CONSTANT",options:[["","PI"],["e","E"],["","GOLDEN_RATIO"],["sqrt(2)","SQRT2"],["sqrt()","SQRT1_2"],["","INFINITY"]]}],output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_CONSTANT_TOOLTIP}",helpUrl:"%{BKY_MATH_CONSTANT_HELPURL}"},{type:"math_number_property",message0:"%1 %2",args0:[{type:"input_value",name:"NUMBER_TO_CHECK",check:"Number"},{type:"field_dropdown",name:"PROPERTY",options:[["%{BKY_MATH_IS_EVEN}","EVEN"],["%{BKY_MATH_IS_ODD}","ODD"],["%{BKY_MATH_IS_PRIME}","PRIME"],["%{BKY_MATH_IS_WHOLE}","WHOLE"],["%{BKY_MATH_IS_POSITIVE}","POSITIVE"],["%{BKY_MATH_IS_NEGATIVE}","NEGATIVE"],["%{BKY_MATH_IS_DIVISIBLE_BY}","DIVISIBLE_BY"]]}],inputsInline:!0,output:"Boolean",style:"math_blocks",tooltip:"%{BKY_MATH_IS_TOOLTIP}",mutator:"math_is_divisibleby_mutator"},{type:"math_change",message0:"%{BKY_MATH_CHANGE_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_MATH_CHANGE_TITLE_ITEM}"},{type:"input_value",name:"DELTA",check:"Number"}],previousStatement:null,nextStatement:null,style:"variable_blocks",helpUrl:"%{BKY_MATH_CHANGE_HELPURL}",extensions:["math_change_tooltip"]},{type:"math_round",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ROUND_OPERATOR_ROUND}","ROUND"],["%{BKY_MATH_ROUND_OPERATOR_ROUNDUP}","ROUNDUP"],["%{BKY_MATH_ROUND_OPERATOR_ROUNDDOWN}","ROUNDDOWN"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ROUND_HELPURL}",tooltip:"%{BKY_MATH_ROUND_TOOLTIP}"},{type:"math_on_list",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ONLIST_OPERATOR_SUM}","SUM"],["%{BKY_MATH_ONLIST_OPERATOR_MIN}","MIN"],["%{BKY_MATH_ONLIST_OPERATOR_MAX}","MAX"],["%{BKY_MATH_ONLIST_OPERATOR_AVERAGE}","AVERAGE"],["%{BKY_MATH_ONLIST_OPERATOR_MEDIAN}","MEDIAN"],["%{BKY_MATH_ONLIST_OPERATOR_MODE}","MODE"],["%{BKY_MATH_ONLIST_OPERATOR_STD_DEV}","STD_DEV"],["%{BKY_MATH_ONLIST_OPERATOR_RANDOM}","RANDOM"]]},{type:"input_value",name:"LIST",check:"Array"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ONLIST_HELPURL}",mutator:"math_modes_of_list_mutator",extensions:["math_op_tooltip"]},{type:"math_modulo",message0:"%{BKY_MATH_MODULO_TITLE}",args0:[{type:"input_value",name:"DIVIDEND",check:"Number"},{type:"input_value",name:"DIVISOR",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_MODULO_TOOLTIP}",helpUrl:"%{BKY_MATH_MODULO_HELPURL}"},{type:"math_constrain",message0:"%{BKY_MATH_CONSTRAIN_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"Number"},{type:"input_value",name:"LOW",check:"Number"},{type:"input_value",name:"HIGH",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_CONSTRAIN_TOOLTIP}",helpUrl:"%{BKY_MATH_CONSTRAIN_HELPURL}"},{type:"math_random_int",message0:"%{BKY_MATH_RANDOM_INT_TITLE}",args0:[{type:"input_value",name:"FROM",check:"Number"},{type:"input_value",name:"TO",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_RANDOM_INT_TOOLTIP}",helpUrl:"%{BKY_MATH_RANDOM_INT_HELPURL}"},{type:"math_random_float",message0:"%{BKY_MATH_RANDOM_FLOAT_TITLE_RANDOM}",output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_RANDOM_FLOAT_TOOLTIP}",helpUrl:"%{BKY_MATH_RANDOM_FLOAT_HELPURL}"},{type:"math_atan2",message0:"%{BKY_MATH_ATAN2_TITLE}",args0:[{type:"input_value",name:"X",check:"Number"},{type:"input_value",name:"Y",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_ATAN2_TOOLTIP}",helpUrl:"%{BKY_MATH_ATAN2_HELPURL}"}]),t.Constants.Math.TOOLTIPS_BY_OP={ADD:"%{BKY_MATH_ARITHMETIC_TOOLTIP_ADD}",MINUS:"%{BKY_MATH_ARITHMETIC_TOOLTIP_MINUS}",MULTIPLY:"%{BKY_MATH_ARITHMETIC_TOOLTIP_MULTIPLY}",DIVIDE:"%{BKY_MATH_ARITHMETIC_TOOLTIP_DIVIDE}",POWER:"%{BKY_MATH_ARITHMETIC_TOOLTIP_POWER}",ROOT:"%{BKY_MATH_SINGLE_TOOLTIP_ROOT}",ABS:"%{BKY_MATH_SINGLE_TOOLTIP_ABS}",NEG:"%{BKY_MATH_SINGLE_TOOLTIP_NEG}",LN:"%{BKY_MATH_SINGLE_TOOLTIP_LN}",LOG10:"%{BKY_MATH_SINGLE_TOOLTIP_LOG10}",EXP:"%{BKY_MATH_SINGLE_TOOLTIP_EXP}",POW10:"%{BKY_MATH_SINGLE_TOOLTIP_POW10}",SIN:"%{BKY_MATH_TRIG_TOOLTIP_SIN}",COS:"%{BKY_MATH_TRIG_TOOLTIP_COS}",TAN:"%{BKY_MATH_TRIG_TOOLTIP_TAN}",ASIN:"%{BKY_MATH_TRIG_TOOLTIP_ASIN}",ACOS:"%{BKY_MATH_TRIG_TOOLTIP_ACOS}",ATAN:"%{BKY_MATH_TRIG_TOOLTIP_ATAN}",SUM:"%{BKY_MATH_ONLIST_TOOLTIP_SUM}",MIN:"%{BKY_MATH_ONLIST_TOOLTIP_MIN}",MAX:"%{BKY_MATH_ONLIST_TOOLTIP_MAX}",AVERAGE:"%{BKY_MATH_ONLIST_TOOLTIP_AVERAGE}",MEDIAN:"%{BKY_MATH_ONLIST_TOOLTIP_MEDIAN}",MODE:"%{BKY_MATH_ONLIST_TOOLTIP_MODE}",STD_DEV:"%{BKY_MATH_ONLIST_TOOLTIP_STD_DEV}",RANDOM:"%{BKY_MATH_ONLIST_TOOLTIP_RANDOM}"},t.Extensions.register("math_op_tooltip",t.Extensions.buildTooltipForDropdown("OP",t.Constants.Math.TOOLTIPS_BY_OP)),t.Constants.Math.IS_DIVISIBLEBY_MUTATOR_MIXIN={mutationToDom:function(){var e=t.utils.xml.createElement("mutation"),i=this.getFieldValue("PROPERTY")=="DIVISIBLE_BY";return e.setAttribute("divisor_input",i),e},domToMutation:function(e){e=e.getAttribute("divisor_input")=="true",this.updateShape_(e)},updateShape_:function(e){var i=this.getInput("DIVISOR");e?i||this.appendValueInput("DIVISOR").setCheck("Number"):i&&this.removeInput("DIVISOR")}},t.Constants.Math.IS_DIVISIBLE_MUTATOR_EXTENSION=function(){this.getField("PROPERTY").setValidator(function(e){e=e=="DIVISIBLE_BY",this.getSourceBlock().updateShape_(e)})},t.Extensions.registerMutator("math_is_divisibleby_mutator",t.Constants.Math.IS_DIVISIBLEBY_MUTATOR_MIXIN,t.Constants.Math.IS_DIVISIBLE_MUTATOR_EXTENSION),t.Extensions.register("math_change_tooltip",t.Extensions.buildTooltipWithFieldText("%{BKY_MATH_CHANGE_TOOLTIP}","VAR")),t.Constants.Math.LIST_MODES_MUTATOR_MIXIN={updateType_:function(e){e=="MODE"?this.outputConnection.setCheck("Array"):this.outputConnection.setCheck("Number")},mutationToDom:function(){var e=t.utils.xml.createElement("mutation");return e.setAttribute("op",this.getFieldValue("OP")),e},domToMutation:function(e){this.updateType_(e.getAttribute("op"))}},t.Constants.Math.LIST_MODES_MUTATOR_EXTENSION=function(){this.getField("OP").setValidator((function(e){this.updateType_(e)}).bind(this))},t.Extensions.registerMutator("math_modes_of_list_mutator",t.Constants.Math.LIST_MODES_MUTATOR_MIXIN,t.Constants.Math.LIST_MODES_MUTATOR_EXTENSION),t.Blocks.procedures={},t.Blocks.procedures_defnoreturn={init:function(){var e=t.Procedures.findLegalName("",this);e=new t.FieldTextInput(e,t.Procedures.rename),e.setSpellcheck(!1),this.appendDummyInput().appendField(t.Msg.PROCEDURES_DEFNORETURN_TITLE).appendField(e,"NAME").appendField("","PARAMS"),this.setMutator(new t.Mutator(["procedures_mutatorarg"])),(this.workspace.options.comments||this.workspace.options.parentWorkspace&&this.workspace.options.parentWorkspace.options.comments)&&t.Msg.PROCEDURES_DEFNORETURN_COMMENT&&this.setCommentText(t.Msg.PROCEDURES_DEFNORETURN_COMMENT),this.setStyle("procedure_blocks"),this.setTooltip(t.Msg.PROCEDURES_DEFNORETURN_TOOLTIP),this.setHelpUrl(t.Msg.PROCEDURES_DEFNORETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.setStatements_(!0),this.statementConnection_=null},setStatements_:function(e){this.hasStatements_!==e&&(e?(this.appendStatementInput("STACK").appendField(t.Msg.PROCEDURES_DEFNORETURN_DO),this.getInput("RETURN")&&this.moveInputBefore("STACK","RETURN")):this.removeInput("STACK",!0),this.hasStatements_=e)},updateParams_:function(){var e="";this.arguments_.length&&(e=t.Msg.PROCEDURES_BEFORE_PARAMS+" "+this.arguments_.join(", ")),t.Events.disable();try{this.setFieldValue(e,"PARAMS")}finally{t.Events.enable()}},mutationToDom:function(e){var i=t.utils.xml.createElement("mutation");e&&i.setAttribute("name",this.getFieldValue("NAME"));for(var s=0;s<this.argumentVarModels_.length;s++){var r=t.utils.xml.createElement("arg"),o=this.argumentVarModels_[s];r.setAttribute("name",o.name),r.setAttribute("varid",o.getId()),e&&this.paramIds_&&r.setAttribute("paramId",this.paramIds_[s]),i.appendChild(r)}return this.hasStatements_||i.setAttribute("statements","false"),i},domToMutation:function(e){this.arguments_=[],this.argumentVarModels_=[];for(var i=0,s;s=e.childNodes[i];i++)if(s.nodeName.toLowerCase()=="arg"){var r=s.getAttribute("name");s=s.getAttribute("varid")||s.getAttribute("varId"),this.arguments_.push(r),s=t.Variables.getOrCreateVariablePackage(this.workspace,s,r,""),s!=null?this.argumentVarModels_.push(s):console.log("Failed to create a variable with name "+r+", ignoring.")}this.updateParams_(),t.Procedures.mutateCallers(this),this.setStatements_(e.getAttribute("statements")!=="false")},decompose:function(e){var i=t.utils.xml.createElement("block");i.setAttribute("type","procedures_mutatorcontainer");var s=t.utils.xml.createElement("statement");s.setAttribute("name","STACK"),i.appendChild(s);for(var r=0;r<this.arguments_.length;r++){var o=t.utils.xml.createElement("block");o.setAttribute("type","procedures_mutatorarg");var h=t.utils.xml.createElement("field");h.setAttribute("name","NAME");var u=t.utils.xml.createTextNode(this.arguments_[r]);h.appendChild(u),o.appendChild(h),h=t.utils.xml.createElement("next"),o.appendChild(h),s.appendChild(o),s=h}return e=t.Xml.domToBlock(i,e),this.type=="procedures_defreturn"?e.setFieldValue(this.hasStatements_,"STATEMENTS"):e.removeInput("STATEMENT_INPUT"),t.Procedures.mutateCallers(this),e},compose:function(e){this.arguments_=[],this.paramIds_=[],this.argumentVarModels_=[];for(var i=e.getInputTargetBlock("STACK");i&&!i.isInsertionMarker();){var s=i.getFieldValue("NAME");this.arguments_.push(s),s=this.workspace.getVariable(s,""),this.argumentVarModels_.push(s),this.paramIds_.push(i.id),i=i.nextConnection&&i.nextConnection.targetBlock()}this.updateParams_(),t.Procedures.mutateCallers(this),e=e.getFieldValue("STATEMENTS"),e!==null&&(e=e=="TRUE",this.hasStatements_!=e)&&(e?(this.setStatements_(!0),t.Mutator.reconnect(this.statementConnection_,this,"STACK"),this.statementConnection_=null):(e=this.getInput("STACK").connection,(this.statementConnection_=e.targetConnection)&&(e=e.targetBlock(),e.unplug(),e.bumpNeighbours()),this.setStatements_(!1)))},getProcedureDef:function(){return[this.getFieldValue("NAME"),this.arguments_,!1]},getVars:function(){return this.arguments_},getVarModels:function(){return this.argumentVarModels_},renameVarById:function(e,i){var s=this.workspace.getVariableById(e);if(s.type==""){s=s.name,i=this.workspace.getVariableById(i);for(var r=!1,o=0;o<this.argumentVarModels_.length;o++)this.argumentVarModels_[o].getId()==e&&(this.arguments_[o]=i.name,this.argumentVarModels_[o]=i,r=!0);r&&(this.displayRenamedVar_(s,i.name),t.Procedures.mutateCallers(this))}},updateVarName:function(e){for(var i=e.name,s=!1,r=0;r<this.argumentVarModels_.length;r++)if(this.argumentVarModels_[r].getId()==e.getId()){var o=this.arguments_[r];this.arguments_[r]=i,s=!0}s&&(this.displayRenamedVar_(o,i),t.Procedures.mutateCallers(this))},displayRenamedVar_:function(e,i){if(this.updateParams_(),this.mutator&&this.mutator.isVisible())for(var s=this.mutator.workspace_.getAllBlocks(!1),r=0,o;o=s[r];r++)o.type=="procedures_mutatorarg"&&t.Names.equals(e,o.getFieldValue("NAME"))&&o.setFieldValue(i,"NAME")},customContextMenu:function(e){if(!this.isInFlyout){var i={enabled:!0},s=this.getFieldValue("NAME");i.text=t.Msg.PROCEDURES_CREATE_DO.replace("%1",s);var r=t.utils.xml.createElement("mutation");for(r.setAttribute("name",s),s=0;s<this.arguments_.length;s++){var o=t.utils.xml.createElement("arg");o.setAttribute("name",this.arguments_[s]),r.appendChild(o)}if(s=t.utils.xml.createElement("block"),s.setAttribute("type",this.callType_),s.appendChild(r),i.callback=t.ContextMenu.callbackFactory(this,s),e.push(i),!this.isCollapsed())for(s=0;s<this.argumentVarModels_.length;s++)i={enabled:!0},r=this.argumentVarModels_[s],i.text=t.Msg.VARIABLES_SET_CREATE_GET.replace("%1",r.name),r=t.Variables.generateVariableFieldDom(r),o=t.utils.xml.createElement("block"),o.setAttribute("type","variables_get"),o.appendChild(r),i.callback=t.ContextMenu.callbackFactory(this,o),e.push(i)}},callType_:"procedures_callnoreturn"},t.Blocks.procedures_defreturn={init:function(){var e=t.Procedures.findLegalName("",this);e=new t.FieldTextInput(e,t.Procedures.rename),e.setSpellcheck(!1),this.appendDummyInput().appendField(t.Msg.PROCEDURES_DEFRETURN_TITLE).appendField(e,"NAME").appendField("","PARAMS"),this.appendValueInput("RETURN").setAlign(t.ALIGN_RIGHT).appendField(t.Msg.PROCEDURES_DEFRETURN_RETURN),this.setMutator(new t.Mutator(["procedures_mutatorarg"])),(this.workspace.options.comments||this.workspace.options.parentWorkspace&&this.workspace.options.parentWorkspace.options.comments)&&t.Msg.PROCEDURES_DEFRETURN_COMMENT&&this.setCommentText(t.Msg.PROCEDURES_DEFRETURN_COMMENT),this.setStyle("procedure_blocks"),this.setTooltip(t.Msg.PROCEDURES_DEFRETURN_TOOLTIP),this.setHelpUrl(t.Msg.PROCEDURES_DEFRETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.setStatements_(!0),this.statementConnection_=null},setStatements_:t.Blocks.procedures_defnoreturn.setStatements_,updateParams_:t.Blocks.procedures_defnoreturn.updateParams_,mutationToDom:t.Blocks.procedures_defnoreturn.mutationToDom,domToMutation:t.Blocks.procedures_defnoreturn.domToMutation,decompose:t.Blocks.procedures_defnoreturn.decompose,compose:t.Blocks.procedures_defnoreturn.compose,getProcedureDef:function(){return[this.getFieldValue("NAME"),this.arguments_,!0]},getVars:t.Blocks.procedures_defnoreturn.getVars,getVarModels:t.Blocks.procedures_defnoreturn.getVarModels,renameVarById:t.Blocks.procedures_defnoreturn.renameVarById,updateVarName:t.Blocks.procedures_defnoreturn.updateVarName,displayRenamedVar_:t.Blocks.procedures_defnoreturn.displayRenamedVar_,customContextMenu:t.Blocks.procedures_defnoreturn.customContextMenu,callType_:"procedures_callreturn"},t.Blocks.procedures_mutatorcontainer={init:function(){this.appendDummyInput().appendField(t.Msg.PROCEDURES_MUTATORCONTAINER_TITLE),this.appendStatementInput("STACK"),this.appendDummyInput("STATEMENT_INPUT").appendField(t.Msg.PROCEDURES_ALLOW_STATEMENTS).appendField(new t.FieldCheckbox("TRUE"),"STATEMENTS"),this.setStyle("procedure_blocks"),this.setTooltip(t.Msg.PROCEDURES_MUTATORCONTAINER_TOOLTIP),this.contextMenu=!1}},t.Blocks.procedures_mutatorarg={init:function(){var e=new t.FieldTextInput(t.Procedures.DEFAULT_ARG,this.validator_);e.oldShowEditorFn_=e.showEditor_,e.showEditor_=function(){this.createdVariables_=[],this.oldShowEditorFn_()},this.appendDummyInput().appendField(t.Msg.PROCEDURES_MUTATORARG_TITLE).appendField(e,"NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setTooltip(t.Msg.PROCEDURES_MUTATORARG_TOOLTIP),this.contextMenu=!1,e.onFinishEditing_=this.deleteIntermediateVars_,e.createdVariables_=[],e.onFinishEditing_("x")},validator_:function(e){var i=this.getSourceBlock(),s=t.Mutator.findParentWs(i.workspace);if(e=e.replace(/[\s\xa0]+/g," ").replace(/^ | $/g,""),!e)return null;for(var r=(i.workspace.targetWorkspace||i.workspace).getAllBlocks(!1),o=e.toLowerCase(),h=0;h<r.length;h++)if(r[h].id!=this.getSourceBlock().id){var u=r[h].getFieldValue("NAME");if(u&&u.toLowerCase()==o)return null}return i.isInFlyout||((i=s.getVariable(e,""))&&i.name!=e&&s.renameVariableById(i.getId(),e),i||(i=s.createVariable(e,""))&&this.createdVariables_&&this.createdVariables_.push(i)),e},deleteIntermediateVars_:function(e){var i=t.Mutator.findParentWs(this.getSourceBlock().workspace);if(i)for(var s=0;s<this.createdVariables_.length;s++){var r=this.createdVariables_[s];r.name!=e&&i.deleteVariableById(r.getId())}}},t.Blocks.procedures_callnoreturn={init:function(){this.appendDummyInput("TOPROW").appendField("","NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setHelpUrl(t.Msg.PROCEDURES_CALLNORETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.quarkConnections_={},this.quarkIds_=null,this.previousEnabledState_=!0},getProcedureCall:function(){return this.getFieldValue("NAME")},renameProcedure:function(e,i){t.Names.equals(e,this.getProcedureCall())&&(this.setFieldValue(i,"NAME"),this.setTooltip((this.outputConnection?t.Msg.PROCEDURES_CALLRETURN_TOOLTIP:t.Msg.PROCEDURES_CALLNORETURN_TOOLTIP).replace("%1",i)))},setProcedureParameters_:function(e,i){var s=t.Procedures.getDefinition(this.getProcedureCall(),this.workspace),r=s&&s.mutator&&s.mutator.isVisible();if(r||(this.quarkConnections_={},this.quarkIds_=null),i)if(e.join(`
`)==this.arguments_.join(`
`))this.quarkIds_=i;else{if(i.length!=e.length)throw RangeError("paramNames and paramIds must be the same length.");this.setCollapsed(!1),this.quarkIds_||(this.quarkConnections_={},this.quarkIds_=[]),s=this.rendered,this.rendered=!1;for(var o=0;o<this.arguments_.length;o++){var h=this.getInput("ARG"+o);h&&(h=h.connection.targetConnection,this.quarkConnections_[this.quarkIds_[o]]=h,r&&h&&i.indexOf(this.quarkIds_[o])==-1&&(h.disconnect(),h.getSourceBlock().bumpNeighbours()))}for(this.arguments_=[].concat(e),this.argumentVarModels_=[],o=0;o<this.arguments_.length;o++)e=t.Variables.getOrCreateVariablePackage(this.workspace,null,this.arguments_[o],""),this.argumentVarModels_.push(e);if(this.updateShape_(),this.quarkIds_=i)for(o=0;o<this.arguments_.length;o++)i=this.quarkIds_[o],i in this.quarkConnections_&&(h=this.quarkConnections_[i],t.Mutator.reconnect(h,this,"ARG"+o)||delete this.quarkConnections_[i]);(this.rendered=s)&&this.render()}},updateShape_:function(){for(var e=0;e<this.arguments_.length;e++){var i=this.getField("ARGNAME"+e);if(i){t.Events.disable();try{i.setValue(this.arguments_[e])}finally{t.Events.enable()}}else i=new t.FieldLabel(this.arguments_[e]),this.appendValueInput("ARG"+e).setAlign(t.ALIGN_RIGHT).appendField(i,"ARGNAME"+e).init()}for(;this.getInput("ARG"+e);)this.removeInput("ARG"+e),e++;(e=this.getInput("TOPROW"))&&(this.arguments_.length?this.getField("WITH")||(e.appendField(t.Msg.PROCEDURES_CALL_BEFORE_PARAMS,"WITH"),e.init()):this.getField("WITH")&&e.removeField("WITH"))},mutationToDom:function(){var e=t.utils.xml.createElement("mutation");e.setAttribute("name",this.getProcedureCall());for(var i=0;i<this.arguments_.length;i++){var s=t.utils.xml.createElement("arg");s.setAttribute("name",this.arguments_[i]),e.appendChild(s)}return e},domToMutation:function(e){var i=e.getAttribute("name");this.renameProcedure(this.getProcedureCall(),i),i=[];for(var s=[],r=0,o;o=e.childNodes[r];r++)o.nodeName.toLowerCase()=="arg"&&(i.push(o.getAttribute("name")),s.push(o.getAttribute("paramId")));this.setProcedureParameters_(i,s)},getVars:function(){return this.arguments_},getVarModels:function(){return this.argumentVarModels_},onchange:function(e){if(this.workspace&&!this.workspace.isFlyout&&e.recordUndo)if(e.type==t.Events.BLOCK_CREATE&&e.ids.indexOf(this.id)!=-1){var i=this.getProcedureCall();if(i=t.Procedures.getDefinition(i,this.workspace),!i||i.type==this.defType_&&JSON.stringify(i.getVars())==JSON.stringify(this.arguments_)||(i=null),!i){t.Events.setGroup(e.group),e=t.utils.xml.createElement("xml"),i=t.utils.xml.createElement("block"),i.setAttribute("type",this.defType_);var s=this.getRelativeToSurfaceXY(),r=s.y+2*t.SNAP_RADIUS;i.setAttribute("x",s.x+t.SNAP_RADIUS*(this.RTL?-1:1)),i.setAttribute("y",r),s=this.mutationToDom(),i.appendChild(s),s=t.utils.xml.createElement("field"),s.setAttribute("name","NAME"),r=this.getProcedureCall(),r||(r=t.Procedures.findLegalName("",this),this.renameProcedure("",r)),s.appendChild(t.utils.xml.createTextNode(r)),i.appendChild(s),e.appendChild(i),t.Xml.domToWorkspace(e,this.workspace),t.Events.setGroup(!1)}}else e.type==t.Events.BLOCK_DELETE?(i=this.getProcedureCall(),i=t.Procedures.getDefinition(i,this.workspace),i||(t.Events.setGroup(e.group),this.dispose(!0),t.Events.setGroup(!1))):e.type==t.Events.CHANGE&&e.element=="disabled"&&(i=this.getProcedureCall(),(i=t.Procedures.getDefinition(i,this.workspace))&&i.id==e.blockId&&((i=t.Events.getGroup())&&console.log("Saw an existing group while responding to a definition change"),t.Events.setGroup(e.group),e.newValue?(this.previousEnabledState_=this.isEnabled(),this.setEnabled(!1)):this.setEnabled(this.previousEnabledState_),t.Events.setGroup(i)))},customContextMenu:function(e){if(this.workspace.isMovable()){var i={enabled:!0};i.text=t.Msg.PROCEDURES_HIGHLIGHT_DEF;var s=this.getProcedureCall(),r=this.workspace;i.callback=function(){var o=t.Procedures.getDefinition(s,r);o&&(r.centerOnBlock(o.id),o.select())},e.push(i)}},defType_:"procedures_defnoreturn"},t.Blocks.procedures_callreturn={init:function(){this.appendDummyInput("TOPROW").appendField("","NAME"),this.setOutput(!0),this.setStyle("procedure_blocks"),this.setHelpUrl(t.Msg.PROCEDURES_CALLRETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.quarkConnections_={},this.quarkIds_=null,this.previousEnabledState_=!0},getProcedureCall:t.Blocks.procedures_callnoreturn.getProcedureCall,renameProcedure:t.Blocks.procedures_callnoreturn.renameProcedure,setProcedureParameters_:t.Blocks.procedures_callnoreturn.setProcedureParameters_,updateShape_:t.Blocks.procedures_callnoreturn.updateShape_,mutationToDom:t.Blocks.procedures_callnoreturn.mutationToDom,domToMutation:t.Blocks.procedures_callnoreturn.domToMutation,getVars:t.Blocks.procedures_callnoreturn.getVars,getVarModels:t.Blocks.procedures_callnoreturn.getVarModels,onchange:t.Blocks.procedures_callnoreturn.onchange,customContextMenu:t.Blocks.procedures_callnoreturn.customContextMenu,defType_:"procedures_defreturn"},t.Blocks.procedures_ifreturn={init:function(){this.appendValueInput("CONDITION").setCheck("Boolean").appendField(t.Msg.CONTROLS_IF_MSG_IF),this.appendValueInput("VALUE").appendField(t.Msg.PROCEDURES_DEFRETURN_RETURN),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setTooltip(t.Msg.PROCEDURES_IFRETURN_TOOLTIP),this.setHelpUrl(t.Msg.PROCEDURES_IFRETURN_HELPURL),this.hasReturnValue_=!0},mutationToDom:function(){var e=t.utils.xml.createElement("mutation");return e.setAttribute("value",Number(this.hasReturnValue_)),e},domToMutation:function(e){this.hasReturnValue_=e.getAttribute("value")==1,this.hasReturnValue_||(this.removeInput("VALUE"),this.appendDummyInput("VALUE").appendField(t.Msg.PROCEDURES_DEFRETURN_RETURN))},onchange:function(e){if(this.workspace.isDragging&&!this.workspace.isDragging()){e=!1;var i=this;do{if(this.FUNCTION_TYPES.indexOf(i.type)!=-1){e=!0;break}i=i.getSurroundParent()}while(i);e?(i.type=="procedures_defnoreturn"&&this.hasReturnValue_?(this.removeInput("VALUE"),this.appendDummyInput("VALUE").appendField(t.Msg.PROCEDURES_DEFRETURN_RETURN),this.hasReturnValue_=!1):i.type!="procedures_defreturn"||this.hasReturnValue_||(this.removeInput("VALUE"),this.appendValueInput("VALUE").appendField(t.Msg.PROCEDURES_DEFRETURN_RETURN),this.hasReturnValue_=!0),this.setWarningText(null),this.isInFlyout||this.setEnabled(!0)):(this.setWarningText(t.Msg.PROCEDURES_IFRETURN_WARNING),this.isInFlyout||this.getInheritedDisabled()||this.setEnabled(!1))}},FUNCTION_TYPES:["procedures_defnoreturn","procedures_defreturn"]},t.Blocks.texts={},t.Constants.Text={},t.Constants.Text.HUE=160,t.defineBlocksWithJsonArray([{type:"text",message0:"%1",args0:[{type:"field_input",name:"TEXT",text:""}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_TEXT_HELPURL}",tooltip:"%{BKY_TEXT_TEXT_TOOLTIP}",extensions:["text_quotes","parent_tooltip_when_inline"]},{type:"text_multiline",message0:"%1 %2",args0:[{type:"field_image",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAARCAYAAADpPU2iAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAdhgAAHYYBXaITgQAAABh0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMS42/U4J6AAAAP1JREFUOE+Vks0KQUEYhjmRIja4ABtZ2dm5A3t3Ia6AUm7CylYuQRaUhZSlLZJiQbFAyRnPN33y01HOW08z8873zpwzM4F3GWOCruvGIE4/rLaV+Nq1hVGMBqzhqlxgCys4wJA65xnogMHsQ5lujnYHTejBBCK2mE4abjCgMGhNxHgDFWjDSG07kdfVa2pZMf4ZyMAdWmpZMfYOsLiDMYMjlMB+K613QISRhTnITnsYg5yUd0DETmEoMlkFOeIT/A58iyK5E18BuTBfgYXfwNJv4P9/oEBerLylOnRhygmGdPpTTBZAPkde61lbQe4moWUvYUZYLfUNftIY4zwA5X2Z9AYnQrEAAAAASUVORK5CYII=",width:12,height:17,alt:""},{type:"field_multilinetext",name:"TEXT",text:""}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_TEXT_HELPURL}",tooltip:"%{BKY_TEXT_TEXT_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"text_join",message0:"",output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_JOIN_HELPURL}",tooltip:"%{BKY_TEXT_JOIN_TOOLTIP}",mutator:"text_join_mutator"},{type:"text_create_join_container",message0:"%{BKY_TEXT_CREATE_JOIN_TITLE_JOIN} %1 %2",args0:[{type:"input_dummy"},{type:"input_statement",name:"STACK"}],style:"text_blocks",tooltip:"%{BKY_TEXT_CREATE_JOIN_TOOLTIP}",enableContextMenu:!1},{type:"text_create_join_item",message0:"%{BKY_TEXT_CREATE_JOIN_ITEM_TITLE_ITEM}",previousStatement:null,nextStatement:null,style:"text_blocks",tooltip:"%{BKY_TEXT_CREATE_JOIN_ITEM_TOOLTIP}",enableContextMenu:!1},{type:"text_append",message0:"%{BKY_TEXT_APPEND_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_TEXT_APPEND_VARIABLE}"},{type:"input_value",name:"TEXT"}],previousStatement:null,nextStatement:null,style:"text_blocks",extensions:["text_append_tooltip"]},{type:"text_length",message0:"%{BKY_TEXT_LENGTH_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Number",style:"text_blocks",tooltip:"%{BKY_TEXT_LENGTH_TOOLTIP}",helpUrl:"%{BKY_TEXT_LENGTH_HELPURL}"},{type:"text_isEmpty",message0:"%{BKY_TEXT_ISEMPTY_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Boolean",style:"text_blocks",tooltip:"%{BKY_TEXT_ISEMPTY_TOOLTIP}",helpUrl:"%{BKY_TEXT_ISEMPTY_HELPURL}"},{type:"text_indexOf",message0:"%{BKY_TEXT_INDEXOF_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"String"},{type:"field_dropdown",name:"END",options:[["%{BKY_TEXT_INDEXOF_OPERATOR_FIRST}","FIRST"],["%{BKY_TEXT_INDEXOF_OPERATOR_LAST}","LAST"]]},{type:"input_value",name:"FIND",check:"String"}],output:"Number",style:"text_blocks",helpUrl:"%{BKY_TEXT_INDEXOF_HELPURL}",inputsInline:!0,extensions:["text_indexOf_tooltip"]},{type:"text_charAt",message0:"%{BKY_TEXT_CHARAT_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"String"},{type:"field_dropdown",name:"WHERE",options:[["%{BKY_TEXT_CHARAT_FROM_START}","FROM_START"],["%{BKY_TEXT_CHARAT_FROM_END}","FROM_END"],["%{BKY_TEXT_CHARAT_FIRST}","FIRST"],["%{BKY_TEXT_CHARAT_LAST}","LAST"],["%{BKY_TEXT_CHARAT_RANDOM}","RANDOM"]]}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_CHARAT_HELPURL}",inputsInline:!0,mutator:"text_charAt_mutator"}]),t.Blocks.text_getSubstring={init:function(){this.WHERE_OPTIONS_1=[[t.Msg.TEXT_GET_SUBSTRING_START_FROM_START,"FROM_START"],[t.Msg.TEXT_GET_SUBSTRING_START_FROM_END,"FROM_END"],[t.Msg.TEXT_GET_SUBSTRING_START_FIRST,"FIRST"]],this.WHERE_OPTIONS_2=[[t.Msg.TEXT_GET_SUBSTRING_END_FROM_START,"FROM_START"],[t.Msg.TEXT_GET_SUBSTRING_END_FROM_END,"FROM_END"],[t.Msg.TEXT_GET_SUBSTRING_END_LAST,"LAST"]],this.setHelpUrl(t.Msg.TEXT_GET_SUBSTRING_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("STRING").setCheck("String").appendField(t.Msg.TEXT_GET_SUBSTRING_INPUT_IN_TEXT),this.appendDummyInput("AT1"),this.appendDummyInput("AT2"),t.Msg.TEXT_GET_SUBSTRING_TAIL&&this.appendDummyInput("TAIL").appendField(t.Msg.TEXT_GET_SUBSTRING_TAIL),this.setInputsInline(!0),this.setOutput(!0,"String"),this.updateAt_(1,!0),this.updateAt_(2,!0),this.setTooltip(t.Msg.TEXT_GET_SUBSTRING_TOOLTIP)},mutationToDom:function(){var e=t.utils.xml.createElement("mutation"),i=this.getInput("AT1").type==t.INPUT_VALUE;return e.setAttribute("at1",i),i=this.getInput("AT2").type==t.INPUT_VALUE,e.setAttribute("at2",i),e},domToMutation:function(e){var i=e.getAttribute("at1")=="true";e=e.getAttribute("at2")=="true",this.updateAt_(1,i),this.updateAt_(2,e)},updateAt_:function(e,i){this.removeInput("AT"+e),this.removeInput("ORDINAL"+e,!0),i?(this.appendValueInput("AT"+e).setCheck("Number"),t.Msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL"+e).appendField(t.Msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"+e),e==2&&t.Msg.TEXT_GET_SUBSTRING_TAIL&&(this.removeInput("TAIL",!0),this.appendDummyInput("TAIL").appendField(t.Msg.TEXT_GET_SUBSTRING_TAIL));var s=new t.FieldDropdown(this["WHERE_OPTIONS_"+e],function(r){var o=r=="FROM_START"||r=="FROM_END";if(o!=i){var h=this.getSourceBlock();return h.updateAt_(e,o),h.setFieldValue(r,"WHERE"+e),null}});this.getInput("AT"+e).appendField(s,"WHERE"+e),e==1&&(this.moveInputBefore("AT1","AT2"),this.getInput("ORDINAL1")&&this.moveInputBefore("ORDINAL1","AT2"))}},t.Blocks.text_changeCase={init:function(){var e=[[t.Msg.TEXT_CHANGECASE_OPERATOR_UPPERCASE,"UPPERCASE"],[t.Msg.TEXT_CHANGECASE_OPERATOR_LOWERCASE,"LOWERCASE"],[t.Msg.TEXT_CHANGECASE_OPERATOR_TITLECASE,"TITLECASE"]];this.setHelpUrl(t.Msg.TEXT_CHANGECASE_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("TEXT").setCheck("String").appendField(new t.FieldDropdown(e),"CASE"),this.setOutput(!0,"String"),this.setTooltip(t.Msg.TEXT_CHANGECASE_TOOLTIP)}},t.Blocks.text_trim={init:function(){var e=[[t.Msg.TEXT_TRIM_OPERATOR_BOTH,"BOTH"],[t.Msg.TEXT_TRIM_OPERATOR_LEFT,"LEFT"],[t.Msg.TEXT_TRIM_OPERATOR_RIGHT,"RIGHT"]];this.setHelpUrl(t.Msg.TEXT_TRIM_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("TEXT").setCheck("String").appendField(new t.FieldDropdown(e),"MODE"),this.setOutput(!0,"String"),this.setTooltip(t.Msg.TEXT_TRIM_TOOLTIP)}},t.Blocks.text_print={init:function(){this.jsonInit({message0:t.Msg.TEXT_PRINT_TITLE,args0:[{type:"input_value",name:"TEXT"}],previousStatement:null,nextStatement:null,style:"text_blocks",tooltip:t.Msg.TEXT_PRINT_TOOLTIP,helpUrl:t.Msg.TEXT_PRINT_HELPURL})}},t.Blocks.text_prompt_ext={init:function(){var e=[[t.Msg.TEXT_PROMPT_TYPE_TEXT,"TEXT"],[t.Msg.TEXT_PROMPT_TYPE_NUMBER,"NUMBER"]];this.setHelpUrl(t.Msg.TEXT_PROMPT_HELPURL),this.setStyle("text_blocks");var i=this;e=new t.FieldDropdown(e,function(s){i.updateType_(s)}),this.appendValueInput("TEXT").appendField(e,"TYPE"),this.setOutput(!0,"String"),this.setTooltip(function(){return i.getFieldValue("TYPE")=="TEXT"?t.Msg.TEXT_PROMPT_TOOLTIP_TEXT:t.Msg.TEXT_PROMPT_TOOLTIP_NUMBER})},updateType_:function(e){this.outputConnection.setCheck(e=="NUMBER"?"Number":"String")},mutationToDom:function(){var e=t.utils.xml.createElement("mutation");return e.setAttribute("type",this.getFieldValue("TYPE")),e},domToMutation:function(e){this.updateType_(e.getAttribute("type"))}},t.Blocks.text_prompt={init:function(){this.mixin(t.Constants.Text.QUOTE_IMAGE_MIXIN);var e=[[t.Msg.TEXT_PROMPT_TYPE_TEXT,"TEXT"],[t.Msg.TEXT_PROMPT_TYPE_NUMBER,"NUMBER"]],i=this;this.setHelpUrl(t.Msg.TEXT_PROMPT_HELPURL),this.setStyle("text_blocks"),e=new t.FieldDropdown(e,function(s){i.updateType_(s)}),this.appendDummyInput().appendField(e,"TYPE").appendField(this.newQuote_(!0)).appendField(new t.FieldTextInput(""),"TEXT").appendField(this.newQuote_(!1)),this.setOutput(!0,"String"),this.setTooltip(function(){return i.getFieldValue("TYPE")=="TEXT"?t.Msg.TEXT_PROMPT_TOOLTIP_TEXT:t.Msg.TEXT_PROMPT_TOOLTIP_NUMBER})},updateType_:t.Blocks.text_prompt_ext.updateType_,mutationToDom:t.Blocks.text_prompt_ext.mutationToDom,domToMutation:t.Blocks.text_prompt_ext.domToMutation},t.Blocks.text_count={init:function(){this.jsonInit({message0:t.Msg.TEXT_COUNT_MESSAGE0,args0:[{type:"input_value",name:"SUB",check:"String"},{type:"input_value",name:"TEXT",check:"String"}],output:"Number",inputsInline:!0,style:"text_blocks",tooltip:t.Msg.TEXT_COUNT_TOOLTIP,helpUrl:t.Msg.TEXT_COUNT_HELPURL})}},t.Blocks.text_replace={init:function(){this.jsonInit({message0:t.Msg.TEXT_REPLACE_MESSAGE0,args0:[{type:"input_value",name:"FROM",check:"String"},{type:"input_value",name:"TO",check:"String"},{type:"input_value",name:"TEXT",check:"String"}],output:"String",inputsInline:!0,style:"text_blocks",tooltip:t.Msg.TEXT_REPLACE_TOOLTIP,helpUrl:t.Msg.TEXT_REPLACE_HELPURL})}},t.Blocks.text_reverse={init:function(){this.jsonInit({message0:t.Msg.TEXT_REVERSE_MESSAGE0,args0:[{type:"input_value",name:"TEXT",check:"String"}],output:"String",inputsInline:!0,style:"text_blocks",tooltip:t.Msg.TEXT_REVERSE_TOOLTIP,helpUrl:t.Msg.TEXT_REVERSE_HELPURL})}},t.Constants.Text.QUOTE_IMAGE_MIXIN={QUOTE_IMAGE_LEFT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAn0lEQVQI1z3OMa5BURSF4f/cQhAKjUQhuQmFNwGJEUi0RKN5rU7FHKhpjEH3TEMtkdBSCY1EIv8r7nFX9e29V7EBAOvu7RPjwmWGH/VuF8CyN9/OAdvqIXYLvtRaNjx9mMTDyo+NjAN1HNcl9ZQ5oQMM3dgDUqDo1l8DzvwmtZN7mnD+PkmLa+4mhrxVA9fRowBWmVBhFy5gYEjKMfz9AylsaRRgGzvZAAAAAElFTkSuQmCC",QUOTE_IMAGE_RIGHT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAqUlEQVQI1z3KvUpCcRiA8ef9E4JNHhI0aFEacm1o0BsI0Slx8wa8gLauoDnoBhq7DcfWhggONDmJJgqCPA7neJ7p934EOOKOnM8Q7PDElo/4x4lFb2DmuUjcUzS3URnGib9qaPNbuXvBO3sGPHJDRG6fGVdMSeWDP2q99FQdFrz26Gu5Tq7dFMzUvbXy8KXeAj57cOklgA+u1B5AoslLtGIHQMaCVnwDnADZIFIrXsoXrgAAAABJRU5ErkJggg==",QUOTE_IMAGE_WIDTH:12,QUOTE_IMAGE_HEIGHT:12,quoteField_:function(e){for(var i=0,s;s=this.inputList[i];i++)for(var r=0,o;o=s.fieldRow[r];r++)if(e==o.name){s.insertFieldAt(r,this.newQuote_(!0)),s.insertFieldAt(r+2,this.newQuote_(!1));return}console.warn('field named "'+e+'" not found in '+this.toDevString())},newQuote_:function(e){return e=this.RTL?!e:e,new t.FieldImage(e?this.QUOTE_IMAGE_LEFT_DATAURI:this.QUOTE_IMAGE_RIGHT_DATAURI,this.QUOTE_IMAGE_WIDTH,this.QUOTE_IMAGE_HEIGHT,e?"":"")}},t.Constants.Text.TEXT_QUOTES_EXTENSION=function(){this.mixin(t.Constants.Text.QUOTE_IMAGE_MIXIN),this.quoteField_("TEXT")},t.Constants.Text.TEXT_JOIN_MUTATOR_MIXIN={mutationToDom:function(){var e=t.utils.xml.createElement("mutation");return e.setAttribute("items",this.itemCount_),e},domToMutation:function(e){this.itemCount_=parseInt(e.getAttribute("items"),10),this.updateShape_()},decompose:function(e){var i=e.newBlock("text_create_join_container");i.initSvg();for(var s=i.getInput("STACK").connection,r=0;r<this.itemCount_;r++){var o=e.newBlock("text_create_join_item");o.initSvg(),s.connect(o.previousConnection),s=o.nextConnection}return i},compose:function(e){var i=e.getInputTargetBlock("STACK");for(e=[];i&&!i.isInsertionMarker();)e.push(i.valueConnection_),i=i.nextConnection&&i.nextConnection.targetBlock();for(i=0;i<this.itemCount_;i++){var s=this.getInput("ADD"+i).connection.targetConnection;s&&e.indexOf(s)==-1&&s.disconnect()}for(this.itemCount_=e.length,this.updateShape_(),i=0;i<this.itemCount_;i++)t.Mutator.reconnect(e[i],this,"ADD"+i)},saveConnections:function(e){e=e.getInputTargetBlock("STACK");for(var i=0;e;){var s=this.getInput("ADD"+i);e.valueConnection_=s&&s.connection.targetConnection,i++,e=e.nextConnection&&e.nextConnection.targetBlock()}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(this.newQuote_(!0)).appendField(this.newQuote_(!1));for(var e=0;e<this.itemCount_;e++)if(!this.getInput("ADD"+e)){var i=this.appendValueInput("ADD"+e).setAlign(t.ALIGN_RIGHT);e==0&&i.appendField(t.Msg.TEXT_JOIN_TITLE_CREATEWITH)}for(;this.getInput("ADD"+e);)this.removeInput("ADD"+e),e++}},t.Constants.Text.TEXT_JOIN_EXTENSION=function(){this.mixin(t.Constants.Text.QUOTE_IMAGE_MIXIN),this.itemCount_=2,this.updateShape_(),this.setMutator(new t.Mutator(["text_create_join_item"]))},t.Extensions.register("text_append_tooltip",t.Extensions.buildTooltipWithFieldText("%{BKY_TEXT_APPEND_TOOLTIP}","VAR")),t.Constants.Text.TEXT_INDEXOF_TOOLTIP_EXTENSION=function(){var e=this;this.setTooltip(function(){return t.Msg.TEXT_INDEXOF_TOOLTIP.replace("%1",e.workspace.options.oneBasedIndex?"0":"-1")})},t.Constants.Text.TEXT_CHARAT_MUTATOR_MIXIN={mutationToDom:function(){var e=t.utils.xml.createElement("mutation");return e.setAttribute("at",!!this.isAt_),e},domToMutation:function(e){e=e.getAttribute("at")!="false",this.updateAt_(e)},updateAt_:function(e){this.removeInput("AT",!0),this.removeInput("ORDINAL",!0),e&&(this.appendValueInput("AT").setCheck("Number"),t.Msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(t.Msg.ORDINAL_NUMBER_SUFFIX)),t.Msg.TEXT_CHARAT_TAIL&&(this.removeInput("TAIL",!0),this.appendDummyInput("TAIL").appendField(t.Msg.TEXT_CHARAT_TAIL)),this.isAt_=e}},t.Constants.Text.TEXT_CHARAT_EXTENSION=function(){this.getField("WHERE").setValidator(function(i){i=i=="FROM_START"||i=="FROM_END",i!=this.isAt_&&this.getSourceBlock().updateAt_(i)}),this.updateAt_(!0);var e=this;this.setTooltip(function(){var i=e.getFieldValue("WHERE"),s=t.Msg.TEXT_CHARAT_TOOLTIP;return(i=="FROM_START"||i=="FROM_END")&&(i=i=="FROM_START"?t.Msg.LISTS_INDEX_FROM_START_TOOLTIP:t.Msg.LISTS_INDEX_FROM_END_TOOLTIP)&&(s+="  "+i.replace("%1",e.workspace.options.oneBasedIndex?"#1":"#0")),s})},t.Extensions.register("text_indexOf_tooltip",t.Constants.Text.TEXT_INDEXOF_TOOLTIP_EXTENSION),t.Extensions.register("text_quotes",t.Constants.Text.TEXT_QUOTES_EXTENSION),t.Extensions.registerMutator("text_join_mutator",t.Constants.Text.TEXT_JOIN_MUTATOR_MIXIN,t.Constants.Text.TEXT_JOIN_EXTENSION),t.Extensions.registerMutator("text_charAt_mutator",t.Constants.Text.TEXT_CHARAT_MUTATOR_MIXIN,t.Constants.Text.TEXT_CHARAT_EXTENSION),t.Blocks.variables={},t.Constants.Variables={},t.Constants.Variables.HUE=330,t.defineBlocksWithJsonArray([{type:"variables_get",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,style:"variable_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableSetterGetter"]},{type:"variables_set",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableSetterGetter"]}]),t.Constants.Variables.CUSTOM_CONTEXT_MENU_VARIABLE_GETTER_SETTER_MIXIN={customContextMenu:function(e){if(this.isInFlyout)(this.type=="variables_get"||this.type=="variables_get_reporter")&&(i={text:t.Msg.RENAME_VARIABLE,enabled:!0,callback:t.Constants.Variables.RENAME_OPTION_CALLBACK_FACTORY(this)},o=this.getField("VAR").getText(),r={text:t.Msg.DELETE_VARIABLE.replace("%1",o),enabled:!0,callback:t.Constants.Variables.DELETE_OPTION_CALLBACK_FACTORY(this)},e.unshift(i),e.unshift(r));else{if(this.type=="variables_get")var i="variables_set",s=t.Msg.VARIABLES_GET_CREATE_SET;else i="variables_get",s=t.Msg.VARIABLES_SET_CREATE_GET;var r={enabled:0<this.workspace.remainingCapacity()},o=this.getField("VAR").getText();r.text=s.replace("%1",o),s=t.utils.xml.createElement("field"),s.setAttribute("name","VAR"),s.appendChild(t.utils.xml.createTextNode(o)),o=t.utils.xml.createElement("block"),o.setAttribute("type",i),o.appendChild(s),r.callback=t.ContextMenu.callbackFactory(this,o),e.push(r)}}},t.Constants.Variables.RENAME_OPTION_CALLBACK_FACTORY=function(e){return function(){var i=e.workspace,s=e.getField("VAR").getVariable();t.Variables.renameVariable(i,s)}},t.Constants.Variables.DELETE_OPTION_CALLBACK_FACTORY=function(e){return function(){var i=e.workspace,s=e.getField("VAR").getVariable();i.deleteVariableById(s.getId()),i.refreshToolboxSelection()}},t.Extensions.registerMixin("contextMenu_variableSetterGetter",t.Constants.Variables.CUSTOM_CONTEXT_MENU_VARIABLE_GETTER_SETTER_MIXIN),t.Constants.VariablesDynamic={},t.Constants.VariablesDynamic.HUE=310,t.defineBlocksWithJsonArray([{type:"variables_get_dynamic",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,style:"variable_dynamic_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableDynamicSetterGetter"]},{type:"variables_set_dynamic",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_dynamic_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableDynamicSetterGetter"]}]),t.Constants.VariablesDynamic.CUSTOM_CONTEXT_MENU_VARIABLE_GETTER_SETTER_MIXIN={customContextMenu:function(e){if(this.isInFlyout)(this.type=="variables_get_dynamic"||this.type=="variables_get_reporter_dynamic")&&(i={text:t.Msg.RENAME_VARIABLE,enabled:!0,callback:t.Constants.Variables.RENAME_OPTION_CALLBACK_FACTORY(this)},h=this.getField("VAR").getText(),o={text:t.Msg.DELETE_VARIABLE.replace("%1",h),enabled:!0,callback:t.Constants.Variables.DELETE_OPTION_CALLBACK_FACTORY(this)},e.unshift(i),e.unshift(o));else{var i=this.getFieldValue("VAR"),s=this.workspace.getVariableById(i).type;if(this.type=="variables_get_dynamic"){i="variables_set_dynamic";var r=t.Msg.VARIABLES_GET_CREATE_SET}else i="variables_get_dynamic",r=t.Msg.VARIABLES_SET_CREATE_GET;var o={enabled:0<this.workspace.remainingCapacity()},h=this.getField("VAR").getText();o.text=r.replace("%1",h),r=t.utils.xml.createElement("field"),r.setAttribute("name","VAR"),r.setAttribute("variabletype",s),r.appendChild(t.utils.xml.createTextNode(h)),h=t.utils.xml.createElement("block"),h.setAttribute("type",i),h.appendChild(r),o.callback=t.ContextMenu.callbackFactory(this,h),e.push(o)}},onchange:function(e){e=this.getFieldValue("VAR"),e=t.Variables.getVariable(this.workspace,e),this.type=="variables_get_dynamic"?this.outputConnection.setCheck(e.type):this.getInput("VALUE").connection.setCheck(e.type)}},t.Constants.VariablesDynamic.RENAME_OPTION_CALLBACK_FACTORY=function(e){return function(){var i=e.workspace,s=e.getField("VAR").getVariable();t.Variables.renameVariable(i,s)}},t.Constants.VariablesDynamic.DELETE_OPTION_CALLBACK_FACTORY=function(e){return function(){var i=e.workspace,s=e.getField("VAR").getVariable();i.deleteVariableById(s.getId()),i.refreshToolboxSelection()}},t.Extensions.registerMixin("contextMenu_variableDynamicSetterGetter",t.Constants.VariablesDynamic.CUSTOM_CONTEXT_MENU_VARIABLE_GETTER_SETTER_MIXIN),t.Blocks})}(blocks_compressed$1)),blocks_compressed$1.exports}var blocks=blocks$1.exports,hasRequiredBlocks;function requireBlocks(){return hasRequiredBlocks||(hasRequiredBlocks=1,function(l,n){(function(t,e){l.exports=e(requireBlocks_compressed())})(blocks,function(t){return t.Blocks={},t.Blocks})}(blocks$1)),blocks$1.exports}var javascript$1={exports:{}},javascript_compressed$1={exports:{}},javascript_compressed=javascript_compressed$1.exports,hasRequiredJavascript_compressed;function requireJavascript_compressed(){return hasRequiredJavascript_compressed||(hasRequiredJavascript_compressed=1,function(l,n){(function(t,e){l.exports=e(requireBlockly_compressed())})(javascript_compressed,function(t){return t.JavaScript=new t.Generator("JavaScript"),t.JavaScript.addReservedWords("break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,in,instanceof,new,return,super,switch,this,throw,try,typeof,var,void,while,with,yield,enum,implements,interface,let,package,private,protected,public,static,await,null,true,false,arguments,"+Object.getOwnPropertyNames(t.utils.global).join(",")),t.JavaScript.ORDER_ATOMIC=0,t.JavaScript.ORDER_NEW=1.1,t.JavaScript.ORDER_MEMBER=1.2,t.JavaScript.ORDER_FUNCTION_CALL=2,t.JavaScript.ORDER_INCREMENT=3,t.JavaScript.ORDER_DECREMENT=3,t.JavaScript.ORDER_BITWISE_NOT=4.1,t.JavaScript.ORDER_UNARY_PLUS=4.2,t.JavaScript.ORDER_UNARY_NEGATION=4.3,t.JavaScript.ORDER_LOGICAL_NOT=4.4,t.JavaScript.ORDER_TYPEOF=4.5,t.JavaScript.ORDER_VOID=4.6,t.JavaScript.ORDER_DELETE=4.7,t.JavaScript.ORDER_AWAIT=4.8,t.JavaScript.ORDER_EXPONENTIATION=5,t.JavaScript.ORDER_MULTIPLICATION=5.1,t.JavaScript.ORDER_DIVISION=5.2,t.JavaScript.ORDER_MODULUS=5.3,t.JavaScript.ORDER_SUBTRACTION=6.1,t.JavaScript.ORDER_ADDITION=6.2,t.JavaScript.ORDER_BITWISE_SHIFT=7,t.JavaScript.ORDER_RELATIONAL=8,t.JavaScript.ORDER_IN=8,t.JavaScript.ORDER_INSTANCEOF=8,t.JavaScript.ORDER_EQUALITY=9,t.JavaScript.ORDER_BITWISE_AND=10,t.JavaScript.ORDER_BITWISE_XOR=11,t.JavaScript.ORDER_BITWISE_OR=12,t.JavaScript.ORDER_LOGICAL_AND=13,t.JavaScript.ORDER_LOGICAL_OR=14,t.JavaScript.ORDER_CONDITIONAL=15,t.JavaScript.ORDER_ASSIGNMENT=16,t.JavaScript.ORDER_YIELD=17,t.JavaScript.ORDER_COMMA=18,t.JavaScript.ORDER_NONE=99,t.JavaScript.ORDER_OVERRIDES=[[t.JavaScript.ORDER_FUNCTION_CALL,t.JavaScript.ORDER_MEMBER],[t.JavaScript.ORDER_FUNCTION_CALL,t.JavaScript.ORDER_FUNCTION_CALL],[t.JavaScript.ORDER_MEMBER,t.JavaScript.ORDER_MEMBER],[t.JavaScript.ORDER_MEMBER,t.JavaScript.ORDER_FUNCTION_CALL],[t.JavaScript.ORDER_LOGICAL_NOT,t.JavaScript.ORDER_LOGICAL_NOT],[t.JavaScript.ORDER_MULTIPLICATION,t.JavaScript.ORDER_MULTIPLICATION],[t.JavaScript.ORDER_ADDITION,t.JavaScript.ORDER_ADDITION],[t.JavaScript.ORDER_LOGICAL_AND,t.JavaScript.ORDER_LOGICAL_AND],[t.JavaScript.ORDER_LOGICAL_OR,t.JavaScript.ORDER_LOGICAL_OR]],t.JavaScript.isInitialized=!1,t.JavaScript.init=function(e){t.JavaScript.definitions_=Object.create(null),t.JavaScript.functionNames_=Object.create(null),t.JavaScript.variableDB_?t.JavaScript.variableDB_.reset():t.JavaScript.variableDB_=new t.Names(t.JavaScript.RESERVED_WORDS_),t.JavaScript.variableDB_.setVariableMap(e.getVariableMap());for(var i=[],s=t.Variables.allDeveloperVariables(e),r=0;r<s.length;r++)i.push(t.JavaScript.variableDB_.getName(s[r],t.Names.DEVELOPER_VARIABLE_TYPE));for(e=t.Variables.allUsedVarModels(e),r=0;r<e.length;r++)i.push(t.JavaScript.variableDB_.getName(e[r].getId(),t.VARIABLE_CATEGORY_NAME));i.length&&(t.JavaScript.definitions_.variables="var "+i.join(", ")+";"),this.isInitialized=!0},t.JavaScript.finish=function(e){var i=[],s;for(s in t.JavaScript.definitions_)i.push(t.JavaScript.definitions_[s]);return delete t.JavaScript.definitions_,delete t.JavaScript.functionNames_,t.JavaScript.variableDB_.reset(),i.join(`

`)+`


`+e},t.JavaScript.scrubNakedValue=function(e){return e+`;
`},t.JavaScript.quote_=function(e){return e=e.replace(/\\/g,"\\\\").replace(/\n/g,`\\
`).replace(/'/g,"\\'"),"'"+e+"'"},t.JavaScript.multiline_quote_=function(e){return e.split(/\n/g).map(t.JavaScript.quote_).join(` + '\\n' +
`)},t.JavaScript.scrub_=function(e,i,s){var r="";if(!e.outputConnection||!e.outputConnection.targetConnection){var o=e.getCommentText();o&&(o=t.utils.string.wrap(o,t.JavaScript.COMMENT_WRAP-3),r+=t.JavaScript.prefixLines(o+`
`,"// "));for(var h=0;h<e.inputList.length;h++)e.inputList[h].type==t.inputTypes.VALUE&&(o=e.inputList[h].connection.targetBlock())&&(o=t.JavaScript.allNestedComments(o))&&(r+=t.JavaScript.prefixLines(o,"// "))}return e=e.nextConnection&&e.nextConnection.targetBlock(),s=s?"":t.JavaScript.blockToCode(e),r+i+s},t.JavaScript.getAdjusted=function(e,i,s,r,o){s=s||0,o=o||t.JavaScript.ORDER_NONE,e.workspace.options.oneBasedIndex&&s--;var h=e.workspace.options.oneBasedIndex?"1":"0";if(e=0<s?t.JavaScript.valueToCode(e,i,t.JavaScript.ORDER_ADDITION)||h:0>s?t.JavaScript.valueToCode(e,i,t.JavaScript.ORDER_SUBTRACTION)||h:r?t.JavaScript.valueToCode(e,i,t.JavaScript.ORDER_UNARY_NEGATION)||h:t.JavaScript.valueToCode(e,i,o)||h,t.isNumber(e))e=Number(e)+s,r&&(e=-e);else{if(0<s){e=e+" + "+s;var u=t.JavaScript.ORDER_ADDITION}else 0>s&&(e=e+" - "+-s,u=t.JavaScript.ORDER_SUBTRACTION);r&&(e=s?"-("+e+")":"-"+e,u=t.JavaScript.ORDER_UNARY_NEGATION),u=Math.floor(u),o=Math.floor(o),u&&o>=u&&(e="("+e+")")}return e},t.JavaScript.colour={},t.JavaScript.colour_picker=function(e){return[t.JavaScript.quote_(e.getFieldValue("COLOUR")),t.JavaScript.ORDER_ATOMIC]},t.JavaScript.colour_random=function(e){return[t.JavaScript.provideFunction_("colourRandom",["function "+t.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"() {","  var num = Math.floor(Math.random() * Math.pow(2, 24));","  return '#' + ('00000' + num.toString(16)).substr(-6);","}"])+"()",t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.colour_rgb=function(e){var i=t.JavaScript.valueToCode(e,"RED",t.JavaScript.ORDER_NONE)||0,s=t.JavaScript.valueToCode(e,"GREEN",t.JavaScript.ORDER_NONE)||0;return e=t.JavaScript.valueToCode(e,"BLUE",t.JavaScript.ORDER_NONE)||0,[t.JavaScript.provideFunction_("colourRgb",["function "+t.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(r, g, b) {","  r = Math.max(Math.min(Number(r), 100), 0) * 2.55;","  g = Math.max(Math.min(Number(g), 100), 0) * 2.55;","  b = Math.max(Math.min(Number(b), 100), 0) * 2.55;","  r = ('0' + (Math.round(r) || 0).toString(16)).slice(-2);","  g = ('0' + (Math.round(g) || 0).toString(16)).slice(-2);","  b = ('0' + (Math.round(b) || 0).toString(16)).slice(-2);","  return '#' + r + g + b;","}"])+"("+i+", "+s+", "+e+")",t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.colour_blend=function(e){var i=t.JavaScript.valueToCode(e,"COLOUR1",t.JavaScript.ORDER_NONE)||"'#000000'",s=t.JavaScript.valueToCode(e,"COLOUR2",t.JavaScript.ORDER_NONE)||"'#000000'";return e=t.JavaScript.valueToCode(e,"RATIO",t.JavaScript.ORDER_NONE)||.5,[t.JavaScript.provideFunction_("colourBlend",["function "+t.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(c1, c2, ratio) {","  ratio = Math.max(Math.min(Number(ratio), 1), 0);","  var r1 = parseInt(c1.substring(1, 3), 16);","  var g1 = parseInt(c1.substring(3, 5), 16);","  var b1 = parseInt(c1.substring(5, 7), 16);","  var r2 = parseInt(c2.substring(1, 3), 16);","  var g2 = parseInt(c2.substring(3, 5), 16);","  var b2 = parseInt(c2.substring(5, 7), 16);","  var r = Math.round(r1 * (1 - ratio) + r2 * ratio);","  var g = Math.round(g1 * (1 - ratio) + g2 * ratio);","  var b = Math.round(b1 * (1 - ratio) + b2 * ratio);","  r = ('0' + (r || 0).toString(16)).slice(-2);","  g = ('0' + (g || 0).toString(16)).slice(-2);","  b = ('0' + (b || 0).toString(16)).slice(-2);","  return '#' + r + g + b;","}"])+"("+i+", "+s+", "+e+")",t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.lists={},t.JavaScript.lists_create_empty=function(e){return["[]",t.JavaScript.ORDER_ATOMIC]},t.JavaScript.lists_create_with=function(e){for(var i=Array(e.itemCount_),s=0;s<e.itemCount_;s++)i[s]=t.JavaScript.valueToCode(e,"ADD"+s,t.JavaScript.ORDER_NONE)||"null";return["["+i.join(", ")+"]",t.JavaScript.ORDER_ATOMIC]},t.JavaScript.lists_repeat=function(e){var i=t.JavaScript.provideFunction_("listsRepeat",["function "+t.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(value, n) {","  var array = [];","  for (var i = 0; i < n; i++) {","    array[i] = value;","  }","  return array;","}"]),s=t.JavaScript.valueToCode(e,"ITEM",t.JavaScript.ORDER_NONE)||"null";return e=t.JavaScript.valueToCode(e,"NUM",t.JavaScript.ORDER_NONE)||"0",[i+"("+s+", "+e+")",t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.lists_length=function(e){return[(t.JavaScript.valueToCode(e,"VALUE",t.JavaScript.ORDER_MEMBER)||"[]")+".length",t.JavaScript.ORDER_MEMBER]},t.JavaScript.lists_isEmpty=function(e){return["!"+(t.JavaScript.valueToCode(e,"VALUE",t.JavaScript.ORDER_MEMBER)||"[]")+".length",t.JavaScript.ORDER_LOGICAL_NOT]},t.JavaScript.lists_indexOf=function(e){var i=e.getFieldValue("END")=="FIRST"?"indexOf":"lastIndexOf",s=t.JavaScript.valueToCode(e,"FIND",t.JavaScript.ORDER_NONE)||"''";return i=(t.JavaScript.valueToCode(e,"VALUE",t.JavaScript.ORDER_MEMBER)||"[]")+"."+i+"("+s+")",e.workspace.options.oneBasedIndex?[i+" + 1",t.JavaScript.ORDER_ADDITION]:[i,t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.lists_getIndex=function(e){var i=e.getFieldValue("MODE")||"GET",s=e.getFieldValue("WHERE")||"FROM_START",r=t.JavaScript.valueToCode(e,"VALUE",s=="RANDOM"?t.JavaScript.ORDER_NONE:t.JavaScript.ORDER_MEMBER)||"[]";switch(s){case"FIRST":if(i=="GET")return[r+"[0]",t.JavaScript.ORDER_MEMBER];if(i=="GET_REMOVE")return[r+".shift()",t.JavaScript.ORDER_MEMBER];if(i=="REMOVE")return r+`.shift();
`;break;case"LAST":if(i=="GET")return[r+".slice(-1)[0]",t.JavaScript.ORDER_MEMBER];if(i=="GET_REMOVE")return[r+".pop()",t.JavaScript.ORDER_MEMBER];if(i=="REMOVE")return r+`.pop();
`;break;case"FROM_START":if(e=t.JavaScript.getAdjusted(e,"AT"),i=="GET")return[r+"["+e+"]",t.JavaScript.ORDER_MEMBER];if(i=="GET_REMOVE")return[r+".splice("+e+", 1)[0]",t.JavaScript.ORDER_FUNCTION_CALL];if(i=="REMOVE")return r+".splice("+e+`, 1);
`;break;case"FROM_END":if(e=t.JavaScript.getAdjusted(e,"AT",1,!0),i=="GET")return[r+".slice("+e+")[0]",t.JavaScript.ORDER_FUNCTION_CALL];if(i=="GET_REMOVE")return[r+".splice("+e+", 1)[0]",t.JavaScript.ORDER_FUNCTION_CALL];if(i=="REMOVE")return r+".splice("+e+", 1);";break;case"RANDOM":if(r=t.JavaScript.provideFunction_("listsGetRandomItem",["function "+t.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(list, remove) {","  var x = Math.floor(Math.random() * list.length);","  if (remove) {","    return list.splice(x, 1)[0];","  } else {","    return list[x];","  }","}"])+"("+r+", "+(i!="GET")+")",i=="GET"||i=="GET_REMOVE")return[r,t.JavaScript.ORDER_FUNCTION_CALL];if(i=="REMOVE")return r+`;
`}throw Error("Unhandled combination (lists_getIndex).")},t.JavaScript.lists_setIndex=function(e){function i(){if(s.match(/^\w+$/))return"";var u=t.JavaScript.variableDB_.getDistinctName("tmpList",t.VARIABLE_CATEGORY_NAME),p="var "+u+" = "+s+`;
`;return s=u,p}var s=t.JavaScript.valueToCode(e,"LIST",t.JavaScript.ORDER_MEMBER)||"[]",r=e.getFieldValue("MODE")||"GET",o=e.getFieldValue("WHERE")||"FROM_START",h=t.JavaScript.valueToCode(e,"TO",t.JavaScript.ORDER_ASSIGNMENT)||"null";switch(o){case"FIRST":if(r=="SET")return s+"[0] = "+h+`;
`;if(r=="INSERT")return s+".unshift("+h+`);
`;break;case"LAST":if(r=="SET")return e=i(),e+(s+"["+s+".length - 1] = "+h+`;
`);if(r=="INSERT")return s+".push("+h+`);
`;break;case"FROM_START":if(o=t.JavaScript.getAdjusted(e,"AT"),r=="SET")return s+"["+o+"] = "+h+`;
`;if(r=="INSERT")return s+".splice("+o+", 0, "+h+`);
`;break;case"FROM_END":if(o=t.JavaScript.getAdjusted(e,"AT",1,!1,t.JavaScript.ORDER_SUBTRACTION),e=i(),r=="SET")return e+(s+"["+s+".length - "+o+"] = "+h+`;
`);if(r=="INSERT")return e+(s+".splice("+s+".length - "+o+", 0, "+h+`);
`);break;case"RANDOM":if(e=i(),o=t.JavaScript.variableDB_.getDistinctName("tmpX",t.VARIABLE_CATEGORY_NAME),e+="var "+o+" = Math.floor(Math.random() * "+s+`.length);
`,r=="SET")return e+(s+"["+o+"] = "+h+`;
`);if(r=="INSERT")return e+(s+".splice("+o+", 0, "+h+`);
`)}throw Error("Unhandled combination (lists_setIndex).")},t.JavaScript.lists.getIndex_=function(e,i,s){return i=="FIRST"?"0":i=="FROM_END"?e+".length - 1 - "+s:i=="LAST"?e+".length - 1":s},t.JavaScript.lists_getSublist=function(e){var i=t.JavaScript.valueToCode(e,"LIST",t.JavaScript.ORDER_MEMBER)||"[]",s=e.getFieldValue("WHERE1"),r=e.getFieldValue("WHERE2");if(s=="FIRST"&&r=="LAST")i+=".slice(0)";else if(i.match(/^\w+$/)||s!="FROM_END"&&r=="FROM_START"){switch(s){case"FROM_START":var o=t.JavaScript.getAdjusted(e,"AT1");break;case"FROM_END":o=t.JavaScript.getAdjusted(e,"AT1",1,!1,t.JavaScript.ORDER_SUBTRACTION),o=i+".length - "+o;break;case"FIRST":o="0";break;default:throw Error("Unhandled option (lists_getSublist).")}switch(r){case"FROM_START":e=t.JavaScript.getAdjusted(e,"AT2",1);break;case"FROM_END":e=t.JavaScript.getAdjusted(e,"AT2",0,!1,t.JavaScript.ORDER_SUBTRACTION),e=i+".length - "+e;break;case"LAST":e=i+".length";break;default:throw Error("Unhandled option (lists_getSublist).")}i=i+".slice("+o+", "+e+")"}else{o=t.JavaScript.getAdjusted(e,"AT1"),e=t.JavaScript.getAdjusted(e,"AT2");var h=t.JavaScript.lists.getIndex_,u={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"};i=t.JavaScript.provideFunction_("subsequence"+u[s]+u[r],["function "+t.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(sequence"+(s=="FROM_END"||s=="FROM_START"?", at1":"")+(r=="FROM_END"||r=="FROM_START"?", at2":"")+") {","  var start = "+h("sequence",s,"at1")+";","  var end = "+h("sequence",r,"at2")+" + 1;","  return sequence.slice(start, end);","}"])+"("+i+(s=="FROM_END"||s=="FROM_START"?", "+o:"")+(r=="FROM_END"||r=="FROM_START"?", "+e:"")+")"}return[i,t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.lists_sort=function(e){var i=t.JavaScript.valueToCode(e,"LIST",t.JavaScript.ORDER_FUNCTION_CALL)||"[]",s=e.getFieldValue("DIRECTION")==="1"?1:-1;e=e.getFieldValue("TYPE");var r=t.JavaScript.provideFunction_("listsGetSortCompare",["function "+t.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(type, direction) {","  var compareFuncs = {",'    "NUMERIC": function(a, b) {',"        return Number(a) - Number(b); },",'    "TEXT": function(a, b) {',"        return a.toString() > b.toString() ? 1 : -1; },",'    "IGNORE_CASE": function(a, b) {',"        return a.toString().toLowerCase() > b.toString().toLowerCase() ? 1 : -1; },","  };","  var compare = compareFuncs[type];","  return function(a, b) { return compare(a, b) * direction; }","}"]);return[i+".slice().sort("+r+'("'+e+'", '+s+"))",t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.lists_split=function(e){var i=t.JavaScript.valueToCode(e,"INPUT",t.JavaScript.ORDER_MEMBER),s=t.JavaScript.valueToCode(e,"DELIM",t.JavaScript.ORDER_NONE)||"''";if(e=e.getFieldValue("MODE"),e=="SPLIT")i||(i="''"),e="split";else if(e=="JOIN")i||(i="[]"),e="join";else throw Error("Unknown mode: "+e);return[i+"."+e+"("+s+")",t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.lists_reverse=function(e){return[(t.JavaScript.valueToCode(e,"LIST",t.JavaScript.ORDER_FUNCTION_CALL)||"[]")+".slice().reverse()",t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.logic={},t.JavaScript.controls_if=function(e){var i=0,s="";t.JavaScript.STATEMENT_PREFIX&&(s+=t.JavaScript.injectId(t.JavaScript.STATEMENT_PREFIX,e));do{var r=t.JavaScript.valueToCode(e,"IF"+i,t.JavaScript.ORDER_NONE)||"false",o=t.JavaScript.statementToCode(e,"DO"+i);t.JavaScript.STATEMENT_SUFFIX&&(o=t.JavaScript.prefixLines(t.JavaScript.injectId(t.JavaScript.STATEMENT_SUFFIX,e),t.JavaScript.INDENT)+o),s+=(0<i?" else ":"")+"if ("+r+`) {
`+o+"}",++i}while(e.getInput("IF"+i));return(e.getInput("ELSE")||t.JavaScript.STATEMENT_SUFFIX)&&(o=t.JavaScript.statementToCode(e,"ELSE"),t.JavaScript.STATEMENT_SUFFIX&&(o=t.JavaScript.prefixLines(t.JavaScript.injectId(t.JavaScript.STATEMENT_SUFFIX,e),t.JavaScript.INDENT)+o),s+=` else {
`+o+"}"),s+`
`},t.JavaScript.controls_ifelse=t.JavaScript.controls_if,t.JavaScript.logic_compare=function(e){var i={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[e.getFieldValue("OP")],s=i=="=="||i=="!="?t.JavaScript.ORDER_EQUALITY:t.JavaScript.ORDER_RELATIONAL,r=t.JavaScript.valueToCode(e,"A",s)||"0";return e=t.JavaScript.valueToCode(e,"B",s)||"0",[r+" "+i+" "+e,s]},t.JavaScript.logic_operation=function(e){var i=e.getFieldValue("OP")=="AND"?"&&":"||",s=i=="&&"?t.JavaScript.ORDER_LOGICAL_AND:t.JavaScript.ORDER_LOGICAL_OR,r=t.JavaScript.valueToCode(e,"A",s);if(e=t.JavaScript.valueToCode(e,"B",s),r||e){var o=i=="&&"?"true":"false";r||(r=o),e||(e=o)}else e=r="false";return[r+" "+i+" "+e,s]},t.JavaScript.logic_negate=function(e){var i=t.JavaScript.ORDER_LOGICAL_NOT;return["!"+(t.JavaScript.valueToCode(e,"BOOL",i)||"true"),i]},t.JavaScript.logic_boolean=function(e){return[e.getFieldValue("BOOL")=="TRUE"?"true":"false",t.JavaScript.ORDER_ATOMIC]},t.JavaScript.logic_null=function(e){return["null",t.JavaScript.ORDER_ATOMIC]},t.JavaScript.logic_ternary=function(e){var i=t.JavaScript.valueToCode(e,"IF",t.JavaScript.ORDER_CONDITIONAL)||"false",s=t.JavaScript.valueToCode(e,"THEN",t.JavaScript.ORDER_CONDITIONAL)||"null";return e=t.JavaScript.valueToCode(e,"ELSE",t.JavaScript.ORDER_CONDITIONAL)||"null",[i+" ? "+s+" : "+e,t.JavaScript.ORDER_CONDITIONAL]},t.JavaScript.loops={},t.JavaScript.controls_repeat_ext=function(e){var i=e.getField("TIMES")?String(Number(e.getFieldValue("TIMES"))):t.JavaScript.valueToCode(e,"TIMES",t.JavaScript.ORDER_ASSIGNMENT)||"0",s=t.JavaScript.statementToCode(e,"DO");s=t.JavaScript.addLoopTrap(s,e),e="";var r=t.JavaScript.variableDB_.getDistinctName("count",t.VARIABLE_CATEGORY_NAME),o=i;return i.match(/^\w+$/)||t.isNumber(i)||(o=t.JavaScript.variableDB_.getDistinctName("repeat_end",t.VARIABLE_CATEGORY_NAME),e+="var "+o+" = "+i+`;
`),e+("for (var "+r+" = 0; "+r+" < "+o+"; "+r+`++) {
`+s+`}
`)},t.JavaScript.controls_repeat=t.JavaScript.controls_repeat_ext,t.JavaScript.controls_whileUntil=function(e){var i=e.getFieldValue("MODE")=="UNTIL",s=t.JavaScript.valueToCode(e,"BOOL",i?t.JavaScript.ORDER_LOGICAL_NOT:t.JavaScript.ORDER_NONE)||"false",r=t.JavaScript.statementToCode(e,"DO");return r=t.JavaScript.addLoopTrap(r,e),i&&(s="!"+s),"while ("+s+`) {
`+r+`}
`},t.JavaScript.controls_for=function(e){var i=t.JavaScript.variableDB_.getName(e.getFieldValue("VAR"),t.VARIABLE_CATEGORY_NAME),s=t.JavaScript.valueToCode(e,"FROM",t.JavaScript.ORDER_ASSIGNMENT)||"0",r=t.JavaScript.valueToCode(e,"TO",t.JavaScript.ORDER_ASSIGNMENT)||"0",o=t.JavaScript.valueToCode(e,"BY",t.JavaScript.ORDER_ASSIGNMENT)||"1",h=t.JavaScript.statementToCode(e,"DO");if(h=t.JavaScript.addLoopTrap(h,e),t.isNumber(s)&&t.isNumber(r)&&t.isNumber(o)){var u=Number(s)<=Number(r);e="for ("+i+" = "+s+"; "+i+(u?" <= ":" >= ")+r+"; "+i,i=Math.abs(Number(o)),e=(i==1?e+(u?"++":"--"):e+((u?" += ":" -= ")+i))+(`) {
`+h+`}
`)}else e="",u=s,s.match(/^\w+$/)||t.isNumber(s)||(u=t.JavaScript.variableDB_.getDistinctName(i+"_start",t.VARIABLE_CATEGORY_NAME),e+="var "+u+" = "+s+`;
`),s=r,r.match(/^\w+$/)||t.isNumber(r)||(s=t.JavaScript.variableDB_.getDistinctName(i+"_end",t.VARIABLE_CATEGORY_NAME),e+="var "+s+" = "+r+`;
`),r=t.JavaScript.variableDB_.getDistinctName(i+"_inc",t.VARIABLE_CATEGORY_NAME),e+="var "+r+" = ",e=t.isNumber(o)?e+(Math.abs(o)+`;
`):e+("Math.abs("+o+`);
`),e=e+("if ("+u+" > "+s+`) {
`)+(t.JavaScript.INDENT+r+" = -"+r+`;
`),e+=`}
`,e+="for ("+i+" = "+u+"; "+r+" >= 0 ? "+i+" <= "+s+" : "+i+" >= "+s+"; "+i+" += "+r+`) {
`+h+`}
`;return e},t.JavaScript.controls_forEach=function(e){var i=t.JavaScript.variableDB_.getName(e.getFieldValue("VAR"),t.VARIABLE_CATEGORY_NAME),s=t.JavaScript.valueToCode(e,"LIST",t.JavaScript.ORDER_ASSIGNMENT)||"[]",r=t.JavaScript.statementToCode(e,"DO");r=t.JavaScript.addLoopTrap(r,e),e="";var o=s;return s.match(/^\w+$/)||(o=t.JavaScript.variableDB_.getDistinctName(i+"_list",t.VARIABLE_CATEGORY_NAME),e+="var "+o+" = "+s+`;
`),s=t.JavaScript.variableDB_.getDistinctName(i+"_index",t.VARIABLE_CATEGORY_NAME),r=t.JavaScript.INDENT+i+" = "+o+"["+s+`];
`+r,e+("for (var "+s+" in "+o+`) {
`+r+`}
`)},t.JavaScript.controls_flow_statements=function(e){var i="";if(t.JavaScript.STATEMENT_PREFIX&&(i+=t.JavaScript.injectId(t.JavaScript.STATEMENT_PREFIX,e)),t.JavaScript.STATEMENT_SUFFIX&&(i+=t.JavaScript.injectId(t.JavaScript.STATEMENT_SUFFIX,e)),t.JavaScript.STATEMENT_PREFIX){var s=t.Constants.Loops.CONTROL_FLOW_IN_LOOP_CHECK_MIXIN.getSurroundLoop(e);s&&!s.suppressPrefixSuffix&&(i+=t.JavaScript.injectId(t.JavaScript.STATEMENT_PREFIX,s))}switch(e.getFieldValue("FLOW")){case"BREAK":return i+`break;
`;case"CONTINUE":return i+`continue;
`}throw Error("Unknown flow statement.")},t.JavaScript.math={},t.JavaScript.math_number=function(e){return e=Number(e.getFieldValue("NUM")),[e,0<=e?t.JavaScript.ORDER_ATOMIC:t.JavaScript.ORDER_UNARY_NEGATION]},t.JavaScript.math_arithmetic=function(e){var i={ADD:[" + ",t.JavaScript.ORDER_ADDITION],MINUS:[" - ",t.JavaScript.ORDER_SUBTRACTION],MULTIPLY:[" * ",t.JavaScript.ORDER_MULTIPLICATION],DIVIDE:[" / ",t.JavaScript.ORDER_DIVISION],POWER:[null,t.JavaScript.ORDER_NONE]}[e.getFieldValue("OP")],s=i[0];i=i[1];var r=t.JavaScript.valueToCode(e,"A",i)||"0";return e=t.JavaScript.valueToCode(e,"B",i)||"0",s?[r+s+e,i]:["Math.pow("+r+", "+e+")",t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.math_single=function(e){var i=e.getFieldValue("OP");if(i=="NEG")return e=t.JavaScript.valueToCode(e,"NUM",t.JavaScript.ORDER_UNARY_NEGATION)||"0",e[0]=="-"&&(e=" "+e),["-"+e,t.JavaScript.ORDER_UNARY_NEGATION];switch(e=i=="SIN"||i=="COS"||i=="TAN"?t.JavaScript.valueToCode(e,"NUM",t.JavaScript.ORDER_DIVISION)||"0":t.JavaScript.valueToCode(e,"NUM",t.JavaScript.ORDER_NONE)||"0",i){case"ABS":var s="Math.abs("+e+")";break;case"ROOT":s="Math.sqrt("+e+")";break;case"LN":s="Math.log("+e+")";break;case"EXP":s="Math.exp("+e+")";break;case"POW10":s="Math.pow(10,"+e+")";break;case"ROUND":s="Math.round("+e+")";break;case"ROUNDUP":s="Math.ceil("+e+")";break;case"ROUNDDOWN":s="Math.floor("+e+")";break;case"SIN":s="Math.sin("+e+" / 180 * Math.PI)";break;case"COS":s="Math.cos("+e+" / 180 * Math.PI)";break;case"TAN":s="Math.tan("+e+" / 180 * Math.PI)"}if(s)return[s,t.JavaScript.ORDER_FUNCTION_CALL];switch(i){case"LOG10":s="Math.log("+e+") / Math.log(10)";break;case"ASIN":s="Math.asin("+e+") / Math.PI * 180";break;case"ACOS":s="Math.acos("+e+") / Math.PI * 180";break;case"ATAN":s="Math.atan("+e+") / Math.PI * 180";break;default:throw Error("Unknown math operator: "+i)}return[s,t.JavaScript.ORDER_DIVISION]},t.JavaScript.math_constant=function(e){return{PI:["Math.PI",t.JavaScript.ORDER_MEMBER],E:["Math.E",t.JavaScript.ORDER_MEMBER],GOLDEN_RATIO:["(1 + Math.sqrt(5)) / 2",t.JavaScript.ORDER_DIVISION],SQRT2:["Math.SQRT2",t.JavaScript.ORDER_MEMBER],SQRT1_2:["Math.SQRT1_2",t.JavaScript.ORDER_MEMBER],INFINITY:["Infinity",t.JavaScript.ORDER_ATOMIC]}[e.getFieldValue("CONSTANT")]},t.JavaScript.math_number_property=function(e){var i=t.JavaScript.valueToCode(e,"NUMBER_TO_CHECK",t.JavaScript.ORDER_MODULUS)||"0",s=e.getFieldValue("PROPERTY");if(s=="PRIME")return[t.JavaScript.provideFunction_("mathIsPrime",["function "+t.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(n) {","  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods","  if (n == 2 || n == 3) {","    return true;","  }","  // False if n is NaN, negative, is 1, or not whole.","  // And false if n is divisible by 2 or 3.","  if (isNaN(n) || n <= 1 || n % 1 != 0 || n % 2 == 0 || n % 3 == 0) {","    return false;","  }","  // Check all the numbers of form 6k +/- 1, up to sqrt(n).","  for (var x = 6; x <= Math.sqrt(n) + 1; x += 6) {","    if (n % (x - 1) == 0 || n % (x + 1) == 0) {","      return false;","    }","  }","  return true;","}"])+"("+i+")",t.JavaScript.ORDER_FUNCTION_CALL];switch(s){case"EVEN":var r=i+" % 2 == 0";break;case"ODD":r=i+" % 2 == 1";break;case"WHOLE":r=i+" % 1 == 0";break;case"POSITIVE":r=i+" > 0";break;case"NEGATIVE":r=i+" < 0";break;case"DIVISIBLE_BY":e=t.JavaScript.valueToCode(e,"DIVISOR",t.JavaScript.ORDER_MODULUS)||"0",r=i+" % "+e+" == 0"}return[r,t.JavaScript.ORDER_EQUALITY]},t.JavaScript.math_change=function(e){var i=t.JavaScript.valueToCode(e,"DELTA",t.JavaScript.ORDER_ADDITION)||"0";return e=t.JavaScript.variableDB_.getName(e.getFieldValue("VAR"),t.VARIABLE_CATEGORY_NAME),e+" = (typeof "+e+" == 'number' ? "+e+" : 0) + "+i+`;
`},t.JavaScript.math_round=t.JavaScript.math_single,t.JavaScript.math_trig=t.JavaScript.math_single,t.JavaScript.math_on_list=function(e){var i=e.getFieldValue("OP");switch(i){case"SUM":e=t.JavaScript.valueToCode(e,"LIST",t.JavaScript.ORDER_MEMBER)||"[]",e+=".reduce(function(x, y) {return x + y;})";break;case"MIN":e=t.JavaScript.valueToCode(e,"LIST",t.JavaScript.ORDER_NONE)||"[]",e="Math.min.apply(null, "+e+")";break;case"MAX":e=t.JavaScript.valueToCode(e,"LIST",t.JavaScript.ORDER_NONE)||"[]",e="Math.max.apply(null, "+e+")";break;case"AVERAGE":i=t.JavaScript.provideFunction_("mathMean",["function "+t.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(myList) {","  return myList.reduce(function(x, y) {return x + y;}) / myList.length;","}"]),e=t.JavaScript.valueToCode(e,"LIST",t.JavaScript.ORDER_NONE)||"[]",e=i+"("+e+")";break;case"MEDIAN":i=t.JavaScript.provideFunction_("mathMedian",["function "+t.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(myList) {","  var localList = myList.filter(function (x) {return typeof x == 'number';});","  if (!localList.length) return null;","  localList.sort(function(a, b) {return b - a;});","  if (localList.length % 2 == 0) {","    return (localList[localList.length / 2 - 1] + localList[localList.length / 2]) / 2;","  } else {","    return localList[(localList.length - 1) / 2];","  }","}"]),e=t.JavaScript.valueToCode(e,"LIST",t.JavaScript.ORDER_NONE)||"[]",e=i+"("+e+")";break;case"MODE":i=t.JavaScript.provideFunction_("mathModes",["function "+t.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(values) {","  var modes = [];","  var counts = [];","  var maxCount = 0;","  for (var i = 0; i < values.length; i++) {","    var value = values[i];","    var found = false;","    var thisCount;","    for (var j = 0; j < counts.length; j++) {","      if (counts[j][0] === value) {","        thisCount = ++counts[j][1];","        found = true;","        break;","      }","    }","    if (!found) {","      counts.push([value, 1]);","      thisCount = 1;","    }","    maxCount = Math.max(thisCount, maxCount);","  }","  for (var j = 0; j < counts.length; j++) {","    if (counts[j][1] == maxCount) {","        modes.push(counts[j][0]);","    }","  }","  return modes;","}"]),e=t.JavaScript.valueToCode(e,"LIST",t.JavaScript.ORDER_NONE)||"[]",e=i+"("+e+")";break;case"STD_DEV":i=t.JavaScript.provideFunction_("mathStandardDeviation",["function "+t.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(numbers) {","  var n = numbers.length;","  if (!n) return null;","  var mean = numbers.reduce(function(x, y) {return x + y;}) / n;","  var variance = 0;","  for (var j = 0; j < n; j++) {","    variance += Math.pow(numbers[j] - mean, 2);","  }","  variance = variance / n;","  return Math.sqrt(variance);","}"]),e=t.JavaScript.valueToCode(e,"LIST",t.JavaScript.ORDER_NONE)||"[]",e=i+"("+e+")";break;case"RANDOM":i=t.JavaScript.provideFunction_("mathRandomList",["function "+t.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(list) {","  var x = Math.floor(Math.random() * list.length);","  return list[x];","}"]),e=t.JavaScript.valueToCode(e,"LIST",t.JavaScript.ORDER_NONE)||"[]",e=i+"("+e+")";break;default:throw Error("Unknown operator: "+i)}return[e,t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.math_modulo=function(e){var i=t.JavaScript.valueToCode(e,"DIVIDEND",t.JavaScript.ORDER_MODULUS)||"0";return e=t.JavaScript.valueToCode(e,"DIVISOR",t.JavaScript.ORDER_MODULUS)||"0",[i+" % "+e,t.JavaScript.ORDER_MODULUS]},t.JavaScript.math_constrain=function(e){var i=t.JavaScript.valueToCode(e,"VALUE",t.JavaScript.ORDER_NONE)||"0",s=t.JavaScript.valueToCode(e,"LOW",t.JavaScript.ORDER_NONE)||"0";return e=t.JavaScript.valueToCode(e,"HIGH",t.JavaScript.ORDER_NONE)||"Infinity",["Math.min(Math.max("+i+", "+s+"), "+e+")",t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.math_random_int=function(e){var i=t.JavaScript.valueToCode(e,"FROM",t.JavaScript.ORDER_NONE)||"0";return e=t.JavaScript.valueToCode(e,"TO",t.JavaScript.ORDER_NONE)||"0",[t.JavaScript.provideFunction_("mathRandomInt",["function "+t.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(a, b) {","  if (a > b) {","    // Swap a and b to ensure a is smaller.","    var c = a;","    a = b;","    b = c;","  }","  return Math.floor(Math.random() * (b - a + 1) + a);","}"])+"("+i+", "+e+")",t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.math_random_float=function(e){return["Math.random()",t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.math_atan2=function(e){var i=t.JavaScript.valueToCode(e,"X",t.JavaScript.ORDER_NONE)||"0";return["Math.atan2("+(t.JavaScript.valueToCode(e,"Y",t.JavaScript.ORDER_NONE)||"0")+", "+i+") / Math.PI * 180",t.JavaScript.ORDER_DIVISION]},t.JavaScript.procedures={},t.JavaScript.procedures_defreturn=function(e){var i=t.JavaScript.variableDB_.getName(e.getFieldValue("NAME"),t.PROCEDURE_CATEGORY_NAME),s="";t.JavaScript.STATEMENT_PREFIX&&(s+=t.JavaScript.injectId(t.JavaScript.STATEMENT_PREFIX,e)),t.JavaScript.STATEMENT_SUFFIX&&(s+=t.JavaScript.injectId(t.JavaScript.STATEMENT_SUFFIX,e)),s&&(s=t.JavaScript.prefixLines(s,t.JavaScript.INDENT));var r="";t.JavaScript.INFINITE_LOOP_TRAP&&(r=t.JavaScript.prefixLines(t.JavaScript.injectId(t.JavaScript.INFINITE_LOOP_TRAP,e),t.JavaScript.INDENT));var o=t.JavaScript.statementToCode(e,"STACK"),h=t.JavaScript.valueToCode(e,"RETURN",t.JavaScript.ORDER_NONE)||"",u="";o&&h&&(u=s),h&&(h=t.JavaScript.INDENT+"return "+h+`;
`);for(var p=[],d=e.getVars(),f=0;f<d.length;f++)p[f]=t.JavaScript.variableDB_.getName(d[f],t.VARIABLE_CATEGORY_NAME);return s="function "+i+"("+p.join(", ")+`) {
`+s+r+o+u+h+"}",s=t.JavaScript.scrub_(e,s),t.JavaScript.definitions_["%"+i]=s,null},t.JavaScript.procedures_defnoreturn=t.JavaScript.procedures_defreturn,t.JavaScript.procedures_callreturn=function(e){for(var i=t.JavaScript.variableDB_.getName(e.getFieldValue("NAME"),t.PROCEDURE_CATEGORY_NAME),s=[],r=e.getVars(),o=0;o<r.length;o++)s[o]=t.JavaScript.valueToCode(e,"ARG"+o,t.JavaScript.ORDER_NONE)||"null";return[i+"("+s.join(", ")+")",t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.procedures_callnoreturn=function(e){return t.JavaScript.procedures_callreturn(e)[0]+`;
`},t.JavaScript.procedures_ifreturn=function(e){var i="if ("+(t.JavaScript.valueToCode(e,"CONDITION",t.JavaScript.ORDER_NONE)||"false")+`) {
`;return t.JavaScript.STATEMENT_SUFFIX&&(i+=t.JavaScript.prefixLines(t.JavaScript.injectId(t.JavaScript.STATEMENT_SUFFIX,e),t.JavaScript.INDENT)),e.hasReturnValue_?(e=t.JavaScript.valueToCode(e,"VALUE",t.JavaScript.ORDER_NONE)||"null",i+=t.JavaScript.INDENT+"return "+e+`;
`):i+=t.JavaScript.INDENT+`return;
`,i+`}
`},t.JavaScript.texts={},t.JavaScript.text=function(e){return[t.JavaScript.quote_(e.getFieldValue("TEXT")),t.JavaScript.ORDER_ATOMIC]},t.JavaScript.text_multiline=function(e){e=t.JavaScript.multiline_quote_(e.getFieldValue("TEXT"));var i=e.indexOf("+")!=-1?t.JavaScript.ORDER_ADDITION:t.JavaScript.ORDER_ATOMIC;return[e,i]},t.JavaScript.text.forceString_=function(e){return t.JavaScript.text.forceString_.strRegExp.test(e)?[e,t.JavaScript.ORDER_ATOMIC]:["String("+e+")",t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.text.forceString_.strRegExp=/^\s*'([^']|\\')*'\s*$/,t.JavaScript.text_join=function(e){switch(e.itemCount_){case 0:return["''",t.JavaScript.ORDER_ATOMIC];case 1:return e=t.JavaScript.valueToCode(e,"ADD0",t.JavaScript.ORDER_NONE)||"''",t.JavaScript.text.forceString_(e);case 2:var i=t.JavaScript.valueToCode(e,"ADD0",t.JavaScript.ORDER_NONE)||"''";return e=t.JavaScript.valueToCode(e,"ADD1",t.JavaScript.ORDER_NONE)||"''",e=t.JavaScript.text.forceString_(i)[0]+" + "+t.JavaScript.text.forceString_(e)[0],[e,t.JavaScript.ORDER_ADDITION];default:i=Array(e.itemCount_);for(var s=0;s<e.itemCount_;s++)i[s]=t.JavaScript.valueToCode(e,"ADD"+s,t.JavaScript.ORDER_NONE)||"''";return e="["+i.join(",")+"].join('')",[e,t.JavaScript.ORDER_FUNCTION_CALL]}},t.JavaScript.text_append=function(e){var i=t.JavaScript.variableDB_.getName(e.getFieldValue("VAR"),t.VARIABLE_CATEGORY_NAME);return e=t.JavaScript.valueToCode(e,"TEXT",t.JavaScript.ORDER_NONE)||"''",i+" += "+t.JavaScript.text.forceString_(e)[0]+`;
`},t.JavaScript.text_length=function(e){return[(t.JavaScript.valueToCode(e,"VALUE",t.JavaScript.ORDER_MEMBER)||"''")+".length",t.JavaScript.ORDER_MEMBER]},t.JavaScript.text_isEmpty=function(e){return["!"+(t.JavaScript.valueToCode(e,"VALUE",t.JavaScript.ORDER_MEMBER)||"''")+".length",t.JavaScript.ORDER_LOGICAL_NOT]},t.JavaScript.text_indexOf=function(e){var i=e.getFieldValue("END")=="FIRST"?"indexOf":"lastIndexOf",s=t.JavaScript.valueToCode(e,"FIND",t.JavaScript.ORDER_NONE)||"''";return i=(t.JavaScript.valueToCode(e,"VALUE",t.JavaScript.ORDER_MEMBER)||"''")+"."+i+"("+s+")",e.workspace.options.oneBasedIndex?[i+" + 1",t.JavaScript.ORDER_ADDITION]:[i,t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.text_charAt=function(e){var i=e.getFieldValue("WHERE")||"FROM_START",s=t.JavaScript.valueToCode(e,"VALUE",i=="RANDOM"?t.JavaScript.ORDER_NONE:t.JavaScript.ORDER_MEMBER)||"''";switch(i){case"FIRST":return[s+".charAt(0)",t.JavaScript.ORDER_FUNCTION_CALL];case"LAST":return[s+".slice(-1)",t.JavaScript.ORDER_FUNCTION_CALL];case"FROM_START":return e=t.JavaScript.getAdjusted(e,"AT"),[s+".charAt("+e+")",t.JavaScript.ORDER_FUNCTION_CALL];case"FROM_END":return e=t.JavaScript.getAdjusted(e,"AT",1,!0),[s+".slice("+e+").charAt(0)",t.JavaScript.ORDER_FUNCTION_CALL];case"RANDOM":return[t.JavaScript.provideFunction_("textRandomLetter",["function "+t.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(text) {","  var x = Math.floor(Math.random() * text.length);","  return text[x];","}"])+"("+s+")",t.JavaScript.ORDER_FUNCTION_CALL]}throw Error("Unhandled option (text_charAt).")},t.JavaScript.text.getIndex_=function(e,i,s){return i=="FIRST"?"0":i=="FROM_END"?e+".length - 1 - "+s:i=="LAST"?e+".length - 1":s},t.JavaScript.text_getSubstring=function(e){var i=e.getFieldValue("WHERE1"),s=e.getFieldValue("WHERE2"),r=i!="FROM_END"&&i!="LAST"&&s!="FROM_END"&&s!="LAST",o=t.JavaScript.valueToCode(e,"STRING",r?t.JavaScript.ORDER_MEMBER:t.JavaScript.ORDER_NONE)||"''";if(i=="FIRST"&&s=="LAST")return[o,t.JavaScript.ORDER_NONE];if(o.match(/^'?\w+'?$/)||r){switch(i){case"FROM_START":r=t.JavaScript.getAdjusted(e,"AT1");break;case"FROM_END":r=t.JavaScript.getAdjusted(e,"AT1",1,!1,t.JavaScript.ORDER_SUBTRACTION),r=o+".length - "+r;break;case"FIRST":r="0";break;default:throw Error("Unhandled option (text_getSubstring).")}switch(s){case"FROM_START":e=t.JavaScript.getAdjusted(e,"AT2",1);break;case"FROM_END":e=t.JavaScript.getAdjusted(e,"AT2",0,!1,t.JavaScript.ORDER_SUBTRACTION),e=o+".length - "+e;break;case"LAST":e=o+".length";break;default:throw Error("Unhandled option (text_getSubstring).")}i=o+".slice("+r+", "+e+")"}else{r=t.JavaScript.getAdjusted(e,"AT1"),e=t.JavaScript.getAdjusted(e,"AT2");var h=t.JavaScript.text.getIndex_,u={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"};i=t.JavaScript.provideFunction_("subsequence"+u[i]+u[s],["function "+t.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(sequence"+(i=="FROM_END"||i=="FROM_START"?", at1":"")+(s=="FROM_END"||s=="FROM_START"?", at2":"")+") {","  var start = "+h("sequence",i,"at1")+";","  var end = "+h("sequence",s,"at2")+" + 1;","  return sequence.slice(start, end);","}"])+"("+o+(i=="FROM_END"||i=="FROM_START"?", "+r:"")+(s=="FROM_END"||s=="FROM_START"?", "+e:"")+")"}return[i,t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.text_changeCase=function(e){var i={UPPERCASE:".toUpperCase()",LOWERCASE:".toLowerCase()",TITLECASE:null}[e.getFieldValue("CASE")];return e=t.JavaScript.valueToCode(e,"TEXT",i?t.JavaScript.ORDER_MEMBER:t.JavaScript.ORDER_NONE)||"''",[i?e+i:t.JavaScript.provideFunction_("textToTitleCase",["function "+t.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(str) {","  return str.replace(/\\S+/g,","      function(txt) {return txt[0].toUpperCase() + txt.substring(1).toLowerCase();});","}"])+"("+e+")",t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.text_trim=function(e){var i={LEFT:".replace(/^[\\s\\xa0]+/, '')",RIGHT:".replace(/[\\s\\xa0]+$/, '')",BOTH:".trim()"}[e.getFieldValue("MODE")];return[(t.JavaScript.valueToCode(e,"TEXT",t.JavaScript.ORDER_MEMBER)||"''")+i,t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.text_print=function(e){return"window.alert("+(t.JavaScript.valueToCode(e,"TEXT",t.JavaScript.ORDER_NONE)||"''")+`);
`},t.JavaScript.text_prompt_ext=function(e){var i="window.prompt("+(e.getField("TEXT")?t.JavaScript.quote_(e.getFieldValue("TEXT")):t.JavaScript.valueToCode(e,"TEXT",t.JavaScript.ORDER_NONE)||"''")+")";return e.getFieldValue("TYPE")=="NUMBER"&&(i="Number("+i+")"),[i,t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.text_prompt=t.JavaScript.text_prompt_ext,t.JavaScript.text_count=function(e){var i=t.JavaScript.valueToCode(e,"TEXT",t.JavaScript.ORDER_NONE)||"''";return e=t.JavaScript.valueToCode(e,"SUB",t.JavaScript.ORDER_NONE)||"''",[t.JavaScript.provideFunction_("textCount",["function "+t.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(haystack, needle) {","  if (needle.length === 0) {","    return haystack.length + 1;","  } else {","    return haystack.split(needle).length - 1;","  }","}"])+"("+i+", "+e+")",t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.text_replace=function(e){var i=t.JavaScript.valueToCode(e,"TEXT",t.JavaScript.ORDER_NONE)||"''",s=t.JavaScript.valueToCode(e,"FROM",t.JavaScript.ORDER_NONE)||"''";return e=t.JavaScript.valueToCode(e,"TO",t.JavaScript.ORDER_NONE)||"''",[t.JavaScript.provideFunction_("textReplace",["function "+t.JavaScript.FUNCTION_NAME_PLACEHOLDER_+"(haystack, needle, replacement) {",'  needle = needle.replace(/([-()\\[\\]{}+?*.$\\^|,:#<!\\\\])/g,"\\\\$1")','                 .replace(/\\x08/g,"\\\\x08");',"  return haystack.replace(new RegExp(needle, 'g'), replacement);","}"])+"("+i+", "+s+", "+e+")",t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.text_reverse=function(e){return[(t.JavaScript.valueToCode(e,"TEXT",t.JavaScript.ORDER_MEMBER)||"''")+".split('').reverse().join('')",t.JavaScript.ORDER_FUNCTION_CALL]},t.JavaScript.variables={},t.JavaScript.variables_get=function(e){return[t.JavaScript.variableDB_.getName(e.getFieldValue("VAR"),t.VARIABLE_CATEGORY_NAME),t.JavaScript.ORDER_ATOMIC]},t.JavaScript.variables_set=function(e){var i=t.JavaScript.valueToCode(e,"VALUE",t.JavaScript.ORDER_ASSIGNMENT)||"0";return t.JavaScript.variableDB_.getName(e.getFieldValue("VAR"),t.VARIABLE_CATEGORY_NAME)+" = "+i+`;
`},t.JavaScript.variablesDynamic={},t.JavaScript.variables_get_dynamic=t.JavaScript.variables_get,t.JavaScript.variables_set_dynamic=t.JavaScript.variables_set,t.JavaScript})}(javascript_compressed$1)),javascript_compressed$1.exports}var javascript=javascript$1.exports,hasRequiredJavascript;function requireJavascript(){return hasRequiredJavascript||(hasRequiredJavascript=1,function(l,n){(function(t,e){l.exports=e(requireCoreBrowser(),requireJavascript_compressed())})(javascript,function(t,e){return t.JavaScript=e,e})}(javascript$1)),javascript$1.exports}var browser=browser$1.exports,hasRequiredBrowser;function requireBrowser(){return hasRequiredBrowser||(hasRequiredBrowser=1,function(l,n){(function(t,e){l.exports=e(requireCoreBrowser(),requireEn(),requireBlocks(),requireJavascript())})(browser,function(t,e,i,s){return t.setLocale(e),t.Blocks=t.Blocks||{},Object.keys(i).forEach(function(r){t.Blocks[r]=i[r]}),t.JavaScript=s,t})}(browser$1)),browser$1.exports}var blockly=blockly$1.exports,hasRequiredBlockly;function requireBlockly(){return hasRequiredBlockly||(hasRequiredBlockly=1,function(l,n){(function(t,e){l.exports=e(requireBrowser())})(blockly,function(t){return t})}(blockly$1)),blockly$1.exports}var blocklyExports=requireBlockly();const NiryoGenerator_v3=blocklyExports.Python;NiryoGenerator_v3.finish_orig=NiryoGenerator_v3.finish;NiryoGenerator_v3.finish=function(l){const n=NiryoGenerator_v3;return n.definitions_.import_niryo_roswrapper="from niryo_robot_python_ros_wrapper.ros_wrapper import *",n.definitions_.import_sys="import sys",n.definitions_.import_rospy="import rospy",n.definitions_.niryo_init=`rospy.init_node('rocksi_niryo_code')
n = NiryoRosWrapper()
n.calibrate_auto()
`,l=`try:
`+n.prefixLines(l,n.INDENT)+`
except NiryoRosWrapperException as e:
`+n.prefixLines("sys.stderr.write(str(e))",n.INDENT),n.finish_orig(l)};NiryoGenerator_v3.FILE_EXTENSION=".py";NiryoGenerator_v3.MAX_MOVE_SPEED=100;NiryoGenerator_v3.MAX_GRIPPER_SPEED=1e3;NiryoGenerator_v3.GRIPPER_SPEED=100;Simulation.getInstance().then(l=>l);function export_impossible(l){let n=l+` cannot be translated for Niryo. So sorry ._.
`;return popWarning(n),"# "+n}NiryoGenerator_v3.move=function(l){let n=blocklyExports.JavaScript.valueToCode(l,"POSE",blocklyExports.JavaScript.ORDER_COMMA)||0,t=l.getInputTargetBlock("POSE").outputConnection.getCheck()[0];switch(t){case"JointspacePose":return"n.move_joints(*"+n+`)
`;case"TaskspacePose":return"n.move_pose(*"+n+`)
`;default:throw new Error("Invalid move argument '"+t+"'")}};NiryoGenerator_v3.default_pose=function(l){return["["+l.defaultPose.toString()+"]",blocklyExports.NiryoGenerator_v3.ORDER_COLLECTION]};NiryoGenerator_v3.joint_space_pose=function(l){let n=[];for(let e=1;e<8;e++)n.push(l.getFieldValue("JOINT_"+e));return["["+ret.toString()+"]",blocklyExports.NiryoGenerator_v3.ORDER_COLLECTION]};NiryoGenerator_v3.task_space_pose=function(l){let n=[];for(const e of["X","Y","Z","ROLL","PITCH","YAW"])n.push(l.getFieldValue(e));return["["+n.toString()+"]",blocklyExports.NiryoGenerator_v3.ORDER_COLLECTION]};NiryoGenerator_v3.joint_absolute=function(l){let n=l.getFieldValue("JOINT"),e=l.getFieldValue("DEGREES")/180*Math.PI;return`pose = n.get_joints()
pose[`+(n-1)+"] = "+e+`
n.move_joints(*pose)
`};NiryoGenerator_v3.joint_relative=function(l){let n=l.getFieldValue("JOINT"),e=l.getFieldValue("DEGREES")/180*Math.PI;return`pose = n.get_joints()
pose[`+(n-1)+"] += "+e+`
n.move_joints(*pose)
`};NiryoGenerator_v3.gripper_open=function(l){return"n.open_gripper("+NiryoGenerator_v3.GRIPPER_SPEED+`)
`};NiryoGenerator_v3.gripper_close=function(l){return"n.close_gripper("+NiryoGenerator_v3.GRIPPER_SPEED+`)
`};NiryoGenerator_v3.add_sim_object=function(l){return export_impossible("add_sim_object")};NiryoGenerator_v3.physics_done=function(l){return export_impossible("physics_done")};NiryoGenerator_v3.is_attached=function(l){return export_impossible("is_attached")};NiryoGenerator_v3.comment=function(l){return"# "+l.getFieldValue("COMMENT")+`
`};NiryoGenerator_v3.wait=function(l){return"n.wait("+l.getFieldValue("SECONDS")+`)
`};NiryoGenerator_v3.set_speed=function(l){let n=l.getFieldValue("MOTION_TYPE"),t=l.getFieldValue("SPEED")/100;switch(n){case"move":return"n.set_arm_max_velocity("+(t*NiryoGenerator_v3.MAX_MOVE_SPEED).toFixed(0)+`)
`;case"gripper":return NiryoGenerator_v3.GRIPPER_SPEED=(t*NiryoGenerator_v3.MAX_GRIPPER_SPEED).toFixed(0),"# set_speed(gripper) will take effect on the next gripper movement";default:return export_impossible("set_speed("+n+")")}};NiryoGenerator_v3.joint_lock=function(l){return export_impossible("joint_lock")};NiryoGenerator_v3.joint_unlock=function(l){return export_impossible("joint_unlock")};class Niryo extends Robot{constructor(){super("Niryo","niryo_robot_description","urdf/ned/niryo_ned_gripper.urdf.xacro"),this.robotRoot="base_link",this.handRoot="tool_link",this.modelScale=20,this.defaultPose={joint_1:0,joint_2:.32,joint_3:-.68,joint_4:0,joint_5:-.73,joint_6:-.01},this.tcp.parent="hand_link",this.tcp.position=[0,0,.08],this.ikEnabled=["joint_1","joint_2","joint_3","joint_5"],this.generator=NiryoGenerator_v3}}const niryo=new Niryo;class Sawyer extends Robot{constructor(){super("Sawyer","sawyer_description","urdf/sawyer_rocksi.urdf.xacro"),this.packages.robotiq_2f_85_gripper_visualization=getPackage("robotiq_2f_85_gripper_visualization"),this.packages.robotiq_3f_gripper_visualization=getPackage("robotiq_3f_gripper_visualization"),this.robotRoot="base",this.handRoot="right_hand_l",this.modelScale=10,this.defaultPose={right_j0:1.2408,right_j1:-1.024,right_j2:-1.3984,right_j3:.7367,right_j4:.2976,right_j5:1.5476,right_j6:-1.193},this.tcp.parent="right_hand_l",this.ikEnabled=["right_j0","right_j1","right_j2","right_j3","right_j4"],this.interactionJointLimits={}}init(n){return"robotiq_arg2f_base_link"in n.frames?(this.tcp.position=[0,0,.15],this.hand.invertOpenClose=!0):this.tcp.position=[.05,0,0],super.init(n)}}const sawyer=new Sawyer;Object3D.DefaultUp=new Vector3(0,0,1);const selectedRobot=getDesiredRobot();let robotMap={franka,niryo,sawyer};const robot=robotMap[selectedRobot.toLowerCase()];if(!robot)throw new Error(`Unknown robot '${selectedRobot}'`);let container,camera,scene,renderer,raycaster,pointerDownPixels=new Vector2,pointerXY=new Vector2,pointerDrag=!1,tcptarget,groundLine,cameraControl,robotControl,simObjectActive=!1,ik;const renderCallbacks=[];loadRobotModel(robot.xacro).then(l=>{robot.init(l),$(".robot-info").on("click",n=>popInfo(robot.info.DE)),robot.setPose(robot.defaultPose),initScene(),initCannon(),ik=new CCDIK(scene,robot),Simulation.init(robot,ik,ikRender)},l=>{console.error(l)});function loadRobotModel(l){return new Promise((n,t)=>{const e=new XacroLoader;e.inOrder=!0,e.requirePrefix=!0,e.localProperties=!0,e.rospackCommands.find=(...i)=>path.join(robot.root,...i);for(let i in robot.rosMacros)e.rospackCommands[i]=robot.rosMacros[i];e.load(l,i=>{let s=new LoadingManager(onLoadComplete,render);const r=new URDFLoader(s);r.packages=robot.packages,r.workingPath=LoaderUtils.extractUrlBase(l);let o=r.parse(i);n(o)},i=>{console.error(i),t(i)})})}function onLoadComplete(){$(".loading-lightbox").hide(),robot.onLoadComplete()}function initScene(){container=document.getElementById("sim-canvas"),scene=new Scene,scene.background=new Color(3554123),camera=new PerspectiveCamera(45,container.clientWidth/container.clientHeight,1,2e3),camera.position.set(8,20,17),camera.lookAt(0,0,10);const l=new GridHelper(20,20,15790320,8947848);l.rotateX(Math.PI/2),scene.add(l),scene.add(robot.model);const n=new HemisphereLight(16772846,1118498);scene.add(n);const t=new PointLight(16777215,.3);t.position.set(30,30,40),scene.add(t),renderer=new WebGLRenderer,renderer.sortObjects=!1,renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),container.appendChild(renderer.domElement),cameraControl=new OrbitControls(camera,renderer.domElement),cameraControl.damping=.2,cameraControl.addEventListener("change",render),tcptarget=new Mesh(new SphereGeometry(2),new MeshBasicMaterial({visible:!1})),robot.tcp.object.getWorldPosition(tcptarget.position),scene.add(tcptarget);let e=[];e.push(tcptarget.position.clone()),e.push(tcptarget.position.clone().setZ(0));let i=new BufferGeometry().setFromPoints(e);groundLine=new Line(i,new LineBasicMaterial({color:11184844})),groundLine.name="groundLine",scene.add(groundLine),robotControl=new TransformControls(camera,renderer.domElement),robotControl.setSize(canHover()?1.7:3),robotControl.addEventListener("change",r=>requestAnimationFrame(render)),robotControl.addEventListener("objectChange",onTargetChange),robotControl.addEventListener("dragging-changed",r=>cameraControl.enabled=!r.value),robotControl.attach(tcptarget),scene.add(robotControl),robotControl.visible=!1,robotControl.enabled=!1,raycaster=new Raycaster,enablePointerEvents();let s=document.querySelector(".sim-container");new ResizeSensor(s,onCanvasResize),onCanvasResize(),initGui(robot,cameraControl,ikRender)}function onCanvasResize(){camera.aspect=container.clientWidth/container.clientHeight,camera.updateProjectionMatrix(),renderer.setSize(container.clientWidth,container.clientHeight),requestAnimationFrame(render)}function onTargetChange(){tcptarget.position.z=Math.max(0,tcptarget.position.z),updateGroundLine(),ik.solve(tcptarget,robot,robot.ikEnabled,{maxIterations:3,stopDistance:.1,jointLimits:robot.interactionJointLimits,apply:!0})}function ikRender(){robot.tcp.object.getWorldPosition(tcptarget.position),robot.tcp.object.getWorldQuaternion(tcptarget.quaternion),updateGroundLine(),requestAnimationFrame(render)}function updateGroundLine(){const n=groundLine.geometry.attributes.position;n.setXYZ(0,tcptarget.position.x,tcptarget.position.y,tcptarget.position.z),n.setXYZ(1,tcptarget.position.x,tcptarget.position.y,0),n.needsUpdate=!0}function render(){renderer.render(scene,camera);for(let l of renderCallbacks)l(robot)}function enablePointerEvents(){canHover()?(container.addEventListener("pointermove",onHoverPointerMove),container.addEventListener("pointerdown",onHoverPointerDown),container.addEventListener("pointerup",onHoverPointerUp)):(container.addEventListener("pointermove",onClickPointerMove),container.addEventListener("pointerdown",onClickPointerDown),container.addEventListener("pointerup",onClickPointerUp))}function disablePointerEvents(){canHover()?(container.removeEventListener("pointermove",onHoverPointerMove),container.removeEventListener("pointerdown",onHoverPointerDown),container.removeEventListener("pointerup",onHoverPointerUp)):(container.removeEventListener("pointermove",onClickPointerMove),container.removeEventListener("pointerdown",onClickPointerDown),container.removeEventListener("pointerup",onClickPointerUp)),remControledSimObject(),robotControl.visible=!1,robotControl.enabled=!1}function onHoverPointerMove(l){l.preventDefault(),pointerDrag=!0,pointerXY.x=l.offsetX/container.clientWidth*2-1,pointerXY.y=-(l.offsetY/container.clientHeight)*2+1,raycaster.setFromCamera(pointerXY,camera),setSimObjectHighlight(raycaster);let n=!1;simObjectActive||(n=raycaster.intersectObjects([tcptarget]).length>0),n!==robotControl.visible&&(robotControl.visible=n,robotControl.enabled=n),requestAnimationFrame(render)}function onHoverPointerDown(l){pointerDrag=!1,pointerDownPixels.x=l.offsetX,pointerDownPixels.y=l.offsetY}function onHoverPointerUp(l){pointerDrag||new Vector2(l.offsetX,l.offsetY).sub(pointerDownPixels).length()>5||(simObjectActive=setTCSimObjectsOnClick(raycaster),requestAnimationFrame(render))}function onClickPointerMove(l){l.preventDefault(),pointerDrag=!0,requestAnimationFrame(render)}function onClickPointerDown(l){pointerDrag=!1,pointerDownPixels.x=l.offsetX,pointerDownPixels.y=l.offsetY}function onClickPointerUp(l){if(pointerDrag||new Vector2(l.offsetX,l.offsetY).sub(pointerDownPixels).length()>5)return;pointerXY.x=l.offsetX/container.clientWidth*2-1,pointerXY.y=-(l.offsetY/container.clientHeight)*2+1,raycaster.setFromCamera(pointerXY,camera);let n=!1;setTCSimObjectsOnClick(raycaster)||(n=raycaster.intersectObjects([tcptarget]).length>0),n!==robotControl.visible&&(robotControl.visible=n,robotControl.enabled=n),requestAnimationFrame(render)}function addRenderCallback(l){renderCallbacks.includes(l)||renderCallbacks.push(l)}function requestAF(){requestAnimationFrame(render)}function getScene(){return scene}function getControl(){return{camera,orbitControls:cameraControl,renderer}}const theRobots=["Franka","Niryo","Sawyer"];let currentRobotIdx=0;{let l=getDesiredRobot().toLowerCase();for(let n=0;n<theRobots.length;n++)if(theRobots[n].toLowerCase()==l){currentRobotIdx=n;break}}const theLanguages=["EN","DE"];let currentLanguageIdx=0;{let l=getDesiredLanguage();for(let n=0;n<theLanguages.length;n++)if(theLanguages[n].toLowerCase()==l){currentLanguageIdx=n;break}}var gui=null;let jointList=null;function initGui(l,n,t){gui=new Gui({css:"h:20; w: 200; z-index: 98"}),gui.content.id="robot-gui",gui.add("title",{name:"Rocksi",prefix:"v2.0"});const e=gui.add("list",{name:localize("gui-language"),list:theLanguages,value:currentLanguageIdx}).onChange(h=>switchLanguage(e,h)),i=gui.add("list",{name:localize("gui-robot"),list:theRobots,value:currentRobotIdx}).onChange(h=>loadRobot(i,h));gui.add("button",{name:"",value:[localize("gui-robot-info")]}).onChange(h=>showRobotInfo(l)),gui.add("button",{name:"",value:[localize("gui-gripper-open"),localize("gui-gripper-close")]}).onChange(h=>setGripper(h)).label(localize("gui-gripper"),1);let r=getRobotJointValuesRelative(l);jointList=gui.add("graph",{name:localize("gui-joints"),value:r,neg:!0,precision:2,h:80}).onChange(h=>updateRobotJoints(l,h,t));let o=gui.add("group",{name:localize("gui-ik-joints")});for(let h of l.arm.movable){let u=l.ikEnabled.includes(h.name);o.add("bool",{name:h.name,value:u,h:20}).onChange(p=>onJointIKChange(l,h.name,p))}gui.add("button",{name:"",value:[localize("gui-reset-robot")],p:0}).onChange(h=>resetRobot(l,t)),gui.add("button",{name:"",value:[localize("gui-reset-view")],p:0}).onChange(h=>n.reset()),gui.isOpen=!1,gui.setHeight(),gui.bottomText=[localize("gui-robot"),localize("gui-close")],gui.bottom.textContent=localize("gui-robot"),addRenderCallback(onRobotMoved)}function onRobotMoved(l){let n=getRobotJointValuesRelative(l),t=jointList.v;for(let e=0;e<n.length;e++)t[e]=(1+n[e])/2;jointList.setValue(n)}function getRobotJointValuesRelative(l){let n=[];for(let t of l.arm.movable){let e=t.angle,i=t.limit.lower,s=t.limit.upper,r=(e-i)/(s-i)*2-1;n.push(r)}return n}function switchLanguage(l,n){if(theLanguages[currentLanguageIdx]===n)return;if(window.confirm(localize("gui-confirm-switch-language",n))){let e=window.location,i=new URLSearchParams(e.search);i.set("lang",n),window.location.replace(e.origin+e.pathname+"?"+i.toString())}else l.setList(theLanguages,currentLanguageIdx),l.close()}function loadRobot(l,n){if(theRobots[currentRobotIdx]===n)return;if(window.confirm(localize("gui-confirm-switch-robot",n))){let e=window.location,i=new URLSearchParams(e.search);i.set("robot",n),window.location.replace(e.origin+e.pathname+"?"+i.toString())}else l.setList(theRobots,robotIdx),l.close()}function showRobotInfo(l){msgBoxInfo({closeTime:2e4}).show(localize(l.name.toLowerCase()+"-info"))}function setGripper(l){Simulation.getInstance().then(n=>{switch(l){case localize("gui-gripper-open"):n.gripper_open();break;case localize("gui-gripper-close"):n.gripper_close();break;default:console.error('GUI event "'+l+'" not handled')}})}function updateRobotJoints(l,n,t){for(let e=0;e<l.arm.movable.length;e++){let i=l.arm.movable[e],s=i.limit.lower,r=i.limit.upper,o=n[e],h=s+(r-s)*(o+1)/2;i.setJointValue(h)}t()}function onJointIKChange(l,n,t){let e=l.ikEnabled.indexOf(n);t&&e<0?l.ikEnabled.push(n):!t&&e>=0&&l.ikEnabled.splice(e,1)}function resetRobot(l,n){for(let t in l.defaultPose){let e=l.defaultPose[t];l.joints[t].setJointValue(e)}n()}const imprint$1="Impressum",privacy$1="Datenschutz",software$1="Software",robots$1="Roboter",html_de={"@metadata":{authors:["Nikolas Dahn"],"last-updated":"2021-07-17",locale:"de","message-documentation":"qqq"},"seo-description":"Rocksi ist ein kostenloser Roboter-Simulator, mit dem du einen virtuellen 3D-Roboter in deinem Browser programmieren kannst!","seo-header":"Programmiere deinen Roboter im Browser!","seo-text":"Rocksi ist ein Simulator, mit dem du einen virtuellen 3D-Roboter hnlich wie in Scratch oder Lego Mindstorms programmieren kannst. Rocksi luft auf jedem modernen Browser (Firefox, Chrome, Safari...) und Gert (iPhone, iPad, IOS, Android, Linux, Windows, ...) - ohne Download oder Installation! Rocksi ist auerdem vllig kostenlos und erfordert keine Registrierung.<br>Rocksi wurde geschrieben, um mehr Menschen Zugang zu Robotern zu geben, insbesondere fr den Bildungsbereich. Egal ob Schulklassen, Vorlesungen, Workshops oder Messen, Rocksi bringt Menschen und Roboter nher zusammen! Bisher wurden Roboter von Franka Emika und Niryo eingebaut, und es ist relativ einfach, weitere hinzuzufgen (siehe Quellcode).","robot-loading":"Lade Roboter...","warn-unsaved":"Der aktuelle Zustand wird nicht gespeichert. Fortfahren?","note-code-export":"Code exportiert! Sei vorsichtig, wenn du ihn auf einem Roboter ausprobierst.","tutorial-0-heading":"Willkommen zu Rocksi!","tutorial-0-intro":"Roboter sind teuer, weshalb es fr die meisten Menschen sehr schwer ist, sie wirklich kennenzulernen. Doch Menschen lieben es, etwas anzufassen! Genau dafr wurde Rocksi geschrieben - um Menschen mit Robotern in Berhrung zu bringen. Egal ob Lehrer, Schler, Fachkraft oder einfach nur technik-affin, Rocksi hilft, die Grundlagen der Robotik zu verstehen und mit anderen zu teilen.","tutorial-0-start":"Mit dem Pfeil rechts kommst du zum ersten Tutorial.<br><i>Viel Spa!</i>","tutorial-0-social":"Updates & Feedback","tutorial-1-heading":"Behalte den berblick","tutorial-1":"ber das Men links kannst du schnell zwischen den Ansichten wechseln.","tutorial-2-heading":"Voll im Bilde","tutorial-2-desktop":"Mit Links- und Rechtsklick drehst du dir die Welt, wie sie dir gefllt.","tutorial-2-mobile":"Mit den gewohnten Touch-Gesten findest du jedes Detail.","tutorial-3-heading":"Handzahm","tutorial-3":"Den Roboter kannst du direkt in der 3D-Ansicht bewegen. ber das Men kannst du auch gezielt einzelne Gelenke steuern.","tutorial-4-heading":"Das Leben ist ein Puzzle-Spiel","tutorial-4":"Mithilfe der Puzzleteile kannst du dir schnell ein Programm fr den Roboter zusammenzubauen.","tutorial-5-heading":"Haltung Wahren","tutorial-5":"Nutze die Pfeile um Posen des Roboters zwischen Blcken und Roboter zu bertragen.","tutorial-6-heading":"Let it go","tutorial-6":"Um ein Programm auszufhren klickst du in der 3D-Ansicht auf den Play-Button.","tutorial-7-heading":"Aus dem Kontext gerissen","tutorial-7":"Das Kontext-Men gibt dir weitere Optionen. Auerdem kannst du so deine Programme speichern und laden.","tutorial-rf-heading":"Roboterfhrerschein","tutorial-rf":"Du mchtest noch mehr wissen oder dir war etwas unklar? Auf {{link:robotikschulungen.de|https://www.robotikschulungen.de}} findest du verschiedene kostenlose Kurse!","license-note":'Rocksi wird unter der <a href="https://tldrlegal.com/license/mit-license" target="_blank">MIT Lizenz</a> verffentlicht<br>',imprint:imprint$1,privacy:privacy$1,software:software$1,robots:robots$1,"imprint-content":"i18n/imprint_de.html","privacy-content":"i18n/privacy_de.html","software-content":"i18n/software_de.html","robots-content":"i18n/robots_de.html","gui-robot":"Rocksi","gui-language":"Sprache","gui-gripper":"Greifer","gui-gripper-open":"ffnen","gui-gripper-close":"Schlieen","gui-advanced-gripping":"Reales Greifen","gui-joints":"Gelenkwinkel","gui-ik-joints":"IK Gelenke","gui-reset-robot":"Roboter zurcksetzen","gui-reset-view":"Ansicht zurcksetzen","gui-close":"Schlieen","gui-confirm-switch-robot":"Mchtest du den $1 Roboter laden? Dein aktuelles Programm geht dabei verloren!","gui-confirm-switch-language":"Mchtest du die Sprache wechseln? Dein aktuelles Programm geht dabei verloren!","gui-robot-info":"Info","franka-info":'Der Roboter von Franka Emika zeichnet sich durch 7 Gelenkfreiheitsgrade und einen hohen Grad von Feingefhl aus. Dadurch kann sich Franka hnlich wie der menschliche Arm bewegen und auch auf leichte Berhrungen reagieren. <p><a href="https://franka.de/" target="_blank">www.franka.de</a></p>',"niryo-info":'Niryo stellt kleine Desktoproboter mit 6 Gelenken her, die vor allem fr den Bildungsbereich gedacht sind. Mit einem 3D-Drucker knnen technisch Begeisterte den Roboter sogar selbst bauen! <p><a href="https://niryo.com/" target="_blank">www.niryo.com</a></p>',"sawyer-info":'Der Sawyer ist der Nachfolger des bekannten zweiarmigen Baxter Roboters und ist uerst beliebt in der Forschung. Die Anordnung der Gelenke fhrt zu einigen sehr ungewhnlichen Bewegungen! <p><a href="https://www.rethinkrobotics.com/de/sawyer/" target="_blank">www.rethinkrobotics.com/de/sawyer/</a></p>'},html_de$1=Object.freeze(Object.defineProperty({__proto__:null,default:html_de,imprint:imprint$1,privacy:privacy$1,robots:robots$1,software:software$1},Symbol.toStringTag,{value:"Module"})),imprint="Imprint",privacy="Privacy Policy",software="Software",robots="Robots",html_en={"@metadata":{authors:["Nikolas Dahn"],"last-updated":"2021-07-17",locale:"en","message-documentation":"qqq"},"seo-description":"Rocksi is a free robot simulator that runs in any modern browser and allows you to program a 3D robot arm using blockly visual programming.","seo-header":"Simulate and program virtual robots in your browser!","seo-text":"Rocksi is a simulator that allows you to freely program a 3D virtual robot similar to scratch or Lego Mindstorms. Rocksi runs on any modern browser (Firefox, Chrome, Safari...) and device (iPhone, iPad, IOS, Android, Linux, Windows, ...) - no download or installation! Rocksi is also completely free of charge with no registration required.<br>Rocksi was written to make robots more accessible for everybody, and especially with education in mind. Use it however you see fit, e.g. school classes, university lectures, workshops, fairs, etc.!At the moments robots by Franka Emika and Niryo are included, but it's easy to add new robots yourself (check the source code).","robot-loading":"Loading Robot...","warn-unsaved":"The current state will not be saved. Continue?","note-code-export":"Code exported! Be careful before running this on your robot.","tutorial-0-heading":"Welcome to Rocksi!","tutorial-0-intro":"Robots are expensive, so for many people it's impossible to get to know them properly. But humans love touching things! Rocksi was created to make robots more accessible. Whether you're a teacher, a student, a specialist worker or just interested, Rocksi enables you to understand and share the very core concepts of robotics.","tutorial-0-start":"To get started, click the arrow on the right to jump to the first tutorial.<br><i>I hope you enjoy!</i>","tutorial-0-social":"Updates & Feedback","tutorial-1-heading":"Organizing Yourself","tutorial-1":"Quickly switch between views using the menu on the left.","tutorial-2-heading":"Taking Perspective","tutorial-2-desktop":"Use left click, right click and mouse wheel to move around.","tutorial-2-mobile":"Use finger gestures to move around.","tutorial-3-heading":"Taming the Robot","tutorial-3":"Control the robot by clicking and dragging its gripper. You can control individual joints through the GUI in the top right.","tutorial-4-heading":"Those Who Program","tutorial-4":"By combining puzzle pieces from the toolbox you can quickly create a program for the robot.","tutorial-5-heading":"Maintaining Posture","tutorial-5":"Use the arrows to transfer poses between blocks and the robot.","tutorial-6-heading":"Let it go","tutorial-6":"To run your program just click the large play button in the 3D view.","tutorial-7-heading":"Context is Everything","tutorial-7":"The context menus give you additional control over your program. You can also load and save programs there!","tutorial-rf-heading":"Robot Driver's License","tutorial-rf":"You want to know more about robots? You can find some decent basic courses on {{link:robotikschulungen.de|https://www.robotikschulungen.de}} (unfortunately only in German right now).","license-note":'Rocksi is distributed under the <a href="https://tldrlegal.com/license/mit-license" target="_blank">MIT license</a><br>',imprint,privacy,software,robots,"imprint-content":"i18n/imprint_en.html","privacy-content":"i18n/privacy_en.html","software-content":"i18n/software_en.html","robots-content":"i18n/robots_en.html","gui-robot":"Rocksi","gui-language":"Language","gui-gripper":"Gripper","gui-gripper-open":"Open","gui-gripper-close":"Close","gui-advanced-gripping":"Realistic Grip","gui-joints":"Joint Values","gui-ik-joints":"IK Joints","gui-reset-robot":"Reset Robot","gui-reset-view":"Reset Viewport","gui-close":"Close","gui-confirm-switch-robot":"Are you sure you want to load the $1 robot? Any unsaved programs will be lost!","gui-confirm-switch-language":"Are you sure you want to change language? Any unsaved programs will be lost!","gui-robot-info":"Info","franka-info":`Franka Emika's robot features 7 joint degrees of freedem as well as a high degree of sensitivity. This allows it to move similar to a human arm and react to even light touches. <p><a href="https://franka.de/" target="_blank">www.franka.de</a></p>`,"niryo-info":'Niryo creates robots with 6 joints that are meant to be used in education. The robot is open source, so if you have the parts and a 3d printer you can even build it yourself! <p><a href="https://niryo.com/" target="_blank">www.niryo.com</a></p>',"sawyer-info":'The Sawyer is the successor of the two-armed Baxter robot and is very popular in research. The arrangements of joints creates some very unusual movement patterns! <p><a href="https://www.rethinkrobotics.com/sawyer/" target="_blank">www.rethinkrobotics.com/sawyer/</a></p>'},html_en$1=Object.freeze(Object.defineProperty({__proto__:null,default:html_en,imprint,privacy,robots,software},Symbol.toStringTag,{value:"Module"}));blocklyExports.Field.prototype.fromXml=function(l){this.setValue(blocklyExports.utils.replaceMessageReferences(l.textContent))};blocklyExports.Xml.domToVariables=function(l,n){for(var t=0,e;e=l.childNodes[t];t++)if(e.nodeType==blocklyExports.utils.dom.NodeType.ELEMENT_NODE){var i=e.getAttribute("type"),s=e.getAttribute("id"),r=blocklyExports.utils.replaceMessageReferences(e.textContent);n.createVariable(r,i,s)}};blocklyExports.Xml.applyCommentTagNodes_=function(l,n){for(var t=0,e;e=l[t];t++){var i=blocklyExports.utils.replaceMessageReferences(e.textContent),s=e.getAttribute("pinned")=="true",r=parseInt(e.getAttribute("w"),10),o=parseInt(e.getAttribute("h"),10);n.setCommentText(i),n.commentModel.pinned=s,!isNaN(r)&&!isNaN(o)&&(n.commentModel.size=new blocklyExports.utils.Size(r,o)),s&&n.getCommentIcon&&!n.isInFlyout&&setTimeout(function(){n.getCommentIcon().setVisible(!0)},1)}};blocklyExports.Xml.applyDataTagNodes_=function(l,n){for(var t=0,e;e=l[t];t++)n.data=blocklyExports.utils.replaceMessageReferences(e.textContent)};var enExports=requireEn();const BlocklyLangEN=getDefaultExportFromCjs(enExports);var de$1={exports:{}},de=de$1.exports,hasRequiredDe;function requireDe(){return hasRequiredDe||(hasRequiredDe=1,function(l,n){(function(t,e){l.exports=e(requireCoreBrowser())})(de,function(e){var e={};return e.Msg={},e.Msg.ADD_COMMENT="Kommentar hinzufgen",e.Msg.CANNOT_DELETE_VARIABLE_PROCEDURE="Die Variable %1 kann nicht gelscht werden, da sie Teil der Definition der Funktion %2 ist.",e.Msg.CHANGE_VALUE_TITLE="Wert ndern:",e.Msg.CLEAN_UP="Bausteine aufrumen",e.Msg.COLLAPSED_WARNINGS_WARNING="Eingeklappte Blcke enthalten Warnungen.",e.Msg.COLLAPSE_ALL="Alle Bausteine zusammenfalten",e.Msg.COLLAPSE_BLOCK="Baustein zusammenfalten",e.Msg.COLOUR_BLEND_COLOUR1="Farbe 1",e.Msg.COLOUR_BLEND_COLOUR2="und Farbe 2",e.Msg.COLOUR_BLEND_HELPURL="https://meyerweb.com/eric/tools/color-blend/#:::rgbp",e.Msg.COLOUR_BLEND_RATIO="im Verhltnis",e.Msg.COLOUR_BLEND_TITLE="mische",e.Msg.COLOUR_BLEND_TOOLTIP="Vermischt 2 Farben mit konfigurierbarem Farbverhltnis (0.0 - 1.0).",e.Msg.COLOUR_PICKER_HELPURL="https://de.wikipedia.org/wiki/Farbe",e.Msg.COLOUR_PICKER_TOOLTIP="Whlt eine Farbe aus der Palette aus.",e.Msg.COLOUR_RANDOM_HELPURL="http://randomcolour.com",e.Msg.COLOUR_RANDOM_TITLE="zufllige Farbe",e.Msg.COLOUR_RANDOM_TOOLTIP="Erzeugt eine Farbe nach dem Zufallsprinzip.",e.Msg.COLOUR_RGB_BLUE="blau",e.Msg.COLOUR_RGB_GREEN="grn",e.Msg.COLOUR_RGB_HELPURL="https://www.december.com/html/spec/colorpercompact.html",e.Msg.COLOUR_RGB_RED="rot",e.Msg.COLOUR_RGB_TITLE="Farbe aus",e.Msg.COLOUR_RGB_TOOLTIP="Erzeugt eine Farbe mit selbst definierten Rot-, Grn- und Blauwerten. Alle Werte mssen zwischen 0 und 100 liegen.",e.Msg.CONTROLS_FLOW_STATEMENTS_HELPURL="https://de.wikipedia.org/wiki/Kontrollstruktur",e.Msg.CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK="die Schleife abbrechen",e.Msg.CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE="sofort mit nchstem Schleifendurchlauf fortfahren",e.Msg.CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK="Die umgebende Schleife beenden.",e.Msg.CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE="Diese Anweisung abbrechen und mit dem nchsten Schleifendurchlauf fortfahren.",e.Msg.CONTROLS_FLOW_STATEMENTS_WARNING="Warnung: Dieser Baustein kann nur in einer Schleife verwendet werden.",e.Msg.CONTROLS_FOREACH_HELPURL="https://de.wikipedia.org/wiki/For-Schleife",e.Msg.CONTROLS_FOREACH_TITLE="fr jeden Wert %1 aus der Liste %2",e.Msg.CONTROLS_FOREACH_TOOLTIP='Fhrt eine Anweisung fr jeden Wert in der Liste aus und setzt dabei die Variable "%1" auf den aktuellen Listenwert.',e.Msg.CONTROLS_FOR_HELPURL="https://de.wikipedia.org/wiki/For-Schleife",e.Msg.CONTROLS_FOR_TITLE="zhle %1 von %2 bis %3 in Schritten von %4",e.Msg.CONTROLS_FOR_TOOLTIP='Zhlt die Variable "%1" von einem Startwert bis zu einem Endwert und fhrt fr jeden Wert eine Anweisung aus.',e.Msg.CONTROLS_IF_ELSEIF_TOOLTIP="Eine weitere Bedingung hinzufgen.",e.Msg.CONTROLS_IF_ELSE_TOOLTIP="Eine sonst-Bedingung hinzufgen. Fhrt eine Anweisung aus, falls keine Bedingung zutrifft.",e.Msg.CONTROLS_IF_HELPURL="https://github.com/google/blockly/wiki/IfElse",e.Msg.CONTROLS_IF_IF_TOOLTIP="Hinzufgen, entfernen oder sortieren von Sektionen",e.Msg.CONTROLS_IF_MSG_ELSE="sonst",e.Msg.CONTROLS_IF_MSG_ELSEIF="sonst falls",e.Msg.CONTROLS_IF_MSG_IF="falls",e.Msg.CONTROLS_IF_TOOLTIP_1="Fhrt eine Anweisung aus, falls eine Bedingung wahr ist.",e.Msg.CONTROLS_IF_TOOLTIP_2="Fhrt die erste Anweisung aus, falls eine Bedingung wahr ist.  Fhrt ansonsten die zweite Anweisung aus.",e.Msg.CONTROLS_IF_TOOLTIP_3="Fhrt die erste Anweisung aus, falls die erste Bedingung wahr ist.  Fhrt ansonsten die zweite Anweisung aus, falls die zweite Bedingung wahr ist.",e.Msg.CONTROLS_IF_TOOLTIP_4="Fhre die erste Anweisung aus, falls die erste Bedingung wahr ist.  Fhrt ansonsten die zweite Anweisung aus, falls die zweite Bedingung wahr ist.  Fhrt die dritte Anweisung aus, falls keine der beiden Bedingungen wahr ist",e.Msg.CONTROLS_REPEAT_HELPURL="https://de.wikipedia.org/wiki/For-Schleife",e.Msg.CONTROLS_REPEAT_INPUT_DO="mache",e.Msg.CONTROLS_REPEAT_TITLE="wiederhole %1 mal:",e.Msg.CONTROLS_REPEAT_TOOLTIP="Eine Anweisung mehrfach ausfhren.",e.Msg.CONTROLS_WHILEUNTIL_HELPURL="https://de.wikipedia.org/wiki/Schleife_%28Programmierung%29",e.Msg.CONTROLS_WHILEUNTIL_OPERATOR_UNTIL="wiederhole bis",e.Msg.CONTROLS_WHILEUNTIL_OPERATOR_WHILE="wiederhole solange",e.Msg.CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL="Fhrt Anweisungen aus solange die Bedingung unwahr ist.",e.Msg.CONTROLS_WHILEUNTIL_TOOLTIP_WHILE="Fhrt Anweisungen aus solange die Bedingung wahr ist.",e.Msg.DELETE_ALL_BLOCKS="Alle %1 Bausteine lschen?",e.Msg.DELETE_BLOCK="Baustein lschen",e.Msg.DELETE_VARIABLE="Die Variable %1 lschen",e.Msg.DELETE_VARIABLE_CONFIRMATION="%1 Verwendungen der Variable %2 lschen?",e.Msg.DELETE_X_BLOCKS="%1 Bausteine lschen",e.Msg.DISABLE_BLOCK="Baustein deaktivieren",e.Msg.DUPLICATE_BLOCK="Kopieren",e.Msg.DUPLICATE_COMMENT="Kommentar kopieren",e.Msg.ENABLE_BLOCK="Baustein aktivieren",e.Msg.EXPAND_ALL="Alle Bausteine entfalten",e.Msg.EXPAND_BLOCK="Baustein entfalten",e.Msg.EXTERNAL_INPUTS="externe Eingnge",e.Msg.HELP="Hilfe",e.Msg.INLINE_INPUTS="interne Eingnge",e.Msg.IOS_CANCEL="Abbrechen",e.Msg.IOS_ERROR="Fehler",e.Msg.IOS_OK="OK",e.Msg.IOS_PROCEDURES_ADD_INPUT="+ Parameter hinzufgen",e.Msg.IOS_PROCEDURES_ALLOW_STATEMENTS="Anweisungen erlauben",e.Msg.IOS_PROCEDURES_DUPLICATE_INPUTS_ERROR="Diese Funktion hat doppelte Parameter.",e.Msg.IOS_PROCEDURES_INPUTS="PARAMETER",e.Msg.IOS_VARIABLES_ADD_BUTTON="Hinzufgen",e.Msg.IOS_VARIABLES_ADD_VARIABLE="+ Variable hinzufgen",e.Msg.IOS_VARIABLES_DELETE_BUTTON="Lschen",e.Msg.IOS_VARIABLES_EMPTY_NAME_ERROR="Du kannst keinen leeren Variablennamen verwenden.",e.Msg.IOS_VARIABLES_RENAME_BUTTON="Umbenennen",e.Msg.IOS_VARIABLES_VARIABLE_NAME="Name der Variable",e.Msg.LISTS_CREATE_EMPTY_HELPURL="https://github.com/google/blockly/wiki/Lists#create-empty-list",e.Msg.LISTS_CREATE_EMPTY_TITLE="erzeuge eine leere Liste",e.Msg.LISTS_CREATE_EMPTY_TOOLTIP="Erzeugt eine leere Liste ohne Inhalt.",e.Msg.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD="Liste",e.Msg.LISTS_CREATE_WITH_CONTAINER_TOOLTIP="Hinzufgen, entfernen und sortieren von Elementen.",e.Msg.LISTS_CREATE_WITH_HELPURL="https://github.com/google/blockly/wiki/Lists#create-list-with",e.Msg.LISTS_CREATE_WITH_INPUT_WITH="erzeuge Liste mit",e.Msg.LISTS_CREATE_WITH_ITEM_TOOLTIP="Ein Element zur Liste hinzufgen.",e.Msg.LISTS_CREATE_WITH_TOOLTIP="Erzeugt eine Liste aus den angegebenen Elementen.",e.Msg.LISTS_GET_INDEX_FIRST="Erste",e.Msg.LISTS_GET_INDEX_FROM_END="von hinten das",e.Msg.LISTS_GET_INDEX_FROM_START="das",e.Msg.LISTS_GET_INDEX_GET="nimm",e.Msg.LISTS_GET_INDEX_GET_REMOVE="nimm und entferne",e.Msg.LISTS_GET_INDEX_LAST="Letzte",e.Msg.LISTS_GET_INDEX_RANDOM="Zufllig",e.Msg.LISTS_GET_INDEX_REMOVE="entferne",e.Msg.LISTS_GET_INDEX_TAIL="Element",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FIRST="Extrahiert das erste Element aus der Liste.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FROM="Extrahiert das Element an der angegebenen Position in der Liste.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_LAST="Extrahiert das letzte Element aus der Liste.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_RANDOM="Extrahiert ein zuflliges Element aus der Liste.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST="Extrahiert und entfernt das erste Element aus der Liste.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM="Extrahiert und entfernt das Element an der angegebenen Position aus der Liste.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST="Extrahiert und entfernt das letzte Element aus der Liste.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM="Extrahiert und entfernt ein zuflliges Element aus der Liste.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST="Entfernt das erste Element aus der Liste.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM="Entfernt das Element an der angegebenen Position aus der Liste.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST="Entfernt das letzte Element aus der Liste.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM="Entfernt ein zuflliges Element aus der Liste.",e.Msg.LISTS_GET_SUBLIST_END_FROM_END="bis von hinten",e.Msg.LISTS_GET_SUBLIST_END_FROM_START="bis",e.Msg.LISTS_GET_SUBLIST_END_LAST="bis letztes",e.Msg.LISTS_GET_SUBLIST_HELPURL="http://publib.boulder.ibm.com/infocenter/lnxpcomp/v8v101/index.jsp?topic=%2Fcom.ibm.xlcpp8l.doc%2Flanguage%2Fref%2Farsubex.htm",e.Msg.LISTS_GET_SUBLIST_START_FIRST="nimm Teilliste ab erstes",e.Msg.LISTS_GET_SUBLIST_START_FROM_END="nimm Teilliste ab von hinten",e.Msg.LISTS_GET_SUBLIST_START_FROM_START="nimm Teilliste ab",e.Msg.LISTS_GET_SUBLIST_TAIL="Element",e.Msg.LISTS_GET_SUBLIST_TOOLTIP="Erstellt eine Kopie mit dem angegebenen Abschnitt der Liste.",e.Msg.LISTS_INDEX_FROM_END_TOOLTIP="%1 ist das letzte Element.",e.Msg.LISTS_INDEX_FROM_START_TOOLTIP="%1 ist das erste Element.",e.Msg.LISTS_INDEX_OF_FIRST="suche erstes Auftreten von",e.Msg.LISTS_INDEX_OF_HELPURL="http://publib.boulder.ibm.com/infocenter/lnxpcomp/v8v101/index.jsp?topic=%2Fcom.ibm.xlcpp8l.doc%2Flanguage%2Fref%2Farsubex.htm",e.Msg.LISTS_INDEX_OF_LAST="suche letztes Auftreten von",e.Msg.LISTS_INDEX_OF_TOOLTIP="Sucht die Position (Index) eines Elementes in der Liste. Gibt %1 zurck, falls kein Element gefunden wurde.",e.Msg.LISTS_INLIST="in der Liste",e.Msg.LISTS_ISEMPTY_HELPURL="https://github.com/google/blockly/wiki/Lists#is-empty",e.Msg.LISTS_ISEMPTY_TITLE="%1 ist leer",e.Msg.LISTS_ISEMPTY_TOOLTIP="Ist wahr, falls die Liste leer ist.",e.Msg.LISTS_LENGTH_HELPURL="https://github.com/google/blockly/wiki/Lists#length-of",e.Msg.LISTS_LENGTH_TITLE="Lnge von %1",e.Msg.LISTS_LENGTH_TOOLTIP="Die Anzahl von Elementen in der Liste.",e.Msg.LISTS_REPEAT_HELPURL="http://publib.boulder.ibm.com/infocenter/lnxpcomp/v8v101/index.jsp?topic=%2Fcom.ibm.xlcpp8l.doc%2Flanguage%2Fref%2Farsubex.htm",e.Msg.LISTS_REPEAT_TITLE="erzeuge Liste mit %2 mal dem Element %1",e.Msg.LISTS_REPEAT_TOOLTIP="Erzeugt eine Liste mit einer variablen Anzahl von Elementen",e.Msg.LISTS_REVERSE_HELPURL="https://github.com/google/blockly/wiki/Lists#reversing-a-list",e.Msg.LISTS_REVERSE_MESSAGE0="kehre %1 um",e.Msg.LISTS_REVERSE_TOOLTIP="Kehre eine Kopie einer Liste um.",e.Msg.LISTS_SET_INDEX_HELPURL="http://publib.boulder.ibm.com/infocenter/lnxpcomp/v8v101/index.jsp?topic=%2Fcom.ibm.xlcpp8l.doc%2Flanguage%2Fref%2Farsubex.htm",e.Msg.LISTS_SET_INDEX_INPUT_TO="ein",e.Msg.LISTS_SET_INDEX_INSERT="fge als",e.Msg.LISTS_SET_INDEX_SET="setze fr",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST="Fgt das Element an den Anfang der Liste an.",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FROM="Fgt das Element an der angegebenen Position in die Liste ein.",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_LAST="Fgt das Element ans Ende der Liste an.",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM="Fgt das Element zufllig in die Liste ein.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FIRST="Setzt das erste Element in der Liste.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FROM="Setzt das Element an der angegebenen Position in der Liste.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_LAST="Setzt das letzte Element in die Liste.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_RANDOM="Setzt ein zuflliges Element in der Liste.",e.Msg.LISTS_SORT_HELPURL="https://github.com/google/blockly/wiki/Lists#sorting-a-list",e.Msg.LISTS_SORT_ORDER_ASCENDING="aufsteigend",e.Msg.LISTS_SORT_ORDER_DESCENDING="absteigend",e.Msg.LISTS_SORT_TITLE="%1 %2 %3 sortieren",e.Msg.LISTS_SORT_TOOLTIP="Eine Kopie einer Liste sortieren.",e.Msg.LISTS_SORT_TYPE_IGNORECASE="alphabetisch, Groschreibung ignorieren",e.Msg.LISTS_SORT_TYPE_NUMERIC="numerisch",e.Msg.LISTS_SORT_TYPE_TEXT="alphabetisch",e.Msg.LISTS_SPLIT_HELPURL="https://github.com/google/blockly/wiki/Lists#splitting-strings-and-joining-lists",e.Msg.LISTS_SPLIT_LIST_FROM_TEXT="Liste aus Text erstellen",e.Msg.LISTS_SPLIT_TEXT_FROM_LIST="Text aus Liste erstellen",e.Msg.LISTS_SPLIT_TOOLTIP_JOIN="Liste mit Texten in einen Text vereinen, getrennt durch ein Trennzeichen.",e.Msg.LISTS_SPLIT_TOOLTIP_SPLIT="Text in eine Liste mit Texten aufteilen, unterbrochen bei jedem Trennzeichen.",e.Msg.LISTS_SPLIT_WITH_DELIMITER="mit Trennzeichen",e.Msg.LOGIC_BOOLEAN_FALSE="falsch",e.Msg.LOGIC_BOOLEAN_HELPURL="https://github.com/google/blockly/wiki/Logic#values",e.Msg.LOGIC_BOOLEAN_TOOLTIP="Ist entweder wahr oder falsch",e.Msg.LOGIC_BOOLEAN_TRUE="wahr",e.Msg.LOGIC_COMPARE_HELPURL="https://de.wikipedia.org/wiki/Vergleich_%28Zahlen%29",e.Msg.LOGIC_COMPARE_TOOLTIP_EQ="Ist wahr, falls beide Werte gleich sind.",e.Msg.LOGIC_COMPARE_TOOLTIP_GT="Ist wahr, falls der erste Wert grer als der zweite Wert ist.",e.Msg.LOGIC_COMPARE_TOOLTIP_GTE="Ist wahr, falls der erste Wert grer als oder gleich gro wie der zweite Wert ist.",e.Msg.LOGIC_COMPARE_TOOLTIP_LT="Ist wahr, falls der erste Wert kleiner als der zweite Wert ist.",e.Msg.LOGIC_COMPARE_TOOLTIP_LTE="Ist wahr, falls der erste Wert kleiner als oder gleich gro wie der zweite Wert ist.",e.Msg.LOGIC_COMPARE_TOOLTIP_NEQ="Ist wahr, falls beide Werte unterschiedlich sind.",e.Msg.LOGIC_NEGATE_HELPURL="https://github.com/google/blockly/wiki/Logic#not",e.Msg.LOGIC_NEGATE_TITLE="nicht %1",e.Msg.LOGIC_NEGATE_TOOLTIP="Ist wahr, falls der Eingabewert unwahr ist.  Ist unwahr, falls der Eingabewert wahr ist.",e.Msg.LOGIC_NULL="null",e.Msg.LOGIC_NULL_HELPURL="https://de.wikipedia.org/wiki/Nullwert",e.Msg.LOGIC_NULL_TOOLTIP='Ist "null".',e.Msg.LOGIC_OPERATION_AND="und",e.Msg.LOGIC_OPERATION_HELPURL="https://github.com/google/blockly/wiki/Logic#logical-operations",e.Msg.LOGIC_OPERATION_OR="oder",e.Msg.LOGIC_OPERATION_TOOLTIP_AND="Ist wahr, falls beide Werte wahr sind.",e.Msg.LOGIC_OPERATION_TOOLTIP_OR="Ist wahr, falls einer der beiden Werte wahr ist.",e.Msg.LOGIC_TERNARY_CONDITION="prfe",e.Msg.LOGIC_TERNARY_HELPURL="https://de.wikipedia.org/wiki/%3F:#Auswahloperator",e.Msg.LOGIC_TERNARY_IF_FALSE="falls falsch",e.Msg.LOGIC_TERNARY_IF_TRUE="falls wahr",e.Msg.LOGIC_TERNARY_TOOLTIP='berprft eine Bedingung "prfe". Falls die Bedingung wahr ist, wird der "falls wahr" Wert zurckgegeben, andernfalls der "falls unwahr" Wert',e.Msg.MATH_ADDITION_SYMBOL="+",e.Msg.MATH_ARITHMETIC_HELPURL="https://de.wikipedia.org/wiki/Grundrechenart",e.Msg.MATH_ARITHMETIC_TOOLTIP_ADD="Ist die Summe zweier Zahlen.",e.Msg.MATH_ARITHMETIC_TOOLTIP_DIVIDE="Ist der Quotient zweier Zahlen.",e.Msg.MATH_ARITHMETIC_TOOLTIP_MINUS="Ist die Differenz zweier Zahlen.",e.Msg.MATH_ARITHMETIC_TOOLTIP_MULTIPLY="Ist das Produkt zweier Zahlen.",e.Msg.MATH_ARITHMETIC_TOOLTIP_POWER="Ist die erste Zahl potenziert mit der zweiten Zahl.",e.Msg.MATH_ATAN2_HELPURL="https://de.wikipedia.org/wiki/Arctan2",e.Msg.MATH_ATAN2_TITLE="atan2 von X:%1 Y:%2",e.Msg.MATH_ATAN2_TOOLTIP="Gibt den Arkustangens des Punktes (X, Y) in Grad von -180 bis 180 zurck.",e.Msg.MATH_CHANGE_HELPURL="https://de.wikipedia.org/wiki/Inkrement_und_Dekrement",e.Msg.MATH_CHANGE_TITLE="erhhe %1 um %2",e.Msg.MATH_CHANGE_TOOLTIP='Addiert eine Zahl zu "%1".',e.Msg.MATH_CONSTANT_HELPURL="https://de.wikipedia.org/wiki/Mathematische_Konstante",e.Msg.MATH_CONSTANT_TOOLTIP="Mathematische Konstanten wie:  (3.141), e (2.718),  (1.618), sqrt(2) (1.414), sqrt() (0.707) oder  (unendlich).",e.Msg.MATH_CONSTRAIN_HELPURL="https://en.wikipedia.org/wiki/Clamping_(graphics)",e.Msg.MATH_CONSTRAIN_TITLE="begrenze %1 zwischen %2 und %3",e.Msg.MATH_CONSTRAIN_TOOLTIP="Begrenzt eine Zahl auf den Wertebereich zwischen zwei anderen Zahlen (inklusiv).",e.Msg.MATH_DIVISION_SYMBOL="",e.Msg.MATH_IS_DIVISIBLE_BY="ist teilbar durch",e.Msg.MATH_IS_EVEN="ist gerade",e.Msg.MATH_IS_NEGATIVE="ist negativ",e.Msg.MATH_IS_ODD="ist ungerade",e.Msg.MATH_IS_POSITIVE="ist positiv",e.Msg.MATH_IS_PRIME="ist eine Primzahl",e.Msg.MATH_IS_TOOLTIP="berprft ob eine Zahl gerade, ungerade, eine Primzahl, ganzzahlig, positiv, negativ oder durch eine zweite Zahl teilbar ist.  Gibt wahr oder falsch zurck.",e.Msg.MATH_IS_WHOLE="ist eine ganze Zahl",e.Msg.MATH_MODULO_HELPURL="https://de.wikipedia.org/wiki/Modulo",e.Msg.MATH_MODULO_TITLE="Rest von %1  %2",e.Msg.MATH_MODULO_TOOLTIP="Der Rest nach einer Division.",e.Msg.MATH_MULTIPLICATION_SYMBOL="",e.Msg.MATH_NUMBER_HELPURL="https://de.wikipedia.org/wiki/Zahl",e.Msg.MATH_NUMBER_TOOLTIP="Eine Zahl.",e.Msg.MATH_ONLIST_HELPURL="http://www.sysplus.ch/einstieg.php?links=menu&seite=4125&grad=Crash&prog=Excel",e.Msg.MATH_ONLIST_OPERATOR_AVERAGE="Mittelwert der Liste",e.Msg.MATH_ONLIST_OPERATOR_MAX="Maximalwert der Liste",e.Msg.MATH_ONLIST_OPERATOR_MEDIAN="Median der Liste",e.Msg.MATH_ONLIST_OPERATOR_MIN="Minimalwert der Liste",e.Msg.MATH_ONLIST_OPERATOR_MODE="am hufigsten in der Liste",e.Msg.MATH_ONLIST_OPERATOR_RANDOM="Zufallswert aus der Liste",e.Msg.MATH_ONLIST_OPERATOR_STD_DEV="Standardabweichung der Liste",e.Msg.MATH_ONLIST_OPERATOR_SUM="Summe ber die Liste",e.Msg.MATH_ONLIST_TOOLTIP_AVERAGE="Ist der Durchschnittswert aller Zahlen in einer Liste.",e.Msg.MATH_ONLIST_TOOLTIP_MAX="Ist die grte Zahl in einer Liste.",e.Msg.MATH_ONLIST_TOOLTIP_MEDIAN="Ist der Median aller Zahlen in einer Liste.",e.Msg.MATH_ONLIST_TOOLTIP_MIN="Ist die kleinste Zahl in einer Liste.",e.Msg.MATH_ONLIST_TOOLTIP_MODE="Findet die Werte mit dem hufigstem Vorkommen in der Liste.",e.Msg.MATH_ONLIST_TOOLTIP_RANDOM="Gibt einen zuflligen Wert aus der Liste zurck.",e.Msg.MATH_ONLIST_TOOLTIP_STD_DEV="Ist die Standardabweichung aller Werte in der Liste.",e.Msg.MATH_ONLIST_TOOLTIP_SUM="Ist die Summe aller Zahlen in einer Liste.",e.Msg.MATH_POWER_SYMBOL="^",e.Msg.MATH_RANDOM_FLOAT_HELPURL="https://de.wikipedia.org/wiki/Zufallszahlen",e.Msg.MATH_RANDOM_FLOAT_TITLE_RANDOM="Zufallszahl (0.0 - 1.0)",e.Msg.MATH_RANDOM_FLOAT_TOOLTIP="Erzeugt eine Zufallszahl zwischen 0.0 (inklusiv) und 1.0 (exklusiv).",e.Msg.MATH_RANDOM_INT_HELPURL="https://de.wikipedia.org/wiki/Zufallszahlen",e.Msg.MATH_RANDOM_INT_TITLE="ganzzahlige Zufallszahl zwischen %1 und %2",e.Msg.MATH_RANDOM_INT_TOOLTIP="Erzeugt eine ganzzahlige Zufallszahl zwischen zwei Zahlen (inklusiv).",e.Msg.MATH_ROUND_HELPURL="https://de.wikipedia.org/wiki/Runden",e.Msg.MATH_ROUND_OPERATOR_ROUND="runde",e.Msg.MATH_ROUND_OPERATOR_ROUNDDOWN="runde ab",e.Msg.MATH_ROUND_OPERATOR_ROUNDUP="runde auf",e.Msg.MATH_ROUND_TOOLTIP="Eine Zahl auf- oder abrunden.",e.Msg.MATH_SINGLE_HELPURL="https://de.wikipedia.org/wiki/Quadratwurzel",e.Msg.MATH_SINGLE_OP_ABSOLUTE="Betrag",e.Msg.MATH_SINGLE_OP_ROOT="Quadratwurzel",e.Msg.MATH_SINGLE_TOOLTIP_ABS="Ist der Betrag einer Zahl.",e.Msg.MATH_SINGLE_TOOLTIP_EXP="Ist Wert der Exponentialfunktion einer Zahl.",e.Msg.MATH_SINGLE_TOOLTIP_LN="Ist der natrliche Logarithmus einer Zahl.",e.Msg.MATH_SINGLE_TOOLTIP_LOG10="Ist der dekadische Logarithmus einer Zahl.",e.Msg.MATH_SINGLE_TOOLTIP_NEG="Negiert eine Zahl.",e.Msg.MATH_SINGLE_TOOLTIP_POW10="Rechnet 10 hoch eine Zahl.",e.Msg.MATH_SINGLE_TOOLTIP_ROOT="Ist die Quadratwurzel einer Zahl.",e.Msg.MATH_SUBTRACTION_SYMBOL="-",e.Msg.MATH_TRIG_ACOS="acos",e.Msg.MATH_TRIG_ASIN="asin",e.Msg.MATH_TRIG_ATAN="atan",e.Msg.MATH_TRIG_COS="cos",e.Msg.MATH_TRIG_HELPURL="https://de.wikipedia.org/wiki/Trigonometrie",e.Msg.MATH_TRIG_SIN="sin",e.Msg.MATH_TRIG_TAN="tan",e.Msg.MATH_TRIG_TOOLTIP_ACOS="Ist der Arkuskosinus des Eingabewertes.",e.Msg.MATH_TRIG_TOOLTIP_ASIN="Ist der Arkussinus des Eingabewertes.",e.Msg.MATH_TRIG_TOOLTIP_ATAN="Ist der Arkustangens des Eingabewertes.",e.Msg.MATH_TRIG_TOOLTIP_COS="Ist der Kosinus des Winkels.",e.Msg.MATH_TRIG_TOOLTIP_SIN="Ist der Sinus des Winkels (nicht Radiant).",e.Msg.MATH_TRIG_TOOLTIP_TAN="Ist der Tangens des Winkels (nicht Radiant).",e.Msg.NEW_COLOUR_VARIABLE="Farbvariable erstellen ",e.Msg.NEW_NUMBER_VARIABLE="Zahlenvariable erstellen ",e.Msg.NEW_STRING_VARIABLE="Zeichenfolgenvariable erstellen ",e.Msg.NEW_VARIABLE="Variable erstellen ",e.Msg.NEW_VARIABLE_TITLE="Name der neuen Variable:",e.Msg.NEW_VARIABLE_TYPE_TITLE="Neuer Variablentyp:",e.Msg.ORDINAL_NUMBER_SUFFIX=".",e.Msg.PROCEDURES_ALLOW_STATEMENTS="Anweisungen erlauben",e.Msg.PROCEDURES_BEFORE_PARAMS="mit:",e.Msg.PROCEDURES_CALLNORETURN_HELPURL="https://de.wikipedia.org/wiki/Unterprogramm",e.Msg.PROCEDURES_CALLNORETURN_TOOLTIP="Rufe einen Funktionsblock ohne Rckgabewert auf.",e.Msg.PROCEDURES_CALLRETURN_HELPURL="https://de.wikipedia.org/wiki/Unterprogramm",e.Msg.PROCEDURES_CALLRETURN_TOOLTIP="Rufe einen Funktionsblock mit Rckgabewert auf.",e.Msg.PROCEDURES_CALL_BEFORE_PARAMS="mit:",e.Msg.PROCEDURES_CREATE_DO='Erzeuge "Aufruf %1"',e.Msg.PROCEDURES_DEFNORETURN_COMMENT="Beschreibe diese Funktion ",e.Msg.PROCEDURES_DEFNORETURN_DO="",e.Msg.PROCEDURES_DEFNORETURN_HELPURL="https://de.wikipedia.org/wiki/Prozedur_%28Programmierung%29",e.Msg.PROCEDURES_DEFNORETURN_PROCEDURE="etwas tun",e.Msg.PROCEDURES_DEFNORETURN_TITLE="um",e.Msg.PROCEDURES_DEFNORETURN_TOOLTIP="Ein Funktionsblock ohne Rckgabewert.",e.Msg.PROCEDURES_DEFRETURN_HELPURL="https://de.wikipedia.org/wiki/Prozedur_%28Programmierung%29",e.Msg.PROCEDURES_DEFRETURN_RETURN="gib zurck",e.Msg.PROCEDURES_DEFRETURN_TOOLTIP="Ein Funktionsblock mit Rckgabewert.",e.Msg.PROCEDURES_DEF_DUPLICATE_WARNING="Warnung: Dieser Funktionsblock hat zwei gleich benannte Parameter.",e.Msg.PROCEDURES_HIGHLIGHT_DEF="Markiere Funktionsblock",e.Msg.PROCEDURES_IFRETURN_HELPURL="http://c2.com/cgi/wiki?GuardClause",e.Msg.PROCEDURES_IFRETURN_TOOLTIP="Gibt den zweiten Wert zurck und verlsst die Funktion, falls der erste Wert wahr ist.",e.Msg.PROCEDURES_IFRETURN_WARNING="Warnung: Dieser Block darf nur innerhalb eines Funktionsblocks genutzt werden.",e.Msg.PROCEDURES_MUTATORARG_TITLE="Variable:",e.Msg.PROCEDURES_MUTATORARG_TOOLTIP="Eine Eingabe zur Funktion hinzufgen.",e.Msg.PROCEDURES_MUTATORCONTAINER_TITLE="Parameter",e.Msg.PROCEDURES_MUTATORCONTAINER_TOOLTIP="Die Eingaben zu dieser Funktion hinzufgen, entfernen oder neu anordnen.",e.Msg.REDO="Wiederholen",e.Msg.REMOVE_COMMENT="Kommentar entfernen",e.Msg.RENAME_VARIABLE="Variable umbenennen ",e.Msg.RENAME_VARIABLE_TITLE='Alle "%1" Variablen umbenennen in:',e.Msg.TEXT_APPEND_HELPURL="https://github.com/google/blockly/wiki/Text#text-modification",e.Msg.TEXT_APPEND_TITLE="zu %1 Text %2 anhngen",e.Msg.TEXT_APPEND_TOOLTIP='Text an die Variable "%1" anhngen.',e.Msg.TEXT_CHANGECASE_HELPURL="https://github.com/google/blockly/wiki/Text#adjusting-text-case",e.Msg.TEXT_CHANGECASE_OPERATOR_LOWERCASE="wandel um in kleinbuchstaben",e.Msg.TEXT_CHANGECASE_OPERATOR_TITLECASE="wandel um in Substantive",e.Msg.TEXT_CHANGECASE_OPERATOR_UPPERCASE="wandel um in GROSSBUCHSTABEN",e.Msg.TEXT_CHANGECASE_TOOLTIP="Wandelt Schreibweise von Texten um, in Grobuchstaben, Kleinbuchstaben oder den ersten Buchstaben jedes Wortes gro und die anderen klein.",e.Msg.TEXT_CHARAT_FIRST="nimm ersten",e.Msg.TEXT_CHARAT_FROM_END="nimm von hinten",e.Msg.TEXT_CHARAT_FROM_START="nimm",e.Msg.TEXT_CHARAT_HELPURL="http://publib.boulder.ibm.com/infocenter/lnxpcomp/v8v101/index.jsp?topic=%2Fcom.ibm.xlcpp8l.doc%2Flanguage%2Fref%2Farsubex.htm",e.Msg.TEXT_CHARAT_LAST="nimm letzten",e.Msg.TEXT_CHARAT_RANDOM="nimm zuflligen",e.Msg.TEXT_CHARAT_TAIL="Buchstaben",e.Msg.TEXT_CHARAT_TITLE="im Text %1 %2",e.Msg.TEXT_CHARAT_TOOLTIP="Extrahiert einen Buchstaben von einer bestimmten Position.",e.Msg.TEXT_COUNT_HELPURL="https://github.com/google/blockly/wiki/Text#counting-substrings",e.Msg.TEXT_COUNT_MESSAGE0="zhle %1 in %2",e.Msg.TEXT_COUNT_TOOLTIP="Zhle, wie oft ein Text innerhalb eines anderen Textes vorkommt.",e.Msg.TEXT_CREATE_JOIN_ITEM_TOOLTIP="Ein Element zum Text hinzufgen.",e.Msg.TEXT_CREATE_JOIN_TITLE_JOIN="verbinden",e.Msg.TEXT_CREATE_JOIN_TOOLTIP="Hinzufgen, entfernen und sortieren von Elementen.",e.Msg.TEXT_GET_SUBSTRING_END_FROM_END="bis von hinten",e.Msg.TEXT_GET_SUBSTRING_END_FROM_START="bis",e.Msg.TEXT_GET_SUBSTRING_END_LAST="bis letzter",e.Msg.TEXT_GET_SUBSTRING_HELPURL="http://publib.boulder.ibm.com/infocenter/lnxpcomp/v8v101/index.jsp?topic=%2Fcom.ibm.xlcpp8l.doc%2Flanguage%2Fref%2Farsubex.htm",e.Msg.TEXT_GET_SUBSTRING_INPUT_IN_TEXT="im Text",e.Msg.TEXT_GET_SUBSTRING_START_FIRST="nimm Teil ab erster",e.Msg.TEXT_GET_SUBSTRING_START_FROM_END="nimm Teil ab von hinten",e.Msg.TEXT_GET_SUBSTRING_START_FROM_START="nimm Teil ab",e.Msg.TEXT_GET_SUBSTRING_TAIL="Buchstabe",e.Msg.TEXT_GET_SUBSTRING_TOOLTIP="Gibt den angegebenen Textabschnitt zurck.",e.Msg.TEXT_INDEXOF_HELPURL="http://publib.boulder.ibm.com/infocenter/lnxpcomp/v8v101/index.jsp?topic=%2Fcom.ibm.xlcpp8l.doc%2Flanguage%2Fref%2Farsubex.htm",e.Msg.TEXT_INDEXOF_OPERATOR_FIRST="suche erstes Auftreten des Begriffs",e.Msg.TEXT_INDEXOF_OPERATOR_LAST="suche letztes Auftreten des Begriffs",e.Msg.TEXT_INDEXOF_TITLE="im Text %1 %2 %3",e.Msg.TEXT_INDEXOF_TOOLTIP="Findet das erste / letzte Auftreten eines Suchbegriffs in einem Text.  Gibt die Position des Begriffs zurck oder %1 falls der Suchbegriff nicht gefunden wurde.",e.Msg.TEXT_ISEMPTY_HELPURL="https://github.com/google/blockly/wiki/Text#checking-for-empty-text",e.Msg.TEXT_ISEMPTY_TITLE="%1 ist leer",e.Msg.TEXT_ISEMPTY_TOOLTIP="Ist wahr, falls der Text keine Zeichen enthlt.",e.Msg.TEXT_JOIN_HELPURL="",e.Msg.TEXT_JOIN_TITLE_CREATEWITH="erstelle Text aus",e.Msg.TEXT_JOIN_TOOLTIP="Erstellt einen Text durch das Verbinden von mehreren Textelementen.",e.Msg.TEXT_LENGTH_HELPURL="https://github.com/google/blockly/wiki/Text#text-modification",e.Msg.TEXT_LENGTH_TITLE="Lnge von %1",e.Msg.TEXT_LENGTH_TOOLTIP="Die Anzahl von Zeichen in einem Text (inkl. Leerzeichen).",e.Msg.TEXT_PRINT_HELPURL="https://github.com/google/blockly/wiki/Text#printing-text",e.Msg.TEXT_PRINT_TITLE="gib aus %1",e.Msg.TEXT_PRINT_TOOLTIP="Gibt den Text aus.",e.Msg.TEXT_PROMPT_HELPURL="https://github.com/google/blockly/wiki/Text#getting-input-from-the-user",e.Msg.TEXT_PROMPT_TOOLTIP_NUMBER="Fragt den Benutzer nach einer Zahl.",e.Msg.TEXT_PROMPT_TOOLTIP_TEXT="Fragt den Benutzer nach einem Text.",e.Msg.TEXT_PROMPT_TYPE_NUMBER="frage nach Zahl mit Hinweis",e.Msg.TEXT_PROMPT_TYPE_TEXT="frage nach Text mit Hinweis",e.Msg.TEXT_REPLACE_HELPURL="https://github.com/google/blockly/wiki/Text#replacing-substrings",e.Msg.TEXT_REPLACE_MESSAGE0="ersetze %1 durch %2 in %3",e.Msg.TEXT_REPLACE_TOOLTIP="Ersetze alle Vorkommen eines Textes innerhalb eines anderen Textes.",e.Msg.TEXT_REVERSE_HELPURL="https://github.com/google/blockly/wiki/Text#reversing-text",e.Msg.TEXT_REVERSE_MESSAGE0="kehre %1 um",e.Msg.TEXT_REVERSE_TOOLTIP="Kehre die Reihenfolge der Zeichen im Text um.",e.Msg.TEXT_TEXT_HELPURL="https://de.wikipedia.org/wiki/Zeichenkette",e.Msg.TEXT_TEXT_TOOLTIP="Ein Buchstabe, Text oder Satz.",e.Msg.TEXT_TRIM_HELPURL="https://github.com/google/blockly/wiki/Text#trimming-removing-spaces",e.Msg.TEXT_TRIM_OPERATOR_BOTH="entferne Leerzeichen vom Anfang und vom Ende (links und rechts)",e.Msg.TEXT_TRIM_OPERATOR_LEFT="entferne Leerzeichen vom Anfang (links)",e.Msg.TEXT_TRIM_OPERATOR_RIGHT="entferne Leerzeichen vom Ende (rechts)",e.Msg.TEXT_TRIM_TOOLTIP="Entfernt Leerzeichen vom Anfang und / oder Ende eines Textes.",e.Msg.TODAY="Heute",e.Msg.UNDO="Rckgngig",e.Msg.UNNAMED_KEY="unbenannt",e.Msg.VARIABLES_DEFAULT_NAME="Element",e.Msg.VARIABLES_GET_CREATE_SET='Erzeuge "Schreibe %1"',e.Msg.VARIABLES_GET_HELPURL="https://de.wikipedia.org/wiki/Variable_%28Programmierung%29",e.Msg.VARIABLES_GET_TOOLTIP="Gibt den Wert der Variable zurck.",e.Msg.VARIABLES_SET="setze %1 auf %2",e.Msg.VARIABLES_SET_CREATE_GET='Erzeuge "Lese %1"',e.Msg.VARIABLES_SET_HELPURL="https://de.wikipedia.org/wiki/Variable_%28Programmierung%29",e.Msg.VARIABLES_SET_TOOLTIP="Setzt den Wert einer Variable.",e.Msg.VARIABLE_ALREADY_EXISTS="Eine Variable namens %1 ist bereits vorhanden.",e.Msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE="Eine Variable namens %1 ist bereits fr einen anderen Typ vorhanden: %2.",e.Msg.WORKSPACE_ARIA_LABEL="Blockly Arbeitsbereich",e.Msg.WORKSPACE_COMMENT_DEFAULT_TEXT="Teile etwas mit",e.Msg.CONTROLS_FOREACH_INPUT_DO=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.CONTROLS_FOR_INPUT_DO=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.CONTROLS_IF_ELSEIF_TITLE_ELSEIF=e.Msg.CONTROLS_IF_MSG_ELSEIF,e.Msg.CONTROLS_IF_ELSE_TITLE_ELSE=e.Msg.CONTROLS_IF_MSG_ELSE,e.Msg.CONTROLS_IF_IF_TITLE_IF=e.Msg.CONTROLS_IF_MSG_IF,e.Msg.CONTROLS_IF_MSG_THEN=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.CONTROLS_WHILEUNTIL_INPUT_DO=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.LISTS_CREATE_WITH_ITEM_TITLE=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.LISTS_GET_INDEX_HELPURL=e.Msg.LISTS_INDEX_OF_HELPURL,e.Msg.LISTS_GET_INDEX_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.LISTS_GET_SUBLIST_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.LISTS_INDEX_OF_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.LISTS_SET_INDEX_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.MATH_CHANGE_TITLE_ITEM=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.PROCEDURES_DEFRETURN_COMMENT=e.Msg.PROCEDURES_DEFNORETURN_COMMENT,e.Msg.PROCEDURES_DEFRETURN_DO=e.Msg.PROCEDURES_DEFNORETURN_DO,e.Msg.PROCEDURES_DEFRETURN_PROCEDURE=e.Msg.PROCEDURES_DEFNORETURN_PROCEDURE,e.Msg.PROCEDURES_DEFRETURN_TITLE=e.Msg.PROCEDURES_DEFNORETURN_TITLE,e.Msg.TEXT_APPEND_VARIABLE=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.TEXT_CREATE_JOIN_ITEM_TITLE_ITEM=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.MATH_HUE="230",e.Msg.LOOPS_HUE="120",e.Msg.LISTS_HUE="260",e.Msg.LOGIC_HUE="210",e.Msg.VARIABLES_HUE="330",e.Msg.TEXTS_HUE="160",e.Msg.PROCEDURES_HUE="290",e.Msg.COLOUR_HUE="20",e.Msg.VARIABLES_DYNAMIC_HUE="310",e.Msg})}(de$1)),de$1.exports}var deExports=requireDe();const BlocklyLangDE=getDefaultExportFromCjs(deExports),BlocklyCustomEN={UNDO:" Undo",REDO:" Redo",CLEAN_UP:" Clean Up",DELETE_BLOCK:" Delete",DELETE_X_BLOCKS:" Delete %1 blocks",LOAD:" Load program...",SAVE:" Save program...",CODE_EXPORT:" Export code...",INLINE_INPUTS:" Arrange horizontal",EXTERNAL_INPUTS:" Arrange vertical",DUPLICATE_BLOCK:" Clone",ADD_COMMENT:" Comment",REMOVE_COMMENT:" Delete comment",COLLAPSE_BLOCK:" Reduce",EXPAND_BLOCK:" Expand",DISABLE_BLOCK:" Deactivate",ENABLE_BLOCK:" Activate",EXEC_ERROR:"Program exception",EXEC_SUCCESS:"Program finished",EMPTY_PROGRAM:"Empty program",SEE_CONSOLE:"Please find additional details in the browser console.",ROCKSI_CATEGORY_MOVE:"Moving",ROCKSI_CATEGORY_OBJECTS:"Objects",ROCKSI_CATEGORY_LOGIC:"Logic",ROCKSI_CATEGORY_EXTRAS:"Extras",ROCKSI_CATEGORY_EXAMPLES:"Examples",ROCKSI_BLOCK_MOVE:"Move %1",ROCKSI_BLOCK_MOVE_TOOLTIP:"Connect to a joint or task space pose to make the robot move there",ROCKSI_BLOCK_DEFAULTPOSE:"Initial pose",ROCKSI_BLOCK_DEFAULTPOSE_TOOLTIP:"Initial pose of the robot",ROCKSI_BLOCK_JOINTSPACEPOSE_TOOLTIP:"A joint space pose, i.e. one angle per joint starting from the base",ROCKSI_BLOCK_TASKSPACEPOSE_TOOLTIP:"A task space pose, i.e. a position and orientation in space",ROCKSI_BLOCK_JOINTABSOLUTE:"Joint angle (absolute) %1 %2",ROCKSI_BLOCK_JOINTABSOLUTE_TOOLTIP:"Move a single joint to a set angle",ROCKSI_BLOCK_JOINTRELATIVE:"Joint angle (relative) %1 %2",ROCKSI_BLOCK_JOINTRELATIVE_TOOLTIP:"Move a single joint by a given amount",ROCKSI_BLOCK_GRIPPEROPEN:"Gripper open",ROCKSI_BLOCK_GRIPPEROPEN_TOOLTIP:"Opens the gripper to its full width",ROCKSI_BLOCK_GRIPPERCLOSE:"Gripper close",ROCKSI_BLOCK_GRIPPERCLOSE_TOOLTIP:"Completely closes the gripper",ROCKSI_BLOCK_SIMOBJECT:"Place a %1",ROCKSI_BLOCK_SIMOBJECT_CUBE:"Cube",ROCKSI_BLOCK_SIMOBJECT_SPHERE:"Sphere",ROCKSI_BLOCK_SIMOBJECT_ROCK:"Rock",ROCKSI_BLOCK_SIMOBJECT_SHAFT:"Shaft",ROCKSI_BLOCK_SIMOBJECT_CUSTOM:"Custom object...",ROCKSI_BLOCK_SIMOBJECT_COLOR:"with color %1",ROCKSI_BLOCK_SIMOBJECT_POSITION:"at position %1",ROCKSI_BLOCK_SIMOBJECT_SCALE:"scaled by %1",ROCKSI_BLOCK_SIMOBJECT_TOOLTIP:"Adds an object to the scene that can be grabbed by the robot",ROCKSI_BLOCK_PHYSICSDONE:"Physics simulation done?",ROCKSI_BLOCK_PHYSICSDONE_TOOLTIP:"Returns true once all objects stopped moving (not considering the robot)",ROCKSI_BLOCK_HOLDING:"Holding?",ROCKSI_BLOCK_HOLDING_TOOLTIP:"Returns true if the robot is holding an object",ROCKSI_BLOCK_COMMENT:"Comment %1",ROCKSI_BLOCK_COMMENT_TOOLTIP:"Comment, ignored during execution",ROCKSI_BLOCK_WAIT:"Wait %1 seconds",ROCKSI_BLOCK_WAIT_TOOLTIP:"Waits some time before executing the next block",ROCKSI_BLOCK_SETSPEED:"Set speed of %1 to %2 %%",ROCKSI_BLOCK_SETSPEED_MOVE:"Moving",ROCKSI_BLOCK_SETSPEED_GRIPPER:"Grasping",ROCKSI_BLOCK_SETSPEED_TOOLTIP:"Changes the speed at which the robot moves",ROCKSI_BLOCK_JOINTLOCK:"Lock %1",ROCKSI_BLOCK_JOINTLOCK_TOOLTIP:"Prevents a joint from moving during program execution",ROCKSI_BLOCK_JOINTUNLOCK:"Unlock %1",ROCKSI_BLOCK_JOINTUNLOCK_TOOLTIP:"Allows a joint to move again during program execution",ROCKSI_BLOCK_SCALE:"%1",ROCKSI_BLOCK_SCALE_TOOLTIP:"A factor",ROCKSI_EXAMPLE_PICK_N_PLACE:"Pick & Place: picking up and letting go of an object",ROCKSI_EXAMPLE_PICK_N_PLACE_COMMENT_1:"Jointspace poses will always be more reliable!"},BlocklyCustomDE={UNDO:" Rckgngig",REDO:" Wiederholen",CLEAN_UP:" Aufrumen",DELETE_BLOCK:" Lschen",DELETE_X_BLOCKS:" Lsche %1 Blcke",LOAD:" Programm laden",SAVE:" Programm speichern",CODE_EXPORT:" Code exportieren",INLINE_INPUTS:" Horizontal anordnen",EXTERNAL_INPUTS:" Vertikal anordnen",DUPLICATE_BLOCK:" Klonen",ADD_COMMENT:" Kommentar",REMOVE_COMMENT:" Kommentar lschen",COLLAPSE_BLOCK:" Reduzieren",EXPAND_BLOCK:" Erweitern",DISABLE_BLOCK:" Deaktivieren",ENABLE_BLOCK:" Aktivieren",EXEC_ERROR:"Programmfehler",EXEC_SUCCESS:"Programm abgeschlossen",EMPTY_PROGRAM:"Leeres Programm",SEE_CONSOLE:"Weitere Details in der Browser-Konsole.",ROCKSI_CATEGORY_MOVE:"Bewegung",ROCKSI_CATEGORY_OBJECTS:"Objekte",ROCKSI_CATEGORY_LOGIC:"Logik",ROCKSI_CATEGORY_EXTRAS:"Extras",ROCKSI_CATEGORY_EXAMPLES:"Beispiele",ROCKSI_BLOCK_MOVE:"Bewegung %1",ROCKSI_BLOCK_MOVE_TOOLTIP:"Fge rechts eine Joint oder Task Space Pose hinzu, zu der sich der Roboter bewegen soll",ROCKSI_BLOCK_DEFAULTPOSE:"Startpose",ROCKSI_BLOCK_DEFAULTPOSE_TOOLTIP:"Die Standard-Pose des Roboters",ROCKSI_BLOCK_JOINTSPACEPOSE_TOOLTIP:"Eine Pose im Gelenkwinkelraum (ein Winkel pro Gelenk beginnend an der Basis)",ROCKSI_BLOCK_TASKSPACEPOSE_TOOLTIP:"Eine Pose im Arbeitsraum (Position und Orientierung im Raum)",ROCKSI_BLOCK_JOINTABSOLUTE:"Gelenkwinkel (absolut) %1 %2",ROCKSI_BLOCK_JOINTABSOLUTE_TOOLTIP:"Bewege ein einzelnes Gelenk in eine bestimmte Position",ROCKSI_BLOCK_JOINTRELATIVE:"Gelenkwinkel (relativ) %1 %2",ROCKSI_BLOCK_JOINTRELATIVE_TOOLTIP:"Drehe ein einzelnes Gelenk um den angegebenen Winkel",ROCKSI_BLOCK_GRIPPEROPEN:"Greifer ffnen",ROCKSI_BLOCK_GRIPPEROPEN_TOOLTIP:"ffnet den Greifer auf volle Weite",ROCKSI_BLOCK_GRIPPERCLOSE:"Greifer schlieen",ROCKSI_BLOCK_GRIPPERCLOSE_TOOLTIP:"Schliet den Greifer vollstndig",ROCKSI_BLOCK_SIMOBJECT:"Platziere einen %1",ROCKSI_BLOCK_SIMOBJECT_CUBE:"Wrfel",ROCKSI_BLOCK_SIMOBJECT_SPHERE:"Kugel",ROCKSI_BLOCK_SIMOBJECT_ROCK:"Stein",ROCKSI_BLOCK_SIMOBJECT_SHAFT:"Welle",ROCKSI_BLOCK_SIMOBJECT_CUSTOM:"Eigenes Objekt...",ROCKSI_BLOCK_SIMOBJECT_COLOR:"in der Farbe %1",ROCKSI_BLOCK_SIMOBJECT_POSITION:"an Position %1",ROCKSI_BLOCK_SIMOBJECT_SCALE:"in der Skalierung %1",ROCKSI_BLOCK_SIMOBJECT_TOOLTIP:"Fgt ein Objekt hinzu, dass der Roboter greifen kann",ROCKSI_BLOCK_PHYSICSDONE:"Physiksimulation abgeschlossen?",ROCKSI_BLOCK_PHYSICSDONE_TOOLTIP:"Gibt Wahr zurck sobald sich kein Objekt mehr bewegt (ausgeschlossen der Roboter)",ROCKSI_BLOCK_HOLDING:"Gegriffen?",ROCKSI_BLOCK_HOLDING_TOOLTIP:"Gibt Wahr zurck wenn der Roboter etwas gegriffen hat",ROCKSI_BLOCK_COMMENT:"Kommentar %1",ROCKSI_BLOCK_COMMENT_TOOLTIP:"Kommentar, hat keine Auswirkungen",ROCKSI_BLOCK_WAIT:"Warte %1 Sekunden",ROCKSI_BLOCK_WAIT_TOOLTIP:"Warte eine bestimmte Zeit, bevor der nchste Block ausgefhrt wird",ROCKSI_BLOCK_SETSPEED:"Geschwindigkeit %1 %2 %%",ROCKSI_BLOCK_SETSPEED_MOVE:"Bewegung",ROCKSI_BLOCK_SETSPEED_GRIPPER:"Greifer",ROCKSI_BLOCK_SETSPEED_TOOLTIP:"ndere die Bewegungsgeschwindigkeit des Roboters",ROCKSI_BLOCK_JOINTLOCK:"Sperre %1",ROCKSI_BLOCK_JOINTLOCK_TOOLTIP:"Verhindert nderungen des Gelenkwinkels fr das gewhlte Gelenk",ROCKSI_BLOCK_JOINTUNLOCK:"Entsperre %1",ROCKSI_BLOCK_JOINTUNLOCK_TOOLTIP:"Erlaubt nderungen des Gelenkwinkels fr das gewhlte Gelenk",ROCKSI_BLOCK_SCALE:"%1",ROCKSI_BLOCK_SCALE_TOOLTIP:"Ein Faktor",ROCKSI_EXAMPLE_PICK_N_PLACE:"Pick & Place: ein Objekt aufheben und loslassen",ROCKSI_EXAMPLE_PICK_N_PLACE_COMMENT_1:"Eine Gelenkwinkelpose ist immer zuverlssiger!"};var jsInterpreter$1={exports:{}},jsInterpreter=jsInterpreter$1.exports,hasRequiredJsInterpreter;function requireJsInterpreter(){return hasRequiredJsInterpreter||(hasRequiredJsInterpreter=1,function(module,exports){(function(n,t){module.exports=t()})(jsInterpreter,function(){return function(l){var n={};function t(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return l[e].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=l,t.c=n,t.d=function(e,i,s){t.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:s})},t.r=function(e){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,i){if(i&1&&(e=t(e)),i&8||i&4&&typeof e=="object"&&e&&e.__esModule)return e;var s=Object.create(null);if(t.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),i&2&&typeof e!="string")for(var r in e)t.d(s,r,(function(o){return e[o]}).bind(null,r));return s},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)},t.p="",t(t.s="./src/js-interpreter.js")}({"./node_modules/vm-browserify/index.js":function(module,exports){var indexOf=function(l,n){if(l.indexOf)return l.indexOf(n);for(var t=0;t<l.length;t++)if(l[t]===n)return t;return-1},Object_keys=function(l){if(Object.keys)return Object.keys(l);var n=[];for(var t in l)n.push(t);return n},forEach=function(l,n){if(l.forEach)return l.forEach(n);for(var t=0;t<l.length;t++)n(l[t],t,l)},defineProp=function(){try{return Object.defineProperty({},"_",{}),function(l,n,t){Object.defineProperty(l,n,{writable:!0,enumerable:!1,configurable:!0,value:t})}}catch{return function(n,t,e){n[t]=e}}}(),globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];function Context(){}Context.prototype={};var Script=exports.Script=function(n){if(!(this instanceof Script))return new Script(n);this.code=n};Script.prototype.runInContext=function(l){if(!(l instanceof Context))throw new TypeError("needs a 'context' argument.");var n=document.createElement("iframe");n.style||(n.style={}),n.style.display="none",document.body.appendChild(n);var t=n.contentWindow,e=t.eval,i=t.execScript;!e&&i&&(i.call(t,"null"),e=t.eval),forEach(Object_keys(l),function(o){t[o]=l[o]}),forEach(globals,function(o){l[o]&&(t[o]=l[o])});var s=Object_keys(t),r=e.call(t,this.code);return forEach(Object_keys(t),function(o){(o in l||indexOf(s,o)===-1)&&(l[o]=t[o])}),forEach(globals,function(o){o in l||defineProp(l,o,t[o])}),document.body.removeChild(n),r},Script.prototype.runInThisContext=function(){return eval(this.code)},Script.prototype.runInNewContext=function(l){var n=Script.createContext(l),t=this.runInContext(n);return l&&forEach(Object_keys(n),function(e){l[e]=n[e]}),t},forEach(Object_keys(Script.prototype),function(l){exports[l]=Script[l]=function(n){var t=Script(n);return t[l].apply(t,[].slice.call(arguments,1))}}),exports.isContext=function(l){return l instanceof Context},exports.createScript=function(l){return exports.Script(l)},exports.createContext=Script.createContext=function(l){var n=new Context;return typeof l=="object"&&forEach(Object_keys(l),function(t){n[t]=l[t]}),n}},"./original-repo/acorn.js":function(l,n,t){(function(e,i){return i(n)})(this,function(e){e.version="0.4.1";var i,s,r,o;e.parse=function(j,K){return s=String(j),r=s.length,u(K),Oe(),Nt(i.program)};var h=e.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null};function u(j){i=j||{};for(var K in h)Object.prototype.hasOwnProperty.call(i,K)||(i[K]=h[K]);o=i.sourceFile||null}var p=e.getLineInfo=function(j,K){for(var lt=1,Et=0;;){Xt.lastIndex=Et;var $t=Xt.exec(j);if($t&&$t.index<K)++lt,Et=$t.index+$t[0].length;else break}return{line:lt,column:K-Et}};e.tokenize=function(j,K){s=String(j),r=s.length,u(K),Oe();var lt={};function Et($t){return De($t),lt.start=f,lt.end=g,lt.startLoc=_,lt.endLoc=v,lt.type=y,lt.value=E,lt}return Et.jumpTo=function($t,Zt){if(d=$t,i.locations){x=1,C=Xt.lastIndex=0;for(var ie;(ie=Xt.exec(s))&&ie.index<$t;)++x,C=ie.index+ie[0].length}m=Zt,Le()},Et};var d,f,g,_,v,y,E,m,x,C,O,S,P,F,V,N;function B(j,K){var lt=p(s,j);K+=" ("+lt.line+":"+lt.column+")";var Et=new SyntaxError(K);throw Et.pos=j,Et.loc=lt,Et.raisedAt=d,Et}var W=[],A={type:"num"},G={type:"regexp"},D={type:"string"},M={type:"name"},J={type:"eof"},et={keyword:"break"},Q={keyword:"case",beforeExpr:!0},ot={keyword:"catch"},tt={keyword:"continue"},rt={keyword:"debugger"},ft={keyword:"default"},_t={keyword:"do",isLoop:!0},yt={keyword:"else",beforeExpr:!0},Z={keyword:"finally"},bt={keyword:"for",isLoop:!0},at={keyword:"function"},nt={keyword:"if"},ht={keyword:"return",beforeExpr:!0},Ct={keyword:"switch"},gt={keyword:"throw",beforeExpr:!0},mt={keyword:"try"},Rt={keyword:"var"},Ft={keyword:"while",isLoop:!0},Pt={keyword:"with"},X={keyword:"new",beforeExpr:!0},z={keyword:"this"},vt={keyword:"null",atomValue:null},St={keyword:"true",atomValue:!0},Dt={keyword:"false",atomValue:!1},kt={keyword:"in",binop:7,beforeExpr:!0},Wt={break:et,case:Q,catch:ot,continue:tt,debugger:rt,default:ft,do:_t,else:yt,finally:Z,for:bt,function:at,if:nt,return:ht,switch:Ct,throw:gt,try:mt,var:Rt,while:Ft,with:Pt,null:vt,true:St,false:Dt,new:X,in:kt,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:z,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},Y={type:"[",beforeExpr:!0},At={type:"]"},Mt={type:"{",beforeExpr:!0},q={type:"}"},xt={type:"(",beforeExpr:!0},pt={type:")"},Bt={type:",",beforeExpr:!0},Ot={type:";",beforeExpr:!0},te={type:":",beforeExpr:!0},ce={type:"."},Ee={type:"?",beforeExpr:!0},Ie={binop:10,beforeExpr:!0},fe={isAssign:!0,beforeExpr:!0},Te={isAssign:!0,beforeExpr:!0},we={postfix:!0,prefix:!0,isUpdate:!0},$e={prefix:!0,beforeExpr:!0},Fe={binop:1,beforeExpr:!0},ze={binop:2,beforeExpr:!0},Ae={binop:3,beforeExpr:!0},Ze={binop:4,beforeExpr:!0},ni={binop:5,beforeExpr:!0},Be={binop:6,beforeExpr:!0},Qe={binop:7,beforeExpr:!0},Re={binop:8,beforeExpr:!0},Xe={binop:9,prefix:!0,beforeExpr:!0},ti={binop:10,beforeExpr:!0};e.tokTypes={bracketL:Y,bracketR:At,braceL:Mt,braceR:q,parenL:xt,parenR:pt,comma:Bt,semi:Ot,colon:te,dot:ce,question:Ee,slash:Ie,eq:fe,name:M,eof:J,num:A,regexp:G,string:D};for(var ei in Wt)e.tokTypes["_"+ei]=Wt[ei];function Ue(j){j=j.split(" ");var K="",lt=[];t:for(var Et=0;Et<j.length;++Et){for(var $t=0;$t<lt.length;++$t)if(lt[$t][0].length==j[Et].length){lt[$t].push(j[Et]);continue t}lt.push([j[Et]])}function Zt(ge){if(ge.length==1)return K+="return str === "+JSON.stringify(ge[0])+";";K+="switch(str){";for(var Ne=0;Ne<ge.length;++Ne)K+="case "+JSON.stringify(ge[Ne])+":";K+="return true}return false;"}if(lt.length>3){lt.sort(function(ge,Ne){return Ne.length-ge.length}),K+="switch(str.length){";for(var Et=0;Et<lt.length;++Et){var ie=lt[Et];K+="case "+ie[0].length+":",Zt(ie)}K+="}"}else Zt(j);return new Function("str",K)}var H=Ue("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),ct=Ue("class enum extends super const export import"),st=Ue("implements interface let package private protected public static yield"),ut=Ue("eval arguments"),Lt=Ue("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),oe=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,ee="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",Yt="------------------------------------------------------------------------------------------------------------------------------------------",ne=new RegExp("["+ee+"]"),jt=new RegExp("["+ee+Yt+"]"),se=/[\n\r\u2028\u2029]/,Xt=/\r\n|[\n\r\u2028\u2029]/g,ae=e.isIdentifierStart=function(j){return j<65?j===36:j<91?!0:j<97?j===95:j<123?!0:j>=170&&ne.test(String.fromCharCode(j))},Ce=e.isIdentifierChar=function(j){return j<48?j===36:j<58?!0:j<65?!1:j<91?!0:j<97?j===95:j<123?!0:j>=170&&jt.test(String.fromCharCode(j))};function _e(){this.line=x,this.column=d-C}function Oe(){x=1,d=C=0,m=!0,Le()}function Jt(j,K){g=d,i.locations&&(v=new _e),y=j,Le(),E=K,m=j.beforeExpr}function xe(){var j=i.onComment&&i.locations&&new _e,K=d,lt=s.indexOf("*/",d+=2);if(lt===-1&&B(d-2,"Unterminated comment"),d=lt+2,i.locations){Xt.lastIndex=K;for(var Et;(Et=Xt.exec(s))&&Et.index<d;)++x,C=Et.index+Et[0].length}i.onComment&&i.onComment(!0,s.slice(K+2,lt),K,d,j,i.locations&&new _e)}function me(){for(var j=d,K=i.onComment&&i.locations&&new _e,lt=s.charCodeAt(d+=2);d<r&&lt!==10&&lt!==13&&lt!==8232&&lt!==8233;)++d,lt=s.charCodeAt(d);i.onComment&&i.onComment(!1,s.slice(j+2,d),j,d,K,i.locations&&new _e)}function Le(){for(;d<r;){var j=s.charCodeAt(d);if(j===32)++d;else if(j===13){++d;var K=s.charCodeAt(d);K===10&&++d,i.locations&&(++x,C=d)}else if(j===10||j===8232||j===8233)++d,i.locations&&(++x,C=d);else if(j>8&&j<14)++d;else if(j===47){var K=s.charCodeAt(d+1);if(K===42)xe();else if(K===47)me();else break}else if(j===160)++d;else if(j>=5760&&oe.test(String.fromCharCode(j)))++d;else break}}function Ve(){var j=s.charCodeAt(d+1);return j>=48&&j<=57?ci(!0):(++d,Jt(ce))}function Pe(){var j=s.charCodeAt(d+1);return m?(++d,si()):j===61?ye(Te,2):ye(Ie,1)}function di(){var j=s.charCodeAt(d+1);return j===61?ye(Te,2):ye(ti,1)}function fi(j){var K=s.charCodeAt(d+1);return K===j?ye(j===124?Fe:ze,2):K===61?ye(Te,2):ye(j===124?Ae:ni,1)}function gi(){var j=s.charCodeAt(d+1);return j===61?ye(Te,2):ye(Ze,1)}function ai(j){var K=s.charCodeAt(d+1);return K===j?K==45&&s.charCodeAt(d+2)==62&&se.test(s.slice(S,d))?(d+=3,me(),Le(),De()):ye(we,2):K===61?ye(Te,2):ye(Xe,1)}function li(j){var K=s.charCodeAt(d+1),lt=1;return K===j?(lt=j===62&&s.charCodeAt(d+2)===62?3:2,s.charCodeAt(d+lt)===61?ye(Te,lt+1):ye(Re,lt)):K==33&&j==60&&s.charCodeAt(d+2)==45&&s.charCodeAt(d+3)==45?(d+=4,me(),Le(),De()):(K===61&&(lt=s.charCodeAt(d+2)===61?3:2),ye(Qe,lt))}function Ge(j){var K=s.charCodeAt(d+1);return K===61?ye(Be,s.charCodeAt(d+2)===61?3:2):ye(j===61?fe:$e,1)}function _i(j){switch(j){case 46:return Ve();case 40:return++d,Jt(xt);case 41:return++d,Jt(pt);case 59:return++d,Jt(Ot);case 44:return++d,Jt(Bt);case 91:return++d,Jt(Y);case 93:return++d,Jt(At);case 123:return++d,Jt(Mt);case 125:return++d,Jt(q);case 58:return++d,Jt(te);case 63:return++d,Jt(Ee);case 48:var K=s.charCodeAt(d+1);if(K===120||K===88)return mi();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return ci(!1);case 34:case 39:return hi(j);case 47:return Pe();case 37:case 42:return di();case 124:case 38:return fi(j);case 94:return gi();case 43:case 45:return ai(j);case 60:case 62:return li(j);case 61:case 33:return Ge(j);case 126:return ye($e,1)}return!1}function De(j){if(j?d=f+1:f=d,i.locations&&(_=new _e),j)return si();if(d>=r)return Jt(J);var K=s.charCodeAt(d);if(ae(K)||K===92)return ri();var lt=_i(K);if(lt===!1){var Et=String.fromCharCode(K);if(Et==="\\"||ne.test(Et))return ri();B(d,"Unexpected character '"+Et+"'")}return lt}function ye(j,K){var lt=s.slice(d,d+K);d+=K,Jt(j,lt)}function si(){for(var $t="",j,K,lt=d;;){d>=r&&B(lt,"Unterminated regular expression");var Et=s.charAt(d);if(se.test(Et)&&B(lt,"Unterminated regular expression"),j)j=!1;else{if(Et==="[")K=!0;else if(Et==="]"&&K)K=!1;else if(Et==="/"&&!K)break;j=Et==="\\"}++d}var $t=s.slice(lt,d);++d;var Zt=ui();return Zt&&!/^[gmsiy]*$/.test(Zt)&&B(lt,"Invalid regexp flag"),Jt(G,new RegExp($t,Zt))}function je(j,K){for(var lt=d,Et=0,$t=0,Zt=K??1/0;$t<Zt;++$t){var ie=s.charCodeAt(d),ge;if(ie>=97?ge=ie-97+10:ie>=65?ge=ie-65+10:ie>=48&&ie<=57?ge=ie-48:ge=1/0,ge>=j)break;++d,Et=Et*j+ge}return d===lt||K!=null&&d-lt!==K?null:Et}function mi(){d+=2;var j=je(16);return j==null&&B(f+2,"Expected hexadecimal number"),ae(s.charCodeAt(d))&&B(d,"Identifier directly after number"),Jt(A,j)}function ci(j){var K=d,lt=!1,Et=s.charCodeAt(d)===48;!j&&je(10)===null&&B(K,"Invalid number"),s.charCodeAt(d)===46&&(++d,je(10),lt=!0);var $t=s.charCodeAt(d);($t===69||$t===101)&&($t=s.charCodeAt(++d),($t===43||$t===45)&&++d,je(10)===null&&B(K,"Invalid number"),lt=!0),ae(s.charCodeAt(d))&&B(d,"Identifier directly after number");var Zt=s.slice(K,d),ie;return lt?ie=parseFloat(Zt):!Et||Zt.length===1?ie=parseInt(Zt,10):/[89]/.test(Zt)||N?B(K,"Invalid number"):ie=parseInt(Zt,8),Jt(A,ie)}function hi(j){d++;for(var K="";;){d>=r&&B(f,"Unterminated string constant");var lt=s.charCodeAt(d);if(lt===j)return++d,Jt(D,K);if(lt===92){lt=s.charCodeAt(++d);var Et=/^[0-7]+/.exec(s.slice(d,d+3));for(Et&&(Et=Et[0]);Et&&parseInt(Et,8)>255;)Et=Et.slice(0,-1);if(Et==="0"&&(Et=null),++d,Et)N&&B(d-2,"Octal literal in strict mode"),K+=String.fromCharCode(parseInt(Et,8)),d+=Et.length-1;else switch(lt){case 110:K+=`
`;break;case 114:K+="\r";break;case 120:K+=String.fromCharCode(ve(2));break;case 117:K+=String.fromCharCode(ve(4));break;case 85:K+=String.fromCharCode(ve(8));break;case 116:K+="	";break;case 98:K+="\b";break;case 118:K+="\v";break;case 102:K+="\f";break;case 48:K+="\0";break;case 13:s.charCodeAt(d)===10&&++d;case 10:i.locations&&(C=d,++x);break;default:K+=String.fromCharCode(lt);break}}else(lt===13||lt===10||lt===8232||lt===8233)&&B(f,"Unterminated string constant"),K+=String.fromCharCode(lt),++d}}function ve(j){var K=je(16,j);return K===null&&B(f,"Bad character escape sequence"),K}var ke;function ui(){ke=!1;for(var j,K=!0,lt=d;;){var Et=s.charCodeAt(d);if(Ce(Et))ke&&(j+=s.charAt(d)),++d;else if(Et===92){ke||(j=s.slice(lt,d)),ke=!0,s.charCodeAt(++d)!=117&&B(d,"Expecting Unicode escape sequence \\uXXXX"),++d;var $t=ve(4),Zt=String.fromCharCode($t);Zt||B(d-1,"Invalid Unicode escape"),(K?ae($t):Ce($t))||B(d-4,"Invalid Unicode escape"),j+=Zt}else break;K=!1}return ke?j:s.slice(lt,d)}function ri(){var j=ui(),K=M;return ke||(Lt(j)?K=Wt[j]:(i.forbidReserved&&(i.ecmaVersion===3?H:ct)(j)||N&&st(j))&&B(f,"The keyword '"+j+"' is reserved")),Jt(K,j)}function le(){O=f,S=g,P=v,De()}function Ye(j){if(N=j,d=S,i.locations)for(;d<C;)C=s.lastIndexOf(`
`,C-2)+1,--x;Le(),De()}function Ke(){this.type=null,this.start=f,this.end=null}function oi(){this.start=_,this.end=null,o!==null&&(this.source=o)}function be(){var j=new Ke;return i.locations&&(j.loc=new oi),i.directSourceFile&&(j.sourceFile=i.directSourceFile),i.ranges&&(j.range=[f,0]),j}function Gt(j){var K=new Ke;return K.start=j.start,i.locations&&(K.loc=new oi,K.loc.start=j.loc.start),i.ranges&&(K.range=[j.range[0],0]),K}function Qt(j,K){return j.type=K,j.end=S,i.locations&&(j.loc.end=P),i.ranges&&(j.range[1]=S),j}function I(j){return i.ecmaVersion>=5&&j.type==="ExpressionStatement"&&j.expression.type==="Literal"&&j.expression.value==="use strict"}function w(j){if(y===j)return le(),!0}function k(){return!i.strictSemicolons&&(y===J||y===q||se.test(s.slice(S,f)))}function U(){!w(Ot)&&!k()&&it()}function L(j){y===j?le():it()}function it(){B(f,"Unexpected token")}function Tt(j){j.type!=="Identifier"&&j.type!=="MemberExpression"&&B(j.start,"Assigning to rvalue"),N&&j.type==="Identifier"&&ut(j.name)&&B(j.start,"Assigning to "+j.name+" in strict mode")}function Nt(j){O=S=d,i.locations&&(P=new _e),F=N=null,V=[],De();var K=j||be(),lt=!0;for(j||(K.body=[]);y!==J;){var Et=wt();K.body.push(Et),lt&&I(Et)&&Ye(!0),lt=!1}return Qt(K,"Program")}var Vt={kind:"loop"},Ht={kind:"switch"};function wt(){(y===Ie||y===Te&&E=="/=")&&De(!0);var j=y,K=be();switch(j){case et:case tt:le();var lt=j===et;w(Ot)||k()?K.label=null:y!==M?it():(K.label=We(),U());for(var Et=0;Et<V.length;++Et){var $t=V[Et];if((K.label==null||$t.name===K.label.name)&&($t.kind!=null&&(lt||$t.kind==="loop")||K.label&&lt))break}return Et===V.length&&B(K.start,"Unsyntactic "+j.keyword),Qt(K,lt?"BreakStatement":"ContinueStatement");case rt:return le(),U(),Qt(K,"DebuggerStatement");case _t:return le(),V.push(Vt),K.body=wt(),V.pop(),L(Ft),K.test=It(),U(),Qt(K,"DoWhileStatement");case bt:if(le(),V.push(Vt),L(xt),y===Ot)return Ut(K,null);if(y===Rt){var Zt=be();return le(),zt(Zt,!0),Qt(Zt,"VariableDeclaration"),Zt.declarations.length===1&&w(kt)?qt(K,Zt):Ut(K,Zt)}var Zt=re(!1,!0);return w(kt)?(Tt(Zt),qt(K,Zt)):Ut(K,Zt);case at:return le(),vi(K,!0);case nt:return le(),K.test=It(),K.consequent=wt(),K.alternate=w(yt)?wt():null,Qt(K,"IfStatement");case ht:return F||B(f,"'return' outside of function"),le(),w(Ot)||k()?K.argument=null:(K.argument=re(),U()),Qt(K,"ReturnStatement");case Ct:le(),K.discriminant=It(),K.cases=[],L(Mt),V.push(Ht);for(var ie,ge;y!=q;)if(y===Q||y===ft){var Ne=y===Q;ie&&Qt(ie,"SwitchCase"),K.cases.push(ie=be()),ie.consequent=[],le(),Ne?ie.test=re():(ge&&B(O,"Multiple default clauses"),ge=!0,ie.test=null),L(te)}else ie||it(),ie.consequent.push(wt());return ie&&Qt(ie,"SwitchCase"),le(),V.pop(),Qt(K,"SwitchStatement");case gt:return le(),se.test(s.slice(S,f))&&B(S,"Illegal newline after throw"),K.argument=re(),U(),Qt(K,"ThrowStatement");case mt:if(le(),K.block=Kt(),K.handler=null,y===ot){var qe=be();le(),L(xt),qe.param=We(),N&&ut(qe.param.name)&&B(qe.param.start,"Binding "+qe.param.name+" in strict mode"),L(pt),qe.guard=null,qe.body=Kt(),K.handler=Qt(qe,"CatchClause")}return K.guardedHandlers=W,K.finalizer=w(Z)?Kt():null,!K.handler&&!K.finalizer&&B(K.start,"Missing catch or finally clause"),Qt(K,"TryStatement");case Rt:return le(),zt(K),U(),Qt(K,"VariableDeclaration");case Ft:return le(),K.test=It(),V.push(Vt),K.body=wt(),V.pop(),Qt(K,"WhileStatement");case Pt:return N&&B(f,"'with' in strict mode"),le(),K.object=It(),K.body=wt(),Qt(K,"WithStatement");case Mt:return Kt();case Ot:return le(),Qt(K,"EmptyStatement");default:var Ti=E,pi=re();if(j===M&&pi.type==="Identifier"&&w(te)){for(var Et=0;Et<V.length;++Et)V[Et].name===Ti&&B(pi.start,"Label '"+Ti+"' is already declared");var Ri=y.isLoop?"loop":y===Ct?"switch":null;return V.push({name:Ti,kind:Ri}),K.body=wt(),V.pop(),K.label=pi,Qt(K,"LabeledStatement")}else return K.expression=pi,U(),Qt(K,"ExpressionStatement")}}function It(){L(xt);var j=re();return L(pt),j}function Kt(j){var K=be(),lt=!0,Et=!1,$t;for(K.body=[],L(Mt);!w(q);){var Zt=wt();K.body.push(Zt),lt&&j&&I(Zt)&&($t=Et,Ye(Et=!0)),lt=!1}return Et&&!$t&&Ye(!1),Qt(K,"BlockStatement")}function Ut(j,K){return j.init=K,L(Ot),j.test=y===Ot?null:re(),L(Ot),j.update=y===pt?null:re(),L(pt),j.body=wt(),V.pop(),Qt(j,"ForStatement")}function qt(j,K){return j.left=K,j.right=re(),L(pt),j.body=wt(),V.pop(),Qt(j,"ForInStatement")}function zt(j,K){for(j.declarations=[],j.kind="var";;){var lt=be();if(lt.id=We(),N&&ut(lt.id.name)&&B(lt.id.start,"Binding "+lt.id.name+" in strict mode"),lt.init=w(fe)?re(!0,K):null,j.declarations.push(Qt(lt,"VariableDeclarator")),!w(Bt))break}return j}function re(j,K){var lt=he(K);if(!j&&y===Bt){var Et=Gt(lt);for(Et.expressions=[lt];w(Bt);)Et.expressions.push(he(K));return Qt(Et,"SequenceExpression")}return lt}function he(j){var K=pe(j);if(y.isAssign){var lt=Gt(K);return lt.operator=E,lt.left=K,le(),lt.right=he(j),Tt(K),Qt(lt,"AssignmentExpression")}return K}function pe(j){var K=ue(j);if(w(Ee)){var lt=Gt(K);return lt.test=K,lt.consequent=re(!0),L(te),lt.alternate=re(!0,j),Qt(lt,"ConditionalExpression")}return K}function ue(j){return Me(Se(),-1,j)}function Me(j,K,lt){var Et=y.binop;if(Et!=null&&(!lt||y!==kt)&&Et>K){var $t=Gt(j);$t.left=j,$t.operator=E;var Zt=y;le(),$t.right=Me(Se(),Et,lt);var ie=Qt($t,Zt===Fe||Zt===ze?"LogicalExpression":"BinaryExpression");return Me(ie,K,lt)}return j}function Se(){if(y.prefix){var j=be(),K=y.isUpdate;return j.operator=E,j.prefix=!0,m=!0,le(),j.argument=Se(),K?Tt(j.argument):N&&j.operator==="delete"&&j.argument.type==="Identifier"&&B(j.start,"Deleting local variable in strict mode"),Qt(j,K?"UpdateExpression":"UnaryExpression")}for(var lt=He();y.postfix&&!k();){var j=Gt(lt);j.operator=E,j.prefix=!1,j.argument=lt,Tt(lt),le(),lt=Qt(j,"UpdateExpression")}return lt}function He(){return Je(ii())}function Je(j,K){if(w(ce)){var lt=Gt(j);return lt.object=j,lt.property=We(!0),lt.computed=!1,Je(Qt(lt,"MemberExpression"),K)}else if(w(Y)){var lt=Gt(j);return lt.object=j,lt.property=re(),lt.computed=!0,L(At),Je(Qt(lt,"MemberExpression"),K)}else if(!K&&w(xt)){var lt=Gt(j);return lt.callee=j,lt.arguments=Ei(pt,!1),Je(Qt(lt,"CallExpression"),K)}else return j}function ii(){switch(y){case z:var Et=be();return le(),Qt(Et,"ThisExpression");case M:return We();case A:case D:case G:var Et=be();return Et.value=E,Et.raw=s.slice(f,g),le(),Qt(Et,"Literal");case vt:case St:case Dt:var Et=be();return Et.value=y.atomValue,Et.raw=y.keyword,le(),Qt(Et,"Literal");case xt:var j=_,K=f;le();var lt=re();return lt.start=K,lt.end=g,i.locations&&(lt.loc.start=j,lt.loc.end=v),i.ranges&&(lt.range=[K,g]),L(pt),lt;case Y:var Et=be();return le(),Et.elements=Ei(At,!0,!0),Qt(Et,"ArrayExpression");case Mt:return Si();case at:var Et=be();return le(),vi(Et,!1);case X:return bi();default:it()}}function bi(){var j=be();return le(),j.callee=Je(ii(),!0),w(xt)?j.arguments=Ei(pt,!1):j.arguments=W,Qt(j,"NewExpression")}function Si(){var j=be(),K=!0,lt=!1;for(j.properties=[],le();!w(q);){if(K)K=!1;else if(L(Bt),i.allowTrailingCommas&&w(q))break;var Et={key:yi()},$t=!1,Zt;if(w(te)?(Et.value=re(!0),Zt=Et.kind="init"):i.ecmaVersion>=5&&Et.key.type==="Identifier"&&(Et.key.name==="get"||Et.key.name==="set")?($t=lt=!0,Zt=Et.kind=Et.key.name,Et.key=yi(),y!==xt&&it(),Et.value=vi(be(),!1)):it(),Et.key.type==="Identifier"&&(N||lt))for(var ie=0;ie<j.properties.length;++ie){var ge=j.properties[ie];if(ge.key.name===Et.key.name){var Ne=Zt==ge.kind||$t&&ge.kind==="init"||Zt==="init"&&(ge.kind==="get"||ge.kind==="set");Ne&&!N&&Zt==="init"&&ge.kind==="init"&&(Ne=!1),Ne&&B(Et.key.start,"Redefinition of property")}}j.properties.push(Et)}return Qt(j,"ObjectExpression")}function yi(){return y===A||y===D?ii():We(!0)}function vi(j,K){y===M?j.id=We():K?it():j.id=null,j.params=[];var lt=!0;for(L(xt);!w(pt);)lt?lt=!1:L(Bt),j.params.push(We());var Et=F,$t=V;if(F=!0,V=[],j.body=Kt(!0),F=Et,V=$t,N||j.body.body.length&&I(j.body.body[0]))for(var Zt=j.id?-1:0;Zt<j.params.length;++Zt){var ie=Zt<0?j.id:j.params[Zt];if((st(ie.name)||ut(ie.name))&&B(ie.start,"Defining '"+ie.name+"' in strict mode"),Zt>=0)for(var ge=0;ge<Zt;++ge)ie.name===j.params[ge].name&&B(ie.start,"Argument name clash in strict mode")}return Qt(j,K?"FunctionDeclaration":"FunctionExpression")}function Ei(j,K,lt){for(var Et=[],$t=!0;!w(j);){if($t)$t=!1;else if(L(Bt),K&&i.allowTrailingCommas&&w(j))break;lt&&y===Bt?Et.push(null):Et.push(re(!0))}return Et}function We(j){var K=be();return K.name=y===M?E:j&&!i.forbidReserved&&y.keyword||it(),m=!1,le(),Qt(K,"Identifier")}})},"./original-repo/interpreter.js":function(l,n,t){(function(e){/**
* @license
* Copyright 2013 Google LLC
* SPDX-License-Identifier: Apache-2.0
*/var i=function(s,r){typeof s=="string"&&(s=e.parse(s,i.PARSE_OPTIONS)),this.nodeConstructor=s.constructor;var o=new this.nodeConstructor({options:{}});for(var h in s)o[h]=h==="body"?s[h].slice():s[h];this.ast=o,this.initFunc_=r,this.paused_=!1,this.polyfills_=[],this.functionCounter_=0,this.stepFunctions_=Object.create(null);var u=/^step([A-Z]\w*)$/,p;for(var d in this)typeof this[d]=="function"&&(p=d.match(u))&&(this.stepFunctions_[p[1]]=this[d].bind(this));this.globalScope=this.createScope(this.ast,null),this.globalObject=this.globalScope.object,this.ast=e.parse(this.polyfills_.join(`
`),i.PARSE_OPTIONS),this.polyfills_=void 0,i.stripLocations_(this.ast,void 0,void 0);var f=new i.State(this.ast,this.globalScope);f.done=!1,this.stateStack=[f],this.run(),this.value=void 0,this.ast=o;var f=new i.State(this.ast,this.globalScope);f.done=!1,this.stateStack.length=0,this.stateStack[0]=f,this.stateStack=this.stateStack};i.Completion={NORMAL:0,BREAK:1,CONTINUE:2,RETURN:3,THROW:4},i.PARSE_OPTIONS={ecmaVersion:5},i.READONLY_DESCRIPTOR={configurable:!0,enumerable:!0,writable:!1},i.NONENUMERABLE_DESCRIPTOR={configurable:!0,enumerable:!1,writable:!0},i.READONLY_NONENUMERABLE_DESCRIPTOR={configurable:!0,enumerable:!1,writable:!1},i.NONCONFIGURABLE_READONLY_NONENUMERABLE_DESCRIPTOR={configurable:!1,enumerable:!1,writable:!1},i.VARIABLE_DESCRIPTOR={configurable:!1,enumerable:!0,writable:!0},i.STEP_ERROR={STEP_ERROR:!0},i.SCOPE_REFERENCE={SCOPE_REFERENCE:!0},i.VALUE_IN_DESCRIPTOR={VALUE_IN_DESCRIPTOR:!0},i.REGEXP_TIMEOUT={REGEXP_TIMEOUT:!0},i.toStringCycles_=[],i.vm=null,i.nativeGlobal=this,i.WORKER_CODE=["onmessage = function(e) {","var result;","var data = e.data;","switch (data[0]) {","case 'split':","result = data[1].split(data[2], data[3]);","break;","case 'match':","result = data[1].match(data[2]);","break;","case 'search':","result = data[1].search(data[2]);","break;","case 'replace':","result = data[1].replace(data[2], data[3]);","break;","case 'exec':","var regexp = data[1];","regexp.lastIndex = data[2];","result = [regexp.exec(data[3]), data[1].lastIndex];","break;","default:","throw Error('Unknown RegExp operation: ' + data[0]);","}","postMessage(result);","};"],i.legalArrayLength=function(s){var r=s>>>0;return r===Number(s)?r:NaN},i.legalArrayIndex=function(s){var r=s>>>0;return String(r)===String(s)&&r!==4294967295?r:NaN},i.stripLocations_=function(s,r,o){r?s.start=r:delete s.start,o?s.end=o:delete s.end;for(var h in s)if(s.hasOwnProperty(h)){var u=s[h];u&&typeof u=="object"&&i.stripLocations_(u,r,o)}},i.prototype.REGEXP_MODE=2,i.prototype.REGEXP_THREAD_TIMEOUT=1e3,i.prototype.POLYFILL_TIMEOUT=1e3,i.prototype.getterStep_=!1,i.prototype.setterStep_=!1,i.prototype.appendCode=function(s){var r=this.stateStack[0];if(!r||r.node.type!=="Program")throw Error("Expecting original AST to start with a Program node.");if(typeof s=="string"&&(s=e.parse(s,i.PARSE_OPTIONS)),!s||s.type!=="Program")throw Error("Expecting new AST to start with a Program node.");this.populateScope_(s,r.scope),Array.prototype.push.apply(r.node.body,s.body),r.done=!1},i.prototype.step=function(){var s=this.stateStack,r=Date.now();do{var o=s[s.length-1];if(!o)return!1;var h=o.node,u=h.type;if(u==="Program"&&o.done)return!1;if(this.paused_)return!0;try{var p=this.stepFunctions_[u](s,o,h)}catch(d){if(d!==i.STEP_ERROR)throw d}if(p&&s.push(p),this.getterStep_)throw Error("Getter not supported in this context");if(this.setterStep_)throw Error("Setter not supported in this context")}while(!h.end&&r+this.POLYFILL_TIMEOUT>Date.now());return!0},i.prototype.run=function(){for(;!this.paused_&&this.step(););return this.paused_},i.prototype.initGlobal=function(s){this.setProperty(s,"NaN",NaN,i.NONCONFIGURABLE_READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(s,"Infinity",1/0,i.NONCONFIGURABLE_READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(s,"undefined",void 0,i.NONCONFIGURABLE_READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(s,"window",s,i.READONLY_DESCRIPTOR),this.setProperty(s,"this",s,i.NONCONFIGURABLE_READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(s,"self",s),this.OBJECT_PROTO=new i.Object(null),this.FUNCTION_PROTO=new i.Object(this.OBJECT_PROTO),this.initFunction(s),this.initObject(s),s.proto=this.OBJECT_PROTO,this.setProperty(s,"constructor",this.OBJECT,i.NONENUMERABLE_DESCRIPTOR),this.initArray(s),this.initString(s),this.initBoolean(s),this.initNumber(s),this.initDate(s),this.initRegExp(s),this.initError(s),this.initMath(s),this.initJSON(s);var r=this,o=this.createNativeFunction(function(d){throw EvalError("Can't happen")},!1);o.eval=!0,this.setProperty(s,"eval",o,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(s,"parseInt",this.createNativeFunction(parseInt,!1),i.NONENUMERABLE_DESCRIPTOR),this.setProperty(s,"parseFloat",this.createNativeFunction(parseFloat,!1),i.NONENUMERABLE_DESCRIPTOR),this.setProperty(s,"isNaN",this.createNativeFunction(isNaN,!1),i.NONENUMERABLE_DESCRIPTOR),this.setProperty(s,"isFinite",this.createNativeFunction(isFinite,!1),i.NONENUMERABLE_DESCRIPTOR);for(var h=[[escape,"escape"],[unescape,"unescape"],[decodeURI,"decodeURI"],[decodeURIComponent,"decodeURIComponent"],[encodeURI,"encodeURI"],[encodeURIComponent,"encodeURIComponent"]],u=0;u<h.length;u++){var p=function(d){return function(f){try{return d(f)}catch(g){r.throwException(r.URI_ERROR,g.message)}}}(h[u][0]);this.setProperty(s,h[u][1],this.createNativeFunction(p,!1),i.NONENUMERABLE_DESCRIPTOR)}this.OBJECT=this.OBJECT,this.OBJECT_PROTO=this.OBJECT_PROTO,this.FUNCTION=this.FUNCTION,this.FUNCTION_PROTO=this.FUNCTION_PROTO,this.ARRAY=this.ARRAY,this.ARRAY_PROTO=this.ARRAY_PROTO,this.REGEXP=this.REGEXP,this.REGEXP_PROTO=this.REGEXP_PROTO,this.DATE=this.DATE,this.DATE_PROTO=this.DATE_PROTO,this.initFunc_&&this.initFunc_(this,s)},i.prototype.initFunction=function(s){var r=this,o,h=/^[A-Za-z_$][\w$]*$/;o=function(p){if(arguments.length)var d=String(arguments[arguments.length-1]);else var d="";var f=Array.prototype.slice.call(arguments,0,-1).join(",").trim();if(f){for(var g=f.split(/\s*,\s*/),_=0;_<g.length;_++){var v=g[_];h.test(v)||r.throwException(r.SYNTAX_ERROR,"Invalid function argument: "+v)}f=g.join(", ")}try{var y=e.parse("(function("+f+") {"+d+"})",i.PARSE_OPTIONS)}catch(m){r.throwException(r.SYNTAX_ERROR,"Invalid code: "+m.message)}y.body.length!==1&&r.throwException(r.SYNTAX_ERROR,"Invalid code in function body.");var E=y.body[0].expression;return r.createFunction(E,r.globalScope,"anonymous")},this.FUNCTION=this.createNativeFunction(o,!0),this.setProperty(s,"Function",this.FUNCTION,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.FUNCTION,"prototype",this.FUNCTION_PROTO,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.FUNCTION_PROTO,"constructor",this.FUNCTION,i.NONENUMERABLE_DESCRIPTOR),this.FUNCTION_PROTO.nativeFunc=function(){},this.FUNCTION_PROTO.nativeFunc.id=this.functionCounter_++,this.FUNCTION_PROTO.illegalConstructor=!0,this.setProperty(this.FUNCTION_PROTO,"length",0,i.READONLY_NONENUMERABLE_DESCRIPTOR),this.FUNCTION_PROTO.class="Function",o=function(p,d){var f=r.stateStack[r.stateStack.length-1];f.func_=this,f.funcThis_=p,f.arguments_=[],d!=null&&(d instanceof i.Object?f.arguments_=r.arrayPseudoToNative(d):r.throwException(r.TYPE_ERROR,"CreateListFromArrayLike called on non-object")),f.doneExec_=!1},this.setNativeFunctionPrototype(this.FUNCTION,"apply",o),o=function(p){var d=r.stateStack[r.stateStack.length-1];d.func_=this,d.funcThis_=p,d.arguments_=[];for(var f=1;f<arguments.length;f++)d.arguments_.push(arguments[f]);d.doneExec_=!1},this.setNativeFunctionPrototype(this.FUNCTION,"call",o),this.polyfills_.push("Object.defineProperty(Function.prototype, 'bind',","{configurable: true, writable: true, value:","function bind(oThis) {","if (typeof this !== 'function') {","throw TypeError('What is trying to be bound is not callable');","}","var aArgs   = Array.prototype.slice.call(arguments, 1),","fToBind = this,","fNOP    = function() {},","fBound  = function() {","return fToBind.apply(this instanceof fNOP","? this",": oThis,","aArgs.concat(Array.prototype.slice.call(arguments)));","};","if (this.prototype) {","fNOP.prototype = this.prototype;","}","fBound.prototype = new fNOP();","return fBound;","}","});",""),o=function(){return String(this)},this.setNativeFunctionPrototype(this.FUNCTION,"toString",o),this.setProperty(this.FUNCTION,"toString",this.createNativeFunction(o,!1),i.NONENUMERABLE_DESCRIPTOR),o=function(){return this.valueOf()},this.setNativeFunctionPrototype(this.FUNCTION,"valueOf",o),this.setProperty(this.FUNCTION,"valueOf",this.createNativeFunction(o,!1),i.NONENUMERABLE_DESCRIPTOR)},i.prototype.initObject=function(s){var r=this,o;o=function(p){if(p==null)return r.calledWithNew()?this:r.createObjectProto(r.OBJECT_PROTO);if(!(p instanceof i.Object)){var d=r.createObjectProto(r.getPrototype(p));return d.data=p,d}return p},this.OBJECT=this.createNativeFunction(o,!0),this.setProperty(this.OBJECT,"prototype",this.OBJECT_PROTO,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.OBJECT_PROTO,"constructor",this.OBJECT,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(s,"Object",this.OBJECT,i.NONENUMERABLE_DESCRIPTOR);var h=function(u){u==null&&r.throwException(r.TYPE_ERROR,"Cannot convert '"+u+"' to object")};o=function(p){h(p);var d=p instanceof i.Object?p.properties:p;return r.arrayNativeToPseudo(Object.getOwnPropertyNames(d))},this.setProperty(this.OBJECT,"getOwnPropertyNames",this.createNativeFunction(o,!1),i.NONENUMERABLE_DESCRIPTOR),o=function(p){return h(p),p instanceof i.Object&&(p=p.properties),r.arrayNativeToPseudo(Object.keys(p))},this.setProperty(this.OBJECT,"keys",this.createNativeFunction(o,!1),i.NONENUMERABLE_DESCRIPTOR),o=function(p){return p===null?r.createObjectProto(null):(p instanceof i.Object||r.throwException(r.TYPE_ERROR,"Object prototype may only be an Object or null"),r.createObjectProto(p))},this.setProperty(this.OBJECT,"create",this.createNativeFunction(o,!1),i.NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("(function() {","var create_ = Object.create;","Object.create = function create(proto, props) {","var obj = create_(proto);","props && Object.defineProperties(obj, props);","return obj;","};","})();",""),o=function(p,d,f){return d=String(d),p instanceof i.Object||r.throwException(r.TYPE_ERROR,"Object.defineProperty called on non-object"),f instanceof i.Object||r.throwException(r.TYPE_ERROR,"Property description must be an object"),!p.properties[d]&&p.preventExtensions&&r.throwException(r.TYPE_ERROR,"Can't define property '"+d+"', object is not extensible"),r.setProperty(p,d,i.VALUE_IN_DESCRIPTOR,f.properties),p},this.setProperty(this.OBJECT,"defineProperty",this.createNativeFunction(o,!1),i.NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("(function() {","var defineProperty_ = Object.defineProperty;","Object.defineProperty = function defineProperty(obj, prop, d1) {","var d2 = {};","if ('configurable' in d1) d2.configurable = d1.configurable;","if ('enumerable' in d1) d2.enumerable = d1.enumerable;","if ('writable' in d1) d2.writable = d1.writable;","if ('value' in d1) d2.value = d1.value;","if ('get' in d1) d2.get = d1.get;","if ('set' in d1) d2.set = d1.set;","return defineProperty_(obj, prop, d2);","};","})();","Object.defineProperty(Object, 'defineProperties',","{configurable: true, writable: true, value:","function defineProperties(obj, props) {","var keys = Object.keys(props);","for (var i = 0; i < keys.length; i++) {","Object.defineProperty(obj, keys[i], props[keys[i]]);","}","return obj;","}","});",""),o=function(p,d){if(p instanceof i.Object||r.throwException(r.TYPE_ERROR,"Object.getOwnPropertyDescriptor called on non-object"),d=String(d),d in p.properties){var f=Object.getOwnPropertyDescriptor(p.properties,d),g=p.getter[d],_=p.setter[d],v=r.createObjectProto(r.OBJECT_PROTO);return g||_?(r.setProperty(v,"get",g),r.setProperty(v,"set",_)):(r.setProperty(v,"value",f.value),r.setProperty(v,"writable",f.writable)),r.setProperty(v,"configurable",f.configurable),r.setProperty(v,"enumerable",f.enumerable),v}},this.setProperty(this.OBJECT,"getOwnPropertyDescriptor",this.createNativeFunction(o,!1),i.NONENUMERABLE_DESCRIPTOR),o=function(p){return h(p),r.getPrototype(p)},this.setProperty(this.OBJECT,"getPrototypeOf",this.createNativeFunction(o,!1),i.NONENUMERABLE_DESCRIPTOR),o=function(p){return!!p&&!p.preventExtensions},this.setProperty(this.OBJECT,"isExtensible",this.createNativeFunction(o,!1),i.NONENUMERABLE_DESCRIPTOR),o=function(p){return p instanceof i.Object&&(p.preventExtensions=!0),p},this.setProperty(this.OBJECT,"preventExtensions",this.createNativeFunction(o,!1),i.NONENUMERABLE_DESCRIPTOR),this.setNativeFunctionPrototype(this.OBJECT,"toString",i.Object.prototype.toString),this.setNativeFunctionPrototype(this.OBJECT,"toLocaleString",i.Object.prototype.toString),this.setNativeFunctionPrototype(this.OBJECT,"valueOf",i.Object.prototype.valueOf),o=function(p){return h(this),this instanceof i.Object?String(p)in this.properties:this.hasOwnProperty(p)},this.setNativeFunctionPrototype(this.OBJECT,"hasOwnProperty",o),o=function(p){return h(this),this instanceof i.Object?Object.prototype.propertyIsEnumerable.call(this.properties,p):this.propertyIsEnumerable(p)},this.setNativeFunctionPrototype(this.OBJECT,"propertyIsEnumerable",o),o=function(p){for(;;){if(p=r.getPrototype(p),!p)return!1;if(p===this)return!0}},this.setNativeFunctionPrototype(this.OBJECT,"isPrototypeOf",o)},i.prototype.initArray=function(s){var r=this,o;o=function(u){if(r.calledWithNew())var p=this;else var p=r.createArray();var d=arguments[0];if(arguments.length===1&&typeof d=="number")isNaN(i.legalArrayLength(d))&&r.throwException(r.RANGE_ERROR,"Invalid array length"),p.properties.length=d;else{for(var f=0;f<arguments.length;f++)p.properties[f]=arguments[f];p.properties.length=f}return p},this.ARRAY=this.createNativeFunction(o,!0),this.ARRAY_PROTO=this.ARRAY.properties.prototype,this.setProperty(s,"Array",this.ARRAY,i.NONENUMERABLE_DESCRIPTOR),o=function(u){return u&&u.class==="Array"},this.setProperty(this.ARRAY,"isArray",this.createNativeFunction(o,!1),i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.ARRAY_PROTO,"length",0,{configurable:!1,enumerable:!1,writable:!0}),this.ARRAY_PROTO.class="Array",this.polyfills_.push("Object.defineProperty(Array.prototype, 'pop',","{configurable: true, writable: true, value:","function pop() {","if (!this) throw TypeError();","var o = Object(this);","var len = o.length >>> 0;","if (!len || len < 0) {","o.length = 0;","return undefined;","}","len--;","var x = o[len];","delete o[len];","o.length = len;","return x;","}","});","Object.defineProperty(Array.prototype, 'push',","{configurable: true, writable: true, value:","function push(var_args) {","if (!this) throw TypeError();","var o = Object(this);","var len = o.length >>> 0;","for (var i = 0; i < arguments.length; i++) {","o[len] = arguments[i];","len++;","}","o.length = len;","return len;","}","});","Object.defineProperty(Array.prototype, 'shift',","{configurable: true, writable: true, value:","function shift() {","if (!this) throw TypeError();","var o = Object(this);","var len = o.length >>> 0;","if (!len || len < 0) {","o.length = 0;","return undefined;","}","var value = o[0];","for (var i = 0; i < len - 1; i++) {","o[i] = o[i + 1];","}","delete o[i];","o.length = len - 1;","return value;","}","});","Object.defineProperty(Array.prototype, 'unshift',","{configurable: true, writable: true, value:","function unshift(var_args) {","if (!this) throw TypeError();","var o = Object(this);","var len = o.length >>> 0;","if (!len || len < 0) {","len = 0;","}","for (var i = len - 1; i >= 0; i--) {","o[i + arguments.length] = o[i];","}","for (var i = 0; i < arguments.length; i++) {","o[i] = arguments[i];","}","return o.length = len + arguments.length;","}","});","Object.defineProperty(Array.prototype, 'reverse',","{configurable: true, writable: true, value:","function reverse() {","if (!this) throw TypeError();","var o = Object(this);","var len = o.length >>> 0;","if (!len || len < 2) {","return o;","}","for (var i = 0; i < len / 2 - 0.5; i++) {","var x = o[i];","o[i] = o[len - i - 1];","o[len - i - 1] = x;","}","return o;","}","});","Object.defineProperty(Array.prototype, 'indexOf',","{configurable: true, writable: true, value:","function indexOf(searchElement, fromIndex) {","if (!this) throw TypeError();","var o = Object(this);","var len = o.length >>> 0;","var n = fromIndex | 0;","if (!len || n >= len) {","return -1;","}","var i = Math.max(n >= 0 ? n : len - Math.abs(n), 0);","while (i < len) {","if (i in o && o[i] === searchElement) {","return i;","}","i++;","}","return -1;","}","});","Object.defineProperty(Array.prototype, 'lastIndexOf',","{configurable: true, writable: true, value:","function lastIndexOf(searchElement, fromIndex) {","if (!this) throw TypeError();","var o = Object(this);","var len = o.length >>> 0;","if (!len) {","return -1;","}","var n = len - 1;","if (arguments.length > 1) {","n = fromIndex | 0;","if (n) {","n = (n > 0 || -1) * Math.floor(Math.abs(n));","}","}","var i = n >= 0 ? Math.min(n, len - 1) : len - Math.abs(n);","while (i >= 0) {","if (i in o && o[i] === searchElement) {","return i;","}","i--;","}","return -1;","}","});","Object.defineProperty(Array.prototype, 'slice',","{configurable: true, writable: true, value:","function slice(start, end) {","if (!this) throw TypeError();","var o = Object(this);","var len = o.length >>> 0;","start |= 0;","start = (start >= 0) ? start : Math.max(0, len + start);","if (typeof end !== 'undefined') {","if (end !== Infinity) {","end |= 0;","}","if (end < 0) {","end = len + end;","} else {","end = Math.min(end, len);","}","} else {","end = len;","}","var size = end - start;","var cloned = [];","for (var i = 0; i < size; i++) {","cloned[i] = o[start + i];","}","return cloned;","}","});","Object.defineProperty(Array.prototype, 'splice',","{configurable: true, writable: true, value:","function splice(start, deleteCount, var_args) {","if (!this) throw TypeError();","var o = Object(this);","var len = o.length >>> 0;","start |= 0;","if (start < 0) {","start = Math.max(len + start, 0);","} else {","start = Math.min(start, len);","}","if (arguments.length < 1) {","deleteCount = len - start;","} else {","deleteCount |= 0;","deleteCount = Math.max(0, Math.min(deleteCount, len - start));","}","var removed = [];","for (var i = start; i < start + deleteCount; i++) {","removed[removed.length++] = o[i];","o[i] = o[i + deleteCount];","}","for (var i = start + deleteCount; i < len - deleteCount; i++) {","o[i] = o[i + deleteCount];","}","for (var i = len - deleteCount; i < len; i++) {","delete o[i];","}","len -= deleteCount;","for (var i = len - 1; i >= start; i--) {","o[i + arguments.length - 2] = o[i];","}","len += arguments.length - 2;","for (var i = 2; i < arguments.length; i++) {","o[start + i - 2] = arguments[i];","}","o.length = len;","return removed;","}","});","Object.defineProperty(Array.prototype, 'concat',","{configurable: true, writable: true, value:","function concat(var_args) {","if (!this) throw TypeError();","var o = Object(this);","var cloned = [];","for (var i = -1; i < arguments.length; i++) {","var value = (i === -1) ? o : arguments[i];","if (Array.isArray(value)) {","cloned.push.apply(cloned, value);","} else {","cloned.push(value);","}","}","return cloned;","}","});","Object.defineProperty(Array.prototype, 'join',","{configurable: true, writable: true, value:","function join(opt_separator) {","if (!this) throw TypeError();","var o = Object(this);","var sep = typeof opt_separator === 'undefined' ?","',' : ('' + opt_separator);","var str = '';","for (var i = 0; i < o.length; i++) {","if (i && sep) {","str += sep;","}","str += o[i];","}","return str;","}","});","Object.defineProperty(Array.prototype, 'every',","{configurable: true, writable: true, value:","function every(callbackfn, thisArg) {","if (!this || typeof callbackfn !== 'function') throw TypeError();","var t, k;","var o = Object(this);","var len = o.length >>> 0;","if (arguments.length > 1) t = thisArg;","k = 0;","while (k < len) {","if (k in o && !callbackfn.call(t, o[k], k, o)) return false;","k++;","}","return true;","}","});","Object.defineProperty(Array.prototype, 'filter',","{configurable: true, writable: true, value:","function filter(fun, var_args) {","if (this === void 0 || this === null || typeof fun !== 'function') throw TypeError();","var o = Object(this);","var len = o.length >>> 0;","var res = [];","var thisArg = arguments.length >= 2 ? arguments[1] : void 0;","for (var i = 0; i < len; i++) {","if (i in o) {","var val = o[i];","if (fun.call(thisArg, val, i, o)) res.push(val);","}","}","return res;","}","});","Object.defineProperty(Array.prototype, 'forEach',","{configurable: true, writable: true, value:","function forEach(callback, thisArg) {","if (!this || typeof callback !== 'function') throw TypeError();","var t, k;","var o = Object(this);","var len = o.length >>> 0;","if (arguments.length > 1) t = thisArg;","k = 0;","while (k < len) {","if (k in o) callback.call(t, o[k], k, o);","k++;","}","}","});","Object.defineProperty(Array.prototype, 'map',","{configurable: true, writable: true, value:","function map(callback, thisArg) {","if (!this || typeof callback !== 'function') throw TypeError();","var t, a, k;","var o = Object(this);","var len = o.length >>> 0;","if (arguments.length > 1) t = thisArg;","a = new Array(len);","k = 0;","while (k < len) {","if (k in o) a[k] = callback.call(t, o[k], k, o);","k++;","}","return a;","}","});","Object.defineProperty(Array.prototype, 'reduce',","{configurable: true, writable: true, value:","function reduce(callback /*, initialValue*/) {","if (!this || typeof callback !== 'function') throw TypeError();","var o = Object(this), len = o.length >>> 0, k = 0, value;","if (arguments.length === 2) {","value = arguments[1];","} else {","while (k < len && !(k in o)) k++;","if (k >= len) {","throw TypeError('Reduce of empty array with no initial value');","}","value = o[k++];","}","for (; k < len; k++) {","if (k in o) value = callback(value, o[k], k, o);","}","return value;","}","});","Object.defineProperty(Array.prototype, 'reduceRight',","{configurable: true, writable: true, value:","function reduceRight(callback /*, initialValue*/) {","if (null === this || 'undefined' === typeof this || 'function' !== typeof callback) throw TypeError();","var o = Object(this), len = o.length >>> 0, k = len - 1, value;","if (arguments.length >= 2) {","value = arguments[1];","} else {","while (k >= 0 && !(k in o)) k--;","if (k < 0) {","throw TypeError('Reduce of empty array with no initial value');","}","value = o[k--];","}","for (; k >= 0; k--) {","if (k in o) value = callback(value, o[k], k, o);","}","return value;","}","});","Object.defineProperty(Array.prototype, 'some',","{configurable: true, writable: true, value:","function some(fun/*, thisArg*/) {","if (!this || typeof fun !== 'function') throw TypeError();","var o = Object(this);","var len = o.length >>> 0;","var thisArg = arguments.length >= 2 ? arguments[1] : void 0;","for (var i = 0; i < len; i++) {","if (i in o && fun.call(thisArg, o[i], i, o)) {","return true;","}","}","return false;","}","});","Object.defineProperty(Array.prototype, 'sort',","{configurable: true, writable: true, value:","function sort(opt_comp) {","if (!this) throw TypeError();","if (typeof opt_comp !== 'function') {","opt_comp = undefined;","}","for (var i = 0; i < this.length; i++) {","var changes = 0;","for (var j = 0; j < this.length - i - 1; j++) {","if (opt_comp ? (opt_comp(this[j], this[j + 1]) > 0) :","(String(this[j]) > String(this[j + 1]))) {","var swap = this[j];","this[j] = this[j + 1];","this[j + 1] = swap;","changes++;","}","}","if (!changes) break;","}","return this;","}","});","Object.defineProperty(Array.prototype, 'toLocaleString',","{configurable: true, writable: true, value:","function toLocaleString() {","if (!this) throw TypeError();","var o = Object(this);","var out = [];","for (var i = 0; i < o.length; i++) {","out[i] = (o[i] === null || o[i] === undefined) ? '' : o[i].toLocaleString();","}","return out.join(',');","}","});","")},i.prototype.initString=function(s){var r=this,o;o=function(d){return d=arguments.length?i.nativeGlobal.String(d):"",r.calledWithNew()?(this.data=d,this):d},this.STRING=this.createNativeFunction(o,!0),this.setProperty(s,"String",this.STRING,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.STRING,"fromCharCode",this.createNativeFunction(String.fromCharCode,!1),i.NONENUMERABLE_DESCRIPTOR);for(var h=["charAt","charCodeAt","concat","indexOf","lastIndexOf","slice","substr","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toUpperCase","trim"],u=0;u<h.length;u++)this.setNativeFunctionPrototype(this.STRING,h[u],String.prototype[h[u]]);o=function(d,f,g){f=r.pseudoToNative(f),g=r.pseudoToNative(g);try{return String(this).localeCompare(d,f,g)}catch(_){r.throwException(r.ERROR,"localeCompare: "+_.message)}},this.setNativeFunctionPrototype(this.STRING,"localeCompare",o),o=function(d,f,g){var _=String(this);if(f=f?Number(f):void 0,r.isa(d,r.REGEXP)&&(d=d.data,r.maybeThrowRegExp(d,g),r.REGEXP_MODE===2)){if(i.vm){var v={string:_,separator:d,limit:f},y="string.split(separator, limit)",x=r.vmCall(y,v,d,g);x!==i.REGEXP_TIMEOUT&&g(r.arrayNativeToPseudo(x))}else{var E=r.createWorker(),m=r.regExpTimeout(d,E,g);E.onmessage=function(C){clearTimeout(m),g(r.arrayNativeToPseudo(C.data))},E.postMessage(["split",_,d,f])}return}var x=_.split(d,f);g(r.arrayNativeToPseudo(x))},this.setAsyncFunctionPrototype(this.STRING,"split",o),o=function(d,f){var g=String(this);if(r.isa(d,r.REGEXP)?d=d.data:d=new RegExp(d),r.maybeThrowRegExp(d,f),r.REGEXP_MODE===2){if(i.vm){var _={string:g,regexp:d},v="string.match(regexp)",m=r.vmCall(v,_,d,f);m!==i.REGEXP_TIMEOUT&&f(m&&r.arrayNativeToPseudo(m))}else{var y=r.createWorker(),E=r.regExpTimeout(d,y,f);y.onmessage=function(x){clearTimeout(E),f(x.data&&r.arrayNativeToPseudo(x.data))},y.postMessage(["match",g,d])}return}var m=g.match(d);f(m&&r.arrayNativeToPseudo(m))},this.setAsyncFunctionPrototype(this.STRING,"match",o),o=function(d,f){var g=String(this);if(r.isa(d,r.REGEXP)?d=d.data:d=new RegExp(d),r.maybeThrowRegExp(d,f),r.REGEXP_MODE===2){if(i.vm){var _={string:g,regexp:d},v="string.search(regexp)",y=r.vmCall(v,_,d,f);y!==i.REGEXP_TIMEOUT&&f(y)}else{var E=r.createWorker(),m=r.regExpTimeout(d,E,f);E.onmessage=function(x){clearTimeout(m),f(x.data)},E.postMessage(["search",g,d])}return}f(g.search(d))},this.setAsyncFunctionPrototype(this.STRING,"search",o),o=function(d,f,g){var _=String(this);if(f=String(f),r.isa(d,r.REGEXP)&&(d=d.data,r.maybeThrowRegExp(d,g),r.REGEXP_MODE===2)){if(i.vm){var v={string:_,substr:d,newSubstr:f},y="string.replace(substr, newSubstr)",E=r.vmCall(y,v,d,g);E!==i.REGEXP_TIMEOUT&&g(E)}else{var m=r.createWorker(),x=r.regExpTimeout(d,m,g);m.onmessage=function(C){clearTimeout(x),g(C.data)},m.postMessage(["replace",_,d,f])}return}g(_.replace(d,f))},this.setAsyncFunctionPrototype(this.STRING,"replace",o),this.polyfills_.push("(function() {","var replace_ = String.prototype.replace;","String.prototype.replace = function replace(substr, newSubstr) {","if (typeof newSubstr !== 'function') {","return replace_.call(this, substr, newSubstr);","}","var str = this;","if (substr instanceof RegExp) {","var subs = [];","var m = substr.exec(str);","while (m) {","m.push(m.index, str);","var inject = newSubstr.apply(null, m);","subs.push([m.index, m[0].length, inject]);","m = substr.global ? substr.exec(str) : null;","}","for (var i = subs.length - 1; i >= 0; i--) {","str = str.substring(0, subs[i][0]) + subs[i][2] + str.substring(subs[i][0] + subs[i][1]);","}","} else {","var i = str.indexOf(substr);","if (i !== -1) {","var inject = newSubstr(str.substr(i, substr.length), i, str);","str = str.substring(0, i) + inject + str.substring(i + substr.length);","}","}","return str;","};","})();","")},i.prototype.initBoolean=function(s){var r=this,o;o=function(u){return u=i.nativeGlobal.Boolean(u),r.calledWithNew()?(this.data=u,this):u},this.BOOLEAN=this.createNativeFunction(o,!0),this.setProperty(s,"Boolean",this.BOOLEAN,i.NONENUMERABLE_DESCRIPTOR)},i.prototype.initNumber=function(s){var r=this,o;o=function(d){return d=arguments.length?i.nativeGlobal.Number(d):0,r.calledWithNew()?(this.data=d,this):d},this.NUMBER=this.createNativeFunction(o,!0),this.setProperty(s,"Number",this.NUMBER,i.NONENUMERABLE_DESCRIPTOR);for(var h=["MAX_VALUE","MIN_VALUE","NaN","NEGATIVE_INFINITY","POSITIVE_INFINITY"],u=0;u<h.length;u++)this.setProperty(this.NUMBER,h[u],Number[h[u]],i.NONCONFIGURABLE_READONLY_NONENUMERABLE_DESCRIPTOR);o=function(d){try{return Number(this).toExponential(d)}catch(f){r.throwException(r.ERROR,f.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toExponential",o),o=function(d){try{return Number(this).toFixed(d)}catch(f){r.throwException(r.ERROR,f.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toFixed",o),o=function(d){try{return Number(this).toPrecision(d)}catch(f){r.throwException(r.ERROR,f.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toPrecision",o),o=function(d){try{return Number(this).toString(d)}catch(f){r.throwException(r.ERROR,f.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toString",o),o=function(d,f){return d=d?r.pseudoToNative(d):void 0,f=f?r.pseudoToNative(f):void 0,Number(this).toLocaleString(d,f)},this.setNativeFunctionPrototype(this.NUMBER,"toLocaleString",o)},i.prototype.initDate=function(s){var r=this,o;o=function(d,f){if(!r.calledWithNew())return i.nativeGlobal.Date();var g=[null].concat(Array.from(arguments));return this.data=new(Function.prototype.bind.apply(i.nativeGlobal.Date,g)),this},this.DATE=this.createNativeFunction(o,!0),this.DATE_PROTO=this.DATE.properties.prototype,this.setProperty(s,"Date",this.DATE,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"now",this.createNativeFunction(Date.now,!1),i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"parse",this.createNativeFunction(Date.parse,!1),i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"UTC",this.createNativeFunction(Date.UTC,!1),i.NONENUMERABLE_DESCRIPTOR);for(var h=["getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getTime","getTimezoneOffset","getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","getYear","setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear","toDateString","toISOString","toJSON","toGMTString","toLocaleDateString","toLocaleString","toLocaleTimeString","toTimeString","toUTCString"],u=0;u<h.length;u++)o=function(p){return function(d){var f=this.data;f instanceof Date||r.throwException(r.TYPE_ERROR,p+" not called on a Date");for(var g=[],_=0;_<arguments.length;_++)g[_]=r.pseudoToNative(arguments[_]);return f[p].apply(f,g)}}(h[u]),this.setNativeFunctionPrototype(this.DATE,h[u],o)},i.prototype.initRegExp=function(s){var r=this,o;o=function(u,p){if(r.calledWithNew())var d=this;else var d=r.createObjectProto(r.REGEXP_PROTO);return u=u?String(u):"",p=p?String(p):"",r.populateRegExp(d,new i.nativeGlobal.RegExp(u,p)),d},this.REGEXP=this.createNativeFunction(o,!0),this.REGEXP_PROTO=this.REGEXP.properties.prototype,this.setProperty(s,"RegExp",this.REGEXP,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"global",void 0,i.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"ignoreCase",void 0,i.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"multiline",void 0,i.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"source","(?:)",i.READONLY_NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("Object.defineProperty(RegExp.prototype, 'test',","{configurable: true, writable: true, value:","function test(str) {","return String(str).search(this) !== -1","}","});"),o=function(u,p){var d=this.data;if(u=String(u),d.lastIndex=Number(r.getProperty(this,"lastIndex")),r.maybeThrowRegExp(d,p),r.REGEXP_MODE===2){if(i.vm){var f={string:u,regexp:d},g="regexp.exec(string)",E=r.vmCall(g,f,d,p);E!==i.REGEXP_TIMEOUT&&(r.setProperty(this,"lastIndex",d.lastIndex),p(m(E)))}else{var _=r.createWorker(),v=r.regExpTimeout(d,_,p),y=this;_.onmessage=function(x){clearTimeout(v),r.setProperty(y,"lastIndex",x.data[1]),p(m(x.data[0]))},_.postMessage(["exec",d,d.lastIndex,u])}return}var E=d.exec(u);r.setProperty(this,"lastIndex",d.lastIndex),p(m(E));function m(x){if(x){var C=r.arrayNativeToPseudo(x);return r.setProperty(C,"index",x.index),r.setProperty(C,"input",x.input),C}return null}},this.setAsyncFunctionPrototype(this.REGEXP,"exec",o)},i.prototype.initError=function(s){var r=this;this.ERROR=this.createNativeFunction(function(u){if(r.calledWithNew())var p=this;else var p=r.createObject(r.ERROR);return u&&r.setProperty(p,"message",String(u),i.NONENUMERABLE_DESCRIPTOR),p},!0),this.setProperty(s,"Error",this.ERROR,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.ERROR.properties.prototype,"message","",i.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.ERROR.properties.prototype,"name","Error",i.NONENUMERABLE_DESCRIPTOR);var o=function(h){var u=r.createNativeFunction(function(p){if(r.calledWithNew())var d=this;else var d=r.createObject(u);return p&&r.setProperty(d,"message",String(p),i.NONENUMERABLE_DESCRIPTOR),d},!0);return r.setProperty(u,"prototype",r.createObject(r.ERROR),i.NONENUMERABLE_DESCRIPTOR),r.setProperty(u.properties.prototype,"name",h,i.NONENUMERABLE_DESCRIPTOR),r.setProperty(s,h,u,i.NONENUMERABLE_DESCRIPTOR),u};this.EVAL_ERROR=o("EvalError"),this.RANGE_ERROR=o("RangeError"),this.REFERENCE_ERROR=o("ReferenceError"),this.SYNTAX_ERROR=o("SyntaxError"),this.TYPE_ERROR=o("TypeError"),this.URI_ERROR=o("URIError")},i.prototype.initMath=function(s){var r=this.createObjectProto(this.OBJECT_PROTO);this.setProperty(s,"Math",r,i.NONENUMERABLE_DESCRIPTOR);for(var o=["E","LN2","LN10","LOG2E","LOG10E","PI","SQRT1_2","SQRT2"],h=0;h<o.length;h++)this.setProperty(r,o[h],Math[o[h]],i.READONLY_NONENUMERABLE_DESCRIPTOR);for(var u=["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","random","round","sin","sqrt","tan"],h=0;h<u.length;h++)this.setProperty(r,u[h],this.createNativeFunction(Math[u[h]],!1),i.NONENUMERABLE_DESCRIPTOR)},i.prototype.initJSON=function(s){var r=this,o=r.createObjectProto(this.OBJECT_PROTO);this.setProperty(s,"JSON",o,i.NONENUMERABLE_DESCRIPTOR);var h=function(p){try{var d=JSON.parse(String(p))}catch(f){r.throwException(r.SYNTAX_ERROR,f.message)}return r.nativeToPseudo(d)};this.setProperty(o,"parse",this.createNativeFunction(h,!1)),h=function(p,d,f){d&&d.class==="Function"?r.throwException(r.TYPE_ERROR,"Function replacer on JSON.stringify not supported"):d&&d.class==="Array"?(d=r.arrayPseudoToNative(d),d=d.filter(function(v){return typeof v=="string"||typeof v=="number"})):d=null,typeof f!="string"&&typeof f!="number"&&(f=void 0);var g=r.pseudoToNative(p);try{var _=JSON.stringify(g,d,f)}catch(v){r.throwException(r.TYPE_ERROR,v.message)}return _},this.setProperty(o,"stringify",this.createNativeFunction(h,!1))},i.prototype.isa=function(s,r){if(s==null||!r)return!1;var o=r.properties.prototype;if(s===o)return!0;for(s=this.getPrototype(s);s;){if(s===o)return!0;s=s.proto}return!1},i.prototype.populateRegExp=function(s,r){s.data=new RegExp(r.source,r.flags),this.setProperty(s,"lastIndex",r.lastIndex,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(s,"source",r.source,i.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(s,"global",r.global,i.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(s,"ignoreCase",r.ignoreCase,i.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(s,"multiline",r.multiline,i.READONLY_NONENUMERABLE_DESCRIPTOR)},i.prototype.createWorker=function(){var s=this.createWorker.blob_;return s||(s=new Blob([i.WORKER_CODE.join(`
`)],{type:"application/javascript"}),this.createWorker.blob_=s),new Worker(URL.createObjectURL(s))},i.prototype.vmCall=function(s,r,o,h){var u={timeout:this.REGEXP_THREAD_TIMEOUT};try{return i.vm.runInNewContext(s,r,u)}catch{h(null),this.throwException(this.ERROR,"RegExp Timeout: "+o)}return i.REGEXP_TIMEOUT},i.prototype.maybeThrowRegExp=function(s,r){var o;if(this.REGEXP_MODE===0)o=!1;else if(this.REGEXP_MODE===1)o=!0;else if(i.vm)o=!0;else if(typeof Worker=="function"&&typeof URL=="function")o=!0;else{try{i.vm=t("./node_modules/vm-browserify/index.js")}catch{}o=!!i.vm}o||(r(null),this.throwException(this.ERROR,"Regular expressions not supported: "+s))},i.prototype.regExpTimeout=function(s,r,o){var h=this;return setTimeout(function(){r.terminate(),o(null);try{h.throwException(h.ERROR,"RegExp Timeout: "+s)}catch{}},this.REGEXP_THREAD_TIMEOUT)},i.prototype.createObject=function(s){return this.createObjectProto(s&&s.properties.prototype)},i.prototype.createObjectProto=function(s){if(typeof s!="object")throw Error("Non object prototype");var r=new i.Object(s);return this.isa(r,this.ERROR)&&(r.class="Error"),r},i.prototype.createArray=function(){var s=this.createObjectProto(this.ARRAY_PROTO);return this.setProperty(s,"length",0,{configurable:!1,enumerable:!1,writable:!0}),s.class="Array",s},i.prototype.createFunctionBase_=function(s,r){var o=this.createObjectProto(this.FUNCTION_PROTO);if(r){var h=this.createObjectProto(this.OBJECT_PROTO);this.setProperty(o,"prototype",h,i.NONENUMERABLE_DESCRIPTOR),this.setProperty(h,"constructor",o,i.NONENUMERABLE_DESCRIPTOR)}else o.illegalConstructor=!0;return this.setProperty(o,"length",s,i.READONLY_NONENUMERABLE_DESCRIPTOR),o.class="Function",o},i.prototype.createFunction=function(s,r,o){var h=this.createFunctionBase_(s.params.length,!0);h.parentScope=r,h.node=s;var u=s.id?String(s.id.name):o||"";return this.setProperty(h,"name",u,i.READONLY_NONENUMERABLE_DESCRIPTOR),h},i.prototype.createNativeFunction=function(s,r){var o=this.createFunctionBase_(s.length,r);return o.nativeFunc=s,s.id=this.functionCounter_++,this.setProperty(o,"name",s.name,i.READONLY_NONENUMERABLE_DESCRIPTOR),o},i.prototype.createAsyncFunction=function(s){var r=this.createFunctionBase_(s.length,!0);return r.asyncFunc=s,s.id=this.functionCounter_++,this.setProperty(r,"name",s.name,i.READONLY_NONENUMERABLE_DESCRIPTOR),r},i.prototype.nativeToPseudo=function(s){if(s instanceof i.Object)throw Error("Object is already pseudo");if(typeof s!="object"&&typeof s!="function"||s===null)return s;if(s instanceof RegExp){var r=this.createObjectProto(this.REGEXP_PROTO);return this.populateRegExp(r,s),r}if(s instanceof Date){var o=this.createObjectProto(this.DATE_PROTO);return o.data=new Date(s.valueOf()),o}if(typeof s=="function"){var h=this,u=function(){var v=Array.prototype.slice.call(arguments).map(function(E){return h.pseudoToNative(E)}),y=s.apply(h,v);return h.nativeToPseudo(y)},p=Object.getOwnPropertyDescriptor(s,"prototype");return this.createNativeFunction(u,!!p)}if(Array.isArray(s)){for(var d=this.createArray(),f=0;f<s.length;f++)f in s&&this.setProperty(d,f,this.nativeToPseudo(s[f]));return d}var g=this.createObjectProto(this.OBJECT_PROTO);for(var _ in s)this.setProperty(g,_,this.nativeToPseudo(s[_]));return g},i.prototype.pseudoToNative=function(s,r){if(typeof s!="object"&&typeof s!="function"||s===null)return s;if(!(s instanceof i.Object))throw Error("Object is not pseudo");if(this.isa(s,this.REGEXP)){var o=new RegExp(s.data.source,s.data.flags);return o.lastIndex=s.data.lastIndex,o}if(this.isa(s,this.DATE))return new Date(s.data.valueOf());var h=r||{pseudo:[],native:[]},u=h.pseudo.indexOf(s);if(u!==-1)return h.native[u];h.pseudo.push(s);var p;if(this.isa(s,this.ARRAY)){p=[],h.native.push(p);for(var d=this.getProperty(s,"length"),u=0;u<d;u++)this.hasProperty(s,u)&&(p[u]=this.pseudoToNative(this.getProperty(s,u),h))}else{p={},h.native.push(p);var f;for(var g in s.properties)f=this.pseudoToNative(s.properties[g],h),Object.defineProperty(p,g,{value:f,writable:!0,enumerable:!0,configurable:!0})}return h.pseudo.pop(),h.native.pop(),p},i.prototype.arrayNativeToPseudo=function(s){for(var r=this.createArray(),o=Object.getOwnPropertyNames(s),h=0;h<o.length;h++)this.setProperty(r,o[h],s[o[h]]);return r},i.prototype.arrayPseudoToNative=function(s){var r=[];for(var o in s.properties)r[o]=this.getProperty(s,o);return r.length=i.legalArrayLength(this.getProperty(s,"length"))||0,r},i.prototype.getPrototype=function(s){switch(typeof s){case"number":return this.NUMBER.properties.prototype;case"boolean":return this.BOOLEAN.properties.prototype;case"string":return this.STRING.properties.prototype}return s?s.proto:null},i.prototype.getProperty=function(s,r){if(this.getterStep_)throw Error("Getter not supported in that context");if(r=String(r),s==null&&this.throwException(this.TYPE_ERROR,"Cannot read property '"+r+"' of "+s),typeof s=="object"&&!(s instanceof i.Object))throw TypeError("Expecting native value or pseudo object");if(r==="length"){if(this.isa(s,this.STRING))return String(s).length}else if(r.charCodeAt(0)<64&&this.isa(s,this.STRING)){var o=i.legalArrayIndex(r);if(!isNaN(o)&&o<String(s).length)return String(s)[o]}do if(s.properties&&r in s.properties){var h=s.getter[r];return h?(this.getterStep_=!0,h):s.properties[r]}while(s=this.getPrototype(s))},i.prototype.hasProperty=function(s,r){if(!(s instanceof i.Object))throw TypeError("Primitive data type has no properties");if(r=String(r),r==="length"&&this.isa(s,this.STRING))return!0;if(this.isa(s,this.STRING)){var o=i.legalArrayIndex(r);if(!isNaN(o)&&o<String(s).length)return!0}do if(s.properties&&r in s.properties)return!0;while(s=this.getPrototype(s));return!1},i.prototype.setProperty=function(s,r,o,h){if(this.setterStep_)throw Error("Setter not supported in that context");if(r=String(r),s==null&&this.throwException(this.TYPE_ERROR,"Cannot set property '"+r+"' of "+s),typeof s=="object"&&!(s instanceof i.Object))throw TypeError("Expecting native value or pseudo object");h&&("get"in h||"set"in h)&&("value"in h||"writable"in h)&&this.throwException(this.TYPE_ERROR,"Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");var u=!this.stateStack||this.getScope().strict;if(!(s instanceof i.Object)){u&&this.throwException(this.TYPE_ERROR,"Can't create property '"+r+"' on '"+s+"'");return}if(this.isa(s,this.STRING)){var p=i.legalArrayIndex(r);if(r==="length"||!isNaN(p)&&p<String(s).length){u&&this.throwException(this.TYPE_ERROR,"Cannot assign to read only property '"+r+"' of String '"+s.data+"'");return}}if(s.class==="Array"){var d=s.properties.length,f;if(r==="length"){if(h){if(!("value"in h))return;o=h.value}if(o=i.legalArrayLength(o),isNaN(o)&&this.throwException(this.RANGE_ERROR,"Invalid array length"),o<d)for(f in s.properties)f=i.legalArrayIndex(f),!isNaN(f)&&o<=f&&delete s.properties[f]}else isNaN(f=i.legalArrayIndex(r))||(s.properties.length=Math.max(d,f+1))}if(s.preventExtensions&&!(r in s.properties)){u&&this.throwException(this.TYPE_ERROR,"Can't add property '"+r+"', object is not extensible");return}if(h){var g={};"get"in h&&h.get&&(s.getter[r]=h.get,g.get=this.setProperty.placeholderGet_),"set"in h&&h.set&&(s.setter[r]=h.set,g.set=this.setProperty.placeholderSet_),"configurable"in h&&(g.configurable=h.configurable),"enumerable"in h&&(g.enumerable=h.enumerable),"writable"in h&&(g.writable=h.writable,delete s.getter[r],delete s.setter[r]),"value"in h?(g.value=h.value,delete s.getter[r],delete s.setter[r]):o!==i.VALUE_IN_DESCRIPTOR&&(g.value=o,delete s.getter[r],delete s.setter[r]);try{Object.defineProperty(s.properties,r,g)}catch{this.throwException(this.TYPE_ERROR,"Cannot redefine property: "+r)}"get"in h&&!h.get&&delete s.getter[r],"set"in h&&!h.set&&delete s.setter[r]}else{if(o===i.VALUE_IN_DESCRIPTOR)throw ReferenceError("Value not specified.");for(var _=s;!(r in _.properties);)if(_=this.getPrototype(_),!_){_=s;break}if(_.setter&&_.setter[r])return this.setterStep_=!0,_.setter[r];if(_.getter&&_.getter[r])u&&this.throwException(this.TYPE_ERROR,"Cannot set property '"+r+"' of object '"+s+"' which only has a getter");else try{s.properties[r]=o}catch{u&&this.throwException(this.TYPE_ERROR,"Cannot assign to read only property '"+r+"' of object '"+s+"'")}}},i.prototype.setProperty.placeholderGet_=function(){throw Error("Placeholder getter")},i.prototype.setProperty.placeholderSet_=function(){throw Error("Placeholder setter")},i.prototype.setNativeFunctionPrototype=function(s,r,o){this.setProperty(s.properties.prototype,r,this.createNativeFunction(o,!1),i.NONENUMERABLE_DESCRIPTOR)},i.prototype.setAsyncFunctionPrototype=function(s,r,o){this.setProperty(s.properties.prototype,r,this.createAsyncFunction(o),i.NONENUMERABLE_DESCRIPTOR)},i.prototype.getScope=function(){var s=this.stateStack[this.stateStack.length-1].scope;if(!s)throw Error("No scope found.");return s},i.prototype.createScope=function(s,r){var o=!1;if(r&&r.strict)o=!0;else{var h=s.body&&s.body[0];h&&h.expression&&h.expression.type==="Literal"&&h.expression.value==="use strict"&&(o=!0)}var u=this.createObjectProto(null),p=new i.Scope(r,o,u);return r||this.initGlobal(p.object),this.populateScope_(s,p),p},i.prototype.createSpecialScope=function(s,r){if(!s)throw Error("parentScope required");var o=r||this.createObjectProto(null);return new i.Scope(s,s.strict,o)},i.prototype.getValueFromScope=function(s){for(var r=this.getScope();r&&r!==this.globalScope;){if(s in r.object.properties)return r.object.properties[s];r=r.parentScope}if(r===this.globalScope&&this.hasProperty(r.object,s))return this.getProperty(r.object,s);var o=this.stateStack[this.stateStack.length-1].node;o.type==="UnaryExpression"&&o.operator==="typeof"||this.throwException(this.REFERENCE_ERROR,s+" is not defined")},i.prototype.setValueToScope=function(s,r){for(var o=this.getScope(),h=o.strict;o&&o!==this.globalScope;){if(s in o.object.properties){o.object.properties[s]=r;return}o=o.parentScope}if(o===this.globalScope&&(!h||this.hasProperty(o.object,s)))return this.setProperty(o.object,s,r);this.throwException(this.REFERENCE_ERROR,s+" is not defined")},i.prototype.populateScope_=function(s,r){if(s.type==="VariableDeclaration")for(var o=0;o<s.declarations.length;o++)this.setProperty(r.object,s.declarations[o].id.name,void 0,i.VARIABLE_DESCRIPTOR);else if(s.type==="FunctionDeclaration"){this.setProperty(r.object,s.id.name,this.createFunction(s,r),i.VARIABLE_DESCRIPTOR);return}else{if(s.type==="FunctionExpression")return;if(s.type==="ExpressionStatement")return}var h=s.constructor;for(var u in s){var p=s[u];if(p&&typeof p=="object")if(Array.isArray(p))for(var o=0;o<p.length;o++)p[o]&&p[o].constructor===h&&this.populateScope_(p[o],r);else p.constructor===h&&this.populateScope_(p,r)}},i.prototype.calledWithNew=function(){return this.stateStack[this.stateStack.length-1].isConstructor},i.prototype.getValue=function(s){return s[0]===i.SCOPE_REFERENCE?this.getValueFromScope(s[1]):this.getProperty(s[0],s[1])},i.prototype.setValue=function(s,r){return s[0]===i.SCOPE_REFERENCE?this.setValueToScope(s[1],r):this.setProperty(s[0],s[1],r)},i.prototype.throwException=function(s,r){if(r===void 0)var o=s;else{var o=this.createObject(s);this.setProperty(o,"message",r,i.NONENUMERABLE_DESCRIPTOR)}throw this.unwind(i.Completion.THROW,o,void 0),i.STEP_ERROR},i.prototype.unwind=function(s,r,o){if(s===i.Completion.NORMAL)throw TypeError("Should not unwind for NORMAL completions");t:for(var h=this.stateStack;h.length>0;h.pop()){var u=h[h.length-1];switch(u.node.type){case"TryStatement":u.cv={type:s,value:r,label:o};return;case"CallExpression":case"NewExpression":if(s===i.Completion.RETURN){u.value=r;return}else if(s!==i.Completion.THROW)throw Error("Unsynatctic break/continue not rejected by Acorn");break;case"Program":u.done=!0;break t}if(s===i.Completion.BREAK){if(o?u.labels&&u.labels.indexOf(o)!==-1:u.isLoop||u.isSwitch){h.pop();return}}else if(s===i.Completion.CONTINUE&&(o?u.labels&&u.labels.indexOf(o)!==-1:u.isLoop))return}var p;if(this.isa(r,this.ERROR)){var d={EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError},f=String(this.getProperty(r,"name")),g=this.getProperty(r,"message").valueOf(),_=d[f]||Error;p=_(g)}else p=String(r);throw p},i.prototype.createGetter_=function(s,r){if(!this.getterStep_)throw Error("Unexpected call to createGetter");this.getterStep_=!1;var o=Array.isArray(r)?r[0]:r,h=new this.nodeConstructor({options:{}});h.type="CallExpression";var u=new i.State(h,this.stateStack[this.stateStack.length-1].scope);return u.doneCallee_=!0,u.funcThis_=o,u.func_=s,u.doneArgs_=!0,u.arguments_=[],u},i.prototype.createSetter_=function(s,r,o){if(!this.setterStep_)throw Error("Unexpected call to createSetter");this.setterStep_=!1;var h=Array.isArray(r)?r[0]:this.globalObject,u=new this.nodeConstructor({options:{}});u.type="CallExpression";var p=new i.State(u,this.stateStack[this.stateStack.length-1].scope);return p.doneCallee_=!0,p.funcThis_=h,p.func_=s,p.doneArgs_=!0,p.arguments_=[o],p},i.prototype.boxThis_=function(s){if(s==null)return this.globalObject;if(!(s instanceof i.Object)){var r=this.createObjectProto(this.getPrototype(s));return r.data=s,r}return s},i.Value,i.State=function(s,r){this.node=s,this.scope=r},i.Scope=function(s,r,o){this.parentScope=s,this.strict=r,this.object=o},i.Object=function(s){this.getter=Object.create(null),this.setter=Object.create(null),this.properties=Object.create(null),this.proto=s},i.Object.prototype.proto=null,i.Object.prototype.class="Object",i.Object.prototype.data=null,i.Object.prototype.toString=function(){if(!(this instanceof i.Object))return String(this);if(this.class==="Array"){var s=i.toStringCycles_;s.push(this);try{var r=[],o=this.properties.length,h=!1;o>1024&&(o=1e3,h=!0);for(var u=0;u<o;u++){var p=this.properties[u];r[u]=p instanceof i.Object&&s.indexOf(p)!==-1?"...":p}h&&r.push("...")}finally{s.pop()}return r.join(",")}if(this.class==="Error"){var s=i.toStringCycles_;if(s.indexOf(this)!==-1)return"[object Error]";var d,f,g=this;do if("name"in g.properties){d=g.properties.name;break}while(g=g.proto);var g=this;do if("message"in g.properties){f=g.properties.message;break}while(g=g.proto);s.push(this);try{d=d&&String(d),f=f&&String(f)}finally{s.pop()}return f?d+": "+f:String(d)}return this.data!==null?String(this.data):"[object "+this.class+"]"},i.Object.prototype.valueOf=function(){return this.data===void 0||this.data===null||this.data instanceof RegExp?this:this.data instanceof Date?this.data.valueOf():this.data},i.prototype.stepArrayExpression=function(s,r,o){var h=o.elements,u=r.n_||0;for(r.array_?(this.setProperty(r.array_,u,r.value),u++):(r.array_=this.createArray(),r.array_.properties.length=h.length);u<h.length;){if(h[u])return r.n_=u,new i.State(h[u],r.scope);u++}s.pop(),s[s.length-1].value=r.array_},i.prototype.stepAssignmentExpression=function(s,r,o){if(!r.doneLeft_){r.doneLeft_=!0;var h=new i.State(o.left,r.scope);return h.components=!0,h}if(!r.doneRight_){if(r.leftReference_||(r.leftReference_=r.value),r.doneGetter_&&(r.leftValue_=r.value),!r.doneGetter_&&o.operator!=="="){var u=this.getValue(r.leftReference_);if(r.leftValue_=u,this.getterStep_){r.doneGetter_=!0;var p=u;return this.createGetter_(p,r.leftReference_)}}return r.doneRight_=!0,o.operator==="="&&o.left.type==="Identifier"&&(r.destinationName=o.left.name),new i.State(o.right,r.scope)}if(r.doneSetter_){s.pop(),s[s.length-1].value=r.setterValue_;return}var d=r.leftValue_,f=r.value;switch(o.operator){case"=":d=f;break;case"+=":d+=f;break;case"-=":d-=f;break;case"*=":d*=f;break;case"/=":d/=f;break;case"%=":d%=f;break;case"<<=":d<<=f;break;case">>=":d>>=f;break;case">>>=":d>>>=f;break;case"&=":d&=f;break;case"^=":d^=f;break;case"|=":d|=f;break;default:throw SyntaxError("Unknown assignment expression: "+o.operator)}var g=this.setValue(r.leftReference_,d);if(g)return r.doneSetter_=!0,r.setterValue_=d,this.createSetter_(g,r.leftReference_,d);s.pop(),s[s.length-1].value=d},i.prototype.stepBinaryExpression=function(s,r,o){if(!r.doneLeft_)return r.doneLeft_=!0,new i.State(o.left,r.scope);if(!r.doneRight_)return r.doneRight_=!0,r.leftValue_=r.value,new i.State(o.right,r.scope);s.pop();var h=r.leftValue_,u=r.value,p;switch(o.operator){case"==":p=h==u;break;case"!=":p=h!=u;break;case"===":p=h===u;break;case"!==":p=h!==u;break;case">":p=h>u;break;case">=":p=h>=u;break;case"<":p=h<u;break;case"<=":p=h<=u;break;case"+":p=h+u;break;case"-":p=h-u;break;case"*":p=h*u;break;case"/":p=h/u;break;case"%":p=h%u;break;case"&":p=h&u;break;case"|":p=h|u;break;case"^":p=h^u;break;case"<<":p=h<<u;break;case">>":p=h>>u;break;case">>>":p=h>>>u;break;case"in":u instanceof i.Object||this.throwException(this.TYPE_ERROR,"'in' expects an object, not '"+u+"'"),p=this.hasProperty(u,h);break;case"instanceof":this.isa(u,this.FUNCTION)||this.throwException(this.TYPE_ERROR,"Right-hand side of instanceof is not an object"),p=h instanceof i.Object?this.isa(h,u):!1;break;default:throw SyntaxError("Unknown binary operator: "+o.operator)}s[s.length-1].value=p},i.prototype.stepBlockStatement=function(s,r,o){var h=r.n_||0,u=o.body[h];if(u)return r.n_=h+1,new i.State(u,r.scope);s.pop()},i.prototype.stepBreakStatement=function(s,r,o){var h=o.label&&o.label.name;this.unwind(i.Completion.BREAK,void 0,h)},i.prototype.stepCallExpression=function(s,r,o){if(!r.doneCallee_){r.doneCallee_=1;var h=new i.State(o.callee,r.scope);return h.components=!0,h}if(r.doneCallee_===1){r.doneCallee_=2;var u=r.value;if(Array.isArray(u)){if(r.func_=this.getValue(u),u[0]===i.SCOPE_REFERENCE?r.directEval_=u[1]==="eval":r.funcThis_=u[0],u=r.func_,this.getterStep_)return r.doneCallee_=1,this.createGetter_(u,r.value)}else r.func_=u;r.arguments_=[],r.n_=0}var u=r.func_;if(!r.doneArgs_){if(r.n_!==0&&r.arguments_.push(r.value),o.arguments[r.n_])return new i.State(o.arguments[r.n_++],r.scope);if(o.type==="NewExpression"){if((!(u instanceof i.Object)||u.illegalConstructor)&&this.throwException(this.TYPE_ERROR,u+" is not a constructor"),u===this.ARRAY)r.funcThis_=this.createArray();else{var p=u.properties.prototype;(typeof p!="object"||p===null)&&(p=this.OBJECT_PROTO),r.funcThis_=this.createObjectProto(p)}r.isConstructor=!0}r.doneArgs_=!0}if(r.doneExec_)s.pop(),r.isConstructor&&typeof r.value!="object"?s[s.length-1].value=r.funcThis_:s[s.length-1].value=r.value;else{r.doneExec_=!0,u instanceof i.Object||this.throwException(this.TYPE_ERROR,u+" is not a function");var d=u.node;if(d){for(var f=this.createScope(d.body,u.parentScope),g=0;g<d.params.length;g++){var _=d.params[g].name,v=r.arguments_.length>g?r.arguments_[g]:void 0;this.setProperty(f.object,_,v)}for(var y=this.createArray(),g=0;g<r.arguments_.length;g++)this.setProperty(y,g,r.arguments_[g]);this.setProperty(f.object,"arguments",y);var E=d.id&&d.id.name;return E&&this.setProperty(f.object,E,u),f.strict||(r.funcThis_=this.boxThis_(r.funcThis_)),this.setProperty(f.object,"this",r.funcThis_,i.READONLY_DESCRIPTOR),r.value=void 0,new i.State(d.body,f)}else if(u.eval){var m=r.arguments_[0];if(typeof m!="string")r.value=m;else{try{var x=e.parse(String(m),i.PARSE_OPTIONS)}catch(N){this.throwException(this.SYNTAX_ERROR,"Invalid code: "+N.message)}var C=new this.nodeConstructor({options:{}});C.type="EvalProgram_",C.body=x.body,i.stripLocations_(C,o.start,o.end);var f=r.directEval_?r.scope:this.globalScope;return f.strict?f=this.createScope(x,f):this.populateScope_(x,f),this.value=void 0,new i.State(C,f)}}else if(u.nativeFunc)r.scope.strict||(r.funcThis_=this.boxThis_(r.funcThis_)),r.value=u.nativeFunc.apply(r.funcThis_,r.arguments_);else if(u.asyncFunc){var O=this,S=function(V){r.value=V,O.paused_=!1},P=u.asyncFunc.length-1,F=r.arguments_.concat(new Array(P)).slice(0,P);F.push(S),this.paused_=!0,r.scope.strict||(r.funcThis_=this.boxThis_(r.funcThis_)),u.asyncFunc.apply(r.funcThis_,F);return}else this.throwException(this.TYPE_ERROR,u.class+" is not callable")}},i.prototype.stepCatchClause=function(s,r,o){if(r.done_)s.pop();else{r.done_=!0;var h=this.createSpecialScope(r.scope);return this.setProperty(h.object,o.param.name,r.throwValue),new i.State(o.body,h)}},i.prototype.stepConditionalExpression=function(s,r,o){var h=r.mode_||0;if(h===0)return r.mode_=1,new i.State(o.test,r.scope);if(h===1){r.mode_=2;var u=!!r.value;if(u&&o.consequent)return new i.State(o.consequent,r.scope);if(!u&&o.alternate)return new i.State(o.alternate,r.scope);this.value=void 0}s.pop(),o.type==="ConditionalExpression"&&(s[s.length-1].value=r.value)},i.prototype.stepContinueStatement=function(s,r,o){var h=o.label&&o.label.name;this.unwind(i.Completion.CONTINUE,void 0,h)},i.prototype.stepDebuggerStatement=function(s,r,o){s.pop()},i.prototype.stepDoWhileStatement=function(s,r,o){if(o.type==="DoWhileStatement"&&r.test_===void 0&&(r.value=!0,r.test_=!0),!r.test_)return r.test_=!0,new i.State(o.test,r.scope);if(!r.value)s.pop();else if(o.body)return r.test_=!1,r.isLoop=!0,new i.State(o.body,r.scope)},i.prototype.stepEmptyStatement=function(s,r,o){s.pop()},i.prototype.stepEvalProgram_=function(s,r,o){var h=r.n_||0,u=o.body[h];if(u)return r.n_=h+1,new i.State(u,r.scope);s.pop(),s[s.length-1].value=this.value},i.prototype.stepExpressionStatement=function(s,r,o){if(!r.done_)return r.done_=!0,new i.State(o.expression,r.scope);s.pop(),this.value=r.value},i.prototype.stepForInStatement=function(s,r,o){if(!r.doneInit_&&(r.doneInit_=!0,o.left.declarations&&o.left.declarations[0].init))return r.scope.strict&&this.throwException(this.SYNTAX_ERROR,"for-in loop variable declaration may not have an initializer."),new i.State(o.left,r.scope);if(!r.doneObject_)return r.doneObject_=!0,r.variable_||(r.variable_=r.value),new i.State(o.right,r.scope);if(r.isLoop||(r.isLoop=!0,r.object_=r.value,r.visited_=Object.create(null)),r.name_===void 0)t:for(;;){if(r.object_ instanceof i.Object)for(r.props_||(r.props_=Object.getOwnPropertyNames(r.object_.properties));;){var h=r.props_.shift();if(h===void 0)break;if(Object.prototype.hasOwnProperty.call(r.object_.properties,h)&&!r.visited_[h]&&(r.visited_[h]=!0,!!Object.prototype.propertyIsEnumerable.call(r.object_.properties,h))){r.name_=h;break t}}else if(r.object_!==null&&r.object_!==void 0)for(r.props_||(r.props_=Object.getOwnPropertyNames(r.object_));;){var h=r.props_.shift();if(h===void 0)break;if(r.visited_[h]=!0,!!Object.prototype.propertyIsEnumerable.call(r.object_,h)){r.name_=h;break t}}if(r.object_=this.getPrototype(r.object_),r.props_=null,r.object_===null){s.pop();return}}if(!r.doneVariable_){r.doneVariable_=!0;var u=o.left;if(u.type==="VariableDeclaration")r.variable_=[i.SCOPE_REFERENCE,u.declarations[0].id.name];else{r.variable_=null;var p=new i.State(u,r.scope);return p.components=!0,p}}if(r.variable_||(r.variable_=r.value),!r.doneSetter_){r.doneSetter_=!0;var d=r.name_,f=this.setValue(r.variable_,d);if(f)return this.createSetter_(f,r.variable_,d)}if(r.name_=void 0,r.doneVariable_=!1,r.doneSetter_=!1,o.body)return new i.State(o.body,r.scope)},i.prototype.stepForStatement=function(s,r,o){var h=r.mode_||0;if(h===0){if(r.mode_=1,o.init)return new i.State(o.init,r.scope)}else if(h===1){if(r.mode_=2,o.test)return new i.State(o.test,r.scope)}else if(h===2)if(r.mode_=3,o.test&&!r.value)s.pop();else return r.isLoop=!0,new i.State(o.body,r.scope);else if(h===3&&(r.mode_=1,o.update))return new i.State(o.update,r.scope)},i.prototype.stepFunctionDeclaration=function(s,r,o){s.pop()},i.prototype.stepFunctionExpression=function(s,r,o){s.pop(),r=s[s.length-1],r.value=this.createFunction(o,r.scope,r.destinationName)},i.prototype.stepIdentifier=function(s,r,o){if(s.pop(),r.components){s[s.length-1].value=[i.SCOPE_REFERENCE,o.name];return}var h=this.getValueFromScope(o.name);if(this.getterStep_){var u=h;return this.createGetter_(u,this.globalObject)}s[s.length-1].value=h},i.prototype.stepIfStatement=i.prototype.stepConditionalExpression,i.prototype.stepLabeledStatement=function(s,r,o){s.pop();var h=r.labels||[];h.push(o.label.name);var u=new i.State(o.body,r.scope);return u.labels=h,u},i.prototype.stepLiteral=function(s,r,o){s.pop();var h=o.value;if(h instanceof RegExp){var u=this.createObjectProto(this.REGEXP_PROTO);this.populateRegExp(u,h),h=u}s[s.length-1].value=h},i.prototype.stepLogicalExpression=function(s,r,o){if(o.operator!=="&&"&&o.operator!=="||")throw SyntaxError("Unknown logical operator: "+o.operator);if(!r.doneLeft_)return r.doneLeft_=!0,new i.State(o.left,r.scope);if(r.doneRight_)s.pop(),s[s.length-1].value=r.value;else if(o.operator==="&&"&&!r.value||o.operator==="||"&&r.value)s.pop(),s[s.length-1].value=r.value;else return r.doneRight_=!0,new i.State(o.right,r.scope)},i.prototype.stepMemberExpression=function(s,r,o){if(!r.doneObject_)return r.doneObject_=!0,new i.State(o.object,r.scope);var h;if(!o.computed)r.object_=r.value,h=o.property.name;else if(r.doneProperty_)h=r.value;else return r.object_=r.value,r.doneProperty_=!0,new i.State(o.property,r.scope);if(s.pop(),r.components)s[s.length-1].value=[r.object_,h];else{var u=this.getProperty(r.object_,h);if(this.getterStep_){var p=u;return this.createGetter_(p,r.object_)}s[s.length-1].value=u}},i.prototype.stepNewExpression=i.prototype.stepCallExpression,i.prototype.stepObjectExpression=function(s,r,o){var h=r.n_||0,u=o.properties[h];if(!r.object_)r.object_=this.createObjectProto(this.OBJECT_PROTO),r.properties_=Object.create(null);else{var p=r.destinationName;r.properties_[p]||(r.properties_[p]={}),r.properties_[p][u.kind]=r.value,r.n_=++h,u=o.properties[h]}if(u){var d=u.key;if(d.type==="Identifier")var p=d.name;else if(d.type==="Literal")var p=d.value;else throw SyntaxError("Unknown object structure: "+d.type);return r.destinationName=p,new i.State(u.value,r.scope)}for(var d in r.properties_){var f=r.properties_[d];if("get"in f||"set"in f){var g={configurable:!0,enumerable:!0,get:f.get,set:f.set};this.setProperty(r.object_,d,i.VALUE_IN_DESCRIPTOR,g)}else this.setProperty(r.object_,d,f.init)}s.pop(),s[s.length-1].value=r.object_},i.prototype.stepProgram=function(s,r,o){var h=o.body.shift();if(h)return r.done=!1,new i.State(h,r.scope);r.done=!0},i.prototype.stepReturnStatement=function(s,r,o){if(o.argument&&!r.done_)return r.done_=!0,new i.State(o.argument,r.scope);this.unwind(i.Completion.RETURN,r.value,void 0)},i.prototype.stepSequenceExpression=function(s,r,o){var h=r.n_||0,u=o.expressions[h];if(u)return r.n_=h+1,new i.State(u,r.scope);s.pop(),s[s.length-1].value=r.value},i.prototype.stepSwitchStatement=function(s,r,o){if(!r.test_)return r.test_=1,new i.State(o.discriminant,r.scope);for(r.test_===1&&(r.test_=2,r.switchValue_=r.value,r.defaultCase_=-1);;){var h=r.index_||0,u=o.cases[h];if(!r.matched_&&u&&!u.test){r.defaultCase_=h,r.index_=h+1;continue}if(!u&&!r.matched_&&r.defaultCase_!==-1){r.matched_=!0,r.index_=r.defaultCase_;continue}if(u){if(!r.matched_&&!r.tested_&&u.test)return r.tested_=!0,new i.State(u.test,r.scope);if(r.matched_||r.value===r.switchValue_){r.matched_=!0;var p=r.n_||0;if(u.consequent[p])return r.isSwitch=!0,r.n_=p+1,new i.State(u.consequent[p],r.scope)}r.tested_=!1,r.n_=0,r.index_=h+1}else{s.pop();return}}},i.prototype.stepThisExpression=function(s,r,o){s.pop(),s[s.length-1].value=this.getValueFromScope("this")},i.prototype.stepThrowStatement=function(s,r,o){if(r.done_)this.throwException(r.value);else return r.done_=!0,new i.State(o.argument,r.scope)},i.prototype.stepTryStatement=function(s,r,o){if(!r.doneBlock_)return r.doneBlock_=!0,new i.State(o.block,r.scope);if(r.cv&&r.cv.type===i.Completion.THROW&&!r.doneHandler_&&o.handler){r.doneHandler_=!0;var h=new i.State(o.handler,r.scope);return h.throwValue=r.cv.value,r.cv=void 0,h}if(!r.doneFinalizer_&&o.finalizer)return r.doneFinalizer_=!0,new i.State(o.finalizer,r.scope);s.pop(),r.cv&&this.unwind(r.cv.type,r.cv.value,r.cv.label)},i.prototype.stepUnaryExpression=function(s,r,o){if(!r.done_){r.done_=!0;var h=new i.State(o.argument,r.scope);return h.components=o.operator==="delete",h}s.pop();var u=r.value;if(o.operator==="-")u=-u;else if(o.operator==="+")u=+u;else if(o.operator==="!")u=!u;else if(o.operator==="~")u=~u;else if(o.operator==="delete"){var p=!0;if(Array.isArray(u)){var d=u[0];d===i.SCOPE_REFERENCE&&(d=r.scope);var f=String(u[1]);try{delete d.properties[f]}catch{r.scope.strict?this.throwException(this.TYPE_ERROR,"Cannot delete property '"+f+"' of '"+d+"'"):p=!1}}u=p}else if(o.operator==="typeof")u=u&&u.class==="Function"?"function":typeof u;else if(o.operator==="void")u=void 0;else throw SyntaxError("Unknown unary operator: "+o.operator);s[s.length-1].value=u},i.prototype.stepUpdateExpression=function(s,r,o){if(!r.doneLeft_){r.doneLeft_=!0;var h=new i.State(o.argument,r.scope);return h.components=!0,h}if(r.leftSide_||(r.leftSide_=r.value),r.doneGetter_&&(r.leftValue_=r.value),!r.doneGetter_){var p=this.getValue(r.leftSide_);if(r.leftValue_=p,this.getterStep_){r.doneGetter_=!0;var u=p;return this.createGetter_(u,r.leftSide_)}}if(r.doneSetter_){s.pop(),s[s.length-1].value=r.setterValue_;return}var p=Number(r.leftValue_),d;if(o.operator==="++")d=p+1;else if(o.operator==="--")d=p-1;else throw SyntaxError("Unknown update expression: "+o.operator);var f=o.prefix?d:p,g=this.setValue(r.leftSide_,d);if(g)return r.doneSetter_=!0,r.setterValue_=f,this.createSetter_(g,r.leftSide_,d);s.pop(),s[s.length-1].value=f},i.prototype.stepVariableDeclaration=function(s,r,o){var h=o.declarations,u=r.n_||0,p=h[u];for(r.init_&&p&&(this.setValueToScope(p.id.name,r.value),r.init_=!1,p=h[++u]);p;){if(p.init)return r.n_=u,r.init_=!0,r.destinationName=p.id.name,new i.State(p.init,r.scope);p=h[++u]}s.pop()},i.prototype.stepWithStatement=function(s,r,o){if(r.doneObject_)if(r.doneBody_)s.pop();else{r.doneBody_=!0;var h=this.createSpecialScope(r.scope,r.value);return new i.State(o.body,h)}else return r.doneObject_=!0,new i.State(o.object,r.scope)},i.prototype.stepWhileStatement=i.prototype.stepDoWhileStatement,this.Interpreter=i,i.prototype.step=i.prototype.step,i.prototype.run=i.prototype.run,i.prototype.appendCode=i.prototype.appendCode,i.prototype.createObject=i.prototype.createObject,i.prototype.createObjectProto=i.prototype.createObjectProto,i.prototype.createAsyncFunction=i.prototype.createAsyncFunction,i.prototype.createNativeFunction=i.prototype.createNativeFunction,i.prototype.getProperty=i.prototype.getProperty,i.prototype.setProperty=i.prototype.setProperty,i.prototype.nativeToPseudo=i.prototype.nativeToPseudo,i.prototype.pseudoToNative=i.prototype.pseudoToNative}).call(this,t("./original-repo/acorn.js"))},"./src/js-interpreter.js":function(l,n,t){t.r(n);var e=t("./original-repo/interpreter.js");n.default=e.Interpreter}}).default})}(jsInterpreter$1)),jsInterpreter$1.exports}var jsInterpreterExports=requireJsInterpreter();const Interpreter=getDefaultExportFromCjs(jsInterpreterExports);requireBlocks();requireJavascript();blocklyExports.Msg.MOVEMENT_HEX="#4c97ff";blocklyExports.Msg.OBJECTS_HEX="#59c059";blocklyExports.Msg.LOGIC_HEX="#ff9f29";blocklyExports.Msg.EXTRAS_HEX="#ff6680";blocklyExports.Msg.MATH_HEX="#7875FF";blocklyExports.Msg.EXAMPLES_HEX="#888888";blocklyExports.Msg.STRUCTURE_HEX="#888888";coreBrowserExports.Themes.Rocksi=coreBrowserExports.Theme.defineTheme("rocksi",{base:coreBrowserExports.Themes.Modern,blockStyles:{movement_blocks:{colourPrimary:blocklyExports.Msg.MOVEMENT_HEX},objects_blocks:{colourPrimary:blocklyExports.Msg.OBJECTS_HEX},colour_blocks:{colourPrimary:blocklyExports.Msg.OBJECTS_HEX},logic_blocks:{colourPrimary:blocklyExports.Msg.LOGIC_HEX},loop_blocks:{colourPrimary:blocklyExports.Msg.LOGIC_HEX},extras_blocks:{colourPrimary:blocklyExports.Msg.EXTRAS_HEX},examples_blocks:{colourPrimary:blocklyExports.Msg.EXAMPLES_HEX},structure_blocks:{colourPrimary:blocklyExports.Msg.STRUCTURE_HEX},math_blocks:{colourPrimary:blocklyExports.Msg.MATH_HEX}},categoryStyles:{}});blocklyExports.FieldAngle.WRAP=180;blocklyExports.Blocks.scale={init:function(){this.jsonInit({type:"scale",message0:"%{BKY_ROCKSI_BLOCK_SCALE}",args0:[{type:"field_slider",name:"NUM",value:1,min:.01,max:10,precision:.1}],output:"Number",style:"math_blocks",tooltip:"%{BKY_ROCKSI_BLOCK_SCALE_TOOLTIP}",helpUrl:""})}};const FIELD_ID_LEFT="LeftMutatorField",FIELD_ID_RIGHT="RightMutatorField";function createButton(l,n,t){let e=blocklyExports.utils.dom.createSvgElement(blocklyExports.utils.Svg.SVG,{},null);blocklyExports.utils.dom.createSvgElement(blocklyExports.utils.Svg.RECT,{class:"blocklyIconShape",rx:"4",ry:"4",height:"18",width:"18",fill:"#00f"},e),blocklyExports.utils.dom.createSvgElement(blocklyExports.utils.Svg.CIRCLE,{class:"blocklyIconSymbol",r:"6",cx:"9",cy:"9",fill:"#fff"},e),blocklyExports.utils.dom.createSvgElement(blocklyExports.utils.Svg.PATH,{class:"blocklyIconShape",d:l,style:"stroke: none;",fill:"#00f"},e);let i=blocklyExports.utils.xml.domToText(e);i="data:image/svg+xml;base64,"+btoa(i);const s=new blocklyExports.FieldImage(i,18,18,n,void 0,{tooltip:t});return s.initModel=function(){blocklyExports.utils.dom.addClass(s.fieldGroup_,"leftRightMutatorButton")},s}function createLeft(){return createButton("M 4 9 l 6 -5 v 3 h 3 v 4 h -3 v 3 Z","","bernehme die Werte aus der 3D-Ansicht")}function createRight(){return createButton("M 13 9 l -6 -5 v 3 h -3 v 4 h 3 v 3 Z","","Aktualisiere das Objekt in der 3D-Ansicht")}const LeftRightMutator={domToMutation:function(){},mutationToDom:function(){return document.createElement("mutation")},addButtons:function(){if(!this.getField(FIELD_ID_LEFT)){const l=createLeft();l.setOnClickHandler(this.left),this.inputList[0].appendField(l,FIELD_ID_LEFT)}if(!this.getField(FIELD_ID_RIGHT)){const l=createRight();l.setOnClickHandler(this.right),this.inputList[0].appendField(l,FIELD_ID_RIGHT)}},left:function(l){const n=this.sourceBlock_;typeof n.onLeft=="function"&&n.onLeft(l)},right:function(l){const n=this.sourceBlock_;typeof n.onRight=="function"&&n.onRight(l)}},leftRightHelper=function(){this.addButtons()};blocklyExports.Extensions.registerMutator("left_right_mutator",LeftRightMutator,leftRightHelper);blocklyExports.Blocks.move={init:function(){this.jsonInit({type:"move",message0:"%{BKY_ROCKSI_BLOCK_MOVE}",args0:[{type:"input_value",name:"POSE",check:["TaskspacePose","JointspacePose"]}],inputsInline:!1,previousStatement:null,nextStatement:"Array",style:"movement_blocks",tooltip:"%{BKY_ROCKSI_BLOCK_MOVE_TOOLTIP}",helpUrl:""})},getJointspacePose:function(){const l=Simulation.instance.getJointSpacePose();for(let n=0;n<l.length;n++)l[n]=l[n]*180/Math.PI;return l},setJointspacePose:function(l){for(let n=0;n<l.length;n++)l[n]*=Math.PI/180;Simulation.instance.robot.setPose(l),Simulation.instance.renderCallback()},getTaskspacePose:function(){let l=Simulation.instance.getTaskSpacePose();for(let n=3;n<6;n++)l[n]=l[n]*180/Math.PI;return l},setTaskspacePose:function(l){const n=Simulation.instance.robot,t=new Object3D;t.position.set(l[0],l[1],l[2]),l.length>3?t.setRotationFromEuler(new Euler(l[3],l[4],l[5])):t.setRotationFromQuaternion(n.tcp.object.quaternion);const e=Simulation.instance.ik.solve(t,n,n.ikEnabled,{maxIterations:30,stopDistance:.05,jointLimits:n.interactionJointLimits,apply:!1});this.setJointspacePose(e)}};blocklyExports.Blocks.default_pose={init:function(){this.jsonInit({type:"default_pose",message0:"%{BKY_ROCKSI_BLOCK_DEFAULTPOSE}",output:"JointspacePose",style:"movement_blocks",tooltip:"%{BKY_ROCKSI_BLOCK_DEFAULTPOSE_TOOLTIP}",helpUrl:""});const l=Simulation.instance,n=[],t=l.robot,e=t.defaultPose;for(const s of t.arm.movable){let r=e[s.name]||0;r*=180/Math.PI,n.push(r)}let i="";for(let s=0;s<n.length;s++)i+="j"+(s+1)+": "+n[s].toFixed(0)+`
`;this.setTooltip(i),this.defaultPose=n}};blocklyExports.Blocks.joint_space_pose={init:function(){const l=Simulation.instance;this.numJoints=l.robot.arm.movable.length;let n="",t=[];for(let e=1;e<=this.numJoints;e++)n+="j"+e+" %"+e,t.push({type:"field_angle",name:"JOINT_"+e,angle:0});this.jsonInit({type:"joint_space_pose",message0:n,args0:t,inputsInline:!0,output:"JointspacePose",style:"movement_blocks",tooltip:"%{BKY_ROCKSI_BLOCK_JOINTSPACEPOSE_TOOLTIP}",helpUrl:"",mutator:"left_right_mutator"})},onLeft:function(l){var n=this.getParent();if(n!=null&&typeof n.getJointspacePose=="function")for(var t=n.getJointspacePose(),e=0;e<t.length;e++)this.setFieldValue(t[e].toFixed(0),"JOINT_"+(e+1))},onRight:function(l){var n=this.getParent();if(n!=null&&typeof n.setJointspacePose=="function"){let t=[];for(let e=1;e<=this.numJoints;e++)t.push(this.getFieldValue("JOINT_"+e));n.setJointspacePose(t)}}};blocklyExports.Blocks.task_space_pose={init:function(){this.jsonInit({type:"pose",message0:"x %1 y %2 z %3  %4  %5  %6",args0:[{type:"field_number",name:"X",value:0,precision:.1},{type:"field_number",name:"Y",value:0,precision:.1},{type:"field_number",name:"Z",value:0,min:0,precision:.1},{type:"field_angle",name:"ROLL",angle:0,precision:.1},{type:"field_angle",name:"PITCH",angle:0,precision:.1},{type:"field_angle",name:"YAW",angle:0,precision:.1}],inputsInline:!0,output:"TaskspacePose",style:"movement_blocks",tooltip:"%{BKY_ROCKSI_BLOCK_TASKSPACEPOSE_TOOLTIP}",helpUrl:"",mutator:"left_right_mutator"})},onLeft:function(l){const n=["X","Y","Z","ROLL","PITCH","YAW"];var t=this.getParent();if(t!=null&&typeof t.getTaskspacePose=="function")for(var e=t.getTaskspacePose(),i=0;i<e.length;i++){let s=i<3?e[i].toFixed(1):e[i].toFixed(0);this.setFieldValue(s,n[i])}},onRight:function(l){var n=this.getParent();if(n!=null&&typeof n.setTaskspacePose=="function"){let t=[];for(const e of["X","Y","Z","ROLL","PITCH","YAW"])t.push(this.getFieldValue(e));n.setTaskspacePose(t)}}};blocklyExports.Blocks.joint_absolute={init:function(){const l=Simulation.instance;this.numJoints=l.robot.arm.movable.length;let n=[];for(let t=1;t<=this.numJoints;t++)n.push(["j"+t,t.toString()]);this.jsonInit({type:"joint_absolute",message0:"%{BKY_ROCKSI_BLOCK_JOINTABSOLUTE}",args0:[{type:"field_dropdown",name:"JOINT",options:n},{type:"field_angle",name:"DEGREES",angle:0}],inputsInline:!1,previousStatement:null,nextStatement:null,style:"movement_blocks",tooltip:"%{BKY_ROCKSI_BLOCK_JOINTABSOLUTE_TOOLTIP}",helpUrl:""})}};blocklyExports.Blocks.joint_relative={init:function(){const l=Simulation.instance;this.numJoints=l.robot.arm.movable.length;let n=[];for(let t=1;t<=this.numJoints;t++)n.push(["j"+t,t.toString()]);this.jsonInit({type:"joint_relative",message0:"%{BKY_ROCKSI_BLOCK_JOINTRELATIVE}",args0:[{type:"field_dropdown",name:"JOINT",options:n},{type:"field_angle",name:"DEGREES",angle:0}],inputsInline:!1,previousStatement:null,nextStatement:null,style:"movement_blocks",tooltip:"%{BKY_ROCKSI_BLOCK_JOINTRELATIVE_TOOLTIP}",helpUrl:""})}};/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class FieldSlider extends coreBrowserExports.FieldNumber{constructor(n=void 0,t=void 0,e=void 0,i=void 0,s=void 0,r=void 0){super(n,t,e,i,s,r),this.boundEvents_=[],this.sliderInput_=null}static fromJson(n){return new FieldSlider(n.value,void 0,void 0,void 0,void 0,n)}showEditor_(n=void 0,t=void 0){const e=coreBrowserExports.utils.userAgent.MOBILE||coreBrowserExports.utils.userAgent.ANDROID||coreBrowserExports.utils.userAgent.IPAD;super.showEditor_(n,e);const i=this.dropdownCreate_();coreBrowserExports.DropDownDiv.getContentDiv().appendChild(i),coreBrowserExports.DropDownDiv.setColour(this.sourceBlock_.style.colourPrimary,this.sourceBlock_.style.colourTertiary),coreBrowserExports.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this))}render_(){super.render_(),this.updateSlider_()}dropdownCreate_(){const n=document.createElement("div");n.className="fieldSliderContainer";const t=document.createElement("input");return t.setAttribute("type","range"),t.setAttribute("min",this.min_),t.setAttribute("max",this.max_),t.setAttribute("step",this.precision_),t.setAttribute("value",this.getValue()),t.className="fieldSlider",n.appendChild(t),this.sliderInput_=t,this.boundEvents_.push(coreBrowserExports.bindEventWithChecks_(t,"input",this,this.onSliderChange_)),n}dropdownDispose_(){for(const n of this.boundEvents_)coreBrowserExports.unbindEvent_(n);this.sliderInput_=null}onSliderChange_(){this.setEditorValue_(this.sliderInput_.value)}updateSlider_(){this.sliderInput_&&this.sliderInput_.setAttribute("value",this.getValue())}}coreBrowserExports.fieldRegistry.register("field_slider",FieldSlider);coreBrowserExports.Css.register([`.fieldSliderContainer {
      align-items: center;
      display: flex;
      height: 32px;
      justify-content: center;
      width: 150px;
    }
    .fieldSlider {
      -webkit-appearance: none;
      background: transparent; /* override white in chrome */
      margin: 4px;
      padding: 0;
      width: 100%;
    }
    .fieldSlider:focus {
      outline: none;
    }
    /* Webkit */
    .fieldSlider::-webkit-slider-runnable-track {
      background: #ddd;
      border-radius: 5px;
      height: 10px;
    }
    .fieldSlider::-webkit-slider-thumb {
      -webkit-appearance: none;
      background: #fff;
      border-radius: 50%;
      box-shadow: 0 0 0 4px rgba(255,255,255,.15);
      cursor: pointer;
      height: 24px;
      margin-top: -7px;
      width: 24px;
    }
    /* Firefox */
    .fieldSlider::-moz-range-track {
      background: #ddd;
      border-radius: 5px;
      height: 10px;
    }
    .fieldSlider::-moz-range-thumb {
      background: #fff;
      border: none;
      border-radius: 50%;
      box-shadow: 0 0 0 4px rgba(255,255,255,.15);
      cursor: pointer;
      height: 24px;
      width: 24px;
    }
    .fieldSlider::-moz-focus-outer {
      /* override the focus border style */
      border: 0;
    }
    /* IE */
    .fieldSlider::-ms-track {
      /* IE wont let the thumb overflow the track, so fake it */
      background: transparent;
      border-color: transparent;
      border-width: 15px 0;
      /* remove default tick marks */
      color: transparent;
      height: 10px;
      width: 100%;
      margin: -4px 0;
    }
    .fieldSlider::-ms-fill-lower  {
      background: #ddd;
      border-radius: 5px;
    }
    .fieldSlider::-ms-fill-upper  {
      background: #ddd;
      border-radius: 5px;
    }
    .fieldSlider::-ms-thumb {
      background: #fff;
      border: none;
      border-radius: 50%;
      box-shadow: 0 0 0 4px rgba(255,255,255,.15);
      cursor: pointer;
      height: 24px;
      width: 24px;
    }`]);const fieldKeys=["X","Y","Z","ROLL","PITCH","YAW"];blocklyExports.Blocks.gripper_open={init:function(){this.jsonInit({type:"gripper_open",message0:"%{BKY_ROCKSI_BLOCK_GRIPPEROPEN}",previousStatement:null,nextStatement:null,style:"objects_blocks",tooltip:"%{BKY_ROCKSI_BLOCK_GRIPPEROPEN_TOOLTIP}",helpUrl:""})}};blocklyExports.Blocks.gripper_close={init:function(){this.jsonInit({type:"gripper_close",message0:"%{BKY_ROCKSI_BLOCK_GRIPPERCLOSE}",previousStatement:null,nextStatement:null,style:"objects_blocks",tooltip:"%{BKY_ROCKSI_BLOCK_GRIPPERCLOSE_TOOLTIP}",helpUrl:""})}};blocklyExports.Blocks.add_sim_object={init:function(){this.jsonInit({type:"add_sim_object",message0:"%{BKY_ROCKSI_BLOCK_SIMOBJECT}",args0:[{type:"field_dropdown",name:"OBJECT_SHAPE",options:[["%{BKY_ROCKSI_BLOCK_SIMOBJECT_CUBE}","cube"],["%{BKY_ROCKSI_BLOCK_SIMOBJECT_SPHERE}","sphere"],["%{BKY_ROCKSI_BLOCK_SIMOBJECT_ROCK}","rock"],["%{BKY_ROCKSI_BLOCK_SIMOBJECT_SHAFT}","shaft"],["%{BKY_ROCKSI_BLOCK_SIMOBJECT_CUSTOM}","custom"]]}],message1:"%{BKY_ROCKSI_BLOCK_SIMOBJECT_COLOR}",args1:[{type:"input_value",name:"COLOUR",check:"Colour"}],message2:"%{BKY_ROCKSI_BLOCK_SIMOBJECT_POSITION}",args2:[{type:"input_value",name:"POSE",check:"TaskspacePose"}],message3:"%{BKY_ROCKSI_BLOCK_SIMOBJECT_SCALE}",args3:[{type:"input_value",name:"SCALE",check:"Number"}],inputsInline:!1,previousStatement:null,nextStatement:null,style:"objects_blocks",tooltip:"%{BKY_ROCKSI_BLOCK_SIMOBJECT_TOOLTIP}",helpUrl:""})},getTaskspacePose:function(){let l=[];const n=getSimObject(this.id);return n!=null&&(n.updateFieldValues(),l=n.getFieldValues()),l},setTaskspacePose:function(l){const n=getSimObject(this.id);n!==void 0&&(n.updateFromFieldValues(),Simulation.instance.renderCallback())},onchange:function(l){let n=getSimObject(this.id);if(!n)return;const t=this.getInputTargetBlock("POSE"),e=this.getInputTargetBlock("COLOUR"),i=this.getInputTargetBlock("SCALE");if(l.blockId===this.id&&l.name=="OBJECT_SHAPE"&&n.changeShape(l.newValue),t!==null&&l.blockId===t.id&&fieldKeys.includes(l.name)){let s=[];for(let r=0;r<fieldKeys.length;r++)s.push(t.getFieldValue(fieldKeys[r]));n.setFieldValues(s),n.updateFromFieldValues(),Simulation.instance.renderCallback()}if(i!==null&&l.blockId===i.id&&n.setScale(l.newValue),e!=null){let s=n.color;l.blockId===e.id&&(e.type=="colour_random"?s=randomColour():e.type=="colour_picker"&&(s=e.getFieldValue("COLOUR"))),n.setColor(s),Simulation.instance.renderCallback(),e.type=="colour_random"&&e.setColour(n.color)}}};blocklyExports.Blocks.physics_done={init:function(){this.jsonInit({type:"physics_done",message0:"%{BKY_ROCKSI_BLOCK_PHYSICSDONE}",output:"Boolean",style:"objects_blocks",tooltip:"%{BKY_ROCKSI_BLOCK_PHYSICSDONE_TOOLTIP}",helpUrl:""})}};blocklyExports.Blocks.is_attached={init:function(){this.jsonInit({type:"is_attached",message0:"%{BKY_ROCKSI_BLOCK_HOLDING}",output:"Boolean",style:"objects_blocks",tooltip:"%{BKY_ROCKSI_BLOCK_HOLDING_TOOLTIP}",helpUrl:""})}};blocklyExports.Blocks.comment={init:function(){this.jsonInit({type:"comment",message0:"%{BKY_ROCKSI_BLOCK_COMMENT}",args0:[{type:"field_input",name:"COMMENT",text:""}],previousStatement:null,nextStatement:null,style:"structure_blocks",tooltip:"%{BKY_ROCKSI_BLOCK_COMMENT_TOOLTIP}",helpUrl:""})}};blocklyExports.Blocks.wait={init:function(){this.jsonInit({type:"wait",message0:"%{BKY_ROCKSI_BLOCK_WAIT}",args0:[{type:"field_number",name:"SECONDS",value:1,min:0,precision:1}],previousStatement:null,nextStatement:null,style:"extras_blocks",tooltip:"%{BKY_ROCKSI_BLOCK_WAIT_TOOLTIP}",helpUrl:""})}};blocklyExports.Blocks.set_speed={init:function(){this.jsonInit({type:"set_speed",message0:"%{BKY_ROCKSI_BLOCK_SETSPEED}",args0:[{type:"field_dropdown",name:"MOTION_TYPE",options:[["%{BKY_ROCKSI_BLOCK_SETSPEED_MOVE}","move"],["%{BKY_ROCKSI_BLOCK_SETSPEED_GRIPPER}","gripper"]]},{type:"field_number",name:"SPEED",value:50,min:1,max:100,precision:1}],previousStatement:null,nextStatement:null,style:"extras_blocks",tooltip:"%{BKY_ROCKSI_BLOCK_SETSPEED_TOOLTIP}",helpUrl:""})}};blocklyExports.Blocks.joint_lock={init:function(){const l=Simulation.instance;this.numJoints=l.robot.arm.movable.length;let n=[];for(let t=1;t<=this.numJoints;t++)n.push(["j"+t,t.toString()]);this.jsonInit({type:"joint_lock",message0:"%{BKY_ROCKSI_BLOCK_JOINTLOCK}",args0:[{type:"field_dropdown",name:"JOINT",options:n}],inputsInline:!1,previousStatement:null,nextStatement:null,style:"extras_blocks",tooltip:"%{BKY_ROCKSI_BLOCK_JOINTLOCK_TOOLTIP}",helpUrl:""})}};blocklyExports.Blocks.joint_unlock={init:function(){const l=Simulation.instance;this.numJoints=l.robot.arm.movable.length;let n=[];for(let t=1;t<=this.numJoints;t++)n.push(["j"+t,t.toString()]);this.jsonInit({type:"joint_unlock",message0:"%{BKY_ROCKSI_BLOCK_JOINTUNLOCK}",args0:[{type:"field_dropdown",name:"JOINT",options:n}],inputsInline:!1,previousStatement:null,nextStatement:null,style:"extras_blocks",tooltip:"%{BKY_ROCKSI_BLOCK_JOINTUNLOCK_TOOLTIP}",helpUrl:""})}};blocklyExports.JavaScript.move=function(l){let n=blocklyExports.JavaScript.valueToCode(l,"POSE",blocklyExports.JavaScript.ORDER_COMMA)||0;var e='robot("move", "'+l.getInputTargetBlock("POSE").outputConnection.getCheck()[0]+'", '+n+`);
`;return e};blocklyExports.JavaScript.default_pose=function(l){return["["+this.defaultPose.toString()+"]",blocklyExports.JavaScript.ORDER_ATOMIC]};blocklyExports.JavaScript.joint_space_pose=function(l){let n=[];for(let e=1;e<8;e++)n.push(l.getFieldValue("JOINT_"+e));return["["+n.toString()+"]",blocklyExports.JavaScript.ORDER_ATOMIC]};blocklyExports.JavaScript.task_space_pose=function(l){let n=[];for(const e of["X","Y","Z","ROLL","PITCH","YAW"])n.push(l.getFieldValue(e));return["["+n.toString()+"]",blocklyExports.JavaScript.ORDER_ATOMIC]};blocklyExports.JavaScript.joint_absolute=function(l){let n=l.getFieldValue("JOINT"),t=l.getFieldValue("DEGREES");return'robot("joint_absolute", '+n+", "+t+`);
`};blocklyExports.JavaScript.joint_relative=function(l){let n=l.getFieldValue("JOINT"),t=l.getFieldValue("DEGREES");return'robot("joint_relative", '+n+", "+t+`);
`};blocklyExports.JavaScript.gripper_open=function(l){var n=`robot("gripper_open");
`;return n};blocklyExports.JavaScript.gripper_close=function(l){var n=`robot("gripper_close");
`;return n};blocklyExports.JavaScript.add_sim_object=function(l){var n=getSimObjectIdx(this.id),t=getSimObject(this.id);t.updateFromFieldValues();var e='robot("startPhysicalBody", '+n+");";return e};blocklyExports.JavaScript.physics_done=function(l){return['robot("getPhysicsDone")',blocklyExports.JavaScript.ORDER_ATOMIC]};blocklyExports.JavaScript.is_attached=function(l){let n='["is_attached", '+isAttached()+"]";return console.log(n),[n,blocklyExports.JavaScript.ORDER_ATOMIC]};blocklyExports.JavaScript.comment=function(l){return"// "+l.getFieldValue("COMMENT")+`
`};blocklyExports.JavaScript.wait=function(l){return'robot("wait", '+l.getFieldValue("SECONDS")*1e3+`);
`};blocklyExports.JavaScript.set_speed=function(l){var n=l.getFieldValue("MOTION_TYPE"),t=l.getFieldValue("SPEED"),e='robot("setParam", "velocity/'+n+'", '+t/100+`);
`;return e};blocklyExports.JavaScript.joint_lock=function(l){var n=l.getFieldValue("JOINT"),t='robot("lockJoint", '+n+`);
`;return t};blocklyExports.JavaScript.joint_unlock=function(l){var n=l.getFieldValue("JOINT"),t='robot("unlockJoint", '+n+`);
`;return t};const toolbox='<xml id="blocks-toolbox" style="display: none"><!--Bewegung des Roboters--><category name="%{BKY_ROCKSI_CATEGORY_MOVE}" categorystyle="movement_category"><block type="move"></block><block type="default_pose"></block><block type="joint_space_pose"></block><block type="task_space_pose"></block><block type="joint_absolute"></block><block type="joint_relative"></block></category><!--3D-Objekte und Greifer--><category name="%{BKY_ROCKSI_CATEGORY_OBJECTS}" categorystyle="objects_category"><block type="add_sim_object"><value name="COLOUR"><block type="colour_random"></block></value><value name="POSE"><block type="task_space_pose"><field name="X">5</field></block></value><value name="SCALE"><block type="scale"><field name="NUM">1</field></block></value></block><block type="is_attached"></block><block type="gripper_open"></block><block type="gripper_close"></block><block type="colour_picker"></block><block type="colour_random"></block><block type="physics_done"></block></category><!--Schleifen&co--><category name="%{BKY_ROCKSI_CATEGORY_LOGIC}" categorystyle="logic_category"><block type="controls_if"></block><block type="controls_whileUntil"></block><block type="controls_repeat"><value name="TIMES"><shadow type="math_number"><field name="NUM">10</field></shadow></value></block><block type="logic_boolean"></block><block type="logic_negate"></block><block type="controls_flow_statements"></block></category><!--Kommentare,Einstellungen,etc.--><category name="%{BKY_ROCKSI_CATEGORY_EXTRAS}" categorystyle="extras_category"><block type="comment"></block><block type="wait"></block><block type="set_speed"></block><block type="joint_lock"></block><block type="joint_unlock"></block></category><!--Beispielprogramme--><category name="%{BKY_ROCKSI_CATEGORY_EXAMPLES}" categorystyle="examples_category"><!--Pick&Place--><block type="comment"><field name="COMMENT">%{BKY_ROCKSI_EXAMPLE_PICK_N_PLACE}</field><next><block type="move"><value name="POSE"><block type="default_pose"></block></value><next><block type="add_sim_object"><field name="OBJECT_SHAPE">cube</field><value name="COLOUR"><block type="colour_random"></block></value><value name="SCALE"><block type="scale"><field name="NUM">1</field></block></value><value name="POSE"><block type="task_space_pose"><field name="X">5</field><field name="Y">0</field><field name="Z">0</field><field name="ROLL">0</field><field name="PITCH">0</field><field name="YAW">0</field></block></value><next><block type="gripper_open"><next><block type="wait"><field name="SECONDS">1</field><next><block type="move"><comment pinned="false">%{BKY_ROCKSI_EXAMPLE_PICK_N_PLACE_COMMENT_1}</comment><value name="POSE"><block type="task_space_pose"><field name="X">5</field><field name="Y">0</field><field name="Z">0.3</field><field name="ROLL">0</field><field name="PITCH">0</field><field name="YAW">0</field></block></value><next><block type="gripper_close"><next><block type="move"><value name="POSE"><block type="default_pose"></block></value><next><block type="gripper_open"><next><block type="wait"><field name="SECONDS">3</field></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></category></xml>',language=getDesiredLanguage();let BlocklyLang=BlocklyLangEN,BlocklyLangCustom=BlocklyCustomEN;language==="de"&&(BlocklyLang=BlocklyLangDE,BlocklyLangCustom=BlocklyCustomDE);coreBrowserExports.setLocale(BlocklyLang);coreBrowserExports.setLocale(BlocklyLangCustom);const generator=coreBrowserExports.JavaScript;generator.STATEMENT_PREFIX=`highlightBlock(%1);
`;generator.addReservedWords("highlightBlock");generator.addReservedWords("sendRobotCommand");generator.addReservedWords("code");var blocklyArea=document.querySelector(".blocks-container"),blocklyDiv=document.getElementById("blocks-canvas"),workspace=coreBrowserExports.inject(blocklyDiv,{toolbox,renderer:"geras",horizontalLayout:!1,grid:{spacing:20,length:3,colour:"#ddd",snap:!0},move:{drag:!0,scrollbars:!0},zoom:{controls:!0,wheel:!1,startScale:1,maxScale:3,minScale:.3,scaleSpeed:1.1,pinch:!0},trashcan:!1,collapse:!1,disable:!0,theme:coreBrowserExports.Themes.Rocksi}),toolboxFlyout=$(".blocklyFlyout"),toolboxScrollbar=$(".blocklyFlyoutScrollbar");toolboxFlyout.each((l,n)=>{var t=new MutationObserver((e,i)=>{let s=$(n);if(s.css("display")!=="none"){let r=parseInt(s.css("left"))+s.width()-toolboxScrollbar.width()+2;toolboxScrollbar.css("transform","translate("+r+"px, 2.5px)")}});t.observe(n,{attributes:!0})});var onresize=function(){var l=blocklyArea,n=0,t=0;do n+=l.offsetLeft,t+=l.offsetTop,l=l.offsetParent;while(l);blocklyDiv.style.left=n+"px",blocklyDiv.style.top=t+"px",blocklyDiv.style.width=blocklyArea.offsetWidth+"px",blocklyDiv.style.height=blocklyArea.offsetHeight+"px",coreBrowserExports.svgResize(workspace)};new ResizeSensor(blocklyArea,onresize);blocklyArea.addEventListener("resize",onresize,!1);onresize();coreBrowserExports.svgResize(workspace);window.matchMedia("(hover: none)")&&$("#blockly-mobile-menu").on("click",l=>{console.log(coreBrowserExports.selected),coreBrowserExports.selected!==null?(console.log("block"),workspace.getBlockById(coreBrowserExports.selected.id).showContextMenu(l)):(console.log("workspace"),workspace.showContextMenu(l))});var contextSaveWorkspace={displayText:function(){return coreBrowserExports.Msg.SAVE||"Save workspace"},preconditionFn:function(l){return l.workspace.getTopBlocks(!1).length>0?"enabled":"disabled"},callback:function(l){let n=coreBrowserExports.Xml.workspaceToDom(l.workspace),t=coreBrowserExports.Xml.domToText(n),e=document.createElement("a");e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),e.setAttribute("download","workspace.xml"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)},scopeType:coreBrowserExports.ContextMenuRegistry.ScopeType.WORKSPACE,id:"saveWorkspace",weight:99};coreBrowserExports.ContextMenuRegistry.registry.register(contextSaveWorkspace);var contextLoadWorkspace={displayText:function(){return coreBrowserExports.Msg.LOAD||"Load workspace"},preconditionFn:function(l){return"enabled"},callback:function(l){let n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("accept",".xml"),n.style.display="none",n.onchange=t=>{try{let e=t.target.files[0],i=new FileReader;i.readAsText(e,"UTF-8"),i.onload=s=>{let r=s.target.result,o=coreBrowserExports.Xml.textToDom(r);coreBrowserExports.Xml.domToWorkspace(l.workspace,o)}}catch(e){console.log(e)}},document.body.appendChild(n),n.click(),document.body.removeChild(n)},scopeType:coreBrowserExports.ContextMenuRegistry.ScopeType.WORKSPACE,id:"loadWorkspace",weight:99};coreBrowserExports.ContextMenuRegistry.registry.register(contextLoadWorkspace);Simulation.getInstance().then(l=>{const n=l.robot,t=n.generator;if(!t)return;let e={displayText:function(){return coreBrowserExports.Msg.CODE_EXPORT||"Code Export"},preconditionFn:function(i){return i.workspace.getTopBlocks(!1).length>0?"enabled":"disabled"},callback:function(i){t.init(i.workspace);let s=t.workspaceToCode(i.workspace);console.log(s);let r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(s)),r.setAttribute("download",n.name+(t.FILE_EXTENSION||".txt")),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),alert(localize("note-code-export"))},scopeType:coreBrowserExports.ContextMenuRegistry.ScopeType.WORKSPACE,id:"codeExport",weight:99};coreBrowserExports.ContextMenuRegistry.registry.register(e)});const runButton=document.querySelector(".run-button");runButton.onclick=function(){return runButton.classList.toggle("running"),runButton.classList.contains("running")?(workspace.getTopBlocks(!1).length==0&&popWarning(coreBrowserExports.Msg.EMPTY_PROGRAM||"Empty program"),compileProgram(),executeProgram()):(pauseExecution(),simulation.cancel()),!1};var simulation=null;Simulation.getInstance().then(l=>{simulation=l,runButton.disabled=!1});function simulationAPI(l,n){let t=function(e){return workspace.highlightBlock(e)};l.setProperty(n,"highlightBlock",l.createNativeFunction(t)),t=async function(e,...i){try{pauseExecution(),await simulation.run(e,...i),executeProgram()}catch(s){onProgramError(s)}},l.setProperty(n,"robot",l.createNativeFunction(t))}var interpreter=null;function compileProgram(){simulation.reset(),simulation.resetSimObjects(!1);try{let n=coreBrowserExports.JavaScript.workspaceToCode(workspace);console.log(n),interpreter=new Interpreter(n,simulationAPI)}catch(n){throw onProgramError(n),n}}function pauseExecution(){interpreter&&(interpreter.paused_=!0)}function executeProgram(){if(!interpreter)throw new Error("Program has not been compiled yet");disablePointerEvents(),remControledSimObject(),interpreter.paused_=!1;try{interpreter.run()||waitForPhysicsSim()}catch(l){onProgramError(l)}}function waitForPhysicsSim(){simulation.getPhysicsDone()?onProgramFinished():setTimeout(()=>{waitForPhysicsSim()},200)}function onProgramError(l){interpreter=null,workspace.highlightBlock(null),simulation.resetSimObjects(!0),runButton.classList.remove("running"),console.error("Program execution failed: ",l),popError(l+`
`+(coreBrowserExports.Msg.SEE_CONSOLE||"See console for additional details.")),enablePointerEvents()}function onProgramFinished(){interpreter=null,workspace.highlightBlock(null),simulation.resetSimObjects(!0),runButton.classList.remove("running"),console.log("Execution finished"),popSuccess(coreBrowserExports.Msg.EXEC_SUCCESS||"Program finished"),enablePointerEvents()}function watchSpawnBlocks(l){if(coreBrowserExports.Events.BLOCK_CREATE===l.type)for(let n=0;n<l.ids.length;n++){const t=workspace.getBlockById(l.ids[n]);if(t.type==="add_sim_object"){const e=t.getFieldValue("OBJECT_SHAPE"),i=t.getInputTargetBlock("POSE"),s=t.getInputTargetBlock("COLOUR"),r=t.getInputTargetBlock("SCALE"),o=["X","Y","Z","ROLL","PITCH","YAW"];let h=[],u,p;if(i!=null)for(let d=0;d<o.length;d++)h.push(i.getFieldValue(o[d]));else h=void 0;s!=null?(s.type==="colour_picker"&&(u=s.getFieldValue("COLOUR")),s.type==="colour_random"&&(u=randomColour())):u=void 0,r!=null?p=r.getFieldValue("NUM"):p=1,addSimObject(t.id,h,u,e,p)}}coreBrowserExports.Events.BLOCK_DELETE===l.type&&remSimObjects(l.ids)}workspace.addChangeListener(watchSpawnBlocks);$.extend($.i18n.parser.emitter,{link:function(l){let n=l[2]||"_blank";return'<a href="'+l[1]+'" target ="'+n+'">'+l[0]+"</a>"}});$.i18n().load({en:html_en$1,de:html_de$1});const lang=getDesiredLanguage();$.i18n().locale=lang;jQuery(document).ready(function(){$("body").i18n(),$(".i18n-only").hide(),$(".i18n-only."+lang).show();let l=document.querySelectorAll("[load-i18n]");for(let n=l.length;n--;){let t=l[n],e=t.getAttribute("load-i18n"),i=$.i18n(e);$(t).load(i,function(s,r,o){r=="error"&&$(t).append("Error: "+o.status+":: "+o.statusText)})}});let accordions=document.getElementsByClassName("accordion");function setAccordionVisible(l,n){let t=document.querySelector(l.getAttribute("panel"));if(n){let e=Math.min(window.outerHeight,document.documentElement.clientHeight)-60;e+=$(t.parentNode).find(".accordion-panel.active").height()||0;let i=t.parentNode.parentNode.firstElementChild;do e-=i.offsetHeight;while(i=i.nextElementSibling);e=Math.min(e,t.scrollHeight),l.classList.add("active"),t.classList.add("active"),t.style.maxHeight=e+"px"}else l.classList.remove("active"),t.classList.remove("active"),t.style.maxHeight=null}for(let l=0;l<accordions.length;l++)accordions[l].addEventListener("click",function(n){n.stopPropagation();let t=!this.classList.contains("active");setAccordionVisible(this,t);for(let e of accordions)e!==this&&setAccordionVisible(e,!1)});Split(["#split-pane-1","#split-pane-2"],{minSize:0,snapOffset:20,gutterStyle:function(l,n,t){return{}}});let animDuration=200;function getSplitpaneRatio(){return isNarrowScreen()?100:50}isNarrowScreen()&&($("#split-pane-1").hide(),$("#split-pane-2").css("width","100%"));$("#blocks-btn").on("click",l=>{let n=$("#split-pane-2");if(n.width()>0)n.animate({width:0},animDuration),$("#split-pane-1").show().animate({width:"100%"},animDuration);else{let t=getSplitpaneRatio();n.animate({width:t+"%"},animDuration),$("#split-pane-1").animate({width:100-t+"%"},animDuration)}});$("#viewport-btn").on("click",l=>{let n=$("#split-pane-1");if(n.width()>0)n.animate({width:0},animDuration),$("#split-pane-2").show().animate({width:"100%"},animDuration);else{let t=getSplitpaneRatio();n.animate({width:t+"%"},animDuration),$("#split-pane-2").animate({width:100-t+"%"},animDuration)}});let slides=$("#tutorial-container .tutorial-slide");slides.each((l,n)=>{let t=l===0?slides.length-1:l-1,e=l===slides.length-1?0:l+1,i=document.createElement("label");i.setAttribute("for","tutorial-radio-"+t),i.classList.add("prev");let s=document.createElement("label");s.setAttribute("for","tutorial-radio-"+e),s.classList.add("next"),n.appendChild(i),n.appendChild(s)});$("#tutorial-btn").on("click",l=>{$("#tutorial-container").show(),$("#robot-gui").hide()});$("#tutorial-close-btn").on("click",l=>{$("#tutorial-container").hide(),$("#robot-gui").show(),$(".tutorial-slide video").each((n,t)=>{t.pause(),t.removeAttribute("src"),t.load()})});$("#about-btn").on("click",l=>{$("#robot-gui").hide(),$("#about-lightbox").show()});$("#about-lightbox").click(function(l){let n=$("#about-box");if(n.is(l.target)||n.has(l.target).length>0)return;let t=$("#about-lightbox");t.hide(),$("#robot-gui").show();for(let e of accordions)t.find(e).length&&setAccordionVisible(e,!1)});$("body").on("click.first-time-hint",l=>{$("#first-time-hint").hide(),$(void 0).off("click.first-time-hint")});const lazyObserver=lozad();lazyObserver.observe();window.onbeforeunload=function(){return localize("warn-unsaved")};try{document.location.hostname==window.parent.location.hostname&&$("#iframe-notice").hide()}catch(l){}});export default wi();
